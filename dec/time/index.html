<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta name="generator" content="quarto-1.8.24">
<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">
<meta name="author" content="Martin Laptev">
<meta name="description" content="Introducing Declock, a timekeeping system that displays time in decimal days using math notation without the need for hours, minutes, or seconds.">
<title>Martin Laptev</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
html { -webkit-text-size-adjust: 100%; }
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>

<script src="https://cdn.jsdelivr.net/npm/jquery@3.5.1/dist/jquery.min.js" integrity="sha384-ZvpUoO/+PpLXR1lu4jmpXWu80pZlYUAfxl5NsBMWOEPSjUn/6Z/hRTt8+pR6L4N2" crossorigin="anonymous"></script><script src="../../site_libs/quarto-nav/quarto-nav.js"></script>
<script src="../../site_libs/quarto-nav/headroom.min.js"></script>
<script src="../../site_libs/clipboard/clipboard.min.js"></script>
<script src="../../site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="../../site_libs/quarto-search/fuse.min.js"></script>
<script src="../../site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="../../">
<link href="../../dec/snap/index.html" rel="next">
<link href="../../dec/date/index.html" rel="prev">
<link href="../../asset/deidec.png" rel="icon" type="image/png">
<script src="../../site_libs/quarto-html/quarto.js" type="module"></script>
<script src="../../site_libs/quarto-html/tabsets/tabsets.js" type="module"></script>
<script src="../../site_libs/quarto-html/axe/axe-check.js" type="module"></script>
<script src="../../site_libs/quarto-html/popper.min.js"></script>
<script src="../../site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="../../site_libs/quarto-html/anchor.min.js"></script>
<link href="../../site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="../../site_libs/quarto-html/quarto-syntax-highlighting-e2ebf8e2605a502049583e0d4fe4413a.css" rel="stylesheet" class="quarto-color-scheme" id="quarto-text-highlighting-styles">
<link href="../../site_libs/quarto-html/quarto-syntax-highlighting-dark-7c0818a6829d610e3ad73bed61f3c46a.css" rel="stylesheet" class="quarto-color-scheme quarto-color-alternate" id="quarto-text-highlighting-styles">
<link href="../../site_libs/quarto-html/quarto-syntax-highlighting-e2ebf8e2605a502049583e0d4fe4413a.css" rel="stylesheet" class="quarto-color-scheme-extra" id="quarto-text-highlighting-styles">
<script src="../../site_libs/bootstrap/bootstrap.min.js"></script>
<link href="../../site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="../../site_libs/bootstrap/bootstrap-b9a791a25694aed63ced742de07bb413.min.css" rel="stylesheet" append-hash="true" class="quarto-color-scheme" id="quarto-bootstrap" data-mode="light">
<link href="../../site_libs/bootstrap/bootstrap-dark-29043812d9f31e1eb9e441e8c0f57f75.min.css" rel="stylesheet" append-hash="true" class="quarto-color-scheme quarto-color-alternate" id="quarto-bootstrap" data-mode="dark">
<link href="../../site_libs/bootstrap/bootstrap-b9a791a25694aed63ced742de07bb413.min.css" rel="stylesheet" append-hash="true" class="quarto-color-scheme-extra" id="quarto-bootstrap" data-mode="light"><script id="quarto-search-options" type="application/json">{
  "location": "sidebar",
  "copy-button": true,
  "collapse-after": 3,
  "panel-placement": "start",
  "type": "overlay",
  "limit": 50,
  "keyboard-shortcut": [],
  "show-item-context": true,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-text-placeholder": "",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script><script type="module" src="../../site_libs/quarto-ojs/quarto-ojs-runtime.js"></script><link href="../../site_libs/quarto-ojs/quarto-ojs.css" rel="stylesheet">
<meta name="mermaid-theme" content="default">
<script src="../../site_libs/quarto-diagram/mermaid.min.js"></script><script src="../../site_libs/quarto-diagram/mermaid-init.js"></script><link href="../../site_libs/quarto-diagram/mermaid.css" rel="stylesheet">
<script src="https://cdn.jsdelivr.net/npm/requirejs@2.3.6/require.min.js" integrity="sha384-c9c+LnTbwQ3aujuU7ULEPVvgLs+Fn6fJUvIGTsuu1ZcCf11fiEubah0ttpca4ntM sha384-6V1/AdqZRWk1KAlWbKBlGhN7VG4iE/yAZcO6NZPMF8od0vukrvr0tg4qY6NSrItx" crossorigin="anonymous"></script><script type="application/javascript">define('jquery', [],function() {return window.jQuery;})</script><meta name="quarto:status" content="draft">
<script src="https://cdnjs.cloudflare.com/polyfill/v3/polyfill.min.js?features=es6"></script><script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml-full.js" type="text/javascript"></script><script type="text/javascript">
const typesetMath = (el) => {
  if (window.MathJax) {
    // MathJax Typeset
    window.MathJax.typeset([el]);
  } else if (window.katex) {
    // KaTeX Render
    var mathElements = el.getElementsByClassName("math");
    var macros = [];
    for (var i = 0; i < mathElements.length; i++) {
      var texText = mathElements[i].firstChild;
      if (mathElements[i].tagName == "SPAN" && texText && texText.data) {
        window.katex.render(texText.data, mathElements[i], {
          displayMode: mathElements[i].classList.contains('display'),
          throwOnError: false,
          macros: macros,
          fleqn: false
        });
      }
    }
  }
}
window.Quarto = {
  typesetMath
};
</script><link rel="stylesheet" href="../../asset/style.css">
<meta name="twitter:title" content="Martin Laptev">
<meta name="twitter:description" content="Introducing Declock, a timekeeping system that displays time in decimal days using math notation without the need for hours, minutes, or seconds.">
<meta name="twitter:image" content="https://maptv.github.io/asset/daywide.svg">
<meta name="twitter:card" content="summary_large_image">
</head>
<body class="nav-sidebar floating nav-fixed slimcontent quarto-light"><script id="quarto-html-before-body" type="application/javascript">
    const toggleBodyColorMode = (bsSheetEl) => {
      const mode = bsSheetEl.getAttribute("data-mode");
      const bodyEl = window.document.querySelector("body");
      if (mode === "dark") {
        bodyEl.classList.add("quarto-dark");
        bodyEl.classList.remove("quarto-light");
      } else {
        bodyEl.classList.add("quarto-light");
        bodyEl.classList.remove("quarto-dark");
      }
    }
    const toggleBodyColorPrimary = () => {
      const bsSheetEl = window.document.querySelector("link#quarto-bootstrap:not([rel=disabled-stylesheet])");
      if (bsSheetEl) {
        toggleBodyColorMode(bsSheetEl);
      }
    }
    const setColorSchemeToggle = (alternate) => {
      const toggles = window.document.querySelectorAll('.quarto-color-scheme-toggle');
      for (let i=0; i < toggles.length; i++) {
        const toggle = toggles[i];
        if (toggle) {
          if (alternate) {
            toggle.classList.add("alternate");
          } else {
            toggle.classList.remove("alternate");
          }
        }
      }
    };
    const toggleColorMode = (alternate) => {
      // Switch the stylesheets
      const primaryStylesheets = window.document.querySelectorAll('link.quarto-color-scheme:not(.quarto-color-alternate)');
      const alternateStylesheets = window.document.querySelectorAll('link.quarto-color-scheme.quarto-color-alternate');
      manageTransitions('#quarto-margin-sidebar .nav-link', false);
      if (alternate) {
        // note: dark is layered on light, we don't disable primary!
        enableStylesheet(alternateStylesheets);
        for (const sheetNode of alternateStylesheets) {
          if (sheetNode.id === "quarto-bootstrap") {
            toggleBodyColorMode(sheetNode);
          }
        }
      } else {
        disableStylesheet(alternateStylesheets);
        enableStylesheet(primaryStylesheets)
        toggleBodyColorPrimary();
      }
      manageTransitions('#quarto-margin-sidebar .nav-link', true);
      // Switch the toggles
      setColorSchemeToggle(alternate)
      // Hack to workaround the fact that safari doesn't
      // properly recolor the scrollbar when toggling (#1455)
      if (navigator.userAgent.indexOf('Safari') > 0 && navigator.userAgent.indexOf('Chrome') == -1) {
        manageTransitions("body", false);
        window.scrollTo(0, 1);
        setTimeout(() => {
          window.scrollTo(0, 0);
          manageTransitions("body", true);
        }, 40);
      }
    }
    const disableStylesheet = (stylesheets) => {
      for (let i=0; i < stylesheets.length; i++) {
        const stylesheet = stylesheets[i];
        stylesheet.rel = 'disabled-stylesheet';
      }
    }
    const enableStylesheet = (stylesheets) => {
      for (let i=0; i < stylesheets.length; i++) {
        const stylesheet = stylesheets[i];
        if(stylesheet.rel !== 'stylesheet') { // for Chrome, which will still FOUC without this check
          stylesheet.rel = 'stylesheet';
        }
      }
    }
    const manageTransitions = (selector, allowTransitions) => {
      const els = window.document.querySelectorAll(selector);
      for (let i=0; i < els.length; i++) {
        const el = els[i];
        if (allowTransitions) {
          el.classList.remove('notransition');
        } else {
          el.classList.add('notransition');
        }
      }
    }
    const isFileUrl = () => {
      return window.location.protocol === 'file:';
    }
    const hasAlternateSentinel = () => {
      let styleSentinel = getColorSchemeSentinel();
      if (styleSentinel !== null) {
        return styleSentinel === "alternate";
      } else {
        return false;
      }
    }
    const setStyleSentinel = (alternate) => {
      const value = alternate ? "alternate" : "default";
      if (!isFileUrl()) {
        window.localStorage.setItem("quarto-color-scheme", value);
      } else {
        localAlternateSentinel = value;
      }
    }
    const getColorSchemeSentinel = () => {
      if (!isFileUrl()) {
        const storageValue = window.localStorage.getItem("quarto-color-scheme");
        return storageValue != null ? storageValue : localAlternateSentinel;
      } else {
        return localAlternateSentinel;
      }
    }
    const toggleGiscusIfUsed = (isAlternate, darkModeDefault) => {
      const baseTheme = document.querySelector('#giscus-base-theme')?.value ?? 'light';
      const alternateTheme = document.querySelector('#giscus-alt-theme')?.value ?? 'dark';
      let newTheme = '';
      if(authorPrefersDark) {
        newTheme = isAlternate ? baseTheme : alternateTheme;
      } else {
        newTheme = isAlternate ? alternateTheme : baseTheme;
      }
      const changeGiscusTheme = () => {
        // From: https://github.com/giscus/giscus/issues/336
        const sendMessage = (message) => {
          const iframe = document.querySelector('iframe.giscus-frame');
          if (!iframe) return;
          iframe.contentWindow.postMessage({ giscus: message }, 'https://giscus.app');
        }
        sendMessage({
          setConfig: {
            theme: newTheme
          }
        });
      }
      const isGiscussLoaded = window.document.querySelector('iframe.giscus-frame') !== null;
      if (isGiscussLoaded) {
        changeGiscusTheme();
      }
    };
    const authorPrefersDark = false;
    const queryPrefersDark = window.matchMedia('(prefers-color-scheme: dark)');
    const darkModeDefault = queryPrefersDark.matches;
      document.querySelector('link#quarto-text-highlighting-styles.quarto-color-scheme-extra').rel = 'disabled-stylesheet';
      document.querySelector('link#quarto-bootstrap.quarto-color-scheme-extra').rel = 'disabled-stylesheet';
    let localAlternateSentinel = darkModeDefault ? 'alternate' : 'default';
    // Dark / light mode switch
    window.quartoToggleColorScheme = () => {
      // Read the current dark / light value
      let toAlternate = !hasAlternateSentinel();
      toggleColorMode(toAlternate);
      setStyleSentinel(toAlternate);
      toggleGiscusIfUsed(toAlternate, darkModeDefault);
      window.dispatchEvent(new Event('resize'));
    };
    queryPrefersDark.addEventListener("change", e => {
      if(window.localStorage.getItem("quarto-color-scheme") !== null)
        return;
      const alternate = e.matches
      toggleColorMode(alternate);
      localAlternateSentinel = e.matches ? 'alternate' : 'default'; // this is used alongside local storage!
      toggleGiscusIfUsed(alternate, darkModeDefault);
    });
    // Switch to dark mode if need be
    if (hasAlternateSentinel()) {
      toggleColorMode(true);
    } else {
      toggleColorMode(false);
    }
  </script>

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top"><div id="quarto-draft-alert" class="alert alert-warning"><i class="bi bi-pencil-square"></i>Draft</div><nav class="navbar navbar-expand-lg " data-bs-theme="dark"><div class="navbar-container container-fluid">
      <div class="navbar-brand-container mx-auto">
    <a href="../../index.html" class="navbar-brand navbar-brand-logo">
    <img src="../../asset/deidec.svg" alt="Decagon made up of 100 triangles that transitions in a circle of ten swirling teardrops each with a repeat of the larger image at its center." class="navbar-logo light-content"><img src="../../asset/deidec.svg" alt="Decagon made up of 100 triangles that transitions in a circle of ten swirling teardrops each with a repeat of the larger image at its center." class="navbar-logo dark-content"></a>
    <a class="navbar-brand" href="../../index.html">
    <span class="navbar-title">Martin Laptev</span>
    </a>
  </div>
        <div class="quarto-navbar-tools tools-end">
  <a href="" class="quarto-color-scheme-toggle quarto-navigation-tool  px-1" onclick="window.quartoToggleColorScheme(); return false;" title="Toggle dark mode"><i class="bi"></i></a>
  <a href="" class="quarto-reader-toggle quarto-navigation-tool px-1" onclick="window.quartoToggleReader(); return false;" title="Toggle reader mode">
  <div class="quarto-reader-toggle-btn">
  <i class="bi"></i>
  </div>
</a>
</div>
      </div> <!-- /container-fluid -->
    </nav><nav class="quarto-secondary-nav"><div class="container-fluid d-flex">
      <button type="button" class="quarto-btn-toggle btn" data-bs-toggle="collapse" role="button" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
        <i class="bi bi-layout-text-sidebar-reverse"></i>
      </button>
        <h1 class="quarto-secondary-nav-title no-breadcrumbs">Dec Time</h1>
        <a class="flex-grow-1" role="navigation" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">      
        </a>
      <button type="button" class="btn quarto-search-button" aria-label="Search" onclick="window.quartoOpenSearch();">
        <i class="bi bi-search"></i>
      </button>
    </div>
  </nav></header><!-- content --><div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-full page-navbar">
<!-- sidebar -->
  <nav id="quarto-sidebar" class="sidebar collapse collapse-horizontal quarto-sidebar-collapse-item sidebar-navigation floating overflow-auto"><div class="pt-lg-2 mt-2 text-left sidebar-header">
      <a href="../../index.html" class="sidebar-logo-link">
      </a>
      <div class="sidebar-tools-main tools-wide">
    <a href="https://www.github.com/maptv" title="" class="quarto-navigation-tool px-1" aria-label="" target="_blank"><i class="bi bi-github"></i></a>
    <a href="https://www.linkedin.com/in/maptv" title="" class="quarto-navigation-tool px-1" aria-label="" target="_blank"><i class="bi bi-linkedin"></i></a>
    <a href="mailto:maptv@ireni.co" title="" class="quarto-navigation-tool px-1" aria-label=""><i class="bi bi-envelope-at"></i></a>
    <div id="quarto-search" class="quarto-navigation-tool px-1" title="Search"></div>
</div>
      </div>
    <div class="sidebar-menu-container"> 
    <ul class="list-unstyled mt-1">
<li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../index.html" class="sidebar-item-text sidebar-link"><i class="bi bi-house-door" role="img">
</i> 
 <span class="menu-text">Home</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../about/index.html" class="sidebar-item-text sidebar-link"><i class="bi bi-info-circle" role="img">
</i> 
 <span class="menu-text">About</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../cv/index.html" class="sidebar-item-text sidebar-link"><i class="bi bi-file-earmark-person" role="img">
</i> 
 <span class="menu-text">CV/Résumé</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../list/index.html" class="sidebar-item-text sidebar-link"><i class="bi bi-grid-3x3-gap" role="img">
</i> 
 <span class="menu-text">Article List</span></a>
  </div>
</li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a href="../../dec/index.html" class="sidebar-item-text sidebar-link"><i class="bi bi-arrow-repeat" role="img">
</i> 
 <span class="menu-text">Dec</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-1" role="navigation" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-1" class="collapse list-unstyled sidebar-section depth1 show">
<li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../dec/date/index.html" class="sidebar-item-text sidebar-link"><i class="bi bi-calendar-date" role="img">
</i> 
 <span class="menu-text">Date</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../dec/time/index.html" class="sidebar-item-text sidebar-link active"><i class="bi bi-clock" role="img">
</i> 
 <span class="menu-text">Time</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../dec/snap/index.html" class="sidebar-item-text sidebar-link"><i class="bi bi-postage" role="img">
</i> 
 <span class="menu-text">Snap</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../dec/span/index.html" class="sidebar-item-text sidebar-link"><i class="bi bi-calendar-range" role="img">
</i> 
 <span class="menu-text">Span</span></a>
  </div>
</li>
      </ul>
</li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-2" role="navigation" aria-expanded="false"><i class="bi bi-hourglass-split" role="img">
</i> 
 <span class="menu-text">History</span></a>
          <a class="sidebar-item-toggle text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-2" role="navigation" aria-expanded="false" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-2" class="collapse list-unstyled sidebar-section depth1 ">
<li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../history/ww2/index.html" class="sidebar-item-text sidebar-link"><i class="bi bi-2-square" role="img">
</i> 
 <span class="menu-text">World War 2</span></a>
  </div>
</li>
      </ul>
</li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-3" role="navigation" aria-expanded="false"><i class="bi bi-robot" role="img">
</i> 
 <span class="menu-text">Machine Learning</span></a>
          <a class="sidebar-item-toggle text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-3" role="navigation" aria-expanded="false" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-3" class="collapse list-unstyled sidebar-section depth1 ">
<li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../ml/prob/index.html" class="sidebar-item-text sidebar-link"><i class="bi bi-dice-5" role="img">
</i> 
 <span class="menu-text">Probablity</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../ml/llm/index.html" class="sidebar-item-text sidebar-link"><i class="bi bi-translate" role="img">
</i> 
 <span class="menu-text">Language Models</span></a>
  </div>
</li>
      </ul>
</li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-4" role="navigation" aria-expanded="false"><i class="bi bi-laptop" role="img">
</i> 
 <span class="menu-text">Software</span></a>
          <a class="sidebar-item-toggle text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-4" role="navigation" aria-expanded="false" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-4" class="collapse list-unstyled sidebar-section depth1 ">
<li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../git/index.html" class="sidebar-item-text sidebar-link"><i class="bi bi-git" role="img">
</i> 
 <span class="menu-text">Git</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../jupyter/index.html" class="sidebar-item-text sidebar-link"><i class="bi bi-journal-richtext" role="img">
</i> 
 <span class="menu-text">Jupyter</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../observable/index.html" class="sidebar-item-text sidebar-link"><i class="bi bi-0-circle" role="img">
</i> 
 <span class="menu-text">Observable</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../positron/index.html" class="sidebar-item-text sidebar-link"><i class="bi bi-p-square" role="img">
</i> 
 <span class="menu-text">Positron</span></a>
  </div>
</li>
          <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a href="../../quarto/index.html" class="sidebar-item-text sidebar-link"><i class="bi bi-markdown" role="img">
</i> 
 <span class="menu-text">Quarto</span></a>
          <a class="sidebar-item-toggle text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-5" role="navigation" aria-expanded="false" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-5" class="collapse list-unstyled sidebar-section depth2 ">
<li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../quarto/filter/index.html" class="sidebar-item-text sidebar-link"><i class="bi bi-funnel" role="img">
</i> 
 <span class="menu-text">Filter</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../quarto/include/index.html" class="sidebar-item-text sidebar-link"><i class="bi bi-file-earmark-plus" role="img">
</i> 
 <span class="menu-text">Include</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../quarto/script/index.html" class="sidebar-item-text sidebar-link"><i class="bi bi-file-code" role="img">
</i> 
 <span class="menu-text">Script</span></a>
  </div>
</li>
      </ul>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../reveal/index.html" class="sidebar-item-text sidebar-link"><i class="bi bi-file-slides" role="img">
</i> 
 <span class="menu-text">Reveal</span></a>
  </div>
</li>
      </ul>
</li>
    </ul>
</div>
</nav><div id="quarto-sidebar-glass" class="quarto-sidebar-collapse-item" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item"></div>
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active"><h2 id="toc-title">On this page</h2>
   
  <ul>
<li><a href="#bcc" id="toc-bcc" class="nav-link active" data-scroll-target="#bcc">Bar chart clocks</a></li>
  <li><a href="#llm" id="toc-llm" class="nav-link" data-scroll-target="#llm">Longitude latitude map</a></li>
  <li><a href="#dac" id="toc-dac" class="nav-link" data-scroll-target="#dac">Daylight area chart</a></li>
  <li><a href="#yda" id="toc-yda" class="nav-link" data-scroll-target="#yda">Yearly day aggregate (yda)</a></li>
  <li><a href="#eda" id="toc-eda" class="nav-link" data-scroll-target="#eda">Epochal day aggregate (eda)</a></li>
  <li><a href="#ute" id="toc-ute" class="nav-link" data-scroll-target="#ute">UNIX time equation</a></li>
  <li><a href="#jte" id="toc-jte" class="nav-link" data-scroll-target="#jte">Julian time equation</a></li>
  <li><a href="#hms" id="toc-hms" class="nav-link" data-scroll-target="#hms">Hour minute second</a></li>
  <li><a href="#uto" id="toc-uto" class="nav-link" data-scroll-target="#uto">Universal time offset</a></li>
  <li><a href="#rod" id="toc-rod" class="nav-link" data-scroll-target="#rod">Rounded offset decimal</a></li>
  <li>
<a href="#tzo" id="toc-tzo" class="nav-link" data-scroll-target="#tzo">Time zone offset</a>
  <ul>
<li><a href="#utc" id="toc-utc" class="nav-link" data-scroll-target="#utc">Coordinated Universal Time (UTC)</a></li>
  <li><a href="#dow" id="toc-dow" class="nav-link" data-scroll-target="#dow">Day of week</a></li>
  <li><a href="#lao" id="toc-lao" class="nav-link" data-scroll-target="#lao">Longitude and offsets</a></li>
  <li><a href="#eot" id="toc-eot" class="nav-link" data-scroll-target="#eot">Equation of time</a></li>
  <li><a href="#cac" id="toc-cac" class="nav-link" data-scroll-target="#cac">Cambridge and Cambridge</a></li>
  <li><a href="#sda" id="toc-sda" class="nav-link" data-scroll-target="#sda">Solar declination angle</a></li>
  <li><a href="#sas" id="toc-sas" class="nav-link" data-scroll-target="#sas">Sunrise and sunset</a></li>
  <li><a href="#sha" id="toc-sha" class="nav-link" data-scroll-target="#sha">Solar hour angle</a></li>
  </ul>
</li>
  <li><a href="#next" id="toc-next" class="nav-link" data-scroll-target="#next">Next</a></li>
  <li><a href="#cite" id="toc-cite" class="nav-link" data-scroll-target="#cite">Cite</a></li>
  </ul><div class="toc-actions"><ul><li><a href="https://github.com/maptv/maptv.github.io/blob/main/dec/time/index.qmd" class="toc-action"><i class="bi bi-github"></i>View source</a></li></ul></div><div class="quarto-alternate-formats"><h2>Other Formats</h2><ul><li><a href="index.qmd"><i class="bi bi-file-code"></i>Quarto markdown (qmd)</a></li><li><a href="index.md"><i class="bi bi-file-code"></i>CommonMark markdown (md)</a></li><li><a href="eot.ipynb"><i class="bi bi-file-code"></i>Python notebook (ipynb)</a></li></ul></div></nav>
    </div>
<!-- main -->
<main class="content page-columns page-full column-body" id="quarto-document-content"><header id="title-block-header" class="quarto-title-block default"><div class="quarto-title">
<div class="quarto-title-block"><div><h1 class="title d-none d-lg-block">Dec Time</h1><button type="button" class="btn code-tools-button" id="quarto-code-tools-source"><i class="bi"></i> Code</button></div></div>
</div>

<div>
  <div class="description">
    <p>Introducing Declock, a timekeeping system that displays time in decimal days using math notation without the need for hours, minutes, or seconds.</p>
  </div>
</div>


<div class="quarto-title-meta column-body">

    <div>
    <div class="quarto-title-meta-heading">Author</div>
    <div class="quarto-title-meta-contents">
             <p><a href="https://maptv.github.io">Martin Laptev</a> </p>
          </div>
  </div>
    
    <div>
    <div class="quarto-title-meta-heading">Published</div>
    <div class="quarto-title-meta-contents">
      <p class="date">2025+216</p>
    </div>
  </div>
  
    
  </div>
  


</header><div id="timenav">
<div class="cell" data-layout-align="default">
<div class="cell-output-display">
<div>
<p></p><figure class="figure"></figure><p></p>
<div>
<pre class="mermaid mermaid-js">%%{init: {'theme': 'default', 'themeVariables': { 'fontSize': '32px'}}}%%
flowchart LR
   A[Dec]--&gt;B[date]--&gt;C[time]--&gt;D[snap]--&gt;E[span]
   click A "/dec"
   click B "/dec/date"
   click C "/dec/time"
   click D "/dec/snap"
   click E "/dec/span"
</pre>
</div>
<p></p>
</div>
</div>
</div>
</div>
<p>My website provides many examples of the <a href="https://quarto.org">Quarto</a> publishing and the <a href="../../dec">Dec</a> measurement systems in action. I leverage Quarto support for the <a href="https://observablehq.com/">Observable</a> data analysis and visualization system to create animated and interactive graphics like the <a href="https://en.wikipedia.org/wiki/Bar_chart">bar📊charts</a> clocks🕓, <a href="https://en.wikipedia.org/wiki/Terminator_%28solar%29#:~:text=a%20moving%20line%20that%20divides%20the%20daylit%20side%20and%20the%20dark%20night%20side%20of%20a%20planetary%20body">solar☀️terminator</a> map🗺, <a href="https://en.wikipedia.org/wiki/Earth%27s_orbit">Earth🌍orbit</a> diagram, and <a href="https://en.wikipedia.org/wiki/Daylight#:~:text=the%20combination%20of%20all%20direct%20and%20indirect%20sunlight%20during%20the%20daytime">daylight</a> <a href="https://en.wikipedia.org/wiki/Area_chart#:~:text=The%20area%20between%20axis%20and%20line%20are%20commonly%20emphasized%20with%20colors">area chart</a> below.</p>
<p>Dec times are measured in <a href="https://en.wikipedia.org/wiki/Decimal_time#Fractional_days:~:text=a%20decimal%20fraction%20of%20a%20day">fractional days</a>, often using <a href="https://en.wikipedia.org/wiki/Metric_prefix#:~:text=a%20unit%20prefix%20that%20precedes%20a%20basic%20unit%20of%20measure%20to%20indicate%20a%20multiple%20or%20submultiple%20of%20the%20unit">metric prefixes</a> like <a href="https://en.wikipedia.org/wiki/Deci-#:~:text=a%20decimal%20unit%20prefix%20in%20the%20metric%20system%20denoting%20a%20factor%20of%20one%20tenth">deci</a>, <a href="https://en.wikipedia.org/wiki/Centi-#:~:text=a%20unit%20prefix%20in%20the%20metric%20system%20denoting%20a%20factor%20of%20one%20hundredth">centi</a>, or <a href="https://en.wikipedia.org/wiki/Milli-#:~:text=a%20unit%20prefix%20in%20the%20metric%20system%20denoting%20a%20factor%20of%20one%20thousandth">milli</a>. The top, middle, and bottom bars📊indicate the <a href="https://en.wikipedia.org/wiki/Decimal_time#:~:text=dividing%20the%20day%20into%2010%20decidays" class="tool" data-bs-toggle="tooltip" data-bs-title="tenths of a day">decidays</a>, <a href="https://en.wikipedia.org/wiki/Unit_of_time#:~:text=1.44%20minutes%2C%20or%2086.4%20seconds" class="tool" data-bs-toggle="tooltip" data-bs-title="thousandths of a day">millidays</a>, and <a href="https://en.wikipedia.org/wiki/Decimal_time#:~:text=which%20would%20be-,1/100%2C000%20day,-%2C%20or%20864%20milliseconds" class="tool" data-bs-toggle="tooltip" data-bs-title="hundred thousandths of a day">centimillidays</a>, respectively, of the time since the start, <span class="point1"><span>+<span id="ojs-element-id-1"></span></span></span>, or until the end, <span class="point0"><span>-<span id="ojs-element-id-2"></span></span></span>, of the day in the Dec <a href="https://en.wikipedia.org/wiki/Time_zone#:~:text=an%20area%20which%20observes%20a%20uniform%20standard%20time">time zone</a>, <span><span id="ojs-element-id-3"></span>,</span> at the location of the red⭕️circle on the map🗺️beneath the bars📊.</p>
<p>To rotate the globe🌐in the Earth🌏orbit diagram, drag the red⭕️circle horizontally↔︎️or slide the red🔴dot on the daylight area chart vertically↕. The red⭕️circle’s vertical↕position determines the yearly daylight pattern visualized by the area chart. Shift the red<font color="red">—</font>line on the area chart horizontally↔︎️to move the globe🌐along the ellipse of the Earth🌎orbit.</p>
<div id="toggles" class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code hidden" id="cb1" data-startfrom="61" data-source-offset="-0"><pre class="sourceCode js code-with-copy"><code class="sourceCode javascript" style="counter-reset: source-line 60;"><span id="cb1-61"><a href="#cb1-61" aria-hidden="true" tabindex="-1"></a>viewof bordertoggle <span class="op">=</span> <span class="fu">labelToggle</span>(Inputs<span class="op">.</span><span class="at">toggle</span><span class="op">,</span> <span class="st">"Border"</span><span class="op">,</span> <span class="kw">false</span><span class="op">,</span> <span class="st">"bordertoggle"</span>)</span>
<span id="cb1-62"><a href="#cb1-62" aria-hidden="true" tabindex="-1"></a>viewof gridtoggle <span class="op">=</span> <span class="fu">labelToggle</span>(Inputs<span class="op">.</span><span class="at">toggle</span><span class="op">,</span> <span class="st">"Grid"</span><span class="op">,</span> <span class="kw">false</span><span class="op">,</span> <span class="st">"gridtoggle"</span>)</span>
<span id="cb1-63"><a href="#cb1-63" aria-hidden="true" tabindex="-1"></a>viewof utctoggle <span class="op">=</span> <span class="fu">labelToggle</span>(Inputs<span class="op">.</span><span class="at">toggle</span><span class="op">,</span> <span class="st">"UTC"</span><span class="op">,</span> <span class="kw">false</span><span class="op">,</span> <span class="st">"utctoggle"</span>)</span>
<span id="cb1-64"><a href="#cb1-64" aria-hidden="true" tabindex="-1"></a>viewof suntoggle <span class="op">=</span> <span class="fu">labelToggle</span>(Inputs<span class="op">.</span><span class="at">toggle</span><span class="op">,</span> <span class="st">"Sun"</span><span class="op">,</span> <span class="kw">false</span><span class="op">,</span> <span class="st">"suntoggle"</span>)</span>
<span id="cb1-65"><a href="#cb1-65" aria-hidden="true" tabindex="-1"></a>rstbtn<span class="op">.</span><span class="fu">node</span>()<span class="op">;</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-display">
<div id="toggles-1">
<div id="ojs-cell-1-1" data-nodetype="declaration">

</div>
</div>
</div>
<div class="cell-output cell-output-display">
<div id="toggles-2">
<div id="ojs-cell-1-2" data-nodetype="declaration">

</div>
</div>
</div>
<div class="cell-output cell-output-display">
<div id="toggles-3">
<div id="ojs-cell-1-3" data-nodetype="declaration">

</div>
</div>
</div>
<div class="cell-output cell-output-display">
<div id="toggles-4">
<div id="ojs-cell-1-4" data-nodetype="declaration">

</div>
</div>
</div>
<div class="cell-output cell-output-display">
<div id="toggles-5">
<div id="ojs-cell-1-5" data-nodetype="expression">

</div>
</div>
</div>
</div>
<section id="bcc" class="level5 hiddenheading page-columns page-full"><h5 class="hiddenheading anchored" data-anchor-id="bcc">Bar chart clocks</h5>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code hidden" id="cb2" data-startfrom="73" data-source-offset="-51"><pre class="sourceCode js code-with-copy"><code class="sourceCode javascript" style="counter-reset: source-line 72;"><span id="cb2-73"><a href="#cb2-73" aria-hidden="true" tabindex="-1"></a>barChart <span class="op">=</span> {</span>
<span id="cb2-74"><a href="#cb2-74" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> W <span class="op">=</span> <span class="dv">800</span><span class="op">;</span></span>
<span id="cb2-75"><a href="#cb2-75" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> H <span class="op">=</span> <span class="dv">88</span><span class="op">;</span></span>
<span id="cb2-76"><a href="#cb2-76" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> barX <span class="op">=</span> <span class="dv">1</span><span class="op">;</span></span>
<span id="cb2-77"><a href="#cb2-77" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> firstBarY <span class="op">=</span> <span class="dv">1</span><span class="op">;</span></span>
<span id="cb2-78"><a href="#cb2-78" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> svg <span class="op">=</span> d3</span>
<span id="cb2-79"><a href="#cb2-79" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">create</span>(<span class="st">"svg"</span>)</span>
<span id="cb2-80"><a href="#cb2-80" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">"width"</span><span class="op">,</span> W)</span>
<span id="cb2-81"><a href="#cb2-81" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">"viewBox"</span><span class="op">,</span> [<span class="dv">0</span><span class="op">,</span> <span class="dv">0</span><span class="op">,</span> W <span class="op">/</span> <span class="fl">1.14</span><span class="op">,</span> H])<span class="op">;</span></span>
<span id="cb2-82"><a href="#cb2-82" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> xRange <span class="op">=</span> [<span class="dv">0</span><span class="op">,</span> W <span class="op">-</span> <span class="dv">100</span>]<span class="op">;</span></span>
<span id="cb2-83"><a href="#cb2-83" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> scaleDD <span class="op">=</span> d3<span class="op">.</span><span class="fu">scaleLinear</span>()</span>
<span id="cb2-84"><a href="#cb2-84" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">domain</span>([<span class="dv">0</span><span class="op">,</span> <span class="dv">10</span>])</span>
<span id="cb2-85"><a href="#cb2-85" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">range</span>(xRange)<span class="op">;</span></span>
<span id="cb2-86"><a href="#cb2-86" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> scaleMandB <span class="op">=</span> d3<span class="op">.</span><span class="fu">scaleLinear</span>()</span>
<span id="cb2-87"><a href="#cb2-87" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">domain</span>([<span class="dv">0</span><span class="op">,</span> <span class="dv">100</span>])</span>
<span id="cb2-88"><a href="#cb2-88" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">range</span>(xRange)<span class="op">;</span></span>
<span id="cb2-89"><a href="#cb2-89" aria-hidden="true" tabindex="-1"></a>  <span class="co">// Background bars to show where 100% lies</span></span>
<span id="cb2-90"><a href="#cb2-90" aria-hidden="true" tabindex="-1"></a>  svg<span class="op">.</span><span class="fu">selectAll</span>(<span class="st">'.background'</span>)</span>
<span id="cb2-91"><a href="#cb2-91" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">data</span>([</span>
<span id="cb2-92"><a href="#cb2-92" aria-hidden="true" tabindex="-1"></a>      <span class="st">'dd'</span><span class="op">,</span> <span class="st">"mils"</span><span class="op">,</span> <span class="st">'beats'</span>])</span>
<span id="cb2-93"><a href="#cb2-93" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">enter</span>()</span>
<span id="cb2-94"><a href="#cb2-94" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">append</span>(<span class="st">'rect'</span>)</span>
<span id="cb2-95"><a href="#cb2-95" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">'class'</span><span class="op">,</span> <span class="st">'background timeBar'</span>)</span>
<span id="cb2-96"><a href="#cb2-96" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">'width'</span><span class="op">,</span> W<span class="op">-</span><span class="dv">100</span>)</span>
<span id="cb2-97"><a href="#cb2-97" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">'y'</span><span class="op">,</span> (d<span class="op">,</span>i)<span class="kw">=&gt;</span>i<span class="op">*</span><span class="dv">30</span><span class="op">+</span>firstBarY)</span>
<span id="cb2-98"><a href="#cb2-98" aria-hidden="true" tabindex="-1"></a>  <span class="co">// Beats</span></span>
<span id="cb2-99"><a href="#cb2-99" aria-hidden="true" tabindex="-1"></a>  svg</span>
<span id="cb2-100"><a href="#cb2-100" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">append</span>(<span class="st">'rect'</span>)</span>
<span id="cb2-101"><a href="#cb2-101" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">'class'</span><span class="op">,</span> <span class="st">'timeBar'</span>)</span>
<span id="cb2-102"><a href="#cb2-102" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">'y'</span><span class="op">,</span> firstBarY<span class="op">+</span><span class="dv">60</span>)</span>
<span id="cb2-103"><a href="#cb2-103" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">'width'</span><span class="op">,</span> d <span class="kw">=&gt;</span> <span class="fu">scaleMandB</span>(<span class="bu">Number</span>(barBeats)))</span>
<span id="cb2-104"><a href="#cb2-104" aria-hidden="true" tabindex="-1"></a>  svg</span>
<span id="cb2-105"><a href="#cb2-105" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">append</span>(<span class="st">'rect'</span>)</span>
<span id="cb2-106"><a href="#cb2-106" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">'class'</span><span class="op">,</span> <span class="st">'timeBarFull'</span>)</span>
<span id="cb2-107"><a href="#cb2-107" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">'y'</span><span class="op">,</span> firstBarY<span class="op">+</span><span class="dv">60</span>)</span>
<span id="cb2-108"><a href="#cb2-108" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">'width'</span><span class="op">,</span> d <span class="kw">=&gt;</span> <span class="fu">scaleMandB</span>(barBeats))</span>
<span id="cb2-109"><a href="#cb2-109" aria-hidden="true" tabindex="-1"></a>  <span class="co">// Cents/Mils</span></span>
<span id="cb2-110"><a href="#cb2-110" aria-hidden="true" tabindex="-1"></a>  svg</span>
<span id="cb2-111"><a href="#cb2-111" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">append</span>(<span class="st">'rect'</span>)</span>
<span id="cb2-112"><a href="#cb2-112" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">'class'</span><span class="op">,</span> <span class="st">'timeBar'</span>)</span>
<span id="cb2-113"><a href="#cb2-113" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">'y'</span><span class="op">,</span> firstBarY)</span>
<span id="cb2-114"><a href="#cb2-114" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">'width'</span><span class="op">,</span> d <span class="kw">=&gt;</span> <span class="fu">scaleDD</span>(<span class="bu">Number</span>(barDD)<span class="op">+</span><span class="bu">Number</span>(barMils)<span class="op">/</span><span class="dv">100</span><span class="op">+</span><span class="bu">Number</span>(barBeats)<span class="op">/</span><span class="dv">10000</span>))</span>
<span id="cb2-115"><a href="#cb2-115" aria-hidden="true" tabindex="-1"></a>  svg</span>
<span id="cb2-116"><a href="#cb2-116" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">append</span>(<span class="st">'rect'</span>)</span>
<span id="cb2-117"><a href="#cb2-117" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">'class'</span><span class="op">,</span> <span class="st">'timeBarFull'</span>)</span>
<span id="cb2-118"><a href="#cb2-118" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">'y'</span><span class="op">,</span> firstBarY)</span>
<span id="cb2-119"><a href="#cb2-119" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">'width'</span><span class="op">,</span> d <span class="kw">=&gt;</span> <span class="fu">scaleDD</span>(barDD))</span>
<span id="cb2-120"><a href="#cb2-120" aria-hidden="true" tabindex="-1"></a>  svg</span>
<span id="cb2-121"><a href="#cb2-121" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">append</span>(<span class="st">'rect'</span>)</span>
<span id="cb2-122"><a href="#cb2-122" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">'class'</span><span class="op">,</span> <span class="st">'timeBar'</span>)</span>
<span id="cb2-123"><a href="#cb2-123" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">'y'</span><span class="op">,</span> firstBarY<span class="op">+</span><span class="dv">30</span>)</span>
<span id="cb2-124"><a href="#cb2-124" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">'width'</span><span class="op">,</span> d <span class="kw">=&gt;</span> <span class="fu">scaleMandB</span>(<span class="bu">Number</span>(barMils)<span class="op">+</span><span class="bu">Number</span>(barBeats)<span class="op">/</span><span class="dv">100</span>))</span>
<span id="cb2-125"><a href="#cb2-125" aria-hidden="true" tabindex="-1"></a>  svg</span>
<span id="cb2-126"><a href="#cb2-126" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">append</span>(<span class="st">'rect'</span>)</span>
<span id="cb2-127"><a href="#cb2-127" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">'class'</span><span class="op">,</span> <span class="st">'timeBarFull'</span>)</span>
<span id="cb2-128"><a href="#cb2-128" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">'y'</span><span class="op">,</span> firstBarY<span class="op">+</span><span class="dv">30</span>)</span>
<span id="cb2-129"><a href="#cb2-129" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">'width'</span><span class="op">,</span> d <span class="kw">=&gt;</span> <span class="fu">scaleMandB</span>(barMils))</span>
<span id="cb2-130"><a href="#cb2-130" aria-hidden="true" tabindex="-1"></a>  <span class="co">// Cent ticks</span></span>
<span id="cb2-131"><a href="#cb2-131" aria-hidden="true" tabindex="-1"></a>  svg<span class="op">.</span><span class="fu">selectAll</span>(<span class="st">'.tickC'</span>)</span>
<span id="cb2-132"><a href="#cb2-132" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">data</span>(d3<span class="op">.</span><span class="fu">range</span>(width <span class="op">&gt;</span> <span class="dv">500</span> <span class="op">?</span> <span class="dv">10</span> <span class="op">:</span> <span class="dv">10</span><span class="op">,</span> <span class="dv">100</span>))</span>
<span id="cb2-133"><a href="#cb2-133" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">enter</span>()</span>
<span id="cb2-134"><a href="#cb2-134" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">append</span>(<span class="st">'rect'</span>)</span>
<span id="cb2-135"><a href="#cb2-135" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">'class'</span><span class="op">,</span> <span class="st">'tickC'</span>)</span>
<span id="cb2-136"><a href="#cb2-136" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">'x'</span><span class="op">,</span> d<span class="kw">=&gt;</span><span class="fu">scaleDD</span>(d<span class="op">/</span><span class="dv">10</span>)<span class="op">+</span>barX)</span>
<span id="cb2-137"><a href="#cb2-137" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">'y'</span><span class="op">,</span> firstBarY<span class="op">+</span><span class="dv">30</span>)</span>
<span id="cb2-138"><a href="#cb2-138" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">'height'</span><span class="op">,</span> d<span class="kw">=&gt;</span>d<span class="op">%</span><span class="dv">2</span><span class="op">===</span><span class="dv">0</span><span class="op">?</span> <span class="dv">8</span><span class="op">:</span><span class="dv">5</span>)</span>
<span id="cb2-139"><a href="#cb2-139" aria-hidden="true" tabindex="-1"></a>  svg<span class="op">.</span><span class="fu">selectAll</span>(<span class="st">'.tickB1'</span>)</span>
<span id="cb2-140"><a href="#cb2-140" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">data</span>(d3<span class="op">.</span><span class="fu">range</span>(width <span class="op">&gt;</span> <span class="dv">500</span> <span class="op">?</span> <span class="dv">10</span> <span class="op">:</span> <span class="dv">10</span><span class="op">,</span> <span class="dv">100</span>))</span>
<span id="cb2-141"><a href="#cb2-141" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">enter</span>()</span>
<span id="cb2-142"><a href="#cb2-142" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">append</span>(<span class="st">'rect'</span>)</span>
<span id="cb2-143"><a href="#cb2-143" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">'class'</span><span class="op">,</span> <span class="st">'tickB1'</span>)</span>
<span id="cb2-144"><a href="#cb2-144" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">'x'</span><span class="op">,</span> d<span class="kw">=&gt;</span><span class="fu">scaleDD</span>(d<span class="op">/</span><span class="dv">10</span>)<span class="op">+</span>barX)</span>
<span id="cb2-145"><a href="#cb2-145" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">'y'</span><span class="op">,</span> d<span class="kw">=&gt;</span>d<span class="op">%</span><span class="dv">2</span><span class="op">===</span><span class="dv">0</span><span class="op">?</span> firstBarY<span class="op">+</span><span class="dv">77</span><span class="op">:</span>firstBarY<span class="op">+</span><span class="dv">80</span>)</span>
<span id="cb2-146"><a href="#cb2-146" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">'height'</span><span class="op">,</span> d<span class="kw">=&gt;</span>d<span class="op">%</span><span class="dv">2</span><span class="op">===</span><span class="dv">0</span><span class="op">?</span> <span class="dv">8</span><span class="op">:</span><span class="dv">5</span>)</span>
<span id="cb2-147"><a href="#cb2-147" aria-hidden="true" tabindex="-1"></a>  svg<span class="op">.</span><span class="fu">selectAll</span>(<span class="st">'.tickC1'</span>)</span>
<span id="cb2-148"><a href="#cb2-148" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">data</span>(d3<span class="op">.</span><span class="fu">range</span>(width <span class="op">&gt;</span> <span class="dv">500</span> <span class="op">?</span> <span class="dv">10</span> <span class="op">:</span> <span class="dv">10</span><span class="op">,</span> <span class="dv">100</span>))</span>
<span id="cb2-149"><a href="#cb2-149" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">enter</span>()</span>
<span id="cb2-150"><a href="#cb2-150" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">append</span>(<span class="st">'rect'</span>)</span>
<span id="cb2-151"><a href="#cb2-151" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">'class'</span><span class="op">,</span> <span class="st">'tickC1'</span>)</span>
<span id="cb2-152"><a href="#cb2-152" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">'x'</span><span class="op">,</span> d<span class="kw">=&gt;</span><span class="fu">scaleDD</span>(d<span class="op">/</span><span class="dv">10</span>)<span class="op">+</span>barX)</span>
<span id="cb2-153"><a href="#cb2-153" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">'y'</span><span class="op">,</span> d<span class="kw">=&gt;</span>d<span class="op">%</span><span class="dv">2</span><span class="op">===</span><span class="dv">0</span><span class="op">?</span> firstBarY<span class="op">+</span><span class="dv">47</span><span class="op">:</span>firstBarY<span class="op">+</span><span class="dv">50</span>)</span>
<span id="cb2-154"><a href="#cb2-154" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">'height'</span><span class="op">,</span> d<span class="kw">=&gt;</span>d<span class="op">%</span><span class="dv">2</span><span class="op">===</span><span class="dv">0</span><span class="op">?</span> <span class="dv">8</span><span class="op">:</span><span class="dv">5</span>)</span>
<span id="cb2-155"><a href="#cb2-155" aria-hidden="true" tabindex="-1"></a>  <span class="co">// Mil ticks</span></span>
<span id="cb2-156"><a href="#cb2-156" aria-hidden="true" tabindex="-1"></a>  svg<span class="op">.</span><span class="fu">selectAll</span>(<span class="st">'.tickM'</span>)</span>
<span id="cb2-157"><a href="#cb2-157" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">data</span>(d3<span class="op">.</span><span class="fu">range</span>(width <span class="op">&gt;</span> <span class="dv">500</span> <span class="op">?</span> <span class="dv">1</span> <span class="op">:</span> <span class="dv">1</span><span class="op">,</span> <span class="dv">10</span>))</span>
<span id="cb2-158"><a href="#cb2-158" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">enter</span>()</span>
<span id="cb2-159"><a href="#cb2-159" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">append</span>(<span class="st">'rect'</span>)</span>
<span id="cb2-160"><a href="#cb2-160" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">'class'</span><span class="op">,</span> <span class="st">'tickM'</span>)</span>
<span id="cb2-161"><a href="#cb2-161" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">'x'</span><span class="op">,</span> d<span class="kw">=&gt;</span><span class="fu">scaleDD</span>(d)<span class="op">+</span>barX)</span>
<span id="cb2-162"><a href="#cb2-162" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">'y'</span><span class="op">,</span> firstBarY<span class="op">+</span><span class="dv">20</span>)</span>
<span id="cb2-163"><a href="#cb2-163" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">'height'</span><span class="op">,</span> <span class="dv">6</span>)</span>
<span id="cb2-164"><a href="#cb2-164" aria-hidden="true" tabindex="-1"></a>  svg<span class="op">.</span><span class="fu">selectAll</span>(<span class="st">'.tickLabel1'</span>)</span>
<span id="cb2-165"><a href="#cb2-165" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">data</span>(d3<span class="op">.</span><span class="fu">range</span>(width <span class="op">&gt;</span> <span class="dv">500</span> <span class="op">?</span> <span class="dv">1</span> <span class="op">:</span> <span class="dv">1</span><span class="op">,</span> <span class="dv">10</span>))</span>
<span id="cb2-166"><a href="#cb2-166" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">enter</span>()</span>
<span id="cb2-167"><a href="#cb2-167" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">append</span>(<span class="st">'text'</span>)</span>
<span id="cb2-168"><a href="#cb2-168" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">'class'</span><span class="op">,</span> <span class="st">'tickLabel1'</span>)</span>
<span id="cb2-169"><a href="#cb2-169" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">'x'</span><span class="op">,</span> d<span class="kw">=&gt;</span><span class="fu">scaleDD</span>(d)<span class="op">+</span>barX<span class="op">+.</span><span class="dv">5</span>)</span>
<span id="cb2-170"><a href="#cb2-170" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">'y'</span><span class="op">,</span> firstBarY<span class="op">+</span><span class="dv">18</span>)</span>
<span id="cb2-171"><a href="#cb2-171" aria-hidden="true" tabindex="-1"></a>    <span class="co">//.style("font-size", `{W &lt; 550 ? 12 : W &lt; 650 ? 14 : W &lt; 750 ? 16 : W &lt; 850 ? 18 : 20}px`)</span></span>
<span id="cb2-172"><a href="#cb2-172" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">text</span>(d<span class="kw">=&gt;</span>d)</span>
<span id="cb2-173"><a href="#cb2-173" aria-hidden="true" tabindex="-1"></a>  <span class="co">// Cent ticks</span></span>
<span id="cb2-174"><a href="#cb2-174" aria-hidden="true" tabindex="-1"></a>  svg<span class="op">.</span><span class="fu">selectAll</span>(<span class="st">'.tickC2'</span>)</span>
<span id="cb2-175"><a href="#cb2-175" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">data</span>(d3<span class="op">.</span><span class="fu">range</span>(width <span class="op">&gt;</span> <span class="dv">500</span> <span class="op">?</span> <span class="dv">10</span> <span class="op">:</span> <span class="dv">10</span><span class="op">,</span> <span class="dv">100</span>))</span>
<span id="cb2-176"><a href="#cb2-176" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">enter</span>()</span>
<span id="cb2-177"><a href="#cb2-177" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">append</span>(<span class="st">'rect'</span>)</span>
<span id="cb2-178"><a href="#cb2-178" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">'class'</span><span class="op">,</span> <span class="st">'tickC2'</span>)</span>
<span id="cb2-179"><a href="#cb2-179" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">'x'</span><span class="op">,</span> d<span class="kw">=&gt;</span><span class="fu">scaleDD</span>(d<span class="op">/</span><span class="dv">10</span>)<span class="op">+</span>barX)</span>
<span id="cb2-180"><a href="#cb2-180" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">'y'</span><span class="op">,</span> firstBarY<span class="op">+</span><span class="dv">10</span>)</span>
<span id="cb2-181"><a href="#cb2-181" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">'height'</span><span class="op">,</span> d<span class="kw">=&gt;</span>d<span class="op">%</span><span class="dv">2</span><span class="op">===</span><span class="dv">0</span><span class="op">?</span> <span class="dv">9</span><span class="op">:</span><span class="dv">6</span>)</span>
<span id="cb2-182"><a href="#cb2-182" aria-hidden="true" tabindex="-1"></a>  <span class="co">// Beat ticks</span></span>
<span id="cb2-183"><a href="#cb2-183" aria-hidden="true" tabindex="-1"></a>  svg<span class="op">.</span><span class="fu">selectAll</span>(<span class="st">'.tickB'</span>)</span>
<span id="cb2-184"><a href="#cb2-184" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">data</span>(d3<span class="op">.</span><span class="fu">range</span>(width <span class="op">&gt;</span> <span class="dv">500</span> <span class="op">?</span> <span class="dv">10</span> <span class="op">:</span> <span class="dv">10</span><span class="op">,</span> <span class="dv">100</span>))</span>
<span id="cb2-185"><a href="#cb2-185" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">enter</span>()</span>
<span id="cb2-186"><a href="#cb2-186" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">append</span>(<span class="st">'rect'</span>)</span>
<span id="cb2-187"><a href="#cb2-187" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">'class'</span><span class="op">,</span> <span class="st">'tickB'</span>)</span>
<span id="cb2-188"><a href="#cb2-188" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">'x'</span><span class="op">,</span> d<span class="kw">=&gt;</span><span class="fu">scaleDD</span>(d<span class="op">/</span><span class="dv">10</span>)<span class="op">+</span>barX)</span>
<span id="cb2-189"><a href="#cb2-189" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">'y'</span><span class="op">,</span> firstBarY<span class="op">+</span><span class="dv">60</span>)</span>
<span id="cb2-190"><a href="#cb2-190" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">'height'</span><span class="op">,</span> d<span class="kw">=&gt;</span>d<span class="op">%</span><span class="dv">2</span><span class="op">===</span><span class="dv">0</span><span class="op">?</span> <span class="dv">9</span><span class="op">:</span><span class="dv">6</span>)</span>
<span id="cb2-191"><a href="#cb2-191" aria-hidden="true" tabindex="-1"></a>  <span class="co">// Labels</span></span>
<span id="cb2-192"><a href="#cb2-192" aria-hidden="true" tabindex="-1"></a>  svg<span class="op">.</span><span class="fu">selectAll</span>(<span class="st">'.timeLabel'</span>)</span>
<span id="cb2-193"><a href="#cb2-193" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">data</span>([<span class="vs">`+</span><span class="sc">${</span>barDD<span class="sc">}</span><span class="vs">`</span><span class="op">,</span> <span class="vs">`</span><span class="sc">${</span>barMils<span class="sc">}</span><span class="vs">`</span><span class="op">,</span> <span class="vs">`</span><span class="sc">${</span>barBeats<span class="sc">}</span><span class="vs">`</span>])</span>
<span id="cb2-194"><a href="#cb2-194" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">enter</span>()</span>
<span id="cb2-195"><a href="#cb2-195" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">append</span>(<span class="st">'text'</span>)</span>
<span id="cb2-196"><a href="#cb2-196" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">'class'</span><span class="op">,</span> <span class="st">'timeLabel'</span>)</span>
<span id="cb2-197"><a href="#cb2-197" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">'x'</span><span class="op">,</span> barX<span class="op">+</span><span class="dv">2</span>)</span>
<span id="cb2-198"><a href="#cb2-198" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">'y'</span><span class="op">,</span> (d<span class="op">,</span>i)<span class="kw">=&gt;</span>i<span class="op">*</span><span class="dv">30</span><span class="op">+</span>firstBarY<span class="op">+</span><span class="dv">20</span>)</span>
<span id="cb2-199"><a href="#cb2-199" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">style</span>(<span class="st">"font-size"</span><span class="op">,</span> <span class="vs">`</span><span class="sc">${</span>W <span class="op">&lt;</span> <span class="dv">300</span> <span class="op">?</span> <span class="dv">14</span> <span class="op">:</span> W <span class="op">&lt;</span> <span class="dv">400</span> <span class="op">?</span> <span class="dv">16</span> <span class="op">:</span> W <span class="op">&lt;</span> <span class="dv">500</span> <span class="op">?</span> <span class="dv">18</span> <span class="op">:</span> W <span class="op">&lt;</span> <span class="dv">600</span> <span class="op">?</span> <span class="dv">20</span> <span class="op">:</span> <span class="dv">22</span><span class="sc">}</span><span class="vs">px`</span>)</span>
<span id="cb2-200"><a href="#cb2-200" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">text</span>(d<span class="kw">=&gt;</span>d)<span class="op">;</span></span>
<span id="cb2-201"><a href="#cb2-201" aria-hidden="true" tabindex="-1"></a>  svg<span class="op">.</span><span class="fu">attr</span>(<span class="st">"id"</span><span class="op">,</span> <span class="st">"topbar"</span>)<span class="op">;</span></span>
<span id="cb2-202"><a href="#cb2-202" aria-hidden="true" tabindex="-1"></a>  svg<span class="op">.</span><span class="fu">attr</span>(<span class="st">'class'</span><span class="op">,</span> <span class="st">'barclock'</span>)</span>
<span id="cb2-203"><a href="#cb2-203" aria-hidden="true" tabindex="-1"></a>  <span class="cf">return</span> svg<span class="op">.</span><span class="fu">node</span>()<span class="op">;</span></span>
<span id="cb2-204"><a href="#cb2-204" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb2-205"><a href="#cb2-205" aria-hidden="true" tabindex="-1"></a>barChart1 <span class="op">=</span> {</span>
<span id="cb2-206"><a href="#cb2-206" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> W <span class="op">=</span> <span class="dv">800</span><span class="op">;</span></span>
<span id="cb2-207"><a href="#cb2-207" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> H <span class="op">=</span> <span class="dv">88</span><span class="op">;</span></span>
<span id="cb2-208"><a href="#cb2-208" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> barX <span class="op">=</span> <span class="dv">1</span><span class="op">;</span></span>
<span id="cb2-209"><a href="#cb2-209" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> firstBarY <span class="op">=</span> <span class="dv">1</span><span class="op">;</span></span>
<span id="cb2-210"><a href="#cb2-210" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> svg <span class="op">=</span> d3</span>
<span id="cb2-211"><a href="#cb2-211" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">create</span>(<span class="st">"svg"</span>)</span>
<span id="cb2-212"><a href="#cb2-212" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">"width"</span><span class="op">,</span> W)</span>
<span id="cb2-213"><a href="#cb2-213" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">"viewBox"</span><span class="op">,</span> [<span class="dv">0</span><span class="op">,</span> <span class="dv">0</span><span class="op">,</span> W <span class="op">/</span> <span class="fl">1.14</span><span class="op">,</span> H])<span class="op">;</span></span>
<span id="cb2-214"><a href="#cb2-214" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> xRange <span class="op">=</span> [<span class="dv">0</span><span class="op">,</span> W <span class="op">-</span> <span class="dv">100</span>]<span class="op">;</span></span>
<span id="cb2-215"><a href="#cb2-215" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> scaleDD <span class="op">=</span> d3<span class="op">.</span><span class="fu">scaleLinear</span>()</span>
<span id="cb2-216"><a href="#cb2-216" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">domain</span>([<span class="dv">0</span><span class="op">,</span> <span class="dv">10</span>])</span>
<span id="cb2-217"><a href="#cb2-217" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">range</span>(xRange)<span class="op">;</span></span>
<span id="cb2-218"><a href="#cb2-218" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> scaleMandB <span class="op">=</span> d3<span class="op">.</span><span class="fu">scaleLinear</span>()</span>
<span id="cb2-219"><a href="#cb2-219" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">domain</span>([<span class="dv">0</span><span class="op">,</span> <span class="dv">100</span>])</span>
<span id="cb2-220"><a href="#cb2-220" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">range</span>(xRange)<span class="op">;</span></span>
<span id="cb2-221"><a href="#cb2-221" aria-hidden="true" tabindex="-1"></a>  <span class="co">// const scaleDek = d3.scaleLinear()</span></span>
<span id="cb2-222"><a href="#cb2-222" aria-hidden="true" tabindex="-1"></a>  <span class="co">//  .domain([0, 37])</span></span>
<span id="cb2-223"><a href="#cb2-223" aria-hidden="true" tabindex="-1"></a>  <span class="co">//  .range(xRange);</span></span>
<span id="cb2-224"><a href="#cb2-224" aria-hidden="true" tabindex="-1"></a>  <span class="co">// Background bars to show where 100% lies</span></span>
<span id="cb2-225"><a href="#cb2-225" aria-hidden="true" tabindex="-1"></a>  svg<span class="op">.</span><span class="fu">selectAll</span>(<span class="st">'.background'</span>)</span>
<span id="cb2-226"><a href="#cb2-226" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">data</span>([</span>
<span id="cb2-227"><a href="#cb2-227" aria-hidden="true" tabindex="-1"></a>      <span class="co">// 'dek', 'dotd',</span></span>
<span id="cb2-228"><a href="#cb2-228" aria-hidden="true" tabindex="-1"></a>      <span class="st">'dd'</span><span class="op">,</span> <span class="st">"mils"</span><span class="op">,</span> <span class="st">'beats'</span>])</span>
<span id="cb2-229"><a href="#cb2-229" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">enter</span>()</span>
<span id="cb2-230"><a href="#cb2-230" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">append</span>(<span class="st">'rect'</span>)</span>
<span id="cb2-231"><a href="#cb2-231" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">'class'</span><span class="op">,</span> <span class="st">'background timeBar'</span>)</span>
<span id="cb2-232"><a href="#cb2-232" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">'width'</span><span class="op">,</span> W<span class="op">-</span><span class="dv">100</span>)</span>
<span id="cb2-233"><a href="#cb2-233" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">'y'</span><span class="op">,</span> (d<span class="op">,</span>i)<span class="kw">=&gt;</span>i<span class="op">*</span><span class="dv">30</span><span class="op">+</span>firstBarY)</span>
<span id="cb2-234"><a href="#cb2-234" aria-hidden="true" tabindex="-1"></a>  <span class="co">// Beats</span></span>
<span id="cb2-235"><a href="#cb2-235" aria-hidden="true" tabindex="-1"></a>  svg</span>
<span id="cb2-236"><a href="#cb2-236" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">append</span>(<span class="st">'rect'</span>)</span>
<span id="cb2-237"><a href="#cb2-237" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">'class'</span><span class="op">,</span> <span class="st">'timeBar'</span>)</span>
<span id="cb2-238"><a href="#cb2-238" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">'y'</span><span class="op">,</span> firstBarY<span class="op">+</span><span class="dv">60</span>)</span>
<span id="cb2-239"><a href="#cb2-239" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">'width'</span><span class="op">,</span> d <span class="kw">=&gt;</span> <span class="fu">scaleMandB</span>(<span class="bu">Number</span>(barBeatsN)))</span>
<span id="cb2-240"><a href="#cb2-240" aria-hidden="true" tabindex="-1"></a>  svg</span>
<span id="cb2-241"><a href="#cb2-241" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">append</span>(<span class="st">'rect'</span>)</span>
<span id="cb2-242"><a href="#cb2-242" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">'class'</span><span class="op">,</span> <span class="st">'timeBarFullN'</span>)</span>
<span id="cb2-243"><a href="#cb2-243" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">'y'</span><span class="op">,</span> firstBarY<span class="op">+</span><span class="dv">60</span>)</span>
<span id="cb2-244"><a href="#cb2-244" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">'width'</span><span class="op">,</span> d <span class="kw">=&gt;</span> <span class="fu">scaleMandB</span>(barBeatsN))</span>
<span id="cb2-245"><a href="#cb2-245" aria-hidden="true" tabindex="-1"></a>  <span class="co">// Cents/Mils</span></span>
<span id="cb2-246"><a href="#cb2-246" aria-hidden="true" tabindex="-1"></a>  svg</span>
<span id="cb2-247"><a href="#cb2-247" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">append</span>(<span class="st">'rect'</span>)</span>
<span id="cb2-248"><a href="#cb2-248" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">'class'</span><span class="op">,</span> <span class="st">'timeBar'</span>)</span>
<span id="cb2-249"><a href="#cb2-249" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">'y'</span><span class="op">,</span> firstBarY)</span>
<span id="cb2-250"><a href="#cb2-250" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">'width'</span><span class="op">,</span> d <span class="kw">=&gt;</span> <span class="fu">scaleDD</span>(<span class="bu">Number</span>(barDDN)<span class="op">+</span><span class="bu">Number</span>(barMilsN)<span class="op">/</span><span class="dv">100</span><span class="op">+</span><span class="bu">Number</span>(barBeatsN)<span class="op">/</span><span class="dv">10000</span>))</span>
<span id="cb2-251"><a href="#cb2-251" aria-hidden="true" tabindex="-1"></a>  svg</span>
<span id="cb2-252"><a href="#cb2-252" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">append</span>(<span class="st">'rect'</span>)</span>
<span id="cb2-253"><a href="#cb2-253" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">'class'</span><span class="op">,</span> <span class="st">'timeBarFullN'</span>)</span>
<span id="cb2-254"><a href="#cb2-254" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">'y'</span><span class="op">,</span> firstBarY)</span>
<span id="cb2-255"><a href="#cb2-255" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">'width'</span><span class="op">,</span> d <span class="kw">=&gt;</span> <span class="fu">scaleDD</span>(barDDN))</span>
<span id="cb2-256"><a href="#cb2-256" aria-hidden="true" tabindex="-1"></a>  svg</span>
<span id="cb2-257"><a href="#cb2-257" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">append</span>(<span class="st">'rect'</span>)</span>
<span id="cb2-258"><a href="#cb2-258" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">'class'</span><span class="op">,</span> <span class="st">'timeBar'</span>)</span>
<span id="cb2-259"><a href="#cb2-259" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">'y'</span><span class="op">,</span> firstBarY<span class="op">+</span><span class="dv">30</span>)</span>
<span id="cb2-260"><a href="#cb2-260" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">'width'</span><span class="op">,</span> d <span class="kw">=&gt;</span> <span class="fu">scaleMandB</span>(<span class="bu">Number</span>(barMilsN)<span class="op">+</span><span class="bu">Number</span>(barBeatsN)<span class="op">/</span><span class="dv">100</span>))</span>
<span id="cb2-261"><a href="#cb2-261" aria-hidden="true" tabindex="-1"></a>  svg</span>
<span id="cb2-262"><a href="#cb2-262" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">append</span>(<span class="st">'rect'</span>)</span>
<span id="cb2-263"><a href="#cb2-263" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">'class'</span><span class="op">,</span> <span class="st">'timeBarFullN'</span>)</span>
<span id="cb2-264"><a href="#cb2-264" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">'y'</span><span class="op">,</span> firstBarY<span class="op">+</span><span class="dv">30</span>)</span>
<span id="cb2-265"><a href="#cb2-265" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">'width'</span><span class="op">,</span> d <span class="kw">=&gt;</span> <span class="fu">scaleMandB</span>(barMilsN))</span>
<span id="cb2-266"><a href="#cb2-266" aria-hidden="true" tabindex="-1"></a>  <span class="co">// Cent ticks</span></span>
<span id="cb2-267"><a href="#cb2-267" aria-hidden="true" tabindex="-1"></a>  svg<span class="op">.</span><span class="fu">selectAll</span>(<span class="st">'.tickC'</span>)</span>
<span id="cb2-268"><a href="#cb2-268" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">data</span>(d3<span class="op">.</span><span class="fu">range</span>(width <span class="op">&gt;</span> <span class="dv">500</span> <span class="op">?</span> <span class="dv">10</span> <span class="op">:</span> <span class="dv">10</span><span class="op">,</span> <span class="dv">100</span>))</span>
<span id="cb2-269"><a href="#cb2-269" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">enter</span>()</span>
<span id="cb2-270"><a href="#cb2-270" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">append</span>(<span class="st">'rect'</span>)</span>
<span id="cb2-271"><a href="#cb2-271" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">'class'</span><span class="op">,</span> <span class="st">'tickC'</span>)</span>
<span id="cb2-272"><a href="#cb2-272" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">'x'</span><span class="op">,</span> d<span class="kw">=&gt;</span><span class="fu">scaleDD</span>(d<span class="op">/</span><span class="dv">10</span>)<span class="op">+</span>barX)</span>
<span id="cb2-273"><a href="#cb2-273" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">'y'</span><span class="op">,</span> firstBarY<span class="op">+</span><span class="dv">30</span>)</span>
<span id="cb2-274"><a href="#cb2-274" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">'height'</span><span class="op">,</span> d<span class="kw">=&gt;</span>d<span class="op">%</span><span class="dv">2</span><span class="op">===</span><span class="dv">0</span><span class="op">?</span> <span class="dv">8</span><span class="op">:</span><span class="dv">5</span>)</span>
<span id="cb2-275"><a href="#cb2-275" aria-hidden="true" tabindex="-1"></a>  svg<span class="op">.</span><span class="fu">selectAll</span>(<span class="st">'.tickB1'</span>)</span>
<span id="cb2-276"><a href="#cb2-276" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">data</span>(d3<span class="op">.</span><span class="fu">range</span>(width <span class="op">&gt;</span> <span class="dv">500</span> <span class="op">?</span> <span class="dv">10</span> <span class="op">:</span> <span class="dv">10</span><span class="op">,</span> <span class="dv">100</span>))</span>
<span id="cb2-277"><a href="#cb2-277" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">enter</span>()</span>
<span id="cb2-278"><a href="#cb2-278" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">append</span>(<span class="st">'rect'</span>)</span>
<span id="cb2-279"><a href="#cb2-279" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">'class'</span><span class="op">,</span> <span class="st">'tickB1'</span>)</span>
<span id="cb2-280"><a href="#cb2-280" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">'x'</span><span class="op">,</span> d<span class="kw">=&gt;</span><span class="fu">scaleDD</span>(d<span class="op">/</span><span class="dv">10</span>)<span class="op">+</span>barX)</span>
<span id="cb2-281"><a href="#cb2-281" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">'y'</span><span class="op">,</span> d<span class="kw">=&gt;</span>d<span class="op">%</span><span class="dv">2</span><span class="op">===</span><span class="dv">0</span><span class="op">?</span> firstBarY<span class="op">+</span><span class="dv">77</span><span class="op">:</span>firstBarY<span class="op">+</span><span class="dv">80</span>)</span>
<span id="cb2-282"><a href="#cb2-282" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">'height'</span><span class="op">,</span> d<span class="kw">=&gt;</span>d<span class="op">%</span><span class="dv">2</span><span class="op">===</span><span class="dv">0</span><span class="op">?</span> <span class="dv">8</span><span class="op">:</span><span class="dv">5</span>)</span>
<span id="cb2-283"><a href="#cb2-283" aria-hidden="true" tabindex="-1"></a>  svg<span class="op">.</span><span class="fu">selectAll</span>(<span class="st">'.tickC1'</span>)</span>
<span id="cb2-284"><a href="#cb2-284" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">data</span>(d3<span class="op">.</span><span class="fu">range</span>(width <span class="op">&gt;</span> <span class="dv">500</span> <span class="op">?</span> <span class="dv">10</span> <span class="op">:</span> <span class="dv">10</span><span class="op">,</span> <span class="dv">100</span>))</span>
<span id="cb2-285"><a href="#cb2-285" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">enter</span>()</span>
<span id="cb2-286"><a href="#cb2-286" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">append</span>(<span class="st">'rect'</span>)</span>
<span id="cb2-287"><a href="#cb2-287" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">'class'</span><span class="op">,</span> <span class="st">'tickC1'</span>)</span>
<span id="cb2-288"><a href="#cb2-288" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">'x'</span><span class="op">,</span> d<span class="kw">=&gt;</span><span class="fu">scaleDD</span>(d<span class="op">/</span><span class="dv">10</span>)<span class="op">+</span>barX)</span>
<span id="cb2-289"><a href="#cb2-289" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">'y'</span><span class="op">,</span> d<span class="kw">=&gt;</span>d<span class="op">%</span><span class="dv">2</span><span class="op">===</span><span class="dv">0</span><span class="op">?</span> firstBarY<span class="op">+</span><span class="dv">47</span><span class="op">:</span>firstBarY<span class="op">+</span><span class="dv">50</span>)</span>
<span id="cb2-290"><a href="#cb2-290" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">'height'</span><span class="op">,</span> d<span class="kw">=&gt;</span>d<span class="op">%</span><span class="dv">2</span><span class="op">===</span><span class="dv">0</span><span class="op">?</span> <span class="dv">8</span><span class="op">:</span><span class="dv">5</span>)</span>
<span id="cb2-291"><a href="#cb2-291" aria-hidden="true" tabindex="-1"></a>  <span class="co">// Mil ticks</span></span>
<span id="cb2-292"><a href="#cb2-292" aria-hidden="true" tabindex="-1"></a>  svg<span class="op">.</span><span class="fu">selectAll</span>(<span class="st">'.tickM'</span>)</span>
<span id="cb2-293"><a href="#cb2-293" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">data</span>(d3<span class="op">.</span><span class="fu">range</span>(width <span class="op">&gt;</span> <span class="dv">500</span> <span class="op">?</span> <span class="dv">1</span> <span class="op">:</span> <span class="dv">1</span><span class="op">,</span> <span class="dv">10</span>))</span>
<span id="cb2-294"><a href="#cb2-294" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">enter</span>()</span>
<span id="cb2-295"><a href="#cb2-295" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">append</span>(<span class="st">'rect'</span>)</span>
<span id="cb2-296"><a href="#cb2-296" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">'class'</span><span class="op">,</span> <span class="st">'tickM'</span>)</span>
<span id="cb2-297"><a href="#cb2-297" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">'x'</span><span class="op">,</span> d<span class="kw">=&gt;</span><span class="fu">scaleDD</span>(d)<span class="op">+</span>barX)</span>
<span id="cb2-298"><a href="#cb2-298" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">'y'</span><span class="op">,</span> firstBarY<span class="op">+</span><span class="dv">20</span>)</span>
<span id="cb2-299"><a href="#cb2-299" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">'height'</span><span class="op">,</span> <span class="dv">6</span>)</span>
<span id="cb2-300"><a href="#cb2-300" aria-hidden="true" tabindex="-1"></a>  svg<span class="op">.</span><span class="fu">selectAll</span>(<span class="st">'.tickLabel1'</span>)</span>
<span id="cb2-301"><a href="#cb2-301" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">data</span>(d3<span class="op">.</span><span class="fu">range</span>(width <span class="op">&gt;</span> <span class="dv">500</span> <span class="op">?</span> <span class="dv">1</span> <span class="op">:</span> <span class="dv">1</span><span class="op">,</span> <span class="dv">10</span>))</span>
<span id="cb2-302"><a href="#cb2-302" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">enter</span>()</span>
<span id="cb2-303"><a href="#cb2-303" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">append</span>(<span class="st">'text'</span>)</span>
<span id="cb2-304"><a href="#cb2-304" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">'class'</span><span class="op">,</span> <span class="st">'tickLabel1'</span>)</span>
<span id="cb2-305"><a href="#cb2-305" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">'x'</span><span class="op">,</span> d<span class="kw">=&gt;</span><span class="fu">scaleDD</span>(d)<span class="op">+</span>barX<span class="op">+.</span><span class="dv">5</span>)</span>
<span id="cb2-306"><a href="#cb2-306" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">'y'</span><span class="op">,</span> firstBarY<span class="op">+</span><span class="dv">18</span>)</span>
<span id="cb2-307"><a href="#cb2-307" aria-hidden="true" tabindex="-1"></a>    <span class="co">//.style("font-size", `{W &lt; 350 ? 12 : W &lt; 450 ? 14 : W &lt; 550 ? 16 : W &lt; 650 ? 18 : 20}px`)</span></span>
<span id="cb2-308"><a href="#cb2-308" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">text</span>(d<span class="kw">=&gt;</span>d)</span>
<span id="cb2-309"><a href="#cb2-309" aria-hidden="true" tabindex="-1"></a>  <span class="co">// Cent ticks</span></span>
<span id="cb2-310"><a href="#cb2-310" aria-hidden="true" tabindex="-1"></a>  svg<span class="op">.</span><span class="fu">selectAll</span>(<span class="st">'.tickC2'</span>)</span>
<span id="cb2-311"><a href="#cb2-311" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">data</span>(d3<span class="op">.</span><span class="fu">range</span>(width <span class="op">&gt;</span> <span class="dv">500</span> <span class="op">?</span> <span class="dv">10</span> <span class="op">:</span> <span class="dv">10</span><span class="op">,</span> <span class="dv">100</span>))</span>
<span id="cb2-312"><a href="#cb2-312" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">enter</span>()</span>
<span id="cb2-313"><a href="#cb2-313" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">append</span>(<span class="st">'rect'</span>)</span>
<span id="cb2-314"><a href="#cb2-314" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">'class'</span><span class="op">,</span> <span class="st">'tickC2'</span>)</span>
<span id="cb2-315"><a href="#cb2-315" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">'x'</span><span class="op">,</span> d<span class="kw">=&gt;</span><span class="fu">scaleDD</span>(d<span class="op">/</span><span class="dv">10</span>)<span class="op">+</span>barX)</span>
<span id="cb2-316"><a href="#cb2-316" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">'y'</span><span class="op">,</span> firstBarY<span class="op">+</span><span class="dv">10</span>)</span>
<span id="cb2-317"><a href="#cb2-317" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">'height'</span><span class="op">,</span> d<span class="kw">=&gt;</span>d<span class="op">%</span><span class="dv">2</span><span class="op">===</span><span class="dv">0</span><span class="op">?</span> <span class="dv">9</span><span class="op">:</span><span class="dv">6</span>)</span>
<span id="cb2-318"><a href="#cb2-318" aria-hidden="true" tabindex="-1"></a>  <span class="co">// Beat ticks</span></span>
<span id="cb2-319"><a href="#cb2-319" aria-hidden="true" tabindex="-1"></a>  svg<span class="op">.</span><span class="fu">selectAll</span>(<span class="st">'.tickB'</span>)</span>
<span id="cb2-320"><a href="#cb2-320" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">data</span>(d3<span class="op">.</span><span class="fu">range</span>(width <span class="op">&gt;</span> <span class="dv">500</span> <span class="op">?</span> <span class="dv">10</span> <span class="op">:</span> <span class="dv">10</span><span class="op">,</span> <span class="dv">100</span>))</span>
<span id="cb2-321"><a href="#cb2-321" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">enter</span>()</span>
<span id="cb2-322"><a href="#cb2-322" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">append</span>(<span class="st">'rect'</span>)</span>
<span id="cb2-323"><a href="#cb2-323" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">'class'</span><span class="op">,</span> <span class="st">'tickB'</span>)</span>
<span id="cb2-324"><a href="#cb2-324" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">'x'</span><span class="op">,</span> d<span class="kw">=&gt;</span><span class="fu">scaleDD</span>(d<span class="op">/</span><span class="dv">10</span>)<span class="op">+</span>barX)</span>
<span id="cb2-325"><a href="#cb2-325" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">'y'</span><span class="op">,</span> firstBarY<span class="op">+</span><span class="dv">60</span>)</span>
<span id="cb2-326"><a href="#cb2-326" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">'height'</span><span class="op">,</span> d<span class="kw">=&gt;</span>d<span class="op">%</span><span class="dv">2</span><span class="op">===</span><span class="dv">0</span><span class="op">?</span> <span class="dv">9</span><span class="op">:</span><span class="dv">6</span>)</span>
<span id="cb2-327"><a href="#cb2-327" aria-hidden="true" tabindex="-1"></a>  <span class="co">// Labels</span></span>
<span id="cb2-328"><a href="#cb2-328" aria-hidden="true" tabindex="-1"></a>  svg<span class="op">.</span><span class="fu">selectAll</span>(<span class="st">'.timeLabel'</span>)</span>
<span id="cb2-329"><a href="#cb2-329" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">data</span>([<span class="vs">`-</span><span class="sc">${</span>barDDN<span class="sc">}</span><span class="vs">`</span><span class="op">,</span> <span class="vs">`</span><span class="sc">${</span>barMilsN<span class="sc">}</span><span class="vs">`</span><span class="op">,</span> <span class="vs">`</span><span class="sc">${</span>barBeatsN<span class="sc">}</span><span class="vs">`</span>])</span>
<span id="cb2-330"><a href="#cb2-330" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">enter</span>()</span>
<span id="cb2-331"><a href="#cb2-331" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">append</span>(<span class="st">'text'</span>)</span>
<span id="cb2-332"><a href="#cb2-332" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">'class'</span><span class="op">,</span> <span class="st">'timeLabel'</span>)</span>
<span id="cb2-333"><a href="#cb2-333" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">'x'</span><span class="op">,</span> barX<span class="op">+</span><span class="dv">2</span>)</span>
<span id="cb2-334"><a href="#cb2-334" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">'y'</span><span class="op">,</span> (d<span class="op">,</span>i)<span class="kw">=&gt;</span>i<span class="op">*</span><span class="dv">30</span><span class="op">+</span>firstBarY<span class="op">+</span><span class="dv">20</span>)</span>
<span id="cb2-335"><a href="#cb2-335" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">style</span>(<span class="st">"font-size"</span><span class="op">,</span> <span class="vs">`</span><span class="sc">${</span>W <span class="op">&lt;</span> <span class="dv">300</span> <span class="op">?</span> <span class="dv">14</span> <span class="op">:</span> W <span class="op">&lt;</span> <span class="dv">400</span> <span class="op">?</span> <span class="dv">16</span> <span class="op">:</span> W <span class="op">&lt;</span> <span class="dv">500</span> <span class="op">?</span> <span class="dv">18</span> <span class="op">:</span> W <span class="op">&lt;</span> <span class="dv">600</span> <span class="op">?</span> <span class="dv">20</span> <span class="op">:</span> <span class="dv">22</span><span class="sc">}</span><span class="vs">px`</span>)</span>
<span id="cb2-336"><a href="#cb2-336" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">text</span>(d<span class="kw">=&gt;</span>d)<span class="op">;</span></span>
<span id="cb2-337"><a href="#cb2-337" aria-hidden="true" tabindex="-1"></a>  svg<span class="op">.</span><span class="fu">attr</span>(<span class="st">"id"</span><span class="op">,</span> <span class="st">"btmbar"</span>)<span class="op">;</span></span>
<span id="cb2-338"><a href="#cb2-338" aria-hidden="true" tabindex="-1"></a>  svg<span class="op">.</span><span class="fu">attr</span>(<span class="st">'class'</span><span class="op">,</span> <span class="st">'barclock'</span>)</span>
<span id="cb2-339"><a href="#cb2-339" aria-hidden="true" tabindex="-1"></a>  <span class="cf">return</span> svg<span class="op">.</span><span class="fu">node</span>()<span class="op">;</span></span>
<span id="cb2-340"><a href="#cb2-340" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-display">
<div>
<div id="ojs-cell-2-1" data-nodetype="declaration">

</div>
</div>
</div>
<div class="cell-output cell-output-display">
<div>
<div id="ojs-cell-2-2" data-nodetype="declaration">

</div>
</div>
</div>
</div>
<div class="marginInputs page-columns page-full">
<div class="cell page-columns page-full">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code hidden" id="cb3" data-startfrom="347" data-source-offset="0"><pre class="sourceCode js code-with-copy"><code class="sourceCode javascript" style="counter-reset: source-line 346;"><span id="cb3-347"><a href="#cb3-347" aria-hidden="true" tabindex="-1"></a>viewof yaw <span class="op">=</span> Inputs<span class="op">.</span><span class="fu">range</span>([<span class="dv">0</span><span class="op">,</span> <span class="dv">1000</span>]<span class="op">,</span> {<span class="dt">label</span><span class="op">:</span> <span class="st">"Yaw"</span><span class="op">,</span> <span class="dt">value</span><span class="op">:</span> <span class="dv">500</span><span class="op">,</span> <span class="dt">step</span><span class="op">:</span> <span class="dv">1</span>})</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>

<div class="no-row-height column-margin column-container"><div id="yawinput" class="cell-output cell-output-display">
<div id="ojs-cell-3" data-nodetype="declaration">

</div>
</div></div></div>
<div class="cell page-columns page-full">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code hidden" id="cb4" data-startfrom="354" data-source-offset="0"><pre class="sourceCode js code-with-copy"><code class="sourceCode javascript" style="counter-reset: source-line 353;"><span id="cb4-354"><a href="#cb4-354" aria-hidden="true" tabindex="-1"></a>viewof pitch <span class="op">=</span> Inputs<span class="op">.</span><span class="fu">range</span>([<span class="op">-</span><span class="dv">500</span><span class="op">,</span> <span class="dv">500</span>]<span class="op">,</span> {<span class="dt">label</span><span class="op">:</span> <span class="st">"Pitch"</span><span class="op">,</span> <span class="dt">value</span><span class="op">:</span> <span class="dv">0</span><span class="op">,</span> <span class="dt">step</span><span class="op">:</span> <span class="dv">1</span>})</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>

<div class="no-row-height column-margin column-container"><div id="pitchinput" class="cell-output cell-output-display">
<div id="ojs-cell-4" data-nodetype="declaration">

</div>
</div></div></div>
<div class="cell page-columns page-full">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code hidden" id="cb5" data-startfrom="361" data-source-offset="0"><pre class="sourceCode js code-with-copy"><code class="sourceCode javascript" style="counter-reset: source-line 360;"><span id="cb5-361"><a href="#cb5-361" aria-hidden="true" tabindex="-1"></a>viewof roll <span class="op">=</span> Inputs<span class="op">.</span><span class="fu">range</span>([<span class="op">-</span><span class="dv">500</span><span class="op">,</span> <span class="dv">500</span>]<span class="op">,</span> {<span class="dt">label</span><span class="op">:</span> <span class="st">"Roll"</span><span class="op">,</span> <span class="dt">value</span><span class="op">:</span> <span class="dv">0</span><span class="op">,</span> <span class="dt">step</span><span class="op">:</span> <span class="dv">1</span>})</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>

<div class="no-row-height column-margin column-container"><div id="rollinput" class="cell-output cell-output-display">
<div id="ojs-cell-5" data-nodetype="declaration">

</div>
</div></div></div>
<div class="cell page-columns page-full">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code hidden" id="cb6" data-startfrom="368" data-source-offset="0"><pre class="sourceCode js code-with-copy"><code class="sourceCode javascript" style="counter-reset: source-line 367;"><span id="cb6-368"><a href="#cb6-368" aria-hidden="true" tabindex="-1"></a>viewof mapsize <span class="op">=</span> Inputs<span class="op">.</span><span class="fu">range</span>([<span class="dv">0</span><span class="op">,</span> <span class="dv">100</span>]<span class="op">,</span> {<span class="dt">label</span><span class="op">:</span> <span class="st">"Size"</span><span class="op">,</span> <span class="dt">value</span><span class="op">:</span> <span class="dv">100</span><span class="op">,</span> <span class="dt">step</span><span class="op">:</span> <span class="dv">1</span>})</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>

<div class="no-row-height column-margin column-container"><div id="sizeinput" class="cell-output cell-output-display">
<div id="ojs-cell-6" data-nodetype="declaration">

</div>
</div></div></div>
<div class="cell page-columns page-full">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code hidden" id="cb7" data-startfrom="375" data-source-offset="0"><pre class="sourceCode js code-with-copy"><code class="sourceCode javascript" style="counter-reset: source-line 374;"><span id="cb7-375"><a href="#cb7-375" aria-hidden="true" tabindex="-1"></a>viewof select <span class="op">=</span> Inputs<span class="op">.</span><span class="fu">select</span>(</span>
<span id="cb7-376"><a href="#cb7-376" aria-hidden="true" tabindex="-1"></a>  projections<span class="op">,</span> {<span class="dt">format</span><span class="op">:</span> x <span class="kw">=&gt;</span> x<span class="op">.</span><span class="at">name</span><span class="op">,</span> <span class="dt">value</span><span class="op">:</span> projections<span class="op">.</span><span class="fu">find</span>(t <span class="kw">=&gt;</span> t<span class="op">.</span><span class="at">name</span> <span class="op">===</span> <span class="st">"Equirectangular (plate carrée)"</span>)})</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>

<div class="no-row-height column-margin column-container"><div id="projselect" class="cell-output cell-output-display">
<div id="ojs-cell-7" data-nodetype="declaration">

</div>
</div></div></div>
<div class="cell page-columns page-full">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code hidden" id="cb8" data-startfrom="383" data-source-offset="0"><pre class="sourceCode js code-with-copy"><code class="sourceCode javascript" style="counter-reset: source-line 382;"><span id="cb8-383"><a href="#cb8-383" aria-hidden="true" tabindex="-1"></a>table <span class="op">=</span> <span class="fu">createTable</span>([</span>
<span id="cb8-384"><a href="#cb8-384" aria-hidden="true" tabindex="-1"></a>  { <span class="dt">Milliparallel</span><span class="op">:</span> <span class="dv">800</span><span class="op">,</span> <span class="dt">Millimeridian</span><span class="op">:</span> <span class="dv">0</span> }<span class="op">,</span></span>
<span id="cb8-385"><a href="#cb8-385" aria-hidden="true" tabindex="-1"></a>]<span class="op">,</span> { <span class="dt">headerEditable</span><span class="op">:</span> <span class="kw">false</span><span class="op">,</span> <span class="dt">appendRows</span><span class="op">:</span> <span class="kw">false</span> })</span>
<span id="cb8-386"><a href="#cb8-386" aria-hidden="true" tabindex="-1"></a><span class="co">//   {Point: 0, Milliparallel: `${Math.floor(long2turn(Place_A[0], 3))}`, Millimeridian: `${Math.floor(lati2turn(Place_A[1], 3))}`, Milliwindrose: `${Math.floor(lati2turn(coor2bear(Place_A, Place_B)))}`},</span></span>
<span id="cb8-387"><a href="#cb8-387" aria-hidden="true" tabindex="-1"></a><span class="co">//   {Point: 1, Milliparallel: `${Math.floor(long2turn(Place_B[0], 3))}`, Millimeridian: `${Math.floor(lati2turn(Place_B[1], 3))}`, Milliwindrose: `${Math.floor(lati2turn(coor2bear(Place_B, Place_A)))}`},</span></span>
<span id="cb8-388"><a href="#cb8-388" aria-hidden="true" tabindex="-1"></a><span class="co">// ], {headerEditable: false, appendRows: false})</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>

<div class="no-row-height column-margin column-container"><div id="maptable" class="cell-output cell-output-display">
<div id="ojs-cell-8" data-nodetype="declaration">

</div>
</div></div></div>
</div>
</section><section id="llm" class="level5 hiddenheading page-columns page-full"><h5 class="hiddenheading anchored" data-anchor-id="llm">Longitude latitude map</h5>
<div class="column-screen">
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code hidden" id="cb9" data-startfrom="398" data-source-offset="0"><pre class="sourceCode js code-with-copy"><code class="sourceCode javascript" style="counter-reset: source-line 397;"><span id="cb9-398"><a href="#cb9-398" aria-hidden="true" tabindex="-1"></a>viewof location <span class="op">=</span> <span class="fu">worldMapCoordinates</span>([[<span class="dv">162</span><span class="op">,</span> <span class="dv">0</span>]<span class="op">,</span> projection]<span class="op">,</span> [width<span class="op">,</span> height <span class="op">*</span> mapsize <span class="op">/</span> <span class="dv">100</span>])</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div id="distmap" class="cell-output cell-output-display">
<div id="ojs-cell-9" data-nodetype="declaration">

</div>
</div>
</div>
</div>
</section><section id="dac" class="level5 hiddenheading page-columns page-full"><h5 class="hiddenheading anchored" data-anchor-id="dac">Daylight area chart</h5>
<div class="column-page">
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code hidden" id="cb10" data-startfrom="407" data-source-offset="0"><pre class="sourceCode js code-with-copy"><code class="sourceCode javascript" style="counter-reset: source-line 406;"><span id="cb10-407"><a href="#cb10-407" aria-hidden="true" tabindex="-1"></a><span class="co">// https://observablehq.com/@dbridges/visualizing-seasonal-daylight</span></span>
<span id="cb10-408"><a href="#cb10-408" aria-hidden="true" tabindex="-1"></a>app <span class="op">=</span> {</span>
<span id="cb10-409"><a href="#cb10-409" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> svg <span class="op">=</span> d3<span class="op">.</span><span class="fu">select</span>(DOM<span class="op">.</span><span class="fu">svg</span>(width<span class="op">,</span> height <span class="op">*</span> (width <span class="op">&lt;</span> <span class="dv">300</span> <span class="op">?</span> <span class="op">.</span><span class="dv">97</span> <span class="op">:</span> width <span class="op">&lt;</span> <span class="dv">350</span> <span class="op">?</span> <span class="op">.</span><span class="dv">96</span> <span class="op">:</span> width <span class="op">&lt;</span> <span class="dv">400</span> <span class="op">?</span> <span class="op">.</span><span class="dv">95</span> <span class="op">:</span> width <span class="op">&lt;</span> <span class="dv">450</span> <span class="op">?</span> <span class="op">.</span><span class="dv">94</span> <span class="op">:</span> width <span class="op">&lt;</span> <span class="dv">500</span> <span class="op">?</span> <span class="op">.</span><span class="dv">93</span> <span class="op">:</span> width <span class="op">&lt;</span> <span class="dv">550</span> <span class="op">?</span> <span class="op">.</span><span class="dv">92</span> <span class="op">:</span> width <span class="op">&lt;</span> <span class="dv">600</span> <span class="op">?</span> <span class="op">.</span><span class="dv">9</span> <span class="op">:</span> width <span class="op">&lt;</span> <span class="dv">650</span> <span class="op">?</span> <span class="op">.</span><span class="dv">86</span> <span class="op">:</span> width <span class="op">&lt;</span> <span class="dv">700</span> <span class="op">?</span> <span class="op">.</span><span class="dv">82</span> <span class="op">:</span> width <span class="op">&lt;</span> <span class="dv">800</span> <span class="op">?</span> <span class="op">.</span><span class="dv">81</span> <span class="op">:</span> width <span class="op">&lt;</span> <span class="dv">900</span> <span class="op">?</span> <span class="op">.</span><span class="dv">80</span> <span class="op">:</span> width <span class="op">&lt;</span> <span class="dv">1000</span> <span class="op">?</span> <span class="op">.</span><span class="dv">76</span> <span class="op">:</span> width <span class="op">&lt;</span> <span class="dv">1100</span> <span class="op">?</span> <span class="op">.</span><span class="dv">74</span> <span class="op">:</span> width <span class="op">&lt;</span> <span class="dv">1200</span> <span class="op">?</span> <span class="op">.</span><span class="dv">72</span> <span class="op">:</span> <span class="op">.</span><span class="dv">7</span>)))<span class="op">;</span></span>
<span id="cb10-410"><a href="#cb10-410" aria-hidden="true" tabindex="-1"></a>  svg<span class="op">.</span><span class="fu">style</span>(<span class="st">"user-select"</span><span class="op">,</span> <span class="st">"none"</span>)<span class="op">.</span><span class="fu">style</span>(<span class="st">"-webkit-user-select"</span><span class="op">,</span> <span class="st">"none"</span>)<span class="op">.</span><span class="fu">attr</span>(<span class="st">"id"</span><span class="op">,</span> <span class="st">"daylightapp"</span>)<span class="op">;</span></span>
<span id="cb10-411"><a href="#cb10-411" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> margin <span class="op">=</span> {<span class="dt">top</span><span class="op">:</span> <span class="dv">0</span><span class="op">,</span> <span class="dt">left</span><span class="op">:</span> <span class="dv">16</span><span class="op">,</span> <span class="dt">right</span><span class="op">:</span> <span class="dv">16</span><span class="op">,</span> <span class="dt">bottom</span><span class="op">:</span> <span class="dv">0</span><span class="op">,</span> <span class="dt">inner</span><span class="op">:</span> <span class="dv">32</span>}<span class="op">;</span></span>
<span id="cb10-412"><a href="#cb10-412" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> contentWidth <span class="op">=</span> width <span class="op">-</span> margin<span class="op">.</span><span class="at">left</span> <span class="op">-</span> margin<span class="op">.</span><span class="at">right</span> <span class="op">-</span> margin<span class="op">.</span><span class="at">inner</span><span class="op">;</span></span>
<span id="cb10-413"><a href="#cb10-413" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> columnWidth <span class="op">=</span> contentWidth <span class="op">/</span> <span class="dv">2</span><span class="op">;</span></span>
<span id="cb10-414"><a href="#cb10-414" aria-hidden="true" tabindex="-1"></a>  <span class="kw">let</span> selection <span class="op">=</span> {</span>
<span id="cb10-415"><a href="#cb10-415" aria-hidden="true" tabindex="-1"></a>    <span class="dt">date</span><span class="op">:</span> <span class="kw">this</span><span class="op">.</span><span class="at">value</span> <span class="op">!=</span> <span class="kw">null</span> <span class="op">?</span> <span class="kw">this</span><span class="op">.</span><span class="at">value</span><span class="op">.</span><span class="at">date</span> <span class="op">:</span> <span class="kw">new</span> <span class="bu">Date</span>(<span class="dv">2022</span><span class="op">,</span> <span class="kw">new</span> <span class="bu">Date</span>()<span class="op">.</span><span class="fu">getMonth</span>()<span class="op">,</span> <span class="kw">new</span> <span class="bu">Date</span>()<span class="op">.</span><span class="fu">getDate</span>()<span class="op">,</span> <span class="kw">new</span> <span class="bu">Date</span>()<span class="op">.</span><span class="fu">getHours</span>())<span class="op">,</span></span>
<span id="cb10-416"><a href="#cb10-416" aria-hidden="true" tabindex="-1"></a>    <span class="dt">hour</span><span class="op">:</span> <span class="kw">this</span><span class="op">.</span><span class="at">value</span> <span class="op">!=</span> <span class="kw">null</span> <span class="op">?</span> <span class="kw">this</span><span class="op">.</span><span class="at">value</span><span class="op">.</span><span class="at">hour</span> <span class="op">:</span> <span class="kw">new</span> <span class="bu">Date</span>(<span class="dv">2022</span><span class="op">,</span> <span class="kw">new</span> <span class="bu">Date</span>()<span class="op">.</span><span class="fu">getMonth</span>()<span class="op">,</span> <span class="kw">new</span> <span class="bu">Date</span>()<span class="op">.</span><span class="fu">getDate</span>()<span class="op">,</span> <span class="kw">new</span> <span class="bu">Date</span>()<span class="op">.</span><span class="fu">getHours</span>())<span class="op">.</span><span class="fu">getHours</span>()</span>
<span id="cb10-417"><a href="#cb10-417" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb10-418"><a href="#cb10-418" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> renderPlot <span class="op">=</span> () <span class="kw">=&gt;</span> {</span>
<span id="cb10-419"><a href="#cb10-419" aria-hidden="true" tabindex="-1"></a>    svg<span class="op">.</span><span class="fu">selectAll</span>(<span class="st">"#plot *"</span>)<span class="op">.</span><span class="fu">remove</span>()<span class="op">;</span></span>
<span id="cb10-420"><a href="#cb10-420" aria-hidden="true" tabindex="-1"></a>    svg<span class="op">.</span><span class="fu">select</span>(<span class="st">"#plot"</span>)<span class="op">.</span><span class="fu">call</span>(daylightPlot<span class="op">,</span> {</span>
<span id="cb10-421"><a href="#cb10-421" aria-hidden="true" tabindex="-1"></a>    <span class="dt">vizwidth</span><span class="op">:</span> columnWidth <span class="op">/</span> (width <span class="op">&lt;</span> <span class="dv">300</span> <span class="op">?</span> <span class="dv">1</span> <span class="op">:</span> width <span class="op">&lt;</span> <span class="dv">400</span> <span class="op">?</span> <span class="fl">1.05</span> <span class="op">:</span> width <span class="op">&lt;</span> <span class="dv">450</span> <span class="op">?</span> <span class="fl">1.1</span> <span class="op">:</span> width <span class="op">&lt;</span> <span class="dv">500</span> <span class="op">?</span> <span class="fl">1.15</span> <span class="op">:</span> width <span class="op">&lt;</span> <span class="dv">550</span> <span class="op">?</span> <span class="fl">1.2</span> <span class="op">:</span> width <span class="op">&lt;</span> <span class="dv">600</span> <span class="op">?</span> <span class="fl">1.25</span> <span class="op">:</span> width <span class="op">&lt;</span> <span class="dv">650</span> <span class="op">?</span> <span class="fl">1.3</span> <span class="op">:</span> width <span class="op">&lt;</span> <span class="dv">700</span> <span class="op">?</span> <span class="fl">1.4</span> <span class="op">:</span> <span class="fl">1.48</span>)<span class="op">,</span></span>
<span id="cb10-422"><a href="#cb10-422" aria-hidden="true" tabindex="-1"></a>      <span class="dt">height</span><span class="op">:</span> height <span class="op">*</span> (width <span class="op">&lt;</span> <span class="dv">400</span> <span class="op">?</span> <span class="fl">1.62</span> <span class="op">:</span> width <span class="op">&lt;</span> <span class="dv">500</span> <span class="op">?</span> <span class="fl">1.6</span> <span class="op">:</span> width <span class="op">&lt;</span> <span class="dv">600</span> <span class="op">?</span> <span class="fl">1.54</span> <span class="op">:</span> width <span class="op">&lt;</span> <span class="dv">800</span> <span class="op">?</span> <span class="fl">1.54</span> <span class="op">:</span> width <span class="op">&lt;</span> <span class="dv">900</span> <span class="op">?</span> <span class="fl">1.54</span> <span class="op">:</span> width <span class="op">&lt;</span> <span class="dv">1000</span> <span class="op">?</span> <span class="fl">1.54</span> <span class="op">:</span> width <span class="op">&lt;</span> <span class="dv">1100</span> <span class="op">?</span> <span class="fl">1.54</span> <span class="op">:</span> width <span class="op">&lt;</span> <span class="dv">1200</span> <span class="op">?</span> <span class="fl">1.54</span> <span class="op">:</span> width <span class="op">&lt;</span> <span class="dv">1300</span> <span class="op">?</span> <span class="fl">1.54</span> <span class="op">:</span> width <span class="op">&lt;</span> <span class="dv">1400</span> <span class="op">?</span> <span class="fl">1.54</span> <span class="op">:</span> <span class="fl">1.56</span>)<span class="op">,</span></span>
<span id="cb10-423"><a href="#cb10-423" aria-hidden="true" tabindex="-1"></a>      <span class="dt">year</span><span class="op">:</span> <span class="dv">2022</span><span class="op">,</span></span>
<span id="cb10-424"><a href="#cb10-424" aria-hidden="true" tabindex="-1"></a>      <span class="dt">latitude</span><span class="op">:</span> location[<span class="dv">1</span>]<span class="op">,</span></span>
<span id="cb10-425"><a href="#cb10-425" aria-hidden="true" tabindex="-1"></a>      <span class="dt">defaultDate</span><span class="op">:</span> selection<span class="op">.</span><span class="at">date</span><span class="op">,</span></span>
<span id="cb10-426"><a href="#cb10-426" aria-hidden="true" tabindex="-1"></a>      <span class="dt">defaultHour</span><span class="op">:</span> selection<span class="op">.</span><span class="at">hour</span></span>
<span id="cb10-427"><a href="#cb10-427" aria-hidden="true" tabindex="-1"></a>    })</span>
<span id="cb10-428"><a href="#cb10-428" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb10-429"><a href="#cb10-429" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> renderSolarSystem <span class="op">=</span> () <span class="kw">=&gt;</span> {</span>
<span id="cb10-430"><a href="#cb10-430" aria-hidden="true" tabindex="-1"></a>    svg<span class="op">.</span><span class="fu">selectAll</span>(<span class="st">"#solar-system *"</span>)<span class="op">.</span><span class="fu">remove</span>()<span class="op">;</span></span>
<span id="cb10-431"><a href="#cb10-431" aria-hidden="true" tabindex="-1"></a>    svg<span class="op">.</span><span class="fu">selectAll</span>(<span class="st">"#solar-system"</span>)<span class="op">.</span><span class="fu">call</span>(solarSystem<span class="op">,</span></span>
<span id="cb10-432"><a href="#cb10-432" aria-hidden="true" tabindex="-1"></a>                                        columnWidth <span class="op">*</span> <span class="fl">2.02</span><span class="op">,</span></span>
<span id="cb10-433"><a href="#cb10-433" aria-hidden="true" tabindex="-1"></a>                                        location<span class="op">,</span></span>
<span id="cb10-434"><a href="#cb10-434" aria-hidden="true" tabindex="-1"></a>                                        selection<span class="op">.</span><span class="at">date</span><span class="op">,</span></span>
<span id="cb10-435"><a href="#cb10-435" aria-hidden="true" tabindex="-1"></a>                                        selection<span class="op">.</span><span class="at">hour</span><span class="op">,</span></span>
<span id="cb10-436"><a href="#cb10-436" aria-hidden="true" tabindex="-1"></a>                                        <span class="bu">window</span><span class="op">.</span><span class="at">darkmode</span>)<span class="op">;</span></span>
<span id="cb10-437"><a href="#cb10-437" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb10-438"><a href="#cb10-438" aria-hidden="true" tabindex="-1"></a>  <span class="co">// const renderGlobe = () =&gt; {</span></span>
<span id="cb10-439"><a href="#cb10-439" aria-hidden="true" tabindex="-1"></a>  <span class="co">//   svg.selectAll("#globe *").remove();</span></span>
<span id="cb10-440"><a href="#cb10-440" aria-hidden="true" tabindex="-1"></a>  <span class="co">//   svg.selectAll("#globe").call(globe, { vizwidth: columnWidth / 1.28, location, ...selection });</span></span>
<span id="cb10-441"><a href="#cb10-441" aria-hidden="true" tabindex="-1"></a>  <span class="co">// }</span></span>
<span id="cb10-442"><a href="#cb10-442" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> setSelection <span class="op">=</span> (newSelection<span class="op">,</span> forceRender <span class="op">=</span> <span class="kw">false</span>) <span class="kw">=&gt;</span> {</span>
<span id="cb10-443"><a href="#cb10-443" aria-hidden="true" tabindex="-1"></a>    <span class="kw">const</span> prev <span class="op">=</span> {<span class="op">...</span>selection}<span class="op">;</span></span>
<span id="cb10-444"><a href="#cb10-444" aria-hidden="true" tabindex="-1"></a>    selection <span class="op">=</span> newSelection<span class="op">;</span></span>
<span id="cb10-445"><a href="#cb10-445" aria-hidden="true" tabindex="-1"></a>    svg<span class="op">.</span><span class="fu">node</span>()<span class="op">.</span><span class="at">value</span> <span class="op">=</span> selection<span class="op">;</span></span>
<span id="cb10-446"><a href="#cb10-446" aria-hidden="true" tabindex="-1"></a>    <span class="kw">this</span><span class="op">.</span><span class="at">value</span> <span class="op">=</span> selection<span class="op">;</span></span>
<span id="cb10-447"><a href="#cb10-447" aria-hidden="true" tabindex="-1"></a>    <span class="kw">set</span>(viewof selectedDate<span class="op">,</span> selection<span class="op">.</span><span class="at">date</span>)<span class="op">;</span></span>
<span id="cb10-448"><a href="#cb10-448" aria-hidden="true" tabindex="-1"></a>    <span class="kw">set</span>(viewof selectedHour<span class="op">,</span> selection<span class="op">.</span><span class="at">hour</span>)<span class="op">;</span></span>
<span id="cb10-449"><a href="#cb10-449" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> (forceRender) {</span>
<span id="cb10-450"><a href="#cb10-450" aria-hidden="true" tabindex="-1"></a>      <span class="fu">renderPlot</span>()<span class="op">;</span></span>
<span id="cb10-451"><a href="#cb10-451" aria-hidden="true" tabindex="-1"></a>      <span class="fu">renderSolarSystem</span>()<span class="op">;</span></span>
<span id="cb10-452"><a href="#cb10-452" aria-hidden="true" tabindex="-1"></a>  <span class="co">//    renderGlobe();</span></span>
<span id="cb10-453"><a href="#cb10-453" aria-hidden="true" tabindex="-1"></a>    } <span class="cf">else</span> <span class="cf">if</span> (prev<span class="op">.</span><span class="at">hour</span> <span class="op">!==</span> selection<span class="op">.</span><span class="at">hour</span> <span class="op">||</span> prev<span class="op">.</span><span class="at">date</span> <span class="op">!==</span> selection<span class="op">.</span><span class="at">date</span>) {</span>
<span id="cb10-454"><a href="#cb10-454" aria-hidden="true" tabindex="-1"></a>      <span class="fu">renderSolarSystem</span>()<span class="op">;</span></span>
<span id="cb10-455"><a href="#cb10-455" aria-hidden="true" tabindex="-1"></a>  <span class="co">//    renderGlobe();</span></span>
<span id="cb10-456"><a href="#cb10-456" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb10-457"><a href="#cb10-457" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb10-458"><a href="#cb10-458" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> plot <span class="op">=</span> svg<span class="op">.</span><span class="fu">append</span>(<span class="st">"g"</span>)</span>
<span id="cb10-459"><a href="#cb10-459" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">"id"</span><span class="op">,</span> <span class="st">"plot"</span>)</span>
<span id="cb10-460"><a href="#cb10-460" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">"transform"</span><span class="op">,</span> <span class="vs">`translate(</span><span class="sc">${</span>margin<span class="op">.</span><span class="at">left</span> <span class="op">+</span> (width <span class="op">&lt;</span> <span class="dv">500</span> <span class="op">?</span> <span class="dv">26</span> <span class="op">:</span> width <span class="op">&lt;</span> <span class="dv">600</span> <span class="op">?</span> <span class="dv">24</span> <span class="op">:</span> width <span class="op">&lt;</span> <span class="dv">700</span> <span class="op">?</span> <span class="dv">22</span> <span class="op">:</span> width <span class="op">&lt;</span> <span class="dv">800</span> <span class="op">?</span> <span class="dv">20</span> <span class="op">:</span> width <span class="op">&lt;</span> <span class="dv">900</span> <span class="op">?</span> <span class="dv">18</span> <span class="op">:</span> width <span class="op">&lt;</span> <span class="dv">950</span> <span class="op">?</span> <span class="dv">16</span> <span class="op">:</span> width <span class="op">&lt;</span> <span class="dv">1000</span> <span class="op">?</span> <span class="dv">15</span> <span class="op">:</span> width <span class="op">&lt;</span> <span class="dv">1100</span> <span class="op">?</span> <span class="dv">22</span> <span class="op">:</span> width <span class="op">&lt;</span> <span class="dv">1200</span> <span class="op">?</span> <span class="dv">20</span> <span class="op">:</span> width <span class="op">&lt;</span> <span class="dv">1300</span> <span class="op">?</span> <span class="dv">15</span> <span class="op">:</span> width <span class="op">&lt;</span> <span class="dv">1400</span> <span class="op">?</span> <span class="dv">10</span> <span class="op">:</span> width <span class="op">&lt;</span> <span class="dv">1500</span> <span class="op">?</span> <span class="dv">5</span> <span class="op">:</span> <span class="dv">0</span>)<span class="sc">}</span><span class="vs">, </span><span class="sc">${</span>width <span class="op">&lt;</span> <span class="dv">500</span> <span class="op">?</span> <span class="op">-</span><span class="dv">4</span> <span class="op">:</span> width <span class="op">&lt;</span> <span class="dv">600</span> <span class="op">?</span> <span class="op">-</span><span class="dv">12</span> <span class="op">:</span> width <span class="op">&lt;</span> <span class="dv">700</span> <span class="op">?</span> <span class="op">-</span><span class="dv">20</span> <span class="op">:</span> width <span class="op">&lt;</span> <span class="dv">800</span> <span class="op">?</span> <span class="op">-</span><span class="dv">28</span> <span class="op">:</span> width <span class="op">&lt;</span> <span class="dv">900</span> <span class="op">?</span> <span class="op">-</span><span class="dv">36</span> <span class="op">:</span> width <span class="op">&lt;</span> <span class="dv">950</span> <span class="op">?</span> <span class="op">-</span><span class="dv">44</span> <span class="op">:</span> width <span class="op">&lt;</span> <span class="dv">1000</span> <span class="op">?</span> <span class="op">-</span><span class="dv">48</span> <span class="op">:</span> width <span class="op">&lt;</span> <span class="dv">1100</span> <span class="op">?</span> <span class="op">-</span><span class="dv">52</span> <span class="op">:</span> width <span class="op">&lt;</span> <span class="dv">1200</span> <span class="op">?</span> <span class="op">-</span><span class="dv">54</span> <span class="op">:</span> width <span class="op">&lt;</span> <span class="dv">1300</span> <span class="op">?</span> <span class="op">-</span><span class="dv">56</span> <span class="op">:</span> width <span class="op">&lt;</span> <span class="dv">1400</span> <span class="op">?</span> <span class="op">-</span><span class="dv">60</span> <span class="op">:</span> width <span class="op">&lt;</span> <span class="dv">1450</span> <span class="op">?</span> <span class="op">-</span><span class="dv">62</span> <span class="op">:</span> <span class="op">-</span><span class="dv">76</span><span class="sc">}</span><span class="vs">)`</span>)<span class="op">;</span></span>
<span id="cb10-461"><a href="#cb10-461" aria-hidden="true" tabindex="-1"></a>  svg<span class="op">.</span><span class="fu">append</span>(<span class="st">"g"</span>)</span>
<span id="cb10-462"><a href="#cb10-462" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">"id"</span><span class="op">,</span> <span class="st">"solar-system"</span>)</span>
<span id="cb10-463"><a href="#cb10-463" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">"transform"</span><span class="op">,</span> <span class="vs">`translate(</span><span class="sc">${</span>margin<span class="op">.</span><span class="at">left</span> <span class="op">+</span> <span class="dv">12</span><span class="sc">}</span><span class="vs">, </span><span class="sc">${</span>margin<span class="op">.</span><span class="at">top</span> <span class="op">+</span> height <span class="op">/</span> <span class="fl">1.6</span> <span class="op">+</span> <span class="dv">6</span> <span class="op">+</span> <span class="dv">5</span> <span class="op">*</span> (width <span class="op">&lt;</span> <span class="dv">400</span>)<span class="sc">}</span><span class="vs">)`</span>)<span class="op">;</span></span>
<span id="cb10-464"><a href="#cb10-464" aria-hidden="true" tabindex="-1"></a>  <span class="co">// svg.append("g")</span></span>
<span id="cb10-465"><a href="#cb10-465" aria-hidden="true" tabindex="-1"></a>  <span class="co">//   .attr("id", "globe")</span></span>
<span id="cb10-466"><a href="#cb10-466" aria-hidden="true" tabindex="-1"></a>  <span class="co">//   .attr("transform", `translate(${margin.left + margin.inner + columnWidth / 2 + 20}, ${margin.top + height / 1.2 + 4})`);</span></span>
<span id="cb10-467"><a href="#cb10-467" aria-hidden="true" tabindex="-1"></a>  <span class="fu">setSelection</span>(selection<span class="op">,</span> <span class="kw">true</span>)<span class="op">;</span></span>
<span id="cb10-468"><a href="#cb10-468" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> handleDateHourChange <span class="op">=</span> ({ target<span class="op">,</span> <span class="dt">detail</span><span class="op">:</span> { date<span class="op">,</span> hour }}) <span class="kw">=&gt;</span> {</span>
<span id="cb10-469"><a href="#cb10-469" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> (date <span class="op">!=</span> <span class="kw">null</span> <span class="op">&amp;&amp;</span> hour <span class="op">!=</span> <span class="kw">null</span>) <span class="fu">setSelection</span>({<span class="op">...</span>selection<span class="op">,</span> date<span class="op">,</span> hour})<span class="op">;</span></span>
<span id="cb10-470"><a href="#cb10-470" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb10-471"><a href="#cb10-471" aria-hidden="true" tabindex="-1"></a>  svg<span class="op">.</span><span class="fu">node</span>()<span class="op">.</span><span class="fu">addEventListener</span>(EventType<span class="op">.</span><span class="at">DateHourChange</span><span class="op">,</span> handleDateHourChange<span class="op">,</span> <span class="kw">false</span>)<span class="op">;</span></span>
<span id="cb10-472"><a href="#cb10-472" aria-hidden="true" tabindex="-1"></a>  <span class="cf">return</span> svg<span class="op">.</span><span class="fu">node</span>()<span class="op">;</span></span>
<span id="cb10-473"><a href="#cb10-473" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-display">
<div id="ojs-cell-10" data-nodetype="declaration">

</div>
</div>
</div>
</div>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb11" data-startfrom="478" data-source-offset="0"><pre class="sourceCode js code-with-copy"><code class="sourceCode javascript" style="counter-reset: source-line 477;"><span id="cb11-478"><a href="#cb11-478" aria-hidden="true" tabindex="-1"></a>width</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-display">
<div id="ojs-cell-11" data-nodetype="expression">

</div>
</div>
</div>
</section><section id="yda" class="level5 hiddenheading"><h5 class="hiddenheading anchored" data-anchor-id="yda">Yearly day aggregate (yda)</h5>
<p>The red<font color="red">—</font>line indicates a “day of year” (<span class="tool" data-bs-toggle="tooltip" data-bs-title="day of year">doy</span>), <span><span id="ojs-element-id-4"></span>,</span> and the red🔴dot denotes a “time of day” (<span class="tool" data-bs-toggle="tooltip" data-bs-title="time of day">tod</span>): <span><span id="ojs-element-id-5"></span>.</span> A <span class="tool" data-bs-toggle="tooltip" data-bs-title="day of year">doy</span> identifies a day in a year like a <a href="https://en.wikipedia.org/wiki/Gregorian_calendar#:~:text=the%20calendar%20used%20in%20most%20parts%20of%20the%20world">Gregorian calendar</a> month and “day of month” (<span class="tool" data-bs-toggle="tooltip" data-bs-title="day of month">dom</span>). A <span class="tool" data-bs-toggle="tooltip" data-bs-title="time of day">tod</span> specifies a point in a day like an “hour minute second” (<span class="tool" data-bs-toggle="tooltip" data-bs-title="hour minute second">hms</span>) triplet. Together, a <span class="tool" data-bs-toggle="tooltip" data-bs-title="day of year">doy</span> and <span class="tool" data-bs-toggle="tooltip" data-bs-title="time of day">tod</span> can form a “yearly day aggregate” (<span class="tool" data-bs-toggle="tooltip" data-bs-title="yearly day aggregate">yda</span>): <span><span id="ojs-element-id-6"></span>.</span></p>
<p><span class="math display">\[\text{yda} = \text{doy} + \text{tod}\]</span></p>
<p><span class="math display">\[\lfloor\text{yda}\rfloor = \text{doy}\]</span></p>
<p><span class="math display">\[\text{yda} - \text{doy} = \text{tod}\]</span></p>
<p>As their names suggest, <span class="tool" data-bs-toggle="tooltip" data-bs-title="days of year">doys</span> and <span class="tool" data-bs-toggle="tooltip" data-bs-title="yearly day aggregates">ydas</span> are measured in days. The <a href="https://en.wikipedia.org/wiki/Unit_of_measurement#:~:text=a%20definite%20magnitude%20of%20a%20quantity">measurement unit</a> of a <span class="tool" data-bs-toggle="tooltip" data-bs-title="time of day">tod</span> can be a day or a <a href="https://en.wikipedia.org/wiki/Multiple_%28mathematics%29#Submultiple:~:text=of%20%22a%20being-,a%20unit%20fraction,-of%20b%22%20">submultiple</a> of a day. By changing how a decimal <span class="tool" data-bs-toggle="tooltip" data-bs-title="time of day">tod</span> is measured, we can shift its <a href="https://en.wikipedia.org/wiki/Decimal_separator#:~:text=a%20symbol%20that%20separates%20the%20integer%20part%20from%20the%20fractional%20part%20of%20a%20number">decimal separator</a> or turn it into an integer. The <span class="tool" data-bs-toggle="tooltip" data-bs-title="times of day">tods</span> along the y-axis of the area chart are integers because they have three digits and are measured in <span class="tool" data-bs-toggle="tooltip" data-bs-title="thousandths of a day">millidays</span>.</p>
</section><section id="eda" class="level5 hiddenheading"><h5 class="hiddenheading anchored" data-anchor-id="eda">Epochal day aggregate (eda)</h5>
<p>We can replace an <span class="tool" data-bs-toggle="tooltip" data-bs-title="yearly day aggregate">yda</span> with a <span class="tool" data-bs-toggle="tooltip" data-bs-title="time of day">tod</span> by <a href="https://en.wikipedia.org/wiki/Modulo#:~:text=returns%20the%20remainder">keeping the remainder after dividing</a> by one to isolate the <a href="https://en.wikipedia.org/wiki/Fractional_part#:~:text=the%20excess%20beyond%20that%20number%27s%20integer%20part">decimal part</a> of the <a href="https://en.wikipedia.org/wiki/Quotient#:~:text=a%20quantity%20produced%20by%20the%20division%20of%20two%20numbers">quotient</a>: <span><span id="ojs-element-id-7"></span></span> <a href="https://en.wikipedia.org/wiki/Modulo#:~:text=returns%20the%20remainder">mod</a> 1 = <span><span id="ojs-element-id-8"></span>.</span> We can use this same approach to obtain a <span class="tool" data-bs-toggle="tooltip" data-bs-title="time of day">tod</span> from an “epochal day aggregate” (<span class="tool" data-bs-toggle="tooltip" data-bs-title="epochal day aggregate">eda</span>): <span><span id="ojs-element-id-9"></span></span> mod 1 = <span><span id="ojs-element-id-10"></span>.</span> The current <span class="tool" data-bs-toggle="tooltip" data-bs-title="epochal day aggregate">eda</span> tells us how many days have passed since the Dec <a href="https://en.wikipedia.org/wiki/Epoch#:~:text=an%20instant%20in%20time%20chosen%20as%20the%20origin%20of%20a%20particular%20calendar%20era">epoch</a>.</p>
<p><span class="math display">\[\text{tod} = \text{yda mod } 1 = \text{eda mod } 1\]</span></p>
</section><section id="ute" class="level5 hiddenheading"><h5 class="hiddenheading anchored" data-anchor-id="ute">UNIX time equation</h5>
<p>Similarly, <a href="https://en.wikipedia.org/wiki/Unix_time#:~:text=the%20number%20of%20non%2Dleap%20seconds%20that%20have%20elapsed%20since%2000%3A00%3A00%20UTC%20on%201%C2%A0January%201970%2C%20the%20Unix%20epoch">UNIX time</a> tallies the seconds since the <a href="https://en.wikipedia.org/wiki/Unix_time#:~:text=00%3A00%3A00%20UTC%20on%201%C2%A0January%201970">UNIX epoch</a>, which is exactly 719468 days after the Dec epoch. To get the <span class="tool" data-bs-toggle="tooltip" data-bs-title="time of day">tod</span> in Zone <span class="color0">0</span>, the Dec time zone that is in between the two leftmost vertical lines on the map🗺️, we can divide UNIX time by the <a href="https://en.wikipedia.org/wiki/Day#:~:text=average%2C%20this%20is-,24%20hours%20(86%2C400%20seconds),-.%20As%20a%20day">number of seconds in a day</a> and then keep the remainder after dividing the resulting days by one:</p>
<p><span class="math display">\[\text{tod} = \text{unix} \div 86400 \text{ mod } 1\]</span></p>
</section><section id="jte" class="level5 hiddenheading"><h5 class="hiddenheading anchored" data-anchor-id="jte">Julian time equation</h5>
<p><a href="https://en.wikipedia.org/wiki/Julian_day#:~:text=the%20Julian%20day%20number%20plus%20the%20fraction%20of%20a%20day%20since%20the%20preceding%20noon">Julian dates</a> track the days since the beginning of the <a href="https://en.wikipedia.org/wiki/Julian_day#:~:text=a%20chronological%20interval%20of%207980%C2%A0years%2C%20derived%20from%20three%20multi%2Dyear%20cycles:%20the%20Indiction%2C%20Solar%2C%20and%20Lunar%20cycles">Julian period</a> and thus are akin to <span class="tool" data-bs-toggle="tooltip" data-bs-title="epochal day aggregates">edas</span>. We can produce a Zone <span class="color5">5</span> <span class="tool" data-bs-toggle="tooltip" data-bs-title="time of day">tod</span> from a <a href="https://en.wikipedia.org/wiki/Julian_day#:~:text=the%20Julian%20day%20number%20plus%20the%20fraction%20of%20a%20day%20since%20the%20preceding%20noon">Julian date</a> simply by keeping the remainder after dividing by one. If we want a Zone <span class="color0">0</span> <span class="tool" data-bs-toggle="tooltip" data-bs-title="time of day">tod</span> instead, we should add <span class="color5">5</span> <span class="tool" data-bs-toggle="tooltip" data-bs-title="tenths of a day">decidays</span> to the Julian date before converting it to a <span class="tool" data-bs-toggle="tooltip" data-bs-title="time of day">tod</span> to ensure that the final result is less than one day:</p>
<p><span class="math display">\[\text{tod} = (\text{julian} + 0.5) \text{ mod } 1\]</span></p>
</section><section id="hms" class="level5 hiddenheading"><h5 class="hiddenheading anchored" data-anchor-id="hms">Hour minute second</h5>
<p>We can also obtain a Zone <span class="color0">0</span> <span class="tool" data-bs-toggle="tooltip" data-bs-title="time of day">tod</span> from a <a href="https://en.wikipedia.org/wiki/Coordinated_Universal_Time#:~:text=the%20primary%20time%20standard%20globally%20used%20to%20regulate%20clocks%20and%20time">Coordinated Universal Time</a> (<span class="tool" data-bs-toggle="tooltip" data-bs-title="Coordinated Universal Time">UTC</span>) <span class="tool" data-bs-toggle="tooltip" data-bs-title="hour minute second">hms</span> triplet by summing its components after converting them to fractional days, as shown in the equation below. The <a href="https://en.wikipedia.org/wiki/Computer_programming#:~:text=the%20composition%20of%20sequences%20of%20instructions%2C%20called%20programs%2C%20that%20computers%20can%20follow%20to%20perform%20tasks">computer programming</a> code in the <a href="https://quarto.org/docs/interactive/layout.html#tabset-panel">tabset panel</a> beneath the equation compares <span class="tool" data-bs-toggle="tooltip" data-bs-title="times of day">tods</span> derived from <span class="tool" data-bs-toggle="tooltip" data-bs-title="Coordinated Universal Time">UTC</span> and UNIX time as Quarto was <a href="https://quarto.org/docs/get-started/hello/rstudio.html#rendering:~:text=When%20rendering%2C%20Quarto%20generates%20a%20new%20file%20that%20contains%20selected%20text%2C%20code%2C%20and%20results">rendering</a> this webpage.</p>
<p><span class="math display">\[\text{tod} = \frac{\text{hour}}{24} + \frac{\text{minute}}{1440} + \frac{\text{second}}{86400}\]</span></p>
<div class="tabset-margin-container"></div><div class="panel-tabset" data-group="language">
<ul class="nav nav-tabs" role="tablist">
<li class="nav-item" role="presentation"><a class="nav-link active" id="tabset-1-1-tab" data-bs-toggle="tab" data-bs-target="#tabset-1-1" role="tab" aria-controls="tabset-1-1" aria-selected="true" href="">Julia</a></li>
<li class="nav-item" role="presentation"><a class="nav-link" id="tabset-1-2-tab" data-bs-toggle="tab" data-bs-target="#tabset-1-2" role="tab" aria-controls="tabset-1-2" aria-selected="false" href="">Observable JavaScript</a></li>
<li class="nav-item" role="presentation"><a class="nav-link" id="tabset-1-3-tab" data-bs-toggle="tab" data-bs-target="#tabset-1-3" role="tab" aria-controls="tabset-1-3" aria-selected="false" href="">Python</a></li>
<li class="nav-item" role="presentation"><a class="nav-link" id="tabset-1-4-tab" data-bs-toggle="tab" data-bs-target="#tabset-1-4" role="tab" aria-controls="tabset-1-4" aria-selected="false" href="">R</a></li>
</ul>
<div class="tab-content" data-group="language">
<div id="tabset-1-1" class="tab-pane active" role="tabpanel" aria-labelledby="tabset-1-1-tab">
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb12"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb12-1"><a href="#cb12-1" aria-hidden="true" tabindex="-1"></a><span class="im">using</span> <span class="bu">Dates</span></span>
<span id="cb12-2"><a href="#cb12-2" aria-hidden="true" tabindex="-1"></a>hms <span class="op">=</span> <span class="fu">now</span>(UTC)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>2025-09-30T17:01:16.868</code></pre>
</div>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb14"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb14-1"><a href="#cb14-1" aria-hidden="true" tabindex="-1"></a><span class="fu">hour</span>(hms) <span class="op">/</span> <span class="fl">24</span> <span class="op">+</span></span>
<span id="cb14-2"><a href="#cb14-2" aria-hidden="true" tabindex="-1"></a><span class="fu">minute</span>(hms) <span class="op">/</span> <span class="fl">1440</span> <span class="op">+</span></span>
<span id="cb14-3"><a href="#cb14-3" aria-hidden="true" tabindex="-1"></a><span class="fu">second</span>(hms) <span class="op">/</span> <span class="fl">86400</span> <span class="op">+</span></span>
<span id="cb14-4"><a href="#cb14-4" aria-hidden="true" tabindex="-1"></a><span class="fu">millisecond</span>(hms) <span class="op">/</span> <span class="fl">864e5</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>0.7092230092592593</code></pre>
</div>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb16"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb16-1"><a href="#cb16-1" aria-hidden="true" tabindex="-1"></a><span class="fu">datetime2unix</span>(hms) <span class="op">/</span> <span class="fl">86400</span> <span class="op">%</span> <span class="fl">1</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>0.7092230092603131</code></pre>
</div>
</div>
</div>
<div id="tabset-1-2" class="tab-pane" role="tabpanel" aria-labelledby="tabset-1-2-tab">
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb18" data-startfrom="535" data-source-offset="-0"><pre class="sourceCode js code-with-copy"><code class="sourceCode javascript" style="counter-reset: source-line 534;"><span id="cb18-535"><a href="#cb18-535" aria-hidden="true" tabindex="-1"></a>hms <span class="op">=</span> <span class="kw">new</span> <span class="bu">Date</span>()<span class="op">;</span></span>
<span id="cb18-536"><a href="#cb18-536" aria-hidden="true" tabindex="-1"></a>hms<span class="op">.</span><span class="fu">getUTCHours</span>() <span class="op">/</span> <span class="dv">24</span> <span class="op">+</span></span>
<span id="cb18-537"><a href="#cb18-537" aria-hidden="true" tabindex="-1"></a>hms<span class="op">.</span><span class="fu">getUTCMinutes</span>() <span class="op">/</span> <span class="dv">1440</span> <span class="op">+</span></span>
<span id="cb18-538"><a href="#cb18-538" aria-hidden="true" tabindex="-1"></a>hms<span class="op">.</span><span class="fu">getUTCSeconds</span>() <span class="op">/</span> <span class="dv">86400</span> <span class="op">+</span></span>
<span id="cb18-539"><a href="#cb18-539" aria-hidden="true" tabindex="-1"></a>hms<span class="op">.</span><span class="fu">getUTCMilliseconds</span>() <span class="op">/</span> <span class="fl">864e5</span><span class="op">;</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-display">
<div>
<div id="ojs-cell-12-1" data-nodetype="declaration">

</div>
</div>
</div>
<div class="cell-output cell-output-display">
<div>
<div id="ojs-cell-12-2" data-nodetype="expression">

</div>
</div>
</div>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb19" data-startfrom="540" data-source-offset="-136"><pre class="sourceCode js code-with-copy"><code class="sourceCode javascript" style="counter-reset: source-line 539;"><span id="cb19-540"><a href="#cb19-540" aria-hidden="true" tabindex="-1"></a>hms<span class="op">.</span><span class="fu">getTime</span>() <span class="op">/</span> <span class="fl">864e5</span> <span class="op">%</span> <span class="dv">1</span><span class="op">;</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-display">
<div>
<div id="ojs-cell-12-3" data-nodetype="expression">

</div>
</div>
</div>
</div>
</div>
<div id="tabset-1-3" class="tab-pane" role="tabpanel" aria-labelledby="tabset-1-3-tab">
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb20"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb20-1"><a href="#cb20-1" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> datetime <span class="im">import</span> datetime, timezone</span>
<span id="cb20-2"><a href="#cb20-2" aria-hidden="true" tabindex="-1"></a>hms <span class="op">=</span> datetime.now(timezone.utc)</span>
<span id="cb20-3"><a href="#cb20-3" aria-hidden="true" tabindex="-1"></a>hms.hour <span class="op">/</span> <span class="dv">24</span> <span class="op">+</span> <span class="op">\</span></span>
<span id="cb20-4"><a href="#cb20-4" aria-hidden="true" tabindex="-1"></a>hms.minute <span class="op">/</span> <span class="dv">1440</span> <span class="op">+</span> <span class="op">\</span></span>
<span id="cb20-5"><a href="#cb20-5" aria-hidden="true" tabindex="-1"></a>hms.second <span class="op">/</span> <span class="dv">86400</span> <span class="op">+</span> <span class="op">\</span></span>
<span id="cb20-6"><a href="#cb20-6" aria-hidden="true" tabindex="-1"></a>hms.microsecond <span class="op">/</span> <span class="fl">864e8</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>0.7092467462731482</code></pre>
</div>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb22"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb22-1"><a href="#cb22-1" aria-hidden="true" tabindex="-1"></a>hms.timestamp() <span class="op">/</span> <span class="dv">86400</span> <span class="op">%</span> <span class="dv">1</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>0.709246746275312</code></pre>
</div>
</div>
</div>
<div id="tabset-1-4" class="tab-pane" role="tabpanel" aria-labelledby="tabset-1-4-tab">
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb24"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">hms</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/as.POSIXlt.html">as.POSIXlt</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/Sys.time.html">Sys.time</a></span><span class="op">(</span><span class="op">)</span>, tz <span class="op">=</span> <span class="st">"UTC"</span><span class="op">)</span></span>
<span><span class="va">hms</span><span class="op">$</span><span class="va">hour</span> <span class="op">/</span> <span class="fl">24</span> <span class="op">+</span></span>
<span><span class="va">hms</span><span class="op">$</span><span class="va">min</span> <span class="op">/</span> <span class="fl">1440</span> <span class="op">+</span></span>
<span><span class="va">hms</span><span class="op">$</span><span class="va">sec</span> <span class="op">/</span> <span class="fl">86400</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 0.7092469</code></pre>
</div>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb26"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/numeric.html">as.numeric</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/as.POSIXlt.html">as.POSIXct</a></span><span class="op">(</span><span class="va">hms</span><span class="op">)</span><span class="op">)</span> <span class="op">/</span> <span class="fl">86400</span><span class="op">)</span> <span class="op"><a href="https://rdrr.io/r/base/Arithmetic.html">%%</a></span> <span class="fl">1</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 0.7092469</code></pre>
</div>
</div>
</div>
</div>
</div>
<p>The equations below convert UNIX time or a Zone <span class="color0">0</span> <span class="tool" data-bs-toggle="tooltip" data-bs-title="time of day">tod</span> into the three components of an <span class="tool" data-bs-toggle="tooltip" data-bs-title="hour minute second">hms</span> triplet: the “hour of day” (<span class="tool" data-bs-toggle="tooltip" data-bs-title="hour of day">hod</span>), “minute of hour” (<span class="tool" data-bs-toggle="tooltip" data-bs-title="minute of hour">moh</span>), and “second of minute” (<span class="tool" data-bs-toggle="tooltip" data-bs-title="second of minute">som</span>), using a “daily second aggregate” (<span class="tool" data-bs-toggle="tooltip" data-bs-title="daily second aggregate">dsa</span>) and “hourly second aggregate” (<span class="tool" data-bs-toggle="tooltip" data-bs-title="hourly second aggregate">hsa</span>). While both count seconds, <span class="tool" data-bs-toggle="tooltip" data-bs-title="daily second aggregates">dsas</span> start at midnight and <span class="tool" data-bs-toggle="tooltip" data-bs-title="hourly second aggregates">hsas</span> begin at the <a href="https://en.wiktionary.org/wiki/top_of_the_hour">top of the hour</a>.</p>
<p><span class="math display">\[\text{dsa} = \text{tod} \times 86400 = \text{unix mod } 86400\]</span></p>
<p><span class="math display">\[\text{hsa} = \text{dsa mod } 3600\]</span></p>
<p><span class="math display">\[\text{hod} = \lfloor \text{dsa} \div 3600 \rfloor\]</span></p>
<p><span class="math display">\[\text{moh} = \lfloor \text{hsa} \div 60 \rfloor\]</span></p>
<p><span class="math display">\[\text{som} = \lfloor \text{hsa mod } 60 \rfloor\]</span></p>
<div class="tabset-margin-container"></div><div class="panel-tabset" data-group="language">
<ul class="nav nav-tabs" role="tablist">
<li class="nav-item" role="presentation"><a class="nav-link active" id="tabset-2-1-tab" data-bs-toggle="tab" data-bs-target="#tabset-2-1" role="tab" aria-controls="tabset-2-1" aria-selected="true" href="">Julia</a></li>
<li class="nav-item" role="presentation"><a class="nav-link" id="tabset-2-2-tab" data-bs-toggle="tab" data-bs-target="#tabset-2-2" role="tab" aria-controls="tabset-2-2" aria-selected="false" href="">Observable JavaScript</a></li>
<li class="nav-item" role="presentation"><a class="nav-link" id="tabset-2-3-tab" data-bs-toggle="tab" data-bs-target="#tabset-2-3" role="tab" aria-controls="tabset-2-3" aria-selected="false" href="">Python</a></li>
<li class="nav-item" role="presentation"><a class="nav-link" id="tabset-2-4-tab" data-bs-toggle="tab" data-bs-target="#tabset-2-4" role="tab" aria-controls="tabset-2-4" aria-selected="false" href="">R</a></li>
</ul>
<div class="tab-content" data-group="language">
<div id="tabset-2-1" class="tab-pane active" role="tabpanel" aria-labelledby="tabset-2-1-tab">
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb28"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb28-1"><a href="#cb28-1" aria-hidden="true" tabindex="-1"></a><span class="im">using</span> <span class="bu">Dates</span></span>
<span id="cb28-2"><a href="#cb28-2" aria-hidden="true" tabindex="-1"></a>dsa <span class="op">=</span> <span class="fu">datetime2unix</span>(<span class="fu">now</span>(UTC)) <span class="op">/</span> <span class="fl">86400</span> <span class="op">%</span> <span class="fl">1</span> <span class="op">*</span> <span class="fl">86400</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>61278.98499977309</code></pre>
</div>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb30"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb30-1"><a href="#cb30-1" aria-hidden="true" tabindex="-1"></a>hsa <span class="op">=</span> dsa <span class="op">%</span> <span class="fl">3600</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>78.98499977309257</code></pre>
</div>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb32"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb32-1"><a href="#cb32-1" aria-hidden="true" tabindex="-1"></a><span class="fu">map</span>(x <span class="op">-&gt;</span> <span class="fu">floor</span>(<span class="dt">Int</span>, x), (dsa <span class="op">/</span> <span class="fl">3600</span>, hsa <span class="op">/</span> <span class="fl">60</span>, hsa <span class="op">%</span> <span class="fl">60</span>))</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>(17, 1, 18)</code></pre>
</div>
</div>
</div>
<div id="tabset-2-2" class="tab-pane" role="tabpanel" aria-labelledby="tabset-2-2-tab">
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb34" data-startfrom="592" data-source-offset="-0"><pre class="sourceCode js code-with-copy"><code class="sourceCode javascript" style="counter-reset: source-line 591;"><span id="cb34-592"><a href="#cb34-592" aria-hidden="true" tabindex="-1"></a>dsa <span class="op">=</span> <span class="bu">Date</span><span class="op">.</span><span class="fu">now</span>() <span class="op">/</span> <span class="fl">864e5</span> <span class="op">%</span> <span class="dv">1</span> <span class="op">*</span> <span class="dv">86400</span><span class="op">;</span></span>
<span id="cb34-593"><a href="#cb34-593" aria-hidden="true" tabindex="-1"></a>hsa <span class="op">=</span> dsa <span class="op">%</span> <span class="dv">3600</span><span class="op">;</span></span>
<span id="cb34-594"><a href="#cb34-594" aria-hidden="true" tabindex="-1"></a>[dsa <span class="op">/</span> <span class="dv">3600</span><span class="op">,</span> hsa <span class="op">/</span> <span class="dv">60</span><span class="op">,</span> hsa <span class="op">%</span> <span class="dv">60</span>]<span class="op">.</span><span class="fu">map</span>(<span class="bu">Math</span><span class="op">.</span><span class="fu">floor</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-display">
<div>
<div id="ojs-cell-13-1" data-nodetype="declaration">

</div>
</div>
</div>
<div class="cell-output cell-output-display">
<div>
<div id="ojs-cell-13-2" data-nodetype="declaration">

</div>
</div>
</div>
<div class="cell-output cell-output-display">
<div>
<div id="ojs-cell-13-3" data-nodetype="expression">

</div>
</div>
</div>
</div>
</div>
<div id="tabset-2-3" class="tab-pane" role="tabpanel" aria-labelledby="tabset-2-3-tab">
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb35"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb35-1"><a href="#cb35-1" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> datetime <span class="im">import</span> datetime, timezone</span>
<span id="cb35-2"><a href="#cb35-2" aria-hidden="true" tabindex="-1"></a>dsa <span class="op">=</span> datetime.now(timezone.utc).timestamp() <span class="op">/</span> <span class="dv">86400</span> <span class="op">%</span> <span class="dv">1</span> <span class="op">*</span> <span class="dv">86400</span></span>
<span id="cb35-3"><a href="#cb35-3" aria-hidden="true" tabindex="-1"></a>hsa <span class="op">=</span> dsa <span class="op">%</span> <span class="dv">3600</span></span>
<span id="cb35-4"><a href="#cb35-4" aria-hidden="true" tabindex="-1"></a><span class="bu">tuple</span>(<span class="bu">map</span>(<span class="bu">int</span>, [dsa <span class="op">//</span> <span class="dv">3600</span>, hsa <span class="op">//</span> <span class="dv">60</span>, hsa <span class="op">%</span> <span class="dv">60</span> <span class="op">//</span> <span class="dv">1</span>]))</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>(19, 18, 27)</code></pre>
</div>
</div>
</div>
<div id="tabset-2-4" class="tab-pane" role="tabpanel" aria-labelledby="tabset-2-4-tab">
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb37"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">dsa</span> <span class="op">&lt;-</span> <span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/numeric.html">as.numeric</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/as.POSIXlt.html">as.POSIXct</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/Sys.time.html">Sys.time</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span><span class="op">)</span> <span class="op">/</span> <span class="fl">86400</span><span class="op">)</span> <span class="op"><a href="https://rdrr.io/r/base/Arithmetic.html">%%</a></span> <span class="fl">1</span> <span class="op">*</span> <span class="fl">86400</span></span>
<span><span class="va">hsa</span> <span class="op">&lt;-</span> <span class="va">dsa</span> <span class="op"><a href="https://rdrr.io/r/base/Arithmetic.html">%%</a></span> <span class="fl">3600</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/lapply.html">sapply</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="va">dsa</span> <span class="op"><a href="https://rdrr.io/r/base/Arithmetic.html">%/%</a></span> <span class="fl">3600</span>, <span class="va">hsa</span> <span class="op"><a href="https://rdrr.io/r/base/Arithmetic.html">%/%</a></span> <span class="fl">60</span>, <span class="va">hsa</span> <span class="op"><a href="https://rdrr.io/r/base/Arithmetic.html">%%</a></span> <span class="fl">60</span><span class="op">)</span>, <span class="va">as.integer</span><span class="op">)</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 19 18 27</code></pre>
</div>
</div>
</div>
</div>
</div>
</section><section id="uto" class="level5 hiddenheading"><h5 class="hiddenheading anchored" data-anchor-id="uto">Universal time offset</h5>
<p>The <a href="https://en.wikipedia.org/wiki/Global_Positioning_System#:~:text=a%20satellite%2Dbased%20hyperbolic%20navigation%20system">Global Positioning System</a>, <a href="https://en.wikipedia.org/wiki/BeiDou#:~:text=a%20satellite%2Dbased%20radio%20navigation%20system">BeiDou</a>, and <a href="https://en.wikipedia.org/wiki/Galileo_(satellite_navigation)#:~:text=a%20global%20navigation%20satellite%20system%20(GNSS)%20created%20by%20the%20European%20Union">Galileo</a> <a href="https://en.wikipedia.org/wiki/Satellite_navigation#:~:text=a%20satellite%20navigation%20system%20with%20global%20coverage">global navigation satellite systems</a> along with most — if not all — <a href="https://en.wikipedia.org/wiki/Programming_language#:~:text=a%20system%20of%20notation%20for%20writing%20source%20code%20such%20as%20used%20to%20produce%20a%20computer%20program">programming languages</a> do not account for <a href="https://en.wikipedia.org/wiki/Leap_second#:~:text=one%2Dsecond%20adjustment">leap seconds</a>, which appears to be for the best given that leap seconds will be <a href="https://en.wikipedia.org/wiki/Leap_second#:~:text=at%20the%2027th%20General%20Conference%20on%20Weights%20and%20Measures%2C%20it%20was%20decided%20to%20abandon%20the%20leap%20second%20by%20or%20before%202035">abolished by 2035</a>. The goal of leap seconds is to keep <span class="tool" data-bs-toggle="tooltip" data-bs-title="Coordinated Universal Time">UTC</span> within <a href="https://en.wikipedia.org/wiki/Leap_second#:~:text=to%20ensure%20that%20the%20difference%20between%20the%20UTC%20and%20UT1%20readings%20will%20never%20exceed%200.9%20seconds">25/24</a> <span class="tool" data-bs-toggle="tooltip" data-bs-title="hundred thousands of a day">centimillidays</span> (<span class="tool" data-bs-toggle="tooltip" data-bs-title="centimillidays">cmds</span>) of <a href="https://en.wikipedia.org/wiki/Universal_Time#Versions:~:text=a%20time%20standard%20based%20on%20Earth%27s%20rotation">Universal Time</a> (<span class="tool" data-bs-toggle="tooltip" data-bs-title="Universal Time">UT</span>).</p>
<p>Instead of leap seconds, Dec matches <span class="tool" data-bs-toggle="tooltip" data-bs-title="Universal Time">UT</span> using a “<a href="https://en.wikipedia.org/wiki/UTC_offset#:~:text=the%20difference%20in%20hours%20and%20minutes%20between%20Coordinated%20Universal%20Time%20(UTC)%20and%20the%20standard%20time%20at%20a%20particular%20place">universal time offset</a>” (<span class="tool" data-bs-toggle="tooltip" data-bs-title="universal time offset">uto</span>). With the <a href="https://en.wikipedia.org/wiki/Leap_second#:~:text=Announced%20leap%20seconds%20to%20date">leap second insertion dates</a> provided by the <a href="https://en.wikipedia.org/wiki/International_Earth_Rotation_and_Reference_Systems_Service#:~:text=the%20body%20responsible%20for%20maintaining%20global%20time%20and%20reference%20frame%20standards">International Earth Rotation and Reference Systems Service</a>, we can approximate the <span class="tool" data-bs-toggle="tooltip" data-bs-title="universal time offset">uto</span> that yields <span class="tool" data-bs-toggle="tooltip" data-bs-title="Universal Time">UT</span> when added to the Zone <span class="color0">0</span> <span class="tool" data-bs-toggle="tooltip" data-bs-title="time of day">tod</span> on the <a href="../../dec/date">Dec date</a> chosen by the <a href="https://observablehq.com/framework/inputs/range">range</a>🎚️inputs below: <span><span id="ojs-element-id-11"></span></span> ÷ 8640 = <span><span id="ojs-element-id-12"></span>.</span></p>
<div id="dateinput" class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code hidden" id="cb39" data-startfrom="625" data-source-offset="-0"><pre class="sourceCode js code-with-copy"><code class="sourceCode javascript" style="counter-reset: source-line 624;"><span id="cb39-625"><a href="#cb39-625" aria-hidden="true" tabindex="-1"></a>viewof leapSecondYear <span class="op">=</span> Inputs<span class="op">.</span><span class="fu">range</span>([<span class="dv">1970</span><span class="op">,</span> <span class="dv">2020</span>]<span class="op">,</span> {<span class="dt">label</span><span class="op">:</span> <span class="st">"Year"</span><span class="op">,</span> <span class="dt">value</span><span class="op">:</span> <span class="dv">1995</span><span class="op">,</span> <span class="dt">step</span><span class="op">:</span> <span class="dv">1</span>})</span>
<span id="cb39-626"><a href="#cb39-626" aria-hidden="true" tabindex="-1"></a>viewof leapSecondDate <span class="op">=</span> Inputs<span class="op">.</span><span class="fu">range</span>([<span class="dv">0</span><span class="op">,</span> <span class="dv">365</span>]<span class="op">,</span> {<span class="dt">label</span><span class="op">:</span> <span class="st">"Day"</span><span class="op">,</span> <span class="dt">value</span><span class="op">:</span> <span class="dv">182</span><span class="op">,</span> <span class="dt">step</span><span class="op">:</span> <span class="dv">1</span>})</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-display">
<div id="dateinput-1">
<div id="ojs-cell-14-1" data-nodetype="declaration">

</div>
</div>
</div>
<div class="cell-output cell-output-display">
<div id="dateinput-2">
<div id="ojs-cell-14-2" data-nodetype="declaration">

</div>
</div>
</div>
</div>
</section><section id="rod" class="level5 hiddenheading"><h5 class="hiddenheading anchored" data-anchor-id="rod">Rounded offset decimal</h5>
<p>Of the twenty eight <span class="tool" data-bs-toggle="tooltip" data-bs-title="universal time offsets">utos</span> that can be shown in the equation above, one is an integer, one is a <a href="https://en.wikipedia.org/wiki/Repeating_decimal#:~:text=a%20finite%20number%20of%20nonzero%20digits">terminating decimal</a>, and the rest are <a href="https://en.wikipedia.org/wiki/Repeating_decimal#:~:text=the%20same%20sequence%20of%20digits%20is%20repeated%20forever">repeating decimals</a>. To express a repeating decimal <span class="tool" data-bs-toggle="tooltip" data-bs-title="universal time offset">uto</span>, Dec uses an <a href="https://en.wikipedia.org/wiki/Irreducible_fraction#:~:text=a%20fraction%20in%20which%20the%20numerator%20and%20denominator%20are%20integers%20that%20have%20no%20other%20common%20divisors%20than%201">irreducible fraction</a> that is called an “exact offset fraction” (<span class="tool" data-bs-toggle="tooltip" data-bs-title="exact offset fraction">eof</span>) when by itself or a “<a href="https://en.wikipedia.org/wiki/Round-off_error#:~:text=the%20difference%20between%20the%20result%20produced%20by%20a%20given%20algorithm%20using%20exact%20arithmetic%20and%20the%20result%20produced%20by%20the%20same%20algorithm%20using%20finite%2Dprecision%2C%20rounded%20arithmetic">rounding error</a> fraction” (<span class="tool" data-bs-toggle="tooltip" data-bs-title="roundoff error fraction">ref</span>) if it follows a “rounded offset decimal” (<span class="tool" data-bs-toggle="tooltip" data-bs-title="rounded offset decimal">rod</span>).</p>
<p>In the equation below, the <span class="tool" data-bs-toggle="tooltip" data-bs-title="universal time offset">uto</span> is the minuend, the <span class="tool" data-bs-toggle="tooltip" data-bs-title="rounded offset decimal">rod</span> is the subtrahend, and the <span class="tool" data-bs-toggle="tooltip" data-bs-title="roundoff error fraction">ref</span> is the difference. Dec uses the term minuend expansion to describe the replacement of a minuend with a subtrahend and a difference. By replacing a repeating decimal <span class="tool" data-bs-toggle="tooltip" data-bs-title="universal time offset">uto</span> with a <span class="tool" data-bs-toggle="tooltip" data-bs-title="rounded offset decimal">rod</span> and a <span class="tool" data-bs-toggle="tooltip" data-bs-title="roundoff error fraction">ref</span>, we can show the initial digits of the <span class="tool" data-bs-toggle="tooltip" data-bs-title="universal time offset">uto</span> as a decimal and the rest as a fraction.</p>
<p><span class="math display">\[\text{uto} - \text{rod} = \text{ref}\]</span></p>
<p>Use the first three range🎚️inputs below to select an <span class="tool" data-bs-toggle="tooltip" data-bs-title="hour minute second">hms</span> triplet to be converted to <span class="tool" data-bs-toggle="tooltip" data-bs-title="tenths of a day">decidays</span>, plugged into the equation above as the <span class="tool" data-bs-toggle="tooltip" data-bs-title="universal time offset">uto</span>, rounded to the number of digits chosen by the fourth range🎚️input, and inserted into the equation as the <span class="tool" data-bs-toggle="tooltip" data-bs-title="rounded offset decimal">rod</span>. Once the left-hand side of the equation is complete, we can solve it to get the <span class="tool" data-bs-toggle="tooltip" data-bs-title="roundoff error fraction">ref</span>: <span><span id="ojs-element-id-13"></span></span> – <span><span id="ojs-element-id-14"></span></span> = <span><span id="ojs-element-id-15"></span>.</span></p>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code hidden" id="cb40" data-startfrom="641" data-source-offset="0"><pre class="sourceCode js code-with-copy"><code class="sourceCode javascript" style="counter-reset: source-line 640;"><span id="cb40-641"><a href="#cb40-641" aria-hidden="true" tabindex="-1"></a>viewof hmsinput <span class="op">=</span> Inputs<span class="op">.</span><span class="fu">form</span>([</span>
<span id="cb40-642"><a href="#cb40-642" aria-hidden="true" tabindex="-1"></a>  Inputs<span class="op">.</span><span class="fu">range</span>([<span class="dv">0</span><span class="op">,</span> <span class="dv">23</span>]<span class="op">,</span> {<span class="dt">label</span><span class="op">:</span> <span class="st">"Hour"</span><span class="op">,</span> <span class="dt">value</span><span class="op">:</span> <span class="dv">11</span><span class="op">,</span> <span class="dt">step</span><span class="op">:</span> <span class="dv">1</span>})<span class="op">,</span></span>
<span id="cb40-643"><a href="#cb40-643" aria-hidden="true" tabindex="-1"></a>  Inputs<span class="op">.</span><span class="fu">range</span>([<span class="dv">0</span><span class="op">,</span> <span class="dv">59</span>]<span class="op">,</span> {<span class="dt">label</span><span class="op">:</span> <span class="st">"Minute"</span><span class="op">,</span> <span class="dt">value</span><span class="op">:</span> <span class="dv">0</span><span class="op">,</span> <span class="dt">step</span><span class="op">:</span> <span class="dv">1</span>})<span class="op">,</span></span>
<span id="cb40-644"><a href="#cb40-644" aria-hidden="true" tabindex="-1"></a>  Inputs<span class="op">.</span><span class="fu">range</span>([<span class="dv">0</span><span class="op">,</span> <span class="dv">59</span>]<span class="op">,</span> {<span class="dt">label</span><span class="op">:</span> <span class="st">"Second"</span><span class="op">,</span> <span class="dt">value</span><span class="op">:</span> <span class="dv">0</span><span class="op">,</span> <span class="dt">step</span><span class="op">:</span> <span class="dv">1</span>})<span class="op">,</span></span>
<span id="cb40-645"><a href="#cb40-645" aria-hidden="true" tabindex="-1"></a>])</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div id="hmsinput" class="cell-output cell-output-display">
<div id="ojs-cell-15" data-nodetype="declaration">

</div>
</div>
</div>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code hidden" id="cb41" data-startfrom="651" data-source-offset="0"><pre class="sourceCode js code-with-copy"><code class="sourceCode javascript" style="counter-reset: source-line 650;"><span id="cb41-651"><a href="#cb41-651" aria-hidden="true" tabindex="-1"></a>viewof digits <span class="op">=</span> Inputs<span class="op">.</span><span class="fu">range</span>([<span class="dv">1</span><span class="op">,</span> <span class="dv">9</span>]<span class="op">,</span> {<span class="dt">label</span><span class="op">:</span> <span class="st">"Digits"</span><span class="op">,</span> <span class="dt">value</span><span class="op">:</span> <span class="dv">3</span><span class="op">,</span> <span class="dt">step</span><span class="op">:</span> <span class="dv">1</span>})</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div id="diginput" class="cell-output cell-output-display">
<div id="ojs-cell-16" data-nodetype="declaration">

</div>
</div>
</div>
</section><section id="tzo" class="level4 hiddenheading"><h4 class="hiddenheading anchored" data-anchor-id="tzo">Time zone offset</h4>
<p>In Dec, a <span class="tool" data-bs-toggle="tooltip" data-bs-title="universal time offset">uto</span> can be any type of number, a “time zone offset” (<span class="tool" data-bs-toggle="tooltip" data-bs-title="time zone offset">tzo</span>) is an integer, a “solar time offset” (<span class="tool" data-bs-toggle="tooltip" data-bs-title="solar time offset">sto</span>) is a terminating decimal, and an <span class="tool" data-bs-toggle="tooltip" data-bs-title="exact offset fraction">eof</span> is a repeating decimal. If we derived <span class="tool" data-bs-toggle="tooltip" data-bs-title="a tenth of a day">deciday</span> offsets from all 86400 of the <span class="tool" data-bs-toggle="tooltip" data-bs-title="hour minute second">hms</span> triplets that can be selected by the range🎚️inputs above, we would have 10 <span class="tool" data-bs-toggle="tooltip" data-bs-title="time zone offsets">tzos</span>, 3190 <span class="tool" data-bs-toggle="tooltip" data-bs-title="solar time offsets">stos</span>, and 83200 <span class="tool" data-bs-toggle="tooltip" data-bs-title="exact offset fractions">eofs</span> or <span class="tool" data-bs-toggle="tooltip" data-bs-title="rounded offset decimal">rod</span> and <span class="tool" data-bs-toggle="tooltip" data-bs-title="roundoff error fraction">ref</span> pairs.</p>
<section id="utc" class="level5 hiddenheading"><h5 class="hiddenheading anchored" data-anchor-id="utc">Coordinated Universal Time (UTC)</h5>
<p>When we do the same to the <a href="https://en.wikipedia.org/wiki/List_of_UTC_offsets">38</a> <span class="tool" data-bs-toggle="tooltip" data-bs-title="Coordinated Universal Time">UTC</span> offsets, we get only <span class="tool" data-bs-toggle="tooltip" data-bs-title="exact offset fractions">eofs</span> or <span class="tool" data-bs-toggle="tooltip" data-bs-title="rounded offset decimal">rod</span> and <span class="tool" data-bs-toggle="tooltip" data-bs-title="roundoff error fraction">ref</span> pairs unless the number of leaps seconds included is zero or a multiple of 27. If the leap second count is zero or a multiple of 8640, we will get 3 <span class="tool" data-bs-toggle="tooltip" data-bs-title="time zone offsets">tzos</span>, 9 <span class="tool" data-bs-toggle="tooltip" data-bs-title="solar time offsets">stos</span>, and 26 <span class="tool" data-bs-toggle="tooltip" data-bs-title="exact offset fractions">eofs</span> or <span class="tool" data-bs-toggle="tooltip" data-bs-title="rounded offset decimal">rod</span> and <span class="tool" data-bs-toggle="tooltip" data-bs-title="roundoff error fraction">ref</span> pairs. The 3 <span class="tool" data-bs-toggle="tooltip" data-bs-title="time zone offsets">tzos</span> will be <span class="tool" data-bs-toggle="tooltip" data-bs-title="solar time offsets">stos</span> if the number of leap seconds is a multiple of 27 but not 8640.</p>
<p>There are 14 negative and 24 positive <span class="tool" data-bs-toggle="tooltip" data-bs-title="Coordinated Universal Time">UTC</span> offsets. The <span class="tool" data-bs-toggle="tooltip" data-bs-title="Coordinated Universal Time">UTC</span> time zone with <a href="https://en.wikipedia.org/wiki/UTC%E2%88%9212:00#:~:text=a%20nautical%20time%20zone%20comprising%20the%20high%20seas%20between%20180%C2%B0%20and%20172%C2%B030%E2%80%B2W%20longitude">the most negative offset</a> is completely uninhabited. The bar📊chart below visualizes <a href="https://www.earthdata.nasa.gov/centers/sedac-daac">Socioeconomic Data and Applications Center</a> data from 2020 regarding the population of each <span class="tool" data-bs-toggle="tooltip" data-bs-title="Coordinated Universal Time">UTC</span> time zone. The vast majority of all people live in <span class="tool" data-bs-toggle="tooltip" data-bs-title="Coordinated Universal Time">UTC</span> time zones with positive offsets.</p>
<div class="cell /togs">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code hidden" id="cb42" data-startfrom="668" data-source-offset="0"><pre class="sourceCode js code-with-copy"><code class="sourceCode javascript" style="counter-reset: source-line 667;"><span id="cb42-668"><a href="#cb42-668" aria-hidden="true" tabindex="-1"></a><span class="co">// https://observablehq.com/@mattdzugan/population-by-time-zone-creating-a-dataset</span></span>
<span id="cb42-669"><a href="#cb42-669" aria-hidden="true" tabindex="-1"></a>viewof sortParams <span class="op">=</span> Inputs<span class="op">.</span><span class="fu">form</span>([</span>
<span id="cb42-670"><a href="#cb42-670" aria-hidden="true" tabindex="-1"></a>  Inputs<span class="op">.</span><span class="fu">toggle</span>({ <span class="dt">label</span><span class="op">:</span> <span class="st">"Sort ascending"</span> })<span class="op">,</span></span>
<span id="cb42-671"><a href="#cb42-671" aria-hidden="true" tabindex="-1"></a>  Inputs<span class="op">.</span><span class="fu">toggle</span>({ <span class="dt">label</span><span class="op">:</span> <span class="st">"Sort by offset"</span> })<span class="op">,</span></span>
<span id="cb42-672"><a href="#cb42-672" aria-hidden="true" tabindex="-1"></a>  ])</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div id="timezonepoptoggles" class="cell-output cell-output-display">
<div id="ojs-cell-17" data-nodetype="declaration">

</div>
</div>
</div>
<div class="cell stackedBar">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code hidden" id="cb43" data-startfrom="679" data-source-offset="0"><pre class="sourceCode js code-with-copy"><code class="sourceCode javascript" style="counter-reset: source-line 678;"><span id="cb43-679"><a href="#cb43-679" aria-hidden="true" tabindex="-1"></a><span class="co">// https://observablehq.com/@mattdzugan/population-by-time-zone-creating-a-dataset</span></span>
<span id="cb43-680"><a href="#cb43-680" aria-hidden="true" tabindex="-1"></a>Plot<span class="op">.</span><span class="fu">plot</span>({</span>
<span id="cb43-681"><a href="#cb43-681" aria-hidden="true" tabindex="-1"></a>  <span class="dt">width</span><span class="op">:</span> width<span class="op">,</span></span>
<span id="cb43-682"><a href="#cb43-682" aria-hidden="true" tabindex="-1"></a>  <span class="dt">marginBottom</span><span class="op">:</span> <span class="dv">50</span><span class="op">,</span></span>
<span id="cb43-683"><a href="#cb43-683" aria-hidden="true" tabindex="-1"></a>  <span class="dt">style</span><span class="op">:</span> <span class="vs">`overflow: visible;font-size:16px;`</span><span class="op">,</span></span>
<span id="cb43-684"><a href="#cb43-684" aria-hidden="true" tabindex="-1"></a>  <span class="dt">color</span><span class="op">:</span> {<span class="dt">scheme</span><span class="op">:</span> <span class="st">"RdBu"</span><span class="op">,</span> <span class="dt">className</span><span class="op">:</span> <span class="st">"barPlotLegend"</span>}<span class="op">,</span></span>
<span id="cb43-685"><a href="#cb43-685" aria-hidden="true" tabindex="-1"></a>  <span class="dt">marginLeft</span><span class="op">:</span> <span class="dv">75</span><span class="op">,</span></span>
<span id="cb43-686"><a href="#cb43-686" aria-hidden="true" tabindex="-1"></a>  <span class="dt">y</span><span class="op">:</span> { <span class="dt">label</span><span class="op">:</span> <span class="kw">null</span> }<span class="op">,</span></span>
<span id="cb43-687"><a href="#cb43-687" aria-hidden="true" tabindex="-1"></a>  <span class="dt">x</span><span class="op">:</span> { <span class="dt">grid</span><span class="op">:</span> <span class="kw">true</span><span class="op">,</span> <span class="dt">label</span><span class="op">:</span> <span class="st">"Population (billions)"</span><span class="op">,</span> <span class="dt">labelOffset</span><span class="op">:</span> <span class="dv">38</span><span class="op">,</span> <span class="dt">transform</span><span class="op">:</span> d <span class="kw">=&gt;</span> d <span class="op">/</span> <span class="fl">1e9</span> }<span class="op">,</span></span>
<span id="cb43-688"><a href="#cb43-688" aria-hidden="true" tabindex="-1"></a>  <span class="dt">marks</span><span class="op">:</span> [</span>
<span id="cb43-689"><a href="#cb43-689" aria-hidden="true" tabindex="-1"></a>    Plot<span class="op">.</span><span class="fu">barX</span>(sortedPop<span class="op">,</span> {<span class="dt">x</span><span class="op">:</span> <span class="st">"pop"</span><span class="op">,</span> <span class="dt">y</span><span class="op">:</span> <span class="st">"Sign"</span><span class="op">,</span> <span class="dt">fill</span><span class="op">:</span> <span class="st">"Offset"</span><span class="op">,</span> <span class="dt">stroke</span><span class="op">:</span> <span class="st">"black"</span><span class="op">,</span> <span class="dt">tip</span><span class="op">:</span> <span class="kw">true</span> })<span class="op">,</span></span>
<span id="cb43-690"><a href="#cb43-690" aria-hidden="true" tabindex="-1"></a>  ]</span>
<span id="cb43-691"><a href="#cb43-691" aria-hidden="true" tabindex="-1"></a>})</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div id="timezonepopstackedbar" class="cell-output cell-output-display">
<div id="ojs-cell-18" data-nodetype="expression">

</div>
</div>
</div>
<p>Negative <span class="tool" data-bs-toggle="tooltip" data-bs-title="Coordinated Universal Time">UTC</span> offsets only exist in <a href="https://en.wikipedia.org/wiki/Americas#:~:text=a%20landmass%20comprising%20the%20totality%20of%20North%20America%20and%20South%20America">the Americas</a> and islands in the <a href="https://en.wikipedia.org/wiki/List_of_islands_in_the_Atlantic_Ocean">Atlantic</a> and <a href="https://en.wikipedia.org/wiki/List_of_islands_in_the_Pacific_Ocean">Pacific</a> Oceans. Therefore, the bar📊chart above is essentially comparing the Americas to the rest of the world. According to 2021 <a href="https://en.wikipedia.org/wiki/United_Nations_Department_of_Economic_and_Social_Affairs#:~:text=part%20of%20the%20United%20Nations%20Secretariat">United Nations Department of Economic and Social Affairs</a> data, about one billion out of a total of almost eight billion people live in the Americas.</p>
<p>Whenever a negative offset is associated with a Dec date, a <span class="tool" data-bs-toggle="tooltip" data-bs-title="time of day">tod</span>, or both a date and a <span class="tool" data-bs-toggle="tooltip" data-bs-title="time of day">tod</span>, Dec will add one day to the date and ten <span class="tool" data-bs-toggle="tooltip" data-bs-title="tenths of a day">decidays</span> to the offset without modifying the <span class="tool" data-bs-toggle="tooltip" data-bs-title="time of day">tod</span>. This typically occurs after the conversion of an <span class="tool" data-bs-toggle="tooltip" data-bs-title="hour minute second">hms</span> triplet to a <span class="tool" data-bs-toggle="tooltip" data-bs-title="time of day">tod</span> or a “year month day” (<span class="tool" data-bs-toggle="tooltip" data-bs-title="year month day">ymd</span>) triplet to a Dec date. As a result, all Dec dates and <span class="tool" data-bs-toggle="tooltip" data-bs-title="times of day">tods</span> have positive offsets.</p>
<p>Dec will not change a negative offset or its associated <span class="tool" data-bs-toggle="tooltip" data-bs-title="day of year">doy</span> if the result of adding one day to the <span class="tool" data-bs-toggle="tooltip" data-bs-title="day of year">doy</span> is uncertain. This uncertainly can only exist if we do not know whether a <span class="tool" data-bs-toggle="tooltip" data-bs-title="day of year">doy</span> that is equal to 364 belongs to a common or leap year. The day after Day <span class="tool" data-bs-toggle="tooltip" data-bs-title="February 28">364</span> of a common year is Day <span class="tool" data-bs-toggle="tooltip" data-bs-title="March 1">0</span> of the subsequent year. In a leap year, Day <span class="tool" data-bs-toggle="tooltip" data-bs-title="February 28">364</span> precedes Day <span class="tool" data-bs-toggle="tooltip" data-bs-title="February 29">365</span>.</p>
</section><section id="dow" class="level5 hiddenheading"><h5 class="hiddenheading anchored" data-anchor-id="dow">Day of week</h5>
<p>Even though it has no effect on the <span class="tool" data-bs-toggle="tooltip" data-bs-title="time of day">tod</span>, adding one day to the <span class="tool" data-bs-toggle="tooltip" data-bs-title="day of year">doy</span> also increments the “day of month” (<span class="tool" data-bs-toggle="tooltip" data-bs-title="day of month">dom</span>) and “day of week” (<span class="tool" data-bs-toggle="tooltip" data-bs-title="day of week">dow</span>) shown by Dec.&nbsp;The table below shows how someone accustomed to a negative offset could intrepret Dec <span class="tool" data-bs-toggle="tooltip" data-bs-title="day of week">dow</span> numbers. From the perspective of a negative offset user, the <span class="tool" data-bs-toggle="tooltip" data-bs-title="day of month">dom</span> and <span class="tool" data-bs-toggle="tooltip" data-bs-title="day of week">dow</span> in Dec will be one day ahead.</p>
<div class="overflowtable" style="overflow-x:auto;overflow-y:hidden;">
<table class="table">
<thead><tr class="header">
<th>Saturday</th>
<th>Sunday</th>
<th>Monday</th>
<th>Tuesday</th>
<th>Wednesday</th>
<th>Thursday</th>
<th>Friday</th>
</tr></thead>
<tbody>
<tr class="odd">
<td>0</td>
<td>1</td>
<td>2</td>
<td>3</td>
<td>4</td>
<td>5</td>
<td>6</td>
</tr>
<tr class="even">
<td>-7</td>
<td>-6</td>
<td>-5</td>
<td>-4</td>
<td>-3</td>
<td>-2</td>
<td>-1</td>
</tr>
</tbody>
</table>
</div>
<p>The one day difference between positive and negative offsets may make Dec <span class="tool" data-bs-toggle="tooltip" data-bs-title="day of week">dow</span> numbers more intuitive than <a href="https://pubs.opengroup.org/onlinepubs/007904875/utilities/date.html#:~:text=weekday%20as%20a%20decimal%20number%20%5B0%2C6%5D%20(0%3Dsunday)">POSIX</a> <span class="tool" data-bs-toggle="tooltip" data-bs-title="day of week">dow</span> numbers for people who consider <a href="https://en.wikipedia.org/wiki/Names_of_the_days_of_the_week#:~:text=Sunday%20comes%20first,-in%20order%20in">Sunday to be the first <span class="tool" data-bs-toggle="tooltip" data-bs-title="day of week">dow</span></a>. According to the <a href="https://en.wikipedia.org/wiki/Week#:~:text=World%20map%20showing%20the%20first%20day%20of%20the%20week%20used%20in%20different%20countries">Common Locale Data Repository</a> and a <a href="https://en.wikipedia.org/w/index.php?title=List_of_countries_in_the_Americas_by_population&amp;oldid=1310903194#Table">2023 population ranking</a>, over 89% of people in the Americas live in a country that starts the week on Sunday.</p>
</section><section id="lao" class="level5 hiddenheading"><h5 class="hiddenheading anchored" data-anchor-id="lao">Longitude and offsets</h5>
<p>In Dec, offsets are closely related to <a href="https://en.wikipedia.org/wiki/Longitude#:~:text=denoted%20by%20the%20Greek%20letter%20lambda">longitude</a>. Dec measures longitude in <a href="https://en.wikipedia.org/wiki/Circle_of_latitude#:~:text=an%20abstract%20east%E2%80%93west%20small%20circle%20connecting%20all%20locations%20around%20Earth%20(ignoring%20elevation)%20at%20a%20given%20latitude%20coordinate%20line">parallels</a> (<span class="tool" data-bs-toggle="tooltip" data-bs-title="parallel">λ</span>) or submultiples of <span class="tool" data-bs-toggle="tooltip" data-bs-title="parallels">λ</span> like <span class="tool" data-bs-toggle="tooltip" data-bs-title="a tenth of a parallel">deci<a href="https://en.wikipedia.org/wiki/Circle_of_latitude#:~:text=an%20abstract%20east%E2%80%93west%20small%20circle%20connecting%20all%20locations%20around%20Earth%20(ignoring%20elevation)%20at%20a%20given%20latitude%20coordinate%20line">parallels</a></span> (<span class="tool" data-bs-toggle="tooltip" data-bs-title="deciparallels">dλ</span>). A <span class="tool" data-bs-toggle="tooltip" data-bs-title="time zone offset">tzo</span> is essentially a <span class="tool" data-bs-toggle="tooltip" data-bs-title="deciparallel">dλ</span> longitude that had its decimal part removed via <a href="https://en.wikipedia.org/wiki/Rounding#:~:text=the%20process%20of%20adjusting%20a%20number%20to%20an%20approximate%2C%20more%20convenient%20value">rounding</a>, <a href="https://en.wikipedia.org/wiki/Floor_and_ceiling_functions#:~:text=takes%20as%20input%20a%20real%20number%20x%2C%20and%20gives%20as%20output%20the%20greatest%20integer%20less%20than%20or%20equal%20to%20x">flooring</a>, <a href="https://en.wikipedia.org/wiki/Truncation#Truncation_and_floor_function:~:text=truncation%20is%20limiting%20the%20number%20of%20digits%20right%20of%20the%20decimal%20point">truncation</a>, or <a href="https://en.wikipedia.org/wiki/Floor_and_ceiling_functions#:~:text=maps%20x%20to%20the%20least%20integer%20greater%20than%20or%20equal%20to%20x">ceiling</a>. Whereas <span class="tool" data-bs-toggle="tooltip" data-bs-title="time zone offsets">tzos</span> have one digit, <span class="tool" data-bs-toggle="tooltip" data-bs-title="a tenth of a day">deciday</span> <span class="tool" data-bs-toggle="tooltip" data-bs-title="times of day">tods</span> and <span class="tool" data-bs-toggle="tooltip" data-bs-title="solar time offsets">stos</span> typically have up to four digits after the <a href="https://en.wikipedia.org/wiki/Decimal_separator#:~:text=a%20symbol%20that%20separates%20the%20integer%20part%20from%20the%20fractional%20part%20of%20a%20number">decimal separator</a>.</p>
<p>The fourth digit in the decimal part of any current deciday <span class="tool" data-bs-toggle="tooltip" data-bs-title="time of day">tod</span> increments <span class="tool" data-bs-toggle="tooltip" data-bs-title="a hundred thousand">10<sup>5</sup></span> times per day, 100 times per <span class="tool" data-bs-toggle="tooltip" data-bs-title="a thousandth of a day">milliday</span>, or once per <span class="tool" data-bs-toggle="tooltip" data-bs-title="a hundred thousandth of a day">beat</span> (<span class="tool" data-bs-toggle="tooltip" data-bs-title="inverse of beat">iob</span>), which is the <a href="https://en.wikipedia.org/wiki/Upper_and_lower_bounds#:~:text=an%20element%20of%20K%20that%20is%20less%20than%20or%20equal%20to%20every%20element%20of%20S">lower bound</a> of the <a href="https://en.wikipedia.org/wiki/Heart_rate#:~:text=normal%20resting%20adult%20human%20heart%20rate%20is%2060%E2%80%93100%20bpm">normal resting heart rate</a> of an adult. For <a href="https://en.wikipedia.org/wiki/Everyday_life">everyday life</a>, we should limit the length of <span class="tool" data-bs-toggle="tooltip" data-bs-title="times of day">tods</span> to the three digits needed to show <span class="tool" data-bs-toggle="tooltip" data-bs-title="thousandths of a day">millidays</span> (<span class="tool" data-bs-toggle="tooltip" data-bs-title="millidays">md</span>) or the five digits required to display <span class="tool" data-bs-toggle="tooltip" data-bs-title="hundred thousandths of a day">beats</span> (<span class="tool" data-bs-toggle="tooltip" data-bs-title="beats">b</span>).</p>
<p>When the current <span class="tool" data-bs-toggle="tooltip" data-bs-title="time of day">tod</span> has seven digits, the sixth digit changes too quickly to be read out loud and the seventh changes so fast that it appears as a blur. Near the Equator, a longitude that has seven digits is accurate to within about ten <span class="tool" data-bs-toggle="tooltip" data-bs-title="zone equatorial meters">zems</span> (z) or four <a href="https://en.wikipedia.org/wiki/Metre#:~:text=the%20base%20unit%20of%20length%20in%20the%20International%20System%20of%20Units">meters</a>, which is roughly the length of a <a href="https://www.dimensions.com/collection/subcompact-cars-b-segment">subcompact car</a> or the width of a <a href="https://www.dimensions.com/collection/living-room-layouts">U-shaped living room layout</a>.</p>
<p>The Equator is approximately (<span class="tool" data-bs-toggle="tooltip" data-bs-title="approximately">~</span>) <span class="tool" data-bs-toggle="tooltip" data-bs-title="one thousand">10<sup>3</sup></span> <span class="tool" data-bs-toggle="tooltip" data-bs-title="thousandths of a taur">millitaurs</span> (<span class="tool" data-bs-toggle="tooltip" data-bs-title="millitaurs">mc</span>), <span class="tool" data-bs-toggle="tooltip" data-bs-title="approximately">~</span>4 × <span class="tool" data-bs-toggle="tooltip" data-bs-title="ten thousand">10<sup>4</sup></span> <span class="tool" data-bs-toggle="tooltip" data-bs-title="thousands of meters">kilometers</span> (<span class="tool" data-bs-toggle="tooltip" data-bs-title="kilometers">km</span>), or <span class="tool" data-bs-toggle="tooltip" data-bs-title="approximately">~</span><span class="tool" data-bs-toggle="tooltip" data-bs-title="a hundred thousand">10<sup>5</sup></span> <span class="tool" data-bs-toggle="tooltip" data-bs-title="thousands of zone equatorial meters">kilozems</span> (<span class="tool" data-bs-toggle="tooltip" data-bs-title="kilozems">kz</span>) long. If we are near the Equator and move 1 <span class="tool" data-bs-toggle="tooltip" data-bs-title="millitaurs">mc</span>, 40 <span class="tool" data-bs-toggle="tooltip" data-bs-title="kilometers">km</span>, or 100 <span class="tool" data-bs-toggle="tooltip" data-bs-title="kilozems">kz</span> to the East or West, our <span class="tool" data-bs-toggle="tooltip" data-bs-title="solar time offset">sto</span> will change by <span class="tool" data-bs-toggle="tooltip" data-bs-title="approximately">~</span>1 <span class="tool" data-bs-toggle="tooltip" data-bs-title="millidays">md</span>, <span class="tool" data-bs-toggle="tooltip" data-bs-title="approximately">~</span>1.44 minutes, or <span class="tool" data-bs-toggle="tooltip" data-bs-title="approximately">~</span>100 <span class="tool" data-bs-toggle="tooltip" data-bs-title="beat">b</span> and our longitude will shift by <span class="tool" data-bs-toggle="tooltip" data-bs-title="approximately">~</span>0.36 degrees, <span class="tool" data-bs-toggle="tooltip" data-bs-title="approximately">~</span>1 <span class="tool" data-bs-toggle="tooltip" data-bs-title="milliparallel">mλ</span>, <span class="tool" data-bs-toggle="tooltip" data-bs-title="approximately">~</span>21.6 <a href="https://en.wikipedia.org/wiki/Minute_and_second_of_arc" class="tool" data-bs-toggle="tooltip" data-bs-title="a sixtieth of a degree">arcminutes</a>, or <span class="tool" data-bs-toggle="tooltip" data-bs-title="approximately">~</span>100 arcbeats (<span class="tool" data-bs-toggle="tooltip" data-bs-title="arcbeats">ab</span>).</p>
<p>For precise <a href="https://en.wikipedia.org/wiki/Geopositioning#:~:text=estimating%20the%20geographic%20position%20of%20an%20object%20or%20a%20person">geopositioning</a>, it may be helpful to show <a href="https://en.wikipedia.org/wiki/Geographic_coordinate_system#:~:text=for%20measuring%20and%20communicating%20positions%20directly%20on%20Earth%20as%20latitude%20and%20longitude">geographic coordinates</a> in submultiples of <span class="tool" data-bs-toggle="tooltip" data-bs-title="arcbeats">ab</span>, but we are unlikely to benefit from units smaller than <span class="tool" data-bs-toggle="tooltip" data-bs-title="millidays">md</span> when displaying the <a href="https://en.wikipedia.org/wiki/Solar_time#:~:text=a%20calculation%20of%20the%20passage%20of%20time%20based%20on%20the%20position%20of%20the%20Sun%20in%20the%20sky">solar time</a> or estimates of what the <span class="tool" data-bs-toggle="tooltip" data-bs-title="time of day">tod</span> will be when the Sun rises, reaches its <a href="https://en.m.wikipedia.org/wiki/Noon#:~:text=highest%20position%20above%20the%20horizon">zenith</a>, or sets on a given day. By default, Dec uses three digits to show each solar time and <span class="tool" data-bs-toggle="tooltip" data-bs-title="solar time offset">sto</span>.</p>
</section><section id="eot" class="level5 hiddenheading"><h5 class="hiddenheading anchored" data-anchor-id="eot">Equation of time</h5>
<p>The two types of <a href="https://en.wikipedia.org/wiki/Solar_time#:~:text=a%20calculation%20of%20the%20passage%20of%20time%20based%20on%20the%20position%20of%20the%20Sun%20in%20the%20sky">solar time</a> are <a href="https://en.wikipedia.org/wiki/Solar_time#Mean_solar_time:~:text=it%20follows%20an%20imaginary%20%22mean%20Sun%22%20that%20moves%20along%20the%20celestial%20equator%20at%20a%20constant%20rate%20that%20matches%20the%20real%20Sun%27s%20average%20rate%20over%20the%20year">“mean solar time”</a> (<span class="tool" data-bs-toggle="tooltip" data-bs-title="mean solar time">mst</span>) and <a href="https://en.wikipedia.org/wiki/Solar_time#Mean_solar_time:~:text=it%20follows%20an%20imaginary%20%22mean%20Sun%22%20that%20moves%20along%20the%20celestial%20equator%20at%20a%20constant%20rate%20that%20matches%20the%20real%20Sun%27s%20average%20rate%20over%20the%20year">“apparent solar time”</a> (<span class="tool" data-bs-toggle="tooltip" data-bs-title="apparent solar time">ast</span>). To calculate <span class="tool" data-bs-toggle="tooltip" data-bs-title="mean solar time">mst</span>, we keep only the decimal part of the sum of 0.95, the Zone <span class="color0">0</span> <span class="tool" data-bs-toggle="tooltip" data-bs-title="time of day">tod</span> measured in days, and our longitude measured in <span class="tool" data-bs-toggle="tooltip" data-bs-title="parallel">λ</span>. If we want <span class="tool" data-bs-toggle="tooltip" data-bs-title="apparent solar time">ast</span> instead of <span class="tool" data-bs-toggle="tooltip" data-bs-title="mean solar time">mst</span>, the sum needs to include the result of plugging the “time of year” (<span class="tool" data-bs-toggle="tooltip" data-bs-title="time of year">toy</span>) into the <a href="https://en.wikipedia.org/wiki/Equation_of_time#:~:text=the%20discrepancy%20between%20two%20kinds%20of%20solar%20time">equation of time</a> (<span class="tool" data-bs-toggle="tooltip" data-bs-title="equation of time">eot</span>).</p>
<p><span class="math display">\[\text{toy} = \text{yda} \div \text{n}\]</span></p>
<p><span class="math display">\[\text{mst} = (0.95 + \text{tod} + \lambda) \text{ mod } 1\]</span></p>
<p><span class="math display">\[\text{ast} = (0.95 + \text{tod} + \lambda +  \text{eot(toy)}) \text{ mod } 1\]</span></p>
<p>To obtain the <span class="tool" data-bs-toggle="tooltip" data-bs-title="time of year">toy</span>, we divide the <span class="tool" data-bs-toggle="tooltip" data-bs-title="yearly day aggregate">yda</span> by the number of days in the year (<span class="tool" data-bs-toggle="tooltip" data-bs-title="the number of days in the year">n</span>). If we use <a href="https://en.wikipedia.org/wiki/Trigonometric_functions#:~:text=functions%20which%20relate%20an%20angle%20of%20a%20right%2Dangled%20triangle%20to%20ratios%20of%20two%20side%20lengths">trigonometric functions</a> that are designed to work with <a href="https://en.wikipedia.org/wiki/Radian#:~:text=the%20unit%20of%20angle%20in%20the%20International%20System%20of%20Units">radians</a>, we will have to multiply the <span class="tool" data-bs-toggle="tooltip" data-bs-title="time of year">toy</span> by <span class="math inline">\(2\pi\)</span> or <span class="math inline">\(\tau\)</span>. We do not need to modify the <span class="tool" data-bs-toggle="tooltip" data-bs-title="time of year">toy</span> before passing it to the <span class="tool" data-bs-toggle="tooltip" data-bs-title="equation of time">eot</span>() function defined below because its trigonometric functions expect <a href="https://en.wikipedia.org/wiki/Turn_%28angle%29#:~:text=a%20unit%20of%20plane%20angle%20measurement%20equal%20to%202%CF%80%C2%A0radians%2C%20360%C2%A0degrees">turns</a> instead of radians.</p>
<p><span class="math display">\[\begin{split}
\text{eot(toy)} &amp; = \beta_0 \\
&amp; + \beta_1 \times \text{costau(toy)} \\
&amp; + \beta_2 \times \text{costau(2} \times \text{toy)} \\
&amp; + \beta_3 \times \text{sintau(toy)} \\
&amp; + \beta_4 \times \text{sintau(2} \times \text{toy)}
\end{split}\]</span></p>
<div class="tabset-margin-container"></div><div class="panel-tabset" data-group="language">
<ul class="nav nav-tabs" role="tablist">
<li class="nav-item" role="presentation"><a class="nav-link active" id="tabset-3-1-tab" data-bs-toggle="tab" data-bs-target="#tabset-3-1" role="tab" aria-controls="tabset-3-1" aria-selected="true" href="">Julia</a></li>
<li class="nav-item" role="presentation"><a class="nav-link" id="tabset-3-2-tab" data-bs-toggle="tab" data-bs-target="#tabset-3-2" role="tab" aria-controls="tabset-3-2" aria-selected="false" href="">Observable JavaScript</a></li>
<li class="nav-item" role="presentation"><a class="nav-link" id="tabset-3-3-tab" data-bs-toggle="tab" data-bs-target="#tabset-3-3" role="tab" aria-controls="tabset-3-3" aria-selected="false" href="">Python</a></li>
<li class="nav-item" role="presentation"><a class="nav-link" id="tabset-3-4-tab" data-bs-toggle="tab" data-bs-target="#tabset-3-4" role="tab" aria-controls="tabset-3-4" aria-selected="false" href="">R</a></li>
</ul>
<div class="tab-content" data-group="language">
<div id="tabset-3-1" class="tab-pane active" role="tabpanel" aria-labelledby="tabset-3-1-tab">
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb44"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb44-1"><a href="#cb44-1" aria-hidden="true" tabindex="-1"></a><span class="fu">sincostau</span>(turn) <span class="op">=</span> <span class="fu">sincospi</span>(<span class="fl">2</span> <span class="op">*</span> turn)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>sincostau (generic function with 1 method)</code></pre>
</div>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb46"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb46-1"><a href="#cb46-1" aria-hidden="true" tabindex="-1"></a><span class="fu">sincostau</span>(<span class="fl">0.25</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>(1.0, 0.0)</code></pre>
</div>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb48"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb48-1"><a href="#cb48-1" aria-hidden="true" tabindex="-1"></a><span class="fu">sincostau</span>(<span class="fl">0.5</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>(0.0, -1.0)</code></pre>
</div>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb50"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb50-1"><a href="#cb50-1" aria-hidden="true" tabindex="-1"></a><span class="fu">sincos</span>(<span class="fl">0.25</span> <span class="op">*</span> <span class="fl">2</span> <span class="op">*</span> <span class="cn">pi</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>(1.0, 6.123233995736766e-17)</code></pre>
</div>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb52"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb52-1"><a href="#cb52-1" aria-hidden="true" tabindex="-1"></a><span class="fu">sincos</span>(<span class="fl">0.5</span> <span class="op">*</span> <span class="fl">2</span> <span class="op">*</span> <span class="cn">pi</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>(1.2246467991473532e-16, -1.0)</code></pre>
</div>
</div>
</div>
<div id="tabset-3-2" class="tab-pane" role="tabpanel" aria-labelledby="tabset-3-2-tab">
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb54" data-startfrom="761" data-source-offset="-0"><pre class="sourceCode js code-with-copy"><code class="sourceCode javascript" style="counter-reset: source-line 760;"><span id="cb54-761"><a href="#cb54-761" aria-hidden="true" tabindex="-1"></a>sincospi <span class="op">=</span> <span class="pp">require</span>(</span>
<span id="cb54-762"><a href="#cb54-762" aria-hidden="true" tabindex="-1"></a>  <span class="st">'https://cdn.jsdelivr.net/gh/stdlib-js/math-base-special-sincospi@umd/browser.js'</span></span>
<span id="cb54-763"><a href="#cb54-763" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb54-764"><a href="#cb54-764" aria-hidden="true" tabindex="-1"></a><span class="kw">function</span> <span class="fu">sincostau</span>(turn) {</span>
<span id="cb54-765"><a href="#cb54-765" aria-hidden="true" tabindex="-1"></a>  <span class="cf">return</span> <span class="fu">sincospi</span>(<span class="dv">2</span> <span class="op">*</span> turn)<span class="op">;</span></span>
<span id="cb54-766"><a href="#cb54-766" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb54-767"><a href="#cb54-767" aria-hidden="true" tabindex="-1"></a><span class="kw">function</span> <span class="fu">sincos</span>(turn) {</span>
<span id="cb54-768"><a href="#cb54-768" aria-hidden="true" tabindex="-1"></a>  turn <span class="op">*=</span> <span class="dv">2</span> <span class="op">*</span> <span class="bu">Math</span><span class="op">.</span><span class="cn">PI</span></span>
<span id="cb54-769"><a href="#cb54-769" aria-hidden="true" tabindex="-1"></a>  <span class="cf">return</span> [<span class="bu">Math</span><span class="op">.</span><span class="fu">sin</span>(turn)<span class="op">,</span> <span class="bu">Math</span><span class="op">.</span><span class="fu">cos</span>(turn)]</span>
<span id="cb54-770"><a href="#cb54-770" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb54-771"><a href="#cb54-771" aria-hidden="true" tabindex="-1"></a><span class="fu">sincostau</span>(<span class="fl">0.25</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-display">
<div>
<div id="ojs-cell-19-1" data-nodetype="declaration">

</div>
</div>
</div>
<div class="cell-output cell-output-display">
<div>
<div id="ojs-cell-19-2" data-nodetype="declaration">

</div>
</div>
</div>
<div class="cell-output cell-output-display">
<div>
<div id="ojs-cell-19-3" data-nodetype="declaration">

</div>
</div>
</div>
<div class="cell-output cell-output-display">
<div>
<div id="ojs-cell-19-4" data-nodetype="expression">

</div>
</div>
</div>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb55" data-startfrom="772" data-source-offset="-272"><pre class="sourceCode js code-with-copy"><code class="sourceCode javascript" style="counter-reset: source-line 771;"><span id="cb55-772"><a href="#cb55-772" aria-hidden="true" tabindex="-1"></a><span class="fu">sincostau</span>(<span class="fl">0.5</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-display">
<div>
<div id="ojs-cell-19-5" data-nodetype="expression">

</div>
</div>
</div>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb56" data-startfrom="773" data-source-offset="-287"><pre class="sourceCode js code-with-copy"><code class="sourceCode javascript" style="counter-reset: source-line 772;"><span id="cb56-773"><a href="#cb56-773" aria-hidden="true" tabindex="-1"></a><span class="fu">sincos</span>(<span class="fl">0.25</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-display">
<div>
<div id="ojs-cell-19-6" data-nodetype="expression">

</div>
</div>
</div>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb57" data-startfrom="774" data-source-offset="-300"><pre class="sourceCode js code-with-copy"><code class="sourceCode javascript" style="counter-reset: source-line 773;"><span id="cb57-774"><a href="#cb57-774" aria-hidden="true" tabindex="-1"></a><span class="fu">sincos</span>(<span class="fl">0.5</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-display">
<div>
<div id="ojs-cell-19-7" data-nodetype="expression">

</div>
</div>
</div>
</div>
</div>
<div id="tabset-3-3" class="tab-pane" role="tabpanel" aria-labelledby="tabset-3-3-tab">
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb58"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb58-1"><a href="#cb58-1" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> math <span class="im">import</span> cos, sin, pi</span>
<span id="cb58-2"><a href="#cb58-2" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> mpmath <span class="im">import</span> cospi, sinpi</span>
<span id="cb58-3"><a href="#cb58-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb58-4"><a href="#cb58-4" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> sincostau(turn):</span>
<span id="cb58-5"><a href="#cb58-5" aria-hidden="true" tabindex="-1"></a>    turn <span class="op">*=</span> <span class="dv">2</span></span>
<span id="cb58-6"><a href="#cb58-6" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> sinpi(turn), cospi(turn)</span>
<span id="cb58-7"><a href="#cb58-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb58-8"><a href="#cb58-8" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> sincos(turn):</span>
<span id="cb58-9"><a href="#cb58-9" aria-hidden="true" tabindex="-1"></a>    turn <span class="op">*=</span> <span class="dv">2</span> <span class="op">*</span> pi</span>
<span id="cb58-10"><a href="#cb58-10" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> sin(turn), cos(turn)</span>
<span id="cb58-11"><a href="#cb58-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb58-12"><a href="#cb58-12" aria-hidden="true" tabindex="-1"></a>sincostau(<span class="fl">0.25</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>(mpf('1.0'), mpf('0.0'))</code></pre>
</div>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb60"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb60-1"><a href="#cb60-1" aria-hidden="true" tabindex="-1"></a>sincostau(<span class="fl">0.5</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>(mpf('0.0'), mpf('-1.0'))</code></pre>
</div>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb62"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb62-1"><a href="#cb62-1" aria-hidden="true" tabindex="-1"></a>sincos(<span class="fl">0.25</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>(1.0, 6.123233995736766e-17)</code></pre>
</div>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb64"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb64-1"><a href="#cb64-1" aria-hidden="true" tabindex="-1"></a>sincos(<span class="fl">0.5</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>(1.2246467991473532e-16, -1.0)</code></pre>
</div>
</div>
</div>
<div id="tabset-3-4" class="tab-pane" role="tabpanel" aria-labelledby="tabset-3-4-tab">
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb66"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">sincostau</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">turn</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="va">turn</span> <span class="op">&lt;-</span> <span class="fl">2</span> <span class="op">*</span> <span class="va">turn</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/Trig.html">sinpi</a></span><span class="op">(</span><span class="va">turn</span><span class="op">)</span>, <span class="fu"><a href="https://rdrr.io/r/base/Trig.html">cospi</a></span><span class="op">(</span><span class="va">turn</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="op">}</span></span>
<span></span>
<span><span class="va">sincos</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">turn</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="va">turn</span> <span class="op">&lt;-</span> <span class="fl">2</span> <span class="op">*</span> <span class="va">turn</span> <span class="op">*</span> <span class="va">pi</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/Trig.html">sin</a></span><span class="op">(</span><span class="va">turn</span><span class="op">)</span>, <span class="fu"><a href="https://rdrr.io/r/base/Trig.html">cos</a></span><span class="op">(</span><span class="va">turn</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="op">}</span></span>
<span></span>
<span><span class="fu">sincostau</span><span class="op">(</span><span class="fl">0.25</span><span class="op">)</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 1 0</code></pre>
</div>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb68"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu">sincostau</span><span class="op">(</span><span class="fl">0.5</span><span class="op">)</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1]  0 -1</code></pre>
</div>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb70"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu">sincos</span><span class="op">(</span><span class="fl">0.25</span><span class="op">)</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 1.000000e+00 6.123234e-17</code></pre>
</div>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb72"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu">sincos</span><span class="op">(</span><span class="fl">0.5</span><span class="op">)</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1]  1.224647e-16 -1.000000e+00</code></pre>
</div>
</div>
</div>
</div>
</div>
<p>The code above compares two functions which return both the <a href="https://en.wikipedia.org/wiki/Sine_and_cosine#:~:text=the%20ratio%20of%20the%20length%20of%20the%20side%20opposite%20that%20angle%20to%20the%20length%20of%20the%20longest%20side%20of%20the%20triangle">sine</a> and <a href="https://en.wikipedia.org/wiki/Sine_and_cosine#:~:text=the%20ratio%20of%20the%20length%20of%20the%20adjacent%20leg%20to%20that%20of%20the%20hypotenuse">cosine</a> of their input. The sincos() function assumes it will receive radians and the sincostau() works with turns. In general, working with turns is more convenient and intuitive. The examples above demonstrate that using turns instead of radians can <a href="https://en.wikipedia.org/wiki/Sine_and_cosine#:~:text=Representing%20angles%20in%20turns%20or%20half%2Dturns%20has%20accuracy%20advantages">yield more accurate results</a>.</p>
<p>The values below are the coefficients of a model adapted from the <a href="https://www.noaa.gov">National Oceanic and Atmospheric Administration</a> (<span class="tool" data-bs-toggle="tooltip" data-bs-title="National Oceanic and Atmospheric Administration">NOAA</span>) <a href="https://gml.noaa.gov/grad/solcalc/solareqns.PDF">General Solar Position Calculations</a>. Before <a href="https://docs.scipy.org/doc/scipy/reference/generated/scipy.optimize.curve_fit.html">fitting</a> the model to <span class="tool" data-bs-toggle="tooltip" data-bs-title="National Oceanic and Atmospheric Administration">NOAA</span> <a href="https://gml.noaa.gov/grad/solcalc/calcdetails.html">yearly solar data</a>, we need to convert eot(<span class="tool" data-bs-toggle="tooltip" data-bs-title="time of year">toy</span>) values from minutes to <a href="https://en.wikipedia.org/wiki/Unit_of_time#:~:text=14.4%20minutes%2C%20or%20864%20seconds" class="tool" data-bs-toggle="tooltip" data-bs-title="hundredths of a day">centidays</a>, combine <span class="tool" data-bs-toggle="tooltip" data-bs-title="year month day">ymd</span> triplet dates and <span class="tool" data-bs-toggle="tooltip" data-bs-title="hour minute second">hms</span> triplet times into <span class="tool" data-bs-toggle="tooltip" data-bs-title="yearly day aggregates">ydas</span>, and sort by <span class="tool" data-bs-toggle="tooltip" data-bs-title="yearly day aggregate">yda</span>.</p>
<div class="quarto-embed-nb-cell" data-notebook="/Users/martinlaptev/maptv/maptv.github.io/dec/time/eot.ipynb" data-notebook-title="Bonus examples" data-notebook-cellid="cell-eot">
<div id="cell-eot" class="cell" data-execution_count="20">
<div id="eot" class="cell-output cell-output-display" data-execution_count="20">
<pre><code>{0: 0.0011114386869002235,
 1: -4.155124400404918,
 2: -2.9710873225303756,
 3: -4.635570414590801,
 4: 5.116176940364264}</code></pre>
</div>
</div>
</div>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code hidden" id="cb75" data-startfrom="826" data-source-offset="0"><pre class="sourceCode js code-with-copy"><code class="sourceCode javascript" style="counter-reset: source-line 825;"><span id="cb75-826"><a href="#cb75-826" aria-hidden="true" tabindex="-1"></a><span class="co">// https://observablehq.com/@mcmcclur/plot-for-mathematicians</span></span>
<span id="cb75-827"><a href="#cb75-827" aria-hidden="true" tabindex="-1"></a>{</span>
<span id="cb75-828"><a href="#cb75-828" aria-hidden="true" tabindex="-1"></a>  <span class="kw">let</span> w <span class="op">=</span> <span class="dv">800</span><span class="op">;</span></span>
<span id="cb75-829"><a href="#cb75-829" aria-hidden="true" tabindex="-1"></a>  <span class="kw">let</span> h <span class="op">=</span> <span class="fl">0.625</span> <span class="op">*</span> w<span class="op">;</span></span>
<span id="cb75-830"><a href="#cb75-830" aria-hidden="true" tabindex="-1"></a>  <span class="kw">let</span> samples <span class="op">=</span> <span class="fu">build_samples</span>(</span>
<span id="cb75-831"><a href="#cb75-831" aria-hidden="true" tabindex="-1"></a>    getEot<span class="op">,</span> <span class="op">-</span><span class="dv">366</span><span class="op">,</span> <span class="dv">365</span><span class="op">,</span> { <span class="dt">N</span><span class="op">:</span> <span class="dv">150</span> }</span>
<span id="cb75-832"><a href="#cb75-832" aria-hidden="true" tabindex="-1"></a>  )<span class="op">;</span></span>
<span id="cb75-833"><a href="#cb75-833" aria-hidden="true" tabindex="-1"></a>  <span class="kw">let</span> plot <span class="op">=</span> Plot<span class="op">.</span><span class="fu">plot</span>({</span>
<span id="cb75-834"><a href="#cb75-834" aria-hidden="true" tabindex="-1"></a>    <span class="dt">marginLeft</span><span class="op">:</span> <span class="dv">60</span><span class="op">,</span></span>
<span id="cb75-835"><a href="#cb75-835" aria-hidden="true" tabindex="-1"></a>    <span class="dt">width</span><span class="op">:</span> w<span class="op">,</span></span>
<span id="cb75-836"><a href="#cb75-836" aria-hidden="true" tabindex="-1"></a>    <span class="dt">height</span><span class="op">:</span> h<span class="op">,</span></span>
<span id="cb75-837"><a href="#cb75-837" aria-hidden="true" tabindex="-1"></a>    <span class="dt">style</span><span class="op">:</span> <span class="st">"font-size:19;"</span><span class="op">,</span></span>
<span id="cb75-838"><a href="#cb75-838" aria-hidden="true" tabindex="-1"></a>    <span class="dt">y</span><span class="op">:</span> {<span class="dt">label</span><span class="op">:</span> <span class="st">"milliday eot(toy)"</span>}<span class="op">,</span></span>
<span id="cb75-839"><a href="#cb75-839" aria-hidden="true" tabindex="-1"></a>    <span class="dt">x</span><span class="op">:</span> {<span class="dt">label</span><span class="op">:</span> <span class="st">"day of year"</span>}<span class="op">,</span></span>
<span id="cb75-840"><a href="#cb75-840" aria-hidden="true" tabindex="-1"></a>    <span class="dt">marks</span><span class="op">:</span> [</span>
<span id="cb75-841"><a href="#cb75-841" aria-hidden="true" tabindex="-1"></a>      Plot<span class="op">.</span><span class="fu">line</span>(samples<span class="op">,</span> {</span>
<span id="cb75-842"><a href="#cb75-842" aria-hidden="true" tabindex="-1"></a>        <span class="dt">strokeWidth</span><span class="op">:</span> <span class="dv">4</span><span class="op">,</span></span>
<span id="cb75-843"><a href="#cb75-843" aria-hidden="true" tabindex="-1"></a>        <span class="dt">stroke</span><span class="op">:</span> <span class="st">"steelblue"</span><span class="op">,</span></span>
<span id="cb75-844"><a href="#cb75-844" aria-hidden="true" tabindex="-1"></a>        <span class="dt">tip</span><span class="op">:</span> <span class="kw">true</span></span>
<span id="cb75-845"><a href="#cb75-845" aria-hidden="true" tabindex="-1"></a>      })<span class="op">,</span></span>
<span id="cb75-846"><a href="#cb75-846" aria-hidden="true" tabindex="-1"></a>      Plot<span class="op">.</span><span class="fu">ruleX</span>([<span class="op">-</span><span class="dv">366</span>])<span class="op">,</span></span>
<span id="cb75-847"><a href="#cb75-847" aria-hidden="true" tabindex="-1"></a>      Plot<span class="op">.</span><span class="fu">ruleY</span>([<span class="dv">0</span>])<span class="op">,</span></span>
<span id="cb75-848"><a href="#cb75-848" aria-hidden="true" tabindex="-1"></a>      Plot<span class="op">.</span><span class="fu">axisX</span>({ <span class="dt">y</span><span class="op">:</span> <span class="dv">0</span> })<span class="op">,</span></span>
<span id="cb75-849"><a href="#cb75-849" aria-hidden="true" tabindex="-1"></a>      Plot<span class="op">.</span><span class="fu">axisY</span>({ <span class="dt">x</span><span class="op">:</span> <span class="op">-</span><span class="dv">366</span> })</span>
<span id="cb75-850"><a href="#cb75-850" aria-hidden="true" tabindex="-1"></a>    ]</span>
<span id="cb75-851"><a href="#cb75-851" aria-hidden="true" tabindex="-1"></a>  })<span class="op">;</span></span>
<span id="cb75-852"><a href="#cb75-852" aria-hidden="true" tabindex="-1"></a>  <span class="cf">return</span> plot<span class="op">;</span></span>
<span id="cb75-853"><a href="#cb75-853" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div id="eotplot" class="cell-output cell-output-display">
<div id="ojs-cell-20" data-nodetype="expression">

</div>
</div>
</div>
<p>The line📈chart above uses <span class="tool" data-bs-toggle="tooltip" data-bs-title="millidays">md</span> to display <span class="tool" data-bs-toggle="tooltip" data-bs-title="equation of time">eot</span>(<span class="tool" data-bs-toggle="tooltip" data-bs-title="time of year">toy</span>) values as integers. There is little difference between <span class="tool" data-bs-toggle="tooltip" data-bs-title="mean solar time">mst</span> and <span class="tool" data-bs-toggle="tooltip" data-bs-title="apparent solar time">ast</span> around Days <span class="tool" data-bs-toggle="tooltip" data-bs-title="April 15">45</span>, <span class="tool" data-bs-toggle="tooltip" data-bs-title="June 12">103</span>, <span class="tool" data-bs-toggle="tooltip" data-bs-title="September 1">184</span>, and <span class="tool" data-bs-toggle="tooltip" data-bs-title="December 25">299</span>. The difference ranges from about -9.8 on <span class="tool" data-bs-toggle="tooltip" data-bs-title="October 31">Day 244</span> to around 11.4 <span class="tool" data-bs-toggle="tooltip" data-bs-title="millidays">md</span> on <span class="tool" data-bs-toggle="tooltip" data-bs-title="February 14">Day 350</span>. We can calculate <span class="tool" data-bs-toggle="tooltip" data-bs-title="mean solar time">mst</span> with just a <span class="tool" data-bs-toggle="tooltip" data-bs-title="time of day">tod</span> and a longitude and we will be off by at most about a <span class="tool" data-bs-toggle="tooltip" data-bs-title="a hundredth of a day">centiday</span> compared to <span class="tool" data-bs-toggle="tooltip" data-bs-title="apparent solar time">ast</span>.</p>
<p>Apart from turning a <span class="tool" data-bs-toggle="tooltip" data-bs-title="mean solar time">mst</span> into an <span class="tool" data-bs-toggle="tooltip" data-bs-title="apparent solar time">ast</span>, we can also use <span class="tool" data-bs-toggle="tooltip" data-bs-title="equation of time">eot</span> to more accurately estimate the <span class="tool" data-bs-toggle="tooltip" data-bs-title="times of day">tods</span> of <a href="https://en.wikipedia.org/wiki/Noon#:~:text=reaching%20its%20highest%20position%20above%20the%20horizon%20on%20that%20day%20and%20casting%20the%20shortest%20shadow">solar noon</a>, sunrise, and sunset. The equation below creates a <a href="https://en.wikipedia.org/wiki/Noon#:~:text=reaching%20its%20highest%20position%20above%20the%20horizon%20on%20that%20day%20and%20casting%20the%20shortest%20shadow">solar noon</a> <span class="tool" data-bs-toggle="tooltip" data-bs-title="time of day">tod</span> measured in days by adding 9.55 to a longitude measured in <span class="tool" data-bs-toggle="tooltip" data-bs-title="parallel">λ</span>, subtracting a <span class="tool" data-bs-toggle="tooltip" data-bs-title="time zone offset">tzo</span> and a <span class="tool" data-bs-toggle="tooltip" data-bs-title="equation of time">eot</span>(<span class="tool" data-bs-toggle="tooltip" data-bs-title="time of year">toy</span>) value that are both measured in days, and keeping only the decimal part of the result.</p>
<p><span class="math display">\[\text{noon} = (9.55 + \text{tzo} - \lambda - \text{eot(toy)) mod 1}\]</span></p>
</section><section id="cac" class="level5 hiddenheading"><h5 class="hiddenheading anchored" data-anchor-id="cac">Cambridge and Cambridge</h5>
<p>To compare the solar noon <span class="tool" data-bs-toggle="tooltip" data-bs-title="time of day">tod</span> in two cities, we can plug in the longitude of each city into the equation above. If all the variables in the equation other than longitude are set to zero, the result is almost five <span class="tool" data-bs-toggle="tooltip" data-bs-title="tenths of a day">decidays</span> for <a href="https://en.wikipedia.org/wiki/Cambridge#:~:text=a%20city%20and%20non%2Dmetropolitan%20district%20in%20the%20county%20of%20Cambridgeshire%2C%20England">Cambridge, England</a> in the <a href="https://en.wikipedia.org/wiki/United_Kingdom#:~:text=a%20country%20in%20Northwestern%20Europe">United Kingdom</a> and nearly seven <span class="tool" data-bs-toggle="tooltip" data-bs-title="tenths of a day">decidays</span> for <a href="https://en.wikipedia.org/wiki/Cambridge,_Massachusetts#:~:text=a%20city%20in%20Middlesex%20County%2C%20Massachusetts%2C%20United%20States">Cambridge, Massachusetts</a> in the <a href="https://en.wikipedia.org/wiki/United_States#:~:text=a%20country%20primarily%20located%20in%20North%20America">United States</a>.</p>
<p><span class="math display">\[4.99635 = (9.55 - 0.050365) \text{ mod 1} \times 10\]</span></p>
<p><span class="math display">\[6.97516 = (9.55 - 0.852484) \text{ mod 1} \times 10\]</span></p>
<p>The two homonymous cities are about two <span class="tool" data-bs-toggle="tooltip" data-bs-title="deciparallels">dλ</span> apart and thus will always differ by around two <span class="tool" data-bs-toggle="tooltip" data-bs-title="tenths of a day">decidays</span> in solar time, regardless of what time zone we use as our frame of reference. England is in Zone <span class="color0">0</span> and Massachusetts is in Zone <span class="color8">8</span>. If we change the <span class="tool" data-bs-toggle="tooltip" data-bs-title="time zone offset">tzo</span> from zero to eight <span class="tool" data-bs-toggle="tooltip" data-bs-title="tenths of a day">decidays</span>, the solar noon <span class="tool" data-bs-toggle="tooltip" data-bs-title="time of day">tod</span> for each city will be two <span class="tool" data-bs-toggle="tooltip" data-bs-title="tenths of a day">decidays</span> earlier.</p>
<p><span class="math display">\[2.99635 = (9.55 + 0.8 - 0.050365) \text{ mod 1} \times 10\]</span></p>
<p><span class="math display">\[4.97516 = (9.55 + 0.8 - 0.852484) \text{ mod 1} \times 10\]</span></p>
</section><section id="sda" class="level5 hiddenheading"><h5 class="hiddenheading anchored" data-anchor-id="sda">Solar declination angle</h5>
<p>The duration of <a href="https://en.wikipedia.org/wiki/Daytime#:~:text=the%20period%20of%20the%20day%20during%20which%20a%20given%20location%20experiences%20natural%20illumination%20from%20direct%20sunlight">daytime</a> is the difference between the sunset and sunrise <span class="tool" data-bs-toggle="tooltip" data-bs-title="times of day">tods</span>. To calculate the daytime duration, we only need a latitude and a “solar declination angle” (<span class="tool" data-bs-toggle="tooltip" data-bs-title="solar declination angle">sda</span>). For simplicity, we can use the same model for the <span class="tool" data-bs-toggle="tooltip" data-bs-title="equation of time">eot</span> and <span class="tool" data-bs-toggle="tooltip" data-bs-title="solar declination angle">sda</span>, even though the <span class="tool" data-bs-toggle="tooltip" data-bs-title="National Oceanic and Atmospheric Administration">NOAA</span> <a href="https://gml.noaa.gov/grad/solcalc/solareqns.PDF">General Solar Position Calculations</a> propose the more complex model shown below.</p>
<p><span class="math display">\[\begin{split}
\text{sda(toy)} &amp; = \beta_0 \\
&amp; + \beta_1 \times \text{costau(toy)} \\
&amp; + \beta_2 \times \text{sintau(toy)} \\
&amp; + \beta_3 \times \text{costau(2} \times \text{toy)} \\
&amp; + \beta_4 \times \text{sintau(2} \times \text{toy)} \\
&amp; + \beta_5 \times \text{costau(3} \times \text{toy)} \\
&amp; + \beta_6 \times \text{sintau(3} \times \text{toy)} \\
\end{split}\]</span></p>
<p>Dec measures latitude in turns called meridians (<span class="tool" data-bs-toggle="tooltip" data-bs-title="meridians">φ</span>). Like <span class="tool" data-bs-toggle="tooltip" data-bs-title="parallels">λ</span>, we can pass <span class="tool" data-bs-toggle="tooltip" data-bs-title="meridians">φ</span> directly into trigonometric functions that accept turns. If the “solar zenith angle” (<span class="tool" data-bs-toggle="tooltip" data-bs-title="solar zenith angle">sza</span>) in the equation below is 0.252314 turns, the equation will give us a “solar hour angle” (<span class="tool" data-bs-toggle="tooltip" data-bs-title="solar hour angle">sha</span>) that we can use to find out how long the Sun will shine or when it will rise or set on a given <span class="tool" data-bs-toggle="tooltip" data-bs-title="day of year">doy</span>.</p>
<p><span class="math display">\[\text{sha} = \arccos\left( \frac{\text{costau(sza)} - \text{sintau($\phi$)} \times \text{sintau(sda)}}{\text{costau($\phi$)} \times \text{costau(sda)}} \right)\]</span></p>
<p>Before being plugged into the <span class="tool" data-bs-toggle="tooltip" data-bs-title="solar hour angle">sha</span> equation above, the <span class="tool" data-bs-toggle="tooltip" data-bs-title="millimeridians">mφ</span> latitude selected by the first range input below is divided by 1000 to convert it to <span class="tool" data-bs-toggle="tooltip" data-bs-title="meridians">φ</span> and the <span class="tool" data-bs-toggle="tooltip" data-bs-title="day of year">doy</span> chosen by the second range input is turned into a <span class="tool" data-bs-toggle="tooltip" data-bs-title="time of year">toy</span> and then into an <span class="tool" data-bs-toggle="tooltip" data-bs-title="solar declination angle">sda</span>. When the <span class="tool" data-bs-toggle="tooltip" data-bs-title="solar zenith angle">sza</span> is 0.252314, we can divide the result of the <span class="tool" data-bs-toggle="tooltip" data-bs-title="solar hour angle">sha</span> equation by <span class="math inline">\(\pi\)</span> to obtain the daytime duration: <span><span id="ojs-element-id-16"></span>.</span></p>
<p><span class="math display">\[\text{sunset} - \text{sunrise} = \text{sha} \div \pi\]</span></p>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code hidden" id="cb76" data-startfrom="901" data-source-offset="0"><pre class="sourceCode js code-with-copy"><code class="sourceCode javascript" style="counter-reset: source-line 900;"><span id="cb76-901"><a href="#cb76-901" aria-hidden="true" tabindex="-1"></a>viewof latInput <span class="op">=</span> Inputs<span class="op">.</span><span class="fu">range</span>([<span class="op">-</span><span class="dv">250</span><span class="op">,</span> <span class="dv">250</span>]<span class="op">,</span> {<span class="dt">label</span><span class="op">:</span> <span class="st">"Latitude"</span><span class="op">,</span> <span class="dt">value</span><span class="op">:</span> <span class="dv">0</span><span class="op">,</span> <span class="dt">step</span><span class="op">:</span> <span class="dv">1</span>})</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div id="latinput" class="cell-output cell-output-display">
<div id="ojs-cell-21" data-nodetype="declaration">

</div>
</div>
</div>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code hidden" id="cb77" data-startfrom="907" data-source-offset="0"><pre class="sourceCode js code-with-copy"><code class="sourceCode javascript" style="counter-reset: source-line 906;"><span id="cb77-907"><a href="#cb77-907" aria-hidden="true" tabindex="-1"></a>viewof doyInput <span class="op">=</span> Inputs<span class="op">.</span><span class="fu">range</span>([<span class="dv">0</span><span class="op">,</span> <span class="dv">365</span>]<span class="op">,</span> {<span class="dt">label</span><span class="op">:</span> <span class="st">"Day of year"</span><span class="op">,</span> <span class="dt">value</span><span class="op">:</span> <span class="dv">183</span><span class="op">,</span> <span class="dt">step</span><span class="op">:</span> <span class="dv">1</span>})</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div id="doyinput" class="cell-output cell-output-display">
<div id="ojs-cell-22" data-nodetype="declaration">

</div>
</div>
</div>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb78" data-startfrom="912" data-source-offset="-0"><pre class="sourceCode js code-with-copy"><code class="sourceCode javascript" style="counter-reset: source-line 911;"><span id="cb78-912"><a href="#cb78-912" aria-hidden="true" tabindex="-1"></a>daytimeDuration</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-display">
<div>
<div id="ojs-cell-23-1" data-nodetype="expression">

</div>
</div>
</div>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb79" data-startfrom="913" data-source-offset="-16"><pre class="sourceCode js code-with-copy"><code class="sourceCode javascript" style="counter-reset: source-line 912;"><span id="cb79-913"><a href="#cb79-913" aria-hidden="true" tabindex="-1"></a>latInput <span class="op">/</span> <span class="dv">1000</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-display">
<div>
<div id="ojs-cell-23-2" data-nodetype="expression">

</div>
</div>
</div>
</div>
<p>Like other trigonometric functions, the <a href="https://en.wikipedia.org/wiki/Inverse_trigonometric_functions#:~:text=y%20%E2%89%A4%2090%C2%B0-,arccosine,-y%20%3D%20arccos">arcosine</a> function returns radians. We can divide by <span class="math inline">\(\tau\)</span> to convert radians to turns. After converting the <span class="tool" data-bs-toggle="tooltip" data-bs-title="solar hour angle">sha</span> to turns, we can sum it with the solar noon to get the sunset <span class="tool" data-bs-toggle="tooltip" data-bs-title="time of day">tod</span> or subtract it from the solar noon <span class="tool" data-bs-toggle="tooltip" data-bs-title="time of day">tod</span> to obtain the sunrise <span class="tool" data-bs-toggle="tooltip" data-bs-title="time of day">tod</span>. The sunrise and sunset <span class="tool" data-bs-toggle="tooltip" data-bs-title="times of day">tods</span> are equidistant from the solar noon <span class="tool" data-bs-toggle="tooltip" data-bs-title="time of day">tod</span>.</p>
<p><span class="math display">\[\text{sunset} = \text{noon} + \text{sha} \div \tau\]</span></p>
<p><span class="math display">\[\text{sunrise} = \text{noon} - \text{sha} \div \tau\]</span></p>
<p>Before we insert the latitude selected by the second range input, we convert mφ to φ.</p>
<p><span class="math display">\[\text{sha} \div \tau = \text{noon} - \text{sunrise} = \text{sunset} - \text{noon}\]</span></p>
<p>When we divide the sha by <span class="math inline">\(\tau\)</span>, we get the difference between the solar noon and sunrise <span class="tool" data-bs-toggle="tooltip" data-bs-title="times of day">tods</span> or the sunset and solar noon <span class="tool" data-bs-toggle="tooltip" data-bs-title="times of day">tods</span>.</p>
</section><section id="sas" class="level5 hiddenheading"><h5 class="hiddenheading anchored" data-anchor-id="sas">Sunrise and sunset</h5>
</section><section id="sha" class="level5 hiddenheading"><h5 class="hiddenheading anchored" data-anchor-id="sha">Solar hour angle</h5>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code hidden" id="cb80" data-startfrom="934" data-source-offset="0"><pre class="sourceCode js code-with-copy"><code class="sourceCode javascript" style="counter-reset: source-line 933;"><span id="cb80-934"><a href="#cb80-934" aria-hidden="true" tabindex="-1"></a>viewof lonInput <span class="op">=</span> Inputs<span class="op">.</span><span class="fu">range</span>([<span class="dv">0</span><span class="op">,</span> <span class="dv">1000</span>]<span class="op">,</span> {<span class="dt">label</span><span class="op">:</span> <span class="st">"Longitude"</span><span class="op">,</span> <span class="dt">value</span><span class="op">:</span> <span class="dv">500</span><span class="op">,</span> <span class="dt">step</span><span class="op">:</span> <span class="dv">1</span>})</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div id="loninput" class="cell-output cell-output-display">
<div id="ojs-cell-24" data-nodetype="declaration">

</div>
</div>
</div>
<p>The first range input above sets the doy that will be used to obtain the sda that along with the φ selected by the second range input will be plugged into the sha equation above. Once we have the sha, we can double it to get the daylight duration in negative days, add it to the solar noon <span class="tool" data-bs-toggle="tooltip" data-bs-title="time of day">tod</span> to get the sunrise <span class="tool" data-bs-toggle="tooltip" data-bs-title="time of day">tod</span>, or subtract it from the solar noon <span class="tool" data-bs-toggle="tooltip" data-bs-title="time of day">tod</span> to get the sunset <span class="tool" data-bs-toggle="tooltip" data-bs-title="time of day">tod</span>.</p>
<p>The difference between a solar noon and sunrise <span class="tool" data-bs-toggle="tooltip" data-bs-title="solar hour angle">sha</span> is a sunrise <span class="tool" data-bs-toggle="tooltip" data-bs-title="time of day">tod</span>. Likewise, the sum of a solar noon and sunrise <span class="tool" data-bs-toggle="tooltip" data-bs-title="solar hour angle">sha</span> is a sunset <span class="tool" data-bs-toggle="tooltip" data-bs-title="time of day">tod</span>. To get the daylight duration in decidays, we can either subtract the sunset <span class="tool" data-bs-toggle="tooltip" data-bs-title="times of day">tod</span> from the sunrise <span class="tool" data-bs-toggle="tooltip" data-bs-title="times of day">tod</span> or multiply the sunrise <span class="tool" data-bs-toggle="tooltip" data-bs-title="solar hour angle">sha</span> by twenty.</p>
<p><span class="math display">\[\text{sunrise} = \text{noon} + \text{sha}\]</span></p>
<p><span class="math display">\[\text{sunset} = \text{noon} - \text{sha}\]</span></p>
<p><span class="math display">\[\text{duration} = \text{sunset} - \text{sunrise} = \left|\text{sha} \times 2\right|\]</span></p>
<p>The sunrise and sunset times in the equations above depend on the time zone of solar noon. To select a time zone may be strange to consider The range🎚️inputs below set the <a href="https://en.wikipedia.org/wiki/Geographic_coordinate_system#:~:text=positions%20directly%20on%20Earth%20as%20latitude%20and%20longitude">geographic coordinates</a> that are used for the equations above. The <a href="https://en.wikipedia.org/wiki/Line_chart#:~:text=a%20type%20of%20chart%20that%20displays%20information%20as%20a%20series%20of%20data%20points%20called%20%27markers%27%20connected%20by%20straight%20line%20segments">line chart</a> beneath the inputs visualizes sunrise and sunset for every <span class="tool" data-bs-toggle="tooltip" data-bs-title="day of year">doy</span>, similar to the daylight area chart beneath the map🗺above. The main difference between the charts is that the area chart shows local <span class="tool" data-bs-toggle="tooltip" data-bs-title="times of day">tods</span> and thus is independent of longitude, whereas the line chart displays <span class="tool" data-bs-toggle="tooltip" data-bs-title="times of day">tzos</span> and therefore changes with longitude.</p>
<p>To find the UTC <span class="tool" data-bs-toggle="tooltip" data-bs-title="time zone offset">tzo</span> of a given longitude and latitude, we could use an <a href="https://en.wikipedia.org/wiki/API#:~:text=a%20type%20of%20software%20interface%2C%20offering%20a%20service%20to%20other%20pieces%20of%20software">application programming interface</a> (API) or a <a href="https://observablehq.com/@jcolot/time-zone-service">database</a>. If we only have longitude, we need to first round degrees to zero or the nearest multiple of fifteen for whole hour <span class="tool" data-bs-toggle="tooltip" data-bs-title="time zone offsets">tzos</span>, 7.5 for half hour <span class="tool" data-bs-toggle="tooltip" data-bs-title="time zone offsets">tzos</span>, or 3.75 for quarter hour <span class="tool" data-bs-toggle="tooltip" data-bs-title="time zone offsets">tzos</span> and then divide by fifteen to convert degrees to hours.</p>
</section></section><section id="next" class="level4"><h4 class="anchored" data-anchor-id="next">Next</h4>
<p>The next article in the <a href="../../dec">Dec section</a> of my <a href="../..">site</a> shows how we can combine <a href="../../dec/date">Dec dates</a> and times into <a href="../../dec/snap">Dec snaps</a>🫰, which are analogous to the <a href="https://en.wikipedia.org/wiki/ISO_8601#Combined_date_and_time_representations">combined date and time representations</a> in the <a href="https://en.wikipedia.org/wiki/ISO_8601#:~:text=an%20international%20standard%20covering%20the%20worldwide%20exchange%20and%20communication%20of%20date%20and%20time%2Drelated%20data">ISO 8601</a> international standard for dates and times. The final article in the Dec section demonstrates how Dec dates, times, and snaps🫰can be paired up to express <a href="https://en.wikipedia.org/wiki/ISO_8601#Time_intervals:~:text=the%20intervening%20time%20between%20two%20time%20points">time intervals</a> called Dec <a href="../../dec/span">spans</a>🌈.</p>
<div id="timenav">
<div class="cell" data-layout-align="default">
<div class="cell-output-display">
<div>
<p></p><figure class="figure"></figure><p></p>
<div>
<pre class="mermaid mermaid-js">%%{init: {'theme': 'default', 'themeVariables': { 'fontSize': '32px'}}}%%
flowchart LR
   A[Dec]--&gt;B[date]--&gt;C[time]--&gt;D[snap]--&gt;E[span]
   click A "/dec"
   click B "/dec/date"
   click C "/dec/time"
   click D "/dec/snap"
   click E "/dec/span"
</pre>
</div>
<p></p>
</div>
</div>
</div>
</div>
</section><section id="cite" class="level4"><h4 class="anchored" data-anchor-id="cite">Cite</h4>
<p>Please spread the good word about Dec using the citation information at the bottom of this article. You may also want to cite the Observable notebooks that I adapted into the clock🕓, bar📊chart, map🗺️, and daylight☀️plot visualizations in this article or the 2014 blog post which proposed a system of 20 decimal time zones, each 5 <span class="tool" data-bs-toggle="tooltip" data-bs-title="hundredths of a day">centidays</span> wide, based on the <a href="https://en.wikipedia.org/wiki/Prime_meridian_(Greenwich)#:~:text=a%20geographical%20reference%20line%20that%20passes%20through%20the%20Royal%20Observatory%2C%20Greenwich%2C%20in%20London%2C%20England">Greenwich Meridian</a>:</p>
<ul>
<li>
<a href="https://www.2x2.graphics">Pearson, Tom</a>. <span class="yellow"><u>2013</u></span><u>+<span class="cyan">124</span></u>. “Simple D3 clock.” <span class="yellow"><span><span id="ojs-element-id-17"></span></span></span>+<span class="cyan"><span><span id="ojs-element-id-18"></span></span></span>. <a href="https://observablehq.com/@d3/simple-clock" class="uri">https://observablehq.com/@d3/simple-clock</a>.</li>
<li>
<a href="https://fheyen.github.io">Heyen, Frank</a>. <span class="yellow"><u>2021</u></span><u>+<span class="cyan">246</span></u>. “BarChart Clock.” <span class="yellow"><span><span id="ojs-element-id-19"></span></span></span>+<span class="cyan"><span><span id="ojs-element-id-20"></span></span></span>. <a href="https://observablehq.com/@fheyen/barchart-clock" class="uri">https://observablehq.com/@fheyen/barchart-clock</a>.</li>
<li>
<a href="https://enjalot.github.io">Johnson, Ian</a>. <span class="yellow"><u>2021</u></span><u>+<span class="cyan">090</span></u>. “Draggable World Map Coordinates Input.” <span class="yellow"><span><span id="ojs-element-id-21"></span></span></span>+<span class="cyan"><span><span id="ojs-element-id-22"></span></span></span>. <a href="https://observablehq.com/@enjalot/draggable-world-map-coordinates-input" class="uri">https://observablehq.com/@enjalot/draggable-world-map-coordinates-input</a>.</li>
<li>
<a href="https://www.danbridges.org">Bridges, Dan</a>. <span class="yellow"><u>2021</u></span><u>+<span class="cyan">311</span></u>. “Visualizing Seasonal Daylight.” <span class="yellow"><span><span id="ojs-element-id-23"></span></span></span>+<span class="cyan"><span><span id="ojs-element-id-24"></span></span></span>. <a href="https://observablehq.com/@dbridges/visualizing-seasonal-daylight" class="uri">https://observablehq.com/@dbridges/visualizing-seasonal-daylight</a>.</li>
<li>
<a href="https://www.brinckerhoff.org">Clements, John</a>. <span class="yellow"><u>2014</u></span><u>+<span class="cyan">091</span></u>, “Decimal Time Zones.” <span class="yellow"><span><span id="ojs-element-id-25"></span></span></span>+<span class="cyan"><span><span id="ojs-element-id-26"></span></span></span>. <a href="https://www.brinckerhoff.org/blog/2014/05/31/decimal-time-zones" class="uri">https://www.brinckerhoff.org/blog/2014/05/31/decimal-time-zones</a>.</li>
</ul>
<div class="cell hidden">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code hidden" id="cb81" data-startfrom="974" data-source-offset="-0"><pre class="sourceCode js code-with-copy"><code class="sourceCode javascript" style="counter-reset: source-line 973;"><span id="cb81-974"><a href="#cb81-974" aria-hidden="true" tabindex="-1"></a><span class="kw">function</span> <span class="fu">unix2dote</span>(unix<span class="op">,</span> zone<span class="op">,</span> offset <span class="op">=</span> <span class="dv">719468</span>) {</span>
<span id="cb81-975"><a href="#cb81-975" aria-hidden="true" tabindex="-1"></a>  <span class="cf">return</span> [(unix <span class="op">??</span> <span class="bu">Date</span><span class="op">.</span><span class="fu">now</span>()) <span class="op">/</span> <span class="dv">86400000</span> <span class="op">+</span> (</span>
<span id="cb81-976"><a href="#cb81-976" aria-hidden="true" tabindex="-1"></a>    zone <span class="op">=</span> zone <span class="op">??</span> <span class="op">-</span><span class="bu">Math</span><span class="op">.</span><span class="fu">round</span>(</span>
<span id="cb81-977"><a href="#cb81-977" aria-hidden="true" tabindex="-1"></a>      (<span class="kw">new</span> <span class="bu">Date</span>)<span class="op">.</span><span class="fu">getTimezoneOffset</span>() <span class="op">/</span> <span class="dv">144</span>)</span>
<span id="cb81-978"><a href="#cb81-978" aria-hidden="true" tabindex="-1"></a>    ) <span class="op">/</span> <span class="dv">10</span> <span class="op">+</span> offset<span class="op">,</span> zone]</span>
<span id="cb81-979"><a href="#cb81-979" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb81-980"><a href="#cb81-980" aria-hidden="true" tabindex="-1"></a><span class="kw">function</span> <span class="fu">unix2dote1</span>(unix<span class="op">,</span> zone<span class="op">,</span> offset <span class="op">=</span> <span class="dv">719468</span>) {</span>
<span id="cb81-981"><a href="#cb81-981" aria-hidden="true" tabindex="-1"></a>  <span class="cf">return</span> [</span>
<span id="cb81-982"><a href="#cb81-982" aria-hidden="true" tabindex="-1"></a>    (unix <span class="op">??</span> <span class="bu">Date</span><span class="op">.</span><span class="fu">now</span>()) <span class="op">/</span> <span class="dv">86400000</span></span>
<span id="cb81-983"><a href="#cb81-983" aria-hidden="true" tabindex="-1"></a>    <span class="op">+</span> (zone <span class="op">=</span> zone <span class="op">??</span> (<span class="dv">10</span> <span class="op">-</span> <span class="bu">Math</span><span class="op">.</span><span class="fu">round</span>(</span>
<span id="cb81-984"><a href="#cb81-984" aria-hidden="true" tabindex="-1"></a>        (<span class="kw">new</span> <span class="bu">Date</span>)<span class="op">.</span><span class="fu">getTimezoneOffset</span>() <span class="op">/</span> <span class="dv">144</span>)) <span class="op">%</span> <span class="dv">10</span></span>
<span id="cb81-985"><a href="#cb81-985" aria-hidden="true" tabindex="-1"></a>      ) <span class="op">/</span> <span class="dv">10</span> <span class="op">+</span> offset<span class="op">,</span> zone]</span>
<span id="cb81-986"><a href="#cb81-986" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb81-987"><a href="#cb81-987" aria-hidden="true" tabindex="-1"></a><span class="kw">function</span> <span class="fu">dote2date</span>(dote<span class="op">,</span> zone <span class="op">=</span> <span class="dv">0</span>) {</span>
<span id="cb81-988"><a href="#cb81-988" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> cote <span class="op">=</span> <span class="bu">Math</span><span class="op">.</span><span class="fu">floor</span>((</span>
<span id="cb81-989"><a href="#cb81-989" aria-hidden="true" tabindex="-1"></a>      dote <span class="op">&gt;=</span> <span class="dv">0</span> <span class="op">?</span> dote</span>
<span id="cb81-990"><a href="#cb81-990" aria-hidden="true" tabindex="-1"></a>      <span class="op">:</span> dote <span class="op">-</span> <span class="dv">146096</span></span>
<span id="cb81-991"><a href="#cb81-991" aria-hidden="true" tabindex="-1"></a>    ) <span class="op">/</span> <span class="dv">146097</span>)<span class="op">,</span></span>
<span id="cb81-992"><a href="#cb81-992" aria-hidden="true" tabindex="-1"></a>  dotc <span class="op">=</span> dote <span class="op">-</span> cote <span class="op">*</span> <span class="dv">146097</span><span class="op">,</span></span>
<span id="cb81-993"><a href="#cb81-993" aria-hidden="true" tabindex="-1"></a>  yotc <span class="op">=</span> <span class="bu">Math</span><span class="op">.</span><span class="fu">floor</span>((dotc</span>
<span id="cb81-994"><a href="#cb81-994" aria-hidden="true" tabindex="-1"></a>    <span class="op">-</span> <span class="bu">Math</span><span class="op">.</span><span class="fu">floor</span>(dotc <span class="op">/</span> <span class="dv">1460</span>)</span>
<span id="cb81-995"><a href="#cb81-995" aria-hidden="true" tabindex="-1"></a>    <span class="op">+</span> <span class="bu">Math</span><span class="op">.</span><span class="fu">floor</span>(dotc <span class="op">/</span> <span class="dv">36524</span>)</span>
<span id="cb81-996"><a href="#cb81-996" aria-hidden="true" tabindex="-1"></a>    <span class="op">-</span> <span class="bu">Math</span><span class="op">.</span><span class="fu">floor</span>(dotc <span class="op">/</span> <span class="dv">146096</span>)</span>
<span id="cb81-997"><a href="#cb81-997" aria-hidden="true" tabindex="-1"></a>  ) <span class="op">/</span> <span class="dv">365</span>)<span class="op">;</span></span>
<span id="cb81-998"><a href="#cb81-998" aria-hidden="true" tabindex="-1"></a>  <span class="cf">return</span> [</span>
<span id="cb81-999"><a href="#cb81-999" aria-hidden="true" tabindex="-1"></a>    yotc <span class="op">+</span> cote <span class="op">*</span> <span class="dv">400</span><span class="op">,</span></span>
<span id="cb81-1000"><a href="#cb81-1000" aria-hidden="true" tabindex="-1"></a>    dotc <span class="op">-</span> (yotc <span class="op">*</span> <span class="dv">365</span></span>
<span id="cb81-1001"><a href="#cb81-1001" aria-hidden="true" tabindex="-1"></a>      <span class="op">+</span> <span class="bu">Math</span><span class="op">.</span><span class="fu">floor</span>(yotc <span class="op">/</span> <span class="dv">4</span>)</span>
<span id="cb81-1002"><a href="#cb81-1002" aria-hidden="true" tabindex="-1"></a>      <span class="op">-</span> <span class="bu">Math</span><span class="op">.</span><span class="fu">floor</span>(yotc <span class="op">/</span> <span class="dv">100</span>)</span>
<span id="cb81-1003"><a href="#cb81-1003" aria-hidden="true" tabindex="-1"></a>  )<span class="op">,</span> zone]}</span>
<span id="cb81-1004"><a href="#cb81-1004" aria-hidden="true" tabindex="-1"></a><span class="kw">function</span> <span class="fu">getEot</span>(day) {</span>
<span id="cb81-1005"><a href="#cb81-1005" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> gamma <span class="op">=</span> <span class="dv">2</span> <span class="op">*</span> <span class="bu">Math</span><span class="op">.</span><span class="cn">PI</span> <span class="op">*</span> day <span class="op">/</span> <span class="dv">365</span></span>
<span id="cb81-1006"><a href="#cb81-1006" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> (</span>
<span id="cb81-1007"><a href="#cb81-1007" aria-hidden="true" tabindex="-1"></a>      <span class="fl">0.0011114386869002235</span> <span class="op">+</span></span>
<span id="cb81-1008"><a href="#cb81-1008" aria-hidden="true" tabindex="-1"></a>      <span class="op">-</span><span class="fl">4.155124400404918</span>    <span class="op">*</span> <span class="bu">Math</span><span class="op">.</span><span class="fu">cos</span>(gamma) <span class="op">+</span></span>
<span id="cb81-1009"><a href="#cb81-1009" aria-hidden="true" tabindex="-1"></a>      <span class="op">-</span><span class="fl">2.9710873225303756</span>   <span class="op">*</span> <span class="bu">Math</span><span class="op">.</span><span class="fu">sin</span>(gamma) <span class="op">+</span></span>
<span id="cb81-1010"><a href="#cb81-1010" aria-hidden="true" tabindex="-1"></a>      <span class="op">-</span><span class="fl">4.635570414590801</span>    <span class="op">*</span> <span class="bu">Math</span><span class="op">.</span><span class="fu">cos</span>(<span class="dv">2</span> <span class="op">*</span> gamma) <span class="op">+</span></span>
<span id="cb81-1011"><a href="#cb81-1011" aria-hidden="true" tabindex="-1"></a>      <span class="fl">5.116176940364264</span>     <span class="op">*</span> <span class="bu">Math</span><span class="op">.</span><span class="fu">sin</span>(<span class="dv">2</span> <span class="op">*</span> gamma)</span>
<span id="cb81-1012"><a href="#cb81-1012" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb81-1013"><a href="#cb81-1013" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb81-1014"><a href="#cb81-1014" aria-hidden="true" tabindex="-1"></a><span class="kw">function</span> <span class="fu">getSda</span>(day) {</span>
<span id="cb81-1015"><a href="#cb81-1015" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> gamma <span class="op">=</span> <span class="dv">2</span> <span class="op">*</span> <span class="bu">Math</span><span class="op">.</span><span class="cn">PI</span> <span class="op">*</span> day <span class="op">/</span> <span class="dv">365</span></span>
<span id="cb81-1016"><a href="#cb81-1016" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> (</span>
<span id="cb81-1017"><a href="#cb81-1017" aria-hidden="true" tabindex="-1"></a>      <span class="fl">0.001091553079960761</span>  <span class="op">+</span></span>
<span id="cb81-1018"><a href="#cb81-1018" aria-hidden="true" tabindex="-1"></a>      <span class="op">-</span><span class="fl">0.023117708562197206</span> <span class="op">*</span> <span class="bu">Math</span><span class="op">.</span><span class="fu">cos</span>(gamma) <span class="op">+</span></span>
<span id="cb81-1019"><a href="#cb81-1019" aria-hidden="true" tabindex="-1"></a>      <span class="fl">0.060320423699681706</span>  <span class="op">*</span> <span class="bu">Math</span><span class="op">.</span><span class="fu">sin</span>(gamma) <span class="op">+</span></span>
<span id="cb81-1020"><a href="#cb81-1020" aria-hidden="true" tabindex="-1"></a>      <span class="fl">0.0006152631125526081</span> <span class="op">*</span> <span class="bu">Math</span><span class="op">.</span><span class="fu">cos</span>(<span class="dv">2</span> <span class="op">*</span> gamma) <span class="op">+</span></span>
<span id="cb81-1021"><a href="#cb81-1021" aria-hidden="true" tabindex="-1"></a>      <span class="fl">0.0008981745798778195</span> <span class="op">*</span> <span class="bu">Math</span><span class="op">.</span><span class="fu">sin</span>(<span class="dv">2</span> <span class="op">*</span> gamma)</span>
<span id="cb81-1022"><a href="#cb81-1022" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb81-1023"><a href="#cb81-1023" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb81-1024"><a href="#cb81-1024" aria-hidden="true" tabindex="-1"></a><span class="kw">function</span> <span class="fu">getSha</span>(latitude<span class="op">,</span> solarDeclinationAngle<span class="op">,</span> solarZenithAngle <span class="op">=</span> <span class="fl">0.252314</span>) {</span>
<span id="cb81-1025"><a href="#cb81-1025" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> ratio <span class="op">=</span> (</span>
<span id="cb81-1026"><a href="#cb81-1026" aria-hidden="true" tabindex="-1"></a>    <span class="fu">costau</span>(<span class="op">.</span><span class="dv">252314</span>) <span class="op">-</span> <span class="fu">sintau</span>(latitude) <span class="op">*</span> <span class="fu">sintau</span>(solarDeclinationAngle)) <span class="op">/</span> (</span>
<span id="cb81-1027"><a href="#cb81-1027" aria-hidden="true" tabindex="-1"></a>    <span class="fu">costau</span>(latitude) <span class="op">*</span> <span class="fu">costau</span>(solarDeclinationAngle))</span>
<span id="cb81-1028"><a href="#cb81-1028" aria-hidden="true" tabindex="-1"></a>  <span class="cf">return</span> ratio <span class="op">&gt;=</span> <span class="dv">1</span> <span class="op">?</span> <span class="dv">0</span> <span class="op">:</span> ratio <span class="op">&lt;=</span> <span class="op">-</span><span class="dv">1</span> <span class="op">?</span> <span class="bu">Math</span><span class="op">.</span><span class="cn">PI</span> <span class="op">:</span> <span class="bu">Math</span><span class="op">.</span><span class="fu">acos</span>(ratio)</span>
<span id="cb81-1029"><a href="#cb81-1029" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb81-1030"><a href="#cb81-1030" aria-hidden="true" tabindex="-1"></a>cospi <span class="op">=</span> <span class="pp">require</span>( <span class="st">'https://cdn.jsdelivr.net/gh/stdlib-js/math-base-special-cospi@umd/browser.js'</span> )</span>
<span id="cb81-1031"><a href="#cb81-1031" aria-hidden="true" tabindex="-1"></a>sinpi <span class="op">=</span> <span class="pp">require</span>( <span class="st">'https://cdn.jsdelivr.net/gh/stdlib-js/math-base-special-sinpi@umd/browser.js'</span> )</span>
<span id="cb81-1032"><a href="#cb81-1032" aria-hidden="true" tabindex="-1"></a><span class="kw">function</span> <span class="fu">sintau</span>(turn) {</span>
<span id="cb81-1033"><a href="#cb81-1033" aria-hidden="true" tabindex="-1"></a>  <span class="cf">return</span> <span class="fu">sinpi</span>(<span class="dv">2</span> <span class="op">*</span> turn)<span class="op">;</span></span>
<span id="cb81-1034"><a href="#cb81-1034" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb81-1035"><a href="#cb81-1035" aria-hidden="true" tabindex="-1"></a><span class="kw">function</span> <span class="fu">costau</span>(turn) {</span>
<span id="cb81-1036"><a href="#cb81-1036" aria-hidden="true" tabindex="-1"></a>  <span class="cf">return</span> <span class="fu">cospi</span>(<span class="dv">2</span> <span class="op">*</span> turn)<span class="op">;</span></span>
<span id="cb81-1037"><a href="#cb81-1037" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb81-1038"><a href="#cb81-1038" aria-hidden="true" tabindex="-1"></a>shaRadiMapPlot <span class="op">=</span> <span class="fu">getSha</span>(latTurnMapPlot<span class="op">,</span> <span class="fu">getSda</span>(selYda))</span>
<span id="cb81-1039"><a href="#cb81-1039" aria-hidden="true" tabindex="-1"></a>shaHalfMapPlot <span class="op">=</span> shaRadiMapPlot <span class="op">/</span> <span class="bu">Math</span><span class="op">.</span><span class="cn">PI</span></span>
<span id="cb81-1040"><a href="#cb81-1040" aria-hidden="true" tabindex="-1"></a>shaTurnMapPlot <span class="op">=</span> shaHalfMapPlot <span class="op">/</span> <span class="dv">2</span></span>
<span id="cb81-1041"><a href="#cb81-1041" aria-hidden="true" tabindex="-1"></a>shaDegrMapPlot <span class="op">=</span> shaHalfMapPlot <span class="op">*</span> <span class="dv">180</span></span>
<span id="cb81-1042"><a href="#cb81-1042" aria-hidden="true" tabindex="-1"></a>eotTurnMapPlot <span class="op">=</span> <span class="fu">getEot</span>(selYda) <span class="op">/</span> <span class="dv">1000</span></span>
<span id="cb81-1043"><a href="#cb81-1043" aria-hidden="true" tabindex="-1"></a>lonTurnMapPlot <span class="op">=</span> <span class="fu">long2turn</span>(location[<span class="dv">0</span>]<span class="op">,</span> <span class="dv">0</span>)</span>
<span id="cb81-1044"><a href="#cb81-1044" aria-hidden="true" tabindex="-1"></a>latTurnMapPlot <span class="op">=</span> <span class="fu">lati2turn</span>(location[<span class="dv">1</span>]<span class="op">,</span> <span class="dv">0</span>)</span>
<span id="cb81-1045"><a href="#cb81-1045" aria-hidden="true" tabindex="-1"></a>astDecMapPlot <span class="op">=</span> (<span class="fl">0.95</span> <span class="op">+</span> zeroTime <span class="op">+</span> lonTurnMapPlot <span class="op">+</span> eotTurnMapPlot) <span class="op">%</span> <span class="dv">1</span> <span class="op">*</span> <span class="dv">10</span></span>
<span id="cb81-1046"><a href="#cb81-1046" aria-hidden="true" tabindex="-1"></a>astDegMapPlot <span class="op">=</span> astDecMapPlot <span class="op">*</span> <span class="dv">36</span></span>
<span id="cb81-1047"><a href="#cb81-1047" aria-hidden="true" tabindex="-1"></a>shaDoyInput <span class="op">=</span> <span class="fu">getSha</span>(latInput <span class="op">/</span> <span class="dv">1000</span><span class="op">,</span> <span class="fu">getSda</span>(doyInput))</span>
<span id="cb81-1048"><a href="#cb81-1048" aria-hidden="true" tabindex="-1"></a>daytimeDuration <span class="op">=</span> shaDoyInput <span class="op">/</span> <span class="bu">Math</span><span class="op">.</span><span class="cn">PI</span></span>
<span id="cb81-1049"><a href="#cb81-1049" aria-hidden="true" tabindex="-1"></a>noonDiff <span class="op">=</span> daytimeDuration <span class="op">/</span> <span class="dv">2</span></span>
<span id="cb81-1050"><a href="#cb81-1050" aria-hidden="true" tabindex="-1"></a>dz <span class="op">=</span> <span class="fu">unix2dote</span>(now)</span>
<span id="cb81-1051"><a href="#cb81-1051" aria-hidden="true" tabindex="-1"></a>decYear <span class="op">=</span> ydz[<span class="dv">0</span>]<span class="op">.</span><span class="fu">toString</span>()<span class="op">.</span><span class="fu">padStart</span>(<span class="dv">4</span><span class="op">,</span> <span class="st">"0"</span>)</span>
<span id="cb81-1052"><a href="#cb81-1052" aria-hidden="true" tabindex="-1"></a>zeroDote <span class="op">=</span> <span class="fu">unix2dote</span>(now<span class="op">,</span> <span class="dv">0</span>)[<span class="dv">0</span>]</span>
<span id="cb81-1053"><a href="#cb81-1053" aria-hidden="true" tabindex="-1"></a>zeroTime <span class="op">=</span> zeroDote <span class="op">%</span> <span class="dv">1</span></span>
<span id="cb81-1054"><a href="#cb81-1054" aria-hidden="true" tabindex="-1"></a>zeroDate <span class="op">=</span> <span class="fu">dote2date</span>(zeroDote)</span>
<span id="cb81-1055"><a href="#cb81-1055" aria-hidden="true" tabindex="-1"></a>zeroYear <span class="op">=</span> zeroDate[<span class="dv">0</span>]</span>
<span id="cb81-1056"><a href="#cb81-1056" aria-hidden="true" tabindex="-1"></a>zeroYda <span class="op">=</span> zeroDate[<span class="dv">1</span>]</span>
<span id="cb81-1057"><a href="#cb81-1057" aria-hidden="true" tabindex="-1"></a>zeroDoy <span class="op">=</span> <span class="bu">Math</span><span class="op">.</span><span class="fu">floor</span>(zeroYda)</span>
<span id="cb81-1058"><a href="#cb81-1058" aria-hidden="true" tabindex="-1"></a>zeroIsLeap <span class="op">=</span> <span class="fu">isLeapYear</span>(zeroYear)</span>
<span id="cb81-1059"><a href="#cb81-1059" aria-hidden="true" tabindex="-1"></a>zeroYdaHsl <span class="op">=</span> <span class="fu">textcolor</span>(zeroYda<span class="op">.</span><span class="fu">toFixed</span>(<span class="dv">5</span>)<span class="op">,</span> d3<span class="op">.</span><span class="fu">color</span>(<span class="fu">piecewiseColor</span>(zeroYda <span class="op">/</span> (<span class="dv">365</span> <span class="op">+</span> zeroIsLeap)))<span class="op">.</span><span class="fu">formatHex</span>())</span>
<span id="cb81-1060"><a href="#cb81-1060" aria-hidden="true" tabindex="-1"></a>zeroTimeHsl0 <span class="op">=</span> <span class="fu">textcolor</span>(zeroTime<span class="op">.</span><span class="fu">toFixed</span>(<span class="dv">5</span>)<span class="op">.</span><span class="fu">slice</span>(<span class="dv">1</span>)<span class="op">,</span> d3<span class="op">.</span><span class="fu">color</span>(<span class="fu">piecewiseColor</span>(zeroTime))<span class="op">.</span><span class="fu">formatHex</span>())</span>
<span id="cb81-1061"><a href="#cb81-1061" aria-hidden="true" tabindex="-1"></a>zeroTimeHsl1 <span class="op">=</span> <span class="fu">textcolor</span>(zeroTime<span class="op">.</span><span class="fu">toFixed</span>(<span class="dv">5</span>)<span class="op">.</span><span class="fu">slice</span>(<span class="dv">1</span>)<span class="op">,</span> d3<span class="op">.</span><span class="fu">color</span>(<span class="fu">piecewiseColor</span>(zeroTime))<span class="op">.</span><span class="fu">formatHex</span>())</span>
<span id="cb81-1062"><a href="#cb81-1062" aria-hidden="true" tabindex="-1"></a>zeroTimeHsl2 <span class="op">=</span> <span class="fu">textcolor</span>((zeroTime <span class="op">*</span> <span class="dv">10</span>)<span class="op">.</span><span class="fu">toFixed</span>(<span class="dv">4</span>)<span class="op">,</span> d3<span class="op">.</span><span class="fu">color</span>(<span class="fu">piecewiseColor</span>(zeroTime))<span class="op">.</span><span class="fu">formatHex</span>())</span>
<span id="cb81-1063"><a href="#cb81-1063" aria-hidden="true" tabindex="-1"></a>zeroTimeHsl3 <span class="op">=</span> <span class="fu">textcolor</span>((zeroTime <span class="op">*</span> <span class="dv">10</span>)<span class="op">.</span><span class="fu">toFixed</span>(<span class="dv">4</span>)<span class="op">,</span> d3<span class="op">.</span><span class="fu">color</span>(<span class="fu">piecewiseColor</span>(zeroTime))<span class="op">.</span><span class="fu">formatHex</span>())</span>
<span id="cb81-1064"><a href="#cb81-1064" aria-hidden="true" tabindex="-1"></a>zeroTimeHsl4 <span class="op">=</span> <span class="fu">textcolor</span>((zeroTime <span class="op">*</span> <span class="dv">10</span>)<span class="op">.</span><span class="fu">toFixed</span>(<span class="dv">4</span>)<span class="op">,</span> d3<span class="op">.</span><span class="fu">color</span>(<span class="fu">piecewiseColor</span>(zeroTime))<span class="op">.</span><span class="fu">formatHex</span>())</span>
<span id="cb81-1065"><a href="#cb81-1065" aria-hidden="true" tabindex="-1"></a>zeroTimeHsl5 <span class="op">=</span> <span class="fu">textcolor</span>((zeroTime <span class="op">*</span> <span class="dv">10</span>)<span class="op">.</span><span class="fu">toFixed</span>(<span class="dv">5</span>)<span class="op">,</span> d3<span class="op">.</span><span class="fu">color</span>(<span class="fu">piecewiseColor</span>(zeroTime))<span class="op">.</span><span class="fu">formatHex</span>())</span>
<span id="cb81-1066"><a href="#cb81-1066" aria-hidden="true" tabindex="-1"></a>zeroDotyHsl <span class="op">=</span> <span class="fu">textcolor</span>(zeroDoy<span class="op">.</span><span class="fu">toString</span>()<span class="op">.</span><span class="fu">padStart</span>(<span class="dv">3</span><span class="op">,</span> <span class="st">"0"</span>)<span class="op">,</span> d3<span class="op">.</span><span class="fu">color</span>(<span class="fu">piecewiseColor</span>(zeroDoy <span class="op">/</span> (<span class="dv">365</span> <span class="op">+</span> zeroIsLeap)))<span class="op">.</span><span class="fu">formatHex</span>())</span>
<span id="cb81-1067"><a href="#cb81-1067" aria-hidden="true" tabindex="-1"></a>zeroDoteHsl <span class="op">=</span> <span class="fu">textcolor</span>(zeroDote<span class="op">.</span><span class="fu">toFixed</span>(<span class="dv">5</span>)<span class="op">,</span> d3<span class="op">.</span><span class="fu">color</span>(<span class="fu">piecewiseColor</span>(zeroDote <span class="op">%</span> <span class="dv">1</span>))<span class="op">.</span><span class="fu">formatHex</span>())</span>
<span id="cb81-1068"><a href="#cb81-1068" aria-hidden="true" tabindex="-1"></a>zeroYearHsl <span class="op">=</span> <span class="fu">textcolor</span>(zeroYear<span class="op">,</span> d3<span class="op">.</span><span class="fu">color</span>(<span class="fu">piecewiseColor</span>(zeroYear <span class="op">%</span> <span class="dv">1000</span> <span class="op">/</span> <span class="dv">1000</span>))<span class="op">.</span><span class="fu">formatHex</span>())</span>
<span id="cb81-1069"><a href="#cb81-1069" aria-hidden="true" tabindex="-1"></a>browserDote <span class="op">=</span> <span class="fu">unix2dote</span>(now)</span>
<span id="cb81-1070"><a href="#cb81-1070" aria-hidden="true" tabindex="-1"></a>browserTime <span class="op">=</span> browserDote[<span class="dv">0</span>] <span class="op">%</span> <span class="dv">1</span> <span class="op">*</span> <span class="dv">10</span></span>
<span id="cb81-1071"><a href="#cb81-1071" aria-hidden="true" tabindex="-1"></a>browserZone <span class="op">=</span> browserDote[<span class="dv">1</span>]</span>
<span id="cb81-1072"><a href="#cb81-1072" aria-hidden="true" tabindex="-1"></a>browserSign <span class="op">=</span> browserZone <span class="op">&gt;</span> <span class="dv">0</span> <span class="op">?</span> <span class="st">"-"</span> <span class="op">:</span> <span class="st">"+"</span></span>
<span id="cb81-1073"><a href="#cb81-1073" aria-hidden="true" tabindex="-1"></a>zone0time <span class="op">=</span> (browserTime <span class="op">-</span> browserZone <span class="op">+</span> <span class="dv">10</span>) <span class="op">%</span> <span class="dv">10</span></span>
<span id="cb81-1074"><a href="#cb81-1074" aria-hidden="true" tabindex="-1"></a>hours <span class="op">=</span> browserTime <span class="op">*</span> <span class="fl">2.4</span></span>
<span id="cb81-1075"><a href="#cb81-1075" aria-hidden="true" tabindex="-1"></a>minutes <span class="op">=</span> hours <span class="op">%</span> <span class="dv">1</span> <span class="op">*</span> <span class="dv">60</span></span>
<span id="cb81-1076"><a href="#cb81-1076" aria-hidden="true" tabindex="-1"></a>seconds <span class="op">=</span> minutes <span class="op">%</span> <span class="dv">1</span> <span class="op">*</span> <span class="dv">60</span></span>
<span id="cb81-1077"><a href="#cb81-1077" aria-hidden="true" tabindex="-1"></a>selectedDote <span class="op">=</span> <span class="fu">unix2dote</span>(now<span class="op">,</span> <span class="fu">long2zone</span>(location[<span class="dv">0</span>]))</span>
<span id="cb81-1078"><a href="#cb81-1078" aria-hidden="true" tabindex="-1"></a>selectedExact <span class="op">=</span> selectedDote[<span class="dv">0</span>] <span class="op">%</span> <span class="dv">1</span></span>
<span id="cb81-1079"><a href="#cb81-1079" aria-hidden="true" tabindex="-1"></a>selectedExactN <span class="op">=</span> (<span class="dv">1</span> <span class="op">-</span> selectedExact) <span class="op">%</span> <span class="dv">1</span></span>
<span id="cb81-1080"><a href="#cb81-1080" aria-hidden="true" tabindex="-1"></a>selectedZone <span class="op">=</span> selectedDote[<span class="dv">1</span>]</span>
<span id="cb81-1081"><a href="#cb81-1081" aria-hidden="true" tabindex="-1"></a>ydz <span class="op">=</span> <span class="fu">dote2date</span>(<span class="op">...</span>selectedDote)</span>
<span id="cb81-1082"><a href="#cb81-1082" aria-hidden="true" tabindex="-1"></a>decDate <span class="op">=</span> <span class="bu">Math</span><span class="op">.</span><span class="fu">floor</span>(ydz[<span class="dv">1</span>])</span>
<span id="cb81-1083"><a href="#cb81-1083" aria-hidden="true" tabindex="-1"></a>decTime <span class="op">=</span> (selectedExact <span class="op">*</span> <span class="dv">10</span>)<span class="op">.</span><span class="fu">toFixed</span>(<span class="dv">4</span>)</span>
<span id="cb81-1084"><a href="#cb81-1084" aria-hidden="true" tabindex="-1"></a>decTimeN <span class="op">=</span> (selectedExactN <span class="op">*</span> <span class="dv">10</span>)<span class="op">.</span><span class="fu">toFixed</span>(<span class="dv">4</span>)</span>
<span id="cb81-1085"><a href="#cb81-1085" aria-hidden="true" tabindex="-1"></a>barDD <span class="op">=</span> decTime[<span class="dv">0</span>]</span>
<span id="cb81-1086"><a href="#cb81-1086" aria-hidden="true" tabindex="-1"></a>barDDN <span class="op">=</span> decTimeN[<span class="dv">0</span>]</span>
<span id="cb81-1087"><a href="#cb81-1087" aria-hidden="true" tabindex="-1"></a>barMils <span class="op">=</span> decTime<span class="op">.</span><span class="fu">slice</span>(<span class="dv">2</span><span class="op">,</span> <span class="dv">4</span>)</span>
<span id="cb81-1088"><a href="#cb81-1088" aria-hidden="true" tabindex="-1"></a>barMilsN <span class="op">=</span> decTimeN<span class="op">.</span><span class="fu">slice</span>(<span class="dv">2</span><span class="op">,</span> <span class="dv">4</span>)</span>
<span id="cb81-1089"><a href="#cb81-1089" aria-hidden="true" tabindex="-1"></a>barBeats <span class="op">=</span> decTime<span class="op">.</span><span class="fu">slice</span>(<span class="dv">4</span><span class="op">,</span> <span class="dv">6</span>)</span>
<span id="cb81-1090"><a href="#cb81-1090" aria-hidden="true" tabindex="-1"></a>barBeatsN <span class="op">=</span> decTimeN<span class="op">.</span><span class="fu">slice</span>(<span class="dv">4</span><span class="op">,</span> <span class="dv">6</span>)</span>
<span id="cb81-1091"><a href="#cb81-1091" aria-hidden="true" tabindex="-1"></a><span class="kw">function</span> <span class="fu">lati2turn</span>(degrees <span class="op">=</span> <span class="op">-</span><span class="dv">180</span><span class="op">,</span> e <span class="op">=</span> <span class="dv">3</span>) {</span>
<span id="cb81-1092"><a href="#cb81-1092" aria-hidden="true" tabindex="-1"></a>  <span class="co">// turns: e=0, deciturns: e=1, etc.</span></span>
<span id="cb81-1093"><a href="#cb81-1093" aria-hidden="true" tabindex="-1"></a>  <span class="cf">return</span> (degrees <span class="op">%=</span> <span class="dv">360</span>) <span class="op">/</span> (<span class="dv">360</span> <span class="op">/</span> <span class="dv">10</span><span class="op">**</span>e) <span class="op">%</span> <span class="dv">10</span><span class="op">**</span>e<span class="op">;</span></span>
<span id="cb81-1094"><a href="#cb81-1094" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb81-1095"><a href="#cb81-1095" aria-hidden="true" tabindex="-1"></a>graticule <span class="op">=</span> d3<span class="op">.</span><span class="fu">geoGraticule</span>()<span class="op">.</span><span class="fu">stepMinor</span>([<span class="dv">36</span><span class="op">,</span><span class="dv">36</span>])<span class="op">.</span><span class="fu">stepMajor</span>([<span class="dv">36</span><span class="op">,</span><span class="dv">36</span>])()</span>
<span id="cb81-1096"><a href="#cb81-1096" aria-hidden="true" tabindex="-1"></a>graticule<span class="op">.</span><span class="at">coordinates</span> <span class="op">=</span> graticule<span class="op">.</span><span class="at">coordinates</span><span class="op">.</span><span class="fu">map</span>(</span>
<span id="cb81-1097"><a href="#cb81-1097" aria-hidden="true" tabindex="-1"></a>  i <span class="kw">=&gt;</span> i<span class="op">.</span><span class="fu">map</span>(j <span class="kw">=&gt;</span> j<span class="op">.</span><span class="fu">map</span>((k<span class="op">,</span> index<span class="op">,</span> arr) <span class="kw">=&gt;</span> i<span class="op">.</span><span class="at">length</span> <span class="op">===</span> <span class="dv">3</span> <span class="op">&amp;&amp;</span> index <span class="op">===</span> <span class="dv">0</span> <span class="op">?</span> k <span class="op">-</span> <span class="dv">18</span> <span class="op">:</span> k))</span>
<span id="cb81-1098"><a href="#cb81-1098" aria-hidden="true" tabindex="-1"></a>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-display hidden">
<div>
<div id="ojs-cell-25-1" data-nodetype="declaration">

</div>
</div>
</div>
<div class="cell-output cell-output-display hidden">
<div>
<div id="ojs-cell-25-2" data-nodetype="declaration">

</div>
</div>
</div>
<div class="cell-output cell-output-display hidden">
<div>
<div id="ojs-cell-25-3" data-nodetype="declaration">

</div>
</div>
</div>
<div class="cell-output cell-output-display hidden">
<div>
<div id="ojs-cell-25-4" data-nodetype="declaration">

</div>
</div>
</div>
<div class="cell-output cell-output-display hidden">
<div>
<div id="ojs-cell-25-5" data-nodetype="declaration">

</div>
</div>
</div>
<div class="cell-output cell-output-display hidden">
<div>
<div id="ojs-cell-25-6" data-nodetype="declaration">

</div>
</div>
</div>
<div class="cell-output cell-output-display hidden">
<div>
<div id="ojs-cell-25-7" data-nodetype="declaration">

</div>
</div>
</div>
<div class="cell-output cell-output-display hidden">
<div>
<div id="ojs-cell-25-8" data-nodetype="declaration">

</div>
</div>
</div>
<div class="cell-output cell-output-display hidden">
<div>
<div id="ojs-cell-25-9" data-nodetype="declaration">

</div>
</div>
</div>
<div class="cell-output cell-output-display hidden">
<div>
<div id="ojs-cell-25-10" data-nodetype="declaration">

</div>
</div>
</div>
<div class="cell-output cell-output-display hidden">
<div>
<div id="ojs-cell-25-11" data-nodetype="declaration">

</div>
</div>
</div>
<div class="cell-output cell-output-display hidden">
<div>
<div id="ojs-cell-25-12" data-nodetype="declaration">

</div>
</div>
</div>
<div class="cell-output cell-output-display hidden">
<div>
<div id="ojs-cell-25-13" data-nodetype="declaration">

</div>
</div>
</div>
<div class="cell-output cell-output-display hidden">
<div>
<div id="ojs-cell-25-14" data-nodetype="declaration">

</div>
</div>
</div>
<div class="cell-output cell-output-display hidden">
<div>
<div id="ojs-cell-25-15" data-nodetype="declaration">

</div>
</div>
</div>
<div class="cell-output cell-output-display hidden">
<div>
<div id="ojs-cell-25-16" data-nodetype="declaration">

</div>
</div>
</div>
<div class="cell-output cell-output-display hidden">
<div>
<div id="ojs-cell-25-17" data-nodetype="declaration">

</div>
</div>
</div>
<div class="cell-output cell-output-display hidden">
<div>
<div id="ojs-cell-25-18" data-nodetype="declaration">

</div>
</div>
</div>
<div class="cell-output cell-output-display hidden">
<div>
<div id="ojs-cell-25-19" data-nodetype="declaration">

</div>
</div>
</div>
<div class="cell-output cell-output-display hidden">
<div>
<div id="ojs-cell-25-20" data-nodetype="declaration">

</div>
</div>
</div>
<div class="cell-output cell-output-display hidden">
<div>
<div id="ojs-cell-25-21" data-nodetype="declaration">

</div>
</div>
</div>
<div class="cell-output cell-output-display hidden">
<div>
<div id="ojs-cell-25-22" data-nodetype="declaration">

</div>
</div>
</div>
<div class="cell-output cell-output-display hidden">
<div>
<div id="ojs-cell-25-23" data-nodetype="declaration">

</div>
</div>
</div>
<div class="cell-output cell-output-display hidden">
<div>
<div id="ojs-cell-25-24" data-nodetype="declaration">

</div>
</div>
</div>
<div class="cell-output cell-output-display hidden">
<div>
<div id="ojs-cell-25-25" data-nodetype="declaration">

</div>
</div>
</div>
<div class="cell-output cell-output-display hidden">
<div>
<div id="ojs-cell-25-26" data-nodetype="declaration">

</div>
</div>
</div>
<div class="cell-output cell-output-display hidden">
<div>
<div id="ojs-cell-25-27" data-nodetype="declaration">

</div>
</div>
</div>
<div class="cell-output cell-output-display hidden">
<div>
<div id="ojs-cell-25-28" data-nodetype="declaration">

</div>
</div>
</div>
<div class="cell-output cell-output-display hidden">
<div>
<div id="ojs-cell-25-29" data-nodetype="declaration">

</div>
</div>
</div>
<div class="cell-output cell-output-display hidden">
<div>
<div id="ojs-cell-25-30" data-nodetype="declaration">

</div>
</div>
</div>
<div class="cell-output cell-output-display hidden">
<div>
<div id="ojs-cell-25-31" data-nodetype="declaration">

</div>
</div>
</div>
<div class="cell-output cell-output-display hidden">
<div>
<div id="ojs-cell-25-32" data-nodetype="declaration">

</div>
</div>
</div>
<div class="cell-output cell-output-display hidden">
<div>
<div id="ojs-cell-25-33" data-nodetype="declaration">

</div>
</div>
</div>
<div class="cell-output cell-output-display hidden">
<div>
<div id="ojs-cell-25-34" data-nodetype="declaration">

</div>
</div>
</div>
<div class="cell-output cell-output-display hidden">
<div>
<div id="ojs-cell-25-35" data-nodetype="declaration">

</div>
</div>
</div>
<div class="cell-output cell-output-display hidden">
<div>
<div id="ojs-cell-25-36" data-nodetype="declaration">

</div>
</div>
</div>
<div class="cell-output cell-output-display hidden">
<div>
<div id="ojs-cell-25-37" data-nodetype="declaration">

</div>
</div>
</div>
<div class="cell-output cell-output-display hidden">
<div>
<div id="ojs-cell-25-38" data-nodetype="declaration">

</div>
</div>
</div>
<div class="cell-output cell-output-display hidden">
<div>
<div id="ojs-cell-25-39" data-nodetype="declaration">

</div>
</div>
</div>
<div class="cell-output cell-output-display hidden">
<div>
<div id="ojs-cell-25-40" data-nodetype="declaration">

</div>
</div>
</div>
<div class="cell-output cell-output-display hidden">
<div>
<div id="ojs-cell-25-41" data-nodetype="declaration">

</div>
</div>
</div>
<div class="cell-output cell-output-display hidden">
<div>
<div id="ojs-cell-25-42" data-nodetype="declaration">

</div>
</div>
</div>
<div class="cell-output cell-output-display hidden">
<div>
<div id="ojs-cell-25-43" data-nodetype="declaration">

</div>
</div>
</div>
<div class="cell-output cell-output-display hidden">
<div>
<div id="ojs-cell-25-44" data-nodetype="declaration">

</div>
</div>
</div>
<div class="cell-output cell-output-display hidden">
<div>
<div id="ojs-cell-25-45" data-nodetype="declaration">

</div>
</div>
</div>
<div class="cell-output cell-output-display hidden">
<div>
<div id="ojs-cell-25-46" data-nodetype="declaration">

</div>
</div>
</div>
<div class="cell-output cell-output-display hidden">
<div>
<div id="ojs-cell-25-47" data-nodetype="declaration">

</div>
</div>
</div>
<div class="cell-output cell-output-display hidden">
<div>
<div id="ojs-cell-25-48" data-nodetype="declaration">

</div>
</div>
</div>
<div class="cell-output cell-output-display hidden">
<div>
<div id="ojs-cell-25-49" data-nodetype="declaration">

</div>
</div>
</div>
<div class="cell-output cell-output-display hidden">
<div>
<div id="ojs-cell-25-50" data-nodetype="declaration">

</div>
</div>
</div>
<div class="cell-output cell-output-display hidden">
<div>
<div id="ojs-cell-25-51" data-nodetype="declaration">

</div>
</div>
</div>
<div class="cell-output cell-output-display hidden">
<div>
<div id="ojs-cell-25-52" data-nodetype="declaration">

</div>
</div>
</div>
<div class="cell-output cell-output-display hidden">
<div>
<div id="ojs-cell-25-53" data-nodetype="declaration">

</div>
</div>
</div>
<div class="cell-output cell-output-display hidden">
<div>
<div id="ojs-cell-25-54" data-nodetype="declaration">

</div>
</div>
</div>
<div class="cell-output cell-output-display hidden">
<div>
<div id="ojs-cell-25-55" data-nodetype="declaration">

</div>
</div>
</div>
<div class="cell-output cell-output-display hidden">
<div>
<div id="ojs-cell-25-56" data-nodetype="declaration">

</div>
</div>
</div>
<div class="cell-output cell-output-display hidden">
<div>
<div id="ojs-cell-25-57" data-nodetype="declaration">

</div>
</div>
</div>
<div class="cell-output cell-output-display hidden">
<div>
<div id="ojs-cell-25-58" data-nodetype="declaration">

</div>
</div>
</div>
<div class="cell-output cell-output-display hidden">
<div>
<div id="ojs-cell-25-59" data-nodetype="declaration">

</div>
</div>
</div>
<div class="cell-output cell-output-display hidden">
<div>
<div id="ojs-cell-25-60" data-nodetype="declaration">

</div>
</div>
</div>
<div class="cell-output cell-output-display hidden">
<div>
<div id="ojs-cell-25-61" data-nodetype="declaration">

</div>
</div>
</div>
<div class="cell-output cell-output-display hidden">
<div>
<div id="ojs-cell-25-62" data-nodetype="declaration">

</div>
</div>
</div>
<div class="cell-output cell-output-display hidden">
<div>
<div id="ojs-cell-25-63" data-nodetype="declaration">

</div>
</div>
</div>
<div class="cell-output cell-output-display hidden">
<div>
<div id="ojs-cell-25-64" data-nodetype="declaration">

</div>
</div>
</div>
<div class="cell-output cell-output-display hidden">
<div>
<div id="ojs-cell-25-65" data-nodetype="declaration">

</div>
</div>
</div>
<div class="cell-output cell-output-display hidden">
<div>
<div id="ojs-cell-25-66" data-nodetype="expression">

</div>
</div>
</div>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code hidden" id="cb82" data-startfrom="1099" data-source-offset="-4989"><pre class="sourceCode js code-with-copy"><code class="sourceCode javascript" style="counter-reset: source-line 1098;"><span id="cb82-1099"><a href="#cb82-1099" aria-hidden="true" tabindex="-1"></a><span class="kw">function</span> <span class="fu">turn2degr</span>(turns <span class="op">=</span> <span class="op">-</span><span class="dv">500</span><span class="op">,</span> e <span class="op">=</span> <span class="dv">3</span>) {</span>
<span id="cb82-1100"><a href="#cb82-1100" aria-hidden="true" tabindex="-1"></a>  <span class="co">// turns: e=0, deciturns: e=1, etc.</span></span>
<span id="cb82-1101"><a href="#cb82-1101" aria-hidden="true" tabindex="-1"></a>  <span class="cf">return</span> turns <span class="op">%</span> <span class="dv">10</span><span class="op">**</span>e <span class="op">*</span> (<span class="dv">360</span> <span class="op">/</span> <span class="dv">10</span><span class="op">**</span>e)</span>
<span id="cb82-1102"><a href="#cb82-1102" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb82-1103"><a href="#cb82-1103" aria-hidden="true" tabindex="-1"></a><span class="kw">function</span> <span class="fu">turn2long</span>(turns <span class="op">=</span> <span class="op">-</span><span class="dv">500</span><span class="op">,</span> e <span class="op">=</span> <span class="dv">3</span>) {</span>
<span id="cb82-1104"><a href="#cb82-1104" aria-hidden="true" tabindex="-1"></a>  <span class="co">// turns: e=0, deciturns: e=1, etc.</span></span>
<span id="cb82-1105"><a href="#cb82-1105" aria-hidden="true" tabindex="-1"></a>  <span class="cf">return</span> turns <span class="op">%</span> <span class="dv">10</span><span class="op">**</span>e <span class="op">*</span> (<span class="dv">360</span> <span class="op">/</span> <span class="dv">10</span><span class="op">**</span>e) <span class="op">-</span> <span class="dv">18</span></span>
<span id="cb82-1106"><a href="#cb82-1106" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb82-1107"><a href="#cb82-1107" aria-hidden="true" tabindex="-1"></a><span class="kw">function</span> <span class="fu">long2turn</span>(degrees <span class="op">=</span> <span class="op">-</span><span class="dv">180</span><span class="op">,</span> e <span class="op">=</span> <span class="dv">3</span>) {</span>
<span id="cb82-1108"><a href="#cb82-1108" aria-hidden="true" tabindex="-1"></a>  <span class="co">// turns: e=0, deciturns: e=1, etc.</span></span>
<span id="cb82-1109"><a href="#cb82-1109" aria-hidden="true" tabindex="-1"></a>  <span class="cf">return</span> (((degrees <span class="op">%=</span> <span class="dv">360</span>) <span class="op">&lt;</span> <span class="dv">0</span> <span class="op">?</span> degrees <span class="op">+</span> <span class="dv">360</span> <span class="op">:</span> degrees) <span class="op">+</span> <span class="dv">18</span>) <span class="op">/</span> (<span class="dv">360</span> <span class="op">/</span> <span class="dv">10</span><span class="op">**</span>e) <span class="op">%</span> <span class="dv">10</span><span class="op">**</span>e<span class="op">;</span></span>
<span id="cb82-1110"><a href="#cb82-1110" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb82-1111"><a href="#cb82-1111" aria-hidden="true" tabindex="-1"></a><span class="co">// https://github.com/topojson/world-atlas</span></span>
<span id="cb82-1112"><a href="#cb82-1112" aria-hidden="true" tabindex="-1"></a>world <span class="op">=</span> d3<span class="op">.</span><span class="fu">json</span>(<span class="st">"https://cdn.jsdelivr.net/npm/world-atlas@2/countries-110m.json"</span>)</span>
<span id="cb82-1113"><a href="#cb82-1113" aria-hidden="true" tabindex="-1"></a><span class="co">// countries = topojson.feature(world, world.objects.countries)</span></span>
<span id="cb82-1114"><a href="#cb82-1114" aria-hidden="true" tabindex="-1"></a>topojson <span class="op">=</span> <span class="pp">require</span>(<span class="st">"topojson-client@3"</span>)</span>
<span id="cb82-1115"><a href="#cb82-1115" aria-hidden="true" tabindex="-1"></a><span class="kw">function</span> <span class="fu">long2zone</span>(degrees <span class="op">=</span> <span class="op">-</span><span class="dv">180</span>) {</span>
<span id="cb82-1116"><a href="#cb82-1116" aria-hidden="true" tabindex="-1"></a>  <span class="cf">return</span> <span class="bu">Math</span><span class="op">.</span><span class="fu">floor</span>(<span class="fu">long2turn</span>(degrees<span class="op">,</span> <span class="dv">1</span>))<span class="op">;</span></span>
<span id="cb82-1117"><a href="#cb82-1117" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb82-1118"><a href="#cb82-1118" aria-hidden="true" tabindex="-1"></a><span class="kw">function</span> <span class="fu">year2leap</span>(year <span class="op">=</span> <span class="dv">1970</span>) {</span>
<span id="cb82-1119"><a href="#cb82-1119" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> year <span class="op">%</span> <span class="dv">4</span> <span class="op">==</span> <span class="dv">0</span> <span class="op">&amp;&amp;</span> year <span class="op">%</span> <span class="dv">100</span> <span class="op">!=</span> <span class="dv">0</span> <span class="op">||</span> year <span class="op">%</span> <span class="dv">400</span> <span class="op">==</span> <span class="dv">0</span><span class="op">;</span></span>
<span id="cb82-1120"><a href="#cb82-1120" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb82-1121"><a href="#cb82-1121" aria-hidden="true" tabindex="-1"></a><span class="co">// https://observablehq.com/@dbridges/visualizing-seasonal-daylight</span></span>
<span id="cb82-1122"><a href="#cb82-1122" aria-hidden="true" tabindex="-1"></a>solarSystem <span class="op">=</span> (<span class="bu">root</span><span class="op">,</span> vizwidth<span class="op">,</span> location<span class="op">,</span> date<span class="op">,</span> hour<span class="op">,</span> darkmode) <span class="kw">=&gt;</span> {</span>
<span id="cb82-1123"><a href="#cb82-1123" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> earthRadius <span class="op">=</span> <span class="fl">0.065</span> <span class="op">*</span> vizwidth<span class="op">;</span></span>
<span id="cb82-1124"><a href="#cb82-1124" aria-hidden="true" tabindex="-1"></a>  <span class="co">// const sunRadius = 0.015 * vizwidth;</span></span>
<span id="cb82-1125"><a href="#cb82-1125" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> solarSystemRadius <span class="op">=</span> vizwidth <span class="op">/</span> <span class="dv">2</span> <span class="op">-</span> (vizwidth <span class="op">&lt;</span> <span class="dv">500</span> <span class="op">?</span> <span class="dv">4</span> <span class="op">:</span> <span class="dv">20</span>)<span class="op">;</span></span>
<span id="cb82-1126"><a href="#cb82-1126" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> stretch <span class="op">=</span> <span class="fl">0.06</span><span class="op">;</span></span>
<span id="cb82-1127"><a href="#cb82-1127" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> solarAngle <span class="op">=</span> <span class="fu">getSolarAngle</span>(date)<span class="op">;</span></span>
<span id="cb82-1128"><a href="#cb82-1128" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> solarAngleDeg <span class="op">=</span> (solarAngle <span class="op">*</span> <span class="dv">180</span>) <span class="op">/</span> <span class="bu">Math</span><span class="op">.</span><span class="cn">PI</span><span class="op">;</span></span>
<span id="cb82-1129"><a href="#cb82-1129" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> x <span class="op">=</span> solarSystemRadius <span class="op">*</span> <span class="bu">Math</span><span class="op">.</span><span class="fu">sin</span>(solarAngle)<span class="op">;</span></span>
<span id="cb82-1130"><a href="#cb82-1130" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> y <span class="op">=</span> stretch <span class="op">*</span> solarSystemRadius <span class="op">*</span> <span class="bu">Math</span><span class="op">.</span><span class="fu">cos</span>(solarAngle)<span class="op">;</span></span>
<span id="cb82-1131"><a href="#cb82-1131" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> spin <span class="op">=</span> <span class="dv">180</span> <span class="op">+</span> <span class="op">-</span>location[<span class="dv">0</span>] <span class="op">+</span> solarAngleDeg <span class="op">+</span> <span class="dv">360</span> <span class="op">*</span> ((hour <span class="op">+</span> <span class="dv">12</span>) <span class="op">/</span> <span class="dv">24</span>)<span class="op">;</span></span>
<span id="cb82-1132"><a href="#cb82-1132" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> earthGeo <span class="op">=</span> { <span class="dt">type</span><span class="op">:</span> <span class="st">"Sphere"</span> }<span class="op">;</span></span>
<span id="cb82-1133"><a href="#cb82-1133" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> projection <span class="op">=</span> d3</span>
<span id="cb82-1134"><a href="#cb82-1134" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">geoOrthographic</span>()</span>
<span id="cb82-1135"><a href="#cb82-1135" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">fitWidth</span>(earthRadius <span class="op">*</span> <span class="dv">2</span><span class="op">,</span> earthGeo)</span>
<span id="cb82-1136"><a href="#cb82-1136" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">rotate</span>([spin<span class="op">,</span> <span class="dv">0</span><span class="op">,</span> <span class="fl">23.5</span>])</span>
<span id="cb82-1137"><a href="#cb82-1137" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">translate</span>([<span class="dv">0</span><span class="op">,</span> <span class="dv">0</span>])<span class="op">;</span></span>
<span id="cb82-1138"><a href="#cb82-1138" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> staticProjection <span class="op">=</span> d3</span>
<span id="cb82-1139"><a href="#cb82-1139" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">geoOrthographic</span>()</span>
<span id="cb82-1140"><a href="#cb82-1140" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">fitWidth</span>(earthRadius <span class="op">*</span> <span class="dv">2</span><span class="op">,</span> earthGeo)</span>
<span id="cb82-1141"><a href="#cb82-1141" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">rotate</span>([solarAngleDeg <span class="op">-</span> <span class="dv">90</span><span class="op">,</span> <span class="dv">0</span>])</span>
<span id="cb82-1142"><a href="#cb82-1142" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">translate</span>([<span class="dv">0</span><span class="op">,</span> <span class="dv">0</span>])<span class="op">;</span></span>
<span id="cb82-1143"><a href="#cb82-1143" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> path <span class="op">=</span> d3<span class="op">.</span><span class="fu">geoPath</span>(projection)<span class="op">.</span><span class="fu">pointRadius</span>(<span class="fl">1.5</span>)<span class="op">;</span></span>
<span id="cb82-1144"><a href="#cb82-1144" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> staticPath <span class="op">=</span> d3<span class="op">.</span><span class="fu">geoPath</span>(staticProjection)<span class="op">;</span></span>
<span id="cb82-1145"><a href="#cb82-1145" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> oceanColor <span class="op">=</span> darkmode <span class="op">?</span> <span class="st">"#007FFF"</span> <span class="op">:</span> mapcolors<span class="op">.</span><span class="at">ocean</span><span class="op">;</span></span>
<span id="cb82-1146"><a href="#cb82-1146" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> landColor <span class="op">=</span> darkmode <span class="op">?</span> <span class="st">"#0808"</span> <span class="op">:</span> mapcolors<span class="op">.</span><span class="at">land</span><span class="op">;</span></span>
<span id="cb82-1147"><a href="#cb82-1147" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> borderColor <span class="op">=</span> darkmode <span class="op">?</span> <span class="st">"#eee"</span> <span class="op">:</span> <span class="st">"#333"</span><span class="op">;</span></span>
<span id="cb82-1148"><a href="#cb82-1148" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> solarSystem <span class="op">=</span> <span class="bu">root</span></span>
<span id="cb82-1149"><a href="#cb82-1149" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">append</span>(<span class="st">"g"</span>)</span>
<span id="cb82-1150"><a href="#cb82-1150" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">"transform"</span><span class="op">,</span> <span class="vs">`translate(</span><span class="sc">${</span>vizwidth <span class="op">/</span> <span class="dv">2</span><span class="sc">}</span><span class="vs">)`</span>)<span class="op">;</span></span>
<span id="cb82-1151"><a href="#cb82-1151" aria-hidden="true" tabindex="-1"></a>  <span class="co">// solarSystem.append("circle").attr("r", sunRadius).attr("fill", colors.sun);</span></span>
<span id="cb82-1152"><a href="#cb82-1152" aria-hidden="true" tabindex="-1"></a>  <span class="co">/* Draw orbit */</span></span>
<span id="cb82-1153"><a href="#cb82-1153" aria-hidden="true" tabindex="-1"></a>    solarSystem</span>
<span id="cb82-1154"><a href="#cb82-1154" aria-hidden="true" tabindex="-1"></a>      <span class="op">.</span><span class="fu">append</span>(<span class="st">"ellipse"</span>)</span>
<span id="cb82-1155"><a href="#cb82-1155" aria-hidden="true" tabindex="-1"></a>      <span class="op">.</span><span class="fu">attr</span>(<span class="st">"rx"</span><span class="op">,</span> solarSystemRadius)</span>
<span id="cb82-1156"><a href="#cb82-1156" aria-hidden="true" tabindex="-1"></a>      <span class="op">.</span><span class="fu">attr</span>(<span class="st">"ry"</span><span class="op">,</span> stretch <span class="op">*</span> solarSystemRadius)</span>
<span id="cb82-1157"><a href="#cb82-1157" aria-hidden="true" tabindex="-1"></a>      <span class="op">.</span><span class="fu">attr</span>(<span class="st">"fill"</span><span class="op">,</span> <span class="st">"none"</span>)</span>
<span id="cb82-1158"><a href="#cb82-1158" aria-hidden="true" tabindex="-1"></a>      <span class="op">.</span><span class="fu">attr</span>(<span class="st">"stroke-width"</span><span class="op">,</span> <span class="st">"1.25"</span>)</span>
<span id="cb82-1159"><a href="#cb82-1159" aria-hidden="true" tabindex="-1"></a>      <span class="op">.</span><span class="fu">attr</span>(<span class="st">"stroke"</span><span class="op">,</span> <span class="st">"black"</span>)<span class="op">;</span></span>
<span id="cb82-1160"><a href="#cb82-1160" aria-hidden="true" tabindex="-1"></a>    <span class="co">/* Draw month ticks */</span></span>
<span id="cb82-1161"><a href="#cb82-1161" aria-hidden="true" tabindex="-1"></a>    d3<span class="op">.</span><span class="fu">range</span>(<span class="dv">12</span>)<span class="op">.</span><span class="fu">map</span>((m) <span class="kw">=&gt;</span> {</span>
<span id="cb82-1162"><a href="#cb82-1162" aria-hidden="true" tabindex="-1"></a>      <span class="kw">const</span> d <span class="op">=</span> <span class="kw">new</span> <span class="bu">Date</span>(date<span class="op">.</span><span class="fu">getFullYear</span>()<span class="op">,</span> m<span class="op">,</span> <span class="dv">1</span>)<span class="op">;</span></span>
<span id="cb82-1163"><a href="#cb82-1163" aria-hidden="true" tabindex="-1"></a>      <span class="kw">const</span> angle <span class="op">=</span> <span class="fu">getSolarAngle</span>(d)<span class="op">;</span></span>
<span id="cb82-1164"><a href="#cb82-1164" aria-hidden="true" tabindex="-1"></a>      solarSystem</span>
<span id="cb82-1165"><a href="#cb82-1165" aria-hidden="true" tabindex="-1"></a>        <span class="op">.</span><span class="fu">append</span>(<span class="st">"line"</span>)</span>
<span id="cb82-1166"><a href="#cb82-1166" aria-hidden="true" tabindex="-1"></a>        <span class="op">.</span><span class="fu">attr</span>(<span class="st">"x1"</span><span class="op">,</span> (solarSystemRadius <span class="op">+</span> <span class="dv">9</span>) <span class="op">*</span> <span class="bu">Math</span><span class="op">.</span><span class="fu">sin</span>(angle))</span>
<span id="cb82-1167"><a href="#cb82-1167" aria-hidden="true" tabindex="-1"></a>        <span class="op">.</span><span class="fu">attr</span>(<span class="st">"y1"</span><span class="op">,</span> (solarSystemRadius <span class="op">+</span> <span class="dv">9</span>) <span class="op">*</span> stretch <span class="op">*</span> <span class="bu">Math</span><span class="op">.</span><span class="fu">cos</span>(angle))</span>
<span id="cb82-1168"><a href="#cb82-1168" aria-hidden="true" tabindex="-1"></a>        <span class="op">.</span><span class="fu">attr</span>(<span class="st">"x2"</span><span class="op">,</span> (solarSystemRadius <span class="op">-</span> <span class="dv">9</span>) <span class="op">*</span> <span class="bu">Math</span><span class="op">.</span><span class="fu">sin</span>(angle))</span>
<span id="cb82-1169"><a href="#cb82-1169" aria-hidden="true" tabindex="-1"></a>        <span class="op">.</span><span class="fu">attr</span>(<span class="st">"y2"</span><span class="op">,</span> (solarSystemRadius <span class="op">-</span> <span class="dv">9</span>) <span class="op">*</span> stretch <span class="op">*</span> <span class="bu">Math</span><span class="op">.</span><span class="fu">cos</span>(angle))</span>
<span id="cb82-1170"><a href="#cb82-1170" aria-hidden="true" tabindex="-1"></a>        <span class="op">.</span><span class="fu">attr</span>(<span class="st">"stroke-width"</span><span class="op">,</span> <span class="st">"3.75"</span>)</span>
<span id="cb82-1171"><a href="#cb82-1171" aria-hidden="true" tabindex="-1"></a>        <span class="op">.</span><span class="fu">attr</span>(<span class="st">"stroke"</span><span class="op">,</span> <span class="st">"black"</span>)<span class="op">;</span></span>
<span id="cb82-1172"><a href="#cb82-1172" aria-hidden="true" tabindex="-1"></a>      <span class="kw">const</span> startMonthAngle <span class="op">=</span> <span class="fu">getSolarAngle</span>(<span class="kw">new</span> <span class="bu">Date</span>(date<span class="op">.</span><span class="fu">getFullYear</span>()<span class="op">,</span> m<span class="op">,</span> <span class="dv">1</span>))<span class="op">;</span></span>
<span id="cb82-1173"><a href="#cb82-1173" aria-hidden="true" tabindex="-1"></a>      solarSystem</span>
<span id="cb82-1174"><a href="#cb82-1174" aria-hidden="true" tabindex="-1"></a>        <span class="op">.</span><span class="fu">append</span>(<span class="st">"text"</span>)</span>
<span id="cb82-1175"><a href="#cb82-1175" aria-hidden="true" tabindex="-1"></a>        <span class="op">.</span><span class="fu">text</span>(<span class="fu">date2doty</span>(d))</span>
<span id="cb82-1176"><a href="#cb82-1176" aria-hidden="true" tabindex="-1"></a>        <span class="op">.</span><span class="fu">attr</span>(<span class="st">"x"</span><span class="op">,</span> (solarSystemRadius <span class="op">+</span> <span class="dv">18</span> <span class="op">-</span> width <span class="op">/</span> <span class="dv">50</span>) <span class="op">*</span> <span class="bu">Math</span><span class="op">.</span><span class="fu">sin</span>(startMonthAngle) <span class="op">*</span> <span class="fl">1.1</span>)</span>
<span id="cb82-1177"><a href="#cb82-1177" aria-hidden="true" tabindex="-1"></a>        <span class="op">.</span><span class="fu">attr</span>(</span>
<span id="cb82-1178"><a href="#cb82-1178" aria-hidden="true" tabindex="-1"></a>          <span class="st">"y"</span><span class="op">,</span></span>
<span id="cb82-1179"><a href="#cb82-1179" aria-hidden="true" tabindex="-1"></a>          (solarSystemRadius <span class="op">+</span> <span class="dv">2</span> <span class="op">-</span> width <span class="op">/</span> <span class="fl">2.8</span>) <span class="op">*</span> <span class="fl">6.2</span> <span class="op">*</span> stretch <span class="op">*</span> <span class="bu">Math</span><span class="op">.</span><span class="fu">cos</span>(startMonthAngle) <span class="op">+</span> <span class="bu">Math</span><span class="op">.</span><span class="fu">sign</span>(<span class="bu">Math</span><span class="op">.</span><span class="fu">cos</span>(startMonthAngle)) <span class="op">*</span> <span class="dv">12</span></span>
<span id="cb82-1180"><a href="#cb82-1180" aria-hidden="true" tabindex="-1"></a>        )</span>
<span id="cb82-1181"><a href="#cb82-1181" aria-hidden="true" tabindex="-1"></a>        <span class="op">.</span><span class="fu">attr</span>(<span class="st">"text-anchor"</span><span class="op">,</span> <span class="st">"middle"</span>)</span>
<span id="cb82-1182"><a href="#cb82-1182" aria-hidden="true" tabindex="-1"></a>        <span class="op">.</span><span class="fu">attr</span>(<span class="st">"dominant-baseline"</span><span class="op">,</span> <span class="st">"middle"</span>)</span>
<span id="cb82-1183"><a href="#cb82-1183" aria-hidden="true" tabindex="-1"></a>        <span class="op">.</span><span class="fu">attr</span>(<span class="st">"font-size"</span><span class="op">,</span> fontSize <span class="op">*</span> (width <span class="op">&lt;</span> <span class="dv">300</span> <span class="op">?</span> <span class="op">.</span><span class="dv">9</span> <span class="op">:</span> width <span class="op">&lt;</span> <span class="dv">400</span> <span class="op">?</span> <span class="op">.</span><span class="dv">95</span> <span class="op">:</span> width <span class="op">&lt;</span> <span class="dv">500</span> <span class="op">?</span> <span class="dv">1</span> <span class="op">:</span> width <span class="op">&lt;</span> <span class="dv">600</span> <span class="op">?</span> <span class="fl">1.05</span> <span class="op">:</span> width <span class="op">&lt;</span> <span class="dv">700</span> <span class="op">?</span> <span class="fl">1.1</span> <span class="op">:</span> <span class="fl">1.2</span>) <span class="op">+</span> width <span class="op">/</span> <span class="dv">100</span>)</span>
<span id="cb82-1184"><a href="#cb82-1184" aria-hidden="true" tabindex="-1"></a>        <span class="op">.</span><span class="fu">attr</span>(<span class="st">"font-family"</span><span class="op">,</span> <span class="st">"sans-serif"</span>)</span>
<span id="cb82-1185"><a href="#cb82-1185" aria-hidden="true" tabindex="-1"></a>        <span class="op">.</span><span class="fu">attr</span>(<span class="st">"fill"</span><span class="op">,</span> <span class="st">"black"</span>)<span class="op">;</span></span>
<span id="cb82-1186"><a href="#cb82-1186" aria-hidden="true" tabindex="-1"></a>    })<span class="op">;</span></span>
<span id="cb82-1187"><a href="#cb82-1187" aria-hidden="true" tabindex="-1"></a>    <span class="kw">const</span> earth <span class="op">=</span> solarSystem</span>
<span id="cb82-1188"><a href="#cb82-1188" aria-hidden="true" tabindex="-1"></a>      <span class="op">.</span><span class="fu">append</span>(<span class="st">"g"</span>)</span>
<span id="cb82-1189"><a href="#cb82-1189" aria-hidden="true" tabindex="-1"></a>      <span class="op">.</span><span class="fu">attr</span>(<span class="st">"transform"</span><span class="op">,</span> <span class="vs">`translate(</span><span class="sc">${</span>x<span class="sc">}</span><span class="vs">, </span><span class="sc">${</span>y<span class="sc">}</span><span class="vs">)`</span>)<span class="op">;</span></span>
<span id="cb82-1190"><a href="#cb82-1190" aria-hidden="true" tabindex="-1"></a>    <span class="kw">function</span> <span class="fu">drawEarth</span>() {</span>
<span id="cb82-1191"><a href="#cb82-1191" aria-hidden="true" tabindex="-1"></a>      earth<span class="op">.</span><span class="fu">append</span>(<span class="st">"line"</span>)<span class="op">.</span><span class="fu">attr</span>(<span class="st">"y1"</span><span class="op">,</span> <span class="op">-</span><span class="fl">1.5</span> <span class="op">*</span> earthRadius)<span class="op">.</span><span class="fu">attr</span>(<span class="st">"y2"</span><span class="op">,</span> <span class="fl">1.5</span> <span class="op">*</span> earthRadius)<span class="op">.</span><span class="fu">attr</span>(<span class="st">"stroke"</span><span class="op">,</span> <span class="st">"blue"</span>)<span class="op">.</span><span class="fu">attr</span>(<span class="st">"transform"</span><span class="op">,</span> <span class="vs">`rotate(-23.5)`</span>)<span class="op">;</span></span>
<span id="cb82-1192"><a href="#cb82-1192" aria-hidden="true" tabindex="-1"></a>      earth<span class="op">.</span><span class="fu">append</span>(<span class="st">"path"</span>)<span class="op">.</span><span class="fu">attr</span>(<span class="st">"d"</span><span class="op">,</span> <span class="fu">path</span>(earthGeo))<span class="op">.</span><span class="fu">attr</span>(<span class="st">"fill"</span><span class="op">,</span> darkmode <span class="op">?</span> <span class="st">"#007FFF"</span> <span class="op">:</span> mapcolors<span class="op">.</span><span class="at">ocean</span>)<span class="op">.</span><span class="fu">attr</span>(<span class="st">"id"</span><span class="op">,</span> <span class="st">"globeOcean"</span>)<span class="op">;</span></span>
<span id="cb82-1193"><a href="#cb82-1193" aria-hidden="true" tabindex="-1"></a>      earth<span class="op">.</span><span class="fu">append</span>(<span class="st">"path"</span>)<span class="op">.</span><span class="fu">attr</span>(<span class="st">"d"</span><span class="op">,</span> <span class="fu">path</span>(land))<span class="op">.</span><span class="fu">attr</span>(<span class="st">"fill"</span><span class="op">,</span> darkmode <span class="op">?</span> <span class="st">"#0808"</span> <span class="op">:</span> mapcolors<span class="op">.</span><span class="at">land</span>)<span class="op">.</span><span class="fu">attr</span>(<span class="st">"id"</span><span class="op">,</span> <span class="st">"globeLand"</span>)<span class="op">;</span></span>
<span id="cb82-1194"><a href="#cb82-1194" aria-hidden="true" tabindex="-1"></a>      earth<span class="op">.</span><span class="fu">append</span>(<span class="st">"path"</span>)<span class="op">.</span><span class="fu">attr</span>(<span class="st">"d"</span><span class="op">,</span> <span class="fu">path</span>(countries))<span class="op">.</span><span class="fu">attr</span>(<span class="st">"stroke-width"</span><span class="op">,</span> <span class="st">".08"</span>)<span class="op">.</span><span class="fu">attr</span>(<span class="st">"fill"</span><span class="op">,</span> <span class="st">"none"</span>)<span class="op">.</span><span class="fu">attr</span>(<span class="st">"stroke"</span><span class="op">,</span> darkmode <span class="op">?</span> <span class="st">"#eee"</span> <span class="op">:</span> <span class="st">"#333"</span>)<span class="op">.</span><span class="fu">attr</span>(<span class="st">"id"</span><span class="op">,</span> <span class="st">"globeBorders"</span>)<span class="op">;</span></span>
<span id="cb82-1195"><a href="#cb82-1195" aria-hidden="true" tabindex="-1"></a>      path<span class="op">.</span><span class="fu">pointRadius</span>(<span class="fl">5.5</span>)<span class="op">;</span></span>
<span id="cb82-1196"><a href="#cb82-1196" aria-hidden="true" tabindex="-1"></a>      earth<span class="op">.</span><span class="fu">append</span>(<span class="st">"path"</span>)<span class="op">.</span><span class="fu">attr</span>(<span class="st">"d"</span><span class="op">,</span> <span class="fu">path</span>({ <span class="dt">type</span><span class="op">:</span> <span class="st">"Point"</span><span class="op">,</span> <span class="dt">coordinates</span><span class="op">:</span> location }))<span class="op">.</span><span class="fu">attr</span>(<span class="st">"fill"</span><span class="op">,</span> <span class="st">"none"</span>)<span class="op">.</span><span class="fu">attr</span>(<span class="st">"stroke-width"</span><span class="op">,</span> <span class="op">.</span><span class="dv">6</span>)<span class="op">.</span><span class="fu">attr</span>(<span class="st">"stroke"</span><span class="op">,</span> <span class="st">"black"</span>)<span class="op">;</span></span>
<span id="cb82-1197"><a href="#cb82-1197" aria-hidden="true" tabindex="-1"></a>      path<span class="op">.</span><span class="fu">pointRadius</span>(<span class="fl">4.5</span>)<span class="op">;</span></span>
<span id="cb82-1198"><a href="#cb82-1198" aria-hidden="true" tabindex="-1"></a>      earth<span class="op">.</span><span class="fu">append</span>(<span class="st">"path"</span>)<span class="op">.</span><span class="fu">attr</span>(<span class="st">"d"</span><span class="op">,</span> <span class="fu">path</span>({ <span class="dt">type</span><span class="op">:</span> <span class="st">"Point"</span><span class="op">,</span> <span class="dt">coordinates</span><span class="op">:</span> location }))<span class="op">.</span><span class="fu">attr</span>(<span class="st">"fill"</span><span class="op">,</span> <span class="st">"none"</span>)<span class="op">.</span><span class="fu">attr</span>(<span class="st">"stroke-width"</span><span class="op">,</span> <span class="fl">2.25</span>)<span class="op">.</span><span class="fu">attr</span>(<span class="st">"stroke"</span><span class="op">,</span> <span class="st">"red"</span>)<span class="op">;</span></span>
<span id="cb82-1199"><a href="#cb82-1199" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb82-1200"><a href="#cb82-1200" aria-hidden="true" tabindex="-1"></a>  <span class="fu">drawEarth</span>()<span class="op">;</span></span>
<span id="cb82-1201"><a href="#cb82-1201" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb82-1202"><a href="#cb82-1202" aria-hidden="true" tabindex="-1"></a><span class="kw">function</span> <span class="fu">greg2doty</span>(month <span class="op">=</span> <span class="dv">1</span><span class="op">,</span> day <span class="op">=</span> <span class="dv">1</span>) {</span>
<span id="cb82-1203"><a href="#cb82-1203" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> <span class="bu">Math</span><span class="op">.</span><span class="fu">floor</span>(</span>
<span id="cb82-1204"><a href="#cb82-1204" aria-hidden="true" tabindex="-1"></a>        (<span class="dv">153</span> <span class="op">*</span> (month <span class="op">&gt;</span> <span class="dv">2</span> <span class="op">?</span> month <span class="op">-</span> <span class="dv">3</span> <span class="op">:</span> month <span class="op">+</span> <span class="dv">9</span>) <span class="op">+</span> <span class="dv">2</span>) <span class="op">/</span> <span class="dv">5</span> <span class="op">+</span> day <span class="op">-</span> <span class="dv">1</span></span>
<span id="cb82-1205"><a href="#cb82-1205" aria-hidden="true" tabindex="-1"></a>)}</span>
<span id="cb82-1206"><a href="#cb82-1206" aria-hidden="true" tabindex="-1"></a><span class="kw">function</span> <span class="fu">date2doty</span>(date) {</span>
<span id="cb82-1207"><a href="#cb82-1207" aria-hidden="true" tabindex="-1"></a>  <span class="cf">return</span> <span class="fu">greg2doty</span>(date<span class="op">.</span><span class="fu">getMonth</span>() <span class="op">+</span> <span class="dv">1</span><span class="op">,</span> date<span class="op">.</span><span class="fu">getDate</span>())</span>
<span id="cb82-1208"><a href="#cb82-1208" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb82-1209"><a href="#cb82-1209" aria-hidden="true" tabindex="-1"></a><span class="kw">function</span> <span class="fu">date2doty1</span>(date) {</span>
<span id="cb82-1210"><a href="#cb82-1210" aria-hidden="true" tabindex="-1"></a>  <span class="cf">return</span> <span class="fu">greg2doty</span>(date<span class="op">.</span><span class="fu">getMonth</span>() <span class="op">+</span> <span class="dv">1</span><span class="op">,</span> date<span class="op">.</span><span class="fu">getDate</span>())</span>
<span id="cb82-1211"><a href="#cb82-1211" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb82-1212"><a href="#cb82-1212" aria-hidden="true" tabindex="-1"></a><span class="co">// https://observablehq.com/@dbridges/visualizing-seasonal-daylight</span></span>
<span id="cb82-1213"><a href="#cb82-1213" aria-hidden="true" tabindex="-1"></a><span class="co">// globe = (root, { vizwidth, location, date, hour }) =&gt; {</span></span>
<span id="cb82-1214"><a href="#cb82-1214" aria-hidden="true" tabindex="-1"></a><span class="co">//   const solarAngle = getSolarAngle(date);</span></span>
<span id="cb82-1215"><a href="#cb82-1215" aria-hidden="true" tabindex="-1"></a><span class="co">//   const solarAngleDeg = toDegrees(solarAngle);</span></span>
<span id="cb82-1216"><a href="#cb82-1216" aria-hidden="true" tabindex="-1"></a><span class="co">//   const hourSpin = 360 * ((hour + 12) / 24);</span></span>
<span id="cb82-1217"><a href="#cb82-1217" aria-hidden="true" tabindex="-1"></a><span class="co">//   const spin = (180 + -location[0] + solarAngleDeg + hourSpin);</span></span>
<span id="cb82-1218"><a href="#cb82-1218" aria-hidden="true" tabindex="-1"></a><span class="co">//   const tilt = -15;</span></span>
<span id="cb82-1219"><a href="#cb82-1219" aria-hidden="true" tabindex="-1"></a><span class="co">//   const projection = d3.geoOrthographic()</span></span>
<span id="cb82-1220"><a href="#cb82-1220" aria-hidden="true" tabindex="-1"></a><span class="co">//                        .fitWidth(vizwidth, graticule)</span></span>
<span id="cb82-1221"><a href="#cb82-1221" aria-hidden="true" tabindex="-1"></a><span class="co">//                        .rotate([spin, tilt, 23.5]);</span></span>
<span id="cb82-1222"><a href="#cb82-1222" aria-hidden="true" tabindex="-1"></a><span class="co">//   const path = d3.geoPath(projection);</span></span>
<span id="cb82-1223"><a href="#cb82-1223" aria-hidden="true" tabindex="-1"></a><span class="co">//   const unClippedProjection = d3.geoOrthographic()</span></span>
<span id="cb82-1224"><a href="#cb82-1224" aria-hidden="true" tabindex="-1"></a><span class="co">//                                 .clipAngle(null)</span></span>
<span id="cb82-1225"><a href="#cb82-1225" aria-hidden="true" tabindex="-1"></a><span class="co">//                                 .fitWidth(vizwidth, graticule)</span></span>
<span id="cb82-1226"><a href="#cb82-1226" aria-hidden="true" tabindex="-1"></a><span class="co">//                                 .rotate([spin, tilt, 23.5]);</span></span>
<span id="cb82-1227"><a href="#cb82-1227" aria-hidden="true" tabindex="-1"></a><span class="co">//   const unClippedPath = d3.geoPath(unClippedProjection);</span></span>
<span id="cb82-1228"><a href="#cb82-1228" aria-hidden="true" tabindex="-1"></a><span class="co">//   const staticProjection = d3.geoOrthographic()</span></span>
<span id="cb82-1229"><a href="#cb82-1229" aria-hidden="true" tabindex="-1"></a><span class="co">//                              .fitWidth(vizwidth, graticule)</span></span>
<span id="cb82-1230"><a href="#cb82-1230" aria-hidden="true" tabindex="-1"></a><span class="co">//                              .rotate([solarAngleDeg - 90, tilt]);</span></span>
<span id="cb82-1231"><a href="#cb82-1231" aria-hidden="true" tabindex="-1"></a><span class="co">//   const staticPath = d3.geoPath(staticProjection);</span></span>
<span id="cb82-1232"><a href="#cb82-1232" aria-hidden="true" tabindex="-1"></a><span class="co">//   const background = root.append("g");</span></span>
<span id="cb82-1233"><a href="#cb82-1233" aria-hidden="true" tabindex="-1"></a><span class="co">//   const earth = root.append("g").style("opacity", 0.75);</span></span>
<span id="cb82-1234"><a href="#cb82-1234" aria-hidden="true" tabindex="-1"></a><span class="co">//   const foreground = root.append("g");</span></span>
<span id="cb82-1235"><a href="#cb82-1235" aria-hidden="true" tabindex="-1"></a><span class="co">//   earth.append("path")</span></span>
<span id="cb82-1236"><a href="#cb82-1236" aria-hidden="true" tabindex="-1"></a><span class="co">//     .attr("d", path({type: "Sphere"}))</span></span>
<span id="cb82-1237"><a href="#cb82-1237" aria-hidden="true" tabindex="-1"></a><span class="co">//     .attr("fill", mapcolors.ocean)</span></span>
<span id="cb82-1238"><a href="#cb82-1238" aria-hidden="true" tabindex="-1"></a><span class="co">//     .attr("stroke", "#9ecbda");</span></span>
<span id="cb82-1239"><a href="#cb82-1239" aria-hidden="true" tabindex="-1"></a><span class="co">//   earth.append("path")</span></span>
<span id="cb82-1240"><a href="#cb82-1240" aria-hidden="true" tabindex="-1"></a><span class="co">//     .attr("d", path(land))</span></span>
<span id="cb82-1241"><a href="#cb82-1241" aria-hidden="true" tabindex="-1"></a><span class="co">//     .attr("fill", mapcolors.land);</span></span>
<span id="cb82-1242"><a href="#cb82-1242" aria-hidden="true" tabindex="-1"></a><span class="co">//   earth.append("path")</span></span>
<span id="cb82-1243"><a href="#cb82-1243" aria-hidden="true" tabindex="-1"></a><span class="co">//     .attr("d", path(countries))</span></span>
<span id="cb82-1244"><a href="#cb82-1244" aria-hidden="true" tabindex="-1"></a><span class="co">//     .attr("stroke-width", "1")</span></span>
<span id="cb82-1245"><a href="#cb82-1245" aria-hidden="true" tabindex="-1"></a><span class="co">//     .attr("fill", "none")</span></span>
<span id="cb82-1246"><a href="#cb82-1246" aria-hidden="true" tabindex="-1"></a><span class="co">//     .attr("stroke", "#000");</span></span>
<span id="cb82-1247"><a href="#cb82-1247" aria-hidden="true" tabindex="-1"></a><span class="co">//   background.append("path")</span></span>
<span id="cb82-1248"><a href="#cb82-1248" aria-hidden="true" tabindex="-1"></a><span class="co">//     .attr("d", unClippedPath({type: "Point", coordinates: location}))</span></span>
<span id="cb82-1249"><a href="#cb82-1249" aria-hidden="true" tabindex="-1"></a><span class="co">//     .attr("fill", "red");</span></span>
<span id="cb82-1250"><a href="#cb82-1250" aria-hidden="true" tabindex="-1"></a><span class="co">//   const latitudeCoords = (latitude, start, end) =&gt; {</span></span>
<span id="cb82-1251"><a href="#cb82-1251" aria-hidden="true" tabindex="-1"></a><span class="co">//     const longitudes = d3.range(start, end, 2).concat(end);</span></span>
<span id="cb82-1252"><a href="#cb82-1252" aria-hidden="true" tabindex="-1"></a><span class="co">//     return longitudes.map(d =&gt; [d, latitude]);</span></span>
<span id="cb82-1253"><a href="#cb82-1253" aria-hidden="true" tabindex="-1"></a><span class="co">//   }</span></span>
<span id="cb82-1254"><a href="#cb82-1254" aria-hidden="true" tabindex="-1"></a><span class="co">//   const correctSpin = d3.geoRotation([-hourSpin, 0]);</span></span>
<span id="cb82-1255"><a href="#cb82-1255" aria-hidden="true" tabindex="-1"></a><span class="co">//   const correctTilt = d3.geoRotation([6, 0, 0]);</span></span>
<span id="cb82-1256"><a href="#cb82-1256" aria-hidden="true" tabindex="-1"></a><span class="co">//   /* total angular extent of day/night */</span></span>
<span id="cb82-1257"><a href="#cb82-1257" aria-hidden="true" tabindex="-1"></a><span class="co">//   const dayExtent = 360 * dayLength(date, location[1]) / 24;</span></span>
<span id="cb82-1258"><a href="#cb82-1258" aria-hidden="true" tabindex="-1"></a><span class="co">//   const nightExtent = 360 - dayExtent;</span></span>
<span id="cb82-1259"><a href="#cb82-1259" aria-hidden="true" tabindex="-1"></a><span class="co">//   const dayLine = {</span></span>
<span id="cb82-1260"><a href="#cb82-1260" aria-hidden="true" tabindex="-1"></a><span class="co">//     type: "LineString",</span></span>
<span id="cb82-1261"><a href="#cb82-1261" aria-hidden="true" tabindex="-1"></a><span class="co">//     coordinates: latitudeCoords(location[1],</span></span>
<span id="cb82-1262"><a href="#cb82-1262" aria-hidden="true" tabindex="-1"></a><span class="co">//                                 location[0] - dayExtent / 2,</span></span>
<span id="cb82-1263"><a href="#cb82-1263" aria-hidden="true" tabindex="-1"></a><span class="co">//                                 location[0] + dayExtent / 2).map(d =&gt; correctSpin(d))</span></span>
<span id="cb82-1264"><a href="#cb82-1264" aria-hidden="true" tabindex="-1"></a><span class="co">//   };</span></span>
<span id="cb82-1265"><a href="#cb82-1265" aria-hidden="true" tabindex="-1"></a><span class="co">//   const nightLine = {</span></span>
<span id="cb82-1266"><a href="#cb82-1266" aria-hidden="true" tabindex="-1"></a><span class="co">//     type: "LineString",</span></span>
<span id="cb82-1267"><a href="#cb82-1267" aria-hidden="true" tabindex="-1"></a><span class="co">//     coordinates: latitudeCoords(location[1],</span></span>
<span id="cb82-1268"><a href="#cb82-1268" aria-hidden="true" tabindex="-1"></a><span class="co">//                                 location[0] - dayExtent / 2 - nightExtent,</span></span>
<span id="cb82-1269"><a href="#cb82-1269" aria-hidden="true" tabindex="-1"></a><span class="co">//                                 location[0] - dayExtent / 2).map(d =&gt; correctSpin(d))</span></span>
<span id="cb82-1270"><a href="#cb82-1270" aria-hidden="true" tabindex="-1"></a><span class="co">//   };</span></span>
<span id="cb82-1271"><a href="#cb82-1271" aria-hidden="true" tabindex="-1"></a><span class="co">//   background.append("path")</span></span>
<span id="cb82-1272"><a href="#cb82-1272" aria-hidden="true" tabindex="-1"></a><span class="co">//     .attr("d", unClippedPath(dayLine))</span></span>
<span id="cb82-1273"><a href="#cb82-1273" aria-hidden="true" tabindex="-1"></a><span class="co">//     .attr("fill", "none")</span></span>
<span id="cb82-1274"><a href="#cb82-1274" aria-hidden="true" tabindex="-1"></a><span class="co">//     .attr("stroke", mapcolors.day)</span></span>
<span id="cb82-1275"><a href="#cb82-1275" aria-hidden="true" tabindex="-1"></a><span class="co">//     .attr("stroke-width", 3);</span></span>
<span id="cb82-1276"><a href="#cb82-1276" aria-hidden="true" tabindex="-1"></a><span class="co">//   background.append("path")</span></span>
<span id="cb82-1277"><a href="#cb82-1277" aria-hidden="true" tabindex="-1"></a><span class="co">//     .attr("d", unClippedPath(nightLine))</span></span>
<span id="cb82-1278"><a href="#cb82-1278" aria-hidden="true" tabindex="-1"></a><span class="co">//     .attr("fill", "none")</span></span>
<span id="cb82-1279"><a href="#cb82-1279" aria-hidden="true" tabindex="-1"></a><span class="co">//     .attr("stroke", mapcolors.night)</span></span>
<span id="cb82-1280"><a href="#cb82-1280" aria-hidden="true" tabindex="-1"></a><span class="co">//     .attr("stroke-width", 3);</span></span>
<span id="cb82-1281"><a href="#cb82-1281" aria-hidden="true" tabindex="-1"></a><span class="co">//   foreground.append("path")</span></span>
<span id="cb82-1282"><a href="#cb82-1282" aria-hidden="true" tabindex="-1"></a><span class="co">//     .attr("d", path(dayLine))</span></span>
<span id="cb82-1283"><a href="#cb82-1283" aria-hidden="true" tabindex="-1"></a><span class="co">//     .attr("fill", "none")</span></span>
<span id="cb82-1284"><a href="#cb82-1284" aria-hidden="true" tabindex="-1"></a><span class="co">//     .attr("stroke", mapcolors.day)</span></span>
<span id="cb82-1285"><a href="#cb82-1285" aria-hidden="true" tabindex="-1"></a><span class="co">//     .attr("stroke-width", 3);</span></span>
<span id="cb82-1286"><a href="#cb82-1286" aria-hidden="true" tabindex="-1"></a><span class="co">//   foreground.append("path")</span></span>
<span id="cb82-1287"><a href="#cb82-1287" aria-hidden="true" tabindex="-1"></a><span class="co">//     .attr("d", path(nightLine))</span></span>
<span id="cb82-1288"><a href="#cb82-1288" aria-hidden="true" tabindex="-1"></a><span class="co">//     .attr("fill", "none")</span></span>
<span id="cb82-1289"><a href="#cb82-1289" aria-hidden="true" tabindex="-1"></a><span class="co">//     .attr("stroke", mapcolors.night)</span></span>
<span id="cb82-1290"><a href="#cb82-1290" aria-hidden="true" tabindex="-1"></a><span class="co">//     .attr("stroke-width", 3);</span></span>
<span id="cb82-1291"><a href="#cb82-1291" aria-hidden="true" tabindex="-1"></a><span class="co">//   foreground.append("path")</span></span>
<span id="cb82-1292"><a href="#cb82-1292" aria-hidden="true" tabindex="-1"></a><span class="co">//     .attr("d", path({type: "Point", coordinates: location}))</span></span>
<span id="cb82-1293"><a href="#cb82-1293" aria-hidden="true" tabindex="-1"></a><span class="co">//     .attr("stroke-width", .5)</span></span>
<span id="cb82-1294"><a href="#cb82-1294" aria-hidden="true" tabindex="-1"></a><span class="co">//     .attr("stroke", "black")</span></span>
<span id="cb82-1295"><a href="#cb82-1295" aria-hidden="true" tabindex="-1"></a><span class="co">//     .attr("fill", "red");</span></span>
<span id="cb82-1296"><a href="#cb82-1296" aria-hidden="true" tabindex="-1"></a><span class="co">//   const shadowPolygon = [[0, -90], [0, 0], [0, 90], [180, 0], [0, -90]].map(d =&gt; correctTilt(d));</span></span>
<span id="cb82-1297"><a href="#cb82-1297" aria-hidden="true" tabindex="-1"></a><span class="co">//   foreground.append("path")</span></span>
<span id="cb82-1298"><a href="#cb82-1298" aria-hidden="true" tabindex="-1"></a><span class="co">//     .attr("d", staticPath({type: "Polygon", coordinates: [shadowPolygon]}))</span></span>
<span id="cb82-1299"><a href="#cb82-1299" aria-hidden="true" tabindex="-1"></a><span class="co">//     .attr("fill", "rgba(0, 0, 0, 0.25)");</span></span>
<span id="cb82-1300"><a href="#cb82-1300" aria-hidden="true" tabindex="-1"></a><span class="co">// }</span></span>
<span id="cb82-1301"><a href="#cb82-1301" aria-hidden="true" tabindex="-1"></a>dayOfYear <span class="op">=</span> (date) <span class="kw">=&gt;</span> {</span>
<span id="cb82-1302"><a href="#cb82-1302" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> yearStart <span class="op">=</span> <span class="kw">new</span> <span class="bu">Date</span>(date<span class="op">.</span><span class="fu">getFullYear</span>()<span class="op">,</span> <span class="dv">0</span><span class="op">,</span> <span class="dv">1</span><span class="op">+</span><span class="dv">60</span>)<span class="op">;</span></span>
<span id="cb82-1303"><a href="#cb82-1303" aria-hidden="true" tabindex="-1"></a>  <span class="cf">return</span> <span class="bu">Math</span><span class="op">.</span><span class="fu">floor</span>((date<span class="op">.</span><span class="fu">getTime</span>() <span class="op">-</span> yearStart<span class="op">.</span><span class="fu">getTime</span>())<span class="op">/</span><span class="dv">86400000</span>) <span class="op">+</span> <span class="dv">1</span></span>
<span id="cb82-1304"><a href="#cb82-1304" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb82-1305"><a href="#cb82-1305" aria-hidden="true" tabindex="-1"></a><span class="co">// https://observablehq.com/@dbridges/visualizing-seasonal-daylight</span></span>
<span id="cb82-1306"><a href="#cb82-1306" aria-hidden="true" tabindex="-1"></a>daylightPlot <span class="op">=</span> (</span>
<span id="cb82-1307"><a href="#cb82-1307" aria-hidden="true" tabindex="-1"></a>  <span class="bu">root</span><span class="op">,</span></span>
<span id="cb82-1308"><a href="#cb82-1308" aria-hidden="true" tabindex="-1"></a>  { vizwidth<span class="op">,</span> height<span class="op">,</span> year<span class="op">,</span> latitude<span class="op">,</span> defaultDate<span class="op">,</span> defaultHour }</span>
<span id="cb82-1309"><a href="#cb82-1309" aria-hidden="true" tabindex="-1"></a>) <span class="kw">=&gt;</span> {</span>
<span id="cb82-1310"><a href="#cb82-1310" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> margin <span class="op">=</span> { <span class="dt">top</span><span class="op">:</span> <span class="dv">32</span><span class="op">,</span> <span class="dt">bottom</span><span class="op">:</span> <span class="dv">32</span><span class="op">,</span> <span class="dt">left</span><span class="op">:</span> <span class="dv">32</span><span class="op">,</span> <span class="dt">right</span><span class="op">:</span> <span class="dv">0</span> }<span class="op">;</span></span>
<span id="cb82-1311"><a href="#cb82-1311" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> chartWidth <span class="op">=</span> vizwidth <span class="op">-</span> margin<span class="op">.</span><span class="at">left</span> <span class="op">-</span> margin<span class="op">.</span><span class="at">right</span><span class="op">;</span></span>
<span id="cb82-1312"><a href="#cb82-1312" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> chartHeight <span class="op">=</span> height <span class="op">-</span> margin<span class="op">.</span><span class="at">top</span> <span class="op">-</span> margin<span class="op">.</span><span class="at">bottom</span><span class="op">;</span></span>
<span id="cb82-1313"><a href="#cb82-1313" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> yTickValues <span class="op">=</span></span>
<span id="cb82-1314"><a href="#cb82-1314" aria-hidden="true" tabindex="-1"></a>    width <span class="op">&gt;</span> <span class="dv">380</span> <span class="op">?</span> [<span class="dv">3</span><span class="op">,</span> <span class="dv">6</span><span class="op">,</span> <span class="dv">9</span><span class="op">,</span> <span class="dv">12</span><span class="op">,</span> <span class="dv">15</span><span class="op">,</span> <span class="dv">18</span><span class="op">,</span> <span class="dv">21</span>] <span class="op">:</span> width <span class="op">&gt;</span> <span class="dv">90</span> <span class="op">?</span> [<span class="dv">6</span><span class="op">,</span> <span class="dv">12</span><span class="op">,</span> <span class="dv">18</span>] <span class="op">:</span> [<span class="dv">12</span>]<span class="op">;</span></span>
<span id="cb82-1315"><a href="#cb82-1315" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> yScale <span class="op">=</span> d3</span>
<span id="cb82-1316"><a href="#cb82-1316" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">scaleLinear</span>()</span>
<span id="cb82-1317"><a href="#cb82-1317" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">domain</span>([<span class="dv">0</span><span class="op">,</span> <span class="dv">24</span>])</span>
<span id="cb82-1318"><a href="#cb82-1318" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">range</span>([margin<span class="op">.</span><span class="at">left</span><span class="op">,</span> margin<span class="op">.</span><span class="at">left</span> <span class="op">+</span> chartWidth])</span>
<span id="cb82-1319"><a href="#cb82-1319" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">clamp</span>(<span class="kw">true</span>)<span class="op">;</span></span>
<span id="cb82-1320"><a href="#cb82-1320" aria-hidden="true" tabindex="-1"></a>  <span class="co">// y-axis scale</span></span>
<span id="cb82-1321"><a href="#cb82-1321" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> xScale <span class="op">=</span> d3</span>
<span id="cb82-1322"><a href="#cb82-1322" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">scaleTime</span>()</span>
<span id="cb82-1323"><a href="#cb82-1323" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">domain</span>([<span class="kw">new</span> <span class="bu">Date</span>(year<span class="op">,</span> <span class="dv">0</span><span class="op">,</span> <span class="dv">61</span>)<span class="op">,</span> <span class="kw">new</span> <span class="bu">Date</span>(year<span class="op">,</span> <span class="dv">11</span><span class="op">,</span> <span class="dv">91</span>)])</span>
<span id="cb82-1324"><a href="#cb82-1324" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">range</span>([margin<span class="op">.</span><span class="at">top</span><span class="op">,</span> margin<span class="op">.</span><span class="at">top</span> <span class="op">+</span> chartHeight])</span>
<span id="cb82-1325"><a href="#cb82-1325" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">clamp</span>(<span class="kw">true</span>)<span class="op">;</span></span>
<span id="cb82-1326"><a href="#cb82-1326" aria-hidden="true" tabindex="-1"></a>  <span class="co">// y-axis labels</span></span>
<span id="cb82-1327"><a href="#cb82-1327" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> xAxis <span class="op">=</span> d3</span>
<span id="cb82-1328"><a href="#cb82-1328" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">axisBottom</span>(xScale)</span>
<span id="cb82-1329"><a href="#cb82-1329" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">tickValues</span>(d3<span class="op">.</span><span class="at">timeMonth</span><span class="op">.</span><span class="fu">range</span>(<span class="kw">new</span> <span class="bu">Date</span>(year<span class="op">,</span> <span class="dv">0</span><span class="op">,</span> <span class="dv">60</span>)<span class="op">,</span> <span class="kw">new</span> <span class="bu">Date</span>(year<span class="op">,</span> <span class="dv">12</span><span class="op">,</span> <span class="dv">57</span>)))</span>
<span id="cb82-1330"><a href="#cb82-1330" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">tickSize</span>(chartWidth)</span>
<span id="cb82-1331"><a href="#cb82-1331" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">tickFormat</span>(date2doty1)<span class="op">;</span></span>
<span id="cb82-1332"><a href="#cb82-1332" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> yAxis <span class="op">=</span> d3</span>
<span id="cb82-1333"><a href="#cb82-1333" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">axisLeft</span>(yScale)</span>
<span id="cb82-1334"><a href="#cb82-1334" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">tickValues</span>(yTickValues)</span>
<span id="cb82-1335"><a href="#cb82-1335" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">tickSize</span>(chartHeight)</span>
<span id="cb82-1336"><a href="#cb82-1336" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">tickFormat</span>((d) <span class="kw">=&gt;</span> { <span class="cf">return</span> <span class="vs">`</span><span class="sc">${</span>d <span class="op">/</span> <span class="op">.</span><span class="bn">024</span><span class="sc">}</span><span class="vs">`</span> })<span class="op">;</span></span>
<span id="cb82-1337"><a href="#cb82-1337" aria-hidden="true" tabindex="-1"></a>  <span class="kw">let</span> date <span class="op">=</span> defaultDate <span class="op">||</span> <span class="kw">new</span> <span class="bu">Date</span>()<span class="op">;</span></span>
<span id="cb82-1338"><a href="#cb82-1338" aria-hidden="true" tabindex="-1"></a>  <span class="kw">let</span> hour <span class="op">=</span> defaultHour <span class="op">!=</span> <span class="kw">null</span> <span class="op">?</span> defaultHour <span class="op">:</span> date<span class="op">.</span><span class="fu">getHours</span>()<span class="op">;</span></span>
<span id="cb82-1339"><a href="#cb82-1339" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> handleMouseMove <span class="op">=</span> (e) <span class="kw">=&gt;</span> {}<span class="op">;</span></span>
<span id="cb82-1340"><a href="#cb82-1340" aria-hidden="true" tabindex="-1"></a>  <span class="bu">root</span></span>
<span id="cb82-1341"><a href="#cb82-1341" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">append</span>(<span class="st">"rect"</span>)</span>
<span id="cb82-1342"><a href="#cb82-1342" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">"y"</span><span class="op">,</span> margin<span class="op">.</span><span class="at">left</span>)</span>
<span id="cb82-1343"><a href="#cb82-1343" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">"x"</span><span class="op">,</span> margin<span class="op">.</span><span class="at">top</span>)</span>
<span id="cb82-1344"><a href="#cb82-1344" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">"height"</span><span class="op">,</span> chartWidth)</span>
<span id="cb82-1345"><a href="#cb82-1345" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">"width"</span><span class="op">,</span> chartHeight)</span>
<span id="cb82-1346"><a href="#cb82-1346" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">"ry"</span><span class="op">,</span> <span class="fl">0.05</span> <span class="op">*</span> vizwidth)</span>
<span id="cb82-1347"><a href="#cb82-1347" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">"fill"</span><span class="op">,</span> mapcolors<span class="op">.</span><span class="at">night</span>)<span class="op">;</span></span>
<span id="cb82-1348"><a href="#cb82-1348" aria-hidden="true" tabindex="-1"></a>  <span class="bu">root</span></span>
<span id="cb82-1349"><a href="#cb82-1349" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">append</span>(<span class="st">"g"</span>)</span>
<span id="cb82-1350"><a href="#cb82-1350" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">"transform"</span><span class="op">,</span> <span class="vs">`translate(0, </span><span class="sc">${</span>margin<span class="op">.</span><span class="at">top</span><span class="sc">}</span><span class="vs">)`</span>)</span>
<span id="cb82-1351"><a href="#cb82-1351" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">call</span>(xAxis)</span>
<span id="cb82-1352"><a href="#cb82-1352" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">call</span>((g) <span class="kw">=&gt;</span> g<span class="op">.</span><span class="fu">select</span>(<span class="st">".domain"</span>)<span class="op">.</span><span class="fu">remove</span>())</span>
<span id="cb82-1353"><a href="#cb82-1353" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">call</span>((g) <span class="kw">=&gt;</span> g<span class="op">.</span><span class="fu">selectAll</span>(<span class="st">".tick"</span>)<span class="op">.</span><span class="fu">attr</span>(<span class="st">"color"</span><span class="op">,</span> mapcolors<span class="op">.</span><span class="at">grid</span>))</span>
<span id="cb82-1354"><a href="#cb82-1354" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">call</span>((g) <span class="kw">=&gt;</span> g<span class="op">.</span><span class="fu">selectAll</span>(<span class="st">".tick text"</span>)<span class="op">.</span><span class="fu">attr</span>(<span class="st">"font-size"</span><span class="op">,</span> (width <span class="op">&lt;</span> <span class="dv">300</span> <span class="op">?</span> <span class="op">.</span><span class="dv">7</span> <span class="op">:</span> width <span class="op">&lt;</span> <span class="dv">325</span> <span class="op">?</span> <span class="op">.</span><span class="dv">725</span> <span class="op">:</span> width <span class="op">&lt;</span> <span class="dv">350</span> <span class="op">?</span> <span class="op">.</span><span class="dv">75</span> <span class="op">:</span> width <span class="op">&lt;</span> <span class="dv">375</span> <span class="op">?</span> <span class="op">.</span><span class="dv">8</span> <span class="op">:</span> width <span class="op">&lt;</span> <span class="dv">400</span> <span class="op">?</span> <span class="op">.</span><span class="dv">9</span> <span class="op">:</span> width <span class="op">&lt;</span> <span class="dv">450</span> <span class="op">?</span> <span class="op">.</span><span class="dv">95</span> <span class="op">:</span> width <span class="op">&lt;</span> <span class="dv">500</span> <span class="op">?</span> <span class="dv">1</span> <span class="op">:</span> width <span class="op">&lt;</span> <span class="dv">600</span> <span class="op">?</span> <span class="fl">1.2</span> <span class="op">:</span> width <span class="op">&lt;</span> <span class="dv">700</span> <span class="op">?</span> <span class="fl">1.3</span> <span class="op">:</span> width <span class="op">&lt;</span> <span class="dv">800</span> <span class="op">?</span> <span class="fl">1.4</span> <span class="op">:</span> width <span class="op">&lt;</span> <span class="dv">900</span> <span class="op">?</span> <span class="fl">1.5</span> <span class="op">:</span> width <span class="op">&lt;</span> <span class="dv">1000</span> <span class="op">?</span> <span class="fl">1.7</span> <span class="op">:</span> width <span class="op">&lt;</span> <span class="dv">1100</span> <span class="op">?</span> <span class="fl">1.8</span> <span class="op">:</span> width <span class="op">&lt;</span> <span class="dv">1200</span> <span class="op">?</span> <span class="fl">1.9</span> <span class="op">:</span> <span class="dv">2</span>) <span class="op">*</span> fontSize))</span>
<span id="cb82-1355"><a href="#cb82-1355" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">call</span>((g) <span class="kw">=&gt;</span> g<span class="op">.</span><span class="fu">selectAll</span>(<span class="st">".tick text"</span>)<span class="op">.</span><span class="fu">attr</span>(<span class="st">"color"</span><span class="op">,</span> <span class="st">"black"</span>))</span>
<span id="cb82-1356"><a href="#cb82-1356" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">call</span>((g) <span class="kw">=&gt;</span> g<span class="op">.</span><span class="fu">selectAll</span>(<span class="st">".tick line"</span>)<span class="op">.</span><span class="fu">attr</span>(<span class="st">"stroke-dasharray"</span><span class="op">,</span> <span class="st">"5 3"</span>))<span class="op">;</span></span>
<span id="cb82-1357"><a href="#cb82-1357" aria-hidden="true" tabindex="-1"></a>  <span class="bu">root</span></span>
<span id="cb82-1358"><a href="#cb82-1358" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">append</span>(<span class="st">"g"</span>)</span>
<span id="cb82-1359"><a href="#cb82-1359" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">"transform"</span><span class="op">,</span> <span class="vs">`translate(</span><span class="sc">${</span>margin<span class="op">.</span><span class="at">left</span> <span class="op">+</span> chartHeight<span class="sc">}</span><span class="vs">, 0)`</span>)</span>
<span id="cb82-1360"><a href="#cb82-1360" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">call</span>(yAxis)</span>
<span id="cb82-1361"><a href="#cb82-1361" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">call</span>((g) <span class="kw">=&gt;</span> g<span class="op">.</span><span class="fu">select</span>(<span class="st">".domain"</span>)<span class="op">.</span><span class="fu">remove</span>())</span>
<span id="cb82-1362"><a href="#cb82-1362" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">call</span>((g) <span class="kw">=&gt;</span> g<span class="op">.</span><span class="fu">selectAll</span>(<span class="st">".tick"</span>)<span class="op">.</span><span class="fu">attr</span>(<span class="st">"color"</span><span class="op">,</span> mapcolors<span class="op">.</span><span class="at">grid</span>))</span>
<span id="cb82-1363"><a href="#cb82-1363" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">call</span>((g) <span class="kw">=&gt;</span> g<span class="op">.</span><span class="fu">selectAll</span>(<span class="st">".tick text"</span>)<span class="op">.</span><span class="fu">attr</span>(<span class="st">"font-size"</span><span class="op">,</span> (width <span class="op">&lt;</span> <span class="dv">400</span> <span class="op">?</span> <span class="op">.</span><span class="dv">9</span> <span class="op">:</span> width <span class="op">&lt;</span> <span class="dv">450</span> <span class="op">?</span> <span class="op">.</span><span class="dv">95</span> <span class="op">:</span> width <span class="op">&lt;</span> <span class="dv">500</span> <span class="op">?</span> <span class="dv">1</span> <span class="op">:</span> width <span class="op">&lt;</span> <span class="dv">600</span> <span class="op">?</span> <span class="fl">1.2</span> <span class="op">:</span> width <span class="op">&lt;</span> <span class="dv">700</span> <span class="op">?</span> <span class="fl">1.3</span> <span class="op">:</span> width <span class="op">&lt;</span> <span class="dv">800</span> <span class="op">?</span> <span class="fl">1.4</span> <span class="op">:</span> width <span class="op">&lt;</span> <span class="dv">900</span> <span class="op">?</span> <span class="fl">1.5</span> <span class="op">:</span> width <span class="op">&lt;</span> <span class="dv">1000</span> <span class="op">?</span> <span class="fl">1.7</span> <span class="op">:</span> width <span class="op">&lt;</span> <span class="dv">1100</span> <span class="op">?</span> <span class="fl">1.8</span> <span class="op">:</span> width <span class="op">&lt;</span> <span class="dv">1200</span> <span class="op">?</span> <span class="fl">1.9</span> <span class="op">:</span> <span class="dv">2</span>) <span class="op">*</span> fontSize))</span>
<span id="cb82-1364"><a href="#cb82-1364" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">call</span>((g) <span class="kw">=&gt;</span> g<span class="op">.</span><span class="fu">selectAll</span>(<span class="st">".tick text"</span>)<span class="op">.</span><span class="fu">attr</span>(<span class="st">"color"</span><span class="op">,</span> <span class="st">"black"</span>))</span>
<span id="cb82-1365"><a href="#cb82-1365" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">call</span>((g) <span class="kw">=&gt;</span> g<span class="op">.</span><span class="fu">selectAll</span>(<span class="st">".tick line"</span>)<span class="op">.</span><span class="fu">attr</span>(<span class="st">"stroke-dasharray"</span><span class="op">,</span> <span class="st">"5 3"</span>))<span class="op">;</span></span>
<span id="cb82-1366"><a href="#cb82-1366" aria-hidden="true" tabindex="-1"></a>  <span class="bu">root</span></span>
<span id="cb82-1367"><a href="#cb82-1367" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">append</span>(<span class="st">"text"</span>)</span>
<span id="cb82-1368"><a href="#cb82-1368" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">text</span>(<span class="st">"Time of day"</span>)</span>
<span id="cb82-1369"><a href="#cb82-1369" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">"x"</span><span class="op">,</span> <span class="op">-</span>chartHeight <span class="op">/</span> <span class="dv">5</span> <span class="op">+</span> (width <span class="op">&lt;</span> <span class="dv">275</span> <span class="op">?</span> <span class="op">-</span><span class="dv">2</span> <span class="op">:</span> width <span class="op">&lt;</span> <span class="dv">300</span> <span class="op">?</span> <span class="op">-</span><span class="dv">6</span> <span class="op">:</span> width <span class="op">&lt;</span> <span class="dv">325</span> <span class="op">?</span> <span class="op">-</span><span class="dv">8</span> <span class="op">:</span> width <span class="op">&lt;</span> <span class="dv">350</span> <span class="op">?</span> <span class="op">-</span><span class="dv">15</span> <span class="op">:</span> width <span class="op">&lt;</span> <span class="dv">375</span> <span class="op">?</span> <span class="op">-</span><span class="dv">20</span> <span class="op">:</span> width <span class="op">&lt;</span> <span class="dv">400</span> <span class="op">?</span> <span class="op">-</span><span class="dv">28</span> <span class="op">:</span> width <span class="op">&lt;</span> <span class="dv">425</span> <span class="op">?</span> <span class="op">-</span><span class="dv">30</span> <span class="op">:</span> width <span class="op">&lt;</span> <span class="dv">450</span> <span class="op">?</span> <span class="op">-</span><span class="dv">32</span> <span class="op">:</span> width <span class="op">&lt;</span> <span class="dv">475</span> <span class="op">?</span> <span class="op">-</span><span class="dv">36</span> <span class="op">:</span> width <span class="op">&lt;</span> <span class="dv">500</span> <span class="op">?</span> <span class="op">-</span><span class="dv">41</span> <span class="op">:</span> width <span class="op">&lt;</span> <span class="dv">525</span> <span class="op">?</span> <span class="op">-</span><span class="dv">42</span> <span class="op">:</span> width <span class="op">&lt;</span> <span class="dv">550</span> <span class="op">?</span> <span class="op">-</span><span class="dv">48</span> <span class="op">:</span> width <span class="op">&lt;</span> <span class="dv">575</span> <span class="op">?</span> <span class="op">-</span><span class="dv">49</span> <span class="op">:</span> width <span class="op">&lt;</span> <span class="dv">600</span> <span class="op">?</span> <span class="op">-</span><span class="dv">4</span> <span class="op">:</span> width <span class="op">&lt;</span> <span class="dv">650</span> <span class="op">?</span> <span class="op">-</span><span class="dv">7</span> <span class="op">:</span> width <span class="op">&lt;</span> <span class="dv">675</span> <span class="op">?</span> <span class="op">-</span><span class="dv">12</span> <span class="op">:</span> width <span class="op">&lt;</span> <span class="dv">700</span> <span class="op">?</span> <span class="op">-</span><span class="dv">16</span> <span class="op">:</span> width <span class="op">&lt;</span> <span class="dv">725</span> <span class="op">?</span> <span class="op">-</span><span class="dv">15</span> <span class="op">:</span> width <span class="op">&lt;</span> <span class="dv">750</span> <span class="op">?</span> <span class="op">-</span><span class="dv">20</span> <span class="op">:</span> width <span class="op">&lt;</span> <span class="dv">775</span> <span class="op">?</span> <span class="op">-</span><span class="dv">5</span> <span class="op">:</span> width <span class="op">&lt;</span> <span class="dv">875</span> <span class="op">?</span> <span class="op">-</span><span class="dv">3</span> <span class="op">:</span> width <span class="op">&lt;</span> <span class="dv">975</span> <span class="op">?</span> <span class="dv">13</span> <span class="op">:</span> width <span class="op">&lt;</span> <span class="dv">1025</span> <span class="op">?</span> <span class="dv">36</span> <span class="op">:</span> width <span class="op">&lt;</span> <span class="dv">1075</span> <span class="op">?</span> <span class="dv">28</span> <span class="op">:</span> width <span class="op">&lt;</span> <span class="dv">1125</span> <span class="op">?</span> <span class="dv">28</span> <span class="op">:</span> width <span class="op">&lt;</span> <span class="dv">1175</span> <span class="op">?</span> <span class="dv">28</span> <span class="op">:</span> width <span class="op">&lt;</span> <span class="dv">1275</span> <span class="op">?</span> <span class="dv">35</span> <span class="op">:</span> <span class="dv">32</span>))</span>
<span id="cb82-1370"><a href="#cb82-1370" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">"y"</span><span class="op">,</span> margin<span class="op">.</span><span class="at">left</span> <span class="op">-</span> (width <span class="op">&lt;</span> <span class="dv">275</span> <span class="op">?</span> <span class="dv">12</span> <span class="op">:</span> width <span class="op">&lt;</span> <span class="dv">300</span> <span class="op">?</span> <span class="dv">16</span> <span class="op">:</span> width <span class="op">&lt;</span> <span class="dv">325</span> <span class="op">?</span> <span class="dv">17</span> <span class="op">:</span> width <span class="op">&lt;</span> <span class="dv">350</span> <span class="op">?</span> <span class="dv">18</span> <span class="op">:</span> width <span class="op">&lt;</span> <span class="dv">375</span> <span class="op">?</span> <span class="dv">19</span> <span class="op">:</span> width <span class="op">&lt;</span> <span class="dv">400</span> <span class="op">?</span> <span class="dv">20</span> <span class="op">:</span> width <span class="op">&lt;</span> <span class="dv">425</span> <span class="op">?</span> <span class="dv">21</span> <span class="op">:</span> width <span class="op">&lt;</span> <span class="dv">450</span> <span class="op">?</span> <span class="dv">22</span> <span class="op">:</span> width <span class="op">&lt;</span> <span class="dv">475</span> <span class="op">?</span> <span class="dv">23</span> <span class="op">:</span> width <span class="op">&lt;</span> <span class="dv">500</span> <span class="op">?</span> <span class="dv">24</span> <span class="op">:</span> width <span class="op">&lt;</span> <span class="dv">525</span> <span class="op">?</span> <span class="dv">25</span> <span class="op">:</span> width <span class="op">&lt;</span> <span class="dv">550</span> <span class="op">?</span> <span class="dv">26</span> <span class="op">:</span> width <span class="op">&lt;</span> <span class="dv">575</span> <span class="op">?</span> <span class="dv">27</span> <span class="op">:</span> width <span class="op">&lt;</span> <span class="dv">600</span> <span class="op">?</span> <span class="dv">28</span> <span class="op">:</span> width <span class="op">&lt;</span> <span class="dv">650</span> <span class="op">?</span> <span class="dv">29</span> <span class="op">:</span> width <span class="op">&lt;</span> <span class="dv">675</span> <span class="op">?</span> <span class="dv">30</span> <span class="op">:</span> width <span class="op">&lt;</span> <span class="dv">700</span> <span class="op">?</span> <span class="dv">31</span> <span class="op">:</span> width <span class="op">&lt;</span> <span class="dv">725</span> <span class="op">?</span> <span class="dv">40</span> <span class="op">:</span> width <span class="op">&lt;</span> <span class="dv">750</span> <span class="op">?</span> <span class="dv">49</span> <span class="op">:</span> width <span class="op">&lt;</span> <span class="dv">775</span> <span class="op">?</span> <span class="dv">46</span> <span class="op">:</span> width <span class="op">&lt;</span> <span class="dv">875</span> <span class="op">?</span> <span class="dv">47</span> <span class="op">:</span> width <span class="op">&lt;</span> <span class="dv">925</span> <span class="op">?</span> <span class="dv">52</span> <span class="op">:</span> width <span class="op">&lt;</span> <span class="dv">975</span> <span class="op">?</span> <span class="dv">53</span> <span class="op">:</span> width <span class="op">&lt;</span> <span class="dv">1025</span> <span class="op">?</span> <span class="dv">54</span> <span class="op">:</span> width <span class="op">&lt;</span> <span class="dv">1075</span> <span class="op">?</span> <span class="dv">55</span> <span class="op">:</span> width <span class="op">&lt;</span> <span class="dv">1175</span> <span class="op">?</span> <span class="dv">64</span> <span class="op">:</span> width <span class="op">&lt;</span> <span class="dv">1275</span> <span class="op">?</span> <span class="dv">68</span> <span class="op">:</span> <span class="dv">64</span>))</span>
<span id="cb82-1371"><a href="#cb82-1371" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">"text-anchor"</span><span class="op">,</span> <span class="st">"middle"</span>)</span>
<span id="cb82-1372"><a href="#cb82-1372" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">"font-size"</span><span class="op">,</span> fontSize <span class="op">*</span> (width <span class="op">&lt;</span> <span class="dv">300</span> <span class="op">?</span> <span class="op">.</span><span class="dv">8</span> <span class="op">:</span> width <span class="op">&lt;</span> <span class="dv">400</span> <span class="op">?</span> <span class="op">.</span><span class="dv">9</span> <span class="op">:</span> width <span class="op">&lt;</span> <span class="dv">500</span> <span class="op">?</span> <span class="dv">1</span> <span class="op">:</span> width <span class="op">&lt;</span> <span class="dv">600</span> <span class="op">?</span> <span class="fl">1.1</span> <span class="op">:</span> width <span class="op">&lt;</span> <span class="dv">700</span> <span class="op">?</span> <span class="fl">1.2</span> <span class="op">:</span> <span class="fl">1.25</span>) <span class="op">+</span> width <span class="op">/</span> <span class="dv">100</span>)</span>
<span id="cb82-1373"><a href="#cb82-1373" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">"font-family"</span><span class="op">,</span> <span class="st">"sans-serif"</span>)</span>
<span id="cb82-1374"><a href="#cb82-1374" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">"transform"</span><span class="op">,</span> <span class="st">"rotate(-90)"</span>)</span>
<span id="cb82-1375"><a href="#cb82-1375" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">"fill"</span><span class="op">,</span> <span class="st">"black"</span>)<span class="op">;</span></span>
<span id="cb82-1376"><a href="#cb82-1376" aria-hidden="true" tabindex="-1"></a>  <span class="bu">root</span></span>
<span id="cb82-1377"><a href="#cb82-1377" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">append</span>(<span class="st">"text"</span>)</span>
<span id="cb82-1378"><a href="#cb82-1378" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">text</span>(<span class="st">"Day of year"</span>)</span>
<span id="cb82-1379"><a href="#cb82-1379" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">"x"</span><span class="op">,</span> margin<span class="op">.</span><span class="at">left</span> <span class="op">+</span> width <span class="op">/</span> <span class="dv">2</span> <span class="op">-</span> (width <span class="op">&lt;</span> <span class="dv">500</span> <span class="op">?</span> <span class="dv">30</span> <span class="op">:</span> width <span class="op">&lt;</span> <span class="dv">600</span> <span class="op">?</span> <span class="dv">28</span> <span class="op">:</span> width <span class="op">&lt;</span> <span class="dv">700</span> <span class="op">?</span> <span class="dv">24</span> <span class="op">:</span> <span class="dv">22</span>))</span>
<span id="cb82-1380"><a href="#cb82-1380" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">"y"</span><span class="op">,</span> margin<span class="op">.</span><span class="at">top</span> <span class="op">+</span> chartHeight <span class="op">/</span> <span class="dv">4</span> <span class="op">+</span> margin<span class="op">.</span><span class="at">bottom</span> <span class="op">+</span> (width <span class="op">&lt;</span> <span class="dv">275</span> <span class="op">?</span> <span class="dv">10</span> <span class="op">:</span> width <span class="op">&lt;</span> <span class="dv">300</span> <span class="op">?</span> <span class="dv">18</span> <span class="op">:</span> width <span class="op">&lt;</span> <span class="dv">325</span> <span class="op">?</span> <span class="dv">19</span> <span class="op">:</span> width <span class="op">&lt;</span> <span class="dv">350</span> <span class="op">?</span> <span class="dv">22</span> <span class="op">:</span> width <span class="op">&lt;</span> <span class="dv">375</span> <span class="op">?</span> <span class="dv">30</span> <span class="op">:</span> width <span class="op">&lt;</span> <span class="dv">400</span> <span class="op">?</span> <span class="dv">37</span> <span class="op">:</span> width <span class="op">&lt;</span> <span class="dv">450</span> <span class="op">?</span> <span class="dv">39</span> <span class="op">:</span> width <span class="op">&lt;</span> <span class="dv">475</span> <span class="op">?</span> <span class="dv">40</span> <span class="op">:</span> width <span class="op">&lt;</span> <span class="dv">500</span> <span class="op">?</span> <span class="dv">44</span> <span class="op">:</span> width <span class="op">&lt;</span> <span class="dv">550</span> <span class="op">?</span> <span class="dv">50</span> <span class="op">:</span> width <span class="op">&lt;</span> <span class="dv">600</span> <span class="op">?</span> <span class="dv">51</span> <span class="op">:</span> width <span class="op">&lt;</span> <span class="dv">650</span> <span class="op">?</span> <span class="dv">45</span> <span class="op">:</span> width <span class="op">&lt;</span> <span class="dv">700</span> <span class="op">?</span> <span class="dv">39</span> <span class="op">:</span> width <span class="op">&lt;</span> <span class="dv">750</span> <span class="op">?</span> <span class="dv">35</span> <span class="op">:</span> width <span class="op">&lt;</span> <span class="dv">850</span> <span class="op">?</span> <span class="dv">45</span> <span class="op">:</span> width <span class="op">&lt;</span> <span class="dv">950</span> <span class="op">?</span> <span class="dv">55</span> <span class="op">:</span> width <span class="op">&lt;</span> <span class="dv">1050</span> <span class="op">?</span> <span class="dv">65</span> <span class="op">:</span> width <span class="op">&lt;</span> <span class="dv">1150</span> <span class="op">?</span> <span class="dv">75</span> <span class="op">:</span> width <span class="op">&lt;</span> <span class="dv">1250</span> <span class="op">?</span> <span class="dv">85</span> <span class="op">:</span> width <span class="op">&lt;</span> <span class="dv">1350</span> <span class="op">?</span> <span class="dv">95</span> <span class="op">:</span> <span class="dv">109</span>))</span>
<span id="cb82-1381"><a href="#cb82-1381" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">"text-anchor"</span><span class="op">,</span> <span class="st">"middle"</span>)</span>
<span id="cb82-1382"><a href="#cb82-1382" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">"font-size"</span><span class="op">,</span> fontSize <span class="op">*</span> (width <span class="op">&lt;</span> <span class="dv">300</span> <span class="op">?</span> <span class="op">.</span><span class="dv">95</span> <span class="op">:</span> width <span class="op">&lt;</span> <span class="dv">400</span> <span class="op">?</span> <span class="dv">1</span> <span class="op">:</span> width <span class="op">&lt;</span> <span class="dv">500</span> <span class="op">?</span> <span class="fl">1.05</span> <span class="op">:</span> width <span class="op">&lt;</span> <span class="dv">600</span> <span class="op">?</span> <span class="fl">1.15</span> <span class="op">:</span> width <span class="op">&lt;</span> <span class="dv">700</span> <span class="op">?</span> <span class="fl">1.2</span> <span class="op">:</span> <span class="fl">1.25</span>) <span class="op">+</span> width <span class="op">/</span> <span class="dv">100</span>)</span>
<span id="cb82-1383"><a href="#cb82-1383" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">"font-family"</span><span class="op">,</span> <span class="st">"sans-serif"</span>)</span>
<span id="cb82-1384"><a href="#cb82-1384" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">"fill"</span><span class="op">,</span> <span class="st">"black"</span>)<span class="op">;</span></span>
<span id="cb82-1385"><a href="#cb82-1385" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> data <span class="op">=</span> <span class="fu">yearDates</span>(year)</span>
<span id="cb82-1386"><a href="#cb82-1386" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">map</span>((d) <span class="kw">=&gt;</span> [d<span class="op">,</span> <span class="fu">dayLength</span>(d<span class="op">,</span> latitude)])</span>
<span id="cb82-1387"><a href="#cb82-1387" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">filter</span>(([_<span class="op">,</span> d]) <span class="kw">=&gt;</span> d <span class="op">&gt;</span> <span class="dv">0</span>)<span class="op">;</span></span>
<span id="cb82-1388"><a href="#cb82-1388" aria-hidden="true" tabindex="-1"></a>  <span class="co">/* Render separate polygons for each continuous sequence of</span></span>
<span id="cb82-1389"><a href="#cb82-1389" aria-hidden="true" tabindex="-1"></a><span class="co">   * days with more than 0 hours of day light</span></span>
<span id="cb82-1390"><a href="#cb82-1390" aria-hidden="true" tabindex="-1"></a><span class="co">   */</span></span>
<span id="cb82-1391"><a href="#cb82-1391" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> polys <span class="op">=</span> []<span class="op">;</span></span>
<span id="cb82-1392"><a href="#cb82-1392" aria-hidden="true" tabindex="-1"></a>  <span class="kw">let</span> currentPoly <span class="op">=</span> []<span class="op">;</span></span>
<span id="cb82-1393"><a href="#cb82-1393" aria-hidden="true" tabindex="-1"></a>  <span class="cf">for</span> (<span class="kw">let</span> i <span class="op">=</span> <span class="dv">0</span><span class="op">;</span> i <span class="op">&lt;</span> data<span class="op">.</span><span class="at">length</span><span class="op">;</span> i<span class="op">++</span>) {</span>
<span id="cb82-1394"><a href="#cb82-1394" aria-hidden="true" tabindex="-1"></a>    <span class="kw">const</span> currentDate <span class="op">=</span> data[i][<span class="dv">0</span>]<span class="op">;</span></span>
<span id="cb82-1395"><a href="#cb82-1395" aria-hidden="true" tabindex="-1"></a>    <span class="kw">const</span> prevDate <span class="op">=</span> (data[i <span class="op">-</span> <span class="dv">1</span>] <span class="op">||</span> [])[<span class="dv">0</span>]<span class="op">;</span></span>
<span id="cb82-1396"><a href="#cb82-1396" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> (</span>
<span id="cb82-1397"><a href="#cb82-1397" aria-hidden="true" tabindex="-1"></a>      i <span class="op">===</span> <span class="dv">0</span> <span class="op">||</span></span>
<span id="cb82-1398"><a href="#cb82-1398" aria-hidden="true" tabindex="-1"></a>      currentDate<span class="op">.</span><span class="fu">getTime</span>() <span class="op">-</span> prevDate<span class="op">.</span><span class="fu">getTime</span>() <span class="op">&lt;</span> <span class="dv">3600</span> <span class="op">*</span> <span class="dv">24</span> <span class="op">*</span> <span class="dv">1000</span> <span class="op">*</span> <span class="fl">1.5</span></span>
<span id="cb82-1399"><a href="#cb82-1399" aria-hidden="true" tabindex="-1"></a>    ) {</span>
<span id="cb82-1400"><a href="#cb82-1400" aria-hidden="true" tabindex="-1"></a>      currentPoly<span class="op">.</span><span class="fu">push</span>(data[i])<span class="op">;</span></span>
<span id="cb82-1401"><a href="#cb82-1401" aria-hidden="true" tabindex="-1"></a>    } <span class="cf">else</span> {</span>
<span id="cb82-1402"><a href="#cb82-1402" aria-hidden="true" tabindex="-1"></a>      polys<span class="op">.</span><span class="fu">push</span>(currentPoly)<span class="op">;</span></span>
<span id="cb82-1403"><a href="#cb82-1403" aria-hidden="true" tabindex="-1"></a>      currentPoly <span class="op">=</span> [data[i]]<span class="op">;</span></span>
<span id="cb82-1404"><a href="#cb82-1404" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb82-1405"><a href="#cb82-1405" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb82-1406"><a href="#cb82-1406" aria-hidden="true" tabindex="-1"></a>  polys<span class="op">.</span><span class="fu">push</span>(currentPoly)<span class="op">;</span></span>
<span id="cb82-1407"><a href="#cb82-1407" aria-hidden="true" tabindex="-1"></a>  polys<span class="op">.</span><span class="fu">forEach</span>((p) <span class="kw">=&gt;</span> {</span>
<span id="cb82-1408"><a href="#cb82-1408" aria-hidden="true" tabindex="-1"></a>    <span class="kw">const</span> points <span class="op">=</span> [</span>
<span id="cb82-1409"><a href="#cb82-1409" aria-hidden="true" tabindex="-1"></a>      <span class="op">...</span>p<span class="op">.</span><span class="fu">map</span>(([d<span class="op">,</span> l]) <span class="kw">=&gt;</span> <span class="vs">`</span><span class="sc">${</span><span class="fu">xScale</span>(d)<span class="sc">}</span><span class="vs">,</span><span class="sc">${</span><span class="fu">yScale</span>(<span class="dv">12</span> <span class="op">-</span> l <span class="op">/</span> <span class="dv">2</span>)<span class="sc">}</span><span class="vs">`</span>)<span class="op">,</span></span>
<span id="cb82-1410"><a href="#cb82-1410" aria-hidden="true" tabindex="-1"></a>      <span class="op">...</span>p<span class="op">.</span><span class="fu">reverse</span>()<span class="op">.</span><span class="fu">map</span>(([d<span class="op">,</span> l]) <span class="kw">=&gt;</span> <span class="vs">`</span><span class="sc">${</span><span class="fu">xScale</span>(d)<span class="sc">}</span><span class="vs">,</span><span class="sc">${</span><span class="fu">yScale</span>(<span class="dv">12</span> <span class="op">+</span> l <span class="op">/</span> <span class="dv">2</span>)<span class="sc">}</span><span class="vs">`</span>)</span>
<span id="cb82-1411"><a href="#cb82-1411" aria-hidden="true" tabindex="-1"></a>    ]<span class="op">.</span><span class="fu">join</span>(<span class="st">" "</span>)<span class="op">;</span></span>
<span id="cb82-1412"><a href="#cb82-1412" aria-hidden="true" tabindex="-1"></a>    <span class="bu">root</span><span class="op">.</span><span class="fu">append</span>(<span class="st">"polygon"</span>)<span class="op">.</span><span class="fu">attr</span>(<span class="st">"points"</span><span class="op">,</span> points)<span class="op">.</span><span class="fu">attr</span>(<span class="st">"fill"</span><span class="op">,</span> mapcolors<span class="op">.</span><span class="at">day</span>)<span class="op">;</span></span>
<span id="cb82-1413"><a href="#cb82-1413" aria-hidden="true" tabindex="-1"></a>  })<span class="op">;</span></span>
<span id="cb82-1414"><a href="#cb82-1414" aria-hidden="true" tabindex="-1"></a>  <span class="co">/* Legend */</span></span>
<span id="cb82-1415"><a href="#cb82-1415" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> legend <span class="op">=</span> <span class="bu">root</span></span>
<span id="cb82-1416"><a href="#cb82-1416" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">append</span>(<span class="st">"g"</span>)</span>
<span id="cb82-1417"><a href="#cb82-1417" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">"transform"</span><span class="op">,</span> <span class="vs">`translate(</span><span class="sc">${</span>margin<span class="op">.</span><span class="at">left</span> <span class="op">+</span> chartWidth <span class="op">/</span> <span class="dv">2</span> <span class="op">-</span> <span class="dv">64</span><span class="sc">}</span><span class="vs">)`</span>)<span class="op">;</span></span>
<span id="cb82-1418"><a href="#cb82-1418" aria-hidden="true" tabindex="-1"></a>  legend</span>
<span id="cb82-1419"><a href="#cb82-1419" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">append</span>(<span class="st">"rect"</span>)</span>
<span id="cb82-1420"><a href="#cb82-1420" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">"x"</span><span class="op">,</span> chartWidth <span class="op">/</span> <span class="dv">20</span> <span class="op">+</span> (width <span class="op">&lt;</span> <span class="dv">275</span> <span class="op">?</span> <span class="dv">1</span> <span class="op">:</span> width <span class="op">&lt;</span> <span class="dv">300</span> <span class="op">?</span> <span class="dv">2</span> <span class="op">:</span> width <span class="op">&lt;</span> <span class="dv">325</span> <span class="op">?</span> <span class="dv">3</span> <span class="op">:</span> width <span class="op">&lt;</span> <span class="dv">350</span> <span class="op">?</span> <span class="dv">4</span> <span class="op">:</span> width <span class="op">&lt;</span> <span class="dv">375</span> <span class="op">?</span> <span class="dv">5</span> <span class="op">:</span> width <span class="op">&lt;</span> <span class="dv">400</span> <span class="op">?</span> <span class="dv">6</span> <span class="op">:</span> width <span class="op">&lt;</span> <span class="dv">450</span> <span class="op">?</span> <span class="dv">7</span> <span class="op">:</span> width <span class="op">&lt;</span> <span class="dv">475</span> <span class="op">?</span> <span class="dv">8</span> <span class="op">:</span> width <span class="op">&lt;</span> <span class="dv">500</span> <span class="op">?</span> <span class="dv">9</span> <span class="op">:</span> width <span class="op">&lt;</span> <span class="dv">550</span> <span class="op">?</span> <span class="dv">10</span> <span class="op">:</span> width <span class="op">&lt;</span> <span class="dv">600</span> <span class="op">?</span> <span class="dv">11</span> <span class="op">:</span> width <span class="op">&lt;</span> <span class="dv">650</span> <span class="op">?</span> <span class="dv">12</span> <span class="op">:</span> width <span class="op">&lt;</span> <span class="dv">700</span> <span class="op">?</span> <span class="dv">13</span> <span class="op">:</span> width <span class="op">&lt;</span> <span class="dv">750</span> <span class="op">?</span> <span class="dv">14</span> <span class="op">:</span> width <span class="op">&lt;</span> <span class="dv">850</span> <span class="op">?</span> <span class="dv">5</span> <span class="op">:</span> width <span class="op">&lt;</span> <span class="dv">950</span> <span class="op">?</span> <span class="op">-</span><span class="dv">6</span> <span class="op">:</span> width <span class="op">&lt;</span> <span class="dv">1050</span> <span class="op">?</span> <span class="op">-</span><span class="dv">8</span> <span class="op">:</span> width <span class="op">&lt;</span> <span class="dv">1150</span> <span class="op">?</span> <span class="op">-</span><span class="dv">8</span> <span class="op">:</span> width <span class="op">&lt;</span> <span class="dv">1250</span> <span class="op">?</span> <span class="op">-</span><span class="dv">8</span> <span class="op">:</span> width <span class="op">&lt;</span> <span class="dv">1350</span> <span class="op">?</span> <span class="op">-</span><span class="dv">8</span> <span class="op">:</span> width <span class="op">&lt;</span> <span class="dv">1400</span> <span class="op">?</span> <span class="op">-</span><span class="dv">8</span> <span class="op">:</span> <span class="op">-</span><span class="dv">100</span>))</span>
<span id="cb82-1421"><a href="#cb82-1421" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">"y"</span><span class="op">,</span> chartHeight <span class="op">/</span> <span class="dv">4</span> <span class="op">+</span> (width <span class="op">&lt;</span> <span class="dv">300</span> <span class="op">?</span> <span class="dv">81</span> <span class="op">:</span> width <span class="op">&lt;</span> <span class="dv">400</span> <span class="op">?</span> <span class="dv">82</span> <span class="op">:</span> width <span class="op">&lt;</span> <span class="dv">450</span> <span class="op">?</span> <span class="dv">83</span> <span class="op">:</span> width <span class="op">&lt;</span> <span class="dv">500</span> <span class="op">?</span> <span class="dv">52</span> <span class="op">:</span> width <span class="op">&lt;</span> <span class="dv">600</span> <span class="op">?</span> <span class="dv">54</span> <span class="op">:</span> width <span class="op">&lt;</span> <span class="dv">700</span> <span class="op">?</span> <span class="dv">85</span> <span class="op">:</span> width <span class="op">&lt;</span> <span class="dv">800</span> <span class="op">?</span> <span class="dv">94</span> <span class="op">:</span> width <span class="op">&lt;</span> <span class="dv">900</span> <span class="op">?</span> <span class="dv">99</span> <span class="op">:</span> width <span class="op">&lt;</span> <span class="dv">1000</span> <span class="op">?</span> <span class="dv">109</span> <span class="op">:</span> width <span class="op">&lt;</span> <span class="dv">1100</span> <span class="op">?</span> <span class="dv">139</span> <span class="op">:</span> width <span class="op">&lt;</span> <span class="dv">1200</span> <span class="op">?</span> <span class="dv">179</span> <span class="op">:</span> <span class="dv">154</span>))</span>
<span id="cb82-1422"><a href="#cb82-1422" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">"rx"</span><span class="op">,</span> <span class="dv">5</span>)</span>
<span id="cb82-1423"><a href="#cb82-1423" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">"width"</span><span class="op">,</span> fontSize <span class="op">*</span> (width <span class="op">&lt;</span> <span class="dv">300</span> <span class="op">?</span> <span class="op">.</span><span class="dv">95</span> <span class="op">:</span> width <span class="op">&lt;</span> <span class="dv">400</span> <span class="op">?</span> <span class="dv">1</span> <span class="op">:</span> width <span class="op">&lt;</span> <span class="dv">500</span> <span class="op">?</span> <span class="fl">1.05</span> <span class="op">:</span> width <span class="op">&lt;</span> <span class="dv">600</span> <span class="op">?</span> <span class="fl">1.15</span> <span class="op">:</span> width <span class="op">&lt;</span> <span class="dv">700</span> <span class="op">?</span> <span class="fl">1.2</span> <span class="op">:</span> <span class="fl">1.25</span>) <span class="op">+</span> width <span class="op">/</span> <span class="dv">100</span>)</span>
<span id="cb82-1424"><a href="#cb82-1424" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">"height"</span><span class="op">,</span> fontSize <span class="op">*</span> (width <span class="op">&lt;</span> <span class="dv">300</span> <span class="op">?</span> <span class="op">.</span><span class="dv">95</span> <span class="op">:</span> width <span class="op">&lt;</span> <span class="dv">400</span> <span class="op">?</span> <span class="dv">1</span> <span class="op">:</span> width <span class="op">&lt;</span> <span class="dv">500</span> <span class="op">?</span> <span class="fl">1.05</span> <span class="op">:</span> width <span class="op">&lt;</span> <span class="dv">600</span> <span class="op">?</span> <span class="fl">1.15</span> <span class="op">:</span> width <span class="op">&lt;</span> <span class="dv">700</span> <span class="op">?</span> <span class="fl">1.2</span> <span class="op">:</span> <span class="fl">1.25</span>) <span class="op">+</span> width <span class="op">/</span> <span class="dv">100</span>)</span>
<span id="cb82-1425"><a href="#cb82-1425" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">"fill"</span><span class="op">,</span> mapcolors<span class="op">.</span><span class="at">day</span>)<span class="op">;</span></span>
<span id="cb82-1426"><a href="#cb82-1426" aria-hidden="true" tabindex="-1"></a>  legend</span>
<span id="cb82-1427"><a href="#cb82-1427" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">append</span>(<span class="st">"text"</span>)</span>
<span id="cb82-1428"><a href="#cb82-1428" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">"x"</span><span class="op">,</span> chartWidth <span class="op">/</span> <span class="dv">20</span> <span class="op">+</span> (width <span class="op">&lt;</span> <span class="dv">275</span> <span class="op">?</span> <span class="dv">1</span> <span class="op">:</span> width <span class="op">&lt;</span> <span class="dv">300</span> <span class="op">?</span> <span class="dv">2</span> <span class="op">:</span> width <span class="op">&lt;</span> <span class="dv">325</span> <span class="op">?</span> <span class="dv">3</span> <span class="op">:</span> width <span class="op">&lt;</span> <span class="dv">350</span> <span class="op">?</span> <span class="dv">4</span> <span class="op">:</span> width <span class="op">&lt;</span> <span class="dv">375</span> <span class="op">?</span> <span class="dv">5</span> <span class="op">:</span> width <span class="op">&lt;</span> <span class="dv">400</span> <span class="op">?</span> <span class="dv">6</span> <span class="op">:</span> width <span class="op">&lt;</span> <span class="dv">450</span> <span class="op">?</span> <span class="dv">7</span> <span class="op">:</span> width <span class="op">&lt;</span> <span class="dv">475</span> <span class="op">?</span> <span class="dv">8</span> <span class="op">:</span> width <span class="op">&lt;</span> <span class="dv">500</span> <span class="op">?</span> <span class="dv">9</span> <span class="op">:</span> width <span class="op">&lt;</span> <span class="dv">550</span> <span class="op">?</span> <span class="dv">10</span> <span class="op">:</span> width <span class="op">&lt;</span> <span class="dv">600</span> <span class="op">?</span> <span class="dv">11</span> <span class="op">:</span> width <span class="op">&lt;</span> <span class="dv">650</span> <span class="op">?</span> <span class="dv">12</span> <span class="op">:</span> width <span class="op">&lt;</span> <span class="dv">700</span> <span class="op">?</span> <span class="dv">13</span> <span class="op">:</span> width <span class="op">&lt;</span> <span class="dv">750</span> <span class="op">?</span> <span class="dv">14</span> <span class="op">:</span> width <span class="op">&lt;</span> <span class="dv">850</span> <span class="op">?</span> <span class="dv">19</span> <span class="op">:</span> width <span class="op">&lt;</span> <span class="dv">950</span> <span class="op">?</span> <span class="dv">29</span> <span class="op">:</span> width <span class="op">&lt;</span> <span class="dv">1050</span> <span class="op">?</span> <span class="dv">29</span> <span class="op">:</span> width <span class="op">&lt;</span> <span class="dv">1150</span> <span class="op">?</span> <span class="dv">29</span> <span class="op">:</span> width <span class="op">&lt;</span> <span class="dv">1250</span> <span class="op">?</span> <span class="dv">29</span> <span class="op">:</span> width <span class="op">&lt;</span> <span class="dv">1350</span> <span class="op">?</span> <span class="dv">29</span> <span class="op">:</span> width <span class="op">&lt;</span> <span class="dv">1400</span> <span class="op">?</span> <span class="dv">33</span> <span class="op">:</span> <span class="op">-</span><span class="dv">62</span>))</span>
<span id="cb82-1429"><a href="#cb82-1429" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">"y"</span><span class="op">,</span> chartHeight <span class="op">/</span> <span class="dv">4</span> <span class="op">+</span> (width <span class="op">&lt;</span> <span class="dv">300</span> <span class="op">?</span> <span class="dv">72</span> <span class="op">:</span> width <span class="op">&lt;</span> <span class="dv">400</span> <span class="op">?</span> <span class="dv">73</span> <span class="op">:</span> width <span class="op">&lt;</span> <span class="dv">450</span> <span class="op">?</span> <span class="dv">74</span> <span class="op">:</span> width <span class="op">&lt;</span> <span class="dv">500</span> <span class="op">?</span> <span class="dv">68</span> <span class="op">:</span> width <span class="op">&lt;</span> <span class="dv">600</span> <span class="op">?</span> <span class="dv">70</span> <span class="op">:</span> width <span class="op">&lt;</span> <span class="dv">700</span> <span class="op">?</span> <span class="dv">74</span> <span class="op">:</span> width <span class="op">&lt;</span> <span class="dv">800</span> <span class="op">?</span> <span class="dv">72</span> <span class="op">:</span> width <span class="op">&lt;</span> <span class="dv">900</span> <span class="op">?</span> <span class="dv">122</span> <span class="op">:</span> width <span class="op">&lt;</span> <span class="dv">1000</span> <span class="op">?</span> <span class="dv">132</span> <span class="op">:</span> width <span class="op">&lt;</span> <span class="dv">1100</span> <span class="op">?</span> <span class="dv">142</span> <span class="op">:</span> width <span class="op">&lt;</span> <span class="dv">1200</span> <span class="op">?</span> <span class="dv">152</span> <span class="op">:</span> <span class="dv">182</span>))</span>
<span id="cb82-1430"><a href="#cb82-1430" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">"font-size"</span><span class="op">,</span> fontSize <span class="op">*</span> (width <span class="op">&lt;</span> <span class="dv">300</span> <span class="op">?</span> <span class="op">.</span><span class="dv">95</span> <span class="op">:</span> width <span class="op">&lt;</span> <span class="dv">400</span> <span class="op">?</span> <span class="dv">1</span> <span class="op">:</span> width <span class="op">&lt;</span> <span class="dv">500</span> <span class="op">?</span> <span class="fl">1.05</span> <span class="op">:</span> width <span class="op">&lt;</span> <span class="dv">600</span> <span class="op">?</span> <span class="fl">1.15</span> <span class="op">:</span> width <span class="op">&lt;</span> <span class="dv">700</span> <span class="op">?</span> <span class="fl">1.2</span> <span class="op">:</span> <span class="fl">1.25</span>) <span class="op">+</span> width <span class="op">/</span> <span class="dv">100</span>)</span>
<span id="cb82-1431"><a href="#cb82-1431" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">"font-family"</span><span class="op">,</span> <span class="st">"sans-serif"</span>)</span>
<span id="cb82-1432"><a href="#cb82-1432" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">text</span>(<span class="st">"Day"</span>)<span class="op">;</span></span>
<span id="cb82-1433"><a href="#cb82-1433" aria-hidden="true" tabindex="-1"></a>  legend</span>
<span id="cb82-1434"><a href="#cb82-1434" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">append</span>(<span class="st">"rect"</span>)</span>
<span id="cb82-1435"><a href="#cb82-1435" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">"x"</span><span class="op">,</span> chartWidth <span class="op">/</span> <span class="dv">20</span> <span class="op">+</span> (width <span class="op">&lt;</span> <span class="dv">275</span> <span class="op">?</span> <span class="op">-</span><span class="dv">59</span> <span class="op">:</span> width <span class="op">&lt;</span> <span class="dv">300</span> <span class="op">?</span> <span class="op">-</span><span class="dv">58</span> <span class="op">:</span> width <span class="op">&lt;</span> <span class="dv">325</span> <span class="op">?</span> <span class="op">-</span><span class="dv">57</span> <span class="op">:</span> width <span class="op">&lt;</span> <span class="dv">350</span> <span class="op">?</span> <span class="op">-</span><span class="dv">56</span> <span class="op">:</span> width <span class="op">&lt;</span> <span class="dv">375</span> <span class="op">?</span> <span class="op">-</span><span class="dv">55</span> <span class="op">:</span> width <span class="op">&lt;</span> <span class="dv">400</span> <span class="op">?</span> <span class="op">-</span><span class="dv">54</span> <span class="op">:</span> width <span class="op">&lt;</span> <span class="dv">450</span> <span class="op">?</span> <span class="op">-</span><span class="dv">53</span> <span class="op">:</span> width <span class="op">&lt;</span> <span class="dv">475</span> <span class="op">?</span> <span class="op">-</span><span class="dv">52</span> <span class="op">:</span> width <span class="op">&lt;</span> <span class="dv">500</span> <span class="op">?</span> <span class="op">-</span><span class="dv">51</span> <span class="op">:</span> width <span class="op">&lt;</span> <span class="dv">550</span> <span class="op">?</span> <span class="op">-</span><span class="dv">50</span> <span class="op">:</span> width <span class="op">&lt;</span> <span class="dv">600</span> <span class="op">?</span> <span class="op">-</span><span class="dv">51</span> <span class="op">:</span> width <span class="op">&lt;</span> <span class="dv">650</span> <span class="op">?</span> <span class="op">-</span><span class="dv">52</span> <span class="op">:</span> width <span class="op">&lt;</span> <span class="dv">700</span> <span class="op">?</span> <span class="op">-</span><span class="dv">53</span> <span class="op">:</span> width <span class="op">&lt;</span> <span class="dv">750</span> <span class="op">?</span> <span class="op">-</span><span class="dv">74</span> <span class="op">:</span> width <span class="op">&lt;</span> <span class="dv">850</span> <span class="op">?</span> <span class="op">-</span><span class="dv">132</span> <span class="op">:</span> width <span class="op">&lt;</span> <span class="dv">950</span> <span class="op">?</span> <span class="op">-</span><span class="dv">132</span> <span class="op">:</span> width <span class="op">&lt;</span> <span class="dv">1050</span> <span class="op">?</span> <span class="op">-</span><span class="dv">132</span> <span class="op">:</span> width <span class="op">&lt;</span> <span class="dv">1150</span> <span class="op">?</span> <span class="op">-</span><span class="dv">132</span> <span class="op">:</span> width <span class="op">&lt;</span> <span class="dv">1250</span> <span class="op">?</span> <span class="op">-</span><span class="dv">132</span> <span class="op">:</span> width <span class="op">&lt;</span> <span class="dv">1350</span> <span class="op">?</span> <span class="op">-</span><span class="dv">132</span> <span class="op">:</span> width <span class="op">&lt;</span> <span class="dv">1400</span> <span class="op">?</span> <span class="op">-</span><span class="dv">148</span> <span class="op">:</span> <span class="op">-</span><span class="dv">240</span>))</span>
<span id="cb82-1436"><a href="#cb82-1436" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">"y"</span><span class="op">,</span> chartHeight <span class="op">/</span> <span class="dv">4</span> <span class="op">+</span> (width <span class="op">&lt;</span> <span class="dv">300</span> <span class="op">?</span> <span class="dv">81</span> <span class="op">:</span> width <span class="op">&lt;</span> <span class="dv">400</span> <span class="op">?</span> <span class="dv">82</span> <span class="op">:</span> width <span class="op">&lt;</span> <span class="dv">450</span> <span class="op">?</span> <span class="dv">83</span> <span class="op">:</span> width <span class="op">&lt;</span> <span class="dv">500</span> <span class="op">?</span> <span class="dv">52</span> <span class="op">:</span> width <span class="op">&lt;</span> <span class="dv">600</span> <span class="op">?</span> <span class="dv">54</span> <span class="op">:</span> width <span class="op">&lt;</span> <span class="dv">700</span> <span class="op">?</span> <span class="dv">85</span> <span class="op">:</span> width <span class="op">&lt;</span> <span class="dv">800</span> <span class="op">?</span> <span class="dv">94</span> <span class="op">:</span> width <span class="op">&lt;</span> <span class="dv">900</span> <span class="op">?</span> <span class="dv">99</span> <span class="op">:</span> width <span class="op">&lt;</span> <span class="dv">1000</span> <span class="op">?</span> <span class="dv">109</span> <span class="op">:</span> width <span class="op">&lt;</span> <span class="dv">1100</span> <span class="op">?</span> <span class="dv">139</span> <span class="op">:</span> width <span class="op">&lt;</span> <span class="dv">1200</span> <span class="op">?</span> <span class="dv">179</span> <span class="op">:</span> <span class="dv">154</span>))</span>
<span id="cb82-1437"><a href="#cb82-1437" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">"rx"</span><span class="op">,</span> <span class="dv">5</span>)</span>
<span id="cb82-1438"><a href="#cb82-1438" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">"width"</span><span class="op">,</span> fontSize <span class="op">*</span> (width <span class="op">&lt;</span> <span class="dv">300</span> <span class="op">?</span> <span class="op">.</span><span class="dv">95</span> <span class="op">:</span> width <span class="op">&lt;</span> <span class="dv">400</span> <span class="op">?</span> <span class="dv">1</span> <span class="op">:</span> width <span class="op">&lt;</span> <span class="dv">500</span> <span class="op">?</span> <span class="fl">1.05</span> <span class="op">:</span> width <span class="op">&lt;</span> <span class="dv">600</span> <span class="op">?</span> <span class="fl">1.15</span> <span class="op">:</span> width <span class="op">&lt;</span> <span class="dv">700</span> <span class="op">?</span> <span class="fl">1.2</span> <span class="op">:</span> <span class="fl">1.25</span>) <span class="op">+</span> width <span class="op">/</span> <span class="dv">100</span>)</span>
<span id="cb82-1439"><a href="#cb82-1439" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">"height"</span><span class="op">,</span> fontSize <span class="op">*</span> (width <span class="op">&lt;</span> <span class="dv">300</span> <span class="op">?</span> <span class="op">.</span><span class="dv">95</span> <span class="op">:</span> width <span class="op">&lt;</span> <span class="dv">400</span> <span class="op">?</span> <span class="dv">1</span> <span class="op">:</span> width <span class="op">&lt;</span> <span class="dv">500</span> <span class="op">?</span> <span class="fl">1.05</span> <span class="op">:</span> width <span class="op">&lt;</span> <span class="dv">600</span> <span class="op">?</span> <span class="fl">1.15</span> <span class="op">:</span> width <span class="op">&lt;</span> <span class="dv">700</span> <span class="op">?</span> <span class="fl">1.2</span> <span class="op">:</span> <span class="fl">1.25</span>) <span class="op">+</span> width <span class="op">/</span> <span class="dv">100</span>)</span>
<span id="cb82-1440"><a href="#cb82-1440" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">"fill"</span><span class="op">,</span> mapcolors<span class="op">.</span><span class="at">night</span>)<span class="op">;</span></span>
<span id="cb82-1441"><a href="#cb82-1441" aria-hidden="true" tabindex="-1"></a>  legend</span>
<span id="cb82-1442"><a href="#cb82-1442" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">append</span>(<span class="st">"text"</span>)</span>
<span id="cb82-1443"><a href="#cb82-1443" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">"x"</span><span class="op">,</span> chartWidth <span class="op">/</span> <span class="dv">20</span> <span class="op">+</span> (width <span class="op">&lt;</span> <span class="dv">275</span> <span class="op">?</span> <span class="dv">9</span> <span class="op">:</span> width <span class="op">&lt;</span> <span class="dv">300</span> <span class="op">?</span> <span class="dv">8</span> <span class="op">:</span> width <span class="op">&lt;</span> <span class="dv">325</span> <span class="op">?</span> <span class="dv">7</span> <span class="op">:</span> width <span class="op">&lt;</span> <span class="dv">350</span> <span class="op">?</span> <span class="dv">6</span> <span class="op">:</span> width <span class="op">&lt;</span> <span class="dv">375</span> <span class="op">?</span> <span class="dv">5</span> <span class="op">:</span> width <span class="op">&lt;</span> <span class="dv">400</span> <span class="op">?</span> <span class="dv">4</span> <span class="op">:</span> width <span class="op">&lt;</span> <span class="dv">450</span> <span class="op">?</span> <span class="dv">3</span> <span class="op">:</span> width <span class="op">&lt;</span> <span class="dv">475</span> <span class="op">?</span> <span class="dv">2</span> <span class="op">:</span> width <span class="op">&lt;</span> <span class="dv">500</span> <span class="op">?</span> <span class="dv">1</span> <span class="op">:</span> width <span class="op">&lt;</span> <span class="dv">550</span> <span class="op">?</span> <span class="dv">0</span> <span class="op">:</span> width <span class="op">&lt;</span> <span class="dv">600</span> <span class="op">?</span> <span class="op">-</span><span class="dv">1</span> <span class="op">:</span> width <span class="op">&lt;</span> <span class="dv">650</span> <span class="op">?</span> <span class="op">-</span><span class="dv">2</span> <span class="op">:</span> width <span class="op">&lt;</span> <span class="dv">700</span> <span class="op">?</span> <span class="op">-</span><span class="dv">3</span> <span class="op">:</span> width <span class="op">&lt;</span> <span class="dv">750</span> <span class="op">?</span> <span class="op">-</span><span class="dv">19</span> <span class="op">:</span> width <span class="op">&lt;</span> <span class="dv">850</span> <span class="op">?</span> <span class="op">-</span><span class="dv">98</span> <span class="op">:</span> width <span class="op">&lt;</span> <span class="dv">950</span> <span class="op">?</span> <span class="op">-</span><span class="dv">98</span> <span class="op">:</span> width <span class="op">&lt;</span> <span class="dv">1050</span> <span class="op">?</span> <span class="op">-</span><span class="dv">98</span> <span class="op">:</span> width <span class="op">&lt;</span> <span class="dv">1150</span> <span class="op">?</span> <span class="op">-</span><span class="dv">98</span> <span class="op">:</span> width <span class="op">&lt;</span> <span class="dv">1250</span> <span class="op">?</span> <span class="op">-</span><span class="dv">98</span> <span class="op">:</span> width <span class="op">&lt;</span> <span class="dv">1350</span> <span class="op">?</span> <span class="op">-</span><span class="dv">98</span> <span class="op">:</span> width <span class="op">&lt;</span> <span class="dv">1400</span> <span class="op">?</span> <span class="op">-</span><span class="dv">108</span> <span class="op">:</span> <span class="op">-</span><span class="dv">201</span>))</span>
<span id="cb82-1444"><a href="#cb82-1444" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">"y"</span><span class="op">,</span> chartHeight <span class="op">/</span> <span class="dv">4</span> <span class="op">+</span> (width <span class="op">&lt;</span> <span class="dv">300</span> <span class="op">?</span> <span class="dv">72</span> <span class="op">:</span> width <span class="op">&lt;</span> <span class="dv">400</span> <span class="op">?</span> <span class="dv">73</span> <span class="op">:</span> width <span class="op">&lt;</span> <span class="dv">450</span> <span class="op">?</span> <span class="dv">74</span> <span class="op">:</span> width <span class="op">&lt;</span> <span class="dv">500</span> <span class="op">?</span> <span class="dv">68</span> <span class="op">:</span> width <span class="op">&lt;</span> <span class="dv">600</span> <span class="op">?</span> <span class="dv">70</span> <span class="op">:</span> width <span class="op">&lt;</span> <span class="dv">700</span> <span class="op">?</span> <span class="dv">74</span> <span class="op">:</span> width <span class="op">&lt;</span> <span class="dv">800</span> <span class="op">?</span> <span class="dv">72</span> <span class="op">:</span> width <span class="op">&lt;</span> <span class="dv">900</span> <span class="op">?</span> <span class="dv">122</span> <span class="op">:</span> width <span class="op">&lt;</span> <span class="dv">1000</span> <span class="op">?</span> <span class="dv">132</span> <span class="op">:</span> width <span class="op">&lt;</span> <span class="dv">1100</span> <span class="op">?</span> <span class="dv">142</span> <span class="op">:</span> width <span class="op">&lt;</span> <span class="dv">1200</span> <span class="op">?</span> <span class="dv">152</span> <span class="op">:</span> <span class="dv">182</span>))</span>
<span id="cb82-1445"><a href="#cb82-1445" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">"font-size"</span><span class="op">,</span> fontSize <span class="op">*</span> (width <span class="op">&lt;</span> <span class="dv">300</span> <span class="op">?</span> <span class="op">.</span><span class="dv">95</span> <span class="op">:</span> width <span class="op">&lt;</span> <span class="dv">400</span> <span class="op">?</span> <span class="dv">1</span> <span class="op">:</span> width <span class="op">&lt;</span> <span class="dv">500</span> <span class="op">?</span> <span class="fl">1.05</span> <span class="op">:</span> width <span class="op">&lt;</span> <span class="dv">600</span> <span class="op">?</span> <span class="fl">1.15</span> <span class="op">:</span> width <span class="op">&lt;</span> <span class="dv">700</span> <span class="op">?</span> <span class="fl">1.2</span> <span class="op">:</span> <span class="fl">1.25</span>) <span class="op">+</span> width <span class="op">/</span> <span class="dv">100</span>)</span>
<span id="cb82-1446"><a href="#cb82-1446" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">"font-family"</span><span class="op">,</span> <span class="st">"sans-serif"</span>)</span>
<span id="cb82-1447"><a href="#cb82-1447" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">text</span>(<span class="st">"Night"</span>)<span class="op">;</span></span>
<span id="cb82-1448"><a href="#cb82-1448" aria-hidden="true" tabindex="-1"></a>  <span class="co">/* Time and date controls */</span></span>
<span id="cb82-1449"><a href="#cb82-1449" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> dateLine <span class="op">=</span> <span class="bu">root</span><span class="op">.</span><span class="fu">append</span>(<span class="st">"g"</span>)<span class="op">;</span></span>
<span id="cb82-1450"><a href="#cb82-1450" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> updateControlPositions <span class="op">=</span> () <span class="kw">=&gt;</span> {</span>
<span id="cb82-1451"><a href="#cb82-1451" aria-hidden="true" tabindex="-1"></a>    dateLine</span>
<span id="cb82-1452"><a href="#cb82-1452" aria-hidden="true" tabindex="-1"></a>      <span class="op">.</span><span class="fu">select</span>(<span class="st">"line"</span>)</span>
<span id="cb82-1453"><a href="#cb82-1453" aria-hidden="true" tabindex="-1"></a>      <span class="op">.</span><span class="fu">attr</span>(<span class="st">"y1"</span><span class="op">,</span> <span class="fu">yScale</span>(<span class="dv">0</span>))</span>
<span id="cb82-1454"><a href="#cb82-1454" aria-hidden="true" tabindex="-1"></a>      <span class="op">.</span><span class="fu">attr</span>(<span class="st">"x1"</span><span class="op">,</span> <span class="fu">xScale</span>(date))</span>
<span id="cb82-1455"><a href="#cb82-1455" aria-hidden="true" tabindex="-1"></a>      <span class="op">.</span><span class="fu">attr</span>(<span class="st">"y2"</span><span class="op">,</span> <span class="fu">yScale</span>(<span class="dv">24</span>))</span>
<span id="cb82-1456"><a href="#cb82-1456" aria-hidden="true" tabindex="-1"></a>      <span class="op">.</span><span class="fu">attr</span>(<span class="st">"x2"</span><span class="op">,</span> <span class="fu">xScale</span>(date))<span class="op">;</span></span>
<span id="cb82-1457"><a href="#cb82-1457" aria-hidden="true" tabindex="-1"></a>    dateLine</span>
<span id="cb82-1458"><a href="#cb82-1458" aria-hidden="true" tabindex="-1"></a>      <span class="op">.</span><span class="fu">select</span>(<span class="st">"rect"</span>)</span>
<span id="cb82-1459"><a href="#cb82-1459" aria-hidden="true" tabindex="-1"></a>      <span class="op">.</span><span class="fu">attr</span>(<span class="st">"y"</span><span class="op">,</span> <span class="fu">yScale</span>(<span class="dv">0</span>))</span>
<span id="cb82-1460"><a href="#cb82-1460" aria-hidden="true" tabindex="-1"></a>      <span class="op">.</span><span class="fu">attr</span>(<span class="st">"x"</span><span class="op">,</span> <span class="fu">xScale</span>(date) <span class="op">-</span> <span class="dv">4</span>)<span class="op">;</span></span>
<span id="cb82-1461"><a href="#cb82-1461" aria-hidden="true" tabindex="-1"></a>    <span class="bu">root</span></span>
<span id="cb82-1462"><a href="#cb82-1462" aria-hidden="true" tabindex="-1"></a>      <span class="op">.</span><span class="fu">select</span>(<span class="st">"#time-control"</span>)</span>
<span id="cb82-1463"><a href="#cb82-1463" aria-hidden="true" tabindex="-1"></a>      <span class="op">.</span><span class="fu">attr</span>(<span class="st">"cy"</span><span class="op">,</span> <span class="fu">yScale</span>(hour))</span>
<span id="cb82-1464"><a href="#cb82-1464" aria-hidden="true" tabindex="-1"></a>      <span class="op">.</span><span class="fu">attr</span>(<span class="st">"cx"</span><span class="op">,</span> <span class="fu">xScale</span>(date))<span class="op">;</span></span>
<span id="cb82-1465"><a href="#cb82-1465" aria-hidden="true" tabindex="-1"></a>  }<span class="op">;</span></span>
<span id="cb82-1466"><a href="#cb82-1466" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> dispatchDateHourChange <span class="op">=</span> () <span class="kw">=&gt;</span> {</span>
<span id="cb82-1467"><a href="#cb82-1467" aria-hidden="true" tabindex="-1"></a>    <span class="kw">const</span> detail <span class="op">=</span> { date<span class="op">,</span> hour }<span class="op">;</span></span>
<span id="cb82-1468"><a href="#cb82-1468" aria-hidden="true" tabindex="-1"></a>    <span class="kw">const</span> changeEvent <span class="op">=</span> <span class="kw">new</span> <span class="bu">CustomEvent</span>(EventType<span class="op">.</span><span class="at">DateHourChange</span><span class="op">,</span> {</span>
<span id="cb82-1469"><a href="#cb82-1469" aria-hidden="true" tabindex="-1"></a>      detail<span class="op">,</span></span>
<span id="cb82-1470"><a href="#cb82-1470" aria-hidden="true" tabindex="-1"></a>      <span class="dt">bubbles</span><span class="op">:</span> <span class="kw">true</span></span>
<span id="cb82-1471"><a href="#cb82-1471" aria-hidden="true" tabindex="-1"></a>    })<span class="op">;</span></span>
<span id="cb82-1472"><a href="#cb82-1472" aria-hidden="true" tabindex="-1"></a>    <span class="bu">root</span><span class="op">.</span><span class="fu">node</span>()<span class="op">.</span><span class="fu">dispatchEvent</span>(changeEvent)<span class="op">;</span></span>
<span id="cb82-1473"><a href="#cb82-1473" aria-hidden="true" tabindex="-1"></a>  }<span class="op">;</span></span>
<span id="cb82-1474"><a href="#cb82-1474" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> handleDateLineDrag <span class="op">=</span> ({ x }) <span class="kw">=&gt;</span> {</span>
<span id="cb82-1475"><a href="#cb82-1475" aria-hidden="true" tabindex="-1"></a>    date <span class="op">=</span> xScale<span class="op">.</span><span class="fu">invert</span>(x)<span class="op">;</span></span>
<span id="cb82-1476"><a href="#cb82-1476" aria-hidden="true" tabindex="-1"></a>    <span class="fu">updateControlPositions</span>()<span class="op">;</span></span>
<span id="cb82-1477"><a href="#cb82-1477" aria-hidden="true" tabindex="-1"></a>    <span class="fu">dispatchDateHourChange</span>()<span class="op">;</span></span>
<span id="cb82-1478"><a href="#cb82-1478" aria-hidden="true" tabindex="-1"></a>  }<span class="op">;</span></span>
<span id="cb82-1479"><a href="#cb82-1479" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> handleTimeCircleDrag <span class="op">=</span> ({ y }) <span class="kw">=&gt;</span> {</span>
<span id="cb82-1480"><a href="#cb82-1480" aria-hidden="true" tabindex="-1"></a>    hour <span class="op">=</span> yScale<span class="op">.</span><span class="fu">invert</span>(y)<span class="op">;</span></span>
<span id="cb82-1481"><a href="#cb82-1481" aria-hidden="true" tabindex="-1"></a>    <span class="fu">updateControlPositions</span>()<span class="op">;</span></span>
<span id="cb82-1482"><a href="#cb82-1482" aria-hidden="true" tabindex="-1"></a>    <span class="fu">dispatchDateHourChange</span>()<span class="op">;</span></span>
<span id="cb82-1483"><a href="#cb82-1483" aria-hidden="true" tabindex="-1"></a>  }<span class="op">;</span></span>
<span id="cb82-1484"><a href="#cb82-1484" aria-hidden="true" tabindex="-1"></a>  dateLine<span class="op">.</span><span class="fu">append</span>(<span class="st">"line"</span>)<span class="op">.</span><span class="fu">attr</span>(<span class="st">"stroke-width"</span><span class="op">,</span> <span class="dv">4</span>)<span class="op">.</span><span class="fu">attr</span>(<span class="st">"stroke"</span><span class="op">,</span> <span class="st">"red"</span>)<span class="op">;</span></span>
<span id="cb82-1485"><a href="#cb82-1485" aria-hidden="true" tabindex="-1"></a>  dateLine</span>
<span id="cb82-1486"><a href="#cb82-1486" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">append</span>(<span class="st">"rect"</span>)</span>
<span id="cb82-1487"><a href="#cb82-1487" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">"height"</span><span class="op">,</span> chartWidth)</span>
<span id="cb82-1488"><a href="#cb82-1488" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">"width"</span><span class="op">,</span> <span class="dv">8</span>)</span>
<span id="cb82-1489"><a href="#cb82-1489" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">"fill"</span><span class="op">,</span> <span class="st">"rgba(0, 0, 0, 0)"</span>)</span>
<span id="cb82-1490"><a href="#cb82-1490" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">style</span>(<span class="st">"cursor"</span><span class="op">,</span> <span class="st">"row-resize"</span>)</span>
<span id="cb82-1491"><a href="#cb82-1491" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">call</span>(d3<span class="op">.</span><span class="fu">drag</span>()<span class="op">.</span><span class="fu">on</span>(<span class="st">"drag"</span><span class="op">,</span> handleDateLineDrag))<span class="op">;</span></span>
<span id="cb82-1492"><a href="#cb82-1492" aria-hidden="true" tabindex="-1"></a>  <span class="bu">root</span></span>
<span id="cb82-1493"><a href="#cb82-1493" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">append</span>(<span class="st">"circle"</span>)</span>
<span id="cb82-1494"><a href="#cb82-1494" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">"id"</span><span class="op">,</span> <span class="st">"time-control"</span>)</span>
<span id="cb82-1495"><a href="#cb82-1495" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">"r"</span><span class="op">,</span> <span class="dv">12</span>)</span>
<span id="cb82-1496"><a href="#cb82-1496" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">"fill"</span><span class="op">,</span> <span class="st">"red"</span>)</span>
<span id="cb82-1497"><a href="#cb82-1497" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">"stroke-width"</span><span class="op">,</span> <span class="op">.</span><span class="dv">6</span>)</span>
<span id="cb82-1498"><a href="#cb82-1498" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">"stroke"</span><span class="op">,</span> <span class="st">"black"</span>)</span>
<span id="cb82-1499"><a href="#cb82-1499" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">style</span>(<span class="st">"cursor"</span><span class="op">,</span> <span class="st">"pointer"</span>)</span>
<span id="cb82-1500"><a href="#cb82-1500" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">call</span>(d3<span class="op">.</span><span class="fu">drag</span>()<span class="op">.</span><span class="fu">on</span>(<span class="st">"drag"</span><span class="op">,</span> handleTimeCircleDrag))<span class="op">;</span></span>
<span id="cb82-1501"><a href="#cb82-1501" aria-hidden="true" tabindex="-1"></a>  <span class="fu">updateControlPositions</span>()<span class="op">;</span></span>
<span id="cb82-1502"><a href="#cb82-1502" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb82-1503"><a href="#cb82-1503" aria-hidden="true" tabindex="-1"></a>fontSize <span class="op">=</span> <span class="dv">14</span><span class="op">;</span></span>
<span id="cb82-1504"><a href="#cb82-1504" aria-hidden="true" tabindex="-1"></a>getSolarAngle <span class="op">=</span> (date) <span class="kw">=&gt;</span> (<span class="fu">dayOfYear</span>(date) <span class="op">+</span> <span class="dv">10</span>) <span class="op">/</span> <span class="dv">365</span> <span class="op">*</span> <span class="bu">Math</span><span class="op">.</span><span class="cn">PI</span> <span class="op">*</span> <span class="dv">2</span> <span class="op">-</span> <span class="bu">Math</span><span class="op">.</span><span class="cn">PI</span> <span class="op">/</span> <span class="dv">2</span><span class="op">;</span></span>
<span id="cb82-1505"><a href="#cb82-1505" aria-hidden="true" tabindex="-1"></a><span class="co">/*</span></span>
<span id="cb82-1506"><a href="#cb82-1506" aria-hidden="true" tabindex="-1"></a><span class="co"> * Formulas uses the CBM model as reviewed here:</span></span>
<span id="cb82-1507"><a href="#cb82-1507" aria-hidden="true" tabindex="-1"></a><span class="co"> * https://www.ikhebeenvraag.be/mediastorage/FSDocument/171/Forsythe+-+A+model+comparison+for+daylength+as+a+function+of+latitude+and+day+of+year+-+1995.pdf</span></span>
<span id="cb82-1508"><a href="#cb82-1508" aria-hidden="true" tabindex="-1"></a><span class="co"> */</span></span>
<span id="cb82-1509"><a href="#cb82-1509" aria-hidden="true" tabindex="-1"></a>dayLength <span class="op">=</span> (date<span class="op">,</span> latitude) <span class="kw">=&gt;</span> {</span>
<span id="cb82-1510"><a href="#cb82-1510" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> yearStart <span class="op">=</span> <span class="kw">new</span> <span class="bu">Date</span>(date<span class="op">.</span><span class="fu">getFullYear</span>()<span class="op">,</span> <span class="dv">0</span><span class="op">,</span> <span class="dv">1</span>)<span class="op">;</span></span>
<span id="cb82-1511"><a href="#cb82-1511" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> dayOfYear <span class="op">=</span> <span class="bu">Math</span><span class="op">.</span><span class="fu">floor</span>((date<span class="op">.</span><span class="fu">getTime</span>() <span class="op">-</span> yearStart<span class="op">.</span><span class="fu">getTime</span>())<span class="op">/</span><span class="dv">86400000</span>) <span class="op">+</span> <span class="dv">1</span><span class="op">;</span></span>
<span id="cb82-1512"><a href="#cb82-1512" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> revAngle <span class="op">=</span> <span class="fl">0.2163108</span> <span class="op">+</span> <span class="dv">2</span> <span class="op">*</span> <span class="bu">Math</span><span class="op">.</span><span class="fu">atan</span>(<span class="fl">0.9671396</span> <span class="op">*</span> <span class="bu">Math</span><span class="op">.</span><span class="fu">tan</span>(<span class="fl">0.00860</span> <span class="op">*</span> (dayOfYear <span class="op">-</span> <span class="dv">186</span>)))<span class="op">;</span></span>
<span id="cb82-1513"><a href="#cb82-1513" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> decAngle <span class="op">=</span> <span class="bu">Math</span><span class="op">.</span><span class="fu">asin</span>(<span class="fl">0.39795</span> <span class="op">*</span> <span class="bu">Math</span><span class="op">.</span><span class="fu">cos</span>(revAngle))<span class="op">;</span></span>
<span id="cb82-1514"><a href="#cb82-1514" aria-hidden="true" tabindex="-1"></a>  <span class="co">/* daylight coefficient selected for apparent sunrise/sunset */</span></span>
<span id="cb82-1515"><a href="#cb82-1515" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> p <span class="op">=</span> <span class="fl">0.8333</span></span>
<span id="cb82-1516"><a href="#cb82-1516" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> intResult <span class="op">=</span></span>
<span id="cb82-1517"><a href="#cb82-1517" aria-hidden="true" tabindex="-1"></a>    (<span class="bu">Math</span><span class="op">.</span><span class="fu">sin</span>((p <span class="op">*</span> <span class="bu">Math</span><span class="op">.</span><span class="cn">PI</span>) <span class="op">/</span> <span class="dv">180</span>) <span class="op">+</span></span>
<span id="cb82-1518"><a href="#cb82-1518" aria-hidden="true" tabindex="-1"></a>      <span class="bu">Math</span><span class="op">.</span><span class="fu">sin</span>((latitude <span class="op">*</span> <span class="bu">Math</span><span class="op">.</span><span class="cn">PI</span>) <span class="op">/</span> <span class="dv">180</span>) <span class="op">*</span> <span class="bu">Math</span><span class="op">.</span><span class="fu">sin</span>(decAngle)) <span class="op">/</span></span>
<span id="cb82-1519"><a href="#cb82-1519" aria-hidden="true" tabindex="-1"></a>    (<span class="bu">Math</span><span class="op">.</span><span class="fu">cos</span>((latitude <span class="op">*</span> <span class="bu">Math</span><span class="op">.</span><span class="cn">PI</span>) <span class="op">/</span> <span class="dv">180</span>) <span class="op">*</span> <span class="bu">Math</span><span class="op">.</span><span class="fu">cos</span>(decAngle))<span class="op">;</span></span>
<span id="cb82-1520"><a href="#cb82-1520" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (intResult <span class="op">&gt;=</span> <span class="dv">1</span>) <span class="cf">return</span> <span class="dv">24</span><span class="op">;</span></span>
<span id="cb82-1521"><a href="#cb82-1521" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (intResult <span class="op">&lt;=</span> <span class="op">-</span><span class="dv">1</span>) <span class="cf">return</span> <span class="dv">0</span><span class="op">;</span></span>
<span id="cb82-1522"><a href="#cb82-1522" aria-hidden="true" tabindex="-1"></a>  <span class="cf">return</span> <span class="dv">24</span> <span class="op">-</span> <span class="dv">24</span> <span class="op">*</span> <span class="bu">Math</span><span class="op">.</span><span class="fu">acos</span>(intResult) <span class="op">/</span> <span class="bu">Math</span><span class="op">.</span><span class="cn">PI</span><span class="op">;</span></span>
<span id="cb82-1523"><a href="#cb82-1523" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb82-1524"><a href="#cb82-1524" aria-hidden="true" tabindex="-1"></a>yearDates <span class="op">=</span> (year) <span class="kw">=&gt;</span> {</span>
<span id="cb82-1525"><a href="#cb82-1525" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> startDate <span class="op">=</span> <span class="kw">new</span> <span class="bu">Date</span>(year<span class="op">,</span> <span class="dv">0</span><span class="op">,</span> <span class="dv">1</span><span class="op">+</span><span class="dv">60</span>)<span class="op">;</span></span>
<span id="cb82-1526"><a href="#cb82-1526" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> endDate <span class="op">=</span> <span class="kw">new</span> <span class="bu">Date</span>(year <span class="op">+</span> <span class="dv">1</span><span class="op">,</span> <span class="dv">0</span><span class="op">,</span> <span class="dv">1</span><span class="op">+</span><span class="dv">60</span>)<span class="op">;</span></span>
<span id="cb82-1527"><a href="#cb82-1527" aria-hidden="true" tabindex="-1"></a>  <span class="cf">return</span> d3<span class="op">.</span><span class="at">timeDay</span><span class="op">.</span><span class="fu">range</span>(startDate<span class="op">,</span> endDate)<span class="op">;</span></span>
<span id="cb82-1528"><a href="#cb82-1528" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb82-1529"><a href="#cb82-1529" aria-hidden="true" tabindex="-1"></a>height <span class="op">=</span> {</span>
<span id="cb82-1530"><a href="#cb82-1530" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> [[x0<span class="op">,</span> y0]<span class="op">,</span> [x1<span class="op">,</span> y1]] <span class="op">=</span> d3<span class="op">.</span><span class="fu">geoPath</span>(projection<span class="op">.</span><span class="fu">fitWidth</span>(width<span class="op">,</span> sphere))<span class="op">.</span><span class="fu">bounds</span>(sphere)<span class="op">;</span></span>
<span id="cb82-1531"><a href="#cb82-1531" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> dy <span class="op">=</span> <span class="bu">Math</span><span class="op">.</span><span class="fu">ceil</span>(y1 <span class="op">-</span> y0)<span class="op">,</span> l <span class="op">=</span> <span class="bu">Math</span><span class="op">.</span><span class="fu">min</span>(<span class="bu">Math</span><span class="op">.</span><span class="fu">ceil</span>(x1 <span class="op">-</span> x0)<span class="op">,</span> dy)<span class="op">;</span></span>
<span id="cb82-1532"><a href="#cb82-1532" aria-hidden="true" tabindex="-1"></a>  projection<span class="op">.</span><span class="fu">scale</span>(projection<span class="op">.</span><span class="fu">scale</span>() <span class="op">*</span> (l <span class="op">-</span> <span class="dv">1</span>) <span class="op">/</span> l)<span class="op">.</span><span class="fu">precision</span>(<span class="fl">0.2</span>)<span class="op">;</span></span>
<span id="cb82-1533"><a href="#cb82-1533" aria-hidden="true" tabindex="-1"></a>  <span class="cf">return</span> dy<span class="op">;</span></span>
<span id="cb82-1534"><a href="#cb82-1534" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb82-1535"><a href="#cb82-1535" aria-hidden="true" tabindex="-1"></a>sphere <span class="op">=</span> ({<span class="dt">type</span><span class="op">:</span> <span class="st">"Sphere"</span>})</span>
<span id="cb82-1536"><a href="#cb82-1536" aria-hidden="true" tabindex="-1"></a>selectedProjection <span class="op">=</span> select <span class="op">?</span> select<span class="op">.</span><span class="fu">value</span>() <span class="op">:</span> d3<span class="op">.</span><span class="fu">geoEquirectangular</span>()</span>
<span id="cb82-1537"><a href="#cb82-1537" aria-hidden="true" tabindex="-1"></a>projection <span class="op">=</span> {</span>
<span id="cb82-1538"><a href="#cb82-1538" aria-hidden="true" tabindex="-1"></a>  <span class="kw">let</span> proj <span class="op">=</span> selectedProjection<span class="op">;</span></span>
<span id="cb82-1539"><a href="#cb82-1539" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (proj<span class="op">.</span><span class="at">rotate</span>) proj<span class="op">.</span><span class="fu">rotate</span>([<span class="op">-</span><span class="fu">turn2long</span>(yaw)<span class="op">,</span> <span class="op">-</span><span class="fu">turn2degr</span>(pitch)<span class="op">,</span> <span class="fu">turn2degr</span>(roll)])<span class="op">;</span></span>
<span id="cb82-1540"><a href="#cb82-1540" aria-hidden="true" tabindex="-1"></a>  <span class="cf">return</span> proj<span class="op">;</span></span>
<span id="cb82-1541"><a href="#cb82-1541" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb82-1542"><a href="#cb82-1542" aria-hidden="true" tabindex="-1"></a><span class="co">// https://observablehq.com/@fil/d3-projections</span></span>
<span id="cb82-1543"><a href="#cb82-1543" aria-hidden="true" tabindex="-1"></a>projections <span class="op">=</span> [</span>
<span id="cb82-1544"><a href="#cb82-1544" aria-hidden="true" tabindex="-1"></a>  { <span class="dt">name</span><span class="op">:</span> <span class="st">"Airocean"</span><span class="op">,</span> <span class="dt">value</span><span class="op">:</span> d3<span class="op">.</span><span class="at">geoAirocean</span> }<span class="op">,</span></span>
<span id="cb82-1545"><a href="#cb82-1545" aria-hidden="true" tabindex="-1"></a>  { <span class="dt">name</span><span class="op">:</span> <span class="st">"Airy’s minimum error"</span><span class="op">,</span> <span class="dt">value</span><span class="op">:</span> d3<span class="op">.</span><span class="at">geoAiry</span> }<span class="op">,</span></span>
<span id="cb82-1546"><a href="#cb82-1546" aria-hidden="true" tabindex="-1"></a>  { <span class="dt">name</span><span class="op">:</span> <span class="st">"Aitoff"</span><span class="op">,</span> <span class="dt">value</span><span class="op">:</span> d3<span class="op">.</span><span class="at">geoAitoff</span> }<span class="op">,</span></span>
<span id="cb82-1547"><a href="#cb82-1547" aria-hidden="true" tabindex="-1"></a>  { <span class="dt">name</span><span class="op">:</span> <span class="st">"American polyconic"</span><span class="op">,</span> <span class="dt">value</span><span class="op">:</span> d3<span class="op">.</span><span class="at">geoPolyconic</span> }<span class="op">,</span></span>
<span id="cb82-1548"><a href="#cb82-1548" aria-hidden="true" tabindex="-1"></a>  { <span class="dt">name</span><span class="op">:</span> <span class="st">"Armadillo"</span><span class="op">,</span> <span class="dt">value</span><span class="op">:</span> d3<span class="op">.</span><span class="at">geoArmadillo</span><span class="op">,</span> <span class="dt">options</span><span class="op">:</span> { <span class="dt">clip</span><span class="op">:</span> { <span class="dt">type</span><span class="op">:</span> <span class="st">"Sphere"</span> } } }<span class="op">,</span></span>
<span id="cb82-1549"><a href="#cb82-1549" aria-hidden="true" tabindex="-1"></a>  { <span class="dt">name</span><span class="op">:</span> <span class="st">"August"</span><span class="op">,</span> <span class="dt">value</span><span class="op">:</span> d3<span class="op">.</span><span class="at">geoAugust</span> }<span class="op">,</span></span>
<span id="cb82-1550"><a href="#cb82-1550" aria-hidden="true" tabindex="-1"></a>  { <span class="dt">name</span><span class="op">:</span> <span class="st">"azimuthal equal-area"</span><span class="op">,</span> <span class="dt">value</span><span class="op">:</span> d3<span class="op">.</span><span class="at">geoAzimuthalEqualArea</span> }<span class="op">,</span></span>
<span id="cb82-1551"><a href="#cb82-1551" aria-hidden="true" tabindex="-1"></a>  { <span class="dt">name</span><span class="op">:</span> <span class="st">"azimuthal equidistant"</span><span class="op">,</span> <span class="dt">value</span><span class="op">:</span> d3<span class="op">.</span><span class="at">geoAzimuthalEquidistant</span> }<span class="op">,</span></span>
<span id="cb82-1552"><a href="#cb82-1552" aria-hidden="true" tabindex="-1"></a>  { <span class="dt">name</span><span class="op">:</span> <span class="st">"Baker dinomic"</span><span class="op">,</span> <span class="dt">value</span><span class="op">:</span> d3<span class="op">.</span><span class="at">geoBaker</span> }<span class="op">,</span></span>
<span id="cb82-1553"><a href="#cb82-1553" aria-hidden="true" tabindex="-1"></a>  { <span class="dt">name</span><span class="op">:</span> <span class="st">"Berghaus’ star"</span><span class="op">,</span> <span class="dt">value</span><span class="op">:</span> d3<span class="op">.</span><span class="at">geoBerghaus</span><span class="op">,</span> <span class="dt">options</span><span class="op">:</span> { <span class="dt">clip</span><span class="op">:</span> { <span class="dt">type</span><span class="op">:</span> <span class="st">"Sphere"</span> } } }<span class="op">,</span></span>
<span id="cb82-1554"><a href="#cb82-1554" aria-hidden="true" tabindex="-1"></a>  { <span class="dt">name</span><span class="op">:</span> <span class="st">"Bertin’s 1953"</span><span class="op">,</span> <span class="dt">value</span><span class="op">:</span> d3<span class="op">.</span><span class="at">geoBertin1953</span> }<span class="op">,</span></span>
<span id="cb82-1555"><a href="#cb82-1555" aria-hidden="true" tabindex="-1"></a>  { <span class="dt">name</span><span class="op">:</span> <span class="st">"Boggs’ eumorphic"</span><span class="op">,</span> <span class="dt">value</span><span class="op">:</span> d3<span class="op">.</span><span class="at">geoBoggs</span> }<span class="op">,</span></span>
<span id="cb82-1556"><a href="#cb82-1556" aria-hidden="true" tabindex="-1"></a>  { <span class="dt">name</span><span class="op">:</span> <span class="st">"Boggs’ eumorphic (interrupted)"</span><span class="op">,</span> <span class="dt">value</span><span class="op">:</span> d3<span class="op">.</span><span class="at">geoInterruptedBoggs</span><span class="op">,</span> <span class="dt">options</span><span class="op">:</span> { <span class="dt">clip</span><span class="op">:</span> { <span class="dt">type</span><span class="op">:</span> <span class="st">"Sphere"</span> } } }<span class="op">,</span></span>
<span id="cb82-1557"><a href="#cb82-1557" aria-hidden="true" tabindex="-1"></a>  { <span class="dt">name</span><span class="op">:</span> <span class="st">"Bonne"</span><span class="op">,</span> <span class="dt">value</span><span class="op">:</span> d3<span class="op">.</span><span class="at">geoBonne</span> }<span class="op">,</span></span>
<span id="cb82-1558"><a href="#cb82-1558" aria-hidden="true" tabindex="-1"></a>  { <span class="dt">name</span><span class="op">:</span> <span class="st">"Bottomley"</span><span class="op">,</span> <span class="dt">value</span><span class="op">:</span> d3<span class="op">.</span><span class="at">geoBottomley</span> }<span class="op">,</span></span>
<span id="cb82-1559"><a href="#cb82-1559" aria-hidden="true" tabindex="-1"></a>  { <span class="dt">name</span><span class="op">:</span> <span class="st">"Bromley"</span><span class="op">,</span> <span class="dt">value</span><span class="op">:</span> d3<span class="op">.</span><span class="at">geoBromley</span> }<span class="op">,</span></span>
<span id="cb82-1560"><a href="#cb82-1560" aria-hidden="true" tabindex="-1"></a>  { <span class="dt">name</span><span class="op">:</span> <span class="st">"Butterfly (gnomonic)"</span><span class="op">,</span> <span class="dt">value</span><span class="op">:</span> d3<span class="op">.</span><span class="at">geoPolyhedralButterfly</span> }<span class="op">,</span></span>
<span id="cb82-1561"><a href="#cb82-1561" aria-hidden="true" tabindex="-1"></a>  { <span class="dt">name</span><span class="op">:</span> <span class="st">"Butterfly (Collignon)"</span><span class="op">,</span> <span class="dt">value</span><span class="op">:</span> d3<span class="op">.</span><span class="at">geoPolyhedralCollignon</span> }<span class="op">,</span></span>
<span id="cb82-1562"><a href="#cb82-1562" aria-hidden="true" tabindex="-1"></a>  { <span class="dt">name</span><span class="op">:</span> <span class="st">"Butterfly (Waterman)"</span><span class="op">,</span> <span class="dt">value</span><span class="op">:</span> d3<span class="op">.</span><span class="at">geoPolyhedralWaterman</span> }<span class="op">,</span></span>
<span id="cb82-1563"><a href="#cb82-1563" aria-hidden="true" tabindex="-1"></a>  { <span class="dt">name</span><span class="op">:</span> <span class="st">"Cahill-Keyes"</span><span class="op">,</span> <span class="dt">value</span><span class="op">:</span> d3<span class="op">.</span><span class="at">geoCahillKeyes</span> }<span class="op">,</span></span>
<span id="cb82-1564"><a href="#cb82-1564" aria-hidden="true" tabindex="-1"></a>  { <span class="dt">name</span><span class="op">:</span> <span class="st">"Collignon"</span><span class="op">,</span> <span class="dt">value</span><span class="op">:</span> d3<span class="op">.</span><span class="at">geoCollignon</span> }<span class="op">,</span></span>
<span id="cb82-1565"><a href="#cb82-1565" aria-hidden="true" tabindex="-1"></a>  { <span class="dt">name</span><span class="op">:</span> <span class="st">"conic equal-area"</span><span class="op">,</span> <span class="dt">value</span><span class="op">:</span> d3<span class="op">.</span><span class="at">geoConicEqualArea</span> }<span class="op">,</span></span>
<span id="cb82-1566"><a href="#cb82-1566" aria-hidden="true" tabindex="-1"></a>  { <span class="dt">name</span><span class="op">:</span> <span class="st">"conic equidistant"</span><span class="op">,</span> <span class="dt">value</span><span class="op">:</span> d3<span class="op">.</span><span class="at">geoConicEquidistant</span> }<span class="op">,</span></span>
<span id="cb82-1567"><a href="#cb82-1567" aria-hidden="true" tabindex="-1"></a>  { <span class="dt">name</span><span class="op">:</span> <span class="st">"Craig retroazimuthal"</span><span class="op">,</span> <span class="dt">value</span><span class="op">:</span> d3<span class="op">.</span><span class="at">geoCraig</span> }<span class="op">,</span></span>
<span id="cb82-1568"><a href="#cb82-1568" aria-hidden="true" tabindex="-1"></a>  { <span class="dt">name</span><span class="op">:</span> <span class="st">"Craster parabolic"</span><span class="op">,</span> <span class="dt">value</span><span class="op">:</span> d3<span class="op">.</span><span class="at">geoCraster</span> }<span class="op">,</span></span>
<span id="cb82-1569"><a href="#cb82-1569" aria-hidden="true" tabindex="-1"></a>  { <span class="dt">name</span><span class="op">:</span> <span class="st">"Cox"</span><span class="op">,</span> <span class="dt">value</span><span class="op">:</span> d3<span class="op">.</span><span class="at">geoCox</span> }<span class="op">,</span></span>
<span id="cb82-1570"><a href="#cb82-1570" aria-hidden="true" tabindex="-1"></a>  { <span class="dt">name</span><span class="op">:</span> <span class="st">"cubic"</span><span class="op">,</span> <span class="dt">value</span><span class="op">:</span> d3<span class="op">.</span><span class="at">geoCubic</span> }<span class="op">,</span></span>
<span id="cb82-1571"><a href="#cb82-1571" aria-hidden="true" tabindex="-1"></a>  { <span class="dt">name</span><span class="op">:</span> <span class="st">"cylindrical equal-area"</span><span class="op">,</span> <span class="dt">value</span><span class="op">:</span> d3<span class="op">.</span><span class="at">geoCylindricalEqualArea</span> }<span class="op">,</span></span>
<span id="cb82-1572"><a href="#cb82-1572" aria-hidden="true" tabindex="-1"></a>  { <span class="dt">name</span><span class="op">:</span> <span class="st">"cylindrical stereographic"</span><span class="op">,</span> <span class="dt">value</span><span class="op">:</span> d3<span class="op">.</span><span class="at">geoCylindricalStereographic</span> }<span class="op">,</span></span>
<span id="cb82-1573"><a href="#cb82-1573" aria-hidden="true" tabindex="-1"></a>  { <span class="dt">name</span><span class="op">:</span> <span class="st">"dodecahedral"</span><span class="op">,</span> <span class="dt">value</span><span class="op">:</span> d3<span class="op">.</span><span class="at">geoDodecahedral</span> }<span class="op">,</span></span>
<span id="cb82-1574"><a href="#cb82-1574" aria-hidden="true" tabindex="-1"></a>  { <span class="dt">name</span><span class="op">:</span> <span class="st">"Eckert I"</span><span class="op">,</span> <span class="dt">value</span><span class="op">:</span> d3<span class="op">.</span><span class="at">geoEckert1</span> }<span class="op">,</span></span>
<span id="cb82-1575"><a href="#cb82-1575" aria-hidden="true" tabindex="-1"></a>  { <span class="dt">name</span><span class="op">:</span> <span class="st">"Eckert II"</span><span class="op">,</span> <span class="dt">value</span><span class="op">:</span> d3<span class="op">.</span><span class="at">geoEckert2</span> }<span class="op">,</span></span>
<span id="cb82-1576"><a href="#cb82-1576" aria-hidden="true" tabindex="-1"></a>  { <span class="dt">name</span><span class="op">:</span> <span class="st">"Eckert III"</span><span class="op">,</span> <span class="dt">value</span><span class="op">:</span> d3<span class="op">.</span><span class="at">geoEckert3</span> }<span class="op">,</span></span>
<span id="cb82-1577"><a href="#cb82-1577" aria-hidden="true" tabindex="-1"></a>  { <span class="dt">name</span><span class="op">:</span> <span class="st">"Eckert IV"</span><span class="op">,</span> <span class="dt">value</span><span class="op">:</span> d3<span class="op">.</span><span class="at">geoEckert4</span> }<span class="op">,</span></span>
<span id="cb82-1578"><a href="#cb82-1578" aria-hidden="true" tabindex="-1"></a>  { <span class="dt">name</span><span class="op">:</span> <span class="st">"Eckert V"</span><span class="op">,</span> <span class="dt">value</span><span class="op">:</span> d3<span class="op">.</span><span class="at">geoEckert5</span> }<span class="op">,</span></span>
<span id="cb82-1579"><a href="#cb82-1579" aria-hidden="true" tabindex="-1"></a>  { <span class="dt">name</span><span class="op">:</span> <span class="st">"Eckert VI"</span><span class="op">,</span> <span class="dt">value</span><span class="op">:</span> d3<span class="op">.</span><span class="at">geoEckert6</span> }<span class="op">,</span></span>
<span id="cb82-1580"><a href="#cb82-1580" aria-hidden="true" tabindex="-1"></a>  { <span class="dt">name</span><span class="op">:</span> <span class="st">"Eisenlohr conformal"</span><span class="op">,</span> <span class="dt">value</span><span class="op">:</span> d3<span class="op">.</span><span class="at">geoEisenlohr</span> }<span class="op">,</span></span>
<span id="cb82-1581"><a href="#cb82-1581" aria-hidden="true" tabindex="-1"></a>  { <span class="dt">name</span><span class="op">:</span> <span class="st">"Equal Earth"</span><span class="op">,</span> <span class="dt">value</span><span class="op">:</span> d3<span class="op">.</span><span class="at">geoEqualEarth</span> }<span class="op">,</span></span>
<span id="cb82-1582"><a href="#cb82-1582" aria-hidden="true" tabindex="-1"></a>  { <span class="dt">name</span><span class="op">:</span> <span class="st">"Equirectangular (plate carrée)"</span><span class="op">,</span> <span class="dt">value</span><span class="op">:</span> d3<span class="op">.</span><span class="at">geoEquirectangular</span> }<span class="op">,</span></span>
<span id="cb82-1583"><a href="#cb82-1583" aria-hidden="true" tabindex="-1"></a>  { <span class="dt">name</span><span class="op">:</span> <span class="st">"Fahey pseudocylindrical"</span><span class="op">,</span> <span class="dt">value</span><span class="op">:</span> d3<span class="op">.</span><span class="at">geoFahey</span> }<span class="op">,</span></span>
<span id="cb82-1584"><a href="#cb82-1584" aria-hidden="true" tabindex="-1"></a>  { <span class="dt">name</span><span class="op">:</span> <span class="st">"flat-polar parabolic"</span><span class="op">,</span> <span class="dt">value</span><span class="op">:</span> d3<span class="op">.</span><span class="at">geoMtFlatPolarParabolic</span> }<span class="op">,</span></span>
<span id="cb82-1585"><a href="#cb82-1585" aria-hidden="true" tabindex="-1"></a>  { <span class="dt">name</span><span class="op">:</span> <span class="st">"flat-polar quartic"</span><span class="op">,</span> <span class="dt">value</span><span class="op">:</span> d3<span class="op">.</span><span class="at">geoMtFlatPolarQuartic</span> }<span class="op">,</span></span>
<span id="cb82-1586"><a href="#cb82-1586" aria-hidden="true" tabindex="-1"></a>  { <span class="dt">name</span><span class="op">:</span> <span class="st">"flat-polar sinusoidal"</span><span class="op">,</span> <span class="dt">value</span><span class="op">:</span> d3<span class="op">.</span><span class="at">geoMtFlatPolarSinusoidal</span> }<span class="op">,</span></span>
<span id="cb82-1587"><a href="#cb82-1587" aria-hidden="true" tabindex="-1"></a>  { <span class="dt">name</span><span class="op">:</span> <span class="st">"Foucaut’s stereographic equivalent"</span><span class="op">,</span> <span class="dt">value</span><span class="op">:</span> d3<span class="op">.</span><span class="at">geoFoucaut</span> }<span class="op">,</span></span>
<span id="cb82-1588"><a href="#cb82-1588" aria-hidden="true" tabindex="-1"></a>  { <span class="dt">name</span><span class="op">:</span> <span class="st">"Foucaut’s sinusoidal"</span><span class="op">,</span> <span class="dt">value</span><span class="op">:</span> d3<span class="op">.</span><span class="at">geoFoucautSinusoidal</span> }<span class="op">,</span></span>
<span id="cb82-1589"><a href="#cb82-1589" aria-hidden="true" tabindex="-1"></a>  { <span class="dt">name</span><span class="op">:</span> <span class="st">"general perspective"</span><span class="op">,</span> <span class="dt">value</span><span class="op">:</span> d3<span class="op">.</span><span class="at">geoSatellite</span> }<span class="op">,</span></span>
<span id="cb82-1590"><a href="#cb82-1590" aria-hidden="true" tabindex="-1"></a>  { <span class="dt">name</span><span class="op">:</span> <span class="st">"Gingery"</span><span class="op">,</span> <span class="dt">value</span><span class="op">:</span> d3<span class="op">.</span><span class="at">geoGingery</span><span class="op">,</span> <span class="dt">options</span><span class="op">:</span> { <span class="dt">clip</span><span class="op">:</span> { <span class="dt">type</span><span class="op">:</span> <span class="st">"Sphere"</span> } } }<span class="op">,</span></span>
<span id="cb82-1591"><a href="#cb82-1591" aria-hidden="true" tabindex="-1"></a>  { <span class="dt">name</span><span class="op">:</span> <span class="st">"Ginzburg V"</span><span class="op">,</span> <span class="dt">value</span><span class="op">:</span> d3<span class="op">.</span><span class="at">geoGinzburg5</span> }<span class="op">,</span></span>
<span id="cb82-1592"><a href="#cb82-1592" aria-hidden="true" tabindex="-1"></a>  { <span class="dt">name</span><span class="op">:</span> <span class="st">"Ginzburg VI"</span><span class="op">,</span> <span class="dt">value</span><span class="op">:</span> d3<span class="op">.</span><span class="at">geoGinzburg6</span> }<span class="op">,</span></span>
<span id="cb82-1593"><a href="#cb82-1593" aria-hidden="true" tabindex="-1"></a>  { <span class="dt">name</span><span class="op">:</span> <span class="st">"Ginzburg VIII"</span><span class="op">,</span> <span class="dt">value</span><span class="op">:</span> d3<span class="op">.</span><span class="at">geoGinzburg8</span> }<span class="op">,</span></span>
<span id="cb82-1594"><a href="#cb82-1594" aria-hidden="true" tabindex="-1"></a>  { <span class="dt">name</span><span class="op">:</span> <span class="st">"Ginzburg IX"</span><span class="op">,</span> <span class="dt">value</span><span class="op">:</span> d3<span class="op">.</span><span class="at">geoGinzburg9</span> }<span class="op">,</span></span>
<span id="cb82-1595"><a href="#cb82-1595" aria-hidden="true" tabindex="-1"></a>  { <span class="dt">name</span><span class="op">:</span> <span class="st">"Goode’s homolosine"</span><span class="op">,</span> <span class="dt">value</span><span class="op">:</span> d3<span class="op">.</span><span class="at">geoHomolosine</span>}<span class="op">,</span></span>
<span id="cb82-1596"><a href="#cb82-1596" aria-hidden="true" tabindex="-1"></a>  { <span class="dt">name</span><span class="op">:</span> <span class="st">"Goode’s homolosine (interrupted)"</span><span class="op">,</span> <span class="dt">value</span><span class="op">:</span> d3<span class="op">.</span><span class="at">geoInterruptedHomolosine</span><span class="op">,</span> <span class="dt">options</span><span class="op">:</span> { <span class="dt">clip</span><span class="op">:</span> { <span class="dt">type</span><span class="op">:</span> <span class="st">"Sphere"</span> } }  }<span class="op">,</span></span>
<span id="cb82-1597"><a href="#cb82-1597" aria-hidden="true" tabindex="-1"></a>  { <span class="dt">name</span><span class="op">:</span> <span class="st">"gnomonic"</span><span class="op">,</span> <span class="dt">value</span><span class="op">:</span> d3<span class="op">.</span><span class="at">geoGnomonic</span> }<span class="op">,</span></span>
<span id="cb82-1598"><a href="#cb82-1598" aria-hidden="true" tabindex="-1"></a>  { <span class="dt">name</span><span class="op">:</span> <span class="st">"Gringorten square"</span><span class="op">,</span> <span class="dt">value</span><span class="op">:</span> d3<span class="op">.</span><span class="at">geoGringorten</span> }<span class="op">,</span></span>
<span id="cb82-1599"><a href="#cb82-1599" aria-hidden="true" tabindex="-1"></a>  { <span class="dt">name</span><span class="op">:</span> <span class="st">"Gringorten quincuncial"</span><span class="op">,</span> <span class="dt">value</span><span class="op">:</span> d3<span class="op">.</span><span class="at">geoGringortenQuincuncial</span> }<span class="op">,</span></span>
<span id="cb82-1600"><a href="#cb82-1600" aria-hidden="true" tabindex="-1"></a>  { <span class="dt">name</span><span class="op">:</span> <span class="st">"Guyou square"</span><span class="op">,</span> <span class="dt">value</span><span class="op">:</span> d3<span class="op">.</span><span class="at">geoGuyou</span> }<span class="op">,</span></span>
<span id="cb82-1601"><a href="#cb82-1601" aria-hidden="true" tabindex="-1"></a>  { <span class="dt">name</span><span class="op">:</span> <span class="st">"Hammer"</span><span class="op">,</span> <span class="dt">value</span><span class="op">:</span> d3<span class="op">.</span><span class="at">geoHammer</span> }<span class="op">,</span></span>
<span id="cb82-1602"><a href="#cb82-1602" aria-hidden="true" tabindex="-1"></a>  { <span class="dt">name</span><span class="op">:</span> <span class="st">"Hammer retroazimuthal"</span><span class="op">,</span> <span class="dt">value</span><span class="op">:</span> d3<span class="op">.</span><span class="at">geoHammerRetroazimuthal</span><span class="op">,</span> <span class="dt">options</span><span class="op">:</span> { <span class="dt">clip</span><span class="op">:</span> { <span class="dt">type</span><span class="op">:</span> <span class="st">"Sphere"</span> } } }<span class="op">,</span></span>
<span id="cb82-1603"><a href="#cb82-1603" aria-hidden="true" tabindex="-1"></a>  { <span class="dt">name</span><span class="op">:</span> <span class="st">"HEALPix"</span><span class="op">,</span> <span class="dt">value</span><span class="op">:</span> d3<span class="op">.</span><span class="at">geoHealpix</span><span class="op">,</span> <span class="dt">options</span><span class="op">:</span> { <span class="dt">clip</span><span class="op">:</span> { <span class="dt">type</span><span class="op">:</span> <span class="st">"Sphere"</span> } } }<span class="op">,</span></span>
<span id="cb82-1604"><a href="#cb82-1604" aria-hidden="true" tabindex="-1"></a>  { <span class="dt">name</span><span class="op">:</span> <span class="st">"Hill eucyclic"</span><span class="op">,</span> <span class="dt">value</span><span class="op">:</span> d3<span class="op">.</span><span class="at">geoHill</span> }<span class="op">,</span></span>
<span id="cb82-1605"><a href="#cb82-1605" aria-hidden="true" tabindex="-1"></a>  { <span class="dt">name</span><span class="op">:</span> <span class="st">"Hufnagel pseudocylindrical"</span><span class="op">,</span> <span class="dt">value</span><span class="op">:</span> d3<span class="op">.</span><span class="at">geoHufnagel</span> }<span class="op">,</span></span>
<span id="cb82-1606"><a href="#cb82-1606" aria-hidden="true" tabindex="-1"></a>  { <span class="dt">name</span><span class="op">:</span> <span class="st">"icosahedral"</span><span class="op">,</span> <span class="dt">value</span><span class="op">:</span> d3<span class="op">.</span><span class="at">geoIcosahedral</span> }<span class="op">,</span></span>
<span id="cb82-1607"><a href="#cb82-1607" aria-hidden="true" tabindex="-1"></a>  { <span class="dt">name</span><span class="op">:</span> <span class="st">"Imago"</span><span class="op">,</span> <span class="dt">value</span><span class="op">:</span> d3<span class="op">.</span><span class="at">geoImago</span> }<span class="op">,</span></span>
<span id="cb82-1608"><a href="#cb82-1608" aria-hidden="true" tabindex="-1"></a>  { <span class="dt">name</span><span class="op">:</span> <span class="st">"Kavrayskiy VII"</span><span class="op">,</span> <span class="dt">value</span><span class="op">:</span> d3<span class="op">.</span><span class="at">geoKavrayskiy7</span> }<span class="op">,</span></span>
<span id="cb82-1609"><a href="#cb82-1609" aria-hidden="true" tabindex="-1"></a>  { <span class="dt">name</span><span class="op">:</span> <span class="st">"Lagrange conformal"</span><span class="op">,</span> <span class="dt">value</span><span class="op">:</span> d3<span class="op">.</span><span class="at">geoLagrange</span> }<span class="op">,</span></span>
<span id="cb82-1610"><a href="#cb82-1610" aria-hidden="true" tabindex="-1"></a>  { <span class="dt">name</span><span class="op">:</span> <span class="st">"Larrivée"</span><span class="op">,</span> <span class="dt">value</span><span class="op">:</span> d3<span class="op">.</span><span class="at">geoLarrivee</span> }<span class="op">,</span></span>
<span id="cb82-1611"><a href="#cb82-1611" aria-hidden="true" tabindex="-1"></a>  { <span class="dt">name</span><span class="op">:</span> <span class="st">"Laskowski tri-optimal"</span><span class="op">,</span> <span class="dt">value</span><span class="op">:</span> d3<span class="op">.</span><span class="at">geoLaskowski</span> }<span class="op">,</span></span>
<span id="cb82-1612"><a href="#cb82-1612" aria-hidden="true" tabindex="-1"></a>  { <span class="dt">name</span><span class="op">:</span> <span class="st">"Loximuthal"</span><span class="op">,</span> <span class="dt">value</span><span class="op">:</span> d3<span class="op">.</span><span class="at">geoLoximuthal</span> }<span class="op">,</span></span>
<span id="cb82-1613"><a href="#cb82-1613" aria-hidden="true" tabindex="-1"></a>  { <span class="dt">name</span><span class="op">:</span> <span class="st">"Mercator"</span><span class="op">,</span> <span class="dt">value</span><span class="op">:</span> d3<span class="op">.</span><span class="at">geoMercator</span> }<span class="op">,</span></span>
<span id="cb82-1614"><a href="#cb82-1614" aria-hidden="true" tabindex="-1"></a>  { <span class="dt">name</span><span class="op">:</span> <span class="st">"Miller cylindrical"</span><span class="op">,</span> <span class="dt">value</span><span class="op">:</span> d3<span class="op">.</span><span class="at">geoMiller</span> }<span class="op">,</span></span>
<span id="cb82-1615"><a href="#cb82-1615" aria-hidden="true" tabindex="-1"></a>  { <span class="dt">name</span><span class="op">:</span> <span class="st">"Mollweide"</span><span class="op">,</span> <span class="dt">value</span><span class="op">:</span> d3<span class="op">.</span><span class="at">geoMollweide</span> }<span class="op">,</span></span>
<span id="cb82-1616"><a href="#cb82-1616" aria-hidden="true" tabindex="-1"></a>  { <span class="dt">name</span><span class="op">:</span> <span class="st">"Mollweide (Goode’s interrupted)"</span><span class="op">,</span> <span class="dt">value</span><span class="op">:</span> d3<span class="op">.</span><span class="at">geoInterruptedMollweide</span><span class="op">,</span> <span class="dt">options</span><span class="op">:</span> { <span class="dt">clip</span><span class="op">:</span> { <span class="dt">type</span><span class="op">:</span> <span class="st">"Sphere"</span> } } }<span class="op">,</span></span>
<span id="cb82-1617"><a href="#cb82-1617" aria-hidden="true" tabindex="-1"></a>  { <span class="dt">name</span><span class="op">:</span> <span class="st">"Mollweide (interrupted hemispheres)"</span><span class="op">,</span> <span class="dt">value</span><span class="op">:</span> d3<span class="op">.</span><span class="at">geoInterruptedMollweideHemispheres</span><span class="op">,</span> <span class="dt">options</span><span class="op">:</span> { <span class="dt">clip</span><span class="op">:</span> { <span class="dt">type</span><span class="op">:</span> <span class="st">"Sphere"</span> } } }<span class="op">,</span></span>
<span id="cb82-1618"><a href="#cb82-1618" aria-hidden="true" tabindex="-1"></a>  { <span class="dt">name</span><span class="op">:</span> <span class="st">"Natural Earth"</span><span class="op">,</span> <span class="dt">value</span><span class="op">:</span> d3<span class="op">.</span><span class="at">geoNaturalEarth1</span> }<span class="op">,</span></span>
<span id="cb82-1619"><a href="#cb82-1619" aria-hidden="true" tabindex="-1"></a>  { <span class="dt">name</span><span class="op">:</span> <span class="st">"Natural Earth II"</span><span class="op">,</span> <span class="dt">value</span><span class="op">:</span> d3<span class="op">.</span><span class="at">geoNaturalEarth2</span> }<span class="op">,</span></span>
<span id="cb82-1620"><a href="#cb82-1620" aria-hidden="true" tabindex="-1"></a>  { <span class="dt">name</span><span class="op">:</span> <span class="st">"Nell–Hammer"</span><span class="op">,</span> <span class="dt">value</span><span class="op">:</span> d3<span class="op">.</span><span class="at">geoNellHammer</span> }<span class="op">,</span></span>
<span id="cb82-1621"><a href="#cb82-1621" aria-hidden="true" tabindex="-1"></a>  { <span class="dt">name</span><span class="op">:</span> <span class="st">"Nicolosi globular"</span><span class="op">,</span> <span class="dt">value</span><span class="op">:</span> d3<span class="op">.</span><span class="at">geoNicolosi</span> }<span class="op">,</span></span>
<span id="cb82-1622"><a href="#cb82-1622" aria-hidden="true" tabindex="-1"></a>  { <span class="dt">name</span><span class="op">:</span> <span class="st">"orthographic"</span><span class="op">,</span> <span class="dt">value</span><span class="op">:</span> d3<span class="op">.</span><span class="at">geoOrthographic</span> }<span class="op">,</span></span>
<span id="cb82-1623"><a href="#cb82-1623" aria-hidden="true" tabindex="-1"></a>  { <span class="dt">name</span><span class="op">:</span> <span class="st">"Patterson cylindrical"</span><span class="op">,</span> <span class="dt">value</span><span class="op">:</span> d3<span class="op">.</span><span class="at">geoPatterson</span> }<span class="op">,</span></span>
<span id="cb82-1624"><a href="#cb82-1624" aria-hidden="true" tabindex="-1"></a>  { <span class="dt">name</span><span class="op">:</span> <span class="st">"Peirce quincuncial"</span><span class="op">,</span> <span class="dt">value</span><span class="op">:</span> d3<span class="op">.</span><span class="at">geoPeirceQuincuncial</span> }<span class="op">,</span></span>
<span id="cb82-1625"><a href="#cb82-1625" aria-hidden="true" tabindex="-1"></a>  { <span class="dt">name</span><span class="op">:</span> <span class="st">"rectangular polyconic"</span><span class="op">,</span> <span class="dt">value</span><span class="op">:</span> d3<span class="op">.</span><span class="at">geoRectangularPolyconic</span> }<span class="op">,</span></span>
<span id="cb82-1626"><a href="#cb82-1626" aria-hidden="true" tabindex="-1"></a>  { <span class="dt">name</span><span class="op">:</span> <span class="st">"Robinson"</span><span class="op">,</span> <span class="dt">value</span><span class="op">:</span> d3<span class="op">.</span><span class="at">geoRobinson</span> }<span class="op">,</span></span>
<span id="cb82-1627"><a href="#cb82-1627" aria-hidden="true" tabindex="-1"></a>  { <span class="dt">name</span><span class="op">:</span> <span class="st">"sinusoidal"</span><span class="op">,</span> <span class="dt">value</span><span class="op">:</span> d3<span class="op">.</span><span class="at">geoSinusoidal</span> }<span class="op">,</span></span>
<span id="cb82-1628"><a href="#cb82-1628" aria-hidden="true" tabindex="-1"></a>  { <span class="dt">name</span><span class="op">:</span> <span class="st">"sinusoidal (interrupted)"</span><span class="op">,</span> <span class="dt">value</span><span class="op">:</span> d3<span class="op">.</span><span class="at">geoInterruptedSinusoidal</span><span class="op">,</span> <span class="dt">options</span><span class="op">:</span> { <span class="dt">clip</span><span class="op">:</span> { <span class="dt">type</span><span class="op">:</span> <span class="st">"Sphere"</span> } } }<span class="op">,</span></span>
<span id="cb82-1629"><a href="#cb82-1629" aria-hidden="true" tabindex="-1"></a>  { <span class="dt">name</span><span class="op">:</span> <span class="st">"sinu-Mollweide"</span><span class="op">,</span> <span class="dt">value</span><span class="op">:</span> d3<span class="op">.</span><span class="at">geoSinuMollweide</span> }<span class="op">,</span></span>
<span id="cb82-1630"><a href="#cb82-1630" aria-hidden="true" tabindex="-1"></a>  { <span class="dt">name</span><span class="op">:</span> <span class="st">"sinu-Mollweide (interrupted)"</span><span class="op">,</span> <span class="dt">value</span><span class="op">:</span> d3<span class="op">.</span><span class="at">geoInterruptedSinuMollweide</span><span class="op">,</span> <span class="dt">options</span><span class="op">:</span> { <span class="dt">clip</span><span class="op">:</span> { <span class="dt">type</span><span class="op">:</span> <span class="st">"Sphere"</span> } } }<span class="op">,</span></span>
<span id="cb82-1631"><a href="#cb82-1631" aria-hidden="true" tabindex="-1"></a>  { <span class="dt">name</span><span class="op">:</span> <span class="st">"stereographic"</span><span class="op">,</span> <span class="dt">value</span><span class="op">:</span> d3<span class="op">.</span><span class="at">geoStereographic</span> }<span class="op">,</span></span>
<span id="cb82-1632"><a href="#cb82-1632" aria-hidden="true" tabindex="-1"></a>  { <span class="dt">name</span><span class="op">:</span> <span class="st">"Lee’s tetrahedal"</span><span class="op">,</span> <span class="dt">value</span><span class="op">:</span> d3<span class="op">.</span><span class="at">geoTetrahedralLee</span> }<span class="op">,</span></span>
<span id="cb82-1633"><a href="#cb82-1633" aria-hidden="true" tabindex="-1"></a>  { <span class="dt">name</span><span class="op">:</span> <span class="st">"Times"</span><span class="op">,</span> <span class="dt">value</span><span class="op">:</span> d3<span class="op">.</span><span class="at">geoTimes</span> }<span class="op">,</span></span>
<span id="cb82-1634"><a href="#cb82-1634" aria-hidden="true" tabindex="-1"></a>  { <span class="dt">name</span><span class="op">:</span> <span class="st">"Tobler hyperelliptical"</span><span class="op">,</span> <span class="dt">value</span><span class="op">:</span> d3<span class="op">.</span><span class="at">geoHyperelliptical</span> }<span class="op">,</span></span>
<span id="cb82-1635"><a href="#cb82-1635" aria-hidden="true" tabindex="-1"></a>  { <span class="dt">name</span><span class="op">:</span> <span class="st">"transverse Mercator"</span><span class="op">,</span> <span class="dt">value</span><span class="op">:</span> d3<span class="op">.</span><span class="at">geoTransverseMercator</span> }<span class="op">,</span></span>
<span id="cb82-1636"><a href="#cb82-1636" aria-hidden="true" tabindex="-1"></a>  { <span class="dt">name</span><span class="op">:</span> <span class="st">"Van der Grinten"</span><span class="op">,</span> <span class="dt">value</span><span class="op">:</span> d3<span class="op">.</span><span class="at">geoVanDerGrinten</span> }<span class="op">,</span></span>
<span id="cb82-1637"><a href="#cb82-1637" aria-hidden="true" tabindex="-1"></a>  { <span class="dt">name</span><span class="op">:</span> <span class="st">"Van der Grinten II"</span><span class="op">,</span> <span class="dt">value</span><span class="op">:</span> d3<span class="op">.</span><span class="at">geoVanDerGrinten2</span> }<span class="op">,</span></span>
<span id="cb82-1638"><a href="#cb82-1638" aria-hidden="true" tabindex="-1"></a>  { <span class="dt">name</span><span class="op">:</span> <span class="st">"Van der Grinten III"</span><span class="op">,</span> <span class="dt">value</span><span class="op">:</span> d3<span class="op">.</span><span class="at">geoVanDerGrinten3</span> }<span class="op">,</span></span>
<span id="cb82-1639"><a href="#cb82-1639" aria-hidden="true" tabindex="-1"></a>  { <span class="dt">name</span><span class="op">:</span> <span class="st">"Van der Grinten IV"</span><span class="op">,</span> <span class="dt">value</span><span class="op">:</span> d3<span class="op">.</span><span class="at">geoVanDerGrinten4</span> }<span class="op">,</span></span>
<span id="cb82-1640"><a href="#cb82-1640" aria-hidden="true" tabindex="-1"></a>  { <span class="dt">name</span><span class="op">:</span> <span class="st">"Wagner IV"</span><span class="op">,</span> <span class="dt">value</span><span class="op">:</span> d3<span class="op">.</span><span class="at">geoWagner4</span> }<span class="op">,</span></span>
<span id="cb82-1641"><a href="#cb82-1641" aria-hidden="true" tabindex="-1"></a>  { <span class="dt">name</span><span class="op">:</span> <span class="st">"Wagner VI"</span><span class="op">,</span> <span class="dt">value</span><span class="op">:</span> d3<span class="op">.</span><span class="at">geoWagner6</span> }<span class="op">,</span></span>
<span id="cb82-1642"><a href="#cb82-1642" aria-hidden="true" tabindex="-1"></a>  { <span class="dt">name</span><span class="op">:</span> <span class="st">"Wagner VII"</span><span class="op">,</span> <span class="dt">value</span><span class="op">:</span> d3<span class="op">.</span><span class="at">geoWagner7</span> }<span class="op">,</span></span>
<span id="cb82-1643"><a href="#cb82-1643" aria-hidden="true" tabindex="-1"></a>  { <span class="dt">name</span><span class="op">:</span> <span class="st">"Werner"</span><span class="op">,</span> <span class="dt">value</span><span class="op">:</span> d3<span class="op">.</span><span class="at">geoBonne</span> <span class="op">?</span> () <span class="kw">=&gt;</span> d3<span class="op">.</span><span class="fu">geoBonne</span>()<span class="op">.</span><span class="fu">parallel</span>(<span class="dv">90</span>) <span class="op">:</span> <span class="kw">null</span> }<span class="op">,</span></span>
<span id="cb82-1644"><a href="#cb82-1644" aria-hidden="true" tabindex="-1"></a>  { <span class="dt">name</span><span class="op">:</span> <span class="st">"Wiechel"</span><span class="op">,</span> <span class="dt">value</span><span class="op">:</span> d3<span class="op">.</span><span class="at">geoWiechel</span> }<span class="op">,</span></span>
<span id="cb82-1645"><a href="#cb82-1645" aria-hidden="true" tabindex="-1"></a>  { <span class="dt">name</span><span class="op">:</span> <span class="st">"Winkel tripel"</span><span class="op">,</span> <span class="dt">value</span><span class="op">:</span> d3<span class="op">.</span><span class="at">geoWinkel3</span> }</span>
<span id="cb82-1646"><a href="#cb82-1646" aria-hidden="true" tabindex="-1"></a>]</span>
<span id="cb82-1647"><a href="#cb82-1647" aria-hidden="true" tabindex="-1"></a>EventType <span class="op">=</span> ({</span>
<span id="cb82-1648"><a href="#cb82-1648" aria-hidden="true" tabindex="-1"></a>  <span class="dt">LocationChange</span><span class="op">:</span> <span class="st">"LOCATION_CHANGE"</span><span class="op">,</span></span>
<span id="cb82-1649"><a href="#cb82-1649" aria-hidden="true" tabindex="-1"></a>  <span class="dt">DateHourChange</span><span class="op">:</span> <span class="st">"DATE_HOUR_CHANGE"</span></span>
<span id="cb82-1650"><a href="#cb82-1650" aria-hidden="true" tabindex="-1"></a>})</span>
<span id="cb82-1651"><a href="#cb82-1651" aria-hidden="true" tabindex="-1"></a>mapcolors <span class="op">=</span> ({</span>
<span id="cb82-1652"><a href="#cb82-1652" aria-hidden="true" tabindex="-1"></a>  <span class="dt">night</span><span class="op">:</span> <span class="st">"#719fb6"</span><span class="op">,</span></span>
<span id="cb82-1653"><a href="#cb82-1653" aria-hidden="true" tabindex="-1"></a>  <span class="dt">day</span><span class="op">:</span> <span class="st">"#ffe438"</span><span class="op">,</span></span>
<span id="cb82-1654"><a href="#cb82-1654" aria-hidden="true" tabindex="-1"></a>  <span class="dt">grid</span><span class="op">:</span> <span class="st">"#4b6a79"</span><span class="op">,</span></span>
<span id="cb82-1655"><a href="#cb82-1655" aria-hidden="true" tabindex="-1"></a>  <span class="dt">ocean</span><span class="op">:</span> <span class="st">"#adeeff"</span><span class="op">,</span></span>
<span id="cb82-1656"><a href="#cb82-1656" aria-hidden="true" tabindex="-1"></a>  <span class="dt">land</span><span class="op">:</span> <span class="st">"#90ff7888"</span><span class="op">,</span></span>
<span id="cb82-1657"><a href="#cb82-1657" aria-hidden="true" tabindex="-1"></a>  <span class="dt">sun</span><span class="op">:</span> <span class="st">"#ffb438"</span></span>
<span id="cb82-1658"><a href="#cb82-1658" aria-hidden="true" tabindex="-1"></a>})</span>
<span id="cb82-1659"><a href="#cb82-1659" aria-hidden="true" tabindex="-1"></a>toRadians <span class="op">=</span> (val) <span class="kw">=&gt;</span> val <span class="op">*</span> <span class="bu">Math</span><span class="op">.</span><span class="cn">PI</span> <span class="op">/</span> <span class="dv">180</span></span>
<span id="cb82-1660"><a href="#cb82-1660" aria-hidden="true" tabindex="-1"></a>toDegrees <span class="op">=</span> (val) <span class="kw">=&gt;</span> val <span class="op">*</span> <span class="dv">180</span> <span class="op">/</span> <span class="bu">Math</span><span class="op">.</span><span class="cn">PI</span><span class="op">;</span></span>
<span id="cb82-1661"><a href="#cb82-1661" aria-hidden="true" tabindex="-1"></a>land <span class="op">=</span> topojson<span class="op">.</span><span class="fu">feature</span>(world<span class="op">,</span> world<span class="op">.</span><span class="at">objects</span><span class="op">.</span><span class="at">land</span>)<span class="op">;</span></span>
<span id="cb82-1662"><a href="#cb82-1662" aria-hidden="true" tabindex="-1"></a>d3 <span class="op">=</span> <span class="pp">require</span>(<span class="st">"d3@7"</span><span class="op">,</span> <span class="st">"d3-geo-projection@3"</span>)</span>
<span id="cb82-1663"><a href="#cb82-1663" aria-hidden="true" tabindex="-1"></a><span class="kw">function</span> <span class="fu">input</span>(config) {</span>
<span id="cb82-1664"><a href="#cb82-1664" aria-hidden="true" tabindex="-1"></a>  <span class="kw">let</span> {</span>
<span id="cb82-1665"><a href="#cb82-1665" aria-hidden="true" tabindex="-1"></a>    form<span class="op">,</span></span>
<span id="cb82-1666"><a href="#cb82-1666" aria-hidden="true" tabindex="-1"></a>    type <span class="op">=</span> <span class="st">"text"</span><span class="op">,</span></span>
<span id="cb82-1667"><a href="#cb82-1667" aria-hidden="true" tabindex="-1"></a>    attributes <span class="op">=</span> {}<span class="op">,</span></span>
<span id="cb82-1668"><a href="#cb82-1668" aria-hidden="true" tabindex="-1"></a>    action<span class="op">,</span></span>
<span id="cb82-1669"><a href="#cb82-1669" aria-hidden="true" tabindex="-1"></a>    getValue<span class="op">,</span></span>
<span id="cb82-1670"><a href="#cb82-1670" aria-hidden="true" tabindex="-1"></a>    title<span class="op">,</span></span>
<span id="cb82-1671"><a href="#cb82-1671" aria-hidden="true" tabindex="-1"></a>    description<span class="op">,</span></span>
<span id="cb82-1672"><a href="#cb82-1672" aria-hidden="true" tabindex="-1"></a>    format<span class="op">,</span></span>
<span id="cb82-1673"><a href="#cb82-1673" aria-hidden="true" tabindex="-1"></a>    display<span class="op">,</span></span>
<span id="cb82-1674"><a href="#cb82-1674" aria-hidden="true" tabindex="-1"></a>    submit<span class="op">,</span></span>
<span id="cb82-1675"><a href="#cb82-1675" aria-hidden="true" tabindex="-1"></a>    options</span>
<span id="cb82-1676"><a href="#cb82-1676" aria-hidden="true" tabindex="-1"></a>  } <span class="op">=</span> config<span class="op">;</span></span>
<span id="cb82-1677"><a href="#cb82-1677" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> wrapper <span class="op">=</span> <span class="fu">html</span><span class="vs">`&lt;div&gt;&lt;/div&gt;`</span><span class="op">;</span></span>
<span id="cb82-1678"><a href="#cb82-1678" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (<span class="op">!</span>form)</span>
<span id="cb82-1679"><a href="#cb82-1679" aria-hidden="true" tabindex="-1"></a>    form <span class="op">=</span> <span class="fu">html</span><span class="vs">`&lt;form&gt;</span></span>
<span id="cb82-1680"><a href="#cb82-1680" aria-hidden="true" tabindex="-1"></a><span class="vs">  &lt;input name=input type=</span><span class="sc">${</span>type<span class="sc">}</span><span class="vs"> /&gt;</span></span>
<span id="cb82-1681"><a href="#cb82-1681" aria-hidden="true" tabindex="-1"></a><span class="vs">  &lt;/form&gt;`</span><span class="op">;</span></span>
<span id="cb82-1682"><a href="#cb82-1682" aria-hidden="true" tabindex="-1"></a>  <span class="bu">Object</span><span class="op">.</span><span class="fu">keys</span>(attributes)<span class="op">.</span><span class="fu">forEach</span>(key <span class="kw">=&gt;</span> {</span>
<span id="cb82-1683"><a href="#cb82-1683" aria-hidden="true" tabindex="-1"></a>    <span class="kw">const</span> val <span class="op">=</span> attributes[key]<span class="op">;</span></span>
<span id="cb82-1684"><a href="#cb82-1684" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> (val <span class="op">!=</span> <span class="kw">null</span>) form<span class="op">.</span><span class="at">input</span><span class="op">.</span><span class="fu">setAttribute</span>(key<span class="op">,</span> val)<span class="op">;</span></span>
<span id="cb82-1685"><a href="#cb82-1685" aria-hidden="true" tabindex="-1"></a>  })<span class="op">;</span></span>
<span id="cb82-1686"><a href="#cb82-1686" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (submit)</span>
<span id="cb82-1687"><a href="#cb82-1687" aria-hidden="true" tabindex="-1"></a>    form<span class="op">.</span><span class="fu">append</span>(</span>
<span id="cb82-1688"><a href="#cb82-1688" aria-hidden="true" tabindex="-1"></a>      <span class="fu">html</span><span class="vs">`&lt;input name=submit type=submit style="margin: 0 0.75em" value="</span><span class="sc">${</span></span>
<span id="cb82-1689"><a href="#cb82-1689" aria-hidden="true" tabindex="-1"></a>        <span class="kw">typeof</span> submit <span class="op">==</span> <span class="st">"string"</span> <span class="op">?</span> submit <span class="op">:</span> <span class="st">"Submit"</span></span>
<span id="cb82-1690"><a href="#cb82-1690" aria-hidden="true" tabindex="-1"></a>      <span class="sc">}</span><span class="vs">" /&gt;`</span></span>
<span id="cb82-1691"><a href="#cb82-1691" aria-hidden="true" tabindex="-1"></a>    )<span class="op">;</span></span>
<span id="cb82-1692"><a href="#cb82-1692" aria-hidden="true" tabindex="-1"></a>  form<span class="op">.</span><span class="fu">append</span>(</span>
<span id="cb82-1693"><a href="#cb82-1693" aria-hidden="true" tabindex="-1"></a>    <span class="fu">html</span><span class="vs">`&lt;output name=output style="font: 14px Menlo, Consolas, monospace; margin-left: 0.1em; text-align:center;"&gt;&lt;/output&gt;`</span></span>
<span id="cb82-1694"><a href="#cb82-1694" aria-hidden="true" tabindex="-1"></a>  )<span class="op">;</span></span>
<span id="cb82-1695"><a href="#cb82-1695" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (title)</span>
<span id="cb82-1696"><a href="#cb82-1696" aria-hidden="true" tabindex="-1"></a>    form<span class="op">.</span><span class="fu">prepend</span>(</span>
<span id="cb82-1697"><a href="#cb82-1697" aria-hidden="true" tabindex="-1"></a>      <span class="fu">html</span><span class="vs">`&lt;div style="font: 700 0.9rem sans-serif; margin-bottom: 3px;"&gt;</span><span class="sc">${</span>title<span class="sc">}</span><span class="vs">&lt;/div&gt;`</span></span>
<span id="cb82-1698"><a href="#cb82-1698" aria-hidden="true" tabindex="-1"></a>    )<span class="op">;</span></span>
<span id="cb82-1699"><a href="#cb82-1699" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (description)</span>
<span id="cb82-1700"><a href="#cb82-1700" aria-hidden="true" tabindex="-1"></a>    form<span class="op">.</span><span class="fu">append</span>(</span>
<span id="cb82-1701"><a href="#cb82-1701" aria-hidden="true" tabindex="-1"></a>      <span class="fu">html</span><span class="vs">`&lt;div style="font-size: 0.85rem; font-style: italic; margin-top: 3px;"&gt;</span><span class="sc">${</span>description<span class="sc">}</span><span class="vs">&lt;/div&gt;`</span></span>
<span id="cb82-1702"><a href="#cb82-1702" aria-hidden="true" tabindex="-1"></a>    )<span class="op">;</span></span>
<span id="cb82-1703"><a href="#cb82-1703" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (format)</span>
<span id="cb82-1704"><a href="#cb82-1704" aria-hidden="true" tabindex="-1"></a>    format <span class="op">=</span> <span class="kw">typeof</span> format <span class="op">===</span> <span class="st">"function"</span> <span class="op">?</span> format <span class="op">:</span> d3format<span class="op">.</span><span class="fu">format</span>(format)<span class="op">;</span></span>
<span id="cb82-1705"><a href="#cb82-1705" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (action) {</span>
<span id="cb82-1706"><a href="#cb82-1706" aria-hidden="true" tabindex="-1"></a>    <span class="fu">action</span>(form)<span class="op">;</span></span>
<span id="cb82-1707"><a href="#cb82-1707" aria-hidden="true" tabindex="-1"></a>  } <span class="cf">else</span> {</span>
<span id="cb82-1708"><a href="#cb82-1708" aria-hidden="true" tabindex="-1"></a>    <span class="kw">const</span> verb <span class="op">=</span> submit</span>
<span id="cb82-1709"><a href="#cb82-1709" aria-hidden="true" tabindex="-1"></a>      <span class="op">?</span> <span class="st">"onsubmit"</span></span>
<span id="cb82-1710"><a href="#cb82-1710" aria-hidden="true" tabindex="-1"></a>      <span class="op">:</span> type <span class="op">==</span> <span class="st">"button"</span></span>
<span id="cb82-1711"><a href="#cb82-1711" aria-hidden="true" tabindex="-1"></a>      <span class="op">?</span> <span class="st">"onclick"</span></span>
<span id="cb82-1712"><a href="#cb82-1712" aria-hidden="true" tabindex="-1"></a>      <span class="op">:</span> type <span class="op">==</span> <span class="st">"checkbox"</span> <span class="op">||</span> type <span class="op">==</span> <span class="st">"radio"</span></span>
<span id="cb82-1713"><a href="#cb82-1713" aria-hidden="true" tabindex="-1"></a>      <span class="op">?</span> <span class="st">"onchange"</span></span>
<span id="cb82-1714"><a href="#cb82-1714" aria-hidden="true" tabindex="-1"></a>      <span class="op">:</span> <span class="st">"oninput"</span><span class="op">;</span></span>
<span id="cb82-1715"><a href="#cb82-1715" aria-hidden="true" tabindex="-1"></a>    form[verb] <span class="op">=</span> e <span class="kw">=&gt;</span> {</span>
<span id="cb82-1716"><a href="#cb82-1716" aria-hidden="true" tabindex="-1"></a>      e <span class="op">&amp;&amp;</span> e<span class="op">.</span><span class="fu">preventDefault</span>()<span class="op">;</span></span>
<span id="cb82-1717"><a href="#cb82-1717" aria-hidden="true" tabindex="-1"></a>      <span class="kw">const</span> value <span class="op">=</span> getValue <span class="op">?</span> <span class="fu">getValue</span>(form<span class="op">.</span><span class="at">input</span>) <span class="op">:</span> form<span class="op">.</span><span class="at">input</span><span class="op">.</span><span class="at">value</span><span class="op">;</span></span>
<span id="cb82-1718"><a href="#cb82-1718" aria-hidden="true" tabindex="-1"></a>      <span class="cf">if</span> (form<span class="op">.</span><span class="at">output</span>) {</span>
<span id="cb82-1719"><a href="#cb82-1719" aria-hidden="true" tabindex="-1"></a>        <span class="kw">const</span> out <span class="op">=</span> display <span class="op">?</span> <span class="fu">display</span>(value) <span class="op">:</span> format <span class="op">?</span> <span class="fu">format</span>(value) <span class="op">:</span> value<span class="op">;</span></span>
<span id="cb82-1720"><a href="#cb82-1720" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> (out <span class="kw">instanceof</span> <span class="bu">window</span><span class="op">.</span><span class="at">Element</span>) {</span>
<span id="cb82-1721"><a href="#cb82-1721" aria-hidden="true" tabindex="-1"></a>          <span class="cf">while</span> (form<span class="op">.</span><span class="at">output</span><span class="op">.</span><span class="fu">hasChildNodes</span>()) {</span>
<span id="cb82-1722"><a href="#cb82-1722" aria-hidden="true" tabindex="-1"></a>            form<span class="op">.</span><span class="at">output</span><span class="op">.</span><span class="fu">removeChild</span>(form<span class="op">.</span><span class="at">output</span><span class="op">.</span><span class="at">lastChild</span>)<span class="op">;</span></span>
<span id="cb82-1723"><a href="#cb82-1723" aria-hidden="true" tabindex="-1"></a>          }</span>
<span id="cb82-1724"><a href="#cb82-1724" aria-hidden="true" tabindex="-1"></a>          form<span class="op">.</span><span class="at">output</span><span class="op">.</span><span class="fu">append</span>(out)<span class="op">;</span></span>
<span id="cb82-1725"><a href="#cb82-1725" aria-hidden="true" tabindex="-1"></a>        } <span class="cf">else</span> {</span>
<span id="cb82-1726"><a href="#cb82-1726" aria-hidden="true" tabindex="-1"></a>          form<span class="op">.</span><span class="at">output</span><span class="op">.</span><span class="at">value</span> <span class="op">=</span> out<span class="op">;</span></span>
<span id="cb82-1727"><a href="#cb82-1727" aria-hidden="true" tabindex="-1"></a>        }</span>
<span id="cb82-1728"><a href="#cb82-1728" aria-hidden="true" tabindex="-1"></a>      }</span>
<span id="cb82-1729"><a href="#cb82-1729" aria-hidden="true" tabindex="-1"></a>      form<span class="op">.</span><span class="at">value</span> <span class="op">=</span> value<span class="op">;</span></span>
<span id="cb82-1730"><a href="#cb82-1730" aria-hidden="true" tabindex="-1"></a>      <span class="cf">if</span> (verb <span class="op">!==</span> <span class="st">"oninput"</span>)</span>
<span id="cb82-1731"><a href="#cb82-1731" aria-hidden="true" tabindex="-1"></a>        form<span class="op">.</span><span class="fu">dispatchEvent</span>(<span class="kw">new</span> <span class="bu">CustomEvent</span>(<span class="st">"input"</span><span class="op">,</span> { <span class="dt">bubbles</span><span class="op">:</span> <span class="kw">true</span> }))<span class="op">;</span></span>
<span id="cb82-1732"><a href="#cb82-1732" aria-hidden="true" tabindex="-1"></a>    }<span class="op">;</span></span>
<span id="cb82-1733"><a href="#cb82-1733" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> (verb <span class="op">!==</span> <span class="st">"oninput"</span>)</span>
<span id="cb82-1734"><a href="#cb82-1734" aria-hidden="true" tabindex="-1"></a>      wrapper<span class="op">.</span><span class="at">oninput</span> <span class="op">=</span> e <span class="kw">=&gt;</span> e <span class="op">&amp;&amp;</span> e<span class="op">.</span><span class="fu">stopPropagation</span>() <span class="op">&amp;&amp;</span> e<span class="op">.</span><span class="fu">preventDefault</span>()<span class="op">;</span></span>
<span id="cb82-1735"><a href="#cb82-1735" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> (verb <span class="op">!==</span> <span class="st">"onsubmit"</span>) form<span class="op">.</span><span class="at">onsubmit</span> <span class="op">=</span> e <span class="kw">=&gt;</span> e <span class="op">&amp;&amp;</span> e<span class="op">.</span><span class="fu">preventDefault</span>()<span class="op">;</span></span>
<span id="cb82-1736"><a href="#cb82-1736" aria-hidden="true" tabindex="-1"></a>    form[verb]()<span class="op">;</span></span>
<span id="cb82-1737"><a href="#cb82-1737" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb82-1738"><a href="#cb82-1738" aria-hidden="true" tabindex="-1"></a>  <span class="cf">while</span> (form<span class="op">.</span><span class="at">childNodes</span><span class="op">.</span><span class="at">length</span>) {</span>
<span id="cb82-1739"><a href="#cb82-1739" aria-hidden="true" tabindex="-1"></a>    wrapper<span class="op">.</span><span class="fu">appendChild</span>(form<span class="op">.</span><span class="at">childNodes</span>[<span class="dv">0</span>])<span class="op">;</span></span>
<span id="cb82-1740"><a href="#cb82-1740" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb82-1741"><a href="#cb82-1741" aria-hidden="true" tabindex="-1"></a>  form<span class="op">.</span><span class="fu">append</span>(wrapper)<span class="op">;</span></span>
<span id="cb82-1742"><a href="#cb82-1742" aria-hidden="true" tabindex="-1"></a>  <span class="cf">return</span> form<span class="op">;</span></span>
<span id="cb82-1743"><a href="#cb82-1743" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb82-1744"><a href="#cb82-1744" aria-hidden="true" tabindex="-1"></a>d3format <span class="op">=</span> <span class="pp">require</span>(<span class="st">"d3-format@1"</span>)</span>
<span id="cb82-1745"><a href="#cb82-1745" aria-hidden="true" tabindex="-1"></a><span class="co">// https://observablehq.com/@enjalot/draggable-world-map-coordinates-input</span></span>
<span id="cb82-1746"><a href="#cb82-1746" aria-hidden="true" tabindex="-1"></a><span class="kw">function</span> <span class="fu">worldMapCoordinates</span>(config <span class="op">=</span> {}<span class="op">,</span> dimensions) {</span>
<span id="cb82-1747"><a href="#cb82-1747" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> {</span>
<span id="cb82-1748"><a href="#cb82-1748" aria-hidden="true" tabindex="-1"></a>    value <span class="op">=</span> []<span class="op">,</span> title<span class="op">,</span> description<span class="op">,</span> width <span class="op">=</span> dimensions[<span class="dv">0</span>]</span>
<span id="cb82-1749"><a href="#cb82-1749" aria-hidden="true" tabindex="-1"></a>  } <span class="op">=</span> <span class="bu">Array</span><span class="op">.</span><span class="fu">isArray</span>(config) <span class="op">?</span> {<span class="dt">value</span><span class="op">:</span> config[<span class="dv">0</span>]} <span class="op">:</span> config<span class="op">;</span></span>
<span id="cb82-1750"><a href="#cb82-1750" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> height <span class="op">=</span> dimensions[<span class="dv">1</span>]<span class="op">;</span></span>
<span id="cb82-1751"><a href="#cb82-1751" aria-hidden="true" tabindex="-1"></a>  <span class="kw">let</span> [lon<span class="op">,</span> lat] <span class="op">=</span> value<span class="op">;</span></span>
<span id="cb82-1752"><a href="#cb82-1752" aria-hidden="true" tabindex="-1"></a>  lon <span class="op">=</span> lon <span class="op">!=</span> <span class="kw">null</span> <span class="op">?</span> lon <span class="op">:</span> <span class="kw">null</span><span class="op">;</span></span>
<span id="cb82-1753"><a href="#cb82-1753" aria-hidden="true" tabindex="-1"></a>  lat <span class="op">=</span> lat <span class="op">!=</span> <span class="kw">null</span> <span class="op">?</span> lat <span class="op">:</span> <span class="kw">null</span><span class="op">;</span></span>
<span id="cb82-1754"><a href="#cb82-1754" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> formEl <span class="op">=</span> <span class="fu">html</span><span class="vs">`&lt;form id="formEl" style="width: </span><span class="sc">${</span>width<span class="sc">}</span><span class="vs">px;"&gt;&lt;/form&gt;`</span><span class="op">;</span></span>
<span id="cb82-1755"><a href="#cb82-1755" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> context <span class="op">=</span> DOM<span class="op">.</span><span class="fu">context2d</span>(width<span class="op">,</span> height)<span class="op">;</span></span>
<span id="cb82-1756"><a href="#cb82-1756" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> canvas <span class="op">=</span> context<span class="op">.</span><span class="at">canvas</span><span class="op">;</span></span>
<span id="cb82-1757"><a href="#cb82-1757" aria-hidden="true" tabindex="-1"></a>  canvas<span class="op">.</span><span class="at">style</span><span class="op">.</span><span class="at">margin</span> <span class="op">=</span> <span class="vs">`10px 0px 0px 0px`</span><span class="op">;</span></span>
<span id="cb82-1758"><a href="#cb82-1758" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> projection <span class="op">=</span> config[<span class="dv">1</span>]</span>
<span id="cb82-1759"><a href="#cb82-1759" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">precision</span>(<span class="fl">0.1</span>)</span>
<span id="cb82-1760"><a href="#cb82-1760" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">fitSize</span>([width<span class="op">,</span> height]<span class="op">,</span> { <span class="dt">type</span><span class="op">:</span> <span class="st">"Sphere"</span> })<span class="op">;</span></span>
<span id="cb82-1761"><a href="#cb82-1761" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> path <span class="op">=</span> d3<span class="op">.</span><span class="fu">geoPath</span>(projection<span class="op">,</span> context)<span class="op">.</span><span class="fu">pointRadius</span>(<span class="fl">2.5</span>)<span class="op">;</span></span>
<span id="cb82-1762"><a href="#cb82-1762" aria-hidden="true" tabindex="-1"></a>  formEl<span class="op">.</span><span class="fu">append</span>(canvas)<span class="op">;</span></span>
<span id="cb82-1763"><a href="#cb82-1763" aria-hidden="true" tabindex="-1"></a>  <span class="kw">function</span> <span class="fu">fillMesh</span>(f) {</span>
<span id="cb82-1764"><a href="#cb82-1764" aria-hidden="true" tabindex="-1"></a>    context<span class="op">.</span><span class="fu">beginPath</span>()<span class="op">;</span></span>
<span id="cb82-1765"><a href="#cb82-1765" aria-hidden="true" tabindex="-1"></a>    <span class="fu">path</span>(f)<span class="op">;</span></span>
<span id="cb82-1766"><a href="#cb82-1766" aria-hidden="true" tabindex="-1"></a>    context<span class="op">.</span><span class="at">fillStyle</span> <span class="op">=</span> <span class="fu">zonecolor</span>(f<span class="op">.</span><span class="at">properties</span><span class="op">.</span><span class="at">zone</span>)<span class="op">;</span></span>
<span id="cb82-1767"><a href="#cb82-1767" aria-hidden="true" tabindex="-1"></a>    context<span class="op">.</span><span class="fu">fill</span>()<span class="op">;</span></span>
<span id="cb82-1768"><a href="#cb82-1768" aria-hidden="true" tabindex="-1"></a>    context<span class="op">.</span><span class="at">innerHTML</span> <span class="op">=</span> <span class="vs">`&lt;title&gt;</span><span class="sc">${</span>f<span class="op">.</span><span class="at">properties</span><span class="op">.</span><span class="at">places</span><span class="sc">}</span><span class="vs"> </span><span class="sc">${</span>f<span class="op">.</span><span class="at">properties</span><span class="op">.</span><span class="at">time_zone</span><span class="sc">}</span><span class="vs">&lt;/title&gt;`</span><span class="op">;</span></span>
<span id="cb82-1769"><a href="#cb82-1769" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb82-1770"><a href="#cb82-1770" aria-hidden="true" tabindex="-1"></a>  <span class="kw">function</span> <span class="fu">draw</span>() {</span>
<span id="cb82-1771"><a href="#cb82-1771" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> (<span class="op">!</span>utctoggle) {</span>
<span id="cb82-1772"><a href="#cb82-1772" aria-hidden="true" tabindex="-1"></a>      context<span class="op">.</span><span class="fu">beginPath</span>()<span class="op">;</span> <span class="fu">path</span>({<span class="dt">type</span><span class="op">:</span> <span class="st">"Sphere"</span>})<span class="op">;</span></span>
<span id="cb82-1773"><a href="#cb82-1773" aria-hidden="true" tabindex="-1"></a>      context<span class="op">.</span><span class="at">fillStyle</span> <span class="op">=</span> <span class="bu">window</span><span class="op">.</span><span class="at">darkmode</span> <span class="op">?</span> <span class="st">"#007FFF"</span> <span class="op">:</span> mapcolors<span class="op">.</span><span class="at">ocean</span><span class="op">;</span></span>
<span id="cb82-1774"><a href="#cb82-1774" aria-hidden="true" tabindex="-1"></a>      context<span class="op">.</span><span class="fu">fill</span>()<span class="op">;</span></span>
<span id="cb82-1775"><a href="#cb82-1775" aria-hidden="true" tabindex="-1"></a>      <span class="cf">if</span> (gridtoggle) {</span>
<span id="cb82-1776"><a href="#cb82-1776" aria-hidden="true" tabindex="-1"></a>        deczones<span class="op">.</span><span class="fu">map</span>((f<span class="op">,</span> i) <span class="kw">=&gt;</span>  {</span>
<span id="cb82-1777"><a href="#cb82-1777" aria-hidden="true" tabindex="-1"></a>          context<span class="op">.</span><span class="fu">beginPath</span>()<span class="op">;</span></span>
<span id="cb82-1778"><a href="#cb82-1778" aria-hidden="true" tabindex="-1"></a>          <span class="fu">path</span>(f)<span class="op">;</span></span>
<span id="cb82-1779"><a href="#cb82-1779" aria-hidden="true" tabindex="-1"></a>          context<span class="op">.</span><span class="at">fillStyle</span> <span class="op">=</span> hsla10[i]<span class="op">;</span></span>
<span id="cb82-1780"><a href="#cb82-1780" aria-hidden="true" tabindex="-1"></a>          context<span class="op">.</span><span class="fu">fill</span>()<span class="op">;</span></span>
<span id="cb82-1781"><a href="#cb82-1781" aria-hidden="true" tabindex="-1"></a>        })</span>
<span id="cb82-1782"><a href="#cb82-1782" aria-hidden="true" tabindex="-1"></a>      }</span>
<span id="cb82-1783"><a href="#cb82-1783" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb82-1784"><a href="#cb82-1784" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> (utctoggle) {</span>
<span id="cb82-1785"><a href="#cb82-1785" aria-hidden="true" tabindex="-1"></a>      zones<span class="op">.</span><span class="fu">map</span>(f <span class="kw">=&gt;</span> <span class="fu">fillMesh</span>(f))</span>
<span id="cb82-1786"><a href="#cb82-1786" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb82-1787"><a href="#cb82-1787" aria-hidden="true" tabindex="-1"></a>    context<span class="op">.</span><span class="fu">beginPath</span>()<span class="op">;</span></span>
<span id="cb82-1788"><a href="#cb82-1788" aria-hidden="true" tabindex="-1"></a>    <span class="fu">path</span>(land)<span class="op">;</span></span>
<span id="cb82-1789"><a href="#cb82-1789" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> (<span class="op">!</span>utctoggle) {</span>
<span id="cb82-1790"><a href="#cb82-1790" aria-hidden="true" tabindex="-1"></a>      context<span class="op">.</span><span class="at">fillStyle</span> <span class="op">=</span> <span class="bu">window</span><span class="op">.</span><span class="at">darkmode</span> <span class="op">?</span> <span class="st">"#0808"</span> <span class="op">:</span> mapcolors<span class="op">.</span><span class="at">land</span><span class="op">;</span></span>
<span id="cb82-1791"><a href="#cb82-1791" aria-hidden="true" tabindex="-1"></a>      context<span class="op">.</span><span class="fu">fill</span>()<span class="op">;</span></span>
<span id="cb82-1792"><a href="#cb82-1792" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb82-1793"><a href="#cb82-1793" aria-hidden="true" tabindex="-1"></a>    context<span class="op">.</span><span class="at">strokeStyle</span> <span class="op">=</span> <span class="vs">`#000`</span><span class="op">;</span></span>
<span id="cb82-1794"><a href="#cb82-1794" aria-hidden="true" tabindex="-1"></a>    context<span class="op">.</span><span class="fu">stroke</span>()<span class="op">;</span></span>
<span id="cb82-1795"><a href="#cb82-1795" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> (bordertoggle) {</span>
<span id="cb82-1796"><a href="#cb82-1796" aria-hidden="true" tabindex="-1"></a>      context<span class="op">.</span><span class="fu">beginPath</span>()<span class="op">;</span></span>
<span id="cb82-1797"><a href="#cb82-1797" aria-hidden="true" tabindex="-1"></a>      <span class="fu">path</span>(borders)<span class="op">;</span></span>
<span id="cb82-1798"><a href="#cb82-1798" aria-hidden="true" tabindex="-1"></a>      context<span class="op">.</span><span class="at">lineWidth</span> <span class="op">=</span> <span class="fl">1.25</span><span class="op">;</span></span>
<span id="cb82-1799"><a href="#cb82-1799" aria-hidden="true" tabindex="-1"></a>      context<span class="op">.</span><span class="at">strokeStyle</span> <span class="op">=</span> <span class="bu">window</span><span class="op">.</span><span class="at">darkmode</span> <span class="op">?</span> <span class="st">"#aaa"</span> <span class="op">:</span> <span class="st">"#333"</span><span class="op">;</span></span>
<span id="cb82-1800"><a href="#cb82-1800" aria-hidden="true" tabindex="-1"></a>      context<span class="op">.</span><span class="fu">stroke</span>()<span class="op">;</span></span>
<span id="cb82-1801"><a href="#cb82-1801" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb82-1802"><a href="#cb82-1802" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> (utctoggle) {</span>
<span id="cb82-1803"><a href="#cb82-1803" aria-hidden="true" tabindex="-1"></a>      context<span class="op">.</span><span class="fu">beginPath</span>()<span class="op">;</span></span>
<span id="cb82-1804"><a href="#cb82-1804" aria-hidden="true" tabindex="-1"></a>      <span class="fu">path</span>(mesh)<span class="op">;</span></span>
<span id="cb82-1805"><a href="#cb82-1805" aria-hidden="true" tabindex="-1"></a>      context<span class="op">.</span><span class="at">lineWidth</span> <span class="op">=</span> <span class="fl">1.25</span><span class="op">;</span></span>
<span id="cb82-1806"><a href="#cb82-1806" aria-hidden="true" tabindex="-1"></a>      context<span class="op">.</span><span class="at">strokeStyle</span> <span class="op">=</span> <span class="vs">`#999`</span><span class="op">;</span></span>
<span id="cb82-1807"><a href="#cb82-1807" aria-hidden="true" tabindex="-1"></a>      context<span class="op">.</span><span class="fu">stroke</span>()<span class="op">;</span></span>
<span id="cb82-1808"><a href="#cb82-1808" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb82-1809"><a href="#cb82-1809" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> (gridtoggle) {</span>
<span id="cb82-1810"><a href="#cb82-1810" aria-hidden="true" tabindex="-1"></a>      context<span class="op">.</span><span class="fu">beginPath</span>()<span class="op">;</span></span>
<span id="cb82-1811"><a href="#cb82-1811" aria-hidden="true" tabindex="-1"></a>      <span class="fu">path</span>(graticule)<span class="op">;</span></span>
<span id="cb82-1812"><a href="#cb82-1812" aria-hidden="true" tabindex="-1"></a>      context<span class="op">.</span><span class="at">lineWidth</span> <span class="op">=</span> <span class="fl">1.25</span><span class="op">;</span></span>
<span id="cb82-1813"><a href="#cb82-1813" aria-hidden="true" tabindex="-1"></a>      context<span class="op">.</span><span class="at">strokeStyle</span> <span class="op">=</span> utctoggle <span class="op">||</span> <span class="op">!</span><span class="bu">window</span><span class="op">.</span><span class="at">darkmode</span> <span class="op">?</span> <span class="st">"#000"</span> <span class="op">:</span> <span class="st">"#fff"</span><span class="op">;</span></span>
<span id="cb82-1814"><a href="#cb82-1814" aria-hidden="true" tabindex="-1"></a>      context<span class="op">.</span><span class="fu">stroke</span>()<span class="op">;</span></span>
<span id="cb82-1815"><a href="#cb82-1815" aria-hidden="true" tabindex="-1"></a>      context<span class="op">.</span><span class="at">fillStyle</span> <span class="op">=</span> <span class="st">"#000"</span><span class="op">;</span></span>
<span id="cb82-1816"><a href="#cb82-1816" aria-hidden="true" tabindex="-1"></a>      context<span class="op">.</span><span class="at">font</span> <span class="op">=</span> width <span class="op">&lt;</span> <span class="dv">760</span> <span class="op">?</span> <span class="st">"14px serif"</span> <span class="op">:</span> width <span class="op">&lt;</span> <span class="dv">990</span> <span class="op">?</span> <span class="st">"17px serif"</span> <span class="op">:</span> <span class="st">"23px serif"</span><span class="op">;</span></span>
<span id="cb82-1817"><a href="#cb82-1817" aria-hidden="true" tabindex="-1"></a>      d3<span class="op">.</span><span class="fu">range</span>(<span class="op">-</span><span class="fl">1.5</span><span class="op">,</span> <span class="dv">342</span> <span class="op">+</span> <span class="dv">1</span><span class="op">,</span> <span class="dv">36</span>)<span class="op">.</span><span class="fu">map</span>(x <span class="kw">=&gt;</span>  context<span class="op">.</span><span class="fu">fillText</span>(<span class="fu">long2zone</span>(x)<span class="op">,</span> <span class="op">...</span><span class="fu">projection</span>([x<span class="op">,</span> <span class="fl">54.7</span>])))<span class="op">;</span></span>
<span id="cb82-1818"><a href="#cb82-1818" aria-hidden="true" tabindex="-1"></a>      d3<span class="op">.</span><span class="fu">range</span>(<span class="op">-</span><span class="fl">1.5</span><span class="op">,</span> <span class="dv">342</span> <span class="op">+</span> <span class="dv">1</span><span class="op">,</span> <span class="dv">36</span>)<span class="op">.</span><span class="fu">map</span>(x <span class="kw">=&gt;</span>  context<span class="op">.</span><span class="fu">fillText</span>(<span class="fu">long2zone</span>(x)<span class="op">,</span> <span class="op">...</span><span class="fu">projection</span>([x<span class="op">,</span> <span class="op">-</span><span class="fl">59.7</span>])))<span class="op">;</span></span>
<span id="cb82-1819"><a href="#cb82-1819" aria-hidden="true" tabindex="-1"></a>      <span class="co">// context.font = width &lt; 760 ? "12px serif" : "21px serif";</span></span>
<span id="cb82-1820"><a href="#cb82-1820" aria-hidden="true" tabindex="-1"></a>      <span class="co">// context.fillStyle = `#000`;</span></span>
<span id="cb82-1821"><a href="#cb82-1821" aria-hidden="true" tabindex="-1"></a>      <span class="co">// d3.range(-1.5, 342 + 1, 36).map(x =&gt;  context.fillText(long2zone(x), ...projection([x, 27.5])));</span></span>
<span id="cb82-1822"><a href="#cb82-1822" aria-hidden="true" tabindex="-1"></a>      <span class="co">// d3.range(-1.5, 342 + 1, 36).map(x =&gt;  context.fillText(long2zone(x), ...projection([x, -48])));</span></span>
<span id="cb82-1823"><a href="#cb82-1823" aria-hidden="true" tabindex="-1"></a>      <span class="co">// d3.range(-18, 336 + 1, 36).map(x =&gt; context.fillText(formatLongitude(x), ...projection([x, 90])));</span></span>
<span id="cb82-1824"><a href="#cb82-1824" aria-hidden="true" tabindex="-1"></a>      <span class="co">// d3.range(-18, 336 + 1, 36).map(x =&gt; context.fillText(formatLongitude(x), ...projection([x, -90])));</span></span>
<span id="cb82-1825"><a href="#cb82-1825" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb82-1826"><a href="#cb82-1826" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> (suntoggle) {</span>
<span id="cb82-1827"><a href="#cb82-1827" aria-hidden="true" tabindex="-1"></a>      context<span class="op">.</span><span class="fu">beginPath</span>()<span class="op">;</span></span>
<span id="cb82-1828"><a href="#cb82-1828" aria-hidden="true" tabindex="-1"></a>      <span class="fu">path</span>(night)<span class="op">;</span></span>
<span id="cb82-1829"><a href="#cb82-1829" aria-hidden="true" tabindex="-1"></a>      context<span class="op">.</span><span class="at">fillStyle</span> <span class="op">=</span> <span class="st">"rgba(0,0,255,0.3)"</span><span class="op">;</span></span>
<span id="cb82-1830"><a href="#cb82-1830" aria-hidden="true" tabindex="-1"></a>      context<span class="op">.</span><span class="fu">fill</span>()<span class="op">;</span></span>
<span id="cb82-1831"><a href="#cb82-1831" aria-hidden="true" tabindex="-1"></a>      context<span class="op">.</span><span class="fu">beginPath</span>()<span class="op">;</span></span>
<span id="cb82-1832"><a href="#cb82-1832" aria-hidden="true" tabindex="-1"></a>      path<span class="op">.</span><span class="fu">pointRadius</span>(width <span class="op">/</span> <span class="dv">84</span> <span class="op">+</span> <span class="dv">5</span>)<span class="op">;</span></span>
<span id="cb82-1833"><a href="#cb82-1833" aria-hidden="true" tabindex="-1"></a>      <span class="fu">path</span>({<span class="dt">type</span><span class="op">:</span> <span class="st">"Point"</span><span class="op">,</span> <span class="dt">coordinates</span><span class="op">:</span> sun})<span class="op">;</span></span>
<span id="cb82-1834"><a href="#cb82-1834" aria-hidden="true" tabindex="-1"></a>      context<span class="op">.</span><span class="at">strokeStyle</span> <span class="op">=</span> <span class="st">"#0009"</span><span class="op">;</span></span>
<span id="cb82-1835"><a href="#cb82-1835" aria-hidden="true" tabindex="-1"></a>      context<span class="op">.</span><span class="at">fillStyle</span> <span class="op">=</span> <span class="st">"#ff0b"</span><span class="op">;</span></span>
<span id="cb82-1836"><a href="#cb82-1836" aria-hidden="true" tabindex="-1"></a>      context<span class="op">.</span><span class="at">lineWidth</span> <span class="op">=</span> <span class="dv">1</span><span class="op">;</span></span>
<span id="cb82-1837"><a href="#cb82-1837" aria-hidden="true" tabindex="-1"></a>      context<span class="op">.</span><span class="fu">stroke</span>()<span class="op">;</span></span>
<span id="cb82-1838"><a href="#cb82-1838" aria-hidden="true" tabindex="-1"></a>      context<span class="op">.</span><span class="fu">fill</span>()<span class="op">;</span></span>
<span id="cb82-1839"><a href="#cb82-1839" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb82-1840"><a href="#cb82-1840" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> (lon <span class="op">!=</span> <span class="kw">null</span> <span class="op">&amp;&amp;</span> lat <span class="op">!=</span> <span class="kw">null</span>) {</span>
<span id="cb82-1841"><a href="#cb82-1841" aria-hidden="true" tabindex="-1"></a>      path<span class="op">.</span><span class="fu">pointRadius</span>(<span class="dv">17</span>)<span class="op">;</span> context<span class="op">.</span><span class="at">strokeStyle</span> <span class="op">=</span> <span class="st">"black"</span><span class="op">;</span></span>
<span id="cb82-1842"><a href="#cb82-1842" aria-hidden="true" tabindex="-1"></a>      context<span class="op">.</span><span class="fu">beginPath</span>()<span class="op">;</span> <span class="fu">path</span>({<span class="dt">type</span><span class="op">:</span> <span class="st">"Point"</span><span class="op">,</span> <span class="dt">coordinates</span><span class="op">:</span> [lon<span class="op">,</span> lat]})<span class="op">;</span> context<span class="op">.</span><span class="at">lineWidth</span> <span class="op">=</span> <span class="dv">1</span><span class="op">;</span> context<span class="op">.</span><span class="fu">stroke</span>()<span class="op">;</span></span>
<span id="cb82-1843"><a href="#cb82-1843" aria-hidden="true" tabindex="-1"></a>      context<span class="op">.</span><span class="at">lineWidth</span> <span class="op">=</span> <span class="dv">6</span><span class="op">;</span></span>
<span id="cb82-1844"><a href="#cb82-1844" aria-hidden="true" tabindex="-1"></a>      path<span class="op">.</span><span class="fu">pointRadius</span>(<span class="dv">14</span>)<span class="op">;</span> context<span class="op">.</span><span class="at">strokeStyle</span> <span class="op">=</span> <span class="st">"red"</span><span class="op">;</span></span>
<span id="cb82-1845"><a href="#cb82-1845" aria-hidden="true" tabindex="-1"></a>      context<span class="op">.</span><span class="fu">beginPath</span>()<span class="op">;</span> <span class="fu">path</span>({<span class="dt">type</span><span class="op">:</span> <span class="st">"Point"</span><span class="op">,</span> <span class="dt">coordinates</span><span class="op">:</span> [lon<span class="op">,</span> lat]})<span class="op">;</span> context<span class="op">.</span><span class="fu">stroke</span>()<span class="op">;</span></span>
<span id="cb82-1846"><a href="#cb82-1846" aria-hidden="true" tabindex="-1"></a>      context<span class="op">.</span><span class="at">lineWidth</span> <span class="op">=</span> <span class="dv">1</span><span class="op">;</span></span>
<span id="cb82-1847"><a href="#cb82-1847" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb82-1848"><a href="#cb82-1848" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb82-1849"><a href="#cb82-1849" aria-hidden="true" tabindex="-1"></a>  <span class="kw">let</span> drag <span class="op">=</span> d3<span class="op">.</span><span class="fu">drag</span>()</span>
<span id="cb82-1850"><a href="#cb82-1850" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">on</span>(<span class="st">"drag"</span><span class="op">,</span> (<span class="bu">event</span>) <span class="kw">=&gt;</span> {</span>
<span id="cb82-1851"><a href="#cb82-1851" aria-hidden="true" tabindex="-1"></a>      <span class="kw">let</span> coords <span class="op">=</span> projection<span class="op">.</span><span class="fu">invert</span>([<span class="bu">event</span><span class="op">.</span><span class="at">x</span><span class="op">,</span> <span class="bu">event</span><span class="op">.</span><span class="at">y</span>])<span class="op">;</span></span>
<span id="cb82-1852"><a href="#cb82-1852" aria-hidden="true" tabindex="-1"></a>      lon <span class="op">=</span> <span class="op">+</span>coords[<span class="dv">0</span>]<span class="op">.</span><span class="fu">toFixed</span>(<span class="dv">2</span>)<span class="op">;</span></span>
<span id="cb82-1853"><a href="#cb82-1853" aria-hidden="true" tabindex="-1"></a>      lat <span class="op">=</span> <span class="op">+</span>coords[<span class="dv">1</span>]<span class="op">.</span><span class="fu">toFixed</span>(<span class="dv">2</span>)<span class="op">;</span></span>
<span id="cb82-1854"><a href="#cb82-1854" aria-hidden="true" tabindex="-1"></a>      <span class="fu">draw</span>()<span class="op">;</span></span>
<span id="cb82-1855"><a href="#cb82-1855" aria-hidden="true" tabindex="-1"></a>      canvas<span class="op">.</span><span class="fu">dispatchEvent</span>(<span class="kw">new</span> <span class="bu">CustomEvent</span>(<span class="st">"input"</span><span class="op">,</span> { <span class="dt">bubbles</span><span class="op">:</span> <span class="kw">true</span> }))<span class="op">;</span></span>
<span id="cb82-1856"><a href="#cb82-1856" aria-hidden="true" tabindex="-1"></a>    })</span>
<span id="cb82-1857"><a href="#cb82-1857" aria-hidden="true" tabindex="-1"></a>  d3<span class="op">.</span><span class="fu">select</span>(canvas)<span class="op">.</span><span class="fu">call</span>(drag)</span>
<span id="cb82-1858"><a href="#cb82-1858" aria-hidden="true" tabindex="-1"></a>  canvas<span class="op">.</span><span class="at">onclick</span> <span class="op">=</span> <span class="kw">function</span>(ev) {</span>
<span id="cb82-1859"><a href="#cb82-1859" aria-hidden="true" tabindex="-1"></a>    <span class="kw">const</span> { offsetX<span class="op">,</span> offsetY } <span class="op">=</span> ev<span class="op">;</span></span>
<span id="cb82-1860"><a href="#cb82-1860" aria-hidden="true" tabindex="-1"></a>    <span class="kw">let</span> coords <span class="op">=</span> projection<span class="op">.</span><span class="fu">invert</span>([offsetX<span class="op">,</span> offsetY])<span class="op">;</span></span>
<span id="cb82-1861"><a href="#cb82-1861" aria-hidden="true" tabindex="-1"></a>    lon <span class="op">=</span> <span class="op">+</span>coords[<span class="dv">0</span>]<span class="op">.</span><span class="fu">toFixed</span>(<span class="dv">2</span>)<span class="op">;</span></span>
<span id="cb82-1862"><a href="#cb82-1862" aria-hidden="true" tabindex="-1"></a>    lat <span class="op">=</span> <span class="op">+</span>coords[<span class="dv">1</span>]<span class="op">.</span><span class="fu">toFixed</span>(<span class="dv">2</span>)<span class="op">;</span></span>
<span id="cb82-1863"><a href="#cb82-1863" aria-hidden="true" tabindex="-1"></a>    <span class="fu">draw</span>()<span class="op">;</span></span>
<span id="cb82-1864"><a href="#cb82-1864" aria-hidden="true" tabindex="-1"></a>    canvas<span class="op">.</span><span class="fu">dispatchEvent</span>(<span class="kw">new</span> <span class="bu">CustomEvent</span>(<span class="st">"input"</span><span class="op">,</span> { <span class="dt">bubbles</span><span class="op">:</span> <span class="kw">true</span> }))<span class="op">;</span></span>
<span id="cb82-1865"><a href="#cb82-1865" aria-hidden="true" tabindex="-1"></a>  }<span class="op">;</span></span>
<span id="cb82-1866"><a href="#cb82-1866" aria-hidden="true" tabindex="-1"></a>  <span class="fu">draw</span>()<span class="op">;</span></span>
<span id="cb82-1867"><a href="#cb82-1867" aria-hidden="true" tabindex="-1"></a>  <span class="kw">function</span> <span class="fu">resetlatlon</span>() {</span>
<span id="cb82-1868"><a href="#cb82-1868" aria-hidden="true" tabindex="-1"></a>    lon <span class="op">=</span> <span class="dv">160</span><span class="op">;</span></span>
<span id="cb82-1869"><a href="#cb82-1869" aria-hidden="true" tabindex="-1"></a>    lat <span class="op">=</span> <span class="dv">0</span><span class="op">;</span></span>
<span id="cb82-1870"><a href="#cb82-1870" aria-hidden="true" tabindex="-1"></a>    <span class="kw">set</span>(viewof bordertoggle<span class="op">,</span> <span class="kw">false</span>)<span class="op">;</span></span>
<span id="cb82-1871"><a href="#cb82-1871" aria-hidden="true" tabindex="-1"></a>    <span class="kw">set</span>(viewof gridtoggle<span class="op">,</span> <span class="kw">false</span>)<span class="op">;</span></span>
<span id="cb82-1872"><a href="#cb82-1872" aria-hidden="true" tabindex="-1"></a>    <span class="kw">set</span>(viewof suntoggle<span class="op">,</span> <span class="kw">false</span>)<span class="op">;</span></span>
<span id="cb82-1873"><a href="#cb82-1873" aria-hidden="true" tabindex="-1"></a>    <span class="kw">set</span>(viewof utctoggle<span class="op">,</span> <span class="kw">false</span>)<span class="op">;</span></span>
<span id="cb82-1874"><a href="#cb82-1874" aria-hidden="true" tabindex="-1"></a>    <span class="kw">set</span>(viewof yaw<span class="op">,</span> <span class="dv">500</span>)<span class="op">;</span></span>
<span id="cb82-1875"><a href="#cb82-1875" aria-hidden="true" tabindex="-1"></a>    <span class="kw">set</span>(viewof pitch<span class="op">,</span> <span class="dv">0</span>)<span class="op">;</span></span>
<span id="cb82-1876"><a href="#cb82-1876" aria-hidden="true" tabindex="-1"></a>    <span class="kw">set</span>(viewof roll<span class="op">,</span> <span class="dv">0</span>)<span class="op">;</span></span>
<span id="cb82-1877"><a href="#cb82-1877" aria-hidden="true" tabindex="-1"></a>    <span class="kw">set</span>(viewof select<span class="op">,</span> projections<span class="op">.</span><span class="fu">find</span>(t <span class="kw">=&gt;</span> t<span class="op">.</span><span class="at">name</span> <span class="op">===</span> <span class="st">"Equirectangular (plate carrée)"</span>))<span class="op">;</span></span>
<span id="cb82-1878"><a href="#cb82-1878" aria-hidden="true" tabindex="-1"></a>    <span class="fu">draw</span>(lon<span class="op">,</span> lat)<span class="op">;</span></span>
<span id="cb82-1879"><a href="#cb82-1879" aria-hidden="true" tabindex="-1"></a>    canvas<span class="op">.</span><span class="fu">dispatchEvent</span>(<span class="kw">new</span> <span class="bu">CustomEvent</span>(<span class="st">"input"</span><span class="op">,</span> { <span class="dt">bubbles</span><span class="op">:</span> <span class="kw">true</span> }))<span class="op">;</span></span>
<span id="cb82-1880"><a href="#cb82-1880" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb82-1881"><a href="#cb82-1881" aria-hidden="true" tabindex="-1"></a>  rstbtn<span class="op">.</span><span class="fu">on</span>(<span class="st">'click'</span><span class="op">,</span> resetlatlon)<span class="op">;</span></span>
<span id="cb82-1882"><a href="#cb82-1882" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> form <span class="op">=</span> <span class="fu">input</span>({</span>
<span id="cb82-1883"><a href="#cb82-1883" aria-hidden="true" tabindex="-1"></a>    <span class="dt">type</span><span class="op">:</span> <span class="st">"worldMapCoordinates"</span><span class="op">,</span></span>
<span id="cb82-1884"><a href="#cb82-1884" aria-hidden="true" tabindex="-1"></a>    title<span class="op">,</span></span>
<span id="cb82-1885"><a href="#cb82-1885" aria-hidden="true" tabindex="-1"></a>    description<span class="op">,</span></span>
<span id="cb82-1886"><a href="#cb82-1886" aria-hidden="true" tabindex="-1"></a>    <span class="dt">display</span><span class="op">:</span> v <span class="kw">=&gt;</span> (width <span class="op">&gt;</span> <span class="dv">300</span>) <span class="op">?</span> <span class="fu">html</span><span class="vs">`&lt;div style="width: </span><span class="sc">${</span>width<span class="sc">}</span><span class="vs">px; pointer-events: none; white-space: nowrap; color: window.darkmode ? #fff : #000; text-align: center; font: </span><span class="sc">${</span>width <span class="op">&gt;</span> <span class="dv">1000</span> <span class="op">?</span> width <span class="op">/</span> <span class="dv">50</span> <span class="op">:</span> width <span class="op">/</span> <span class="dv">40</span><span class="sc">}</span><span class="vs">px monospace; position: relative; top: </span><span class="sc">${</span><span class="op">-</span><span class="dv">28</span> <span class="op">-</span> width <span class="op">/</span> <span class="dv">25</span><span class="sc">}</span><span class="vs">px;  margin-bottom: -.4em;"&gt;</span></span>
<span id="cb82-1887"><a href="#cb82-1887" aria-hidden="true" tabindex="-1"></a><span class="vs">            &lt;span style="color: window.darkmode ? #fff : #000;"&gt;Zone:&lt;/span&gt; </span><span class="sc">${</span>lon <span class="op">!=</span> <span class="kw">null</span> <span class="op">?</span> <span class="fu">long2zone</span>(lon) <span class="op">:</span> <span class="st">""</span><span class="sc">}</span></span>
<span id="cb82-1888"><a href="#cb82-1888" aria-hidden="true" tabindex="-1"></a><span class="vs">            &amp;nbsp; &amp;nbsp;</span></span>
<span id="cb82-1889"><a href="#cb82-1889" aria-hidden="true" tabindex="-1"></a><span class="vs">            &lt;span style="color: window.darkmode ? #fff : #000;"&gt;Longitude:&lt;/span&gt; </span><span class="sc">${</span>lon <span class="op">!=</span> <span class="kw">null</span> <span class="op">?</span> (<span class="fu">long2turn</span>(lon))<span class="op">.</span><span class="fu">toFixed</span>(<span class="dv">0</span>) <span class="op">:</span> <span class="st">""</span><span class="sc">}</span></span>
<span id="cb82-1890"><a href="#cb82-1890" aria-hidden="true" tabindex="-1"></a><span class="vs">            &amp;nbsp; &amp;nbsp;</span></span>
<span id="cb82-1891"><a href="#cb82-1891" aria-hidden="true" tabindex="-1"></a><span class="vs">            &lt;span style="color: window.darkmode ? #fff : #000;"&gt;Latitude:&lt;/span&gt; </span><span class="sc">${</span>lat <span class="op">!=</span> <span class="kw">null</span> <span class="op">?</span> (<span class="fu">lati2turn</span>(lat))<span class="op">.</span><span class="fu">toFixed</span>(<span class="dv">0</span>) <span class="op">:</span> <span class="st">""</span><span class="sc">}</span></span>
<span id="cb82-1892"><a href="#cb82-1892" aria-hidden="true" tabindex="-1"></a><span class="vs">          &lt;/div&gt;`</span> <span class="op">:</span> <span class="st">''</span><span class="op">,</span></span>
<span id="cb82-1893"><a href="#cb82-1893" aria-hidden="true" tabindex="-1"></a>    <span class="dt">getValue</span><span class="op">:</span> () <span class="kw">=&gt;</span> [lon <span class="op">!=</span> <span class="kw">null</span> <span class="op">?</span> lon <span class="op">:</span> <span class="kw">null</span><span class="op">,</span> lat <span class="op">!=</span> <span class="kw">null</span> <span class="op">?</span> lat <span class="op">:</span> <span class="kw">null</span>]<span class="op">,</span></span>
<span id="cb82-1894"><a href="#cb82-1894" aria-hidden="true" tabindex="-1"></a>    <span class="dt">form</span><span class="op">:</span> formEl</span>
<span id="cb82-1895"><a href="#cb82-1895" aria-hidden="true" tabindex="-1"></a>  })<span class="op">;</span></span>
<span id="cb82-1896"><a href="#cb82-1896" aria-hidden="true" tabindex="-1"></a>  <span class="cf">return</span> form<span class="op">;</span></span>
<span id="cb82-1897"><a href="#cb82-1897" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb82-1898"><a href="#cb82-1898" aria-hidden="true" tabindex="-1"></a><span class="bu">window</span><span class="op">.</span><span class="at">darkmode</span> <span class="op">=</span> <span class="bu">document</span><span class="op">.</span><span class="fu">getElementsByTagName</span>(<span class="st">"body"</span>)[<span class="dv">0</span>]<span class="op">.</span><span class="at">className</span><span class="op">.</span><span class="fu">match</span>(<span class="ss">/quarto-dark/</span>) <span class="op">?</span> <span class="kw">true</span> <span class="op">:</span> <span class="kw">false</span><span class="op">;</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-display hidden">
<div>
<div id="ojs-cell-25-67" data-nodetype="declaration">

</div>
</div>
</div>
<div class="cell-output cell-output-display hidden">
<div>
<div id="ojs-cell-25-68" data-nodetype="declaration">

</div>
</div>
</div>
<div class="cell-output cell-output-display hidden">
<div>
<div id="ojs-cell-25-69" data-nodetype="declaration">

</div>
</div>
</div>
<div class="cell-output cell-output-display hidden">
<div>
<div id="ojs-cell-25-70" data-nodetype="declaration">

</div>
</div>
</div>
<div class="cell-output cell-output-display hidden">
<div>
<div id="ojs-cell-25-71" data-nodetype="declaration">

</div>
</div>
</div>
<div class="cell-output cell-output-display hidden">
<div>
<div id="ojs-cell-25-72" data-nodetype="declaration">

</div>
</div>
</div>
<div class="cell-output cell-output-display hidden">
<div>
<div id="ojs-cell-25-73" data-nodetype="declaration">

</div>
</div>
</div>
<div class="cell-output cell-output-display hidden">
<div>
<div id="ojs-cell-25-74" data-nodetype="declaration">

</div>
</div>
</div>
<div class="cell-output cell-output-display hidden">
<div>
<div id="ojs-cell-25-75" data-nodetype="declaration">

</div>
</div>
</div>
<div class="cell-output cell-output-display hidden">
<div>
<div id="ojs-cell-25-76" data-nodetype="declaration">

</div>
</div>
</div>
<div class="cell-output cell-output-display hidden">
<div>
<div id="ojs-cell-25-77" data-nodetype="declaration">

</div>
</div>
</div>
<div class="cell-output cell-output-display hidden">
<div>
<div id="ojs-cell-25-78" data-nodetype="declaration">

</div>
</div>
</div>
<div class="cell-output cell-output-display hidden">
<div>
<div id="ojs-cell-25-79" data-nodetype="declaration">

</div>
</div>
</div>
<div class="cell-output cell-output-display hidden">
<div>
<div id="ojs-cell-25-80" data-nodetype="declaration">

</div>
</div>
</div>
<div class="cell-output cell-output-display hidden">
<div>
<div id="ojs-cell-25-81" data-nodetype="declaration">

</div>
</div>
</div>
<div class="cell-output cell-output-display hidden">
<div>
<div id="ojs-cell-25-82" data-nodetype="declaration">

</div>
</div>
</div>
<div class="cell-output cell-output-display hidden">
<div>
<div id="ojs-cell-25-83" data-nodetype="declaration">

</div>
</div>
</div>
<div class="cell-output cell-output-display hidden">
<div>
<div id="ojs-cell-25-84" data-nodetype="declaration">

</div>
</div>
</div>
<div class="cell-output cell-output-display hidden">
<div>
<div id="ojs-cell-25-85" data-nodetype="declaration">

</div>
</div>
</div>
<div class="cell-output cell-output-display hidden">
<div>
<div id="ojs-cell-25-86" data-nodetype="declaration">

</div>
</div>
</div>
<div class="cell-output cell-output-display hidden">
<div>
<div id="ojs-cell-25-87" data-nodetype="declaration">

</div>
</div>
</div>
<div class="cell-output cell-output-display hidden">
<div>
<div id="ojs-cell-25-88" data-nodetype="declaration">

</div>
</div>
</div>
<div class="cell-output cell-output-display hidden">
<div>
<div id="ojs-cell-25-89" data-nodetype="declaration">

</div>
</div>
</div>
<div class="cell-output cell-output-display hidden">
<div>
<div id="ojs-cell-25-90" data-nodetype="declaration">

</div>
</div>
</div>
<div class="cell-output cell-output-display hidden">
<div>
<div id="ojs-cell-25-91" data-nodetype="declaration">

</div>
</div>
</div>
<div class="cell-output cell-output-display hidden">
<div>
<div id="ojs-cell-25-92" data-nodetype="declaration">

</div>
</div>
</div>
<div class="cell-output cell-output-display hidden">
<div>
<div id="ojs-cell-25-93" data-nodetype="declaration">

</div>
</div>
</div>
<div class="cell-output cell-output-display hidden">
<div>
<div id="ojs-cell-25-94" data-nodetype="declaration">

</div>
</div>
</div>
<div class="cell-output cell-output-display hidden">
<div>
<div id="ojs-cell-25-95" data-nodetype="declaration">

</div>
</div>
</div>
<div class="cell-output cell-output-display hidden">
<div>
<div id="ojs-cell-25-96" data-nodetype="declaration">

</div>
</div>
</div>
<div class="cell-output cell-output-display hidden">
<div>
<div id="ojs-cell-25-97" data-nodetype="declaration">

</div>
</div>
</div>
<div class="cell-output cell-output-display hidden">
<div>
<div id="ojs-cell-25-98" data-nodetype="expression">

</div>
</div>
</div>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code hidden" id="cb83" data-startfrom="1899" data-source-offset="-42950"><pre class="sourceCode js code-with-copy"><code class="sourceCode javascript" style="counter-reset: source-line 1898;"><span id="cb83-1899"><a href="#cb83-1899" aria-hidden="true" tabindex="-1"></a><span class="bu">document</span><span class="op">.</span><span class="fu">getElementsByClassName</span>(<span class="st">"quarto-color-scheme-toggle"</span>)[<span class="dv">0</span>]<span class="op">.</span><span class="at">onclick</span> <span class="op">=</span> <span class="kw">function</span> (e) {</span>
<span id="cb83-1900"><a href="#cb83-1900" aria-hidden="true" tabindex="-1"></a>  <span class="bu">window</span><span class="op">.</span><span class="fu">quartoToggleColorScheme</span>()<span class="op">;</span></span>
<span id="cb83-1901"><a href="#cb83-1901" aria-hidden="true" tabindex="-1"></a>  <span class="bu">window</span><span class="op">.</span><span class="at">darkmode</span> <span class="op">=</span> <span class="bu">document</span><span class="op">.</span><span class="fu">getElementsByTagName</span>(<span class="st">"body"</span>)[<span class="dv">0</span>]<span class="op">.</span><span class="at">className</span><span class="op">.</span><span class="fu">match</span>(<span class="ss">/quarto-dark/</span>) <span class="op">?</span> <span class="kw">true</span> <span class="op">:</span> <span class="kw">false</span><span class="op">;</span></span>
<span id="cb83-1902"><a href="#cb83-1902" aria-hidden="true" tabindex="-1"></a>  worldMapCoordinates<span class="op">.</span><span class="fu">draw</span>()<span class="op">;</span></span>
<span id="cb83-1903"><a href="#cb83-1903" aria-hidden="true" tabindex="-1"></a>  app<span class="op">.</span><span class="fu">drawEarth</span>()<span class="op">;</span></span>
<span id="cb83-1904"><a href="#cb83-1904" aria-hidden="true" tabindex="-1"></a>  <span class="cf">return</span> <span class="kw">false</span><span class="op">;</span></span>
<span id="cb83-1905"><a href="#cb83-1905" aria-hidden="true" tabindex="-1"></a>}<span class="op">;</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-display hidden">
<div>
<div id="ojs-cell-25-99" data-nodetype="expression">

</div>
</div>
</div>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code hidden" id="cb84" data-startfrom="1906" data-source-offset="-43252"><pre class="sourceCode js code-with-copy"><code class="sourceCode javascript" style="counter-reset: source-line 1905;"><span id="cb84-1906"><a href="#cb84-1906" aria-hidden="true" tabindex="-1"></a>sun <span class="op">=</span> {</span>
<span id="cb84-1907"><a href="#cb84-1907" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> now <span class="op">=</span> <span class="kw">new</span> <span class="bu">Date</span><span class="op">;</span></span>
<span id="cb84-1908"><a href="#cb84-1908" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> day <span class="op">=</span> <span class="kw">new</span> <span class="bu">Date</span>(<span class="op">+</span>now)<span class="op">.</span><span class="fu">setUTCHours</span>(<span class="dv">0</span><span class="op">,</span> <span class="dv">0</span><span class="op">,</span> <span class="dv">0</span><span class="op">,</span> <span class="dv">0</span>)<span class="op">;</span></span>
<span id="cb84-1909"><a href="#cb84-1909" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> t <span class="op">=</span> solar<span class="op">.</span><span class="fu">century</span>(now)<span class="op">;</span></span>
<span id="cb84-1910"><a href="#cb84-1910" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> longitude <span class="op">=</span> (day <span class="op">-</span> now) <span class="op">/</span> <span class="fl">864e5</span> <span class="op">*</span> <span class="dv">360</span> <span class="op">-</span> <span class="dv">180</span><span class="op">;</span></span>
<span id="cb84-1911"><a href="#cb84-1911" aria-hidden="true" tabindex="-1"></a>  <span class="cf">return</span> [longitude <span class="op">-</span> solar<span class="op">.</span><span class="fu">equationOfTime</span>(t) <span class="op">/</span> <span class="dv">4</span><span class="op">,</span> solar<span class="op">.</span><span class="fu">declination</span>(t)]<span class="op">;</span></span>
<span id="cb84-1912"><a href="#cb84-1912" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb84-1913"><a href="#cb84-1913" aria-hidden="true" tabindex="-1"></a>night <span class="op">=</span> d3<span class="op">.</span><span class="fu">geoCircle</span>()</span>
<span id="cb84-1914"><a href="#cb84-1914" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">radius</span>(<span class="dv">90</span>)</span>
<span id="cb84-1915"><a href="#cb84-1915" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">center</span>(<span class="fu">antipode</span>(sun))</span>
<span id="cb84-1916"><a href="#cb84-1916" aria-hidden="true" tabindex="-1"></a>  ()</span>
<span id="cb84-1917"><a href="#cb84-1917" aria-hidden="true" tabindex="-1"></a>antipode <span class="op">=</span> ([longitude<span class="op">,</span> latitude]) <span class="kw">=&gt;</span> [longitude <span class="op">+</span> <span class="dv">180</span><span class="op">,</span> <span class="op">-</span>latitude]</span>
<span id="cb84-1918"><a href="#cb84-1918" aria-hidden="true" tabindex="-1"></a>solar <span class="op">=</span> <span class="pp">require</span>(<span class="st">"solar-calculator@0.3/dist/solar-calculator.min.js"</span>)</span>
<span id="cb84-1919"><a href="#cb84-1919" aria-hidden="true" tabindex="-1"></a>viewof fancySecondsOFF <span class="op">=</span> Inputs<span class="op">.</span><span class="fu">toggle</span>({</span>
<span id="cb84-1920"><a href="#cb84-1920" aria-hidden="true" tabindex="-1"></a>  <span class="dt">label</span><span class="op">:</span> <span class="st">"Ticking clock"</span><span class="op">,</span></span>
<span id="cb84-1921"><a href="#cb84-1921" aria-hidden="true" tabindex="-1"></a>  <span class="dt">value</span><span class="op">:</span> <span class="kw">true</span><span class="op">,</span></span>
<span id="cb84-1922"><a href="#cb84-1922" aria-hidden="true" tabindex="-1"></a>})</span>
<span id="cb84-1923"><a href="#cb84-1923" aria-hidden="true" tabindex="-1"></a><span class="kw">function</span> <span class="fu">setStyle</span>(content<span class="op">,</span> style <span class="op">=</span> {}) {</span>
<span id="cb84-1924"><a href="#cb84-1924" aria-hidden="true" tabindex="-1"></a>  <span class="kw">function</span> <span class="fu">yiq</span>(color) {</span>
<span id="cb84-1925"><a href="#cb84-1925" aria-hidden="true" tabindex="-1"></a>    <span class="kw">const</span> {r<span class="op">,</span> g<span class="op">,</span> b} <span class="op">=</span> d3<span class="op">.</span><span class="fu">rgb</span>(color)<span class="op">;</span></span>
<span id="cb84-1926"><a href="#cb84-1926" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> (r <span class="op">*</span> <span class="dv">299</span> <span class="op">+</span> g <span class="op">*</span> <span class="dv">587</span> <span class="op">+</span> b <span class="op">*</span> <span class="dv">114</span>) <span class="op">/</span> <span class="dv">1000</span> <span class="op">/</span> <span class="dv">255</span><span class="op">;</span> <span class="co">// returns values between 0 and 1</span></span>
<span id="cb84-1927"><a href="#cb84-1927" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb84-1928"><a href="#cb84-1928" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> {</span>
<span id="cb84-1929"><a href="#cb84-1929" aria-hidden="true" tabindex="-1"></a>    background<span class="op">,</span></span>
<span id="cb84-1930"><a href="#cb84-1930" aria-hidden="true" tabindex="-1"></a>    color <span class="op">=</span> <span class="fu">yiq</span>(background) <span class="op">&gt;=</span> <span class="fl">0.6</span> <span class="op">?</span> <span class="st">"#111"</span> <span class="op">:</span> <span class="st">"white"</span><span class="op">,</span></span>
<span id="cb84-1931"><a href="#cb84-1931" aria-hidden="true" tabindex="-1"></a>    padding <span class="op">=</span> <span class="st">"0 1px"</span><span class="op">,</span></span>
<span id="cb84-1932"><a href="#cb84-1932" aria-hidden="true" tabindex="-1"></a>    borderRadius <span class="op">=</span> <span class="st">"4px"</span><span class="op">,</span></span>
<span id="cb84-1933"><a href="#cb84-1933" aria-hidden="true" tabindex="-1"></a>    fontWeight <span class="op">=</span> <span class="dv">900</span><span class="op">,</span></span>
<span id="cb84-1934"><a href="#cb84-1934" aria-hidden="true" tabindex="-1"></a>    fontSize <span class="op">=</span> <span class="st">"1em"</span><span class="op">,</span></span>
<span id="cb84-1935"><a href="#cb84-1935" aria-hidden="true" tabindex="-1"></a>    <span class="op">...</span>rest</span>
<span id="cb84-1936"><a href="#cb84-1936" aria-hidden="true" tabindex="-1"></a>  } <span class="op">=</span> <span class="kw">typeof</span> style <span class="op">===</span> <span class="st">"string"</span> <span class="op">?</span> {<span class="dt">background</span><span class="op">:</span> style} <span class="op">:</span> style<span class="op">;</span></span>
<span id="cb84-1937"><a href="#cb84-1937" aria-hidden="true" tabindex="-1"></a>  <span class="cf">return</span> htl<span class="op">.</span><span class="fu">html</span><span class="vs">`&lt;span style=</span><span class="sc">${</span>{</span>
<span id="cb84-1938"><a href="#cb84-1938" aria-hidden="true" tabindex="-1"></a>    background<span class="op">,</span></span>
<span id="cb84-1939"><a href="#cb84-1939" aria-hidden="true" tabindex="-1"></a>    color<span class="op">,</span></span>
<span id="cb84-1940"><a href="#cb84-1940" aria-hidden="true" tabindex="-1"></a>    padding<span class="op">,</span></span>
<span id="cb84-1941"><a href="#cb84-1941" aria-hidden="true" tabindex="-1"></a>    borderRadius<span class="op">,</span></span>
<span id="cb84-1942"><a href="#cb84-1942" aria-hidden="true" tabindex="-1"></a>    fontWeight<span class="op">,</span></span>
<span id="cb84-1943"><a href="#cb84-1943" aria-hidden="true" tabindex="-1"></a>    <span class="op">...</span>rest</span>
<span id="cb84-1944"><a href="#cb84-1944" aria-hidden="true" tabindex="-1"></a>  }<span class="sc">}</span><span class="vs">&gt;</span><span class="sc">${</span>content<span class="sc">}</span><span class="vs">&lt;/span&gt;`</span><span class="op">;</span></span>
<span id="cb84-1945"><a href="#cb84-1945" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb84-1946"><a href="#cb84-1946" aria-hidden="true" tabindex="-1"></a><span class="kw">function</span> <span class="fu">yiq</span>(color) {</span>
<span id="cb84-1947"><a href="#cb84-1947" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> {r<span class="op">,</span> g<span class="op">,</span> b} <span class="op">=</span> d3<span class="op">.</span><span class="fu">rgb</span>(color)<span class="op">;</span></span>
<span id="cb84-1948"><a href="#cb84-1948" aria-hidden="true" tabindex="-1"></a>  <span class="cf">return</span> (r <span class="op">*</span> <span class="dv">299</span> <span class="op">+</span> g <span class="op">*</span> <span class="dv">587</span> <span class="op">+</span> b <span class="op">*</span> <span class="dv">114</span>) <span class="op">/</span> <span class="dv">1000</span> <span class="op">/</span> <span class="dv">255</span><span class="op">;</span> <span class="co">// returns values between 0 and 1</span></span>
<span id="cb84-1949"><a href="#cb84-1949" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb84-1950"><a href="#cb84-1950" aria-hidden="true" tabindex="-1"></a><span class="kw">function</span> <span class="fu">textcolor</span>(content<span class="op">,</span> style <span class="op">=</span> {}) {</span>
<span id="cb84-1951"><a href="#cb84-1951" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> {</span>
<span id="cb84-1952"><a href="#cb84-1952" aria-hidden="true" tabindex="-1"></a>    background<span class="op">,</span></span>
<span id="cb84-1953"><a href="#cb84-1953" aria-hidden="true" tabindex="-1"></a>    color <span class="op">=</span> <span class="fu">yiq</span>(background) <span class="op">&gt;</span> <span class="fl">0.51</span> <span class="op">?</span> <span class="st">"#000"</span> <span class="op">:</span> <span class="st">"white"</span><span class="op">,</span></span>
<span id="cb84-1954"><a href="#cb84-1954" aria-hidden="true" tabindex="-1"></a>    padding <span class="op">=</span> <span class="st">"0 5px"</span><span class="op">,</span></span>
<span id="cb84-1955"><a href="#cb84-1955" aria-hidden="true" tabindex="-1"></a>    borderRadius <span class="op">=</span> <span class="st">"4px"</span><span class="op">,</span></span>
<span id="cb84-1956"><a href="#cb84-1956" aria-hidden="true" tabindex="-1"></a>    fontWeight <span class="op">=</span> <span class="dv">400</span><span class="op">,</span></span>
<span id="cb84-1957"><a href="#cb84-1957" aria-hidden="true" tabindex="-1"></a>    fontFamily <span class="op">=</span> <span class="st">"monospace"</span><span class="op">,</span></span>
<span id="cb84-1958"><a href="#cb84-1958" aria-hidden="true" tabindex="-1"></a>    <span class="op">...</span>rest</span>
<span id="cb84-1959"><a href="#cb84-1959" aria-hidden="true" tabindex="-1"></a>  } <span class="op">=</span> <span class="kw">typeof</span> style <span class="op">===</span> <span class="st">"string"</span> <span class="op">?</span> {<span class="dt">background</span><span class="op">:</span> style} <span class="op">:</span> style<span class="op">;</span></span>
<span id="cb84-1960"><a href="#cb84-1960" aria-hidden="true" tabindex="-1"></a>  <span class="cf">return</span> htl<span class="op">.</span><span class="fu">html</span><span class="vs">`&lt;span style=</span><span class="sc">${</span>{</span>
<span id="cb84-1961"><a href="#cb84-1961" aria-hidden="true" tabindex="-1"></a>    background<span class="op">,</span></span>
<span id="cb84-1962"><a href="#cb84-1962" aria-hidden="true" tabindex="-1"></a>    color<span class="op">,</span></span>
<span id="cb84-1963"><a href="#cb84-1963" aria-hidden="true" tabindex="-1"></a>    padding<span class="op">,</span></span>
<span id="cb84-1964"><a href="#cb84-1964" aria-hidden="true" tabindex="-1"></a>    borderRadius<span class="op">,</span></span>
<span id="cb84-1965"><a href="#cb84-1965" aria-hidden="true" tabindex="-1"></a>    fontWeight<span class="op">,</span></span>
<span id="cb84-1966"><a href="#cb84-1966" aria-hidden="true" tabindex="-1"></a>    fontFamily<span class="op">,</span></span>
<span id="cb84-1967"><a href="#cb84-1967" aria-hidden="true" tabindex="-1"></a>    <span class="op">...</span>rest</span>
<span id="cb84-1968"><a href="#cb84-1968" aria-hidden="true" tabindex="-1"></a>  }<span class="sc">}</span><span class="vs">&gt;</span><span class="sc">${</span>content<span class="sc">}</span><span class="vs">&lt;/span&gt;`</span><span class="op">;</span></span>
<span id="cb84-1969"><a href="#cb84-1969" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb84-1970"><a href="#cb84-1970" aria-hidden="true" tabindex="-1"></a><span class="kw">function</span> <span class="fu">isLeapYear</span>(y) {</span>
<span id="cb84-1971"><a href="#cb84-1971" aria-hidden="true" tabindex="-1"></a>  y <span class="op">+=</span> <span class="dv">1</span><span class="op">;</span></span>
<span id="cb84-1972"><a href="#cb84-1972" aria-hidden="true" tabindex="-1"></a>  <span class="cf">return</span> y <span class="op">%</span> <span class="dv">4</span> <span class="op">==</span> <span class="dv">0</span> <span class="op">&amp;&amp;</span> y <span class="op">%</span> <span class="dv">100</span> <span class="op">!=</span> <span class="dv">0</span> <span class="op">||</span> y <span class="op">%</span> <span class="dv">400</span> <span class="op">==</span> <span class="dv">0</span><span class="op">;</span></span>
<span id="cb84-1973"><a href="#cb84-1973" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb84-1974"><a href="#cb84-1974" aria-hidden="true" tabindex="-1"></a>elapsed <span class="op">=</span> {</span>
<span id="cb84-1975"><a href="#cb84-1975" aria-hidden="true" tabindex="-1"></a>  <span class="kw">let</span> i <span class="op">=</span> <span class="dv">0</span><span class="op">;</span></span>
<span id="cb84-1976"><a href="#cb84-1976" aria-hidden="true" tabindex="-1"></a>  <span class="cf">while</span> (<span class="kw">true</span>) {</span>
<span id="cb84-1977"><a href="#cb84-1977" aria-hidden="true" tabindex="-1"></a>    <span class="kw">yield</span> Promises<span class="op">.</span><span class="fu">tick</span>(<span class="dv">864</span><span class="op">,</span> <span class="op">++</span>i)<span class="op">;</span></span>
<span id="cb84-1978"><a href="#cb84-1978" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb84-1979"><a href="#cb84-1979" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb84-1980"><a href="#cb84-1980" aria-hidden="true" tabindex="-1"></a>piecewiseColor <span class="op">=</span> d3<span class="op">.</span><span class="fu">piecewise</span>(d3<span class="op">.</span><span class="at">interpolateRgb</span><span class="op">,</span> [</span>
<span id="cb84-1981"><a href="#cb84-1981" aria-hidden="true" tabindex="-1"></a>  <span class="st">"#f00"</span><span class="op">,</span>    <span class="co">//  0   0 red</span></span>
<span id="cb84-1982"><a href="#cb84-1982" aria-hidden="true" tabindex="-1"></a>  <span class="st">"#f50"</span><span class="op">,</span>    <span class="co">//  0.25  20 yr</span></span>
<span id="cb84-1983"><a href="#cb84-1983" aria-hidden="true" tabindex="-1"></a>  <span class="st">"#f60"</span><span class="op">,</span>    <span class="co">//  0.5   24 yr orangered</span></span>
<span id="cb84-1984"><a href="#cb84-1984" aria-hidden="true" tabindex="-1"></a>  <span class="st">"#f70"</span><span class="op">,</span>    <span class="co">//  0.75  28 yr</span></span>
<span id="cb84-1985"><a href="#cb84-1985" aria-hidden="true" tabindex="-1"></a>  <span class="st">"#f90"</span><span class="op">,</span>    <span class="co">//  1     36 yr orange</span></span>
<span id="cb84-1986"><a href="#cb84-1986" aria-hidden="true" tabindex="-1"></a>  <span class="st">"#fb0"</span><span class="op">,</span>    <span class="co">//  1.25  44 yr</span></span>
<span id="cb84-1987"><a href="#cb84-1987" aria-hidden="true" tabindex="-1"></a>  <span class="st">"#fc0"</span><span class="op">,</span>    <span class="co">//  1.5   48 yr yelloworange</span></span>
<span id="cb84-1988"><a href="#cb84-1988" aria-hidden="true" tabindex="-1"></a>  <span class="st">"#fd0"</span><span class="op">,</span>    <span class="co">//  1.75  52 yr</span></span>
<span id="cb84-1989"><a href="#cb84-1989" aria-hidden="true" tabindex="-1"></a>  <span class="st">"#ff0"</span><span class="op">,</span>    <span class="co">//  2     60 yellow</span></span>
<span id="cb84-1990"><a href="#cb84-1990" aria-hidden="true" tabindex="-1"></a>  <span class="st">"#ef0"</span><span class="op">,</span>    <span class="co">//  2.25  64 gy</span></span>
<span id="cb84-1991"><a href="#cb84-1991" aria-hidden="true" tabindex="-1"></a>  <span class="st">"#df0"</span><span class="op">,</span>    <span class="co">//  2.5   68 gy limeyellow</span></span>
<span id="cb84-1992"><a href="#cb84-1992" aria-hidden="true" tabindex="-1"></a>  <span class="st">"#cf0"</span><span class="op">,</span>    <span class="co">//  2.75  72 gy</span></span>
<span id="cb84-1993"><a href="#cb84-1993" aria-hidden="true" tabindex="-1"></a>  <span class="st">"#af0"</span><span class="op">,</span>    <span class="co">//  3     80 gy lime</span></span>
<span id="cb84-1994"><a href="#cb84-1994" aria-hidden="true" tabindex="-1"></a>  <span class="st">"#8f0"</span><span class="op">,</span>    <span class="co">//  3.25  88 gy</span></span>
<span id="cb84-1995"><a href="#cb84-1995" aria-hidden="true" tabindex="-1"></a>  <span class="st">"#7f0"</span><span class="op">,</span>    <span class="co">//  3.5   92 gy greenlime</span></span>
<span id="cb84-1996"><a href="#cb84-1996" aria-hidden="true" tabindex="-1"></a>  <span class="st">"#6f0"</span><span class="op">,</span>    <span class="co">//  3.75  96 gy</span></span>
<span id="cb84-1997"><a href="#cb84-1997" aria-hidden="true" tabindex="-1"></a>  <span class="st">"#0f0"</span><span class="op">,</span>    <span class="co">//  4    120 green</span></span>
<span id="cb84-1998"><a href="#cb84-1998" aria-hidden="true" tabindex="-1"></a>  <span class="st">"#0f7"</span><span class="op">,</span>    <span class="co">//  4.25 148 cg</span></span>
<span id="cb84-1999"><a href="#cb84-1999" aria-hidden="true" tabindex="-1"></a>  <span class="st">"#0f9"</span><span class="op">,</span>    <span class="co">//  4.5  156 cg cyangreen</span></span>
<span id="cb84-2000"><a href="#cb84-2000" aria-hidden="true" tabindex="-1"></a>  <span class="st">"#0fb"</span><span class="op">,</span>    <span class="co">//  4.75 164 cg</span></span>
<span id="cb84-2001"><a href="#cb84-2001" aria-hidden="true" tabindex="-1"></a>  <span class="st">"#0ff"</span><span class="op">,</span>    <span class="co">//  5    180 cyan</span></span>
<span id="cb84-2002"><a href="#cb84-2002" aria-hidden="true" tabindex="-1"></a>  <span class="st">"#0cf"</span><span class="op">,</span>    <span class="co">//  5.25 192 bc</span></span>
<span id="cb84-2003"><a href="#cb84-2003" aria-hidden="true" tabindex="-1"></a>  <span class="st">"#0bf"</span><span class="op">,</span>    <span class="co">//  5.5  196 bc azurecyan</span></span>
<span id="cb84-2004"><a href="#cb84-2004" aria-hidden="true" tabindex="-1"></a>  <span class="st">"#0af"</span><span class="op">,</span>    <span class="co">//  5.75 200 bc</span></span>
<span id="cb84-2005"><a href="#cb84-2005" aria-hidden="true" tabindex="-1"></a>  <span class="st">"#08f"</span><span class="op">,</span>    <span class="co">//  6    208 bc azure</span></span>
<span id="cb84-2006"><a href="#cb84-2006" aria-hidden="true" tabindex="-1"></a>  <span class="st">"#06f"</span><span class="op">,</span>    <span class="co">//  6.25 216 bc</span></span>
<span id="cb84-2007"><a href="#cb84-2007" aria-hidden="true" tabindex="-1"></a>  <span class="st">"#05f"</span><span class="op">,</span>    <span class="co">//  6.5  220 bc blueazure</span></span>
<span id="cb84-2008"><a href="#cb84-2008" aria-hidden="true" tabindex="-1"></a>  <span class="st">"#04f"</span><span class="op">,</span>    <span class="co">//  6.75 224 bc</span></span>
<span id="cb84-2009"><a href="#cb84-2009" aria-hidden="true" tabindex="-1"></a>  <span class="st">"#00f"</span><span class="op">,</span>    <span class="co">//  7    240 blue</span></span>
<span id="cb84-2010"><a href="#cb84-2010" aria-hidden="true" tabindex="-1"></a>  <span class="st">"#50f"</span><span class="op">,</span>    <span class="co">//  7.25 260 mb</span></span>
<span id="cb84-2011"><a href="#cb84-2011" aria-hidden="true" tabindex="-1"></a>  <span class="st">"#60f"</span><span class="op">,</span>    <span class="co">//  7.5  264 mb purpleblue</span></span>
<span id="cb84-2012"><a href="#cb84-2012" aria-hidden="true" tabindex="-1"></a>  <span class="st">"#70f"</span><span class="op">,</span>    <span class="co">//  7.75 268 mb</span></span>
<span id="cb84-2013"><a href="#cb84-2013" aria-hidden="true" tabindex="-1"></a>  <span class="st">"#90f"</span><span class="op">,</span>    <span class="co">//  8    276 mb purple</span></span>
<span id="cb84-2014"><a href="#cb84-2014" aria-hidden="true" tabindex="-1"></a>  <span class="st">"#b0f"</span><span class="op">,</span>    <span class="co">//  8.25 284 mb</span></span>
<span id="cb84-2015"><a href="#cb84-2015" aria-hidden="true" tabindex="-1"></a>  <span class="st">"#c0f"</span><span class="op">,</span>    <span class="co">//  8.5  288 mb violetpurple</span></span>
<span id="cb84-2016"><a href="#cb84-2016" aria-hidden="true" tabindex="-1"></a>  <span class="st">"#d0f"</span><span class="op">,</span>    <span class="co">//  8.75 292 mb</span></span>
<span id="cb84-2017"><a href="#cb84-2017" aria-hidden="true" tabindex="-1"></a>  <span class="st">"#f0f"</span><span class="op">,</span>    <span class="co">//  9    300 magenta</span></span>
<span id="cb84-2018"><a href="#cb84-2018" aria-hidden="true" tabindex="-1"></a>  <span class="st">"#f0a"</span><span class="op">,</span>    <span class="co">//  9.25 320 rm</span></span>
<span id="cb84-2019"><a href="#cb84-2019" aria-hidden="true" tabindex="-1"></a>  <span class="st">"#f08"</span><span class="op">,</span>    <span class="co">//  9.5  328 rm</span></span>
<span id="cb84-2020"><a href="#cb84-2020" aria-hidden="true" tabindex="-1"></a>  <span class="st">"#f06"</span><span class="op">,</span>    <span class="co">//  9.75 336 rm</span></span>
<span id="cb84-2021"><a href="#cb84-2021" aria-hidden="true" tabindex="-1"></a>  <span class="st">"#f00"</span><span class="op">,</span>    <span class="co">//  0        0 red</span></span>
<span id="cb84-2022"><a href="#cb84-2022" aria-hidden="true" tabindex="-1"></a>])</span>
<span id="cb84-2023"><a href="#cb84-2023" aria-hidden="true" tabindex="-1"></a>slStr <span class="op">=</span> <span class="vs">`, 100%, 50%)`</span></span>
<span id="cb84-2024"><a href="#cb84-2024" aria-hidden="true" tabindex="-1"></a>elaTime <span class="op">=</span> elapsed <span class="op">%</span> <span class="fl">1e5</span></span>
<span id="cb84-2025"><a href="#cb84-2025" aria-hidden="true" tabindex="-1"></a>elaTimeHsl <span class="op">=</span> <span class="fu">textcolor</span>(elaTime<span class="op">,</span> <span class="vs">`hsl(</span><span class="sc">${</span>d3<span class="op">.</span><span class="fu">hsl</span>(<span class="fu">piecewiseColor</span>(elaTime <span class="op">%</span> <span class="dv">1000</span> <span class="op">/</span> <span class="dv">1000</span>))<span class="op">.</span><span class="at">h</span><span class="sc">}</span><span class="vs">`</span> <span class="op">+</span> slStr)</span>
<span id="cb84-2026"><a href="#cb84-2026" aria-hidden="true" tabindex="-1"></a>decMoty <span class="op">=</span> <span class="bu">Math</span><span class="op">.</span><span class="fu">floor</span>((<span class="dv">5</span> <span class="op">*</span> decDate <span class="op">+</span> <span class="dv">2</span>) <span class="op">/</span> <span class="dv">153</span>)</span>
<span id="cb84-2027"><a href="#cb84-2027" aria-hidden="true" tabindex="-1"></a>isoYear <span class="op">=</span> decYear <span class="op">+</span> (decMoty <span class="op">&gt;</span> <span class="dv">9</span>)</span>
<span id="cb84-2028"><a href="#cb84-2028" aria-hidden="true" tabindex="-1"></a>month <span class="op">=</span> decMoty <span class="op">&lt;</span> <span class="dv">10</span> <span class="op">?</span> decMoty <span class="op">+</span> <span class="dv">3</span> <span class="op">:</span> decMoty <span class="op">-</span> <span class="dv">9</span></span>
<span id="cb84-2029"><a href="#cb84-2029" aria-hidden="true" tabindex="-1"></a>decHour <span class="op">=</span> decTime <span class="op">*</span> <span class="dv">24</span></span>
<span id="cb84-2030"><a href="#cb84-2030" aria-hidden="true" tabindex="-1"></a>decMinute <span class="op">=</span> (decHour <span class="op">%</span> <span class="dv">1</span>) <span class="op">*</span> <span class="dv">60</span></span>
<span id="cb84-2031"><a href="#cb84-2031" aria-hidden="true" tabindex="-1"></a>decSecond <span class="op">=</span> (decMinute <span class="op">%</span> <span class="dv">1</span>) <span class="op">*</span> <span class="dv">60</span></span>
<span id="cb84-2032"><a href="#cb84-2032" aria-hidden="true" tabindex="-1"></a>isoHour <span class="op">=</span> <span class="bu">Math</span><span class="op">.</span><span class="fu">floor</span>(decHour)</span>
<span id="cb84-2033"><a href="#cb84-2033" aria-hidden="true" tabindex="-1"></a>isoMinute <span class="op">=</span> <span class="bu">Math</span><span class="op">.</span><span class="fu">floor</span>(decMinute)</span>
<span id="cb84-2034"><a href="#cb84-2034" aria-hidden="true" tabindex="-1"></a>isoSecond <span class="op">=</span> <span class="bu">Math</span><span class="op">.</span><span class="fu">floor</span>(decSecond)</span>
<span id="cb84-2035"><a href="#cb84-2035" aria-hidden="true" tabindex="-1"></a>decDek <span class="op">=</span> <span class="bu">Math</span><span class="op">.</span><span class="fu">floor</span>(decDate <span class="op">/</span> <span class="dv">10</span>)</span>
<span id="cb84-2036"><a href="#cb84-2036" aria-hidden="true" tabindex="-1"></a>decDod <span class="op">=</span> decDate <span class="op">%</span> <span class="dv">10</span></span>
<span id="cb84-2037"><a href="#cb84-2037" aria-hidden="true" tabindex="-1"></a>decDotm <span class="op">=</span> <span class="bu">Math</span><span class="op">.</span><span class="fu">floor</span>(decDate <span class="op">-</span> (<span class="dv">153</span> <span class="op">*</span> decMoty <span class="op">+</span> <span class="dv">2</span>) <span class="op">/</span> <span class="dv">5</span> <span class="op">+</span> <span class="dv">1</span>)</span>
<span id="cb84-2038"><a href="#cb84-2038" aria-hidden="true" tabindex="-1"></a>selDote <span class="op">=</span> <span class="fu">unix2dote</span>(selectedDate<span class="op">.</span><span class="fu">getTime</span>() <span class="op">-</span> <span class="dv">86400000</span><span class="op">,</span> <span class="dv">0</span>)</span>
<span id="cb84-2039"><a href="#cb84-2039" aria-hidden="true" tabindex="-1"></a>selDate <span class="op">=</span> <span class="bu">Math</span><span class="op">.</span><span class="fu">floor</span>(<span class="fu">dote2date</span>(<span class="op">...</span>selDote)[<span class="dv">1</span>])</span>
<span id="cb84-2040"><a href="#cb84-2040" aria-hidden="true" tabindex="-1"></a>selTime <span class="op">=</span> selectedHour <span class="op">/</span> <span class="dv">24</span></span>
<span id="cb84-2041"><a href="#cb84-2041" aria-hidden="true" tabindex="-1"></a>selTimeOne <span class="op">=</span> selTime <span class="op">%</span> <span class="dv">1</span></span>
<span id="cb84-2042"><a href="#cb84-2042" aria-hidden="true" tabindex="-1"></a>selTimeTen <span class="op">=</span> selTime <span class="op">*</span> <span class="dv">10</span> <span class="op">%</span> <span class="dv">10</span></span>
<span id="cb84-2043"><a href="#cb84-2043" aria-hidden="true" tabindex="-1"></a>selYda <span class="op">=</span> selDate <span class="op">+</span> selTime</span>
<span id="cb84-2044"><a href="#cb84-2044" aria-hidden="true" tabindex="-1"></a>selLati <span class="op">=</span> <span class="fu">lati2turn</span>(location[<span class="dv">1</span>])</span>
<span id="cb84-2045"><a href="#cb84-2045" aria-hidden="true" tabindex="-1"></a>decDodHsl <span class="op">=</span> <span class="fu">textcolor</span>(decDod<span class="op">,</span> d3<span class="op">.</span><span class="fu">color</span>(<span class="fu">piecewiseColor</span>(decDod <span class="op">/</span> <span class="dv">10</span>))<span class="op">.</span><span class="fu">formatHex</span>())</span>
<span id="cb84-2046"><a href="#cb84-2046" aria-hidden="true" tabindex="-1"></a>decDateHsl <span class="op">=</span> <span class="fu">textcolor</span>(decDate<span class="op">.</span><span class="fu">toString</span>()<span class="op">.</span><span class="fu">padStart</span>(<span class="dv">3</span><span class="op">,</span> <span class="st">"0"</span>)<span class="op">,</span> d3<span class="op">.</span><span class="fu">color</span>(<span class="fu">piecewiseColor</span>(decDate <span class="op">/</span> (<span class="dv">365</span> <span class="op">+</span> <span class="fu">isLeapYear</span>(decYear))))<span class="op">.</span><span class="fu">formatHex</span>())</span>
<span id="cb84-2047"><a href="#cb84-2047" aria-hidden="true" tabindex="-1"></a>decTimeHsl <span class="op">=</span> <span class="fu">textcolor</span>(decTime<span class="op">,</span> d3<span class="op">.</span><span class="fu">color</span>(<span class="fu">piecewiseColor</span>(decTime <span class="op">/</span> <span class="dv">10</span>))<span class="op">.</span><span class="fu">formatHex</span>())</span>
<span id="cb84-2048"><a href="#cb84-2048" aria-hidden="true" tabindex="-1"></a>selDateHsl <span class="op">=</span> <span class="fu">textcolor</span>(selDate<span class="op">.</span><span class="fu">toString</span>()<span class="op">.</span><span class="fu">padStart</span>(<span class="dv">3</span><span class="op">,</span> <span class="st">"0"</span>)<span class="op">,</span> d3<span class="op">.</span><span class="fu">color</span>(<span class="fu">piecewiseColor</span>(selDate <span class="op">/</span> <span class="dv">365</span>))<span class="op">.</span><span class="fu">formatHex</span>())</span>
<span id="cb84-2049"><a href="#cb84-2049" aria-hidden="true" tabindex="-1"></a>selLatiHsl <span class="op">=</span> <span class="fu">textcolor</span>(selLati<span class="op">.</span><span class="fu">toFixed</span>(<span class="dv">0</span>)<span class="op">,</span> d3<span class="op">.</span><span class="fu">color</span>(<span class="fu">piecewiseColor</span>((selLati <span class="op">+</span> <span class="dv">250</span>) <span class="op">%</span> <span class="dv">250</span> <span class="op">/</span> <span class="dv">250</span>))<span class="op">.</span><span class="fu">formatHex</span>())</span>
<span id="cb84-2050"><a href="#cb84-2050" aria-hidden="true" tabindex="-1"></a>selTimeDay <span class="op">=</span> <span class="fu">textcolor</span>(selTimeOne<span class="op">.</span><span class="fu">toFixed</span>(<span class="dv">3</span>)<span class="op">.</span><span class="fu">slice</span>(<span class="dv">2</span>)<span class="op">,</span> d3<span class="op">.</span><span class="fu">color</span>(<span class="fu">piecewiseColor</span>(selTime))<span class="op">.</span><span class="fu">formatHex</span>())</span>
<span id="cb84-2051"><a href="#cb84-2051" aria-hidden="true" tabindex="-1"></a>selTimeHsl0 <span class="op">=</span> <span class="fu">textcolor</span>(selTimeTen<span class="op">.</span><span class="fu">toFixed</span>(<span class="dv">4</span>)<span class="op">,</span> d3<span class="op">.</span><span class="fu">color</span>(<span class="fu">piecewiseColor</span>(selTime))<span class="op">.</span><span class="fu">formatHex</span>())</span>
<span id="cb84-2052"><a href="#cb84-2052" aria-hidden="true" tabindex="-1"></a>selTimeHsl1 <span class="op">=</span> <span class="fu">textcolor</span>(selTimeTen<span class="op">.</span><span class="fu">toFixed</span>(<span class="dv">4</span>)<span class="op">,</span> d3<span class="op">.</span><span class="fu">color</span>(<span class="fu">piecewiseColor</span>(selTime))<span class="op">.</span><span class="fu">formatHex</span>())</span>
<span id="cb84-2053"><a href="#cb84-2053" aria-hidden="true" tabindex="-1"></a>selZoneHsl <span class="op">=</span> <span class="fu">textcolor</span>(selectedZone<span class="op">,</span> d3<span class="op">.</span><span class="fu">color</span>(<span class="fu">piecewiseColor</span>(selectedZone <span class="op">/</span> <span class="dv">10</span>))<span class="op">.</span><span class="fu">formatHex</span>())</span>
<span id="cb84-2054"><a href="#cb84-2054" aria-hidden="true" tabindex="-1"></a>selYdaDay <span class="op">=</span> <span class="fu">textcolor</span>(selYda<span class="op">.</span><span class="fu">toFixed</span>(<span class="dv">3</span>)<span class="op">.</span><span class="fu">padStart</span>(<span class="dv">6</span><span class="op">,</span> <span class="st">"0"</span>)<span class="op">,</span> d3<span class="op">.</span><span class="fu">color</span>(<span class="fu">piecewiseColor</span>(selYda <span class="op">/</span> <span class="dv">365</span>))<span class="op">.</span><span class="fu">formatHex</span>())</span>
<span id="cb84-2055"><a href="#cb84-2055" aria-hidden="true" tabindex="-1"></a>selYdaDec <span class="op">=</span> <span class="fu">textcolor</span>((selYda <span class="op">*</span> <span class="dv">10</span>)<span class="op">.</span><span class="fu">toFixed</span>(<span class="dv">4</span>)<span class="op">.</span><span class="fu">padStart</span>(<span class="dv">9</span><span class="op">,</span> <span class="st">"0"</span>)<span class="op">,</span> d3<span class="op">.</span><span class="fu">color</span>(<span class="fu">piecewiseColor</span>(selYda <span class="op">/</span> <span class="dv">365</span>))<span class="op">.</span><span class="fu">formatHex</span>())</span>
<span id="cb84-2056"><a href="#cb84-2056" aria-hidden="true" tabindex="-1"></a>decZoneHsl <span class="op">=</span> <span class="fu">textcolor</span>(selectedZone<span class="op">,</span> d3<span class="op">.</span><span class="fu">color</span>(<span class="fu">piecewiseColor</span>(selectedZone <span class="op">/</span> <span class="dv">10</span>))<span class="op">.</span><span class="fu">formatHex</span>())</span>
<span id="cb84-2057"><a href="#cb84-2057" aria-hidden="true" tabindex="-1"></a>viewof selectedDate <span class="op">=</span> Inputs<span class="op">.</span><span class="fu">input</span>(<span class="kw">new</span> <span class="bu">Date</span>(<span class="dv">2022</span><span class="op">,</span> <span class="kw">new</span> <span class="bu">Date</span>()<span class="op">.</span><span class="fu">getMonth</span>()<span class="op">,</span> <span class="kw">new</span> <span class="bu">Date</span>()<span class="op">.</span><span class="fu">getDate</span>()<span class="op">,</span> <span class="kw">new</span> <span class="bu">Date</span>()<span class="op">.</span><span class="fu">getHours</span>()))</span>
<span id="cb84-2058"><a href="#cb84-2058" aria-hidden="true" tabindex="-1"></a>viewof selectedHour <span class="op">=</span> Inputs<span class="op">.</span><span class="fu">input</span>(<span class="kw">new</span> <span class="bu">Date</span>(<span class="dv">2022</span><span class="op">,</span> <span class="kw">new</span> <span class="bu">Date</span>()<span class="op">.</span><span class="fu">getMonth</span>()<span class="op">,</span> <span class="kw">new</span> <span class="bu">Date</span>()<span class="op">.</span><span class="fu">getDate</span>()<span class="op">,</span> <span class="kw">new</span> <span class="bu">Date</span>()<span class="op">.</span><span class="fu">getHours</span>())<span class="op">.</span><span class="fu">getHours</span>())</span>
<span id="cb84-2059"><a href="#cb84-2059" aria-hidden="true" tabindex="-1"></a><span class="kw">function</span> <span class="fu">set</span>(input<span class="op">,</span> value) {</span>
<span id="cb84-2060"><a href="#cb84-2060" aria-hidden="true" tabindex="-1"></a>  input<span class="op">.</span><span class="at">value</span> <span class="op">=</span> value<span class="op">;</span></span>
<span id="cb84-2061"><a href="#cb84-2061" aria-hidden="true" tabindex="-1"></a>  input<span class="op">.</span><span class="fu">dispatchEvent</span>(<span class="kw">new</span> <span class="bu">Event</span>(<span class="st">"input"</span><span class="op">,</span> {<span class="dt">bubbles</span><span class="op">:</span> <span class="kw">true</span>}))<span class="op">;</span></span>
<span id="cb84-2062"><a href="#cb84-2062" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb84-2063"><a href="#cb84-2063" aria-hidden="true" tabindex="-1"></a>hD121 <span class="op">=</span> d3<span class="op">.</span><span class="fu">hsl</span>(<span class="fu">piecewiseColor</span>(<span class="dv">121</span> <span class="op">/</span> <span class="dv">365</span>))<span class="op">.</span><span class="at">h</span></span>
<span id="cb84-2064"><a href="#cb84-2064" aria-hidden="true" tabindex="-1"></a>hD268 <span class="op">=</span> d3<span class="op">.</span><span class="fu">hsl</span>(<span class="fu">piecewiseColor</span>(<span class="dv">268</span> <span class="op">/</span> <span class="dv">365</span>))<span class="op">.</span><span class="at">h</span></span>
<span id="cb84-2065"><a href="#cb84-2065" aria-hidden="true" tabindex="-1"></a>hD305 <span class="op">=</span> d3<span class="op">.</span><span class="fu">hsl</span>(<span class="fu">piecewiseColor</span>(<span class="dv">305</span> <span class="op">/</span> <span class="dv">365</span>))<span class="op">.</span><span class="at">h</span></span>
<span id="cb84-2066"><a href="#cb84-2066" aria-hidden="true" tabindex="-1"></a>hD306 <span class="op">=</span> d3<span class="op">.</span><span class="fu">hsl</span>(<span class="fu">piecewiseColor</span>(<span class="dv">306</span> <span class="op">/</span> <span class="dv">365</span>))<span class="op">.</span><span class="at">h</span></span>
<span id="cb84-2067"><a href="#cb84-2067" aria-hidden="true" tabindex="-1"></a>h1by320 <span class="op">=</span> d3<span class="op">.</span><span class="fu">hsl</span>(<span class="fu">piecewiseColor</span>(<span class="dv">1</span> <span class="op">/</span> <span class="dv">320</span>))<span class="op">.</span><span class="at">h</span></span>
<span id="cb84-2068"><a href="#cb84-2068" aria-hidden="true" tabindex="-1"></a>h1by8640 <span class="op">=</span> d3<span class="op">.</span><span class="fu">hsl</span>(<span class="fu">piecewiseColor</span>(<span class="dv">1</span> <span class="op">/</span> <span class="dv">8640</span>))<span class="op">.</span><span class="at">h</span></span>
<span id="cb84-2069"><a href="#cb84-2069" aria-hidden="true" tabindex="-1"></a>hues <span class="op">=</span> <span class="bu">Object</span><span class="op">.</span><span class="fu">fromEntries</span>([</span>
<span id="cb84-2070"><a href="#cb84-2070" aria-hidden="true" tabindex="-1"></a>  <span class="op">.</span><span class="dv">0083</span><span class="op">,</span></span>
<span id="cb84-2071"><a href="#cb84-2071" aria-hidden="true" tabindex="-1"></a>  <span class="op">.</span><span class="bn">0166</span><span class="op">,</span></span>
<span id="cb84-2072"><a href="#cb84-2072" aria-hidden="true" tabindex="-1"></a>  <span class="op">.</span><span class="dv">0229</span><span class="op">,</span></span>
<span id="cb84-2073"><a href="#cb84-2073" aria-hidden="true" tabindex="-1"></a>  <span class="op">.</span><span class="bn">025</span><span class="op">,</span></span>
<span id="cb84-2074"><a href="#cb84-2074" aria-hidden="true" tabindex="-1"></a>  <span class="op">.</span><span class="dv">287</span><span class="op">,</span></span>
<span id="cb84-2075"><a href="#cb84-2075" aria-hidden="true" tabindex="-1"></a>  <span class="op">.</span><span class="bn">0333</span><span class="op">,</span></span>
<span id="cb84-2076"><a href="#cb84-2076" aria-hidden="true" tabindex="-1"></a>  <span class="op">.</span><span class="bn">0416</span><span class="op">,</span></span>
<span id="cb84-2077"><a href="#cb84-2077" aria-hidden="true" tabindex="-1"></a>  <span class="op">.</span><span class="bn">05</span><span class="op">,</span></span>
<span id="cb84-2078"><a href="#cb84-2078" aria-hidden="true" tabindex="-1"></a>  <span class="op">.</span><span class="dv">125</span><span class="op">,</span></span>
<span id="cb84-2079"><a href="#cb84-2079" aria-hidden="true" tabindex="-1"></a>  <span class="op">.</span><span class="dv">333</span><span class="op">,</span></span>
<span id="cb84-2080"><a href="#cb84-2080" aria-hidden="true" tabindex="-1"></a>  <span class="op">.</span><span class="dv">375</span><span class="op">,</span></span>
<span id="cb84-2081"><a href="#cb84-2081" aria-hidden="true" tabindex="-1"></a>  <span class="op">.</span><span class="dv">429</span><span class="op">,</span></span>
<span id="cb84-2082"><a href="#cb84-2082" aria-hidden="true" tabindex="-1"></a>  <span class="op">.</span><span class="dv">533</span><span class="op">,</span></span>
<span id="cb84-2083"><a href="#cb84-2083" aria-hidden="true" tabindex="-1"></a>  <span class="op">.</span><span class="dv">969</span><span class="op">,</span></span>
<span id="cb84-2084"><a href="#cb84-2084" aria-hidden="true" tabindex="-1"></a>  <span class="op">.</span><span class="dv">999</span><span class="op">,</span></span>
<span id="cb84-2085"><a href="#cb84-2085" aria-hidden="true" tabindex="-1"></a>  ]<span class="op">.</span><span class="fu">map</span>(i <span class="kw">=&gt;</span> [i<span class="op">,</span> d3<span class="op">.</span><span class="fu">hsl</span>(<span class="fu">piecewiseColor</span>(i))<span class="op">.</span><span class="at">h</span>])</span>
<span id="cb84-2086"><a href="#cb84-2086" aria-hidden="true" tabindex="-1"></a>)<span class="op">;</span></span>
<span id="cb84-2087"><a href="#cb84-2087" aria-hidden="true" tabindex="-1"></a><span class="co">// https://observablehq.com/@mattdzugan/population-by-time-zone-creating-a-dataset</span></span>
<span id="cb84-2088"><a href="#cb84-2088" aria-hidden="true" tabindex="-1"></a>populationByTimeZone <span class="op">=</span> <span class="fu">FileAttachment</span>(<span class="st">"../../asset/populationByTimeZone.json"</span>)<span class="op">.</span><span class="fu">json</span>()<span class="op">;</span></span>
<span id="cb84-2089"><a href="#cb84-2089" aria-hidden="true" tabindex="-1"></a>sortedPop <span class="op">=</span> populationByTimeZone<span class="op">.</span><span class="fu">sort</span>(</span>
<span id="cb84-2090"><a href="#cb84-2090" aria-hidden="true" tabindex="-1"></a>  (a<span class="op">,</span> b) <span class="kw">=&gt;</span> sortParams[<span class="dv">1</span>] <span class="op">?</span> <span class="fu">sortFunc</span>(a<span class="op">.</span><span class="at">number</span><span class="op">,</span> b<span class="op">.</span><span class="at">number</span>) <span class="op">:</span> <span class="fu">sortFunc</span>(a<span class="op">.</span><span class="at">pop</span><span class="op">,</span> b<span class="op">.</span><span class="at">pop</span>)</span>
<span id="cb84-2091"><a href="#cb84-2091" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb84-2092"><a href="#cb84-2092" aria-hidden="true" tabindex="-1"></a>sortFunc <span class="op">=</span> sortParams[<span class="dv">0</span>] <span class="op">?</span> d3<span class="op">.</span><span class="at">ascending</span> <span class="op">:</span> d3<span class="op">.</span><span class="at">descending</span></span>
<span id="cb84-2093"><a href="#cb84-2093" aria-hidden="true" tabindex="-1"></a>popBySign <span class="op">=</span> d3<span class="op">.</span><span class="fu">rollup</span>(sortedPop<span class="op">,</span> v <span class="kw">=&gt;</span> d3<span class="op">.</span><span class="fu">sum</span>(v<span class="op">,</span> d <span class="kw">=&gt;</span> d<span class="op">.</span><span class="at">pop</span> <span class="op">/</span> <span class="fl">1e9</span>)<span class="op">,</span> d <span class="kw">=&gt;</span> d<span class="op">.</span><span class="at">Sign</span>)</span>
<span id="cb84-2094"><a href="#cb84-2094" aria-hidden="true" tabindex="-1"></a>totalPop <span class="op">=</span> d3<span class="op">.</span><span class="fu">sum</span>(sortedPop<span class="op">,</span> d <span class="kw">=&gt;</span> d<span class="op">.</span><span class="at">pop</span> <span class="op">/</span> <span class="fl">1e9</span>)</span>
<span id="cb84-2095"><a href="#cb84-2095" aria-hidden="true" tabindex="-1"></a>utcOffsetM <span class="op">=</span> <span class="op">-</span>(<span class="kw">new</span> <span class="bu">Date</span>)<span class="op">.</span><span class="fu">getTimezoneOffset</span>()</span>
<span id="cb84-2096"><a href="#cb84-2096" aria-hidden="true" tabindex="-1"></a>utcOffsetD <span class="op">=</span> utcOffsetM <span class="op">/</span> <span class="dv">144</span></span>
<span id="cb84-2097"><a href="#cb84-2097" aria-hidden="true" tabindex="-1"></a>utcOffsetP <span class="op">=</span> (utcOffsetD <span class="op">+</span> <span class="dv">10</span>) <span class="op">%</span> <span class="dv">10</span></span>
<span id="cb84-2098"><a href="#cb84-2098" aria-hidden="true" tabindex="-1"></a>decZone <span class="op">=</span> ydz[<span class="dv">2</span>]</span>
<span id="cb84-2099"><a href="#cb84-2099" aria-hidden="true" tabindex="-1"></a>decZonePos <span class="op">=</span> (decZone <span class="op">+</span> <span class="dv">10</span>) <span class="op">%</span> <span class="dv">10</span></span>
<span id="cb84-2100"><a href="#cb84-2100" aria-hidden="true" tabindex="-1"></a>utcOffDiff <span class="op">=</span> <span class="pp">parseFloat</span>((<span class="bu">Math</span><span class="op">.</span><span class="fu">round</span>(utcOffsetD) <span class="op">-</span> utcOffsetD)<span class="op">.</span><span class="fu">toFixed</span>(<span class="dv">2</span>))</span>
<span id="cb84-2101"><a href="#cb84-2101" aria-hidden="true" tabindex="-1"></a>utcOffHslM <span class="op">=</span> <span class="fu">textcolor</span>(utcOffsetM<span class="op">,</span> <span class="vs">`hsl(</span><span class="sc">${</span>d3<span class="op">.</span><span class="fu">hsl</span>(<span class="fu">piecewiseColor</span>(utcOffsetP <span class="op">/</span> <span class="dv">10</span>))<span class="op">.</span><span class="at">h</span><span class="sc">}</span><span class="vs">`</span> <span class="op">+</span> slStr)</span>
<span id="cb84-2102"><a href="#cb84-2102" aria-hidden="true" tabindex="-1"></a>utcOffHslD <span class="op">=</span> <span class="fu">textcolor</span>(<span class="pp">parseFloat</span>(utcOffsetD<span class="op">.</span><span class="fu">toFixed</span>(<span class="dv">2</span>))<span class="op">,</span> <span class="vs">`hsl(</span><span class="sc">${</span>d3<span class="op">.</span><span class="fu">hsl</span>(<span class="fu">piecewiseColor</span>(utcOffsetP <span class="op">/</span> <span class="dv">10</span>))<span class="op">.</span><span class="at">h</span><span class="sc">}</span><span class="vs">`</span> <span class="op">+</span> slStr)</span>
<span id="cb84-2103"><a href="#cb84-2103" aria-hidden="true" tabindex="-1"></a>decZonHslP <span class="op">=</span> <span class="fu">textcolor</span>(decZonePos<span class="op">,</span> <span class="vs">`hsl(</span><span class="sc">${</span>d3<span class="op">.</span><span class="fu">hsl</span>(<span class="fu">piecewiseColor</span>(decZonePos <span class="op">/</span> <span class="dv">10</span>))<span class="op">.</span><span class="at">h</span><span class="sc">}</span><span class="vs">`</span> <span class="op">+</span> slStr)</span>
<span id="cb84-2104"><a href="#cb84-2104" aria-hidden="true" tabindex="-1"></a>utcOffsetMdiffHsl <span class="op">=</span> <span class="fu">textcolor</span>(<span class="pp">parseFloat</span>((utcOffDiff <span class="op">*</span> <span class="dv">144</span>)<span class="op">.</span><span class="fu">toFixed</span>(<span class="dv">2</span>))<span class="op">,</span> <span class="vs">`hsl(</span><span class="sc">${</span>d3<span class="op">.</span><span class="fu">hsl</span>(<span class="fu">piecewiseColor</span>(utcOffDiff <span class="op">/</span> <span class="dv">10</span>))<span class="op">.</span><span class="at">h</span><span class="sc">}</span><span class="vs">`</span> <span class="op">+</span> slStr)</span>
<span id="cb84-2105"><a href="#cb84-2105" aria-hidden="true" tabindex="-1"></a>utcOffDiffHsl <span class="op">=</span> <span class="fu">textcolor</span>(utcOffDiff<span class="op">,</span> <span class="vs">`hsl(</span><span class="sc">${</span>d3<span class="op">.</span><span class="fu">hsl</span>(<span class="fu">piecewiseColor</span>(utcOffDiff <span class="op">/</span> <span class="dv">10</span>))<span class="op">.</span><span class="at">h</span><span class="sc">}</span><span class="vs">`</span> <span class="op">+</span> slStr)</span>
<span id="cb84-2106"><a href="#cb84-2106" aria-hidden="true" tabindex="-1"></a><span class="kw">function</span> <span class="fu">date2dote</span>(year <span class="op">=</span> <span class="dv">1969</span><span class="op">,</span> doty <span class="op">=</span> <span class="dv">306</span><span class="op">,</span> zone <span class="op">=</span> <span class="dv">0</span>) {</span>
<span id="cb84-2107"><a href="#cb84-2107" aria-hidden="true" tabindex="-1"></a>    <span class="kw">const</span> cote <span class="op">=</span> <span class="bu">Math</span><span class="op">.</span><span class="fu">floor</span>((year <span class="op">&gt;=</span> <span class="dv">0</span> <span class="op">?</span> year <span class="op">:</span> year <span class="op">-</span> <span class="dv">399</span>) <span class="op">/</span> <span class="dv">400</span>)<span class="op">,</span> yote <span class="op">=</span> year <span class="op">-</span> cote <span class="op">*</span> <span class="dv">400</span><span class="op">;</span></span>
<span id="cb84-2108"><a href="#cb84-2108" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> [cote <span class="op">*</span> <span class="dv">146097</span> <span class="op">+</span> yote <span class="op">*</span> <span class="dv">365</span> <span class="op">+</span> <span class="bu">Math</span><span class="op">.</span><span class="fu">floor</span>(yote <span class="op">/</span> <span class="dv">4</span>) <span class="op">-</span> <span class="bu">Math</span><span class="op">.</span><span class="fu">floor</span>(yote <span class="op">/</span> <span class="dv">100</span>) <span class="op">+</span> doty<span class="op">,</span> zone]</span>
<span id="cb84-2109"><a href="#cb84-2109" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb84-2110"><a href="#cb84-2110" aria-hidden="true" tabindex="-1"></a>leapSecondDotes <span class="op">=</span> [</span>
<span id="cb84-2111"><a href="#cb84-2111" aria-hidden="true" tabindex="-1"></a>  [<span class="dv">1972</span><span class="op">,</span> <span class="dv">121</span>]<span class="op">,</span></span>
<span id="cb84-2112"><a href="#cb84-2112" aria-hidden="true" tabindex="-1"></a>  [<span class="dv">1972</span><span class="op">,</span> <span class="dv">305</span>]<span class="op">,</span></span>
<span id="cb84-2113"><a href="#cb84-2113" aria-hidden="true" tabindex="-1"></a>  [<span class="dv">1973</span><span class="op">,</span> <span class="dv">305</span>]<span class="op">,</span></span>
<span id="cb84-2114"><a href="#cb84-2114" aria-hidden="true" tabindex="-1"></a>  [<span class="dv">1974</span><span class="op">,</span> <span class="dv">305</span>]<span class="op">,</span></span>
<span id="cb84-2115"><a href="#cb84-2115" aria-hidden="true" tabindex="-1"></a>  [<span class="dv">1975</span><span class="op">,</span> <span class="dv">305</span>]<span class="op">,</span></span>
<span id="cb84-2116"><a href="#cb84-2116" aria-hidden="true" tabindex="-1"></a>  [<span class="dv">1976</span><span class="op">,</span> <span class="dv">305</span>]<span class="op">,</span></span>
<span id="cb84-2117"><a href="#cb84-2117" aria-hidden="true" tabindex="-1"></a>  [<span class="dv">1977</span><span class="op">,</span> <span class="dv">305</span>]<span class="op">,</span></span>
<span id="cb84-2118"><a href="#cb84-2118" aria-hidden="true" tabindex="-1"></a>  [<span class="dv">1978</span><span class="op">,</span> <span class="dv">305</span>]<span class="op">,</span></span>
<span id="cb84-2119"><a href="#cb84-2119" aria-hidden="true" tabindex="-1"></a>  [<span class="dv">1979</span><span class="op">,</span> <span class="dv">305</span>]<span class="op">,</span></span>
<span id="cb84-2120"><a href="#cb84-2120" aria-hidden="true" tabindex="-1"></a>  [<span class="dv">1981</span><span class="op">,</span> <span class="dv">121</span>]<span class="op">,</span></span>
<span id="cb84-2121"><a href="#cb84-2121" aria-hidden="true" tabindex="-1"></a>  [<span class="dv">1982</span><span class="op">,</span> <span class="dv">121</span>]<span class="op">,</span></span>
<span id="cb84-2122"><a href="#cb84-2122" aria-hidden="true" tabindex="-1"></a>  [<span class="dv">1983</span><span class="op">,</span> <span class="dv">121</span>]<span class="op">,</span></span>
<span id="cb84-2123"><a href="#cb84-2123" aria-hidden="true" tabindex="-1"></a>  [<span class="dv">1985</span><span class="op">,</span> <span class="dv">121</span>]<span class="op">,</span></span>
<span id="cb84-2124"><a href="#cb84-2124" aria-hidden="true" tabindex="-1"></a>  [<span class="dv">1987</span><span class="op">,</span> <span class="dv">305</span>]<span class="op">,</span></span>
<span id="cb84-2125"><a href="#cb84-2125" aria-hidden="true" tabindex="-1"></a>  [<span class="dv">1989</span><span class="op">,</span> <span class="dv">305</span>]<span class="op">,</span></span>
<span id="cb84-2126"><a href="#cb84-2126" aria-hidden="true" tabindex="-1"></a>  [<span class="dv">1990</span><span class="op">,</span> <span class="dv">305</span>]<span class="op">,</span></span>
<span id="cb84-2127"><a href="#cb84-2127" aria-hidden="true" tabindex="-1"></a>  [<span class="dv">1992</span><span class="op">,</span> <span class="dv">121</span>]<span class="op">,</span></span>
<span id="cb84-2128"><a href="#cb84-2128" aria-hidden="true" tabindex="-1"></a>  [<span class="dv">1993</span><span class="op">,</span> <span class="dv">121</span>]<span class="op">,</span></span>
<span id="cb84-2129"><a href="#cb84-2129" aria-hidden="true" tabindex="-1"></a>  [<span class="dv">1994</span><span class="op">,</span> <span class="dv">121</span>]<span class="op">,</span></span>
<span id="cb84-2130"><a href="#cb84-2130" aria-hidden="true" tabindex="-1"></a>  [<span class="dv">1995</span><span class="op">,</span> <span class="dv">305</span>]<span class="op">,</span></span>
<span id="cb84-2131"><a href="#cb84-2131" aria-hidden="true" tabindex="-1"></a>  [<span class="dv">1997</span><span class="op">,</span> <span class="dv">121</span>]<span class="op">,</span></span>
<span id="cb84-2132"><a href="#cb84-2132" aria-hidden="true" tabindex="-1"></a>  [<span class="dv">1998</span><span class="op">,</span> <span class="dv">305</span>]<span class="op">,</span></span>
<span id="cb84-2133"><a href="#cb84-2133" aria-hidden="true" tabindex="-1"></a>  [<span class="dv">2005</span><span class="op">,</span> <span class="dv">305</span>]<span class="op">,</span></span>
<span id="cb84-2134"><a href="#cb84-2134" aria-hidden="true" tabindex="-1"></a>  [<span class="dv">2008</span><span class="op">,</span> <span class="dv">305</span>]<span class="op">,</span></span>
<span id="cb84-2135"><a href="#cb84-2135" aria-hidden="true" tabindex="-1"></a>  [<span class="dv">2012</span><span class="op">,</span> <span class="dv">121</span>]<span class="op">,</span></span>
<span id="cb84-2136"><a href="#cb84-2136" aria-hidden="true" tabindex="-1"></a>  [<span class="dv">2015</span><span class="op">,</span> <span class="dv">121</span>]<span class="op">,</span></span>
<span id="cb84-2137"><a href="#cb84-2137" aria-hidden="true" tabindex="-1"></a>  [<span class="dv">2016</span><span class="op">,</span> <span class="dv">305</span>]<span class="op">,</span></span>
<span id="cb84-2138"><a href="#cb84-2138" aria-hidden="true" tabindex="-1"></a>]<span class="op">.</span><span class="fu">map</span>(x <span class="kw">=&gt;</span> <span class="fu">date2dote</span>(<span class="op">...</span>x)[<span class="dv">0</span>])</span>
<span id="cb84-2139"><a href="#cb84-2139" aria-hidden="true" tabindex="-1"></a>leapSecondDote <span class="op">=</span> <span class="fu">date2dote</span>(leapSecondYear<span class="op">,</span> leapSecondDate)[<span class="dv">0</span>]</span>
<span id="cb84-2140"><a href="#cb84-2140" aria-hidden="true" tabindex="-1"></a>leapCount <span class="op">=</span> leapSecondDotes<span class="op">.</span><span class="fu">filter</span>(dote <span class="kw">=&gt;</span> leapSecondDote <span class="op">&gt;</span> dote)<span class="op">.</span><span class="at">length</span><span class="op">;</span></span>
<span id="cb84-2141"><a href="#cb84-2141" aria-hidden="true" tabindex="-1"></a>leapColor <span class="op">=</span> d3<span class="op">.</span><span class="fu">color</span>(<span class="fu">piecewiseColor</span>(leapCount <span class="op">/</span> <span class="dv">86400</span>))<span class="op">.</span><span class="fu">formatHex</span>()</span>
<span id="cb84-2142"><a href="#cb84-2142" aria-hidden="true" tabindex="-1"></a>leapCountHsl <span class="op">=</span> <span class="fu">textcolor</span>(leapCount<span class="op">,</span> leapColor)</span>
<span id="cb84-2143"><a href="#cb84-2143" aria-hidden="true" tabindex="-1"></a>frac <span class="op">=</span> <span class="pp">require</span>(<span class="st">"fraction.js"</span>)</span>
<span id="cb84-2144"><a href="#cb84-2144" aria-hidden="true" tabindex="-1"></a>leapFrac <span class="op">=</span> <span class="fu">frac</span>(leapCount)<span class="op">.</span><span class="fu">div</span>(<span class="dv">8640</span>)<span class="op">.</span><span class="fu">toFraction</span>()</span>
<span id="cb84-2145"><a href="#cb84-2145" aria-hidden="true" tabindex="-1"></a>leapTzoHsl0 <span class="op">=</span> <span class="fu">textcolor</span>(leapFrac<span class="op">,</span> leapColor)</span>
<span id="cb84-2146"><a href="#cb84-2146" aria-hidden="true" tabindex="-1"></a>leapTzoHsl1 <span class="op">=</span> <span class="fu">textcolor</span>(leapFrac<span class="op">,</span> leapColor)</span>
<span id="cb84-2147"><a href="#cb84-2147" aria-hidden="true" tabindex="-1"></a>leapTzoHsl2 <span class="op">=</span> <span class="fu">textcolor</span>(leapFrac<span class="op">,</span> leapColor)</span>
<span id="cb84-2148"><a href="#cb84-2148" aria-hidden="true" tabindex="-1"></a>hmsTzo <span class="op">=</span> <span class="fu">frac</span>(hmsinput[<span class="dv">0</span>])<span class="op">.</span><span class="fu">div</span>(<span class="dv">24</span>)<span class="op">.</span><span class="fu">add</span>(hmsinput[<span class="dv">1</span>]<span class="op">,</span> <span class="dv">1440</span>)<span class="op">.</span><span class="fu">add</span>(hmsinput[<span class="dv">2</span>]<span class="op">,</span> <span class="dv">86400</span>)<span class="op">.</span><span class="fu">mod</span>(<span class="dv">1</span>)</span>
<span id="cb84-2149"><a href="#cb84-2149" aria-hidden="true" tabindex="-1"></a>hmsTzox10 <span class="op">=</span> hmsTzo<span class="op">.</span><span class="fu">mul</span>(<span class="dv">10</span>)</span>
<span id="cb84-2150"><a href="#cb84-2150" aria-hidden="true" tabindex="-1"></a>pluralx10 <span class="op">=</span> hmsTzox10<span class="op">.</span><span class="fu">equals</span>(<span class="dv">1</span>) <span class="op">?</span> <span class="st">""</span> <span class="op">:</span> <span class="st">"s"</span></span>
<span id="cb84-2151"><a href="#cb84-2151" aria-hidden="true" tabindex="-1"></a>hmsRounded <span class="op">=</span> hmsTzox10<span class="op">.</span><span class="fu">round</span>(digits <span class="op">-</span> <span class="dv">1</span>)</span>
<span id="cb84-2152"><a href="#cb84-2152" aria-hidden="true" tabindex="-1"></a>hmsRef <span class="op">=</span> hmsRounded<span class="op">.</span><span class="fu">sub</span>(hmsTzox10)</span>
<span id="cb84-2153"><a href="#cb84-2153" aria-hidden="true" tabindex="-1"></a>hmsRefHsl <span class="op">=</span> <span class="fu">textcolor</span>(hmsRef<span class="op">.</span><span class="fu">abs</span>()<span class="op">.</span><span class="fu">toFraction</span>()<span class="op">,</span> d3<span class="op">.</span><span class="fu">color</span>(<span class="fu">piecewiseColor</span>(<span class="bu">Number</span>(hmsRef<span class="op">.</span><span class="fu">div</span>(<span class="dv">10</span>))))<span class="op">.</span><span class="fu">formatHex</span>())</span>
<span id="cb84-2154"><a href="#cb84-2154" aria-hidden="true" tabindex="-1"></a>hmsRefSign <span class="op">=</span> hmsRef<span class="op">.</span><span class="fu">lt</span>(<span class="dv">0</span>) <span class="op">?</span> <span class="st">"-"</span> <span class="op">:</span> <span class="st">"+"</span></span>
<span id="cb84-2155"><a href="#cb84-2155" aria-hidden="true" tabindex="-1"></a>hmsTzoHsl <span class="op">=</span> <span class="fu">textcolor</span>(hmsTzox10<span class="op">.</span><span class="fu">toFraction</span>()<span class="op">,</span> d3<span class="op">.</span><span class="fu">color</span>(<span class="fu">piecewiseColor</span>(<span class="bu">Number</span>(hmsTzo)))<span class="op">.</span><span class="fu">formatHex</span>())</span>
<span id="cb84-2156"><a href="#cb84-2156" aria-hidden="true" tabindex="-1"></a>hmsRodHsl <span class="op">=</span> <span class="fu">textcolor</span>(hmsRounded<span class="op">,</span> d3<span class="op">.</span><span class="fu">color</span>(<span class="fu">piecewiseColor</span>(<span class="bu">Number</span>(hmsRounded<span class="op">.</span><span class="fu">div</span>(<span class="dv">10</span>))))<span class="op">.</span><span class="fu">formatHex</span>())</span>
<span id="cb84-2157"><a href="#cb84-2157" aria-hidden="true" tabindex="-1"></a>hmsTod <span class="op">=</span> (zeroTime <span class="op">+</span> hmsTzo) <span class="op">%</span> <span class="dv">1</span></span>
<span id="cb84-2158"><a href="#cb84-2158" aria-hidden="true" tabindex="-1"></a>hmsTodHsl <span class="op">=</span> <span class="fu">textcolor</span>((hmsTod <span class="op">*</span> <span class="dv">10</span>)<span class="op">.</span><span class="fu">toFixed</span>(<span class="dv">4</span>)<span class="op">,</span> d3<span class="op">.</span><span class="fu">color</span>(<span class="fu">piecewiseColor</span>(hmsTod))<span class="op">.</span><span class="fu">formatHex</span>())</span>
<span id="cb84-2159"><a href="#cb84-2159" aria-hidden="true" tabindex="-1"></a>leapTod <span class="op">=</span> (zeroTime <span class="op">+</span> leapCount <span class="op">/</span> <span class="dv">86400</span>) <span class="op">%</span> <span class="dv">1</span></span>
<span id="cb84-2160"><a href="#cb84-2160" aria-hidden="true" tabindex="-1"></a>leapDecidayTod <span class="op">=</span> (leapTod <span class="op">*</span> <span class="dv">10</span>)<span class="op">.</span><span class="fu">toFixed</span>(<span class="dv">4</span>)</span>
<span id="cb84-2161"><a href="#cb84-2161" aria-hidden="true" tabindex="-1"></a>leapTodHsl0 <span class="op">=</span> <span class="fu">textcolor</span>(leapDecidayTod<span class="op">,</span> d3<span class="op">.</span><span class="fu">color</span>(<span class="fu">piecewiseColor</span>(leapTod))<span class="op">.</span><span class="fu">formatHex</span>())</span>
<span id="cb84-2162"><a href="#cb84-2162" aria-hidden="true" tabindex="-1"></a>leapTodHsl1 <span class="op">=</span> <span class="fu">textcolor</span>(leapDecidayTod<span class="op">,</span> d3<span class="op">.</span><span class="fu">color</span>(<span class="fu">piecewiseColor</span>(leapTod))<span class="op">.</span><span class="fu">formatHex</span>())</span>
<span id="cb84-2163"><a href="#cb84-2163" aria-hidden="true" tabindex="-1"></a>longInputHsl <span class="op">=</span> <span class="fu">textcolor</span>(lonInput<span class="op">,</span> d3<span class="op">.</span><span class="fu">color</span>(<span class="fu">piecewiseColor</span>(lonInput <span class="op">/</span> <span class="dv">10</span>))<span class="op">.</span><span class="fu">formatHex</span>())</span>
<span id="cb84-2164"><a href="#cb84-2164" aria-hidden="true" tabindex="-1"></a>eot <span class="op">=</span> <span class="fu">getEot</span>(leapSecondDate)</span>
<span id="cb84-2165"><a href="#cb84-2165" aria-hidden="true" tabindex="-1"></a>astTzo <span class="op">=</span> eot <span class="op">+</span> lonInput</span>
<span id="cb84-2166"><a href="#cb84-2166" aria-hidden="true" tabindex="-1"></a>astTzoHsl <span class="op">=</span> <span class="fu">textcolor</span>(astTzo<span class="op">.</span><span class="fu">toFixed</span>(<span class="dv">4</span>)<span class="op">,</span> d3<span class="op">.</span><span class="fu">color</span>(<span class="fu">piecewiseColor</span>(astTzo <span class="op">/</span> <span class="dv">10</span>))<span class="op">.</span><span class="fu">formatHex</span>())</span>
<span id="cb84-2167"><a href="#cb84-2167" aria-hidden="true" tabindex="-1"></a>eotHsl <span class="op">=</span> <span class="fu">textcolor</span>(eot<span class="op">.</span><span class="fu">toFixed</span>(<span class="dv">4</span>)<span class="op">,</span> d3<span class="op">.</span><span class="fu">color</span>(<span class="fu">piecewiseColor</span>(eot <span class="op">/</span> <span class="dv">10</span>))<span class="op">.</span><span class="fu">formatHex</span>())</span>
<span id="cb84-2168"><a href="#cb84-2168" aria-hidden="true" tabindex="-1"></a>eotSum <span class="op">=</span> (zeroTime <span class="op">+</span> astTzo <span class="op">+</span> <span class="dv">10</span>) <span class="op">%</span> <span class="dv">10</span></span>
<span id="cb84-2169"><a href="#cb84-2169" aria-hidden="true" tabindex="-1"></a>eotSumHsl <span class="op">=</span> <span class="fu">textcolor</span>(eotSum<span class="op">.</span><span class="fu">toFixed</span>(<span class="dv">4</span>)<span class="op">,</span> d3<span class="op">.</span><span class="fu">color</span>(<span class="fu">piecewiseColor</span>(eotSum <span class="op">/</span> <span class="dv">10</span>))<span class="op">.</span><span class="fu">formatHex</span>())</span>
<span id="cb84-2170"><a href="#cb84-2170" aria-hidden="true" tabindex="-1"></a><span class="co">// https://observablehq.com/@mcmcclur/adaptive-plotter</span></span>
<span id="cb84-2171"><a href="#cb84-2171" aria-hidden="true" tabindex="-1"></a><span class="kw">function</span> <span class="fu">build_samples</span>(f<span class="op">,</span> a<span class="op">,</span> b<span class="op">,</span> opts <span class="op">=</span> {}) {</span>
<span id="cb84-2172"><a href="#cb84-2172" aria-hidden="true" tabindex="-1"></a>  <span class="kw">let</span> { N <span class="op">=</span> <span class="dv">9</span><span class="op">,</span> max_depth <span class="op">=</span> <span class="dv">6</span> } <span class="op">=</span> opts<span class="op">;</span></span>
<span id="cb84-2173"><a href="#cb84-2173" aria-hidden="true" tabindex="-1"></a>  <span class="kw">let</span> dx <span class="op">=</span> (b <span class="op">-</span> a) <span class="op">/</span> N<span class="op">;</span></span>
<span id="cb84-2174"><a href="#cb84-2174" aria-hidden="true" tabindex="-1"></a>  <span class="kw">let</span> root_intervals <span class="op">=</span> <span class="bu">Array</span><span class="op">.</span><span class="fu">from</span>({ <span class="dt">length</span><span class="op">:</span> N })<span class="op">.</span><span class="fu">map</span>(</span>
<span id="cb84-2175"><a href="#cb84-2175" aria-hidden="true" tabindex="-1"></a>    (_<span class="op">,</span> i) <span class="kw">=&gt;</span> <span class="kw">new</span> <span class="fu">Interval</span>(a <span class="op">+</span> i <span class="op">*</span> dx<span class="op">,</span> a <span class="op">+</span> (i <span class="op">+</span> <span class="dv">1</span>) <span class="op">*</span> dx<span class="op">,</span> <span class="dv">0</span>)</span>
<span id="cb84-2176"><a href="#cb84-2176" aria-hidden="true" tabindex="-1"></a>  )<span class="op">;</span></span>
<span id="cb84-2177"><a href="#cb84-2177" aria-hidden="true" tabindex="-1"></a>  root_intervals<span class="op">.</span><span class="fu">forEach</span>((I) <span class="kw">=&gt;</span> {</span>
<span id="cb84-2178"><a href="#cb84-2178" aria-hidden="true" tabindex="-1"></a>    I<span class="op">.</span><span class="at">fa</span> <span class="op">=</span> <span class="fu">f</span>(I<span class="op">.</span><span class="at">a</span>)<span class="op">;</span></span>
<span id="cb84-2179"><a href="#cb84-2179" aria-hidden="true" tabindex="-1"></a>    I<span class="op">.</span><span class="at">fb</span> <span class="op">=</span> <span class="fu">f</span>(I<span class="op">.</span><span class="at">b</span>)<span class="op">;</span></span>
<span id="cb84-2180"><a href="#cb84-2180" aria-hidden="true" tabindex="-1"></a>  })<span class="op">;</span></span>
<span id="cb84-2181"><a href="#cb84-2181" aria-hidden="true" tabindex="-1"></a>  root_intervals<span class="op">.</span><span class="fu">reverse</span>()<span class="op">;</span></span>
<span id="cb84-2182"><a href="#cb84-2182" aria-hidden="true" tabindex="-1"></a>  <span class="kw">let</span> stack <span class="op">=</span> root_intervals<span class="op">;</span></span>
<span id="cb84-2183"><a href="#cb84-2183" aria-hidden="true" tabindex="-1"></a>  <span class="kw">let</span> cnt <span class="op">=</span> <span class="dv">0</span><span class="op">;</span></span>
<span id="cb84-2184"><a href="#cb84-2184" aria-hidden="true" tabindex="-1"></a>  <span class="kw">let</span> pts <span class="op">=</span> []<span class="op">;</span></span>
<span id="cb84-2185"><a href="#cb84-2185" aria-hidden="true" tabindex="-1"></a>  <span class="kw">let</span> nodeRight<span class="op">,</span> nodeLeft<span class="op">;</span></span>
<span id="cb84-2186"><a href="#cb84-2186" aria-hidden="true" tabindex="-1"></a>  <span class="cf">while</span> (stack<span class="op">.</span><span class="at">length</span> <span class="op">&gt;</span> <span class="dv">0</span> <span class="op">&amp;&amp;</span> cnt<span class="op">++</span> <span class="op">&lt;</span> <span class="dv">100000</span>) {</span>
<span id="cb84-2187"><a href="#cb84-2187" aria-hidden="true" tabindex="-1"></a>    <span class="kw">let</span> node <span class="op">=</span> stack<span class="op">.</span><span class="fu">pop</span>()<span class="op">;</span></span>
<span id="cb84-2188"><a href="#cb84-2188" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> (<span class="fu">test</span>(f<span class="op">,</span> node<span class="op">,</span> opts)) {</span>
<span id="cb84-2189"><a href="#cb84-2189" aria-hidden="true" tabindex="-1"></a>      <span class="kw">let</span> midpoint <span class="op">=</span> node<span class="op">.</span><span class="at">midpoint</span><span class="op">;</span></span>
<span id="cb84-2190"><a href="#cb84-2190" aria-hidden="true" tabindex="-1"></a>      <span class="kw">let</span> new_depth <span class="op">=</span> node<span class="op">.</span><span class="at">depth</span> <span class="op">+</span> <span class="dv">1</span><span class="op">;</span></span>
<span id="cb84-2191"><a href="#cb84-2191" aria-hidden="true" tabindex="-1"></a>      <span class="cf">if</span> (new_depth <span class="op">&lt;=</span> max_depth) {</span>
<span id="cb84-2192"><a href="#cb84-2192" aria-hidden="true" tabindex="-1"></a>        <span class="kw">let</span> a_left <span class="op">=</span> node<span class="op">.</span><span class="at">a</span><span class="op">;</span></span>
<span id="cb84-2193"><a href="#cb84-2193" aria-hidden="true" tabindex="-1"></a>        <span class="kw">let</span> b_left <span class="op">=</span> midpoint<span class="op">;</span></span>
<span id="cb84-2194"><a href="#cb84-2194" aria-hidden="true" tabindex="-1"></a>        nodeLeft <span class="op">=</span> <span class="kw">new</span> <span class="fu">Interval</span>(a_left<span class="op">,</span> b_left<span class="op">,</span> new_depth)<span class="op">;</span></span>
<span id="cb84-2195"><a href="#cb84-2195" aria-hidden="true" tabindex="-1"></a>        nodeLeft<span class="op">.</span><span class="at">fa</span> <span class="op">=</span> <span class="fu">f</span>(a_left)<span class="op">;</span></span>
<span id="cb84-2196"><a href="#cb84-2196" aria-hidden="true" tabindex="-1"></a>        nodeLeft<span class="op">.</span><span class="at">fb</span> <span class="op">=</span> <span class="fu">f</span>(b_left)<span class="op">;</span></span>
<span id="cb84-2197"><a href="#cb84-2197" aria-hidden="true" tabindex="-1"></a>        node<span class="op">.</span><span class="at">left</span> <span class="op">=</span> nodeLeft<span class="op">;</span></span>
<span id="cb84-2198"><a href="#cb84-2198" aria-hidden="true" tabindex="-1"></a>        <span class="kw">let</span> a_right <span class="op">=</span> midpoint<span class="op">;</span></span>
<span id="cb84-2199"><a href="#cb84-2199" aria-hidden="true" tabindex="-1"></a>        <span class="kw">let</span> b_right <span class="op">=</span> node<span class="op">.</span><span class="at">b</span><span class="op">;</span></span>
<span id="cb84-2200"><a href="#cb84-2200" aria-hidden="true" tabindex="-1"></a>        nodeRight <span class="op">=</span> <span class="kw">new</span> <span class="fu">Interval</span>(a_right<span class="op">,</span> b_right<span class="op">,</span> new_depth)<span class="op">;</span></span>
<span id="cb84-2201"><a href="#cb84-2201" aria-hidden="true" tabindex="-1"></a>        nodeRight<span class="op">.</span><span class="at">fa</span> <span class="op">=</span> <span class="fu">f</span>(a_left)<span class="op">;</span></span>
<span id="cb84-2202"><a href="#cb84-2202" aria-hidden="true" tabindex="-1"></a>        nodeRight<span class="op">.</span><span class="at">fb</span> <span class="op">=</span> <span class="fu">f</span>(b_left)<span class="op">;</span></span>
<span id="cb84-2203"><a href="#cb84-2203" aria-hidden="true" tabindex="-1"></a>        node<span class="op">.</span><span class="at">right</span> <span class="op">=</span> nodeRight<span class="op">;</span></span>
<span id="cb84-2204"><a href="#cb84-2204" aria-hidden="true" tabindex="-1"></a>        stack<span class="op">.</span><span class="fu">push</span>(nodeRight)<span class="op">;</span></span>
<span id="cb84-2205"><a href="#cb84-2205" aria-hidden="true" tabindex="-1"></a>        stack<span class="op">.</span><span class="fu">push</span>(nodeLeft)<span class="op">;</span></span>
<span id="cb84-2206"><a href="#cb84-2206" aria-hidden="true" tabindex="-1"></a>      } <span class="cf">else</span> {</span>
<span id="cb84-2207"><a href="#cb84-2207" aria-hidden="true" tabindex="-1"></a>        pts<span class="op">.</span><span class="fu">push</span>(node<span class="op">.</span><span class="at">a</span>)<span class="op">;</span></span>
<span id="cb84-2208"><a href="#cb84-2208" aria-hidden="true" tabindex="-1"></a>      }</span>
<span id="cb84-2209"><a href="#cb84-2209" aria-hidden="true" tabindex="-1"></a>    } <span class="cf">else</span> {</span>
<span id="cb84-2210"><a href="#cb84-2210" aria-hidden="true" tabindex="-1"></a>      pts<span class="op">.</span><span class="fu">push</span>(node<span class="op">.</span><span class="at">a</span>)<span class="op">;</span></span>
<span id="cb84-2211"><a href="#cb84-2211" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb84-2212"><a href="#cb84-2212" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb84-2213"><a href="#cb84-2213" aria-hidden="true" tabindex="-1"></a>  pts<span class="op">.</span><span class="fu">push</span>(b)<span class="op">;</span></span>
<span id="cb84-2214"><a href="#cb84-2214" aria-hidden="true" tabindex="-1"></a>  <span class="co">//  pts = pts.map(x =&gt; ({ x: x, y: f(x) }));</span></span>
<span id="cb84-2215"><a href="#cb84-2215" aria-hidden="true" tabindex="-1"></a>  pts <span class="op">=</span> pts<span class="op">.</span><span class="fu">map</span>((x) <span class="kw">=&gt;</span> [x<span class="op">,</span> <span class="fu">f</span>(x)])<span class="op">;</span></span>
<span id="cb84-2216"><a href="#cb84-2216" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (opts<span class="op">.</span><span class="at">show_roots</span>) {</span>
<span id="cb84-2217"><a href="#cb84-2217" aria-hidden="true" tabindex="-1"></a>    <span class="kw">let</span> function_roots <span class="op">=</span> []<span class="op">;</span></span>
<span id="cb84-2218"><a href="#cb84-2218" aria-hidden="true" tabindex="-1"></a>    pts<span class="op">.</span><span class="fu">forEach</span>(<span class="kw">function</span> (o<span class="op">,</span> i) {</span>
<span id="cb84-2219"><a href="#cb84-2219" aria-hidden="true" tabindex="-1"></a>      <span class="cf">if</span> (i <span class="op">&lt;</span> pts<span class="op">.</span><span class="at">length</span> <span class="op">-</span> <span class="dv">1</span> <span class="op">&amp;&amp;</span> <span class="bu">Math</span><span class="op">.</span><span class="fu">sign</span>(o<span class="op">.</span><span class="at">y</span>) <span class="op">!=</span> <span class="bu">Math</span><span class="op">.</span><span class="fu">sign</span>(pts[i <span class="op">+</span> <span class="dv">1</span>]<span class="op">.</span><span class="at">y</span>)) {</span>
<span id="cb84-2220"><a href="#cb84-2220" aria-hidden="true" tabindex="-1"></a>        function_roots<span class="op">.</span><span class="fu">push</span>((o<span class="op">.</span><span class="at">x</span> <span class="op">+</span> pts[i <span class="op">+</span> <span class="dv">1</span>]<span class="op">.</span><span class="at">x</span>) <span class="op">/</span> <span class="dv">2</span>)<span class="op">;</span></span>
<span id="cb84-2221"><a href="#cb84-2221" aria-hidden="true" tabindex="-1"></a>      }</span>
<span id="cb84-2222"><a href="#cb84-2222" aria-hidden="true" tabindex="-1"></a>    })<span class="op">;</span></span>
<span id="cb84-2223"><a href="#cb84-2223" aria-hidden="true" tabindex="-1"></a>    pts<span class="op">.</span><span class="at">function_roots</span> <span class="op">=</span> function_roots<span class="op">;</span></span>
<span id="cb84-2224"><a href="#cb84-2224" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb84-2225"><a href="#cb84-2225" aria-hidden="true" tabindex="-1"></a>  <span class="cf">return</span> pts<span class="op">;</span></span>
<span id="cb84-2226"><a href="#cb84-2226" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb84-2227"><a href="#cb84-2227" aria-hidden="true" tabindex="-1"></a><span class="kw">function</span> <span class="fu">test</span>(f<span class="op">,</span> I<span class="op">,</span> opts <span class="op">=</span> {}) {</span>
<span id="cb84-2228"><a href="#cb84-2228" aria-hidden="true" tabindex="-1"></a>  <span class="kw">let</span> { angle_tolerance <span class="op">=</span> <span class="fl">0.01</span><span class="op">,</span> check_roots <span class="op">=</span> <span class="kw">false</span> } <span class="op">=</span> opts<span class="op">;</span></span>
<span id="cb84-2229"><a href="#cb84-2229" aria-hidden="true" tabindex="-1"></a>  <span class="kw">let</span> a <span class="op">=</span> I<span class="op">.</span><span class="at">a</span><span class="op">;</span></span>
<span id="cb84-2230"><a href="#cb84-2230" aria-hidden="true" tabindex="-1"></a>  <span class="kw">let</span> b <span class="op">=</span> I<span class="op">.</span><span class="at">b</span><span class="op">;</span></span>
<span id="cb84-2231"><a href="#cb84-2231" aria-hidden="true" tabindex="-1"></a>  <span class="kw">let</span> dx2 <span class="op">=</span> (b <span class="op">-</span> a) <span class="op">/</span> <span class="dv">2</span><span class="op">;</span></span>
<span id="cb84-2232"><a href="#cb84-2232" aria-hidden="true" tabindex="-1"></a>  <span class="kw">let</span> m <span class="op">=</span> (a <span class="op">+</span> b) <span class="op">/</span> <span class="dv">2</span><span class="op">;</span></span>
<span id="cb84-2233"><a href="#cb84-2233" aria-hidden="true" tabindex="-1"></a>  <span class="kw">let</span> fm <span class="op">=</span> <span class="fu">f</span>(m)<span class="op">;</span></span>
<span id="cb84-2234"><a href="#cb84-2234" aria-hidden="true" tabindex="-1"></a>  I<span class="op">.</span><span class="at">midpoint</span> <span class="op">=</span> m<span class="op">;</span></span>
<span id="cb84-2235"><a href="#cb84-2235" aria-hidden="true" tabindex="-1"></a>  I<span class="op">.</span><span class="at">f_mid</span> <span class="op">=</span> fm<span class="op">;</span></span>
<span id="cb84-2236"><a href="#cb84-2236" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (check_roots <span class="op">&amp;&amp;</span> <span class="bu">Math</span><span class="op">.</span><span class="fu">sign</span>(I<span class="op">.</span><span class="at">fa</span>) <span class="op">!=</span> <span class="bu">Math</span><span class="op">.</span><span class="fu">sign</span>(I<span class="op">.</span><span class="at">fb</span>)) {</span>
<span id="cb84-2237"><a href="#cb84-2237" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> <span class="kw">true</span><span class="op">;</span></span>
<span id="cb84-2238"><a href="#cb84-2238" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb84-2239"><a href="#cb84-2239" aria-hidden="true" tabindex="-1"></a>  <span class="kw">let</span> alpha <span class="op">=</span> <span class="bu">Math</span><span class="op">.</span><span class="fu">atan</span>((I<span class="op">.</span><span class="at">f_mid</span> <span class="op">-</span> I<span class="op">.</span><span class="at">fa</span>) <span class="op">/</span> dx2)<span class="op">;</span></span>
<span id="cb84-2240"><a href="#cb84-2240" aria-hidden="true" tabindex="-1"></a>  <span class="kw">let</span> beta <span class="op">=</span> <span class="bu">Math</span><span class="op">.</span><span class="fu">atan</span>((I<span class="op">.</span><span class="at">fb</span> <span class="op">-</span> I<span class="op">.</span><span class="at">f_mid</span>) <span class="op">/</span> dx2)<span class="op">;</span></span>
<span id="cb84-2241"><a href="#cb84-2241" aria-hidden="true" tabindex="-1"></a>  <span class="cf">return</span> <span class="bu">Math</span><span class="op">.</span><span class="fu">abs</span>(alpha <span class="op">-</span> beta) <span class="op">&gt;</span> angle_tolerance<span class="op">;</span></span>
<span id="cb84-2242"><a href="#cb84-2242" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb84-2243"><a href="#cb84-2243" aria-hidden="true" tabindex="-1"></a><span class="kw">class</span> Interval {</span>
<span id="cb84-2244"><a href="#cb84-2244" aria-hidden="true" tabindex="-1"></a>  <span class="fu">constructor</span>(a<span class="op">,</span> b<span class="op">,</span> depth) {</span>
<span id="cb84-2245"><a href="#cb84-2245" aria-hidden="true" tabindex="-1"></a>    <span class="kw">this</span><span class="op">.</span><span class="at">a</span> <span class="op">=</span> a<span class="op">;</span></span>
<span id="cb84-2246"><a href="#cb84-2246" aria-hidden="true" tabindex="-1"></a>    <span class="kw">this</span><span class="op">.</span><span class="at">b</span> <span class="op">=</span> b<span class="op">;</span></span>
<span id="cb84-2247"><a href="#cb84-2247" aria-hidden="true" tabindex="-1"></a>    <span class="kw">this</span><span class="op">.</span><span class="at">depth</span> <span class="op">=</span> depth<span class="op">;</span></span>
<span id="cb84-2248"><a href="#cb84-2248" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb84-2249"><a href="#cb84-2249" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb84-2250"><a href="#cb84-2250" aria-hidden="true" tabindex="-1"></a>colors <span class="op">=</span> ({</span>
<span id="cb84-2251"><a href="#cb84-2251" aria-hidden="true" tabindex="-1"></a>  <span class="dt">night</span><span class="op">:</span> <span class="st">"#719fb6"</span><span class="op">,</span></span>
<span id="cb84-2252"><a href="#cb84-2252" aria-hidden="true" tabindex="-1"></a>  <span class="dt">day</span><span class="op">:</span> <span class="st">"#ffe438"</span><span class="op">,</span></span>
<span id="cb84-2253"><a href="#cb84-2253" aria-hidden="true" tabindex="-1"></a>  <span class="dt">grid</span><span class="op">:</span> <span class="st">"#4b6a79"</span><span class="op">,</span></span>
<span id="cb84-2254"><a href="#cb84-2254" aria-hidden="true" tabindex="-1"></a>  <span class="dt">ocean</span><span class="op">:</span> <span class="st">"lightblue"</span><span class="op">,</span></span>
<span id="cb84-2255"><a href="#cb84-2255" aria-hidden="true" tabindex="-1"></a>  <span class="dt">land</span><span class="op">:</span> <span class="st">"#f5f1dc"</span><span class="op">,</span></span>
<span id="cb84-2256"><a href="#cb84-2256" aria-hidden="true" tabindex="-1"></a>  <span class="dt">sun</span><span class="op">:</span> <span class="st">"#ffe438"</span></span>
<span id="cb84-2257"><a href="#cb84-2257" aria-hidden="true" tabindex="-1"></a>})</span>
<span id="cb84-2258"><a href="#cb84-2258" aria-hidden="true" tabindex="-1"></a><span class="co">// https://observablehq.com/@parlant/editable-table</span></span>
<span id="cb84-2259"><a href="#cb84-2259" aria-hidden="true" tabindex="-1"></a><span class="kw">function</span> <span class="fu">createTable</span>(data<span class="op">,</span> options) {</span>
<span id="cb84-2260"><a href="#cb84-2260" aria-hidden="true" tabindex="-1"></a>  <span class="kw">let</span> table <span class="op">=</span> <span class="fu">html</span><span class="vs">`&lt;table class="editable-table"&gt;&lt;/table&gt;`</span><span class="op">;</span></span>
<span id="cb84-2261"><a href="#cb84-2261" aria-hidden="true" tabindex="-1"></a>  table<span class="op">.</span><span class="at">innerHTML</span> <span class="op">=</span> xss<span class="op">.</span><span class="fu">filterXSS</span>(tableify<span class="op">.</span><span class="fu">default</span>(data))<span class="op">;</span></span>
<span id="cb84-2262"><a href="#cb84-2262" aria-hidden="true" tabindex="-1"></a>  <span class="fu">makeTableEditable</span>(table<span class="op">,</span> options)<span class="op">;</span></span>
<span id="cb84-2263"><a href="#cb84-2263" aria-hidden="true" tabindex="-1"></a>  <span class="cf">return</span> table<span class="op">;</span></span>
<span id="cb84-2264"><a href="#cb84-2264" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb84-2265"><a href="#cb84-2265" aria-hidden="true" tabindex="-1"></a>table<span class="op">.</span><span class="fu">setAttribute</span>(<span class="st">"class"</span><span class="op">,</span> <span class="st">"table"</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-display hidden">
<div>
<div id="ojs-cell-25-100" data-nodetype="declaration">

</div>
</div>
</div>
<div class="cell-output cell-output-display hidden">
<div>
<div id="ojs-cell-25-101" data-nodetype="declaration">

</div>
</div>
</div>
<div class="cell-output cell-output-display hidden">
<div>
<div id="ojs-cell-25-102" data-nodetype="declaration">

</div>
</div>
</div>
<div class="cell-output cell-output-display hidden">
<div>
<div id="ojs-cell-25-103" data-nodetype="declaration">

</div>
</div>
</div>
<div class="cell-output cell-output-display hidden">
<div>
<div id="ojs-cell-25-104" data-nodetype="declaration">

</div>
</div>
</div>
<div class="cell-output cell-output-display hidden">
<div>
<div id="ojs-cell-25-105" data-nodetype="declaration">

</div>
</div>
</div>
<div class="cell-output cell-output-display hidden">
<div>
<div id="ojs-cell-25-106" data-nodetype="declaration">

</div>
</div>
</div>
<div class="cell-output cell-output-display hidden">
<div>
<div id="ojs-cell-25-107" data-nodetype="declaration">

</div>
</div>
</div>
<div class="cell-output cell-output-display hidden">
<div>
<div id="ojs-cell-25-108" data-nodetype="declaration">

</div>
</div>
</div>
<div class="cell-output cell-output-display hidden">
<div>
<div id="ojs-cell-25-109" data-nodetype="declaration">

</div>
</div>
</div>
<div class="cell-output cell-output-display hidden">
<div>
<div id="ojs-cell-25-110" data-nodetype="declaration">

</div>
</div>
</div>
<div class="cell-output cell-output-display hidden">
<div>
<div id="ojs-cell-25-111" data-nodetype="declaration">

</div>
</div>
</div>
<div class="cell-output cell-output-display hidden">
<div>
<div id="ojs-cell-25-112" data-nodetype="declaration">

</div>
</div>
</div>
<div class="cell-output cell-output-display hidden">
<div>
<div id="ojs-cell-25-113" data-nodetype="declaration">

</div>
</div>
</div>
<div class="cell-output cell-output-display hidden">
<div>
<div id="ojs-cell-25-114" data-nodetype="declaration">

</div>
</div>
</div>
<div class="cell-output cell-output-display hidden">
<div>
<div id="ojs-cell-25-115" data-nodetype="declaration">

</div>
</div>
</div>
<div class="cell-output cell-output-display hidden">
<div>
<div id="ojs-cell-25-116" data-nodetype="declaration">

</div>
</div>
</div>
<div class="cell-output cell-output-display hidden">
<div>
<div id="ojs-cell-25-117" data-nodetype="declaration">

</div>
</div>
</div>
<div class="cell-output cell-output-display hidden">
<div>
<div id="ojs-cell-25-118" data-nodetype="declaration">

</div>
</div>
</div>
<div class="cell-output cell-output-display hidden">
<div>
<div id="ojs-cell-25-119" data-nodetype="declaration">

</div>
</div>
</div>
<div class="cell-output cell-output-display hidden">
<div>
<div id="ojs-cell-25-120" data-nodetype="declaration">

</div>
</div>
</div>
<div class="cell-output cell-output-display hidden">
<div>
<div id="ojs-cell-25-121" data-nodetype="declaration">

</div>
</div>
</div>
<div class="cell-output cell-output-display hidden">
<div>
<div id="ojs-cell-25-122" data-nodetype="declaration">

</div>
</div>
</div>
<div class="cell-output cell-output-display hidden">
<div>
<div id="ojs-cell-25-123" data-nodetype="declaration">

</div>
</div>
</div>
<div class="cell-output cell-output-display hidden">
<div>
<div id="ojs-cell-25-124" data-nodetype="declaration">

</div>
</div>
</div>
<div class="cell-output cell-output-display hidden">
<div>
<div id="ojs-cell-25-125" data-nodetype="declaration">

</div>
</div>
</div>
<div class="cell-output cell-output-display hidden">
<div>
<div id="ojs-cell-25-126" data-nodetype="declaration">

</div>
</div>
</div>
<div class="cell-output cell-output-display hidden">
<div>
<div id="ojs-cell-25-127" data-nodetype="declaration">

</div>
</div>
</div>
<div class="cell-output cell-output-display hidden">
<div>
<div id="ojs-cell-25-128" data-nodetype="declaration">

</div>
</div>
</div>
<div class="cell-output cell-output-display hidden">
<div>
<div id="ojs-cell-25-129" data-nodetype="declaration">

</div>
</div>
</div>
<div class="cell-output cell-output-display hidden">
<div>
<div id="ojs-cell-25-130" data-nodetype="declaration">

</div>
</div>
</div>
<div class="cell-output cell-output-display hidden">
<div>
<div id="ojs-cell-25-131" data-nodetype="declaration">

</div>
</div>
</div>
<div class="cell-output cell-output-display hidden">
<div>
<div id="ojs-cell-25-132" data-nodetype="declaration">

</div>
</div>
</div>
<div class="cell-output cell-output-display hidden">
<div>
<div id="ojs-cell-25-133" data-nodetype="declaration">

</div>
</div>
</div>
<div class="cell-output cell-output-display hidden">
<div>
<div id="ojs-cell-25-134" data-nodetype="declaration">

</div>
</div>
</div>
<div class="cell-output cell-output-display hidden">
<div>
<div id="ojs-cell-25-135" data-nodetype="declaration">

</div>
</div>
</div>
<div class="cell-output cell-output-display hidden">
<div>
<div id="ojs-cell-25-136" data-nodetype="declaration">

</div>
</div>
</div>
<div class="cell-output cell-output-display hidden">
<div>
<div id="ojs-cell-25-137" data-nodetype="declaration">

</div>
</div>
</div>
<div class="cell-output cell-output-display hidden">
<div>
<div id="ojs-cell-25-138" data-nodetype="declaration">

</div>
</div>
</div>
<div class="cell-output cell-output-display hidden">
<div>
<div id="ojs-cell-25-139" data-nodetype="declaration">

</div>
</div>
</div>
<div class="cell-output cell-output-display hidden">
<div>
<div id="ojs-cell-25-140" data-nodetype="declaration">

</div>
</div>
</div>
<div class="cell-output cell-output-display hidden">
<div>
<div id="ojs-cell-25-141" data-nodetype="declaration">

</div>
</div>
</div>
<div class="cell-output cell-output-display hidden">
<div>
<div id="ojs-cell-25-142" data-nodetype="declaration">

</div>
</div>
</div>
<div class="cell-output cell-output-display hidden">
<div>
<div id="ojs-cell-25-143" data-nodetype="declaration">

</div>
</div>
</div>
<div class="cell-output cell-output-display hidden">
<div>
<div id="ojs-cell-25-144" data-nodetype="declaration">

</div>
</div>
</div>
<div class="cell-output cell-output-display hidden">
<div>
<div id="ojs-cell-25-145" data-nodetype="declaration">

</div>
</div>
</div>
<div class="cell-output cell-output-display hidden">
<div>
<div id="ojs-cell-25-146" data-nodetype="declaration">

</div>
</div>
</div>
<div class="cell-output cell-output-display hidden">
<div>
<div id="ojs-cell-25-147" data-nodetype="declaration">

</div>
</div>
</div>
<div class="cell-output cell-output-display hidden">
<div>
<div id="ojs-cell-25-148" data-nodetype="declaration">

</div>
</div>
</div>
<div class="cell-output cell-output-display hidden">
<div>
<div id="ojs-cell-25-149" data-nodetype="declaration">

</div>
</div>
</div>
<div class="cell-output cell-output-display hidden">
<div>
<div id="ojs-cell-25-150" data-nodetype="declaration">

</div>
</div>
</div>
<div class="cell-output cell-output-display hidden">
<div>
<div id="ojs-cell-25-151" data-nodetype="declaration">

</div>
</div>
</div>
<div class="cell-output cell-output-display hidden">
<div>
<div id="ojs-cell-25-152" data-nodetype="declaration">

</div>
</div>
</div>
<div class="cell-output cell-output-display hidden">
<div>
<div id="ojs-cell-25-153" data-nodetype="declaration">

</div>
</div>
</div>
<div class="cell-output cell-output-display hidden">
<div>
<div id="ojs-cell-25-154" data-nodetype="declaration">

</div>
</div>
</div>
<div class="cell-output cell-output-display hidden">
<div>
<div id="ojs-cell-25-155" data-nodetype="declaration">

</div>
</div>
</div>
<div class="cell-output cell-output-display hidden">
<div>
<div id="ojs-cell-25-156" data-nodetype="declaration">

</div>
</div>
</div>
<div class="cell-output cell-output-display hidden">
<div>
<div id="ojs-cell-25-157" data-nodetype="declaration">

</div>
</div>
</div>
<div class="cell-output cell-output-display hidden">
<div>
<div id="ojs-cell-25-158" data-nodetype="declaration">

</div>
</div>
</div>
<div class="cell-output cell-output-display hidden">
<div>
<div id="ojs-cell-25-159" data-nodetype="declaration">

</div>
</div>
</div>
<div class="cell-output cell-output-display hidden">
<div>
<div id="ojs-cell-25-160" data-nodetype="declaration">

</div>
</div>
</div>
<div class="cell-output cell-output-display hidden">
<div>
<div id="ojs-cell-25-161" data-nodetype="declaration">

</div>
</div>
</div>
<div class="cell-output cell-output-display hidden">
<div>
<div id="ojs-cell-25-162" data-nodetype="declaration">

</div>
</div>
</div>
<div class="cell-output cell-output-display hidden">
<div>
<div id="ojs-cell-25-163" data-nodetype="declaration">

</div>
</div>
</div>
<div class="cell-output cell-output-display hidden">
<div>
<div id="ojs-cell-25-164" data-nodetype="declaration">

</div>
</div>
</div>
<div class="cell-output cell-output-display hidden">
<div>
<div id="ojs-cell-25-165" data-nodetype="declaration">

</div>
</div>
</div>
<div class="cell-output cell-output-display hidden">
<div>
<div id="ojs-cell-25-166" data-nodetype="declaration">

</div>
</div>
</div>
<div class="cell-output cell-output-display hidden">
<div>
<div id="ojs-cell-25-167" data-nodetype="declaration">

</div>
</div>
</div>
<div class="cell-output cell-output-display hidden">
<div>
<div id="ojs-cell-25-168" data-nodetype="declaration">

</div>
</div>
</div>
<div class="cell-output cell-output-display hidden">
<div>
<div id="ojs-cell-25-169" data-nodetype="declaration">

</div>
</div>
</div>
<div class="cell-output cell-output-display hidden">
<div>
<div id="ojs-cell-25-170" data-nodetype="declaration">

</div>
</div>
</div>
<div class="cell-output cell-output-display hidden">
<div>
<div id="ojs-cell-25-171" data-nodetype="declaration">

</div>
</div>
</div>
<div class="cell-output cell-output-display hidden">
<div>
<div id="ojs-cell-25-172" data-nodetype="declaration">

</div>
</div>
</div>
<div class="cell-output cell-output-display hidden">
<div>
<div id="ojs-cell-25-173" data-nodetype="declaration">

</div>
</div>
</div>
<div class="cell-output cell-output-display hidden">
<div>
<div id="ojs-cell-25-174" data-nodetype="declaration">

</div>
</div>
</div>
<div class="cell-output cell-output-display hidden">
<div>
<div id="ojs-cell-25-175" data-nodetype="declaration">

</div>
</div>
</div>
<div class="cell-output cell-output-display hidden">
<div>
<div id="ojs-cell-25-176" data-nodetype="declaration">

</div>
</div>
</div>
<div class="cell-output cell-output-display hidden">
<div>
<div id="ojs-cell-25-177" data-nodetype="declaration">

</div>
</div>
</div>
<div class="cell-output cell-output-display hidden">
<div>
<div id="ojs-cell-25-178" data-nodetype="declaration">

</div>
</div>
</div>
<div class="cell-output cell-output-display hidden">
<div>
<div id="ojs-cell-25-179" data-nodetype="declaration">

</div>
</div>
</div>
<div class="cell-output cell-output-display hidden">
<div>
<div id="ojs-cell-25-180" data-nodetype="declaration">

</div>
</div>
</div>
<div class="cell-output cell-output-display hidden">
<div>
<div id="ojs-cell-25-181" data-nodetype="declaration">

</div>
</div>
</div>
<div class="cell-output cell-output-display hidden">
<div>
<div id="ojs-cell-25-182" data-nodetype="declaration">

</div>
</div>
</div>
<div class="cell-output cell-output-display hidden">
<div>
<div id="ojs-cell-25-183" data-nodetype="declaration">

</div>
</div>
</div>
<div class="cell-output cell-output-display hidden">
<div>
<div id="ojs-cell-25-184" data-nodetype="declaration">

</div>
</div>
</div>
<div class="cell-output cell-output-display hidden">
<div>
<div id="ojs-cell-25-185" data-nodetype="declaration">

</div>
</div>
</div>
<div class="cell-output cell-output-display hidden">
<div>
<div id="ojs-cell-25-186" data-nodetype="declaration">

</div>
</div>
</div>
<div class="cell-output cell-output-display hidden">
<div>
<div id="ojs-cell-25-187" data-nodetype="declaration">

</div>
</div>
</div>
<div class="cell-output cell-output-display hidden">
<div>
<div id="ojs-cell-25-188" data-nodetype="declaration">

</div>
</div>
</div>
<div class="cell-output cell-output-display hidden">
<div>
<div id="ojs-cell-25-189" data-nodetype="declaration">

</div>
</div>
</div>
<div class="cell-output cell-output-display hidden">
<div>
<div id="ojs-cell-25-190" data-nodetype="declaration">

</div>
</div>
</div>
<div class="cell-output cell-output-display hidden">
<div>
<div id="ojs-cell-25-191" data-nodetype="declaration">

</div>
</div>
</div>
<div class="cell-output cell-output-display hidden">
<div>
<div id="ojs-cell-25-192" data-nodetype="declaration">

</div>
</div>
</div>
<div class="cell-output cell-output-display hidden">
<div>
<div id="ojs-cell-25-193" data-nodetype="declaration">

</div>
</div>
</div>
<div class="cell-output cell-output-display hidden">
<div>
<div id="ojs-cell-25-194" data-nodetype="declaration">

</div>
</div>
</div>
<div class="cell-output cell-output-display hidden">
<div>
<div id="ojs-cell-25-195" data-nodetype="declaration">

</div>
</div>
</div>
<div class="cell-output cell-output-display hidden">
<div>
<div id="ojs-cell-25-196" data-nodetype="declaration">

</div>
</div>
</div>
<div class="cell-output cell-output-display hidden">
<div>
<div id="ojs-cell-25-197" data-nodetype="declaration">

</div>
</div>
</div>
<div class="cell-output cell-output-display hidden">
<div>
<div id="ojs-cell-25-198" data-nodetype="declaration">

</div>
</div>
</div>
<div class="cell-output cell-output-display hidden">
<div>
<div id="ojs-cell-25-199" data-nodetype="declaration">

</div>
</div>
</div>
<div class="cell-output cell-output-display hidden">
<div>
<div id="ojs-cell-25-200" data-nodetype="declaration">

</div>
</div>
</div>
<div class="cell-output cell-output-display hidden">
<div>
<div id="ojs-cell-25-201" data-nodetype="declaration">

</div>
</div>
</div>
<div class="cell-output cell-output-display hidden">
<div>
<div id="ojs-cell-25-202" data-nodetype="declaration">

</div>
</div>
</div>
<div class="cell-output cell-output-display hidden">
<div>
<div id="ojs-cell-25-203" data-nodetype="declaration">

</div>
</div>
</div>
<div class="cell-output cell-output-display hidden">
<div>
<div id="ojs-cell-25-204" data-nodetype="declaration">

</div>
</div>
</div>
<div class="cell-output cell-output-display hidden">
<div>
<div id="ojs-cell-25-205" data-nodetype="declaration">

</div>
</div>
</div>
<div class="cell-output cell-output-display hidden">
<div>
<div id="ojs-cell-25-206" data-nodetype="declaration">

</div>
</div>
</div>
<div class="cell-output cell-output-display hidden">
<div>
<div id="ojs-cell-25-207" data-nodetype="declaration">

</div>
</div>
</div>
<div class="cell-output cell-output-display hidden">
<div>
<div id="ojs-cell-25-208" data-nodetype="declaration">

</div>
</div>
</div>
<div class="cell-output cell-output-display hidden">
<div>
<div id="ojs-cell-25-209" data-nodetype="expression">

</div>
</div>
</div>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code hidden" id="cb85" data-startfrom="2266" data-source-offset="-55953"><pre class="sourceCode js code-with-copy"><code class="sourceCode javascript" style="counter-reset: source-line 2265;"><span id="cb85-2266"><a href="#cb85-2266" aria-hidden="true" tabindex="-1"></a>tableify <span class="op">=</span> <span class="im">import</span>(<span class="st">"https://cdn.skypack.dev/tableify@1.1.1?min"</span>)</span>
<span id="cb85-2267"><a href="#cb85-2267" aria-hidden="true" tabindex="-1"></a>xss <span class="op">=</span> <span class="im">import</span>(<span class="st">"https://cdn.skypack.dev/xss@1.0.14?min"</span>)</span>
<span id="cb85-2268"><a href="#cb85-2268" aria-hidden="true" tabindex="-1"></a><span class="kw">function</span> <span class="fu">createCellDiv</span>(value<span class="op">,</span> max) {</span>
<span id="cb85-2269"><a href="#cb85-2269" aria-hidden="true" tabindex="-1"></a>  <span class="cf">return</span> <span class="vs">`&lt;div style="</span></span>
<span id="cb85-2270"><a href="#cb85-2270" aria-hidden="true" tabindex="-1"></a><span class="vs">    width: </span><span class="sc">${</span><span class="bu">Math</span><span class="op">.</span><span class="fu">abs</span>(value) <span class="op">/</span> max<span class="sc">}</span><span class="vs">%;</span></span>
<span id="cb85-2271"><a href="#cb85-2271" aria-hidden="true" tabindex="-1"></a><span class="vs">    float: left;</span></span>
<span id="cb85-2272"><a href="#cb85-2272" aria-hidden="true" tabindex="-1"></a><span class="vs">    padding: 0px 0px 0px 2px;</span></span>
<span id="cb85-2273"><a href="#cb85-2273" aria-hidden="true" tabindex="-1"></a><span class="vs">    text-indent: 2px;</span></span>
<span id="cb85-2274"><a href="#cb85-2274" aria-hidden="true" tabindex="-1"></a><span class="vs">    box-sizing: border-box;</span></span>
<span id="cb85-2275"><a href="#cb85-2275" aria-hidden="true" tabindex="-1"></a><span class="vs">    overflow: visible;</span></span>
<span id="cb85-2276"><a href="#cb85-2276" aria-hidden="true" tabindex="-1"></a><span class="vs">    white-space: nowrap;</span></span>
<span id="cb85-2277"><a href="#cb85-2277" aria-hidden="true" tabindex="-1"></a><span class="vs">    display: flex;</span></span>
<span id="cb85-2278"><a href="#cb85-2278" aria-hidden="true" tabindex="-1"></a><span class="vs">    justify-content: start;"&gt;</span><span class="sc">${</span><span class="bu">Math</span><span class="op">.</span><span class="fu">round</span>(value)<span class="sc">}</span><span class="vs">&lt;/div&gt;`</span></span>
<span id="cb85-2279"><a href="#cb85-2279" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb85-2280"><a href="#cb85-2280" aria-hidden="true" tabindex="-1"></a>liveTable <span class="op">=</span> <span class="fu">observeTable</span>(table)</span>
<span id="cb85-2281"><a href="#cb85-2281" aria-hidden="true" tabindex="-1"></a><span class="kw">function</span> <span class="fu">makeTableEditable</span>(table<span class="op">,</span> options) {</span>
<span id="cb85-2282"><a href="#cb85-2282" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> defaults <span class="op">=</span> {<span class="dt">headerEditable</span><span class="op">:</span> <span class="kw">false</span><span class="op">,</span> <span class="dt">appendRows</span><span class="op">:</span> <span class="kw">true</span>}<span class="op">;</span></span>
<span id="cb85-2283"><a href="#cb85-2283" aria-hidden="true" tabindex="-1"></a>  options <span class="op">=</span> options <span class="op">===</span> <span class="kw">undefined</span> <span class="op">?</span> {} <span class="op">:</span> options<span class="op">;</span></span>
<span id="cb85-2284"><a href="#cb85-2284" aria-hidden="true" tabindex="-1"></a>  <span class="cf">for</span> (<span class="kw">let</span> key <span class="kw">in</span> defaults) {</span>
<span id="cb85-2285"><a href="#cb85-2285" aria-hidden="true" tabindex="-1"></a>    options[key] <span class="op">=</span> options[key] <span class="op">===</span> <span class="kw">undefined</span> <span class="op">?</span> defaults[key] <span class="op">:</span> options[key]<span class="op">;</span></span>
<span id="cb85-2286"><a href="#cb85-2286" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb85-2287"><a href="#cb85-2287" aria-hidden="true" tabindex="-1"></a>  <span class="cf">return</span> Generators<span class="op">.</span><span class="fu">observe</span>((_notify) <span class="kw">=&gt;</span> {</span>
<span id="cb85-2288"><a href="#cb85-2288" aria-hidden="true" tabindex="-1"></a>    <span class="kw">const</span> navigate <span class="op">=</span> (<span class="bu">event</span>) <span class="kw">=&gt;</span> {</span>
<span id="cb85-2289"><a href="#cb85-2289" aria-hidden="true" tabindex="-1"></a>      <span class="kw">const</span> cell <span class="op">=</span> <span class="bu">event</span><span class="op">.</span><span class="at">target</span><span class="op">;</span></span>
<span id="cb85-2290"><a href="#cb85-2290" aria-hidden="true" tabindex="-1"></a>      <span class="kw">const</span> row <span class="op">=</span> cell<span class="op">.</span><span class="fu">closest</span>(<span class="st">'tr'</span>)<span class="op">;</span></span>
<span id="cb85-2291"><a href="#cb85-2291" aria-hidden="true" tabindex="-1"></a>      <span class="kw">const</span> table <span class="op">=</span> row<span class="op">.</span><span class="fu">closest</span>(<span class="st">'table'</span>)<span class="op">;</span></span>
<span id="cb85-2292"><a href="#cb85-2292" aria-hidden="true" tabindex="-1"></a>      <span class="kw">const</span> isBody <span class="op">=</span> row<span class="op">.</span><span class="at">parentNode</span><span class="op">.</span><span class="at">tagName</span> <span class="op">===</span> <span class="st">'TBODY'</span><span class="op">;</span></span>
<span id="cb85-2293"><a href="#cb85-2293" aria-hidden="true" tabindex="-1"></a>      <span class="kw">const</span> isHeader <span class="op">=</span> row<span class="op">.</span><span class="at">parentNode</span><span class="op">.</span><span class="at">tagName</span> <span class="op">===</span> <span class="st">'THEAD'</span><span class="op">;</span></span>
<span id="cb85-2294"><a href="#cb85-2294" aria-hidden="true" tabindex="-1"></a>      <span class="kw">const</span> colIndex <span class="op">=</span> cell<span class="op">.</span><span class="at">cellIndex</span><span class="op">;</span></span>
<span id="cb85-2295"><a href="#cb85-2295" aria-hidden="true" tabindex="-1"></a>      <span class="kw">const</span> colCount <span class="op">=</span> row<span class="op">.</span><span class="at">cells</span><span class="op">.</span><span class="at">length</span><span class="op">;</span></span>
<span id="cb85-2296"><a href="#cb85-2296" aria-hidden="true" tabindex="-1"></a>      <span class="kw">const</span> rowIndex <span class="op">=</span> row<span class="op">.</span><span class="at">rowIndex</span><span class="op">;</span></span>
<span id="cb85-2297"><a href="#cb85-2297" aria-hidden="true" tabindex="-1"></a>      <span class="kw">const</span> rowCount <span class="op">=</span> table<span class="op">.</span><span class="at">rows</span><span class="op">.</span><span class="at">length</span><span class="op">;</span></span>
<span id="cb85-2298"><a href="#cb85-2298" aria-hidden="true" tabindex="-1"></a>      <span class="kw">const</span> headStop <span class="op">=</span> options<span class="op">.</span><span class="at">headerEditable</span> <span class="op">?</span> <span class="dv">0</span> <span class="op">:</span> <span class="dv">1</span><span class="op">;</span></span>
<span id="cb85-2299"><a href="#cb85-2299" aria-hidden="true" tabindex="-1"></a>      <span class="kw">let</span> direction <span class="op">=</span> <span class="kw">null</span><span class="op">;</span></span>
<span id="cb85-2300"><a href="#cb85-2300" aria-hidden="true" tabindex="-1"></a>      <span class="kw">let</span> x <span class="op">=</span> colIndex<span class="op">;</span></span>
<span id="cb85-2301"><a href="#cb85-2301" aria-hidden="true" tabindex="-1"></a>      <span class="kw">let</span> y <span class="op">=</span> rowIndex<span class="op">;</span></span>
<span id="cb85-2302"><a href="#cb85-2302" aria-hidden="true" tabindex="-1"></a>      <span class="cf">if</span> (<span class="op">!</span>[</span>
<span id="cb85-2303"><a href="#cb85-2303" aria-hidden="true" tabindex="-1"></a>      <span class="co">// https://www.freecodecamp.org/news/javascript-keycode-list-keypress-event-key-codes#heading-a-full-list-of-key-event-values</span></span>
<span id="cb85-2304"><a href="#cb85-2304" aria-hidden="true" tabindex="-1"></a>        <span class="dv">8</span><span class="op">,</span> <span class="dv">9</span><span class="op">,</span> <span class="dv">13</span><span class="op">,</span> <span class="dv">16</span><span class="op">,</span> <span class="dv">17</span><span class="op">,</span> <span class="dv">18</span><span class="op">,</span> <span class="dv">27</span><span class="op">,</span> <span class="dv">33</span><span class="op">,</span> <span class="dv">34</span><span class="op">,</span> <span class="dv">35</span><span class="op">,</span> <span class="dv">36</span><span class="op">,</span> <span class="dv">37</span><span class="op">,</span> <span class="dv">38</span><span class="op">,</span> <span class="dv">39</span><span class="op">,</span> <span class="dv">40</span><span class="op">,</span> <span class="dv">46</span><span class="op">,</span> <span class="dv">48</span><span class="op">,</span> <span class="dv">49</span><span class="op">,</span> <span class="dv">50</span><span class="op">,</span> <span class="dv">51</span><span class="op">,</span> <span class="dv">52</span><span class="op">,</span> <span class="dv">53</span><span class="op">,</span> <span class="dv">54</span><span class="op">,</span> <span class="dv">55</span><span class="op">,</span> <span class="dv">56</span><span class="op">,</span> <span class="dv">57</span><span class="op">,</span> <span class="dv">109</span><span class="op">,</span> <span class="dv">189</span></span>
<span id="cb85-2305"><a href="#cb85-2305" aria-hidden="true" tabindex="-1"></a>      ]<span class="op">.</span><span class="fu">includes</span>(<span class="bu">event</span><span class="op">.</span><span class="at">which</span>)) {</span>
<span id="cb85-2306"><a href="#cb85-2306" aria-hidden="true" tabindex="-1"></a>        <span class="bu">event</span><span class="op">.</span><span class="fu">preventDefault</span>()<span class="op">;</span></span>
<span id="cb85-2307"><a href="#cb85-2307" aria-hidden="true" tabindex="-1"></a>      }</span>
<span id="cb85-2308"><a href="#cb85-2308" aria-hidden="true" tabindex="-1"></a>      <span class="cf">else</span> {</span>
<span id="cb85-2309"><a href="#cb85-2309" aria-hidden="true" tabindex="-1"></a>      <span class="cf">switch</span>(<span class="bu">event</span><span class="op">.</span><span class="at">code</span>) {</span>
<span id="cb85-2310"><a href="#cb85-2310" aria-hidden="true" tabindex="-1"></a>        <span class="co">// Tab cycles through the table, adding new rows as needed.</span></span>
<span id="cb85-2311"><a href="#cb85-2311" aria-hidden="true" tabindex="-1"></a>        <span class="cf">case</span> <span class="st">'Tab'</span><span class="op">:</span></span>
<span id="cb85-2312"><a href="#cb85-2312" aria-hidden="true" tabindex="-1"></a>          <span class="bu">event</span><span class="op">.</span><span class="fu">preventDefault</span>()<span class="op">;</span></span>
<span id="cb85-2313"><a href="#cb85-2313" aria-hidden="true" tabindex="-1"></a>          <span class="cf">if</span> (<span class="bu">event</span><span class="op">.</span><span class="at">altKey</span> <span class="op">||</span> <span class="bu">event</span><span class="op">.</span><span class="at">shiftKey</span>) {</span>
<span id="cb85-2314"><a href="#cb85-2314" aria-hidden="true" tabindex="-1"></a>            direction <span class="op">=</span> <span class="op">-</span><span class="dv">1</span><span class="op">;</span></span>
<span id="cb85-2315"><a href="#cb85-2315" aria-hidden="true" tabindex="-1"></a>            <span class="cf">if</span> (x <span class="op">-</span> <span class="dv">1</span> <span class="op">&lt;</span> <span class="dv">0</span>) {</span>
<span id="cb85-2316"><a href="#cb85-2316" aria-hidden="true" tabindex="-1"></a>              <span class="cf">if</span> (y <span class="op">-</span> <span class="dv">1</span> <span class="op">&lt;</span> headStop) <span class="cf">break</span><span class="op">;</span></span>
<span id="cb85-2317"><a href="#cb85-2317" aria-hidden="true" tabindex="-1"></a>              x <span class="op">=</span> colCount <span class="op">-</span> <span class="dv">1</span><span class="op">;</span></span>
<span id="cb85-2318"><a href="#cb85-2318" aria-hidden="true" tabindex="-1"></a>              y <span class="op">=</span> y <span class="op">-</span> <span class="dv">1</span><span class="op">;</span></span>
<span id="cb85-2319"><a href="#cb85-2319" aria-hidden="true" tabindex="-1"></a>            } <span class="cf">else</span> {</span>
<span id="cb85-2320"><a href="#cb85-2320" aria-hidden="true" tabindex="-1"></a>              x <span class="op">=</span> x <span class="op">-</span> <span class="dv">1</span><span class="op">;</span></span>
<span id="cb85-2321"><a href="#cb85-2321" aria-hidden="true" tabindex="-1"></a>            }</span>
<span id="cb85-2322"><a href="#cb85-2322" aria-hidden="true" tabindex="-1"></a>          } <span class="cf">else</span> {</span>
<span id="cb85-2323"><a href="#cb85-2323" aria-hidden="true" tabindex="-1"></a>            direction <span class="op">=</span> <span class="dv">1</span><span class="op">;</span></span>
<span id="cb85-2324"><a href="#cb85-2324" aria-hidden="true" tabindex="-1"></a>            <span class="cf">if</span> (x <span class="op">+</span> <span class="dv">1</span> <span class="op">===</span> colCount) {</span>
<span id="cb85-2325"><a href="#cb85-2325" aria-hidden="true" tabindex="-1"></a>              x <span class="op">=</span> <span class="dv">0</span><span class="op">;</span></span>
<span id="cb85-2326"><a href="#cb85-2326" aria-hidden="true" tabindex="-1"></a>              y <span class="op">=</span> y <span class="op">+</span> <span class="dv">1</span><span class="op">;</span></span>
<span id="cb85-2327"><a href="#cb85-2327" aria-hidden="true" tabindex="-1"></a>            } <span class="cf">else</span> {</span>
<span id="cb85-2328"><a href="#cb85-2328" aria-hidden="true" tabindex="-1"></a>              x <span class="op">=</span> x <span class="op">+</span> <span class="dv">1</span><span class="op">;</span></span>
<span id="cb85-2329"><a href="#cb85-2329" aria-hidden="true" tabindex="-1"></a>            }</span>
<span id="cb85-2330"><a href="#cb85-2330" aria-hidden="true" tabindex="-1"></a>          }</span>
<span id="cb85-2331"><a href="#cb85-2331" aria-hidden="true" tabindex="-1"></a>          <span class="cf">break</span><span class="op">;</span></span>
<span id="cb85-2332"><a href="#cb85-2332" aria-hidden="true" tabindex="-1"></a>        <span class="co">// Plain Enter navigates downwards.</span></span>
<span id="cb85-2333"><a href="#cb85-2333" aria-hidden="true" tabindex="-1"></a>        <span class="co">// Shift + Enter or Alt + Enter goes up to the cell above.</span></span>
<span id="cb85-2334"><a href="#cb85-2334" aria-hidden="true" tabindex="-1"></a>        <span class="cf">case</span> <span class="st">'Enter'</span><span class="op">:</span></span>
<span id="cb85-2335"><a href="#cb85-2335" aria-hidden="true" tabindex="-1"></a>          <span class="bu">event</span><span class="op">.</span><span class="fu">preventDefault</span>()<span class="op">;</span></span>
<span id="cb85-2336"><a href="#cb85-2336" aria-hidden="true" tabindex="-1"></a>          <span class="cf">if</span> (<span class="bu">event</span><span class="op">.</span><span class="at">altKey</span> <span class="op">||</span> <span class="bu">event</span><span class="op">.</span><span class="at">shiftKey</span>) {</span>
<span id="cb85-2337"><a href="#cb85-2337" aria-hidden="true" tabindex="-1"></a>            direction <span class="op">=</span> <span class="op">-</span><span class="dv">1</span><span class="op">;</span></span>
<span id="cb85-2338"><a href="#cb85-2338" aria-hidden="true" tabindex="-1"></a>            x <span class="op">=</span> x<span class="op">;</span></span>
<span id="cb85-2339"><a href="#cb85-2339" aria-hidden="true" tabindex="-1"></a>            y <span class="op">=</span> y <span class="op">-</span> <span class="dv">1</span><span class="op">;</span></span>
<span id="cb85-2340"><a href="#cb85-2340" aria-hidden="true" tabindex="-1"></a>          }</span>
<span id="cb85-2341"><a href="#cb85-2341" aria-hidden="true" tabindex="-1"></a>          <span class="cf">else</span> {</span>
<span id="cb85-2342"><a href="#cb85-2342" aria-hidden="true" tabindex="-1"></a>            direction <span class="op">=</span> <span class="dv">1</span><span class="op">;</span></span>
<span id="cb85-2343"><a href="#cb85-2343" aria-hidden="true" tabindex="-1"></a>            x <span class="op">=</span> x<span class="op">;</span></span>
<span id="cb85-2344"><a href="#cb85-2344" aria-hidden="true" tabindex="-1"></a>            y <span class="op">=</span> y <span class="op">+</span> <span class="dv">1</span><span class="op">;</span></span>
<span id="cb85-2345"><a href="#cb85-2345" aria-hidden="true" tabindex="-1"></a>          }</span>
<span id="cb85-2346"><a href="#cb85-2346" aria-hidden="true" tabindex="-1"></a>          <span class="cf">break</span><span class="op">;</span></span>
<span id="cb85-2347"><a href="#cb85-2347" aria-hidden="true" tabindex="-1"></a>        <span class="co">// The arrow keys allow you to navigate through cells.</span></span>
<span id="cb85-2348"><a href="#cb85-2348" aria-hidden="true" tabindex="-1"></a>        <span class="co">// No new rows are added.</span></span>
<span id="cb85-2349"><a href="#cb85-2349" aria-hidden="true" tabindex="-1"></a>        <span class="cf">case</span> <span class="st">'ArrowUp'</span><span class="op">:</span></span>
<span id="cb85-2350"><a href="#cb85-2350" aria-hidden="true" tabindex="-1"></a>        <span class="cf">case</span> <span class="st">'ArrowDown'</span><span class="op">:</span></span>
<span id="cb85-2351"><a href="#cb85-2351" aria-hidden="true" tabindex="-1"></a>        <span class="cf">case</span> <span class="st">'ArrowLeft'</span><span class="op">:</span></span>
<span id="cb85-2352"><a href="#cb85-2352" aria-hidden="true" tabindex="-1"></a>        <span class="cf">case</span> <span class="st">'ArrowRight'</span><span class="op">:</span></span>
<span id="cb85-2353"><a href="#cb85-2353" aria-hidden="true" tabindex="-1"></a>        <span class="cf">case</span> <span class="st">'Enter'</span><span class="op">:</span></span>
<span id="cb85-2354"><a href="#cb85-2354" aria-hidden="true" tabindex="-1"></a>          <span class="cf">if</span> (<span class="op">!</span><span class="bu">event</span><span class="op">.</span><span class="at">altKey</span>) <span class="cf">break</span><span class="op">;</span></span>
<span id="cb85-2355"><a href="#cb85-2355" aria-hidden="true" tabindex="-1"></a>          <span class="bu">event</span><span class="op">.</span><span class="fu">preventDefault</span>()<span class="op">;</span></span>
<span id="cb85-2356"><a href="#cb85-2356" aria-hidden="true" tabindex="-1"></a>          <span class="cf">switch</span>(<span class="bu">event</span><span class="op">.</span><span class="at">code</span>) {</span>
<span id="cb85-2357"><a href="#cb85-2357" aria-hidden="true" tabindex="-1"></a>            <span class="cf">case</span> <span class="st">'ArrowUp'</span><span class="op">:</span></span>
<span id="cb85-2358"><a href="#cb85-2358" aria-hidden="true" tabindex="-1"></a>              direction <span class="op">=</span> <span class="op">-</span><span class="dv">1</span><span class="op">;</span></span>
<span id="cb85-2359"><a href="#cb85-2359" aria-hidden="true" tabindex="-1"></a>              y <span class="op">=</span> <span class="bu">Math</span><span class="op">.</span><span class="fu">max</span>(y <span class="op">-</span> <span class="dv">1</span><span class="op">,</span> headStop)<span class="op">;</span></span>
<span id="cb85-2360"><a href="#cb85-2360" aria-hidden="true" tabindex="-1"></a>              <span class="cf">break</span><span class="op">;</span></span>
<span id="cb85-2361"><a href="#cb85-2361" aria-hidden="true" tabindex="-1"></a>            <span class="cf">case</span> <span class="st">'ArrowDown'</span><span class="op">:</span></span>
<span id="cb85-2362"><a href="#cb85-2362" aria-hidden="true" tabindex="-1"></a>              direction <span class="op">=</span> <span class="dv">1</span><span class="op">;</span></span>
<span id="cb85-2363"><a href="#cb85-2363" aria-hidden="true" tabindex="-1"></a>              y <span class="op">=</span> <span class="bu">Math</span><span class="op">.</span><span class="fu">min</span>(y <span class="op">+</span> <span class="dv">1</span><span class="op">,</span> rowCount <span class="op">-</span> <span class="dv">1</span>)<span class="op">;</span></span>
<span id="cb85-2364"><a href="#cb85-2364" aria-hidden="true" tabindex="-1"></a>              <span class="cf">break</span><span class="op">;</span></span>
<span id="cb85-2365"><a href="#cb85-2365" aria-hidden="true" tabindex="-1"></a>            <span class="cf">case</span> <span class="st">'ArrowLeft'</span><span class="op">:</span></span>
<span id="cb85-2366"><a href="#cb85-2366" aria-hidden="true" tabindex="-1"></a>              direction <span class="op">=</span> <span class="op">-</span><span class="dv">1</span><span class="op">;</span></span>
<span id="cb85-2367"><a href="#cb85-2367" aria-hidden="true" tabindex="-1"></a>              x <span class="op">=</span> <span class="bu">Math</span><span class="op">.</span><span class="fu">max</span>(x <span class="op">-</span> <span class="dv">1</span><span class="op">,</span> <span class="dv">0</span>)<span class="op">;</span></span>
<span id="cb85-2368"><a href="#cb85-2368" aria-hidden="true" tabindex="-1"></a>              <span class="cf">break</span><span class="op">;</span></span>
<span id="cb85-2369"><a href="#cb85-2369" aria-hidden="true" tabindex="-1"></a>            <span class="cf">case</span> <span class="st">'ArrowRight'</span><span class="op">:</span></span>
<span id="cb85-2370"><a href="#cb85-2370" aria-hidden="true" tabindex="-1"></a>              direction <span class="op">=</span> <span class="dv">1</span><span class="op">;</span></span>
<span id="cb85-2371"><a href="#cb85-2371" aria-hidden="true" tabindex="-1"></a>              x <span class="op">=</span> <span class="bu">Math</span><span class="op">.</span><span class="fu">min</span>(x <span class="op">+</span> <span class="dv">1</span><span class="op">,</span> colCount <span class="op">-</span> <span class="dv">1</span>)<span class="op">;</span></span>
<span id="cb85-2372"><a href="#cb85-2372" aria-hidden="true" tabindex="-1"></a>              <span class="cf">break</span><span class="op">;</span></span>
<span id="cb85-2373"><a href="#cb85-2373" aria-hidden="true" tabindex="-1"></a>          }</span>
<span id="cb85-2374"><a href="#cb85-2374" aria-hidden="true" tabindex="-1"></a>          <span class="cf">break</span><span class="op">;</span></span>
<span id="cb85-2375"><a href="#cb85-2375" aria-hidden="true" tabindex="-1"></a>      }</span>
<span id="cb85-2376"><a href="#cb85-2376" aria-hidden="true" tabindex="-1"></a>      <span class="cf">if</span> (direction <span class="op">!==</span> <span class="kw">null</span>) {</span>
<span id="cb85-2377"><a href="#cb85-2377" aria-hidden="true" tabindex="-1"></a>        <span class="kw">let</span> nextRow<span class="op">;</span></span>
<span id="cb85-2378"><a href="#cb85-2378" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> (y <span class="op">===</span> rowCount) {</span>
<span id="cb85-2379"><a href="#cb85-2379" aria-hidden="true" tabindex="-1"></a>          nextRow <span class="op">=</span> options<span class="op">.</span><span class="at">appendRows</span> <span class="op">?</span> <span class="fu">addRowRelativeTo</span>(row<span class="op">,</span> direction) <span class="op">:</span> row<span class="op">;</span></span>
<span id="cb85-2380"><a href="#cb85-2380" aria-hidden="true" tabindex="-1"></a>        } <span class="cf">else</span> {</span>
<span id="cb85-2381"><a href="#cb85-2381" aria-hidden="true" tabindex="-1"></a>          nextRow <span class="op">=</span> table<span class="op">.</span><span class="at">rows</span>[y]<span class="op">;</span></span>
<span id="cb85-2382"><a href="#cb85-2382" aria-hidden="true" tabindex="-1"></a>        }</span>
<span id="cb85-2383"><a href="#cb85-2383" aria-hidden="true" tabindex="-1"></a>        <span class="kw">let</span> nextCell <span class="op">=</span> nextRow<span class="op">.</span><span class="at">cells</span>[x]<span class="op">;</span></span>
<span id="cb85-2384"><a href="#cb85-2384" aria-hidden="true" tabindex="-1"></a>        <span class="fu">focusCell</span>(nextCell)<span class="op">;</span></span>
<span id="cb85-2385"><a href="#cb85-2385" aria-hidden="true" tabindex="-1"></a>      }</span>
<span id="cb85-2386"><a href="#cb85-2386" aria-hidden="true" tabindex="-1"></a>    }<span class="op">;</span></span>
<span id="cb85-2387"><a href="#cb85-2387" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb85-2388"><a href="#cb85-2388" aria-hidden="true" tabindex="-1"></a>    table<span class="op">.</span><span class="fu">addEventListener</span>(<span class="st">"keydown"</span><span class="op">,</span> navigate<span class="op">,</span> <span class="kw">false</span>)<span class="op">;</span></span>
<span id="cb85-2389"><a href="#cb85-2389" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> (table<span class="op">.</span><span class="at">rows</span><span class="op">.</span><span class="at">length</span> <span class="op">&gt;</span> <span class="dv">0</span>) {</span>
<span id="cb85-2390"><a href="#cb85-2390" aria-hidden="true" tabindex="-1"></a>      <span class="cf">for</span> (<span class="kw">let</span> row <span class="kw">of</span> table<span class="op">.</span><span class="at">rows</span>) {</span>
<span id="cb85-2391"><a href="#cb85-2391" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> (<span class="op">!</span>options<span class="op">.</span><span class="at">headerEditable</span> <span class="op">&amp;&amp;</span> row<span class="op">.</span><span class="at">rowIndex</span> <span class="op">===</span> <span class="dv">0</span>) <span class="cf">continue</span><span class="op">;</span></span>
<span id="cb85-2392"><a href="#cb85-2392" aria-hidden="true" tabindex="-1"></a>        <span class="cf">for</span> (<span class="kw">let</span> cell <span class="kw">of</span> row<span class="op">.</span><span class="at">cells</span>) {</span>
<span id="cb85-2393"><a href="#cb85-2393" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> (cell<span class="op">.</span><span class="at">cellIndex</span> <span class="op">===</span> <span class="dv">0</span>) <span class="cf">continue</span><span class="op">;</span></span>
<span id="cb85-2394"><a href="#cb85-2394" aria-hidden="true" tabindex="-1"></a>          <span class="kw">let</span> cellValue <span class="op">=</span> cell<span class="op">.</span><span class="at">innerText</span></span>
<span id="cb85-2395"><a href="#cb85-2395" aria-hidden="true" tabindex="-1"></a>          cell<span class="op">.</span><span class="at">innerHTML</span> <span class="op">=</span> <span class="vs">`&lt;div style="</span></span>
<span id="cb85-2396"><a href="#cb85-2396" aria-hidden="true" tabindex="-1"></a><span class="vs">            width: </span><span class="sc">${</span><span class="bu">Math</span><span class="op">.</span><span class="fu">abs</span>(cellValue) <span class="op">/</span> (cell<span class="op">.</span><span class="at">cellIndex</span> <span class="op">===</span> <span class="dv">2</span> <span class="op">?</span> <span class="fl">2.5</span> <span class="op">:</span> <span class="dv">10</span>)<span class="sc">}</span><span class="vs">%;</span></span>
<span id="cb85-2397"><a href="#cb85-2397" aria-hidden="true" tabindex="-1"></a><span class="vs">            float: left;</span></span>
<span id="cb85-2398"><a href="#cb85-2398" aria-hidden="true" tabindex="-1"></a><span class="vs">            padding: 0px 0px 0px 2px;</span></span>
<span id="cb85-2399"><a href="#cb85-2399" aria-hidden="true" tabindex="-1"></a><span class="vs">            text-indent: 2px;</span></span>
<span id="cb85-2400"><a href="#cb85-2400" aria-hidden="true" tabindex="-1"></a><span class="vs">            box-sizing: border-box;</span></span>
<span id="cb85-2401"><a href="#cb85-2401" aria-hidden="true" tabindex="-1"></a><span class="vs">            overflow: visible;</span></span>
<span id="cb85-2402"><a href="#cb85-2402" aria-hidden="true" tabindex="-1"></a><span class="vs">            white-space: nowrap;</span></span>
<span id="cb85-2403"><a href="#cb85-2403" aria-hidden="true" tabindex="-1"></a><span class="vs">            display: flex;</span></span>
<span id="cb85-2404"><a href="#cb85-2404" aria-hidden="true" tabindex="-1"></a><span class="vs">            justify-content: start;"&gt;</span><span class="sc">${</span>cellValue<span class="sc">}</span><span class="vs">&lt;/div&gt;`</span></span>
<span id="cb85-2405"><a href="#cb85-2405" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> (cell<span class="op">.</span><span class="at">cellIndex</span> <span class="op">===</span> <span class="dv">3</span>) <span class="cf">continue</span><span class="op">;</span></span>
<span id="cb85-2406"><a href="#cb85-2406" aria-hidden="true" tabindex="-1"></a>          cell<span class="op">.</span><span class="at">contentEditable</span> <span class="op">=</span> <span class="kw">true</span><span class="op">;</span></span>
<span id="cb85-2407"><a href="#cb85-2407" aria-hidden="true" tabindex="-1"></a>        }</span>
<span id="cb85-2408"><a href="#cb85-2408" aria-hidden="true" tabindex="-1"></a>      }</span>
<span id="cb85-2409"><a href="#cb85-2409" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb85-2410"><a href="#cb85-2410" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> () <span class="kw">=&gt;</span> table<span class="op">.</span><span class="fu">removeEventListener</span>(<span class="st">"keydown"</span><span class="op">,</span> navigate)<span class="op">;</span></span>
<span id="cb85-2411"><a href="#cb85-2411" aria-hidden="true" tabindex="-1"></a>  })<span class="op">;</span></span>
<span id="cb85-2412"><a href="#cb85-2412" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb85-2413"><a href="#cb85-2413" aria-hidden="true" tabindex="-1"></a><span class="kw">function</span> <span class="fu">observeTable</span>(table) {</span>
<span id="cb85-2414"><a href="#cb85-2414" aria-hidden="true" tabindex="-1"></a>  <span class="cf">return</span> Generators<span class="op">.</span><span class="fu">observe</span>((notify) <span class="kw">=&gt;</span> {</span>
<span id="cb85-2415"><a href="#cb85-2415" aria-hidden="true" tabindex="-1"></a>    <span class="kw">const</span> keyinput <span class="op">=</span> (<span class="bu">event</span>) <span class="kw">=&gt;</span> <span class="fu">notify</span>(<span class="fu">parseTableData</span>(table))<span class="op">;</span></span>
<span id="cb85-2416"><a href="#cb85-2416" aria-hidden="true" tabindex="-1"></a>    table<span class="op">.</span><span class="fu">addEventListener</span>(<span class="st">"input"</span><span class="op">,</span> keyinput<span class="op">,</span> <span class="kw">false</span>)<span class="op">;</span></span>
<span id="cb85-2417"><a href="#cb85-2417" aria-hidden="true" tabindex="-1"></a>    <span class="fu">notify</span>(<span class="fu">parseTableData</span>(table))<span class="op">;</span></span>
<span id="cb85-2418"><a href="#cb85-2418" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> () <span class="kw">=&gt;</span> <span class="bu">window</span><span class="op">.</span><span class="fu">removeEventListener</span>(<span class="st">"input"</span><span class="op">,</span> keyinput)<span class="op">;</span></span>
<span id="cb85-2419"><a href="#cb85-2419" aria-hidden="true" tabindex="-1"></a>  })<span class="op">;</span></span>
<span id="cb85-2420"><a href="#cb85-2420" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb85-2421"><a href="#cb85-2421" aria-hidden="true" tabindex="-1"></a><span class="kw">function</span> <span class="fu">parseTableData</span>(table) {</span>
<span id="cb85-2422"><a href="#cb85-2422" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> header <span class="op">=</span> []<span class="op">;</span></span>
<span id="cb85-2423"><a href="#cb85-2423" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> data <span class="op">=</span> []<span class="op">;</span></span>
<span id="cb85-2424"><a href="#cb85-2424" aria-hidden="true" tabindex="-1"></a>  <span class="cf">for</span> (<span class="kw">let</span> row <span class="kw">of</span> table<span class="op">.</span><span class="at">rows</span>) {</span>
<span id="cb85-2425"><a href="#cb85-2425" aria-hidden="true" tabindex="-1"></a>    <span class="kw">const</span> rowIndex <span class="op">=</span> row<span class="op">.</span><span class="at">rowIndex</span><span class="op">;</span></span>
<span id="cb85-2426"><a href="#cb85-2426" aria-hidden="true" tabindex="-1"></a>    <span class="kw">const</span> isHeader <span class="op">=</span> row<span class="op">.</span><span class="at">parentNode</span><span class="op">.</span><span class="at">tagName</span> <span class="op">===</span> <span class="st">'THEAD'</span> <span class="op">&amp;&amp;</span> rowIndex <span class="op">===</span> <span class="dv">0</span><span class="op">;</span></span>
<span id="cb85-2427"><a href="#cb85-2427" aria-hidden="true" tabindex="-1"></a>    <span class="kw">let</span> obj <span class="op">=</span> {}<span class="op">;</span></span>
<span id="cb85-2428"><a href="#cb85-2428" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> (<span class="kw">let</span> cell <span class="kw">of</span> row<span class="op">.</span><span class="at">cells</span>) {</span>
<span id="cb85-2429"><a href="#cb85-2429" aria-hidden="true" tabindex="-1"></a>      <span class="kw">const</span> head <span class="op">=</span> header[cell<span class="op">.</span><span class="at">cellIndex</span>]<span class="op">;</span></span>
<span id="cb85-2430"><a href="#cb85-2430" aria-hidden="true" tabindex="-1"></a>      <span class="cf">if</span> (isHeader) {</span>
<span id="cb85-2431"><a href="#cb85-2431" aria-hidden="true" tabindex="-1"></a>        header<span class="op">.</span><span class="fu">push</span>(cell<span class="op">.</span><span class="at">innerText</span>)<span class="op">;</span></span>
<span id="cb85-2432"><a href="#cb85-2432" aria-hidden="true" tabindex="-1"></a>      } <span class="cf">else</span> {</span>
<span id="cb85-2433"><a href="#cb85-2433" aria-hidden="true" tabindex="-1"></a>        obj[head] <span class="op">=</span> cell<span class="op">.</span><span class="at">innerText</span><span class="op">;</span></span>
<span id="cb85-2434"><a href="#cb85-2434" aria-hidden="true" tabindex="-1"></a>      }</span>
<span id="cb85-2435"><a href="#cb85-2435" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb85-2436"><a href="#cb85-2436" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> (<span class="op">!</span>isHeader) data<span class="op">.</span><span class="fu">push</span>(obj)<span class="op">;</span></span>
<span id="cb85-2437"><a href="#cb85-2437" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb85-2438"><a href="#cb85-2438" aria-hidden="true" tabindex="-1"></a>  <span class="cf">return</span> <span class="bu">JSON</span><span class="op">.</span><span class="fu">parse</span>(<span class="bu">JSON</span><span class="op">.</span><span class="fu">stringify</span>(data))<span class="op">;</span></span>
<span id="cb85-2439"><a href="#cb85-2439" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb85-2440"><a href="#cb85-2440" aria-hidden="true" tabindex="-1"></a><span class="kw">function</span> <span class="fu">focusCell</span>(td) {</span>
<span id="cb85-2441"><a href="#cb85-2441" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> s <span class="op">=</span> <span class="bu">window</span><span class="op">.</span><span class="fu">getSelection</span>()<span class="op">;</span></span>
<span id="cb85-2442"><a href="#cb85-2442" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> r <span class="op">=</span> <span class="bu">document</span><span class="op">.</span><span class="fu">createRange</span>()<span class="op">;</span></span>
<span id="cb85-2443"><a href="#cb85-2443" aria-hidden="true" tabindex="-1"></a>  <span class="kw">let</span> textNode <span class="op">=</span> td<span class="op">.</span><span class="at">childNodes</span>[<span class="dv">0</span>]<span class="op">;</span></span>
<span id="cb85-2444"><a href="#cb85-2444" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> i <span class="op">=</span> td<span class="op">.</span><span class="at">innerText</span><span class="op">.</span><span class="at">length</span><span class="op">;</span></span>
<span id="cb85-2445"><a href="#cb85-2445" aria-hidden="true" tabindex="-1"></a>  td<span class="op">.</span><span class="fu">focus</span>()<span class="op">;</span></span>
<span id="cb85-2446"><a href="#cb85-2446" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (textNode) {</span>
<span id="cb85-2447"><a href="#cb85-2447" aria-hidden="true" tabindex="-1"></a>    r<span class="op">.</span><span class="fu">setStart</span>(textNode<span class="op">,</span> i)<span class="op">;</span></span>
<span id="cb85-2448"><a href="#cb85-2448" aria-hidden="true" tabindex="-1"></a>    r<span class="op">.</span><span class="fu">setEnd</span>(textNode<span class="op">,</span> i)<span class="op">;</span></span>
<span id="cb85-2449"><a href="#cb85-2449" aria-hidden="true" tabindex="-1"></a>  } <span class="cf">else</span> {</span>
<span id="cb85-2450"><a href="#cb85-2450" aria-hidden="true" tabindex="-1"></a>    r<span class="op">.</span><span class="fu">selectNode</span>(td)<span class="op">;</span></span>
<span id="cb85-2451"><a href="#cb85-2451" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb85-2452"><a href="#cb85-2452" aria-hidden="true" tabindex="-1"></a>  s<span class="op">.</span><span class="fu">removeAllRanges</span>()<span class="op">;</span></span>
<span id="cb85-2453"><a href="#cb85-2453" aria-hidden="true" tabindex="-1"></a>  s<span class="op">.</span><span class="fu">addRange</span>(r)<span class="op">;</span></span>
<span id="cb85-2454"><a href="#cb85-2454" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb85-2455"><a href="#cb85-2455" aria-hidden="true" tabindex="-1"></a><span class="kw">function</span> <span class="fu">addRowRelativeTo</span>(tr<span class="op">,</span> direction) {</span>
<span id="cb85-2456"><a href="#cb85-2456" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> newTr <span class="op">=</span> <span class="bu">document</span><span class="op">.</span><span class="fu">createElement</span>(<span class="st">'tr'</span>)<span class="op">;</span></span>
<span id="cb85-2457"><a href="#cb85-2457" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> insertPosition <span class="op">=</span> direction <span class="op">==</span> <span class="dv">1</span> <span class="op">?</span> <span class="st">'afterend'</span> <span class="op">:</span> <span class="st">'beforebegin'</span><span class="op">;</span></span>
<span id="cb85-2458"><a href="#cb85-2458" aria-hidden="true" tabindex="-1"></a>  tr<span class="op">.</span><span class="fu">insertAdjacentElement</span>(insertPosition<span class="op">,</span> newTr)<span class="op">;</span></span>
<span id="cb85-2459"><a href="#cb85-2459" aria-hidden="true" tabindex="-1"></a>  <span class="cf">for</span> (<span class="kw">let</span> _td <span class="kw">of</span> <span class="bu">Array</span><span class="op">.</span><span class="fu">from</span>(tr<span class="op">.</span><span class="at">children</span>)) {</span>
<span id="cb85-2460"><a href="#cb85-2460" aria-hidden="true" tabindex="-1"></a>    <span class="kw">const</span> newTd <span class="op">=</span> <span class="bu">document</span><span class="op">.</span><span class="fu">createElement</span>(<span class="st">'td'</span>)<span class="op">;</span></span>
<span id="cb85-2461"><a href="#cb85-2461" aria-hidden="true" tabindex="-1"></a>    newTd<span class="op">.</span><span class="fu">appendChild</span>(<span class="bu">document</span><span class="op">.</span><span class="fu">createTextNode</span>(<span class="st">''</span>))<span class="op">;</span></span>
<span id="cb85-2462"><a href="#cb85-2462" aria-hidden="true" tabindex="-1"></a>    newTd<span class="op">.</span><span class="at">contentEditable</span> <span class="op">=</span> <span class="kw">true</span><span class="op">;</span></span>
<span id="cb85-2463"><a href="#cb85-2463" aria-hidden="true" tabindex="-1"></a>    newTr<span class="op">.</span><span class="fu">appendChild</span>(newTd)<span class="op">;</span></span>
<span id="cb85-2464"><a href="#cb85-2464" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb85-2465"><a href="#cb85-2465" aria-hidden="true" tabindex="-1"></a>  <span class="cf">return</span> newTr<span class="op">;</span></span>
<span id="cb85-2466"><a href="#cb85-2466" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb85-2467"><a href="#cb85-2467" aria-hidden="true" tabindex="-1"></a><span class="co">// https://observablehq.com/@observablehq/text-color-annotations-in-markdown</span></span>
<span id="cb85-2468"><a href="#cb85-2468" aria-hidden="true" tabindex="-1"></a>rstbtn <span class="op">=</span> d3<span class="op">.</span><span class="fu">create</span>(<span class="st">'button'</span>)<span class="op">.</span><span class="fu">html</span>(<span class="st">'Reset'</span>)<span class="op">.</span><span class="fu">attr</span>(<span class="st">"id"</span><span class="op">,</span> <span class="st">"rstbtn"</span>)<span class="op">.</span><span class="fu">attr</span>(<span class="st">"class"</span><span class="op">,</span> <span class="st">"btn btn-quarto"</span>)<span class="op">;</span></span>
<span id="cb85-2469"><a href="#cb85-2469" aria-hidden="true" tabindex="-1"></a><span class="co">// https://observablehq.com/@recifs/add-a-class-to-an-observable-input--support</span></span>
<span id="cb85-2470"><a href="#cb85-2470" aria-hidden="true" tabindex="-1"></a><span class="kw">function</span> <span class="fu">labelToggle</span>(inputType<span class="op">,</span> inputLabel<span class="op">,</span> inputValue<span class="op">,</span> inputId) {</span>
<span id="cb85-2471"><a href="#cb85-2471" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> input <span class="op">=</span> <span class="fu">inputType</span>({<span class="dt">label</span><span class="op">:</span> inputLabel<span class="op">,</span> <span class="dt">value</span><span class="op">:</span> inputValue})<span class="op">;</span></span>
<span id="cb85-2472"><a href="#cb85-2472" aria-hidden="true" tabindex="-1"></a>  input<span class="op">.</span><span class="fu">setAttribute</span>(<span class="st">"id"</span><span class="op">,</span> inputId)<span class="op">;</span></span>
<span id="cb85-2473"><a href="#cb85-2473" aria-hidden="true" tabindex="-1"></a>  <span class="cf">return</span> input<span class="op">;</span></span>
<span id="cb85-2474"><a href="#cb85-2474" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb85-2475"><a href="#cb85-2475" aria-hidden="true" tabindex="-1"></a>timezones <span class="op">=</span> <span class="fu">FileAttachment</span>(<span class="st">"../../asset/timezones.json"</span>)<span class="op">.</span><span class="fu">json</span>()</span>
<span id="cb85-2476"><a href="#cb85-2476" aria-hidden="true" tabindex="-1"></a>zones <span class="op">=</span> topojson<span class="op">.</span><span class="fu">feature</span>(timezones<span class="op">,</span> timezones<span class="op">.</span><span class="at">objects</span><span class="op">.</span><span class="at">timezones</span>)<span class="op">.</span><span class="at">features</span></span>
<span id="cb85-2477"><a href="#cb85-2477" aria-hidden="true" tabindex="-1"></a>mesh <span class="op">=</span> topojson<span class="op">.</span><span class="fu">mesh</span>(timezones<span class="op">,</span> timezones<span class="op">.</span><span class="at">objects</span><span class="op">.</span><span class="at">timezones</span>)</span>
<span id="cb85-2478"><a href="#cb85-2478" aria-hidden="true" tabindex="-1"></a>zonecolor <span class="op">=</span> d3<span class="op">.</span><span class="fu">scaleSequential</span>(d3<span class="op">.</span><span class="at">interpolateRdBu</span>)<span class="op">.</span><span class="fu">domain</span>([<span class="op">-</span><span class="dv">12</span><span class="op">,</span> <span class="dv">14</span>])</span>
<span id="cb85-2479"><a href="#cb85-2479" aria-hidden="true" tabindex="-1"></a>coor <span class="op">=</span> [[[<span class="op">-</span><span class="dv">18</span><span class="op">,</span> <span class="op">-</span><span class="fl">89.98</span>]<span class="op">,</span> [<span class="op">-</span><span class="dv">18</span><span class="op">,</span> <span class="fl">89.98</span>]<span class="op">,</span> [<span class="dv">18</span><span class="op">,</span> <span class="fl">89.98</span>]<span class="op">,</span> [<span class="dv">18</span><span class="op">,</span> <span class="op">-</span><span class="fl">89.98</span>]<span class="op">,</span> [<span class="op">-</span><span class="dv">18</span><span class="op">,</span> <span class="op">-</span><span class="fl">89.98</span>]<span class="op">,</span> ]]</span>
<span id="cb85-2480"><a href="#cb85-2480" aria-hidden="true" tabindex="-1"></a>deczones <span class="op">=</span> [<span class="op">...</span><span class="bu">Array</span>(<span class="dv">10</span>)<span class="op">.</span><span class="fu">keys</span>()]<span class="op">.</span><span class="fu">map</span>(</span>
<span id="cb85-2481"><a href="#cb85-2481" aria-hidden="true" tabindex="-1"></a>  i <span class="kw">=&gt;</span> ({</span>
<span id="cb85-2482"><a href="#cb85-2482" aria-hidden="true" tabindex="-1"></a>    <span class="st">"type"</span><span class="op">:</span> <span class="st">"Feature"</span><span class="op">,</span></span>
<span id="cb85-2483"><a href="#cb85-2483" aria-hidden="true" tabindex="-1"></a>    <span class="st">"geometry"</span><span class="op">:</span> {</span>
<span id="cb85-2484"><a href="#cb85-2484" aria-hidden="true" tabindex="-1"></a>      <span class="st">"type"</span><span class="op">:</span> <span class="st">"Polygon"</span><span class="op">,</span></span>
<span id="cb85-2485"><a href="#cb85-2485" aria-hidden="true" tabindex="-1"></a>      <span class="st">"coordinates"</span><span class="op">:</span> [coor[<span class="dv">0</span>]<span class="op">.</span><span class="fu">map</span>(t <span class="kw">=&gt;</span> [t[<span class="dv">0</span>]<span class="op">+</span><span class="dv">36</span><span class="op">*</span>i<span class="op">,</span> t[<span class="dv">1</span>]])]</span>
<span id="cb85-2486"><a href="#cb85-2486" aria-hidden="true" tabindex="-1"></a>      }<span class="op">,</span></span>
<span id="cb85-2487"><a href="#cb85-2487" aria-hidden="true" tabindex="-1"></a>    <span class="st">"properties"</span><span class="op">:</span> []</span>
<span id="cb85-2488"><a href="#cb85-2488" aria-hidden="true" tabindex="-1"></a>  })</span>
<span id="cb85-2489"><a href="#cb85-2489" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb85-2490"><a href="#cb85-2490" aria-hidden="true" tabindex="-1"></a>hsla10 <span class="op">=</span> [</span>
<span id="cb85-2491"><a href="#cb85-2491" aria-hidden="true" tabindex="-1"></a>  <span class="vs">`hsla(0,   100%, 50%, 100%)`</span><span class="op">,</span> <span class="co">// red</span></span>
<span id="cb85-2492"><a href="#cb85-2492" aria-hidden="true" tabindex="-1"></a>  <span class="vs">`hsla(36,  100%, 50%, 100%)`</span><span class="op">,</span> <span class="co">// orange</span></span>
<span id="cb85-2493"><a href="#cb85-2493" aria-hidden="true" tabindex="-1"></a>  <span class="vs">`hsla(60,  100%, 50%, 100%)`</span><span class="op">,</span> <span class="co">// yellow</span></span>
<span id="cb85-2494"><a href="#cb85-2494" aria-hidden="true" tabindex="-1"></a>  <span class="vs">`hsla(80,  100%, 50%, 100%)`</span><span class="op">,</span> <span class="co">// lime</span></span>
<span id="cb85-2495"><a href="#cb85-2495" aria-hidden="true" tabindex="-1"></a>  <span class="vs">`hsla(120, 100%, 50%, 100%)`</span><span class="op">,</span> <span class="co">// green</span></span>
<span id="cb85-2496"><a href="#cb85-2496" aria-hidden="true" tabindex="-1"></a>  <span class="vs">`hsla(180, 100%, 50%, 100%)`</span><span class="op">,</span> <span class="co">// cyan</span></span>
<span id="cb85-2497"><a href="#cb85-2497" aria-hidden="true" tabindex="-1"></a>  <span class="vs">`hsla(208, 100%, 50%, 100%)`</span><span class="op">,</span> <span class="co">// azure</span></span>
<span id="cb85-2498"><a href="#cb85-2498" aria-hidden="true" tabindex="-1"></a>  <span class="vs">`hsla(240, 100%, 50%, 100%)`</span><span class="op">,</span> <span class="co">// blue</span></span>
<span id="cb85-2499"><a href="#cb85-2499" aria-hidden="true" tabindex="-1"></a>  <span class="vs">`hsla(276, 100%, 50%, 100%)`</span><span class="op">,</span> <span class="co">// violet</span></span>
<span id="cb85-2500"><a href="#cb85-2500" aria-hidden="true" tabindex="-1"></a>  <span class="vs">`hsla(300, 100%, 50%, 100%)`</span><span class="op">,</span> <span class="co">// magenta</span></span>
<span id="cb85-2501"><a href="#cb85-2501" aria-hidden="true" tabindex="-1"></a>  <span class="vs">`hsla(0,   100%, 50%, 100%)`</span><span class="op">,</span> <span class="co">// red</span></span>
<span id="cb85-2502"><a href="#cb85-2502" aria-hidden="true" tabindex="-1"></a>]</span>
<span id="cb85-2503"><a href="#cb85-2503" aria-hidden="true" tabindex="-1"></a>borders <span class="op">=</span> topojson<span class="op">.</span><span class="fu">mesh</span>(countries<span class="op">,</span> countries<span class="op">.</span><span class="at">objects</span><span class="op">.</span><span class="at">countries</span><span class="op">,</span> (a<span class="op">,</span> b) <span class="kw">=&gt;</span> a <span class="op">!==</span> b)</span>
<span id="cb85-2504"><a href="#cb85-2504" aria-hidden="true" tabindex="-1"></a>countries <span class="op">=</span> <span class="fu">fetch</span>(<span class="st">"https://cdn.jsdelivr.net/npm/world-atlas@2/countries-50m.json"</span>)<span class="op">.</span><span class="fu">then</span>(response <span class="kw">=&gt;</span> response<span class="op">.</span><span class="fu">json</span>())</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-display hidden">
<div>
<div id="ojs-cell-25-210" data-nodetype="declaration">

</div>
</div>
</div>
<div class="cell-output cell-output-display hidden">
<div>
<div id="ojs-cell-25-211" data-nodetype="declaration">

</div>
</div>
</div>
<div class="cell-output cell-output-display hidden">
<div>
<div id="ojs-cell-25-212" data-nodetype="declaration">

</div>
</div>
</div>
<div class="cell-output cell-output-display hidden">
<div>
<div id="ojs-cell-25-213" data-nodetype="declaration">

</div>
</div>
</div>
<div class="cell-output cell-output-display hidden">
<div>
<div id="ojs-cell-25-214" data-nodetype="declaration">

</div>
</div>
</div>
<div class="cell-output cell-output-display hidden">
<div>
<div id="ojs-cell-25-215" data-nodetype="declaration">

</div>
</div>
</div>
<div class="cell-output cell-output-display hidden">
<div>
<div id="ojs-cell-25-216" data-nodetype="declaration">

</div>
</div>
</div>
<div class="cell-output cell-output-display hidden">
<div>
<div id="ojs-cell-25-217" data-nodetype="declaration">

</div>
</div>
</div>
<div class="cell-output cell-output-display hidden">
<div>
<div id="ojs-cell-25-218" data-nodetype="declaration">

</div>
</div>
</div>
<div class="cell-output cell-output-display hidden">
<div>
<div id="ojs-cell-25-219" data-nodetype="declaration">

</div>
</div>
</div>
<div class="cell-output cell-output-display hidden">
<div>
<div id="ojs-cell-25-220" data-nodetype="declaration">

</div>
</div>
</div>
<div class="cell-output cell-output-display hidden">
<div>
<div id="ojs-cell-25-221" data-nodetype="declaration">

</div>
</div>
</div>
<div class="cell-output cell-output-display hidden">
<div>
<div id="ojs-cell-25-222" data-nodetype="declaration">

</div>
</div>
</div>
<div class="cell-output cell-output-display hidden">
<div>
<div id="ojs-cell-25-223" data-nodetype="declaration">

</div>
</div>
</div>
<div class="cell-output cell-output-display hidden">
<div>
<div id="ojs-cell-25-224" data-nodetype="declaration">

</div>
</div>
</div>
<div class="cell-output cell-output-display hidden">
<div>
<div id="ojs-cell-25-225" data-nodetype="declaration">

</div>
</div>
</div>
<div class="cell-output cell-output-display hidden">
<div>
<div id="ojs-cell-25-226" data-nodetype="declaration">

</div>
</div>
</div>
<div class="cell-output cell-output-display hidden">
<div>
<div id="ojs-cell-25-227" data-nodetype="declaration">

</div>
</div>
</div>
<div class="cell-output cell-output-display hidden">
<div>
<div id="ojs-cell-25-228" data-nodetype="declaration">

</div>
</div>
</div>
<div class="cell-output cell-output-display hidden">
<div>
<div id="ojs-cell-25-229" data-nodetype="declaration">

</div>
</div>
</div>
</div>
<div class="cell hidden clock">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code hidden" id="cb86" data-startfrom="2511" data-source-offset="0"><pre class="sourceCode js code-with-copy"><code class="sourceCode javascript" style="counter-reset: source-line 2510;"><span id="cb86-2511"><a href="#cb86-2511" aria-hidden="true" tabindex="-1"></a><span class="co">// https://observablehq.com/@d3/simple-clock</span></span>
<span id="cb86-2512"><a href="#cb86-2512" aria-hidden="true" tabindex="-1"></a><span class="co">// https://observablehq.com/@drio/lets-build-an-analog-clock</span></span>
<span id="cb86-2513"><a href="#cb86-2513" aria-hidden="true" tabindex="-1"></a>clock <span class="op">=</span> {</span>
<span id="cb86-2514"><a href="#cb86-2514" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> clockRadius <span class="op">=</span> <span class="dv">200</span><span class="op">,</span></span>
<span id="cb86-2515"><a href="#cb86-2515" aria-hidden="true" tabindex="-1"></a>    margin <span class="op">=</span> <span class="dv">50</span><span class="op">,</span></span>
<span id="cb86-2516"><a href="#cb86-2516" aria-hidden="true" tabindex="-1"></a>    w <span class="op">=</span> (clockRadius <span class="op">+</span> margin) <span class="op">*</span> <span class="dv">2</span><span class="op">,</span></span>
<span id="cb86-2517"><a href="#cb86-2517" aria-hidden="true" tabindex="-1"></a>    h <span class="op">=</span> (clockRadius <span class="op">+</span> margin) <span class="op">*</span> <span class="dv">2</span><span class="op">,</span></span>
<span id="cb86-2518"><a href="#cb86-2518" aria-hidden="true" tabindex="-1"></a>    hourHandLength <span class="op">=</span> (<span class="dv">2</span> <span class="op">*</span> clockRadius) <span class="op">/</span> <span class="dv">3</span><span class="op">,</span></span>
<span id="cb86-2519"><a href="#cb86-2519" aria-hidden="true" tabindex="-1"></a>    minuteHandLength <span class="op">=</span> clockRadius<span class="op">,</span></span>
<span id="cb86-2520"><a href="#cb86-2520" aria-hidden="true" tabindex="-1"></a>    secondHandLength <span class="op">=</span> clockRadius <span class="op">-</span> <span class="dv">12</span><span class="op">,</span></span>
<span id="cb86-2521"><a href="#cb86-2521" aria-hidden="true" tabindex="-1"></a>    secondHandBalance <span class="op">=</span> <span class="dv">30</span><span class="op">,</span></span>
<span id="cb86-2522"><a href="#cb86-2522" aria-hidden="true" tabindex="-1"></a>    secondTickStart <span class="op">=</span> clockRadius<span class="op">,</span></span>
<span id="cb86-2523"><a href="#cb86-2523" aria-hidden="true" tabindex="-1"></a>    secondTickLength <span class="op">=</span> <span class="op">-</span><span class="dv">10</span><span class="op">,</span></span>
<span id="cb86-2524"><a href="#cb86-2524" aria-hidden="true" tabindex="-1"></a>    hourTickStart <span class="op">=</span> clockRadius<span class="op">,</span></span>
<span id="cb86-2525"><a href="#cb86-2525" aria-hidden="true" tabindex="-1"></a>    hourTickLength <span class="op">=</span> <span class="op">-</span><span class="dv">18</span><span class="op">,</span></span>
<span id="cb86-2526"><a href="#cb86-2526" aria-hidden="true" tabindex="-1"></a>    secondLabelRadius <span class="op">=</span> clockRadius <span class="op">+</span> <span class="dv">16</span><span class="op">,</span></span>
<span id="cb86-2527"><a href="#cb86-2527" aria-hidden="true" tabindex="-1"></a>    secondLabelYOffset <span class="op">=</span> <span class="dv">5</span><span class="op">,</span></span>
<span id="cb86-2528"><a href="#cb86-2528" aria-hidden="true" tabindex="-1"></a>    hourLabelRadius <span class="op">=</span> clockRadius <span class="op">-</span> <span class="dv">40</span><span class="op">,</span></span>
<span id="cb86-2529"><a href="#cb86-2529" aria-hidden="true" tabindex="-1"></a>    hourLabelYOffset <span class="op">=</span> <span class="dv">7</span><span class="op">,</span></span>
<span id="cb86-2530"><a href="#cb86-2530" aria-hidden="true" tabindex="-1"></a>    radians <span class="op">=</span> <span class="bu">Math</span><span class="op">.</span><span class="cn">PI</span> <span class="op">/</span> <span class="dv">180</span><span class="op">;</span></span>
<span id="cb86-2531"><a href="#cb86-2531" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> ten <span class="op">=</span> d3</span>
<span id="cb86-2532"><a href="#cb86-2532" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">scaleLinear</span>()</span>
<span id="cb86-2533"><a href="#cb86-2533" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">range</span>([<span class="dv">0</span><span class="op">,</span> <span class="dv">360</span>])</span>
<span id="cb86-2534"><a href="#cb86-2534" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">domain</span>([<span class="dv">0</span><span class="op">,</span> <span class="dv">10</span>])<span class="op">;</span></span>
<span id="cb86-2535"><a href="#cb86-2535" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> sto <span class="op">=</span> d3</span>
<span id="cb86-2536"><a href="#cb86-2536" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">scaleLinear</span>()</span>
<span id="cb86-2537"><a href="#cb86-2537" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">range</span>([<span class="dv">0</span><span class="op">,</span> <span class="dv">360</span>])</span>
<span id="cb86-2538"><a href="#cb86-2538" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">domain</span>([<span class="dv">0</span><span class="op">,</span> <span class="dv">100</span>])<span class="op">;</span></span>
<span id="cb86-2539"><a href="#cb86-2539" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> handData <span class="op">=</span> [</span>
<span id="cb86-2540"><a href="#cb86-2540" aria-hidden="true" tabindex="-1"></a>    {</span>
<span id="cb86-2541"><a href="#cb86-2541" aria-hidden="true" tabindex="-1"></a>      <span class="dt">type</span><span class="op">:</span> <span class="st">"hour"</span><span class="op">,</span></span>
<span id="cb86-2542"><a href="#cb86-2542" aria-hidden="true" tabindex="-1"></a>      <span class="dt">value</span><span class="op">:</span> <span class="dv">0</span><span class="op">,</span></span>
<span id="cb86-2543"><a href="#cb86-2543" aria-hidden="true" tabindex="-1"></a>      <span class="dt">length</span><span class="op">:</span> <span class="op">-</span>hourHandLength<span class="op">,</span></span>
<span id="cb86-2544"><a href="#cb86-2544" aria-hidden="true" tabindex="-1"></a>      <span class="dt">scale</span><span class="op">:</span> ten</span>
<span id="cb86-2545"><a href="#cb86-2545" aria-hidden="true" tabindex="-1"></a>    }<span class="op">,</span></span>
<span id="cb86-2546"><a href="#cb86-2546" aria-hidden="true" tabindex="-1"></a>    {</span>
<span id="cb86-2547"><a href="#cb86-2547" aria-hidden="true" tabindex="-1"></a>      <span class="dt">type</span><span class="op">:</span> <span class="st">"minute"</span><span class="op">,</span></span>
<span id="cb86-2548"><a href="#cb86-2548" aria-hidden="true" tabindex="-1"></a>      <span class="dt">value</span><span class="op">:</span> <span class="dv">0</span><span class="op">,</span></span>
<span id="cb86-2549"><a href="#cb86-2549" aria-hidden="true" tabindex="-1"></a>      <span class="dt">length</span><span class="op">:</span> <span class="op">-</span>minuteHandLength<span class="op">,</span></span>
<span id="cb86-2550"><a href="#cb86-2550" aria-hidden="true" tabindex="-1"></a>      <span class="dt">scale</span><span class="op">:</span> sto</span>
<span id="cb86-2551"><a href="#cb86-2551" aria-hidden="true" tabindex="-1"></a>    }<span class="op">,</span></span>
<span id="cb86-2552"><a href="#cb86-2552" aria-hidden="true" tabindex="-1"></a>    {</span>
<span id="cb86-2553"><a href="#cb86-2553" aria-hidden="true" tabindex="-1"></a>      <span class="dt">type</span><span class="op">:</span> <span class="st">"second"</span><span class="op">,</span></span>
<span id="cb86-2554"><a href="#cb86-2554" aria-hidden="true" tabindex="-1"></a>      <span class="dt">value</span><span class="op">:</span> <span class="dv">0</span><span class="op">,</span></span>
<span id="cb86-2555"><a href="#cb86-2555" aria-hidden="true" tabindex="-1"></a>      <span class="dt">length</span><span class="op">:</span> <span class="op">-</span>secondHandLength<span class="op">,</span></span>
<span id="cb86-2556"><a href="#cb86-2556" aria-hidden="true" tabindex="-1"></a>      <span class="dt">scale</span><span class="op">:</span> sto<span class="op">,</span></span>
<span id="cb86-2557"><a href="#cb86-2557" aria-hidden="true" tabindex="-1"></a>      <span class="dt">balance</span><span class="op">:</span> secondHandBalance</span>
<span id="cb86-2558"><a href="#cb86-2558" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb86-2559"><a href="#cb86-2559" aria-hidden="true" tabindex="-1"></a>  ]<span class="op">;</span></span>
<span id="cb86-2560"><a href="#cb86-2560" aria-hidden="true" tabindex="-1"></a>  <span class="kw">function</span> <span class="fu">drawClock</span>() {</span>
<span id="cb86-2561"><a href="#cb86-2561" aria-hidden="true" tabindex="-1"></a>    <span class="co">// create all the clock elements</span></span>
<span id="cb86-2562"><a href="#cb86-2562" aria-hidden="true" tabindex="-1"></a>    <span class="fu">updateData</span>()<span class="op">;</span> <span class="co">//draw them in the correct starting position</span></span>
<span id="cb86-2563"><a href="#cb86-2563" aria-hidden="true" tabindex="-1"></a>    <span class="kw">const</span> face <span class="op">=</span> svg</span>
<span id="cb86-2564"><a href="#cb86-2564" aria-hidden="true" tabindex="-1"></a>      <span class="op">.</span><span class="fu">append</span>(<span class="st">"g"</span>)</span>
<span id="cb86-2565"><a href="#cb86-2565" aria-hidden="true" tabindex="-1"></a>      <span class="op">.</span><span class="fu">attr</span>(<span class="st">"id"</span><span class="op">,</span> <span class="st">"clock-face"</span>)</span>
<span id="cb86-2566"><a href="#cb86-2566" aria-hidden="true" tabindex="-1"></a>      <span class="op">.</span><span class="fu">attr</span>(<span class="st">"transform"</span><span class="op">,</span> <span class="vs">`translate(</span><span class="sc">${</span>[w <span class="op">/</span> <span class="dv">2</span><span class="op">,</span> h <span class="op">/</span> <span class="dv">2</span>]<span class="sc">}</span><span class="vs">)`</span>)<span class="op">;</span></span>
<span id="cb86-2567"><a href="#cb86-2567" aria-hidden="true" tabindex="-1"></a>    <span class="co">// add marks for seconds</span></span>
<span id="cb86-2568"><a href="#cb86-2568" aria-hidden="true" tabindex="-1"></a>    face</span>
<span id="cb86-2569"><a href="#cb86-2569" aria-hidden="true" tabindex="-1"></a>      <span class="op">.</span><span class="fu">selectAll</span>(<span class="st">".second-tick"</span>)</span>
<span id="cb86-2570"><a href="#cb86-2570" aria-hidden="true" tabindex="-1"></a>      <span class="op">.</span><span class="fu">data</span>(d3<span class="op">.</span><span class="fu">range</span>(<span class="dv">0</span><span class="op">,</span> <span class="dv">100</span>))</span>
<span id="cb86-2571"><a href="#cb86-2571" aria-hidden="true" tabindex="-1"></a>      <span class="op">.</span><span class="fu">enter</span>()</span>
<span id="cb86-2572"><a href="#cb86-2572" aria-hidden="true" tabindex="-1"></a>      <span class="op">.</span><span class="fu">append</span>(<span class="st">"line"</span>)</span>
<span id="cb86-2573"><a href="#cb86-2573" aria-hidden="true" tabindex="-1"></a>      <span class="op">.</span><span class="fu">attr</span>(<span class="st">"class"</span><span class="op">,</span> <span class="st">"second-tick"</span>)</span>
<span id="cb86-2574"><a href="#cb86-2574" aria-hidden="true" tabindex="-1"></a>      <span class="op">.</span><span class="fu">attr</span>(<span class="st">"x1"</span><span class="op">,</span> <span class="dv">0</span>)</span>
<span id="cb86-2575"><a href="#cb86-2575" aria-hidden="true" tabindex="-1"></a>      <span class="op">.</span><span class="fu">attr</span>(<span class="st">"x2"</span><span class="op">,</span> <span class="dv">0</span>)</span>
<span id="cb86-2576"><a href="#cb86-2576" aria-hidden="true" tabindex="-1"></a>      <span class="op">.</span><span class="fu">attr</span>(<span class="st">"y1"</span><span class="op">,</span> secondTickStart)</span>
<span id="cb86-2577"><a href="#cb86-2577" aria-hidden="true" tabindex="-1"></a>      <span class="op">.</span><span class="fu">attr</span>(<span class="st">"y2"</span><span class="op">,</span> secondTickStart <span class="op">+</span> secondTickLength)</span>
<span id="cb86-2578"><a href="#cb86-2578" aria-hidden="true" tabindex="-1"></a>      <span class="op">.</span><span class="fu">attr</span>(<span class="st">"transform"</span><span class="op">,</span> d <span class="kw">=&gt;</span> <span class="vs">`rotate(</span><span class="sc">${</span><span class="fu">sto</span>(d)<span class="sc">}</span><span class="vs">)`</span>)<span class="op">;</span></span>
<span id="cb86-2579"><a href="#cb86-2579" aria-hidden="true" tabindex="-1"></a>    <span class="co">// and labels...</span></span>
<span id="cb86-2580"><a href="#cb86-2580" aria-hidden="true" tabindex="-1"></a>    face</span>
<span id="cb86-2581"><a href="#cb86-2581" aria-hidden="true" tabindex="-1"></a>      <span class="op">.</span><span class="fu">selectAll</span>(<span class="st">".second-label"</span>)</span>
<span id="cb86-2582"><a href="#cb86-2582" aria-hidden="true" tabindex="-1"></a>      <span class="op">.</span><span class="fu">data</span>(d3<span class="op">.</span><span class="fu">range</span>(<span class="dv">0</span><span class="op">,</span> <span class="dv">100</span><span class="op">,</span> <span class="dv">5</span>))</span>
<span id="cb86-2583"><a href="#cb86-2583" aria-hidden="true" tabindex="-1"></a>      <span class="op">.</span><span class="fu">enter</span>()</span>
<span id="cb86-2584"><a href="#cb86-2584" aria-hidden="true" tabindex="-1"></a>      <span class="op">.</span><span class="fu">append</span>(<span class="st">"text"</span>)</span>
<span id="cb86-2585"><a href="#cb86-2585" aria-hidden="true" tabindex="-1"></a>      <span class="op">.</span><span class="fu">attr</span>(<span class="st">"class"</span><span class="op">,</span> <span class="st">"second-label"</span>)</span>
<span id="cb86-2586"><a href="#cb86-2586" aria-hidden="true" tabindex="-1"></a>      <span class="op">.</span><span class="fu">attr</span>(<span class="st">"text-anchor"</span><span class="op">,</span> <span class="st">"middle"</span>)</span>
<span id="cb86-2587"><a href="#cb86-2587" aria-hidden="true" tabindex="-1"></a>      <span class="op">.</span><span class="fu">attr</span>(<span class="st">"x"</span><span class="op">,</span> d <span class="kw">=&gt;</span> secondLabelRadius <span class="op">*</span> <span class="bu">Math</span><span class="op">.</span><span class="fu">sin</span>(<span class="fu">sto</span>(d) <span class="op">*</span> radians))</span>
<span id="cb86-2588"><a href="#cb86-2588" aria-hidden="true" tabindex="-1"></a>      <span class="op">.</span><span class="fu">attr</span>(</span>
<span id="cb86-2589"><a href="#cb86-2589" aria-hidden="true" tabindex="-1"></a>        <span class="st">"y"</span><span class="op">,</span></span>
<span id="cb86-2590"><a href="#cb86-2590" aria-hidden="true" tabindex="-1"></a>        d <span class="kw">=&gt;</span></span>
<span id="cb86-2591"><a href="#cb86-2591" aria-hidden="true" tabindex="-1"></a>          <span class="op">-</span>secondLabelRadius <span class="op">*</span> <span class="bu">Math</span><span class="op">.</span><span class="fu">cos</span>(<span class="fu">sto</span>(d) <span class="op">*</span> radians) <span class="op">+</span> secondLabelYOffset</span>
<span id="cb86-2592"><a href="#cb86-2592" aria-hidden="true" tabindex="-1"></a>      )</span>
<span id="cb86-2593"><a href="#cb86-2593" aria-hidden="true" tabindex="-1"></a>      <span class="op">.</span><span class="fu">text</span>(d <span class="kw">=&gt;</span> d)<span class="op">;</span></span>
<span id="cb86-2594"><a href="#cb86-2594" aria-hidden="true" tabindex="-1"></a>    <span class="co">// ... and hours</span></span>
<span id="cb86-2595"><a href="#cb86-2595" aria-hidden="true" tabindex="-1"></a>    face</span>
<span id="cb86-2596"><a href="#cb86-2596" aria-hidden="true" tabindex="-1"></a>      <span class="op">.</span><span class="fu">selectAll</span>(<span class="st">".hour-tick"</span>)</span>
<span id="cb86-2597"><a href="#cb86-2597" aria-hidden="true" tabindex="-1"></a>      <span class="op">.</span><span class="fu">data</span>(d3<span class="op">.</span><span class="fu">range</span>(<span class="dv">0</span><span class="op">,</span> <span class="dv">10</span><span class="op">,</span> <span class="dv">1</span>))</span>
<span id="cb86-2598"><a href="#cb86-2598" aria-hidden="true" tabindex="-1"></a>      <span class="op">.</span><span class="fu">enter</span>()</span>
<span id="cb86-2599"><a href="#cb86-2599" aria-hidden="true" tabindex="-1"></a>      <span class="op">.</span><span class="fu">append</span>(<span class="st">"line"</span>)</span>
<span id="cb86-2600"><a href="#cb86-2600" aria-hidden="true" tabindex="-1"></a>      <span class="op">.</span><span class="fu">attr</span>(<span class="st">"class"</span><span class="op">,</span> <span class="st">"hour-tick"</span>)</span>
<span id="cb86-2601"><a href="#cb86-2601" aria-hidden="true" tabindex="-1"></a>      <span class="op">.</span><span class="fu">attr</span>(<span class="st">"x1"</span><span class="op">,</span> <span class="dv">0</span>)</span>
<span id="cb86-2602"><a href="#cb86-2602" aria-hidden="true" tabindex="-1"></a>      <span class="op">.</span><span class="fu">attr</span>(<span class="st">"x2"</span><span class="op">,</span> <span class="dv">0</span>)</span>
<span id="cb86-2603"><a href="#cb86-2603" aria-hidden="true" tabindex="-1"></a>      <span class="op">.</span><span class="fu">attr</span>(<span class="st">"y1"</span><span class="op">,</span> hourTickStart)</span>
<span id="cb86-2604"><a href="#cb86-2604" aria-hidden="true" tabindex="-1"></a>      <span class="op">.</span><span class="fu">attr</span>(<span class="st">"y2"</span><span class="op">,</span> hourTickStart <span class="op">+</span> hourTickLength)</span>
<span id="cb86-2605"><a href="#cb86-2605" aria-hidden="true" tabindex="-1"></a>      <span class="op">.</span><span class="fu">attr</span>(<span class="st">"transform"</span><span class="op">,</span> d <span class="kw">=&gt;</span> <span class="vs">`rotate(</span><span class="sc">${</span><span class="fu">ten</span>(d)<span class="sc">}</span><span class="vs">)`</span>)<span class="op">;</span></span>
<span id="cb86-2606"><a href="#cb86-2606" aria-hidden="true" tabindex="-1"></a>    face</span>
<span id="cb86-2607"><a href="#cb86-2607" aria-hidden="true" tabindex="-1"></a>      <span class="op">.</span><span class="fu">selectAll</span>(<span class="st">".hour-label"</span>)</span>
<span id="cb86-2608"><a href="#cb86-2608" aria-hidden="true" tabindex="-1"></a>      <span class="op">.</span><span class="fu">data</span>(d3<span class="op">.</span><span class="fu">range</span>(<span class="dv">0</span><span class="op">,</span> <span class="dv">10</span><span class="op">,</span> <span class="dv">1</span>))</span>
<span id="cb86-2609"><a href="#cb86-2609" aria-hidden="true" tabindex="-1"></a>      <span class="op">.</span><span class="fu">enter</span>()</span>
<span id="cb86-2610"><a href="#cb86-2610" aria-hidden="true" tabindex="-1"></a>      <span class="op">.</span><span class="fu">append</span>(<span class="st">"text"</span>)</span>
<span id="cb86-2611"><a href="#cb86-2611" aria-hidden="true" tabindex="-1"></a>      <span class="op">.</span><span class="fu">attr</span>(<span class="st">"class"</span><span class="op">,</span> <span class="st">"hour-label"</span>)</span>
<span id="cb86-2612"><a href="#cb86-2612" aria-hidden="true" tabindex="-1"></a>      <span class="op">.</span><span class="fu">attr</span>(<span class="st">"text-anchor"</span><span class="op">,</span> <span class="st">"middle"</span>)</span>
<span id="cb86-2613"><a href="#cb86-2613" aria-hidden="true" tabindex="-1"></a>      <span class="op">.</span><span class="fu">attr</span>(<span class="st">"x"</span><span class="op">,</span> d <span class="kw">=&gt;</span> hourLabelRadius <span class="op">*</span> <span class="bu">Math</span><span class="op">.</span><span class="fu">sin</span>(<span class="fu">ten</span>(d) <span class="op">*</span> radians))</span>
<span id="cb86-2614"><a href="#cb86-2614" aria-hidden="true" tabindex="-1"></a>      <span class="op">.</span><span class="fu">attr</span>(</span>
<span id="cb86-2615"><a href="#cb86-2615" aria-hidden="true" tabindex="-1"></a>        <span class="st">"y"</span><span class="op">,</span></span>
<span id="cb86-2616"><a href="#cb86-2616" aria-hidden="true" tabindex="-1"></a>        d <span class="kw">=&gt;</span> <span class="op">-</span>hourLabelRadius <span class="op">*</span> <span class="bu">Math</span><span class="op">.</span><span class="fu">cos</span>(<span class="fu">ten</span>(d) <span class="op">*</span> radians) <span class="op">+</span> hourLabelYOffset</span>
<span id="cb86-2617"><a href="#cb86-2617" aria-hidden="true" tabindex="-1"></a>      )</span>
<span id="cb86-2618"><a href="#cb86-2618" aria-hidden="true" tabindex="-1"></a>      <span class="op">.</span><span class="fu">text</span>(d <span class="kw">=&gt;</span> d)<span class="op">;</span></span>
<span id="cb86-2619"><a href="#cb86-2619" aria-hidden="true" tabindex="-1"></a>    <span class="kw">const</span> hands <span class="op">=</span> face<span class="op">.</span><span class="fu">append</span>(<span class="st">"g"</span>)<span class="op">.</span><span class="fu">attr</span>(<span class="st">"id"</span><span class="op">,</span> <span class="st">"clock-hands"</span>)<span class="op">;</span></span>
<span id="cb86-2620"><a href="#cb86-2620" aria-hidden="true" tabindex="-1"></a>    hands</span>
<span id="cb86-2621"><a href="#cb86-2621" aria-hidden="true" tabindex="-1"></a>      <span class="op">.</span><span class="fu">selectAll</span>(<span class="st">"line"</span>)</span>
<span id="cb86-2622"><a href="#cb86-2622" aria-hidden="true" tabindex="-1"></a>      <span class="op">.</span><span class="fu">data</span>(handData)</span>
<span id="cb86-2623"><a href="#cb86-2623" aria-hidden="true" tabindex="-1"></a>      <span class="op">.</span><span class="fu">enter</span>()</span>
<span id="cb86-2624"><a href="#cb86-2624" aria-hidden="true" tabindex="-1"></a>      <span class="op">.</span><span class="fu">append</span>(<span class="st">"line"</span>)</span>
<span id="cb86-2625"><a href="#cb86-2625" aria-hidden="true" tabindex="-1"></a>      <span class="op">.</span><span class="fu">attr</span>(<span class="st">"class"</span><span class="op">,</span> d <span class="kw">=&gt;</span> d<span class="op">.</span><span class="at">type</span> <span class="op">+</span> <span class="st">"-hand"</span>)</span>
<span id="cb86-2626"><a href="#cb86-2626" aria-hidden="true" tabindex="-1"></a>      <span class="op">.</span><span class="fu">attr</span>(<span class="st">"x1"</span><span class="op">,</span> <span class="dv">0</span>)</span>
<span id="cb86-2627"><a href="#cb86-2627" aria-hidden="true" tabindex="-1"></a>      <span class="op">.</span><span class="fu">attr</span>(<span class="st">"y1"</span><span class="op">,</span> d <span class="kw">=&gt;</span> d<span class="op">.</span><span class="at">balance</span> <span class="op">||</span> <span class="dv">0</span>)</span>
<span id="cb86-2628"><a href="#cb86-2628" aria-hidden="true" tabindex="-1"></a>      <span class="op">.</span><span class="fu">attr</span>(<span class="st">"x2"</span><span class="op">,</span> <span class="dv">0</span>)</span>
<span id="cb86-2629"><a href="#cb86-2629" aria-hidden="true" tabindex="-1"></a>      <span class="op">.</span><span class="fu">attr</span>(<span class="st">"y2"</span><span class="op">,</span> d <span class="kw">=&gt;</span> d<span class="op">.</span><span class="at">length</span>)</span>
<span id="cb86-2630"><a href="#cb86-2630" aria-hidden="true" tabindex="-1"></a>      <span class="op">.</span><span class="fu">attr</span>(<span class="st">"transform"</span><span class="op">,</span> d <span class="kw">=&gt;</span> <span class="vs">`rotate(</span><span class="sc">${</span>d<span class="op">.</span><span class="fu">scale</span>(d<span class="op">.</span><span class="at">value</span>)<span class="sc">}</span><span class="vs">)`</span>)<span class="op">;</span></span>
<span id="cb86-2631"><a href="#cb86-2631" aria-hidden="true" tabindex="-1"></a>    face</span>
<span id="cb86-2632"><a href="#cb86-2632" aria-hidden="true" tabindex="-1"></a>      <span class="op">.</span><span class="fu">append</span>(<span class="st">"g"</span>)</span>
<span id="cb86-2633"><a href="#cb86-2633" aria-hidden="true" tabindex="-1"></a>      <span class="op">.</span><span class="fu">attr</span>(<span class="st">"id"</span><span class="op">,</span> <span class="st">"face-overlay"</span>)</span>
<span id="cb86-2634"><a href="#cb86-2634" aria-hidden="true" tabindex="-1"></a>      <span class="op">.</span><span class="fu">append</span>(<span class="st">"circle"</span>)</span>
<span id="cb86-2635"><a href="#cb86-2635" aria-hidden="true" tabindex="-1"></a>      <span class="op">.</span><span class="fu">attr</span>(<span class="st">"class"</span><span class="op">,</span> <span class="st">"hands-cover"</span>)</span>
<span id="cb86-2636"><a href="#cb86-2636" aria-hidden="true" tabindex="-1"></a>      <span class="op">.</span><span class="fu">attr</span>(<span class="st">"x"</span><span class="op">,</span> <span class="dv">0</span>)</span>
<span id="cb86-2637"><a href="#cb86-2637" aria-hidden="true" tabindex="-1"></a>      <span class="op">.</span><span class="fu">attr</span>(<span class="st">"y"</span><span class="op">,</span> <span class="dv">0</span>)</span>
<span id="cb86-2638"><a href="#cb86-2638" aria-hidden="true" tabindex="-1"></a>      <span class="op">.</span><span class="fu">attr</span>(<span class="st">"r"</span><span class="op">,</span> clockRadius <span class="op">/</span> <span class="dv">20</span>)<span class="op">;</span></span>
<span id="cb86-2639"><a href="#cb86-2639" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb86-2640"><a href="#cb86-2640" aria-hidden="true" tabindex="-1"></a>  <span class="kw">function</span> <span class="fu">moveHands</span>() {</span>
<span id="cb86-2641"><a href="#cb86-2641" aria-hidden="true" tabindex="-1"></a>    <span class="kw">const</span> sel <span class="op">=</span> d3</span>
<span id="cb86-2642"><a href="#cb86-2642" aria-hidden="true" tabindex="-1"></a>      <span class="op">.</span><span class="fu">select</span>(<span class="st">"#clock-hands-final"</span>)</span>
<span id="cb86-2643"><a href="#cb86-2643" aria-hidden="true" tabindex="-1"></a>      <span class="op">.</span><span class="fu">selectAll</span>(<span class="st">"line"</span>)</span>
<span id="cb86-2644"><a href="#cb86-2644" aria-hidden="true" tabindex="-1"></a>      <span class="op">.</span><span class="fu">data</span>(handData)</span>
<span id="cb86-2645"><a href="#cb86-2645" aria-hidden="true" tabindex="-1"></a>      <span class="op">.</span><span class="fu">transition</span>()<span class="op">;</span></span>
<span id="cb86-2646"><a href="#cb86-2646" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> (fancySecondsOFF) sel<span class="op">.</span><span class="fu">ease</span>(d3<span class="op">.</span><span class="at">easeElastic</span><span class="op">.</span><span class="fu">period</span>(<span class="fl">0.5</span>))<span class="op">;</span></span>
<span id="cb86-2647"><a href="#cb86-2647" aria-hidden="true" tabindex="-1"></a>    sel<span class="op">.</span><span class="fu">attr</span>(<span class="st">"transform"</span><span class="op">,</span> d <span class="kw">=&gt;</span> <span class="vs">`rotate(</span><span class="sc">${</span>d<span class="op">.</span><span class="fu">scale</span>(d<span class="op">.</span><span class="at">value</span>)<span class="sc">}</span><span class="vs">)`</span>)<span class="op">;</span></span>
<span id="cb86-2648"><a href="#cb86-2648" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb86-2649"><a href="#cb86-2649" aria-hidden="true" tabindex="-1"></a>  <span class="kw">function</span> <span class="fu">updateData</span>() {</span>
<span id="cb86-2650"><a href="#cb86-2650" aria-hidden="true" tabindex="-1"></a>    handData[<span class="dv">0</span>]<span class="op">.</span><span class="at">value</span> <span class="op">=</span> <span class="op">!</span>fancySecondsOFF <span class="op">?</span> <span class="bu">Math</span><span class="op">.</span><span class="fu">floor</span>(selectedExact <span class="op">*</span> <span class="dv">10</span>) <span class="op">:</span> decTime[<span class="dv">0</span>]<span class="op">;</span></span>
<span id="cb86-2651"><a href="#cb86-2651" aria-hidden="true" tabindex="-1"></a>    handData[<span class="dv">1</span>]<span class="op">.</span><span class="at">value</span> <span class="op">=</span> <span class="op">!</span>fancySecondsOFF <span class="op">?</span> <span class="bu">Math</span><span class="op">.</span><span class="fu">floor</span>(selectedExact <span class="op">*</span> <span class="dv">10</span> <span class="op">%</span> <span class="dv">1</span> <span class="op">*</span> <span class="dv">100</span>) <span class="op">:</span> decTime<span class="op">.</span><span class="fu">slice</span>(<span class="dv">2</span><span class="op">,</span> <span class="dv">4</span>)<span class="op">;</span></span>
<span id="cb86-2652"><a href="#cb86-2652" aria-hidden="true" tabindex="-1"></a>    handData[<span class="dv">2</span>]<span class="op">.</span><span class="at">value</span> <span class="op">=</span> <span class="op">!</span>fancySecondsOFF <span class="op">?</span> selectedExact <span class="op">*</span> <span class="dv">10</span> <span class="op">%</span> <span class="dv">1</span> <span class="op">*</span> <span class="dv">100</span> <span class="op">%</span> <span class="dv">1</span> <span class="op">*</span> <span class="dv">100</span> <span class="op">:</span> decTime<span class="op">.</span><span class="fu">slice</span>(<span class="dv">4</span><span class="op">,</span> <span class="dv">6</span>)<span class="op">;</span></span>
<span id="cb86-2653"><a href="#cb86-2653" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb86-2654"><a href="#cb86-2654" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> svg <span class="op">=</span> d3</span>
<span id="cb86-2655"><a href="#cb86-2655" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">create</span>(<span class="st">"svg"</span>)</span>
<span id="cb86-2656"><a href="#cb86-2656" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">"viewBox"</span><span class="op">,</span> [<span class="dv">0</span><span class="op">,</span> <span class="dv">0</span><span class="op">,</span> w<span class="op">,</span> h])</span>
<span id="cb86-2657"><a href="#cb86-2657" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">style</span>(<span class="st">"max-width"</span><span class="op">,</span> <span class="vs">`</span><span class="sc">${</span>width <span class="op">/</span> <span class="fl">2.1</span><span class="sc">}</span><span class="vs">px`</span>)</span>
<span id="cb86-2658"><a href="#cb86-2658" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">"class"</span><span class="op">,</span> <span class="st">"analogclock"</span>)</span>
<span id="cb86-2659"><a href="#cb86-2659" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">"id"</span><span class="op">,</span> <span class="st">"topclock"</span>)<span class="op">;</span></span>
<span id="cb86-2660"><a href="#cb86-2660" aria-hidden="true" tabindex="-1"></a>  svg</span>
<span id="cb86-2661"><a href="#cb86-2661" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">append</span>(<span class="st">"text"</span>)</span>
<span id="cb86-2662"><a href="#cb86-2662" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">text</span>(<span class="vs">`+</span><span class="sc">${</span>decTime<span class="sc">}</span><span class="vs">-</span><span class="sc">${</span>selectedZone<span class="sc">}</span><span class="vs">`</span>)</span>
<span id="cb86-2663"><a href="#cb86-2663" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">"x"</span><span class="op">,</span> clockRadius <span class="op">+</span> margin)</span>
<span id="cb86-2664"><a href="#cb86-2664" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">"y"</span><span class="op">,</span> clockRadius <span class="op">*</span> <span class="dv">2</span> <span class="op">+</span> margin <span class="op">*</span> <span class="fl">2.1</span>)</span>
<span id="cb86-2665"><a href="#cb86-2665" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">"text-anchor"</span><span class="op">,</span> <span class="st">"middle"</span>)</span>
<span id="cb86-2666"><a href="#cb86-2666" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">"font-size"</span><span class="op">,</span> <span class="dv">32</span>)</span>
<span id="cb86-2667"><a href="#cb86-2667" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">"font-family"</span><span class="op">,</span> <span class="st">"monospace"</span>)<span class="op">;</span></span>
<span id="cb86-2668"><a href="#cb86-2668" aria-hidden="true" tabindex="-1"></a>  <span class="fu">drawClock</span>()<span class="op">;</span></span>
<span id="cb86-2669"><a href="#cb86-2669" aria-hidden="true" tabindex="-1"></a>  <span class="co">// Animation</span></span>
<span id="cb86-2670"><a href="#cb86-2670" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> interval <span class="op">=</span> <span class="pp">setInterval</span>(</span>
<span id="cb86-2671"><a href="#cb86-2671" aria-hidden="true" tabindex="-1"></a>    () <span class="kw">=&gt;</span> {</span>
<span id="cb86-2672"><a href="#cb86-2672" aria-hidden="true" tabindex="-1"></a>      <span class="fu">updateData</span>()<span class="op">;</span></span>
<span id="cb86-2673"><a href="#cb86-2673" aria-hidden="true" tabindex="-1"></a>      <span class="fu">moveHands</span>()<span class="op">;</span></span>
<span id="cb86-2674"><a href="#cb86-2674" aria-hidden="true" tabindex="-1"></a>    }<span class="op">,</span></span>
<span id="cb86-2675"><a href="#cb86-2675" aria-hidden="true" tabindex="-1"></a>    <span class="op">!</span>fancySecondsOFF <span class="op">?</span> <span class="dv">10</span> <span class="op">:</span> <span class="dv">864</span></span>
<span id="cb86-2676"><a href="#cb86-2676" aria-hidden="true" tabindex="-1"></a>  )<span class="op">;</span></span>
<span id="cb86-2677"><a href="#cb86-2677" aria-hidden="true" tabindex="-1"></a>  invalidation<span class="op">.</span><span class="fu">then</span>(() <span class="kw">=&gt;</span> <span class="pp">clearInterval</span>(interval))<span class="op">;</span></span>
<span id="cb86-2678"><a href="#cb86-2678" aria-hidden="true" tabindex="-1"></a>  <span class="cf">return</span> svg<span class="op">.</span><span class="fu">node</span>()<span class="op">;</span></span>
<span id="cb86-2679"><a href="#cb86-2679" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div id="posclock" class="cell-output cell-output-display hidden">
<div id="ojs-cell-26" data-nodetype="declaration">

</div>
</div>
</div>
<div class="cell hidden clock">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code hidden" id="cb87" data-startfrom="2687" data-source-offset="0"><pre class="sourceCode js code-with-copy"><code class="sourceCode javascript" style="counter-reset: source-line 2686;"><span id="cb87-2687"><a href="#cb87-2687" aria-hidden="true" tabindex="-1"></a><span class="co">// https://observablehq.com/@d3/simple-clock</span></span>
<span id="cb87-2688"><a href="#cb87-2688" aria-hidden="true" tabindex="-1"></a><span class="co">// https://observablehq.com/@drio/lets-build-an-analog-clock</span></span>
<span id="cb87-2689"><a href="#cb87-2689" aria-hidden="true" tabindex="-1"></a>clock1 <span class="op">=</span> {</span>
<span id="cb87-2690"><a href="#cb87-2690" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> clockRadius <span class="op">=</span> <span class="dv">200</span><span class="op">,</span></span>
<span id="cb87-2691"><a href="#cb87-2691" aria-hidden="true" tabindex="-1"></a>    margin <span class="op">=</span> <span class="dv">50</span><span class="op">,</span></span>
<span id="cb87-2692"><a href="#cb87-2692" aria-hidden="true" tabindex="-1"></a>    w <span class="op">=</span> (clockRadius <span class="op">+</span> margin) <span class="op">*</span> <span class="dv">2</span><span class="op">,</span></span>
<span id="cb87-2693"><a href="#cb87-2693" aria-hidden="true" tabindex="-1"></a>    h <span class="op">=</span> (clockRadius <span class="op">+</span> margin) <span class="op">*</span> <span class="dv">2</span><span class="op">,</span></span>
<span id="cb87-2694"><a href="#cb87-2694" aria-hidden="true" tabindex="-1"></a>    hourHandLength <span class="op">=</span> (<span class="dv">2</span> <span class="op">*</span> clockRadius) <span class="op">/</span> <span class="dv">3</span><span class="op">,</span></span>
<span id="cb87-2695"><a href="#cb87-2695" aria-hidden="true" tabindex="-1"></a>    minuteHandLength <span class="op">=</span> clockRadius<span class="op">,</span></span>
<span id="cb87-2696"><a href="#cb87-2696" aria-hidden="true" tabindex="-1"></a>    secondHandLength <span class="op">=</span> clockRadius <span class="op">-</span> <span class="dv">12</span><span class="op">,</span></span>
<span id="cb87-2697"><a href="#cb87-2697" aria-hidden="true" tabindex="-1"></a>    secondHandBalance <span class="op">=</span> <span class="dv">30</span><span class="op">,</span></span>
<span id="cb87-2698"><a href="#cb87-2698" aria-hidden="true" tabindex="-1"></a>    secondTickStart <span class="op">=</span> clockRadius<span class="op">,</span></span>
<span id="cb87-2699"><a href="#cb87-2699" aria-hidden="true" tabindex="-1"></a>    secondTickLength <span class="op">=</span> <span class="op">-</span><span class="dv">10</span><span class="op">,</span></span>
<span id="cb87-2700"><a href="#cb87-2700" aria-hidden="true" tabindex="-1"></a>    hourTickStart <span class="op">=</span> clockRadius<span class="op">,</span></span>
<span id="cb87-2701"><a href="#cb87-2701" aria-hidden="true" tabindex="-1"></a>    hourTickLength <span class="op">=</span> <span class="op">-</span><span class="dv">18</span><span class="op">,</span></span>
<span id="cb87-2702"><a href="#cb87-2702" aria-hidden="true" tabindex="-1"></a>    secondLabelRadius <span class="op">=</span> clockRadius <span class="op">+</span> <span class="dv">16</span><span class="op">,</span></span>
<span id="cb87-2703"><a href="#cb87-2703" aria-hidden="true" tabindex="-1"></a>    secondLabelYOffset <span class="op">=</span> <span class="dv">5</span><span class="op">,</span></span>
<span id="cb87-2704"><a href="#cb87-2704" aria-hidden="true" tabindex="-1"></a>    hourLabelRadius <span class="op">=</span> clockRadius <span class="op">-</span> <span class="dv">40</span><span class="op">,</span></span>
<span id="cb87-2705"><a href="#cb87-2705" aria-hidden="true" tabindex="-1"></a>    hourLabelYOffset <span class="op">=</span> <span class="dv">7</span><span class="op">,</span></span>
<span id="cb87-2706"><a href="#cb87-2706" aria-hidden="true" tabindex="-1"></a>    radians <span class="op">=</span> <span class="bu">Math</span><span class="op">.</span><span class="cn">PI</span> <span class="op">/</span> <span class="dv">180</span><span class="op">;</span></span>
<span id="cb87-2707"><a href="#cb87-2707" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> ten <span class="op">=</span> d3</span>
<span id="cb87-2708"><a href="#cb87-2708" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">scaleLinear</span>()</span>
<span id="cb87-2709"><a href="#cb87-2709" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">range</span>([<span class="dv">0</span><span class="op">,</span> <span class="dv">360</span>])</span>
<span id="cb87-2710"><a href="#cb87-2710" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">domain</span>([<span class="dv">0</span><span class="op">,</span> <span class="dv">10</span>])<span class="op">;</span></span>
<span id="cb87-2711"><a href="#cb87-2711" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> sto <span class="op">=</span> d3</span>
<span id="cb87-2712"><a href="#cb87-2712" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">scaleLinear</span>()</span>
<span id="cb87-2713"><a href="#cb87-2713" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">range</span>([<span class="dv">0</span><span class="op">,</span> <span class="dv">360</span>])</span>
<span id="cb87-2714"><a href="#cb87-2714" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">domain</span>([<span class="dv">0</span><span class="op">,</span> <span class="dv">100</span>])<span class="op">;</span></span>
<span id="cb87-2715"><a href="#cb87-2715" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> handData <span class="op">=</span> [</span>
<span id="cb87-2716"><a href="#cb87-2716" aria-hidden="true" tabindex="-1"></a>    {</span>
<span id="cb87-2717"><a href="#cb87-2717" aria-hidden="true" tabindex="-1"></a>      <span class="dt">type</span><span class="op">:</span> <span class="st">"hour"</span><span class="op">,</span></span>
<span id="cb87-2718"><a href="#cb87-2718" aria-hidden="true" tabindex="-1"></a>      <span class="dt">value</span><span class="op">:</span> <span class="dv">0</span><span class="op">,</span></span>
<span id="cb87-2719"><a href="#cb87-2719" aria-hidden="true" tabindex="-1"></a>      <span class="dt">length</span><span class="op">:</span> <span class="op">-</span>hourHandLength<span class="op">,</span></span>
<span id="cb87-2720"><a href="#cb87-2720" aria-hidden="true" tabindex="-1"></a>      <span class="dt">scale</span><span class="op">:</span> ten</span>
<span id="cb87-2721"><a href="#cb87-2721" aria-hidden="true" tabindex="-1"></a>    }<span class="op">,</span></span>
<span id="cb87-2722"><a href="#cb87-2722" aria-hidden="true" tabindex="-1"></a>    {</span>
<span id="cb87-2723"><a href="#cb87-2723" aria-hidden="true" tabindex="-1"></a>      <span class="dt">type</span><span class="op">:</span> <span class="st">"minute"</span><span class="op">,</span></span>
<span id="cb87-2724"><a href="#cb87-2724" aria-hidden="true" tabindex="-1"></a>      <span class="dt">value</span><span class="op">:</span> <span class="dv">0</span><span class="op">,</span></span>
<span id="cb87-2725"><a href="#cb87-2725" aria-hidden="true" tabindex="-1"></a>      <span class="dt">length</span><span class="op">:</span> <span class="op">-</span>minuteHandLength<span class="op">,</span></span>
<span id="cb87-2726"><a href="#cb87-2726" aria-hidden="true" tabindex="-1"></a>      <span class="dt">scale</span><span class="op">:</span> sto</span>
<span id="cb87-2727"><a href="#cb87-2727" aria-hidden="true" tabindex="-1"></a>    }<span class="op">,</span></span>
<span id="cb87-2728"><a href="#cb87-2728" aria-hidden="true" tabindex="-1"></a>    {</span>
<span id="cb87-2729"><a href="#cb87-2729" aria-hidden="true" tabindex="-1"></a>      <span class="dt">type</span><span class="op">:</span> <span class="st">"second"</span><span class="op">,</span></span>
<span id="cb87-2730"><a href="#cb87-2730" aria-hidden="true" tabindex="-1"></a>      <span class="dt">value</span><span class="op">:</span> <span class="dv">0</span><span class="op">,</span></span>
<span id="cb87-2731"><a href="#cb87-2731" aria-hidden="true" tabindex="-1"></a>      <span class="dt">length</span><span class="op">:</span> <span class="op">-</span>secondHandLength<span class="op">,</span></span>
<span id="cb87-2732"><a href="#cb87-2732" aria-hidden="true" tabindex="-1"></a>      <span class="dt">scale</span><span class="op">:</span> sto<span class="op">,</span></span>
<span id="cb87-2733"><a href="#cb87-2733" aria-hidden="true" tabindex="-1"></a>      <span class="dt">balance</span><span class="op">:</span> secondHandBalance</span>
<span id="cb87-2734"><a href="#cb87-2734" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb87-2735"><a href="#cb87-2735" aria-hidden="true" tabindex="-1"></a>  ]<span class="op">;</span></span>
<span id="cb87-2736"><a href="#cb87-2736" aria-hidden="true" tabindex="-1"></a>  <span class="kw">function</span> <span class="fu">drawClock</span>() {</span>
<span id="cb87-2737"><a href="#cb87-2737" aria-hidden="true" tabindex="-1"></a>    <span class="co">// create all the clock elements</span></span>
<span id="cb87-2738"><a href="#cb87-2738" aria-hidden="true" tabindex="-1"></a>    <span class="fu">updateData</span>()<span class="op">;</span> <span class="co">//draw them in the correct starting position</span></span>
<span id="cb87-2739"><a href="#cb87-2739" aria-hidden="true" tabindex="-1"></a>    <span class="kw">const</span> face <span class="op">=</span> svg</span>
<span id="cb87-2740"><a href="#cb87-2740" aria-hidden="true" tabindex="-1"></a>      <span class="op">.</span><span class="fu">append</span>(<span class="st">"g"</span>)</span>
<span id="cb87-2741"><a href="#cb87-2741" aria-hidden="true" tabindex="-1"></a>      <span class="op">.</span><span class="fu">attr</span>(<span class="st">"id"</span><span class="op">,</span> <span class="st">"clock-face"</span>)</span>
<span id="cb87-2742"><a href="#cb87-2742" aria-hidden="true" tabindex="-1"></a>      <span class="op">.</span><span class="fu">attr</span>(<span class="st">"transform"</span><span class="op">,</span> <span class="vs">`translate(</span><span class="sc">${</span>[w <span class="op">/</span> <span class="dv">2</span><span class="op">,</span> h <span class="op">/</span> <span class="dv">2</span>]<span class="sc">}</span><span class="vs">)`</span>)<span class="op">;</span></span>
<span id="cb87-2743"><a href="#cb87-2743" aria-hidden="true" tabindex="-1"></a>    <span class="co">// add marks for seconds</span></span>
<span id="cb87-2744"><a href="#cb87-2744" aria-hidden="true" tabindex="-1"></a>    face</span>
<span id="cb87-2745"><a href="#cb87-2745" aria-hidden="true" tabindex="-1"></a>      <span class="op">.</span><span class="fu">selectAll</span>(<span class="st">".second-tick"</span>)</span>
<span id="cb87-2746"><a href="#cb87-2746" aria-hidden="true" tabindex="-1"></a>      <span class="op">.</span><span class="fu">data</span>(d3<span class="op">.</span><span class="fu">range</span>(<span class="dv">0</span><span class="op">,</span> <span class="dv">100</span>))</span>
<span id="cb87-2747"><a href="#cb87-2747" aria-hidden="true" tabindex="-1"></a>      <span class="op">.</span><span class="fu">enter</span>()</span>
<span id="cb87-2748"><a href="#cb87-2748" aria-hidden="true" tabindex="-1"></a>      <span class="op">.</span><span class="fu">append</span>(<span class="st">"line"</span>)</span>
<span id="cb87-2749"><a href="#cb87-2749" aria-hidden="true" tabindex="-1"></a>      <span class="op">.</span><span class="fu">attr</span>(<span class="st">"class"</span><span class="op">,</span> <span class="st">"second-tick"</span>)</span>
<span id="cb87-2750"><a href="#cb87-2750" aria-hidden="true" tabindex="-1"></a>      <span class="op">.</span><span class="fu">attr</span>(<span class="st">"x1"</span><span class="op">,</span> <span class="dv">0</span>)</span>
<span id="cb87-2751"><a href="#cb87-2751" aria-hidden="true" tabindex="-1"></a>      <span class="op">.</span><span class="fu">attr</span>(<span class="st">"x2"</span><span class="op">,</span> <span class="dv">0</span>)</span>
<span id="cb87-2752"><a href="#cb87-2752" aria-hidden="true" tabindex="-1"></a>      <span class="op">.</span><span class="fu">attr</span>(<span class="st">"y1"</span><span class="op">,</span> secondTickStart)</span>
<span id="cb87-2753"><a href="#cb87-2753" aria-hidden="true" tabindex="-1"></a>      <span class="op">.</span><span class="fu">attr</span>(<span class="st">"y2"</span><span class="op">,</span> secondTickStart <span class="op">+</span> secondTickLength)</span>
<span id="cb87-2754"><a href="#cb87-2754" aria-hidden="true" tabindex="-1"></a>      <span class="op">.</span><span class="fu">attr</span>(<span class="st">"transform"</span><span class="op">,</span> d <span class="kw">=&gt;</span> <span class="vs">`rotate(</span><span class="sc">${</span><span class="fu">sto</span>(d)<span class="sc">}</span><span class="vs">)`</span>)<span class="op">;</span></span>
<span id="cb87-2755"><a href="#cb87-2755" aria-hidden="true" tabindex="-1"></a>    <span class="co">// and labels...</span></span>
<span id="cb87-2756"><a href="#cb87-2756" aria-hidden="true" tabindex="-1"></a>    face</span>
<span id="cb87-2757"><a href="#cb87-2757" aria-hidden="true" tabindex="-1"></a>      <span class="op">.</span><span class="fu">selectAll</span>(<span class="st">".second-label"</span>)</span>
<span id="cb87-2758"><a href="#cb87-2758" aria-hidden="true" tabindex="-1"></a>      <span class="op">.</span><span class="fu">data</span>(d3<span class="op">.</span><span class="fu">range</span>(<span class="dv">0</span><span class="op">,</span> <span class="dv">100</span><span class="op">,</span> <span class="dv">5</span>))</span>
<span id="cb87-2759"><a href="#cb87-2759" aria-hidden="true" tabindex="-1"></a>      <span class="op">.</span><span class="fu">enter</span>()</span>
<span id="cb87-2760"><a href="#cb87-2760" aria-hidden="true" tabindex="-1"></a>      <span class="op">.</span><span class="fu">append</span>(<span class="st">"text"</span>)</span>
<span id="cb87-2761"><a href="#cb87-2761" aria-hidden="true" tabindex="-1"></a>      <span class="op">.</span><span class="fu">attr</span>(<span class="st">"class"</span><span class="op">,</span> <span class="st">"second-label"</span>)</span>
<span id="cb87-2762"><a href="#cb87-2762" aria-hidden="true" tabindex="-1"></a>      <span class="op">.</span><span class="fu">attr</span>(<span class="st">"text-anchor"</span><span class="op">,</span> <span class="st">"middle"</span>)</span>
<span id="cb87-2763"><a href="#cb87-2763" aria-hidden="true" tabindex="-1"></a>      <span class="op">.</span><span class="fu">attr</span>(<span class="st">"x"</span><span class="op">,</span> d <span class="kw">=&gt;</span> secondLabelRadius <span class="op">*</span> <span class="bu">Math</span><span class="op">.</span><span class="fu">sin</span>(<span class="fu">sto</span>(d) <span class="op">*</span> radians))</span>
<span id="cb87-2764"><a href="#cb87-2764" aria-hidden="true" tabindex="-1"></a>      <span class="op">.</span><span class="fu">attr</span>(</span>
<span id="cb87-2765"><a href="#cb87-2765" aria-hidden="true" tabindex="-1"></a>        <span class="st">"y"</span><span class="op">,</span></span>
<span id="cb87-2766"><a href="#cb87-2766" aria-hidden="true" tabindex="-1"></a>        d <span class="kw">=&gt;</span></span>
<span id="cb87-2767"><a href="#cb87-2767" aria-hidden="true" tabindex="-1"></a>          <span class="op">-</span>secondLabelRadius <span class="op">*</span> <span class="bu">Math</span><span class="op">.</span><span class="fu">cos</span>(<span class="fu">sto</span>(d) <span class="op">*</span> radians) <span class="op">+</span> secondLabelYOffset</span>
<span id="cb87-2768"><a href="#cb87-2768" aria-hidden="true" tabindex="-1"></a>      )</span>
<span id="cb87-2769"><a href="#cb87-2769" aria-hidden="true" tabindex="-1"></a>      <span class="op">.</span><span class="fu">text</span>(d <span class="kw">=&gt;</span> d)<span class="op">;</span></span>
<span id="cb87-2770"><a href="#cb87-2770" aria-hidden="true" tabindex="-1"></a>    <span class="co">// ... and hours</span></span>
<span id="cb87-2771"><a href="#cb87-2771" aria-hidden="true" tabindex="-1"></a>    face</span>
<span id="cb87-2772"><a href="#cb87-2772" aria-hidden="true" tabindex="-1"></a>      <span class="op">.</span><span class="fu">selectAll</span>(<span class="st">".hour-tick"</span>)</span>
<span id="cb87-2773"><a href="#cb87-2773" aria-hidden="true" tabindex="-1"></a>      <span class="op">.</span><span class="fu">data</span>(d3<span class="op">.</span><span class="fu">range</span>(<span class="dv">0</span><span class="op">,</span> <span class="dv">10</span><span class="op">,</span> <span class="dv">1</span>))</span>
<span id="cb87-2774"><a href="#cb87-2774" aria-hidden="true" tabindex="-1"></a>      <span class="op">.</span><span class="fu">enter</span>()</span>
<span id="cb87-2775"><a href="#cb87-2775" aria-hidden="true" tabindex="-1"></a>      <span class="op">.</span><span class="fu">append</span>(<span class="st">"line"</span>)</span>
<span id="cb87-2776"><a href="#cb87-2776" aria-hidden="true" tabindex="-1"></a>      <span class="op">.</span><span class="fu">attr</span>(<span class="st">"class"</span><span class="op">,</span> <span class="st">"hour-tick"</span>)</span>
<span id="cb87-2777"><a href="#cb87-2777" aria-hidden="true" tabindex="-1"></a>      <span class="op">.</span><span class="fu">attr</span>(<span class="st">"x1"</span><span class="op">,</span> <span class="dv">0</span>)</span>
<span id="cb87-2778"><a href="#cb87-2778" aria-hidden="true" tabindex="-1"></a>      <span class="op">.</span><span class="fu">attr</span>(<span class="st">"x2"</span><span class="op">,</span> <span class="dv">0</span>)</span>
<span id="cb87-2779"><a href="#cb87-2779" aria-hidden="true" tabindex="-1"></a>      <span class="op">.</span><span class="fu">attr</span>(<span class="st">"y1"</span><span class="op">,</span> hourTickStart)</span>
<span id="cb87-2780"><a href="#cb87-2780" aria-hidden="true" tabindex="-1"></a>      <span class="op">.</span><span class="fu">attr</span>(<span class="st">"y2"</span><span class="op">,</span> hourTickStart <span class="op">+</span> hourTickLength)</span>
<span id="cb87-2781"><a href="#cb87-2781" aria-hidden="true" tabindex="-1"></a>      <span class="op">.</span><span class="fu">attr</span>(<span class="st">"transform"</span><span class="op">,</span> d <span class="kw">=&gt;</span> <span class="vs">`rotate(</span><span class="sc">${</span><span class="fu">ten</span>(d)<span class="sc">}</span><span class="vs">)`</span>)<span class="op">;</span></span>
<span id="cb87-2782"><a href="#cb87-2782" aria-hidden="true" tabindex="-1"></a>    face</span>
<span id="cb87-2783"><a href="#cb87-2783" aria-hidden="true" tabindex="-1"></a>      <span class="op">.</span><span class="fu">selectAll</span>(<span class="st">".hour-label"</span>)</span>
<span id="cb87-2784"><a href="#cb87-2784" aria-hidden="true" tabindex="-1"></a>      <span class="op">.</span><span class="fu">data</span>(d3<span class="op">.</span><span class="fu">range</span>(<span class="dv">0</span><span class="op">,</span> <span class="dv">10</span><span class="op">,</span> <span class="dv">1</span>))</span>
<span id="cb87-2785"><a href="#cb87-2785" aria-hidden="true" tabindex="-1"></a>      <span class="op">.</span><span class="fu">enter</span>()</span>
<span id="cb87-2786"><a href="#cb87-2786" aria-hidden="true" tabindex="-1"></a>      <span class="op">.</span><span class="fu">append</span>(<span class="st">"text"</span>)</span>
<span id="cb87-2787"><a href="#cb87-2787" aria-hidden="true" tabindex="-1"></a>      <span class="op">.</span><span class="fu">attr</span>(<span class="st">"class"</span><span class="op">,</span> <span class="st">"hour-label"</span>)</span>
<span id="cb87-2788"><a href="#cb87-2788" aria-hidden="true" tabindex="-1"></a>      <span class="op">.</span><span class="fu">attr</span>(<span class="st">"text-anchor"</span><span class="op">,</span> <span class="st">"middle"</span>)</span>
<span id="cb87-2789"><a href="#cb87-2789" aria-hidden="true" tabindex="-1"></a>      <span class="op">.</span><span class="fu">attr</span>(<span class="st">"x"</span><span class="op">,</span> d <span class="kw">=&gt;</span> hourLabelRadius <span class="op">*</span> <span class="bu">Math</span><span class="op">.</span><span class="fu">sin</span>(<span class="fu">ten</span>(d) <span class="op">*</span> radians))</span>
<span id="cb87-2790"><a href="#cb87-2790" aria-hidden="true" tabindex="-1"></a>      <span class="op">.</span><span class="fu">attr</span>(</span>
<span id="cb87-2791"><a href="#cb87-2791" aria-hidden="true" tabindex="-1"></a>        <span class="st">"y"</span><span class="op">,</span></span>
<span id="cb87-2792"><a href="#cb87-2792" aria-hidden="true" tabindex="-1"></a>        d <span class="kw">=&gt;</span> <span class="op">-</span>hourLabelRadius <span class="op">*</span> <span class="bu">Math</span><span class="op">.</span><span class="fu">cos</span>(<span class="fu">ten</span>(d) <span class="op">*</span> radians) <span class="op">+</span> hourLabelYOffset</span>
<span id="cb87-2793"><a href="#cb87-2793" aria-hidden="true" tabindex="-1"></a>      )</span>
<span id="cb87-2794"><a href="#cb87-2794" aria-hidden="true" tabindex="-1"></a>      <span class="op">.</span><span class="fu">text</span>(d <span class="kw">=&gt;</span> d)<span class="op">;</span></span>
<span id="cb87-2795"><a href="#cb87-2795" aria-hidden="true" tabindex="-1"></a>    <span class="kw">const</span> hands <span class="op">=</span> face<span class="op">.</span><span class="fu">append</span>(<span class="st">"g"</span>)<span class="op">.</span><span class="fu">attr</span>(<span class="st">"id"</span><span class="op">,</span> <span class="st">"clock-hands"</span>)<span class="op">;</span></span>
<span id="cb87-2796"><a href="#cb87-2796" aria-hidden="true" tabindex="-1"></a>    hands</span>
<span id="cb87-2797"><a href="#cb87-2797" aria-hidden="true" tabindex="-1"></a>      <span class="op">.</span><span class="fu">selectAll</span>(<span class="st">"line"</span>)</span>
<span id="cb87-2798"><a href="#cb87-2798" aria-hidden="true" tabindex="-1"></a>      <span class="op">.</span><span class="fu">data</span>(handData)</span>
<span id="cb87-2799"><a href="#cb87-2799" aria-hidden="true" tabindex="-1"></a>      <span class="op">.</span><span class="fu">enter</span>()</span>
<span id="cb87-2800"><a href="#cb87-2800" aria-hidden="true" tabindex="-1"></a>      <span class="op">.</span><span class="fu">append</span>(<span class="st">"line"</span>)</span>
<span id="cb87-2801"><a href="#cb87-2801" aria-hidden="true" tabindex="-1"></a>      <span class="op">.</span><span class="fu">attr</span>(<span class="st">"class"</span><span class="op">,</span> d <span class="kw">=&gt;</span> d<span class="op">.</span><span class="at">type</span> <span class="op">+</span> <span class="st">"-hand"</span>)</span>
<span id="cb87-2802"><a href="#cb87-2802" aria-hidden="true" tabindex="-1"></a>      <span class="op">.</span><span class="fu">attr</span>(<span class="st">"x1"</span><span class="op">,</span> <span class="dv">0</span>)</span>
<span id="cb87-2803"><a href="#cb87-2803" aria-hidden="true" tabindex="-1"></a>      <span class="op">.</span><span class="fu">attr</span>(<span class="st">"y1"</span><span class="op">,</span> d <span class="kw">=&gt;</span> d<span class="op">.</span><span class="at">balance</span> <span class="op">||</span> <span class="dv">0</span>)</span>
<span id="cb87-2804"><a href="#cb87-2804" aria-hidden="true" tabindex="-1"></a>      <span class="op">.</span><span class="fu">attr</span>(<span class="st">"x2"</span><span class="op">,</span> <span class="dv">0</span>)</span>
<span id="cb87-2805"><a href="#cb87-2805" aria-hidden="true" tabindex="-1"></a>      <span class="op">.</span><span class="fu">attr</span>(<span class="st">"y2"</span><span class="op">,</span> d <span class="kw">=&gt;</span> d<span class="op">.</span><span class="at">length</span>)</span>
<span id="cb87-2806"><a href="#cb87-2806" aria-hidden="true" tabindex="-1"></a>      <span class="op">.</span><span class="fu">attr</span>(<span class="st">"transform"</span><span class="op">,</span> d <span class="kw">=&gt;</span> <span class="vs">`rotate(</span><span class="sc">${</span>d<span class="op">.</span><span class="fu">scale</span>(d<span class="op">.</span><span class="at">value</span>)<span class="sc">}</span><span class="vs">)`</span>)<span class="op">;</span></span>
<span id="cb87-2807"><a href="#cb87-2807" aria-hidden="true" tabindex="-1"></a>    face</span>
<span id="cb87-2808"><a href="#cb87-2808" aria-hidden="true" tabindex="-1"></a>      <span class="op">.</span><span class="fu">append</span>(<span class="st">"g"</span>)</span>
<span id="cb87-2809"><a href="#cb87-2809" aria-hidden="true" tabindex="-1"></a>      <span class="op">.</span><span class="fu">attr</span>(<span class="st">"id"</span><span class="op">,</span> <span class="st">"face-overlay"</span>)</span>
<span id="cb87-2810"><a href="#cb87-2810" aria-hidden="true" tabindex="-1"></a>      <span class="op">.</span><span class="fu">append</span>(<span class="st">"circle"</span>)</span>
<span id="cb87-2811"><a href="#cb87-2811" aria-hidden="true" tabindex="-1"></a>      <span class="op">.</span><span class="fu">attr</span>(<span class="st">"class"</span><span class="op">,</span> <span class="st">"hands-cover"</span>)</span>
<span id="cb87-2812"><a href="#cb87-2812" aria-hidden="true" tabindex="-1"></a>      <span class="op">.</span><span class="fu">attr</span>(<span class="st">"x"</span><span class="op">,</span> <span class="dv">0</span>)</span>
<span id="cb87-2813"><a href="#cb87-2813" aria-hidden="true" tabindex="-1"></a>      <span class="op">.</span><span class="fu">attr</span>(<span class="st">"y"</span><span class="op">,</span> <span class="dv">0</span>)</span>
<span id="cb87-2814"><a href="#cb87-2814" aria-hidden="true" tabindex="-1"></a>      <span class="op">.</span><span class="fu">attr</span>(<span class="st">"r"</span><span class="op">,</span> clockRadius <span class="op">/</span> <span class="dv">20</span>)<span class="op">;</span></span>
<span id="cb87-2815"><a href="#cb87-2815" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb87-2816"><a href="#cb87-2816" aria-hidden="true" tabindex="-1"></a>  <span class="kw">function</span> <span class="fu">moveHands</span>() {</span>
<span id="cb87-2817"><a href="#cb87-2817" aria-hidden="true" tabindex="-1"></a>    <span class="kw">const</span> sel <span class="op">=</span> d3</span>
<span id="cb87-2818"><a href="#cb87-2818" aria-hidden="true" tabindex="-1"></a>      <span class="op">.</span><span class="fu">select</span>(<span class="st">"#clock-hands-final"</span>)</span>
<span id="cb87-2819"><a href="#cb87-2819" aria-hidden="true" tabindex="-1"></a>      <span class="op">.</span><span class="fu">selectAll</span>(<span class="st">"line"</span>)</span>
<span id="cb87-2820"><a href="#cb87-2820" aria-hidden="true" tabindex="-1"></a>      <span class="op">.</span><span class="fu">data</span>(handData)</span>
<span id="cb87-2821"><a href="#cb87-2821" aria-hidden="true" tabindex="-1"></a>      <span class="op">.</span><span class="fu">transition</span>()<span class="op">;</span></span>
<span id="cb87-2822"><a href="#cb87-2822" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> (fancySecondsOFF) sel<span class="op">.</span><span class="fu">ease</span>(d3<span class="op">.</span><span class="at">easeElastic</span><span class="op">.</span><span class="fu">period</span>(<span class="fl">0.5</span>))<span class="op">;</span></span>
<span id="cb87-2823"><a href="#cb87-2823" aria-hidden="true" tabindex="-1"></a>    sel<span class="op">.</span><span class="fu">attr</span>(<span class="st">"transform"</span><span class="op">,</span> d <span class="kw">=&gt;</span> <span class="vs">`rotate(</span><span class="sc">${</span>d<span class="op">.</span><span class="fu">scale</span>(d<span class="op">.</span><span class="at">value</span>)<span class="sc">}</span><span class="vs">)`</span>)<span class="op">;</span></span>
<span id="cb87-2824"><a href="#cb87-2824" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb87-2825"><a href="#cb87-2825" aria-hidden="true" tabindex="-1"></a>  <span class="kw">function</span> <span class="fu">updateData</span>() {</span>
<span id="cb87-2826"><a href="#cb87-2826" aria-hidden="true" tabindex="-1"></a>    handData[<span class="dv">0</span>]<span class="op">.</span><span class="at">value</span> <span class="op">=</span> <span class="op">!</span>fancySecondsOFF <span class="op">?</span> <span class="bu">Math</span><span class="op">.</span><span class="fu">floor</span>(selectedExactN <span class="op">*</span> <span class="dv">10</span>) <span class="op">:</span> decTimeN[<span class="dv">0</span>]<span class="op">;</span></span>
<span id="cb87-2827"><a href="#cb87-2827" aria-hidden="true" tabindex="-1"></a>    handData[<span class="dv">1</span>]<span class="op">.</span><span class="at">value</span> <span class="op">=</span> <span class="op">!</span>fancySecondsOFF <span class="op">?</span> <span class="bu">Math</span><span class="op">.</span><span class="fu">floor</span>(selectedExactN <span class="op">*</span> <span class="dv">10</span> <span class="op">%</span> <span class="dv">1</span> <span class="op">*</span> <span class="dv">100</span>) <span class="op">:</span> decTimeN<span class="op">.</span><span class="fu">slice</span>(<span class="dv">2</span><span class="op">,</span> <span class="dv">4</span>)<span class="op">;</span></span>
<span id="cb87-2828"><a href="#cb87-2828" aria-hidden="true" tabindex="-1"></a>    handData[<span class="dv">2</span>]<span class="op">.</span><span class="at">value</span> <span class="op">=</span> <span class="op">!</span>fancySecondsOFF <span class="op">?</span> selectedExactN <span class="op">*</span> <span class="dv">10</span> <span class="op">%</span> <span class="dv">1</span> <span class="op">*</span> <span class="dv">100</span> <span class="op">%</span> <span class="dv">1</span> <span class="op">*</span> <span class="dv">100</span> <span class="op">:</span> decTimeN<span class="op">.</span><span class="fu">slice</span>(<span class="dv">4</span><span class="op">,</span> <span class="dv">6</span>)<span class="op">;</span></span>
<span id="cb87-2829"><a href="#cb87-2829" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb87-2830"><a href="#cb87-2830" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> svg <span class="op">=</span> d3</span>
<span id="cb87-2831"><a href="#cb87-2831" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">create</span>(<span class="st">"svg"</span>)</span>
<span id="cb87-2832"><a href="#cb87-2832" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">"viewBox"</span><span class="op">,</span> [<span class="dv">0</span><span class="op">,</span> <span class="dv">0</span><span class="op">,</span> w<span class="op">,</span> h])</span>
<span id="cb87-2833"><a href="#cb87-2833" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">style</span>(<span class="st">"max-width"</span><span class="op">,</span> <span class="vs">`</span><span class="sc">${</span>width <span class="op">/</span> <span class="fl">2.1</span><span class="sc">}</span><span class="vs">px`</span>)</span>
<span id="cb87-2834"><a href="#cb87-2834" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">"class"</span><span class="op">,</span> <span class="st">"analogclock"</span>)</span>
<span id="cb87-2835"><a href="#cb87-2835" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">"id"</span><span class="op">,</span> <span class="st">"midclock"</span>)<span class="op">;</span></span>
<span id="cb87-2836"><a href="#cb87-2836" aria-hidden="true" tabindex="-1"></a>  svg</span>
<span id="cb87-2837"><a href="#cb87-2837" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">append</span>(<span class="st">"text"</span>)</span>
<span id="cb87-2838"><a href="#cb87-2838" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">text</span>(<span class="vs">`-</span><span class="sc">${</span>decTimeN<span class="sc">}</span><span class="vs">-</span><span class="sc">${</span>selectedZone<span class="sc">}</span><span class="vs">`</span>)</span>
<span id="cb87-2839"><a href="#cb87-2839" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">"x"</span><span class="op">,</span> clockRadius <span class="op">+</span> margin)</span>
<span id="cb87-2840"><a href="#cb87-2840" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">"y"</span><span class="op">,</span> clockRadius <span class="op">*</span> <span class="dv">2</span> <span class="op">+</span> margin <span class="op">*</span> <span class="fl">2.1</span>)</span>
<span id="cb87-2841"><a href="#cb87-2841" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">"text-anchor"</span><span class="op">,</span> <span class="st">"middle"</span>)</span>
<span id="cb87-2842"><a href="#cb87-2842" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">"font-size"</span><span class="op">,</span> <span class="dv">32</span>)</span>
<span id="cb87-2843"><a href="#cb87-2843" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">"font-family"</span><span class="op">,</span> <span class="st">"monospace"</span>)<span class="op">;</span></span>
<span id="cb87-2844"><a href="#cb87-2844" aria-hidden="true" tabindex="-1"></a>  <span class="fu">drawClock</span>()<span class="op">;</span></span>
<span id="cb87-2845"><a href="#cb87-2845" aria-hidden="true" tabindex="-1"></a>  <span class="co">// Animation</span></span>
<span id="cb87-2846"><a href="#cb87-2846" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> interval <span class="op">=</span> <span class="pp">setInterval</span>(</span>
<span id="cb87-2847"><a href="#cb87-2847" aria-hidden="true" tabindex="-1"></a>    () <span class="kw">=&gt;</span> {</span>
<span id="cb87-2848"><a href="#cb87-2848" aria-hidden="true" tabindex="-1"></a>      <span class="fu">updateData</span>()<span class="op">;</span></span>
<span id="cb87-2849"><a href="#cb87-2849" aria-hidden="true" tabindex="-1"></a>      <span class="fu">moveHands</span>()<span class="op">;</span></span>
<span id="cb87-2850"><a href="#cb87-2850" aria-hidden="true" tabindex="-1"></a>    }<span class="op">,</span></span>
<span id="cb87-2851"><a href="#cb87-2851" aria-hidden="true" tabindex="-1"></a>    <span class="op">!</span>fancySecondsOFF <span class="op">?</span> <span class="dv">10</span> <span class="op">:</span> <span class="dv">864</span></span>
<span id="cb87-2852"><a href="#cb87-2852" aria-hidden="true" tabindex="-1"></a>  )<span class="op">;</span></span>
<span id="cb87-2853"><a href="#cb87-2853" aria-hidden="true" tabindex="-1"></a>  invalidation<span class="op">.</span><span class="fu">then</span>(() <span class="kw">=&gt;</span> <span class="pp">clearInterval</span>(interval))<span class="op">;</span></span>
<span id="cb87-2854"><a href="#cb87-2854" aria-hidden="true" tabindex="-1"></a>  <span class="cf">return</span> svg<span class="op">.</span><span class="fu">node</span>()<span class="op">;</span></span>
<span id="cb87-2855"><a href="#cb87-2855" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div id="negclock" class="cell-output cell-output-display hidden">
<div id="ojs-cell-27" data-nodetype="declaration">

</div>
</div>
</div>
<div id="sunclock" class="cell hidden clock">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code hidden" id="cb88" data-startfrom="2865" data-source-offset="-69"><pre class="sourceCode js code-with-copy"><code class="sourceCode javascript" style="counter-reset: source-line 2864;"><span id="cb88-2865"><a href="#cb88-2865" aria-hidden="true" tabindex="-1"></a>sunclock <span class="op">=</span> {</span>
<span id="cb88-2866"><a href="#cb88-2866" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> radius <span class="op">=</span> <span class="dv">200</span><span class="op">;</span></span>
<span id="cb88-2867"><a href="#cb88-2867" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> width <span class="op">=</span> radius <span class="op">*</span> <span class="dv">2</span><span class="op">;</span></span>
<span id="cb88-2868"><a href="#cb88-2868" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> height <span class="op">=</span> radius <span class="op">*</span> <span class="dv">2</span><span class="op">;</span></span>
<span id="cb88-2869"><a href="#cb88-2869" aria-hidden="true" tabindex="-1"></a>  <span class="co">//let _minutes = 0;</span></span>
<span id="cb88-2870"><a href="#cb88-2870" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> svg <span class="op">=</span> d3</span>
<span id="cb88-2871"><a href="#cb88-2871" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">create</span>(<span class="st">"svg"</span>)</span>
<span id="cb88-2872"><a href="#cb88-2872" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">"id"</span><span class="op">,</span> <span class="st">"btmclock"</span>)</span>
<span id="cb88-2873"><a href="#cb88-2873" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">"viewBox"</span><span class="op">,</span> [<span class="dv">0</span><span class="op">,</span> <span class="dv">0</span><span class="op">,</span> width<span class="op">,</span> height])</span>
<span id="cb88-2874"><a href="#cb88-2874" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">style</span>(<span class="st">"margin-top"</span><span class="op">,</span> <span class="st">"1px"</span>)</span>
<span id="cb88-2875"><a href="#cb88-2875" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">style</span>(<span class="st">"max-width"</span><span class="op">,</span> <span class="st">"200px"</span>)<span class="op">;</span></span>
<span id="cb88-2876"><a href="#cb88-2876" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> face <span class="op">=</span> svg</span>
<span id="cb88-2877"><a href="#cb88-2877" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">append</span>(<span class="st">"g"</span>)</span>
<span id="cb88-2878"><a href="#cb88-2878" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">"transform"</span><span class="op">,</span> <span class="vs">`translate(</span><span class="sc">${</span>width <span class="op">/</span> <span class="dv">2</span><span class="sc">}</span><span class="vs">, </span><span class="sc">${</span>height <span class="op">/</span> <span class="dv">2</span><span class="sc">}</span><span class="vs">)`</span>)<span class="op">;</span></span>
<span id="cb88-2879"><a href="#cb88-2879" aria-hidden="true" tabindex="-1"></a>  <span class="cf">for</span> (<span class="kw">const</span> angle <span class="kw">of</span> angles) {</span>
<span id="cb88-2880"><a href="#cb88-2880" aria-hidden="true" tabindex="-1"></a>    <span class="kw">const</span> arc <span class="op">=</span> d3</span>
<span id="cb88-2881"><a href="#cb88-2881" aria-hidden="true" tabindex="-1"></a>      <span class="op">.</span><span class="fu">arc</span>()</span>
<span id="cb88-2882"><a href="#cb88-2882" aria-hidden="true" tabindex="-1"></a>      <span class="op">.</span><span class="fu">innerRadius</span>(<span class="dv">0</span>)</span>
<span id="cb88-2883"><a href="#cb88-2883" aria-hidden="true" tabindex="-1"></a>      <span class="op">.</span><span class="fu">outerRadius</span>(radius)</span>
<span id="cb88-2884"><a href="#cb88-2884" aria-hidden="true" tabindex="-1"></a>      <span class="op">.</span><span class="fu">startAngle</span>(angle<span class="op">.</span><span class="at">start</span>)</span>
<span id="cb88-2885"><a href="#cb88-2885" aria-hidden="true" tabindex="-1"></a>      <span class="op">.</span><span class="fu">endAngle</span>(angle<span class="op">.</span><span class="at">end</span>)<span class="op">;</span></span>
<span id="cb88-2886"><a href="#cb88-2886" aria-hidden="true" tabindex="-1"></a>    face<span class="op">.</span><span class="fu">append</span>(<span class="st">"path"</span>)<span class="op">.</span><span class="fu">attr</span>(<span class="st">"d"</span><span class="op">,</span> arc)<span class="op">.</span><span class="fu">attr</span>(<span class="st">"fill"</span><span class="op">,</span> angle<span class="op">.</span><span class="at">color</span>)<span class="op">;</span></span>
<span id="cb88-2887"><a href="#cb88-2887" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb88-2888"><a href="#cb88-2888" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> sun <span class="op">=</span> face</span>
<span id="cb88-2889"><a href="#cb88-2889" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">append</span>(<span class="st">"circle"</span>)</span>
<span id="cb88-2890"><a href="#cb88-2890" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">"r"</span><span class="op">,</span> <span class="dv">15</span>)</span>
<span id="cb88-2891"><a href="#cb88-2891" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">"cx"</span><span class="op">,</span> <span class="dv">125</span> <span class="op">*</span> <span class="op">-</span><span class="fu">sin</span>(astDegMapPlot))</span>
<span id="cb88-2892"><a href="#cb88-2892" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">"cy"</span><span class="op">,</span> <span class="dv">125</span> <span class="op">*</span> <span class="fu">cos</span>(astDegMapPlot))</span>
<span id="cb88-2893"><a href="#cb88-2893" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">style</span>(<span class="st">"fill"</span><span class="op">,</span> <span class="st">"white"</span>)<span class="op">;</span></span>
<span id="cb88-2894"><a href="#cb88-2894" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> ringContainer <span class="op">=</span> svg</span>
<span id="cb88-2895"><a href="#cb88-2895" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">append</span>(<span class="st">"g"</span>)</span>
<span id="cb88-2896"><a href="#cb88-2896" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">"transform"</span><span class="op">,</span> <span class="vs">`translate(</span><span class="sc">${</span>width <span class="op">/</span> <span class="dv">2</span><span class="sc">}</span><span class="vs">, </span><span class="sc">${</span>height <span class="op">/</span> <span class="dv">2</span><span class="sc">}</span><span class="vs">)`</span>)<span class="op">;</span></span>
<span id="cb88-2897"><a href="#cb88-2897" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> ring <span class="op">=</span> ringContainer</span>
<span id="cb88-2898"><a href="#cb88-2898" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">append</span>(<span class="st">"circle"</span>)</span>
<span id="cb88-2899"><a href="#cb88-2899" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">"r"</span><span class="op">,</span> <span class="dv">125</span>)</span>
<span id="cb88-2900"><a href="#cb88-2900" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">style</span>(<span class="st">"opacity"</span><span class="op">,</span> <span class="fl">0.2</span>)</span>
<span id="cb88-2901"><a href="#cb88-2901" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">style</span>(<span class="st">"fill"</span><span class="op">,</span> <span class="st">"transparent"</span>)</span>
<span id="cb88-2902"><a href="#cb88-2902" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">style</span>(<span class="st">"stroke"</span><span class="op">,</span> <span class="st">"white"</span>)</span>
<span id="cb88-2903"><a href="#cb88-2903" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">style</span>(<span class="st">"stroke-width"</span><span class="op">,</span> <span class="dv">3</span>)<span class="op">;</span></span>
<span id="cb88-2904"><a href="#cb88-2904" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> events <span class="op">=</span> [</span>
<span id="cb88-2905"><a href="#cb88-2905" aria-hidden="true" tabindex="-1"></a>    data<span class="op">.</span><span class="at">astronomicalSunrise</span><span class="op">,</span></span>
<span id="cb88-2906"><a href="#cb88-2906" aria-hidden="true" tabindex="-1"></a>    data<span class="op">.</span><span class="at">astronomicalSunset</span><span class="op">,</span></span>
<span id="cb88-2907"><a href="#cb88-2907" aria-hidden="true" tabindex="-1"></a>    data<span class="op">.</span><span class="at">nauticalSunrise</span><span class="op">,</span></span>
<span id="cb88-2908"><a href="#cb88-2908" aria-hidden="true" tabindex="-1"></a>    data<span class="op">.</span><span class="at">nauticalSunset</span><span class="op">,</span></span>
<span id="cb88-2909"><a href="#cb88-2909" aria-hidden="true" tabindex="-1"></a>    data<span class="op">.</span><span class="at">civilSunrise</span><span class="op">,</span></span>
<span id="cb88-2910"><a href="#cb88-2910" aria-hidden="true" tabindex="-1"></a>    data<span class="op">.</span><span class="at">civilSunset</span><span class="op">,</span></span>
<span id="cb88-2911"><a href="#cb88-2911" aria-hidden="true" tabindex="-1"></a>    data<span class="op">.</span><span class="at">sunrise</span><span class="op">,</span></span>
<span id="cb88-2912"><a href="#cb88-2912" aria-hidden="true" tabindex="-1"></a>    data<span class="op">.</span><span class="at">sunset</span><span class="op">,</span></span>
<span id="cb88-2913"><a href="#cb88-2913" aria-hidden="true" tabindex="-1"></a>    data<span class="op">.</span><span class="at">solarNoon</span></span>
<span id="cb88-2914"><a href="#cb88-2914" aria-hidden="true" tabindex="-1"></a>  ]<span class="op">;</span></span>
<span id="cb88-2915"><a href="#cb88-2915" aria-hidden="true" tabindex="-1"></a>  <span class="cf">for</span> (<span class="kw">const</span> e <span class="kw">of</span> events) {</span>
<span id="cb88-2916"><a href="#cb88-2916" aria-hidden="true" tabindex="-1"></a>    ringContainer</span>
<span id="cb88-2917"><a href="#cb88-2917" aria-hidden="true" tabindex="-1"></a>      <span class="op">.</span><span class="fu">append</span>(<span class="st">"circle"</span>)</span>
<span id="cb88-2918"><a href="#cb88-2918" aria-hidden="true" tabindex="-1"></a>      <span class="op">.</span><span class="fu">attr</span>(<span class="st">"r"</span><span class="op">,</span> <span class="dv">5</span>)</span>
<span id="cb88-2919"><a href="#cb88-2919" aria-hidden="true" tabindex="-1"></a>      <span class="op">.</span><span class="fu">attr</span>(<span class="st">"cx"</span><span class="op">,</span> <span class="dv">125</span> <span class="op">*</span> <span class="bu">Math</span><span class="op">.</span><span class="fu">sin</span>(e))</span>
<span id="cb88-2920"><a href="#cb88-2920" aria-hidden="true" tabindex="-1"></a>      <span class="op">.</span><span class="fu">attr</span>(<span class="st">"cy"</span><span class="op">,</span> <span class="dv">125</span> <span class="op">*</span> <span class="op">-</span><span class="bu">Math</span><span class="op">.</span><span class="fu">cos</span>(e))</span>
<span id="cb88-2921"><a href="#cb88-2921" aria-hidden="true" tabindex="-1"></a>      <span class="op">.</span><span class="fu">style</span>(<span class="st">"opacity"</span><span class="op">,</span> <span class="fl">0.4</span>)</span>
<span id="cb88-2922"><a href="#cb88-2922" aria-hidden="true" tabindex="-1"></a>      <span class="op">.</span><span class="fu">style</span>(<span class="st">"fill"</span><span class="op">,</span> <span class="st">"white"</span>)<span class="op">;</span></span>
<span id="cb88-2923"><a href="#cb88-2923" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb88-2924"><a href="#cb88-2924" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> digitalClock <span class="op">=</span> svg</span>
<span id="cb88-2925"><a href="#cb88-2925" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">append</span>(<span class="st">"g"</span>)</span>
<span id="cb88-2926"><a href="#cb88-2926" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">attr</span>(</span>
<span id="cb88-2927"><a href="#cb88-2927" aria-hidden="true" tabindex="-1"></a>      <span class="st">"transform"</span><span class="op">,</span></span>
<span id="cb88-2928"><a href="#cb88-2928" aria-hidden="true" tabindex="-1"></a>      <span class="vs">`translate(</span><span class="sc">${</span>width <span class="op">/</span> <span class="dv">2</span> <span class="op">+</span> <span class="dv">45</span> <span class="op">*</span> <span class="fu">sin</span>(astDegMapPlot)<span class="sc">}</span><span class="vs">, </span><span class="sc">${</span></span>
<span id="cb88-2929"><a href="#cb88-2929" aria-hidden="true" tabindex="-1"></a>        height <span class="op">/</span> <span class="dv">2</span> <span class="op">+</span> <span class="dv">45</span> <span class="op">*</span> <span class="op">-</span><span class="fu">cos</span>(astDegMapPlot)</span>
<span id="cb88-2930"><a href="#cb88-2930" aria-hidden="true" tabindex="-1"></a>      <span class="sc">}</span><span class="vs">)`</span></span>
<span id="cb88-2931"><a href="#cb88-2931" aria-hidden="true" tabindex="-1"></a>    )<span class="op">;</span></span>
<span id="cb88-2932"><a href="#cb88-2932" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> digitalClockBase <span class="op">=</span> digitalClock</span>
<span id="cb88-2933"><a href="#cb88-2933" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">append</span>(<span class="st">"circle"</span>)</span>
<span id="cb88-2934"><a href="#cb88-2934" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">"r"</span><span class="op">,</span> <span class="dv">100</span>)</span>
<span id="cb88-2935"><a href="#cb88-2935" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">style</span>(<span class="st">"opacity"</span><span class="op">,</span> <span class="fl">0.21</span>)</span>
<span id="cb88-2936"><a href="#cb88-2936" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">style</span>(<span class="st">"fill"</span><span class="op">,</span> <span class="st">"white"</span>)<span class="op">;</span></span>
<span id="cb88-2937"><a href="#cb88-2937" aria-hidden="true" tabindex="-1"></a><span class="co">//  const digitalClockTicks = digitalClock</span></span>
<span id="cb88-2938"><a href="#cb88-2938" aria-hidden="true" tabindex="-1"></a><span class="co">//    .selectAll(".digital-clock-tick")</span></span>
<span id="cb88-2939"><a href="#cb88-2939" aria-hidden="true" tabindex="-1"></a><span class="co">//    .data(d3.range(0, 60))</span></span>
<span id="cb88-2940"><a href="#cb88-2940" aria-hidden="true" tabindex="-1"></a><span class="co">//    .enter()</span></span>
<span id="cb88-2941"><a href="#cb88-2941" aria-hidden="true" tabindex="-1"></a><span class="co">//    .append("line")</span></span>
<span id="cb88-2942"><a href="#cb88-2942" aria-hidden="true" tabindex="-1"></a><span class="co">//    .attr("class", "digital-clock-tick")</span></span>
<span id="cb88-2943"><a href="#cb88-2943" aria-hidden="true" tabindex="-1"></a><span class="co">//    .attr("x1", 0)</span></span>
<span id="cb88-2944"><a href="#cb88-2944" aria-hidden="true" tabindex="-1"></a><span class="co">//    .attr("x2", 0)</span></span>
<span id="cb88-2945"><a href="#cb88-2945" aria-hidden="true" tabindex="-1"></a><span class="co">//    .attr("y1", 100 - 5)</span></span>
<span id="cb88-2946"><a href="#cb88-2946" aria-hidden="true" tabindex="-1"></a><span class="co">//    .attr("y2", 100 - 10)</span></span>
<span id="cb88-2947"><a href="#cb88-2947" aria-hidden="true" tabindex="-1"></a><span class="co">//    .attr("stroke", (d) =&gt; (d &gt; seconds ? "black" : "white"))</span></span>
<span id="cb88-2948"><a href="#cb88-2948" aria-hidden="true" tabindex="-1"></a><span class="co">//    .attr("stroke-width", "3")</span></span>
<span id="cb88-2949"><a href="#cb88-2949" aria-hidden="true" tabindex="-1"></a><span class="co">//    .attr("stroke-linecap", "round")</span></span>
<span id="cb88-2950"><a href="#cb88-2950" aria-hidden="true" tabindex="-1"></a><span class="co">//    .style("mix-blend-mode", "luminance")</span></span>
<span id="cb88-2951"><a href="#cb88-2951" aria-hidden="true" tabindex="-1"></a><span class="co">//    .style("opacity", 0.6)</span></span>
<span id="cb88-2952"><a href="#cb88-2952" aria-hidden="true" tabindex="-1"></a><span class="co">//    .attr("transform", (d) =&gt; `rotate(${180 + d * 6})`);</span></span>
<span id="cb88-2953"><a href="#cb88-2953" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> clockText <span class="op">=</span> digitalClock</span>
<span id="cb88-2954"><a href="#cb88-2954" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">append</span>(<span class="st">"text"</span>)</span>
<span id="cb88-2955"><a href="#cb88-2955" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">"y"</span><span class="op">,</span> <span class="dv">25</span>)</span>
<span id="cb88-2956"><a href="#cb88-2956" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">"fill"</span><span class="op">,</span> <span class="st">"white"</span>)</span>
<span id="cb88-2957"><a href="#cb88-2957" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">"text-anchor"</span><span class="op">,</span> <span class="st">"middle"</span>)</span>
<span id="cb88-2958"><a href="#cb88-2958" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">"font-family"</span><span class="op">,</span> <span class="st">"Helvetica, Arial, sans-serif"</span>)</span>
<span id="cb88-2959"><a href="#cb88-2959" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">style</span>(<span class="st">"opacity"</span><span class="op">,</span> <span class="dv">1</span>)</span>
<span id="cb88-2960"><a href="#cb88-2960" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">"font-weight"</span><span class="op">,</span> <span class="dv">600</span>)</span>
<span id="cb88-2961"><a href="#cb88-2961" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">"font-size"</span><span class="op">,</span> <span class="st">"75px"</span>)</span>
<span id="cb88-2962"><a href="#cb88-2962" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">text</span>(astDecMapPlot<span class="op">.</span><span class="fu">toFixed</span>(<span class="dv">2</span>))<span class="op">;</span></span>
<span id="cb88-2963"><a href="#cb88-2963" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> ticks <span class="op">=</span> face</span>
<span id="cb88-2964"><a href="#cb88-2964" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">selectAll</span>(<span class="st">".tick"</span>)</span>
<span id="cb88-2965"><a href="#cb88-2965" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">data</span>(d3<span class="op">.</span><span class="fu">range</span>(<span class="dv">0</span><span class="op">,</span> <span class="dv">20</span>))</span>
<span id="cb88-2966"><a href="#cb88-2966" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">enter</span>()</span>
<span id="cb88-2967"><a href="#cb88-2967" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">append</span>(<span class="st">"line"</span>)</span>
<span id="cb88-2968"><a href="#cb88-2968" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">"class"</span><span class="op">,</span> <span class="st">"tick"</span>)</span>
<span id="cb88-2969"><a href="#cb88-2969" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">"x1"</span><span class="op">,</span> <span class="dv">0</span>)</span>
<span id="cb88-2970"><a href="#cb88-2970" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">"x2"</span><span class="op">,</span> <span class="dv">0</span>)</span>
<span id="cb88-2971"><a href="#cb88-2971" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">"y1"</span><span class="op">,</span> radius <span class="op">-</span> <span class="dv">5</span>)</span>
<span id="cb88-2972"><a href="#cb88-2972" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">"y2"</span><span class="op">,</span> radius <span class="op">-</span> <span class="dv">20</span>)</span>
<span id="cb88-2973"><a href="#cb88-2973" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">"stroke"</span><span class="op">,</span> <span class="st">"white"</span>)</span>
<span id="cb88-2974"><a href="#cb88-2974" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">"stroke-width"</span><span class="op">,</span> <span class="st">"3"</span>)</span>
<span id="cb88-2975"><a href="#cb88-2975" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">"stroke-linecap"</span><span class="op">,</span> <span class="st">"round"</span>)</span>
<span id="cb88-2976"><a href="#cb88-2976" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">style</span>(<span class="st">"mix-blend-mode"</span><span class="op">,</span> <span class="st">"screen"</span>)</span>
<span id="cb88-2977"><a href="#cb88-2977" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">style</span>(<span class="st">"opacity"</span><span class="op">,</span> <span class="dv">1</span>)</span>
<span id="cb88-2978"><a href="#cb88-2978" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">"transform"</span><span class="op">,</span> (d) <span class="kw">=&gt;</span> <span class="vs">`rotate(</span><span class="sc">${</span>d <span class="op">*</span> <span class="dv">18</span><span class="sc">}</span><span class="vs">)`</span>)<span class="op">;</span></span>
<span id="cb88-2979"><a href="#cb88-2979" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> minuteTicks <span class="op">=</span> face</span>
<span id="cb88-2980"><a href="#cb88-2980" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">selectAll</span>(<span class="st">".tick"</span>)</span>
<span id="cb88-2981"><a href="#cb88-2981" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">data</span>(d3<span class="op">.</span><span class="fu">range</span>(<span class="dv">0</span><span class="op">,</span> <span class="dv">200</span>))</span>
<span id="cb88-2982"><a href="#cb88-2982" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">enter</span>()</span>
<span id="cb88-2983"><a href="#cb88-2983" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">append</span>(<span class="st">"line"</span>)</span>
<span id="cb88-2984"><a href="#cb88-2984" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">"class"</span><span class="op">,</span> <span class="st">"tick"</span>)</span>
<span id="cb88-2985"><a href="#cb88-2985" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">"x1"</span><span class="op">,</span> <span class="dv">0</span>)</span>
<span id="cb88-2986"><a href="#cb88-2986" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">"x2"</span><span class="op">,</span> <span class="dv">0</span>)</span>
<span id="cb88-2987"><a href="#cb88-2987" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">"y1"</span><span class="op">,</span> radius <span class="op">-</span> <span class="dv">5</span>)</span>
<span id="cb88-2988"><a href="#cb88-2988" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">"y2"</span><span class="op">,</span> radius <span class="op">-</span> <span class="dv">15</span>)</span>
<span id="cb88-2989"><a href="#cb88-2989" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">"stroke"</span><span class="op">,</span> <span class="st">"white"</span>)</span>
<span id="cb88-2990"><a href="#cb88-2990" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">"stroke-width"</span><span class="op">,</span> <span class="st">"2"</span>)</span>
<span id="cb88-2991"><a href="#cb88-2991" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">"stroke-linecap"</span><span class="op">,</span> <span class="st">"round"</span>)</span>
<span id="cb88-2992"><a href="#cb88-2992" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">style</span>(<span class="st">"mix-blend-mode"</span><span class="op">,</span> <span class="st">"screen"</span>)</span>
<span id="cb88-2993"><a href="#cb88-2993" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">style</span>(<span class="st">"opacity"</span><span class="op">,</span> <span class="fl">0.6</span>)</span>
<span id="cb88-2994"><a href="#cb88-2994" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">"transform"</span><span class="op">,</span> (d) <span class="kw">=&gt;</span> <span class="vs">`rotate(</span><span class="sc">${</span>d <span class="op">*</span> <span class="dv">2</span><span class="sc">}</span><span class="vs">)`</span>)<span class="op">;</span></span>
<span id="cb88-2995"><a href="#cb88-2995" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> hourLabels <span class="op">=</span> face</span>
<span id="cb88-2996"><a href="#cb88-2996" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">selectAll</span>(<span class="st">".hour-label"</span>)</span>
<span id="cb88-2997"><a href="#cb88-2997" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">data</span>(d3<span class="op">.</span><span class="fu">range</span>(<span class="dv">0</span><span class="op">,</span> <span class="dv">10</span>))</span>
<span id="cb88-2998"><a href="#cb88-2998" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">enter</span>()</span>
<span id="cb88-2999"><a href="#cb88-2999" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">append</span>(<span class="st">"text"</span>)</span>
<span id="cb88-3000"><a href="#cb88-3000" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">"class"</span><span class="op">,</span> <span class="st">"hour-label"</span>)</span>
<span id="cb88-3001"><a href="#cb88-3001" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">"x"</span><span class="op">,</span> (d) <span class="kw">=&gt;</span> <span class="dv">160</span> <span class="op">*</span> <span class="op">-</span><span class="bu">Math</span><span class="op">.</span><span class="fu">sin</span>(<span class="fu">toRadians</span>((d <span class="op">/</span> <span class="dv">10</span>) <span class="op">*</span> <span class="dv">360</span>)))</span>
<span id="cb88-3002"><a href="#cb88-3002" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">"y"</span><span class="op">,</span> (d) <span class="kw">=&gt;</span> <span class="dv">160</span> <span class="op">*</span> <span class="bu">Math</span><span class="op">.</span><span class="fu">cos</span>(<span class="fu">toRadians</span>((d <span class="op">/</span> <span class="dv">10</span>) <span class="op">*</span> <span class="dv">360</span>)) <span class="op">+</span> <span class="dv">12</span>)</span>
<span id="cb88-3003"><a href="#cb88-3003" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">"fill"</span><span class="op">,</span> <span class="st">"white"</span>)</span>
<span id="cb88-3004"><a href="#cb88-3004" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">"text-anchor"</span><span class="op">,</span> <span class="st">"middle"</span>)</span>
<span id="cb88-3005"><a href="#cb88-3005" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">"font-family"</span><span class="op">,</span> <span class="st">"Helvetica, Arial, sans-serif"</span>)</span>
<span id="cb88-3006"><a href="#cb88-3006" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">"font-weight"</span><span class="op">,</span> <span class="dv">600</span>)</span>
<span id="cb88-3007"><a href="#cb88-3007" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">"font-size"</span><span class="op">,</span> <span class="st">"38px"</span>)</span>
<span id="cb88-3008"><a href="#cb88-3008" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">style</span>(<span class="st">"opacity"</span><span class="op">,</span> <span class="fl">0.7</span>)</span>
<span id="cb88-3009"><a href="#cb88-3009" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">text</span>((d) <span class="kw">=&gt;</span> (<span class="bu">String</span>(d)))<span class="op">;</span></span>
<span id="cb88-3010"><a href="#cb88-3010" aria-hidden="true" tabindex="-1"></a>  <span class="cf">return</span> svg<span class="op">.</span><span class="fu">node</span>()<span class="op">;</span></span>
<span id="cb88-3011"><a href="#cb88-3011" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb88-3012"><a href="#cb88-3012" aria-hidden="true" tabindex="-1"></a>minutesAndSeconds <span class="op">=</span> {</span>
<span id="cb88-3013"><a href="#cb88-3013" aria-hidden="true" tabindex="-1"></a>  <span class="cf">while</span> (<span class="kw">true</span>) {</span>
<span id="cb88-3014"><a href="#cb88-3014" aria-hidden="true" tabindex="-1"></a>    <span class="cf">await</span> Promises<span class="op">.</span><span class="fu">delay</span>(<span class="dv">1000</span>)<span class="op">;</span></span>
<span id="cb88-3015"><a href="#cb88-3015" aria-hidden="true" tabindex="-1"></a>    <span class="kw">const</span> date <span class="op">=</span> <span class="kw">new</span> <span class="bu">Date</span>()<span class="op">;</span></span>
<span id="cb88-3016"><a href="#cb88-3016" aria-hidden="true" tabindex="-1"></a>    <span class="kw">yield</span> {</span>
<span id="cb88-3017"><a href="#cb88-3017" aria-hidden="true" tabindex="-1"></a>      <span class="dt">minutes</span><span class="op">:</span> date<span class="op">.</span><span class="fu">getHours</span>() <span class="op">*</span> <span class="dv">60</span> <span class="op">+</span> date<span class="op">.</span><span class="fu">getMinutes</span>()<span class="op">,</span></span>
<span id="cb88-3018"><a href="#cb88-3018" aria-hidden="true" tabindex="-1"></a>      <span class="dt">seconds</span><span class="op">:</span> date<span class="op">.</span><span class="fu">getSeconds</span>()</span>
<span id="cb88-3019"><a href="#cb88-3019" aria-hidden="true" tabindex="-1"></a>    }<span class="op">;</span></span>
<span id="cb88-3020"><a href="#cb88-3020" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb88-3021"><a href="#cb88-3021" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb88-3022"><a href="#cb88-3022" aria-hidden="true" tabindex="-1"></a><span class="kw">function</span> <span class="fu">minutesTo12HourTime</span>(minutes) {</span>
<span id="cb88-3023"><a href="#cb88-3023" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> decidays <span class="op">=</span> minutes <span class="op">/</span> <span class="dv">144</span> <span class="op">%</span> <span class="dv">10</span></span>
<span id="cb88-3024"><a href="#cb88-3024" aria-hidden="true" tabindex="-1"></a>  <span class="cf">return</span> decidays<span class="op">.</span><span class="fu">toFixed</span>(<span class="dv">2</span>)<span class="op">;</span></span>
<span id="cb88-3025"><a href="#cb88-3025" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb88-3026"><a href="#cb88-3026" aria-hidden="true" tabindex="-1"></a>viewof date <span class="op">=</span> Inputs<span class="op">.</span><span class="fu">date</span>({ <span class="dt">label</span><span class="op">:</span> <span class="st">"Date"</span><span class="op">,</span> <span class="dt">value</span><span class="op">:</span> <span class="bu">Date</span><span class="op">.</span><span class="fu">now</span>() })</span>
<span id="cb88-3027"><a href="#cb88-3027" aria-hidden="true" tabindex="-1"></a>JD <span class="op">=</span> <span class="fu">getJulianDate</span>(date)</span>
<span id="cb88-3028"><a href="#cb88-3028" aria-hidden="true" tabindex="-1"></a>T <span class="op">=</span> (JD <span class="op">-</span> <span class="fl">2451545.0</span>) <span class="op">/</span> <span class="dv">36525</span></span>
<span id="cb88-3029"><a href="#cb88-3029" aria-hidden="true" tabindex="-1"></a>sun_geometric_mean_longitude <span class="op">=</span> <span class="fl">280.46646</span> <span class="op">+</span> <span class="fl">36000.76983</span> <span class="op">*</span> T <span class="op">+</span> <span class="fl">0.0003032</span> <span class="op">*</span> T <span class="op">**</span> <span class="dv">2</span></span>
<span id="cb88-3030"><a href="#cb88-3030" aria-hidden="true" tabindex="-1"></a>sun_mean_anomaly <span class="op">=</span> <span class="fl">357.52911</span> <span class="op">+</span> <span class="fl">35999.05029</span> <span class="op">*</span> T <span class="op">-</span> <span class="fl">0.0001537</span> <span class="op">*</span> T <span class="op">**</span> <span class="dv">2</span></span>
<span id="cb88-3031"><a href="#cb88-3031" aria-hidden="true" tabindex="-1"></a>earth_eccentricity_orbit <span class="op">=</span> <span class="fl">0.016708634</span> <span class="op">-</span> <span class="fl">0.000042037</span> <span class="op">*</span> T <span class="op">-</span> <span class="fl">0.0000001267</span> <span class="op">*</span> T <span class="op">**</span> <span class="dv">2</span></span>
<span id="cb88-3032"><a href="#cb88-3032" aria-hidden="true" tabindex="-1"></a>sun_equation_of_the_center <span class="op">=</span> (<span class="fl">1.914602</span> <span class="op">-</span> <span class="fl">0.004817</span> <span class="op">*</span> T <span class="op">-</span> <span class="fl">0.000014</span> <span class="op">*</span> T <span class="op">**</span> <span class="dv">2</span>) <span class="op">*</span> <span class="fu">sin</span>(sun_mean_anomaly) <span class="op">+</span> (<span class="fl">0.019993</span> <span class="op">-</span> <span class="fl">0.000101</span> <span class="op">*</span> T) <span class="op">*</span> <span class="fu">sin</span>(<span class="dv">2</span> <span class="op">*</span> sun_mean_anomaly) <span class="op">+</span> <span class="fl">0.000289</span> <span class="op">*</span> <span class="fu">sin</span>(<span class="dv">3</span> <span class="op">*</span> sun_mean_anomaly)</span>
<span id="cb88-3033"><a href="#cb88-3033" aria-hidden="true" tabindex="-1"></a>sun_true_longitude <span class="op">=</span> sun_geometric_mean_longitude <span class="op">+</span> sun_equation_of_the_center</span>
<span id="cb88-3034"><a href="#cb88-3034" aria-hidden="true" tabindex="-1"></a>sun_true_anomaly <span class="op">=</span> sun_mean_anomaly <span class="op">+</span> sun_equation_of_the_center</span>
<span id="cb88-3035"><a href="#cb88-3035" aria-hidden="true" tabindex="-1"></a>omega <span class="op">=</span> <span class="fl">125.04</span> <span class="op">-</span> <span class="fl">1934.136</span> <span class="op">*</span> T</span>
<span id="cb88-3036"><a href="#cb88-3036" aria-hidden="true" tabindex="-1"></a>sun_aparrent_longitude <span class="op">=</span> sun_true_longitude <span class="op">-</span> <span class="fl">0.00569</span> <span class="op">-</span> <span class="fl">0.00478</span> <span class="op">*</span> <span class="fu">sin</span>(omega)</span>
<span id="cb88-3037"><a href="#cb88-3037" aria-hidden="true" tabindex="-1"></a>sun_ecliptic_obliquity <span class="op">=</span> <span class="dv">23</span> <span class="op">+</span> (<span class="dv">26</span> <span class="op">+</span> (<span class="fl">21.448</span> <span class="op">-</span> <span class="fl">46.815</span> <span class="op">*</span> T <span class="op">-</span> <span class="fl">0.00059</span> <span class="op">*</span> T <span class="op">**</span> <span class="dv">2</span> <span class="op">+</span> <span class="fl">0.001813</span> <span class="op">*</span> T <span class="op">**</span> <span class="dv">3</span>) <span class="op">/</span> <span class="dv">60</span>) <span class="op">/</span> <span class="dv">60</span></span>
<span id="cb88-3038"><a href="#cb88-3038" aria-hidden="true" tabindex="-1"></a>sun_ecliptic_obliquity_corrected <span class="op">=</span> sun_ecliptic_obliquity <span class="op">+</span> <span class="fl">0.00256</span> <span class="op">*</span> <span class="fu">cos</span>(omega)</span>
<span id="cb88-3039"><a href="#cb88-3039" aria-hidden="true" tabindex="-1"></a>sun_right_ascension <span class="op">=</span> <span class="bu">Math</span><span class="op">.</span><span class="fu">atan2</span>(</span>
<span id="cb88-3040"><a href="#cb88-3040" aria-hidden="true" tabindex="-1"></a>  <span class="fu">cos</span>(sun_ecliptic_obliquity_corrected) <span class="op">*</span> <span class="fu">sin</span>(sun_aparrent_longitude)<span class="op">,</span></span>
<span id="cb88-3041"><a href="#cb88-3041" aria-hidden="true" tabindex="-1"></a>  <span class="fu">cos</span>(sun_aparrent_longitude)</span>
<span id="cb88-3042"><a href="#cb88-3042" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb88-3043"><a href="#cb88-3043" aria-hidden="true" tabindex="-1"></a>sun_declination <span class="op">=</span> <span class="bu">Math</span><span class="op">.</span><span class="fu">asin</span>(</span>
<span id="cb88-3044"><a href="#cb88-3044" aria-hidden="true" tabindex="-1"></a>  <span class="fu">sin</span>(sun_ecliptic_obliquity_corrected) <span class="op">*</span> <span class="fu">sin</span>(sun_aparrent_longitude)</span>
<span id="cb88-3045"><a href="#cb88-3045" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb88-3046"><a href="#cb88-3046" aria-hidden="true" tabindex="-1"></a>y <span class="op">=</span> <span class="bu">Math</span><span class="op">.</span><span class="fu">tan</span>(<span class="fu">toRadians</span>(sun_ecliptic_obliquity_corrected) <span class="op">/</span> <span class="dv">2</span>) <span class="op">**</span> <span class="dv">2</span></span>
<span id="cb88-3047"><a href="#cb88-3047" aria-hidden="true" tabindex="-1"></a>equation_of_time <span class="op">=</span> <span class="fu">toDegrees</span>(</span>
<span id="cb88-3048"><a href="#cb88-3048" aria-hidden="true" tabindex="-1"></a>  y <span class="op">*</span> <span class="fu">sin</span>(<span class="dv">2</span> <span class="op">*</span> (sun_geometric_mean_longitude)) <span class="op">-</span></span>
<span id="cb88-3049"><a href="#cb88-3049" aria-hidden="true" tabindex="-1"></a>    <span class="dv">2</span> <span class="op">*</span> earth_eccentricity_orbit <span class="op">*</span> <span class="fu">sin</span>((sun_mean_anomaly)) <span class="op">+</span></span>
<span id="cb88-3050"><a href="#cb88-3050" aria-hidden="true" tabindex="-1"></a>    <span class="dv">4</span> <span class="op">*</span> earth_eccentricity_orbit <span class="op">*</span> y <span class="op">*</span> <span class="fu">sin</span>((sun_mean_anomaly)) <span class="op">*</span> <span class="fu">cos</span>(<span class="dv">2</span> <span class="op">*</span> (sun_geometric_mean_longitude)) <span class="op">-</span></span>
<span id="cb88-3051"><a href="#cb88-3051" aria-hidden="true" tabindex="-1"></a>    (<span class="dv">1</span> <span class="op">/</span> <span class="dv">2</span>) <span class="op">*</span> y <span class="op">**</span> <span class="dv">2</span> <span class="op">*</span> <span class="fu">sin</span>(<span class="dv">4</span> <span class="op">*</span> (sun_geometric_mean_longitude)) <span class="op">-</span></span>
<span id="cb88-3052"><a href="#cb88-3052" aria-hidden="true" tabindex="-1"></a>    (<span class="dv">5</span> <span class="op">/</span> <span class="dv">4</span>) <span class="op">*</span> earth_eccentricity_orbit <span class="op">**</span> <span class="dv">2</span> <span class="op">*</span> <span class="fu">sin</span>(<span class="dv">2</span> <span class="op">*</span> (sun_mean_anomaly))</span>
<span id="cb88-3053"><a href="#cb88-3053" aria-hidden="true" tabindex="-1"></a>) <span class="op">*</span> <span class="dv">4</span></span>
<span id="cb88-3054"><a href="#cb88-3054" aria-hidden="true" tabindex="-1"></a>hour_angle <span class="op">=</span> shaDegrMapPlot</span>
<span id="cb88-3055"><a href="#cb88-3055" aria-hidden="true" tabindex="-1"></a>sun_transit <span class="op">=</span> solarNoonMinu</span>
<span id="cb88-3056"><a href="#cb88-3056" aria-hidden="true" tabindex="-1"></a>sun_rise <span class="op">=</span> sun_transit <span class="op">-</span> hour_angle <span class="op">*</span> <span class="dv">4</span></span>
<span id="cb88-3057"><a href="#cb88-3057" aria-hidden="true" tabindex="-1"></a>sun_set <span class="op">=</span> sun_transit <span class="op">+</span> hour_angle <span class="op">*</span> <span class="dv">4</span></span>
<span id="cb88-3058"><a href="#cb88-3058" aria-hidden="true" tabindex="-1"></a>sun_duration <span class="op">=</span> sun_set <span class="op">-</span> sun_rise</span>
<span id="cb88-3059"><a href="#cb88-3059" aria-hidden="true" tabindex="-1"></a>sun_civil_rise <span class="op">=</span> sun_transit <span class="op">-</span> (hour_angle <span class="op">+</span> <span class="dv">6</span>) <span class="op">*</span> <span class="dv">4</span></span>
<span id="cb88-3060"><a href="#cb88-3060" aria-hidden="true" tabindex="-1"></a>sun_nautical_rise <span class="op">=</span> sun_transit <span class="op">-</span> (hour_angle <span class="op">+</span> <span class="dv">12</span>) <span class="op">*</span> <span class="dv">4</span></span>
<span id="cb88-3061"><a href="#cb88-3061" aria-hidden="true" tabindex="-1"></a>sun_astronomical_rise <span class="op">=</span> sun_transit <span class="op">-</span> (hour_angle <span class="op">+</span> <span class="dv">18</span>) <span class="op">*</span> <span class="dv">4</span></span>
<span id="cb88-3062"><a href="#cb88-3062" aria-hidden="true" tabindex="-1"></a>sun_civil_set <span class="op">=</span> sun_transit <span class="op">+</span> (hour_angle <span class="op">+</span> <span class="dv">6</span>) <span class="op">*</span> <span class="dv">4</span></span>
<span id="cb88-3063"><a href="#cb88-3063" aria-hidden="true" tabindex="-1"></a>sun_nautical_set <span class="op">=</span> sun_transit <span class="op">+</span> (hour_angle <span class="op">+</span> <span class="dv">12</span>) <span class="op">*</span> <span class="dv">4</span></span>
<span id="cb88-3064"><a href="#cb88-3064" aria-hidden="true" tabindex="-1"></a>sun_astronomical_set <span class="op">=</span> sun_transit <span class="op">+</span> (hour_angle <span class="op">+</span> <span class="dv">18</span>) <span class="op">*</span> <span class="dv">4</span></span>
<span id="cb88-3065"><a href="#cb88-3065" aria-hidden="true" tabindex="-1"></a>data <span class="op">=</span> ({</span>
<span id="cb88-3066"><a href="#cb88-3066" aria-hidden="true" tabindex="-1"></a>  <span class="dt">astronomicalSunrise</span><span class="op">:</span></span>
<span id="cb88-3067"><a href="#cb88-3067" aria-hidden="true" tabindex="-1"></a>    <span class="fu">toRadians</span>((sun_astronomical_rise <span class="op">/</span> <span class="dv">1440</span>) <span class="op">*</span> <span class="dv">360</span>) <span class="op">+</span> <span class="bu">Math</span><span class="op">.</span><span class="cn">PI</span><span class="op">,</span></span>
<span id="cb88-3068"><a href="#cb88-3068" aria-hidden="true" tabindex="-1"></a>  <span class="dt">nauticalSunrise</span><span class="op">:</span> <span class="fu">toRadians</span>((sun_nautical_rise <span class="op">/</span> <span class="dv">1440</span>) <span class="op">*</span> <span class="dv">360</span>) <span class="op">+</span> <span class="bu">Math</span><span class="op">.</span><span class="cn">PI</span><span class="op">,</span></span>
<span id="cb88-3069"><a href="#cb88-3069" aria-hidden="true" tabindex="-1"></a>  <span class="dt">civilSunrise</span><span class="op">:</span> <span class="fu">toRadians</span>((sun_civil_rise <span class="op">/</span> <span class="dv">1440</span>) <span class="op">*</span> <span class="dv">360</span>) <span class="op">+</span> <span class="bu">Math</span><span class="op">.</span><span class="cn">PI</span><span class="op">,</span></span>
<span id="cb88-3070"><a href="#cb88-3070" aria-hidden="true" tabindex="-1"></a>  <span class="dt">sunrise</span><span class="op">:</span> <span class="fu">toRadians</span>((sun_rise <span class="op">/</span> <span class="dv">1440</span>) <span class="op">*</span> <span class="dv">360</span>) <span class="op">+</span> <span class="bu">Math</span><span class="op">.</span><span class="cn">PI</span><span class="op">,</span></span>
<span id="cb88-3071"><a href="#cb88-3071" aria-hidden="true" tabindex="-1"></a>  <span class="dt">sunset</span><span class="op">:</span> <span class="fu">toRadians</span>((sun_set <span class="op">/</span> <span class="dv">1440</span>) <span class="op">*</span> <span class="dv">360</span>) <span class="op">+</span> <span class="bu">Math</span><span class="op">.</span><span class="cn">PI</span><span class="op">,</span></span>
<span id="cb88-3072"><a href="#cb88-3072" aria-hidden="true" tabindex="-1"></a>  <span class="dt">civilSunset</span><span class="op">:</span> <span class="fu">toRadians</span>((sun_civil_set <span class="op">/</span> <span class="dv">1440</span>) <span class="op">*</span> <span class="dv">360</span>) <span class="op">+</span> <span class="bu">Math</span><span class="op">.</span><span class="cn">PI</span><span class="op">,</span></span>
<span id="cb88-3073"><a href="#cb88-3073" aria-hidden="true" tabindex="-1"></a>  <span class="dt">nauticalSunset</span><span class="op">:</span> <span class="fu">toRadians</span>((sun_nautical_set <span class="op">/</span> <span class="dv">1440</span>) <span class="op">*</span> <span class="dv">360</span>) <span class="op">+</span> <span class="bu">Math</span><span class="op">.</span><span class="cn">PI</span><span class="op">,</span></span>
<span id="cb88-3074"><a href="#cb88-3074" aria-hidden="true" tabindex="-1"></a>  <span class="dt">astronomicalSunset</span><span class="op">:</span> <span class="fu">toRadians</span>((sun_astronomical_set <span class="op">/</span> <span class="dv">1440</span>) <span class="op">*</span> <span class="dv">360</span>) <span class="op">+</span> <span class="bu">Math</span><span class="op">.</span><span class="cn">PI</span><span class="op">,</span></span>
<span id="cb88-3075"><a href="#cb88-3075" aria-hidden="true" tabindex="-1"></a>  <span class="dt">solarNoon</span><span class="op">:</span> <span class="fu">toRadians</span>((sun_transit <span class="op">/</span> <span class="dv">1440</span>) <span class="op">*</span> <span class="dv">360</span>) <span class="op">+</span> <span class="bu">Math</span><span class="op">.</span><span class="cn">PI</span><span class="op">,</span></span>
<span id="cb88-3076"><a href="#cb88-3076" aria-hidden="true" tabindex="-1"></a>  <span class="dt">dayLength</span><span class="op">:</span> sun_duration</span>
<span id="cb88-3077"><a href="#cb88-3077" aria-hidden="true" tabindex="-1"></a>})</span>
<span id="cb88-3078"><a href="#cb88-3078" aria-hidden="true" tabindex="-1"></a>angles <span class="op">=</span> [</span>
<span id="cb88-3079"><a href="#cb88-3079" aria-hidden="true" tabindex="-1"></a>  {</span>
<span id="cb88-3080"><a href="#cb88-3080" aria-hidden="true" tabindex="-1"></a>    <span class="dt">start</span><span class="op">:</span> data<span class="op">.</span><span class="at">astronomicalSunrise</span><span class="op">,</span></span>
<span id="cb88-3081"><a href="#cb88-3081" aria-hidden="true" tabindex="-1"></a>    <span class="dt">end</span><span class="op">:</span> data<span class="op">.</span><span class="at">nauticalSunrise</span><span class="op">,</span></span>
<span id="cb88-3082"><a href="#cb88-3082" aria-hidden="true" tabindex="-1"></a>    <span class="dt">color</span><span class="op">:</span> <span class="st">"rgb(17,49,86)"</span></span>
<span id="cb88-3083"><a href="#cb88-3083" aria-hidden="true" tabindex="-1"></a>  }<span class="op">,</span></span>
<span id="cb88-3084"><a href="#cb88-3084" aria-hidden="true" tabindex="-1"></a>  {</span>
<span id="cb88-3085"><a href="#cb88-3085" aria-hidden="true" tabindex="-1"></a>    <span class="dt">start</span><span class="op">:</span> data<span class="op">.</span><span class="at">nauticalSunrise</span><span class="op">,</span></span>
<span id="cb88-3086"><a href="#cb88-3086" aria-hidden="true" tabindex="-1"></a>    <span class="dt">end</span><span class="op">:</span> data<span class="op">.</span><span class="at">civilSunrise</span><span class="op">,</span></span>
<span id="cb88-3087"><a href="#cb88-3087" aria-hidden="true" tabindex="-1"></a>    <span class="dt">color</span><span class="op">:</span> <span class="st">"rgb(23,61,112)"</span></span>
<span id="cb88-3088"><a href="#cb88-3088" aria-hidden="true" tabindex="-1"></a>  }<span class="op">,</span></span>
<span id="cb88-3089"><a href="#cb88-3089" aria-hidden="true" tabindex="-1"></a>  { <span class="dt">start</span><span class="op">:</span> data<span class="op">.</span><span class="at">civilSunrise</span><span class="op">,</span> <span class="dt">end</span><span class="op">:</span> data<span class="op">.</span><span class="at">sunrise</span><span class="op">,</span> <span class="dt">color</span><span class="op">:</span> <span class="st">"rgb(35,85,155)"</span> }<span class="op">,</span></span>
<span id="cb88-3090"><a href="#cb88-3090" aria-hidden="true" tabindex="-1"></a>  { <span class="dt">start</span><span class="op">:</span> data<span class="op">.</span><span class="at">sunrise</span><span class="op">,</span> <span class="dt">end</span><span class="op">:</span> data<span class="op">.</span><span class="at">sunset</span><span class="op">,</span> <span class="dt">color</span><span class="op">:</span> <span class="st">"rgb(70,155,245)"</span> }<span class="op">,</span></span>
<span id="cb88-3091"><a href="#cb88-3091" aria-hidden="true" tabindex="-1"></a>  { <span class="dt">start</span><span class="op">:</span> data<span class="op">.</span><span class="at">sunset</span><span class="op">,</span> <span class="dt">end</span><span class="op">:</span> data<span class="op">.</span><span class="at">civilSunset</span><span class="op">,</span> <span class="dt">color</span><span class="op">:</span> <span class="st">"rgb(35,85,155)"</span> }<span class="op">,</span></span>
<span id="cb88-3092"><a href="#cb88-3092" aria-hidden="true" tabindex="-1"></a>  {</span>
<span id="cb88-3093"><a href="#cb88-3093" aria-hidden="true" tabindex="-1"></a>    <span class="dt">start</span><span class="op">:</span> data<span class="op">.</span><span class="at">civilSunset</span><span class="op">,</span></span>
<span id="cb88-3094"><a href="#cb88-3094" aria-hidden="true" tabindex="-1"></a>    <span class="dt">end</span><span class="op">:</span> data<span class="op">.</span><span class="at">nauticalSunset</span><span class="op">,</span></span>
<span id="cb88-3095"><a href="#cb88-3095" aria-hidden="true" tabindex="-1"></a>    <span class="dt">color</span><span class="op">:</span> <span class="st">"rgb(23,61,112)"</span></span>
<span id="cb88-3096"><a href="#cb88-3096" aria-hidden="true" tabindex="-1"></a>  }<span class="op">,</span></span>
<span id="cb88-3097"><a href="#cb88-3097" aria-hidden="true" tabindex="-1"></a>  {</span>
<span id="cb88-3098"><a href="#cb88-3098" aria-hidden="true" tabindex="-1"></a>    <span class="dt">start</span><span class="op">:</span> data<span class="op">.</span><span class="at">nauticalSunset</span><span class="op">,</span></span>
<span id="cb88-3099"><a href="#cb88-3099" aria-hidden="true" tabindex="-1"></a>    <span class="dt">end</span><span class="op">:</span> data<span class="op">.</span><span class="at">astronomicalSunset</span><span class="op">,</span></span>
<span id="cb88-3100"><a href="#cb88-3100" aria-hidden="true" tabindex="-1"></a>    <span class="dt">color</span><span class="op">:</span> <span class="st">"rgb(17,49,86)"</span></span>
<span id="cb88-3101"><a href="#cb88-3101" aria-hidden="true" tabindex="-1"></a>  }<span class="op">,</span></span>
<span id="cb88-3102"><a href="#cb88-3102" aria-hidden="true" tabindex="-1"></a>  {</span>
<span id="cb88-3103"><a href="#cb88-3103" aria-hidden="true" tabindex="-1"></a>    <span class="dt">start</span><span class="op">:</span> data<span class="op">.</span><span class="at">astronomicalSunset</span><span class="op">,</span></span>
<span id="cb88-3104"><a href="#cb88-3104" aria-hidden="true" tabindex="-1"></a>    <span class="dt">end</span><span class="op">:</span> data<span class="op">.</span><span class="at">astronomicalSunrise</span> <span class="op">+</span> <span class="bu">Math</span><span class="op">.</span><span class="cn">PI</span> <span class="op">*</span> <span class="dv">2</span><span class="op">,</span></span>
<span id="cb88-3105"><a href="#cb88-3105" aria-hidden="true" tabindex="-1"></a>    <span class="dt">color</span><span class="op">:</span> <span class="st">"rgb(10,34,58)"</span></span>
<span id="cb88-3106"><a href="#cb88-3106" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb88-3107"><a href="#cb88-3107" aria-hidden="true" tabindex="-1"></a>]</span>
<span id="cb88-3108"><a href="#cb88-3108" aria-hidden="true" tabindex="-1"></a>getJulianDate <span class="op">=</span> (timestamp) <span class="kw">=&gt;</span> {</span>
<span id="cb88-3109"><a href="#cb88-3109" aria-hidden="true" tabindex="-1"></a>  <span class="cf">return</span> <span class="kw">new</span> <span class="bu">Date</span>(timestamp) <span class="op">/</span> <span class="dv">86400000</span> <span class="op">+</span> <span class="fl">2440587.5</span><span class="op">;</span></span>
<span id="cb88-3110"><a href="#cb88-3110" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb88-3111"><a href="#cb88-3111" aria-hidden="true" tabindex="-1"></a>sin <span class="op">=</span> (x) <span class="kw">=&gt;</span> <span class="bu">Math</span><span class="op">.</span><span class="fu">sin</span>(<span class="fu">toRadians</span>(x))</span>
<span id="cb88-3112"><a href="#cb88-3112" aria-hidden="true" tabindex="-1"></a>cos <span class="op">=</span> (x) <span class="kw">=&gt;</span> <span class="bu">Math</span><span class="op">.</span><span class="fu">cos</span>(<span class="fu">toRadians</span>(x))</span>
<span id="cb88-3113"><a href="#cb88-3113" aria-hidden="true" tabindex="-1"></a>solarNoonTurn <span class="op">=</span> (<span class="fl">9.55</span> <span class="op">+</span> selectedZone <span class="op">/</span> <span class="dv">10</span> <span class="op">-</span> lonTurnMapPlot <span class="op">-</span> eotTurnMapPlot) <span class="op">%</span> <span class="dv">1</span></span>
<span id="cb88-3114"><a href="#cb88-3114" aria-hidden="true" tabindex="-1"></a>solarNoonMinu <span class="op">=</span> solarNoonTurn <span class="op">*</span> <span class="dv">1440</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-display hidden">
<div id="sunclock-1">
<div id="ojs-cell-28-1" data-nodetype="declaration">

</div>
</div>
</div>
<div class="cell-output cell-output-display hidden">
<div id="sunclock-2">
<div id="ojs-cell-28-2" data-nodetype="declaration">

</div>
</div>
</div>
<div class="cell-output cell-output-display hidden">
<div id="sunclock-3">
<div id="ojs-cell-28-3" data-nodetype="declaration">

</div>
</div>
</div>
<div class="cell-output cell-output-display hidden">
<div id="sunclock-4">
<div id="ojs-cell-28-4" data-nodetype="declaration">

</div>
</div>
</div>
<div class="cell-output cell-output-display hidden">
<div id="sunclock-5">
<div id="ojs-cell-28-5" data-nodetype="declaration">

</div>
</div>
</div>
<div class="cell-output cell-output-display hidden">
<div id="sunclock-6">
<div id="ojs-cell-28-6" data-nodetype="declaration">

</div>
</div>
</div>
<div class="cell-output cell-output-display hidden">
<div id="sunclock-7">
<div id="ojs-cell-28-7" data-nodetype="declaration">

</div>
</div>
</div>
<div class="cell-output cell-output-display hidden">
<div id="sunclock-8">
<div id="ojs-cell-28-8" data-nodetype="declaration">

</div>
</div>
</div>
<div class="cell-output cell-output-display hidden">
<div id="sunclock-9">
<div id="ojs-cell-28-9" data-nodetype="declaration">

</div>
</div>
</div>
<div class="cell-output cell-output-display hidden">
<div id="sunclock-10">
<div id="ojs-cell-28-10" data-nodetype="declaration">

</div>
</div>
</div>
<div class="cell-output cell-output-display hidden">
<div id="sunclock-11">
<div id="ojs-cell-28-11" data-nodetype="declaration">

</div>
</div>
</div>
<div class="cell-output cell-output-display hidden">
<div id="sunclock-12">
<div id="ojs-cell-28-12" data-nodetype="declaration">

</div>
</div>
</div>
<div class="cell-output cell-output-display hidden">
<div id="sunclock-13">
<div id="ojs-cell-28-13" data-nodetype="declaration">

</div>
</div>
</div>
<div class="cell-output cell-output-display hidden">
<div id="sunclock-14">
<div id="ojs-cell-28-14" data-nodetype="declaration">

</div>
</div>
</div>
<div class="cell-output cell-output-display hidden">
<div id="sunclock-15">
<div id="ojs-cell-28-15" data-nodetype="declaration">

</div>
</div>
</div>
<div class="cell-output cell-output-display hidden">
<div id="sunclock-16">
<div id="ojs-cell-28-16" data-nodetype="declaration">

</div>
</div>
</div>
<div class="cell-output cell-output-display hidden">
<div id="sunclock-17">
<div id="ojs-cell-28-17" data-nodetype="declaration">

</div>
</div>
</div>
<div class="cell-output cell-output-display hidden">
<div id="sunclock-18">
<div id="ojs-cell-28-18" data-nodetype="declaration">

</div>
</div>
</div>
<div class="cell-output cell-output-display hidden">
<div id="sunclock-19">
<div id="ojs-cell-28-19" data-nodetype="declaration">

</div>
</div>
</div>
<div class="cell-output cell-output-display hidden">
<div id="sunclock-20">
<div id="ojs-cell-28-20" data-nodetype="declaration">

</div>
</div>
</div>
<div class="cell-output cell-output-display hidden">
<div id="sunclock-21">
<div id="ojs-cell-28-21" data-nodetype="declaration">

</div>
</div>
</div>
<div class="cell-output cell-output-display hidden">
<div id="sunclock-22">
<div id="ojs-cell-28-22" data-nodetype="declaration">

</div>
</div>
</div>
<div class="cell-output cell-output-display hidden">
<div id="sunclock-23">
<div id="ojs-cell-28-23" data-nodetype="declaration">

</div>
</div>
</div>
<div class="cell-output cell-output-display hidden">
<div id="sunclock-24">
<div id="ojs-cell-28-24" data-nodetype="declaration">

</div>
</div>
</div>
<div class="cell-output cell-output-display hidden">
<div id="sunclock-25">
<div id="ojs-cell-28-25" data-nodetype="declaration">

</div>
</div>
</div>
<div class="cell-output cell-output-display hidden">
<div id="sunclock-26">
<div id="ojs-cell-28-26" data-nodetype="declaration">

</div>
</div>
</div>
<div class="cell-output cell-output-display hidden">
<div id="sunclock-27">
<div id="ojs-cell-28-27" data-nodetype="declaration">

</div>
</div>
</div>
<div class="cell-output cell-output-display hidden">
<div id="sunclock-28">
<div id="ojs-cell-28-28" data-nodetype="declaration">

</div>
</div>
</div>
<div class="cell-output cell-output-display hidden">
<div id="sunclock-29">
<div id="ojs-cell-28-29" data-nodetype="declaration">

</div>
</div>
</div>
<div class="cell-output cell-output-display hidden">
<div id="sunclock-30">
<div id="ojs-cell-28-30" data-nodetype="declaration">

</div>
</div>
</div>
<div class="cell-output cell-output-display hidden">
<div id="sunclock-31">
<div id="ojs-cell-28-31" data-nodetype="declaration">

</div>
</div>
</div>
<div class="cell-output cell-output-display hidden">
<div id="sunclock-32">
<div id="ojs-cell-28-32" data-nodetype="declaration">

</div>
</div>
</div>
<div class="cell-output cell-output-display hidden">
<div id="sunclock-33">
<div id="ojs-cell-28-33" data-nodetype="declaration">

</div>
</div>
</div>
<div class="cell-output cell-output-display hidden">
<div id="sunclock-34">
<div id="ojs-cell-28-34" data-nodetype="declaration">

</div>
</div>
</div>
<div class="cell-output cell-output-display hidden">
<div id="sunclock-35">
<div id="ojs-cell-28-35" data-nodetype="declaration">

</div>
</div>
</div>
<div class="cell-output cell-output-display hidden">
<div id="sunclock-36">
<div id="ojs-cell-28-36" data-nodetype="declaration">

</div>
</div>
</div>
<div class="cell-output cell-output-display hidden">
<div id="sunclock-37">
<div id="ojs-cell-28-37" data-nodetype="declaration">

</div>
</div>
</div>
<div class="cell-output cell-output-display hidden">
<div id="sunclock-38">
<div id="ojs-cell-28-38" data-nodetype="declaration">

</div>
</div>
</div>
</div>
<div class="cell hidden">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code hidden" id="cb89" data-startfrom="3119" data-source-offset="0"><pre class="sourceCode js code-with-copy"><code class="sourceCode javascript" style="counter-reset: source-line 3118;"><span id="cb89-3119"><a href="#cb89-3119" aria-hidden="true" tabindex="-1"></a><span class="fu">html</span><span class="vs">`</span></span>
<span id="cb89-3120"><a href="#cb89-3120" aria-hidden="true" tabindex="-1"></a><span class="vs">&lt;style&gt;</span></span>
<span id="cb89-3121"><a href="#cb89-3121" aria-hidden="true" tabindex="-1"></a><span class="vs">.colorNight {</span></span>
<span id="cb89-3122"><a href="#cb89-3122" aria-hidden="true" tabindex="-1"></a><span class="vs">  background: #416f86;</span></span>
<span id="cb89-3123"><a href="#cb89-3123" aria-hidden="true" tabindex="-1"></a><span class="vs">  color: white;</span></span>
<span id="cb89-3124"><a href="#cb89-3124" aria-hidden="true" tabindex="-1"></a><span class="vs">  padding: 0px 2px 0px 4px;</span></span>
<span id="cb89-3125"><a href="#cb89-3125" aria-hidden="true" tabindex="-1"></a><span class="vs">  border-radius: 4px;</span></span>
<span id="cb89-3126"><a href="#cb89-3126" aria-hidden="true" tabindex="-1"></a><span class="vs">  font-weight: 400;</span></span>
<span id="cb89-3127"><a href="#cb89-3127" aria-hidden="true" tabindex="-1"></a><span class="vs">  font-family: monospace;</span></span>
<span id="cb89-3128"><a href="#cb89-3128" aria-hidden="true" tabindex="-1"></a><span class="vs">}</span></span>
<span id="cb89-3129"><a href="#cb89-3129" aria-hidden="true" tabindex="-1"></a><span class="vs">.colorDay {</span></span>
<span id="cb89-3130"><a href="#cb89-3130" aria-hidden="true" tabindex="-1"></a><span class="vs">  background: #ffe438;</span></span>
<span id="cb89-3131"><a href="#cb89-3131" aria-hidden="true" tabindex="-1"></a><span class="vs">  color: black;</span></span>
<span id="cb89-3132"><a href="#cb89-3132" aria-hidden="true" tabindex="-1"></a><span class="vs">  padding: 0px 3px 0px 4px;</span></span>
<span id="cb89-3133"><a href="#cb89-3133" aria-hidden="true" tabindex="-1"></a><span class="vs">  border-radius: 4px;</span></span>
<span id="cb89-3134"><a href="#cb89-3134" aria-hidden="true" tabindex="-1"></a><span class="vs">  font-weight: 400;</span></span>
<span id="cb89-3135"><a href="#cb89-3135" aria-hidden="true" tabindex="-1"></a><span class="vs">  font-family: monospace;</span></span>
<span id="cb89-3136"><a href="#cb89-3136" aria-hidden="true" tabindex="-1"></a><span class="vs">}</span></span>
<span id="cb89-3137"><a href="#cb89-3137" aria-hidden="true" tabindex="-1"></a><span class="vs">.colorBkg {</span></span>
<span id="cb89-3138"><a href="#cb89-3138" aria-hidden="true" tabindex="-1"></a><span class="vs">  background: </span><span class="sc">${</span><span class="bu">window</span><span class="op">.</span><span class="at">darkmode</span> <span class="op">?</span> <span class="st">"black"</span> <span class="op">:</span> <span class="st">"white"</span><span class="sc">}</span><span class="vs">;</span></span>
<span id="cb89-3139"><a href="#cb89-3139" aria-hidden="true" tabindex="-1"></a><span class="vs">  color: </span><span class="sc">${</span><span class="bu">window</span><span class="op">.</span><span class="at">darkmode</span> <span class="op">?</span> <span class="st">"white"</span> <span class="op">:</span> <span class="st">"black"</span><span class="sc">}</span><span class="vs">;</span></span>
<span id="cb89-3140"><a href="#cb89-3140" aria-hidden="true" tabindex="-1"></a><span class="vs">  padding: 0px 5px;</span></span>
<span id="cb89-3141"><a href="#cb89-3141" aria-hidden="true" tabindex="-1"></a><span class="vs">  border-radius: 4px;</span></span>
<span id="cb89-3142"><a href="#cb89-3142" aria-hidden="true" tabindex="-1"></a><span class="vs">  font-weight: 400;</span></span>
<span id="cb89-3143"><a href="#cb89-3143" aria-hidden="true" tabindex="-1"></a><span class="vs">  font-family: monospace;</span></span>
<span id="cb89-3144"><a href="#cb89-3144" aria-hidden="true" tabindex="-1"></a><span class="vs">}</span></span>
<span id="cb89-3145"><a href="#cb89-3145" aria-hidden="true" tabindex="-1"></a><span class="vs">.color0 {</span></span>
<span id="cb89-3146"><a href="#cb89-3146" aria-hidden="true" tabindex="-1"></a><span class="vs">  background: hsl(0 100% 50%);</span></span>
<span id="cb89-3147"><a href="#cb89-3147" aria-hidden="true" tabindex="-1"></a><span class="vs">  color: </span><span class="sc">${</span><span class="fu">yiq</span>(<span class="vs">`hsl(0, 100%, 50%)`</span>) <span class="op">&gt;</span> <span class="fl">0.51</span> <span class="op">?</span> <span class="st">"black"</span> <span class="op">:</span> <span class="st">"white"</span><span class="sc">}</span><span class="vs">;</span></span>
<span id="cb89-3148"><a href="#cb89-3148" aria-hidden="true" tabindex="-1"></a><span class="vs">  padding: 0px 5px;</span></span>
<span id="cb89-3149"><a href="#cb89-3149" aria-hidden="true" tabindex="-1"></a><span class="vs">  border-radius: 4px;</span></span>
<span id="cb89-3150"><a href="#cb89-3150" aria-hidden="true" tabindex="-1"></a><span class="vs">  font-weight: 400;</span></span>
<span id="cb89-3151"><a href="#cb89-3151" aria-hidden="true" tabindex="-1"></a><span class="vs">  font-family: monospace;</span></span>
<span id="cb89-3152"><a href="#cb89-3152" aria-hidden="true" tabindex="-1"></a><span class="vs">}</span></span>
<span id="cb89-3153"><a href="#cb89-3153" aria-hidden="true" tabindex="-1"></a><span class="vs">.color1by8640 {</span></span>
<span id="cb89-3154"><a href="#cb89-3154" aria-hidden="true" tabindex="-1"></a><span class="vs">  background: hsl(</span><span class="sc">${</span>h1by8640<span class="sc">}</span><span class="vs"> 100% 50%);</span></span>
<span id="cb89-3155"><a href="#cb89-3155" aria-hidden="true" tabindex="-1"></a><span class="vs">  color: </span><span class="sc">${</span><span class="fu">yiq</span>(<span class="vs">`hsl(</span><span class="sc">${</span>h1by8640<span class="sc">}</span><span class="vs">, 100%, 50%)`</span>) <span class="op">&gt;</span> <span class="fl">0.51</span> <span class="op">?</span> <span class="st">"black"</span> <span class="op">:</span> <span class="st">"white"</span><span class="sc">}</span><span class="vs">;</span></span>
<span id="cb89-3156"><a href="#cb89-3156" aria-hidden="true" tabindex="-1"></a><span class="vs">  padding: 0px 5px;</span></span>
<span id="cb89-3157"><a href="#cb89-3157" aria-hidden="true" tabindex="-1"></a><span class="vs">  border-radius: 4px;</span></span>
<span id="cb89-3158"><a href="#cb89-3158" aria-hidden="true" tabindex="-1"></a><span class="vs">  font-weight: 400;</span></span>
<span id="cb89-3159"><a href="#cb89-3159" aria-hidden="true" tabindex="-1"></a><span class="vs">  font-family: monospace;</span></span>
<span id="cb89-3160"><a href="#cb89-3160" aria-hidden="true" tabindex="-1"></a><span class="vs">}</span></span>
<span id="cb89-3161"><a href="#cb89-3161" aria-hidden="true" tabindex="-1"></a><span class="vs">.color1 {</span></span>
<span id="cb89-3162"><a href="#cb89-3162" aria-hidden="true" tabindex="-1"></a><span class="vs">  background: hsl(300 100% 50%);</span></span>
<span id="cb89-3163"><a href="#cb89-3163" aria-hidden="true" tabindex="-1"></a><span class="vs">  color: </span><span class="sc">${</span><span class="fu">yiq</span>(<span class="vs">`hsl(300, 100%, 50%)`</span>) <span class="op">&gt;</span> <span class="fl">0.51</span> <span class="op">?</span> <span class="st">"black"</span> <span class="op">:</span> <span class="st">"white"</span><span class="sc">}</span><span class="vs">;</span></span>
<span id="cb89-3164"><a href="#cb89-3164" aria-hidden="true" tabindex="-1"></a><span class="vs">  padding: 0px 5px;</span></span>
<span id="cb89-3165"><a href="#cb89-3165" aria-hidden="true" tabindex="-1"></a><span class="vs">  border-radius: 4px;</span></span>
<span id="cb89-3166"><a href="#cb89-3166" aria-hidden="true" tabindex="-1"></a><span class="vs">  font-weight: 400;</span></span>
<span id="cb89-3167"><a href="#cb89-3167" aria-hidden="true" tabindex="-1"></a><span class="vs">  font-family: monospace;</span></span>
<span id="cb89-3168"><a href="#cb89-3168" aria-hidden="true" tabindex="-1"></a><span class="vs">}</span></span>
<span id="cb89-3169"><a href="#cb89-3169" aria-hidden="true" tabindex="-1"></a><span class="vs">.color2 {</span></span>
<span id="cb89-3170"><a href="#cb89-3170" aria-hidden="true" tabindex="-1"></a><span class="vs">  background: hsl(280 100% 50%);</span></span>
<span id="cb89-3171"><a href="#cb89-3171" aria-hidden="true" tabindex="-1"></a><span class="vs">  color: </span><span class="sc">${</span><span class="fu">yiq</span>(<span class="vs">`hsl(280, 100%, 50%)`</span>) <span class="op">&gt;</span> <span class="fl">0.51</span> <span class="op">?</span> <span class="st">"black"</span> <span class="op">:</span> <span class="st">"white"</span><span class="sc">}</span><span class="vs">;</span></span>
<span id="cb89-3172"><a href="#cb89-3172" aria-hidden="true" tabindex="-1"></a><span class="vs">  padding: 0px 5px;</span></span>
<span id="cb89-3173"><a href="#cb89-3173" aria-hidden="true" tabindex="-1"></a><span class="vs">  border-radius: 4px;</span></span>
<span id="cb89-3174"><a href="#cb89-3174" aria-hidden="true" tabindex="-1"></a><span class="vs">  font-weight: 400;</span></span>
<span id="cb89-3175"><a href="#cb89-3175" aria-hidden="true" tabindex="-1"></a><span class="vs">  font-family: monospace;</span></span>
<span id="cb89-3176"><a href="#cb89-3176" aria-hidden="true" tabindex="-1"></a><span class="vs">}</span></span>
<span id="cb89-3177"><a href="#cb89-3177" aria-hidden="true" tabindex="-1"></a><span class="vs">.color3 {</span></span>
<span id="cb89-3178"><a href="#cb89-3178" aria-hidden="true" tabindex="-1"></a><span class="vs">  background: hsl(240 100% 50%);</span></span>
<span id="cb89-3179"><a href="#cb89-3179" aria-hidden="true" tabindex="-1"></a><span class="vs">  color: </span><span class="sc">${</span><span class="fu">yiq</span>(<span class="vs">`hsl(240, 100%, 50%)`</span>) <span class="op">&gt;</span> <span class="fl">0.51</span> <span class="op">?</span> <span class="st">"black"</span> <span class="op">:</span> <span class="st">"white"</span><span class="sc">}</span><span class="vs">;</span></span>
<span id="cb89-3180"><a href="#cb89-3180" aria-hidden="true" tabindex="-1"></a><span class="vs">  padding: 0px 5px;</span></span>
<span id="cb89-3181"><a href="#cb89-3181" aria-hidden="true" tabindex="-1"></a><span class="vs">  border-radius: 4px;</span></span>
<span id="cb89-3182"><a href="#cb89-3182" aria-hidden="true" tabindex="-1"></a><span class="vs">  font-weight: 400;</span></span>
<span id="cb89-3183"><a href="#cb89-3183" aria-hidden="true" tabindex="-1"></a><span class="vs">  font-family: monospace;</span></span>
<span id="cb89-3184"><a href="#cb89-3184" aria-hidden="true" tabindex="-1"></a><span class="vs">}</span></span>
<span id="cb89-3185"><a href="#cb89-3185" aria-hidden="true" tabindex="-1"></a><span class="vs">.color4 {</span></span>
<span id="cb89-3186"><a href="#cb89-3186" aria-hidden="true" tabindex="-1"></a><span class="vs">  background: hsl(200 100% 50%);</span></span>
<span id="cb89-3187"><a href="#cb89-3187" aria-hidden="true" tabindex="-1"></a><span class="vs">  color: </span><span class="sc">${</span><span class="fu">yiq</span>(<span class="vs">`hsl(200, 100%, 50%)`</span>) <span class="op">&gt;</span> <span class="fl">0.51</span> <span class="op">?</span> <span class="st">"black"</span> <span class="op">:</span> <span class="st">"white"</span><span class="sc">}</span><span class="vs">;</span></span>
<span id="cb89-3188"><a href="#cb89-3188" aria-hidden="true" tabindex="-1"></a><span class="vs">  padding: 0px 5px;</span></span>
<span id="cb89-3189"><a href="#cb89-3189" aria-hidden="true" tabindex="-1"></a><span class="vs">  border-radius: 4px;</span></span>
<span id="cb89-3190"><a href="#cb89-3190" aria-hidden="true" tabindex="-1"></a><span class="vs">  font-weight: 400;</span></span>
<span id="cb89-3191"><a href="#cb89-3191" aria-hidden="true" tabindex="-1"></a><span class="vs">  font-family: monospace;</span></span>
<span id="cb89-3192"><a href="#cb89-3192" aria-hidden="true" tabindex="-1"></a><span class="vs">}</span></span>
<span id="cb89-3193"><a href="#cb89-3193" aria-hidden="true" tabindex="-1"></a><span class="vs">.color5 {</span></span>
<span id="cb89-3194"><a href="#cb89-3194" aria-hidden="true" tabindex="-1"></a><span class="vs">  background: hsl(180 100% 50%);</span></span>
<span id="cb89-3195"><a href="#cb89-3195" aria-hidden="true" tabindex="-1"></a><span class="vs">  color: </span><span class="sc">${</span><span class="fu">yiq</span>(<span class="vs">`hsl(180, 100%, 50%)`</span>) <span class="op">&gt;</span> <span class="fl">0.51</span> <span class="op">?</span> <span class="st">"black"</span> <span class="op">:</span> <span class="st">"white"</span><span class="sc">}</span><span class="vs">;</span></span>
<span id="cb89-3196"><a href="#cb89-3196" aria-hidden="true" tabindex="-1"></a><span class="vs">  padding: 0px 5px;</span></span>
<span id="cb89-3197"><a href="#cb89-3197" aria-hidden="true" tabindex="-1"></a><span class="vs">  border-radius: 4px;</span></span>
<span id="cb89-3198"><a href="#cb89-3198" aria-hidden="true" tabindex="-1"></a><span class="vs">  font-weight: 400;</span></span>
<span id="cb89-3199"><a href="#cb89-3199" aria-hidden="true" tabindex="-1"></a><span class="vs">  font-family: monospace;</span></span>
<span id="cb89-3200"><a href="#cb89-3200" aria-hidden="true" tabindex="-1"></a><span class="vs">}</span></span>
<span id="cb89-3201"><a href="#cb89-3201" aria-hidden="true" tabindex="-1"></a><span class="vs">.color583 {</span></span>
<span id="cb89-3202"><a href="#cb89-3202" aria-hidden="true" tabindex="-1"></a><span class="vs">  background: hsl(129.88235294117646 100% 50%);</span></span>
<span id="cb89-3203"><a href="#cb89-3203" aria-hidden="true" tabindex="-1"></a><span class="vs">  color: </span><span class="sc">${</span><span class="fu">yiq</span>(<span class="vs">`hsl(129.88235294117646, 100%, 50%)`</span>) <span class="op">&gt;</span> <span class="fl">0.51</span> <span class="op">?</span> <span class="st">"black"</span> <span class="op">:</span> <span class="st">"white"</span><span class="sc">}</span><span class="vs">;</span></span>
<span id="cb89-3204"><a href="#cb89-3204" aria-hidden="true" tabindex="-1"></a><span class="vs">  padding: 0px 5px;</span></span>
<span id="cb89-3205"><a href="#cb89-3205" aria-hidden="true" tabindex="-1"></a><span class="vs">  border-radius: 4px;</span></span>
<span id="cb89-3206"><a href="#cb89-3206" aria-hidden="true" tabindex="-1"></a><span class="vs">  font-weight: 400;</span></span>
<span id="cb89-3207"><a href="#cb89-3207" aria-hidden="true" tabindex="-1"></a><span class="vs">  font-family: monospace;</span></span>
<span id="cb89-3208"><a href="#cb89-3208" aria-hidden="true" tabindex="-1"></a><span class="vs">}</span></span>
<span id="cb89-3209"><a href="#cb89-3209" aria-hidden="true" tabindex="-1"></a><span class="vs">.color6 {</span></span>
<span id="cb89-3210"><a href="#cb89-3210" aria-hidden="true" tabindex="-1"></a><span class="vs">  background: hsl(120 100% 50%);</span></span>
<span id="cb89-3211"><a href="#cb89-3211" aria-hidden="true" tabindex="-1"></a><span class="vs">  color: </span><span class="sc">${</span><span class="fu">yiq</span>(<span class="vs">`hsl(120, 100%, 50%)`</span>) <span class="op">&gt;</span> <span class="fl">0.51</span> <span class="op">?</span> <span class="st">"black"</span> <span class="op">:</span> <span class="st">"white"</span><span class="sc">}</span><span class="vs">;</span></span>
<span id="cb89-3212"><a href="#cb89-3212" aria-hidden="true" tabindex="-1"></a><span class="vs">  padding: 0px 5px;</span></span>
<span id="cb89-3213"><a href="#cb89-3213" aria-hidden="true" tabindex="-1"></a><span class="vs">  border-radius: 4px;</span></span>
<span id="cb89-3214"><a href="#cb89-3214" aria-hidden="true" tabindex="-1"></a><span class="vs">  font-weight: 400;</span></span>
<span id="cb89-3215"><a href="#cb89-3215" aria-hidden="true" tabindex="-1"></a><span class="vs">  font-family: monospace;</span></span>
<span id="cb89-3216"><a href="#cb89-3216" aria-hidden="true" tabindex="-1"></a><span class="vs">}</span></span>
<span id="cb89-3217"><a href="#cb89-3217" aria-hidden="true" tabindex="-1"></a><span class="vs">.color7 {</span></span>
<span id="cb89-3218"><a href="#cb89-3218" aria-hidden="true" tabindex="-1"></a><span class="vs">  background: hsl(80 100% 50%);</span></span>
<span id="cb89-3219"><a href="#cb89-3219" aria-hidden="true" tabindex="-1"></a><span class="vs">  color: </span><span class="sc">${</span><span class="fu">yiq</span>(<span class="vs">`hsl(80, 100%, 50%)`</span>) <span class="op">&gt;</span> <span class="fl">0.51</span> <span class="op">?</span> <span class="st">"black"</span> <span class="op">:</span> <span class="st">"white"</span><span class="sc">}</span><span class="vs">;</span></span>
<span id="cb89-3220"><a href="#cb89-3220" aria-hidden="true" tabindex="-1"></a><span class="vs">  padding: 0px 5px;</span></span>
<span id="cb89-3221"><a href="#cb89-3221" aria-hidden="true" tabindex="-1"></a><span class="vs">  border-radius: 4px;</span></span>
<span id="cb89-3222"><a href="#cb89-3222" aria-hidden="true" tabindex="-1"></a><span class="vs">  font-weight: 400;</span></span>
<span id="cb89-3223"><a href="#cb89-3223" aria-hidden="true" tabindex="-1"></a><span class="vs">  font-family: monospace;</span></span>
<span id="cb89-3224"><a href="#cb89-3224" aria-hidden="true" tabindex="-1"></a><span class="vs">}</span></span>
<span id="cb89-3225"><a href="#cb89-3225" aria-hidden="true" tabindex="-1"></a><span class="vs">.color8 {</span></span>
<span id="cb89-3226"><a href="#cb89-3226" aria-hidden="true" tabindex="-1"></a><span class="vs">  background: hsl(60 100% 50%);</span></span>
<span id="cb89-3227"><a href="#cb89-3227" aria-hidden="true" tabindex="-1"></a><span class="vs">  color: </span><span class="sc">${</span><span class="fu">yiq</span>(<span class="vs">`hsl(60, 100%, 50%)`</span>) <span class="op">&gt;</span> <span class="fl">0.51</span> <span class="op">?</span> <span class="st">"black"</span> <span class="op">:</span> <span class="st">"white"</span><span class="sc">}</span><span class="vs">;</span></span>
<span id="cb89-3228"><a href="#cb89-3228" aria-hidden="true" tabindex="-1"></a><span class="vs">  padding: 0px 5px;</span></span>
<span id="cb89-3229"><a href="#cb89-3229" aria-hidden="true" tabindex="-1"></a><span class="vs">  border-radius: 4px;</span></span>
<span id="cb89-3230"><a href="#cb89-3230" aria-hidden="true" tabindex="-1"></a><span class="vs">  font-weight: 400;</span></span>
<span id="cb89-3231"><a href="#cb89-3231" aria-hidden="true" tabindex="-1"></a><span class="vs">  font-family: monospace;</span></span>
<span id="cb89-3232"><a href="#cb89-3232" aria-hidden="true" tabindex="-1"></a><span class="vs">}</span></span>
<span id="cb89-3233"><a href="#cb89-3233" aria-hidden="true" tabindex="-1"></a><span class="vs">.color9 {</span></span>
<span id="cb89-3234"><a href="#cb89-3234" aria-hidden="true" tabindex="-1"></a><span class="vs">  background: hsl(40 100% 50%);</span></span>
<span id="cb89-3235"><a href="#cb89-3235" aria-hidden="true" tabindex="-1"></a><span class="vs">  color: </span><span class="sc">${</span><span class="fu">yiq</span>(<span class="vs">`hsl(40, 100%, 50%)`</span>) <span class="op">&gt;</span> <span class="fl">0.51</span> <span class="op">?</span> <span class="st">"black"</span> <span class="op">:</span> <span class="st">"white"</span><span class="sc">}</span><span class="vs">;</span></span>
<span id="cb89-3236"><a href="#cb89-3236" aria-hidden="true" tabindex="-1"></a><span class="vs">  padding: 0px 5px;</span></span>
<span id="cb89-3237"><a href="#cb89-3237" aria-hidden="true" tabindex="-1"></a><span class="vs">  border-radius: 4px;</span></span>
<span id="cb89-3238"><a href="#cb89-3238" aria-hidden="true" tabindex="-1"></a><span class="vs">  font-weight: 400;</span></span>
<span id="cb89-3239"><a href="#cb89-3239" aria-hidden="true" tabindex="-1"></a><span class="vs">  font-family: monospace;</span></span>
<span id="cb89-3240"><a href="#cb89-3240" aria-hidden="true" tabindex="-1"></a><span class="vs">}</span></span>
<span id="cb89-3241"><a href="#cb89-3241" aria-hidden="true" tabindex="-1"></a><span class="vs">.color375 {</span></span>
<span id="cb89-3242"><a href="#cb89-3242" aria-hidden="true" tabindex="-1"></a><span class="vs">  background: hsl(</span><span class="sc">${</span>hues[<span class="fl">0.375</span>]<span class="sc">}</span><span class="vs"> 100% 50%);</span></span>
<span id="cb89-3243"><a href="#cb89-3243" aria-hidden="true" tabindex="-1"></a><span class="vs">  color: </span><span class="sc">${</span><span class="fu">yiq</span>(<span class="vs">`hsl(</span><span class="sc">${</span>hues[<span class="fl">0.375</span>]<span class="sc">}</span><span class="vs">, 100%, 50%)`</span>) <span class="op">&gt;</span> <span class="fl">0.51</span> <span class="op">?</span> <span class="st">"black"</span> <span class="op">:</span> <span class="st">"white"</span><span class="sc">}</span><span class="vs">;</span></span>
<span id="cb89-3244"><a href="#cb89-3244" aria-hidden="true" tabindex="-1"></a><span class="vs">  padding: 0px 5px;</span></span>
<span id="cb89-3245"><a href="#cb89-3245" aria-hidden="true" tabindex="-1"></a><span class="vs">  border-radius: 4px;</span></span>
<span id="cb89-3246"><a href="#cb89-3246" aria-hidden="true" tabindex="-1"></a><span class="vs">  font-weight: 400;</span></span>
<span id="cb89-3247"><a href="#cb89-3247" aria-hidden="true" tabindex="-1"></a><span class="vs">  font-family: monospace;</span></span>
<span id="cb89-3248"><a href="#cb89-3248" aria-hidden="true" tabindex="-1"></a><span class="vs">}</span></span>
<span id="cb89-3249"><a href="#cb89-3249" aria-hidden="true" tabindex="-1"></a><span class="vs">.color0083 {</span></span>
<span id="cb89-3250"><a href="#cb89-3250" aria-hidden="true" tabindex="-1"></a><span class="vs">  background: hsl(</span><span class="sc">${</span>hues[<span class="fl">0.0083</span>]<span class="sc">}</span><span class="vs"> 100% 50%);</span></span>
<span id="cb89-3251"><a href="#cb89-3251" aria-hidden="true" tabindex="-1"></a><span class="vs">  color: </span><span class="sc">${</span><span class="fu">yiq</span>(<span class="vs">`hsl(</span><span class="sc">${</span>hues[<span class="fl">0.0083</span>]<span class="sc">}</span><span class="vs">, 100%, 50%)`</span>) <span class="op">&gt;</span> <span class="fl">0.51</span> <span class="op">?</span> <span class="st">"black"</span> <span class="op">:</span> <span class="st">"white"</span><span class="sc">}</span><span class="vs">;</span></span>
<span id="cb89-3252"><a href="#cb89-3252" aria-hidden="true" tabindex="-1"></a><span class="vs">  padding: 0px 5px;</span></span>
<span id="cb89-3253"><a href="#cb89-3253" aria-hidden="true" tabindex="-1"></a><span class="vs">  border-radius: 4px;</span></span>
<span id="cb89-3254"><a href="#cb89-3254" aria-hidden="true" tabindex="-1"></a><span class="vs">  font-weight: 400;</span></span>
<span id="cb89-3255"><a href="#cb89-3255" aria-hidden="true" tabindex="-1"></a><span class="vs">  font-family: monospace;</span></span>
<span id="cb89-3256"><a href="#cb89-3256" aria-hidden="true" tabindex="-1"></a><span class="vs">}</span></span>
<span id="cb89-3257"><a href="#cb89-3257" aria-hidden="true" tabindex="-1"></a><span class="vs">.color0166 {</span></span>
<span id="cb89-3258"><a href="#cb89-3258" aria-hidden="true" tabindex="-1"></a><span class="vs">  background: hsl(</span><span class="sc">${</span>hues[<span class="fl">0.0166</span>]<span class="sc">}</span><span class="vs"> 100% 50%);</span></span>
<span id="cb89-3259"><a href="#cb89-3259" aria-hidden="true" tabindex="-1"></a><span class="vs">  color: </span><span class="sc">${</span><span class="fu">yiq</span>(<span class="vs">`hsl(</span><span class="sc">${</span>hues[<span class="fl">0.0166</span>]<span class="sc">}</span><span class="vs">, 100%, 50%)`</span>) <span class="op">&gt;</span> <span class="fl">0.51</span> <span class="op">?</span> <span class="st">"black"</span> <span class="op">:</span> <span class="st">"white"</span><span class="sc">}</span><span class="vs">;</span></span>
<span id="cb89-3260"><a href="#cb89-3260" aria-hidden="true" tabindex="-1"></a><span class="vs">  padding: 0px 5px;</span></span>
<span id="cb89-3261"><a href="#cb89-3261" aria-hidden="true" tabindex="-1"></a><span class="vs">  border-radius: 4px;</span></span>
<span id="cb89-3262"><a href="#cb89-3262" aria-hidden="true" tabindex="-1"></a><span class="vs">  font-weight: 400;</span></span>
<span id="cb89-3263"><a href="#cb89-3263" aria-hidden="true" tabindex="-1"></a><span class="vs">  font-family: monospace;</span></span>
<span id="cb89-3264"><a href="#cb89-3264" aria-hidden="true" tabindex="-1"></a><span class="vs">}</span></span>
<span id="cb89-3265"><a href="#cb89-3265" aria-hidden="true" tabindex="-1"></a><span class="vs">.color55by24 {</span></span>
<span id="cb89-3266"><a href="#cb89-3266" aria-hidden="true" tabindex="-1"></a><span class="vs">  background: hsl(</span><span class="sc">${</span>hues[<span class="op">.</span><span class="dv">0229</span>]<span class="sc">}</span><span class="vs"> 100% 50%);</span></span>
<span id="cb89-3267"><a href="#cb89-3267" aria-hidden="true" tabindex="-1"></a><span class="vs">  color: </span><span class="sc">${</span><span class="fu">yiq</span>(<span class="vs">`hsl(</span><span class="sc">${</span>hues[<span class="op">.</span><span class="dv">0229</span>]<span class="sc">}</span><span class="vs">, 100%, 50%)`</span>) <span class="op">&gt;</span> <span class="fl">0.51</span> <span class="op">?</span> <span class="st">"black"</span> <span class="op">:</span> <span class="st">"white"</span><span class="sc">}</span><span class="vs">;</span></span>
<span id="cb89-3268"><a href="#cb89-3268" aria-hidden="true" tabindex="-1"></a><span class="vs">  padding: 0px 5px;</span></span>
<span id="cb89-3269"><a href="#cb89-3269" aria-hidden="true" tabindex="-1"></a><span class="vs">  border-radius: 4px;</span></span>
<span id="cb89-3270"><a href="#cb89-3270" aria-hidden="true" tabindex="-1"></a><span class="vs">  font-weight: 400;</span></span>
<span id="cb89-3271"><a href="#cb89-3271" aria-hidden="true" tabindex="-1"></a><span class="vs">  font-family: monospace;</span></span>
<span id="cb89-3272"><a href="#cb89-3272" aria-hidden="true" tabindex="-1"></a><span class="vs">}</span></span>
<span id="cb89-3273"><a href="#cb89-3273" aria-hidden="true" tabindex="-1"></a><span class="vs">.color125 {</span></span>
<span id="cb89-3274"><a href="#cb89-3274" aria-hidden="true" tabindex="-1"></a><span class="vs">  background: hsl(</span><span class="sc">${</span>hues[<span class="op">.</span><span class="dv">125</span>]<span class="sc">}</span><span class="vs"> 100% 50%);</span></span>
<span id="cb89-3275"><a href="#cb89-3275" aria-hidden="true" tabindex="-1"></a><span class="vs">  color: </span><span class="sc">${</span><span class="fu">yiq</span>(<span class="vs">`hsl(</span><span class="sc">${</span>hues[<span class="op">.</span><span class="dv">125</span>]<span class="sc">}</span><span class="vs">, 100%, 50%)`</span>) <span class="op">&gt;</span> <span class="fl">0.51</span> <span class="op">?</span> <span class="st">"black"</span> <span class="op">:</span> <span class="st">"white"</span><span class="sc">}</span><span class="vs">;</span></span>
<span id="cb89-3276"><a href="#cb89-3276" aria-hidden="true" tabindex="-1"></a><span class="vs">  padding: 0px 5px;</span></span>
<span id="cb89-3277"><a href="#cb89-3277" aria-hidden="true" tabindex="-1"></a><span class="vs">  border-radius: 4px;</span></span>
<span id="cb89-3278"><a href="#cb89-3278" aria-hidden="true" tabindex="-1"></a><span class="vs">  font-weight: 400;</span></span>
<span id="cb89-3279"><a href="#cb89-3279" aria-hidden="true" tabindex="-1"></a><span class="vs">  font-family: monospace;</span></span>
<span id="cb89-3280"><a href="#cb89-3280" aria-hidden="true" tabindex="-1"></a><span class="vs">}</span></span>
<span id="cb89-3281"><a href="#cb89-3281" aria-hidden="true" tabindex="-1"></a><span class="vs">.color025 {</span></span>
<span id="cb89-3282"><a href="#cb89-3282" aria-hidden="true" tabindex="-1"></a><span class="vs">  background: hsl(</span><span class="sc">${</span>hues[<span class="fl">0.025</span>]<span class="sc">}</span><span class="vs"> 100% 50%);</span></span>
<span id="cb89-3283"><a href="#cb89-3283" aria-hidden="true" tabindex="-1"></a><span class="vs">  color: </span><span class="sc">${</span><span class="fu">yiq</span>(<span class="vs">`hsl(</span><span class="sc">${</span>hues[<span class="fl">0.025</span>]<span class="sc">}</span><span class="vs">, 100%, 50%)`</span>) <span class="op">&gt;</span> <span class="fl">0.51</span> <span class="op">?</span> <span class="st">"black"</span> <span class="op">:</span> <span class="st">"white"</span><span class="sc">}</span><span class="vs">;</span></span>
<span id="cb89-3284"><a href="#cb89-3284" aria-hidden="true" tabindex="-1"></a><span class="vs">  padding: 0px 5px;</span></span>
<span id="cb89-3285"><a href="#cb89-3285" aria-hidden="true" tabindex="-1"></a><span class="vs">  border-radius: 4px;</span></span>
<span id="cb89-3286"><a href="#cb89-3286" aria-hidden="true" tabindex="-1"></a><span class="vs">  font-weight: 400;</span></span>
<span id="cb89-3287"><a href="#cb89-3287" aria-hidden="true" tabindex="-1"></a><span class="vs">  font-family: monospace;</span></span>
<span id="cb89-3288"><a href="#cb89-3288" aria-hidden="true" tabindex="-1"></a><span class="vs">}</span></span>
<span id="cb89-3289"><a href="#cb89-3289" aria-hidden="true" tabindex="-1"></a><span class="vs">.color287 {</span></span>
<span id="cb89-3290"><a href="#cb89-3290" aria-hidden="true" tabindex="-1"></a><span class="vs">  background: hsl(</span><span class="sc">${</span>hues[<span class="fl">0.287</span>]<span class="sc">}</span><span class="vs"> 100% 50%);</span></span>
<span id="cb89-3291"><a href="#cb89-3291" aria-hidden="true" tabindex="-1"></a><span class="vs">  color: </span><span class="sc">${</span><span class="fu">yiq</span>(<span class="vs">`hsl(</span><span class="sc">${</span>hues[<span class="fl">0.287</span>]<span class="sc">}</span><span class="vs">, 100%, 50%)`</span>) <span class="op">&gt;</span> <span class="fl">0.51</span> <span class="op">?</span> <span class="st">"black"</span> <span class="op">:</span> <span class="st">"white"</span><span class="sc">}</span><span class="vs">;</span></span>
<span id="cb89-3292"><a href="#cb89-3292" aria-hidden="true" tabindex="-1"></a><span class="vs">  padding: 0px 5px;</span></span>
<span id="cb89-3293"><a href="#cb89-3293" aria-hidden="true" tabindex="-1"></a><span class="vs">  border-radius: 4px;</span></span>
<span id="cb89-3294"><a href="#cb89-3294" aria-hidden="true" tabindex="-1"></a><span class="vs">  font-weight: 400;</span></span>
<span id="cb89-3295"><a href="#cb89-3295" aria-hidden="true" tabindex="-1"></a><span class="vs">  font-family: monospace;</span></span>
<span id="cb89-3296"><a href="#cb89-3296" aria-hidden="true" tabindex="-1"></a><span class="vs">}</span></span>
<span id="cb89-3297"><a href="#cb89-3297" aria-hidden="true" tabindex="-1"></a><span class="vs">.color333 {</span></span>
<span id="cb89-3298"><a href="#cb89-3298" aria-hidden="true" tabindex="-1"></a><span class="vs">  background: hsl(</span><span class="sc">${</span>hues[<span class="fl">0.333</span>]<span class="sc">}</span><span class="vs"> 100% 50%);</span></span>
<span id="cb89-3299"><a href="#cb89-3299" aria-hidden="true" tabindex="-1"></a><span class="vs">  color: </span><span class="sc">${</span><span class="fu">yiq</span>(<span class="vs">`hsl(</span><span class="sc">${</span>hues[<span class="fl">0.333</span>]<span class="sc">}</span><span class="vs">, 100%, 50%)`</span>) <span class="op">&gt;</span> <span class="fl">0.51</span> <span class="op">?</span> <span class="st">"black"</span> <span class="op">:</span> <span class="st">"white"</span><span class="sc">}</span><span class="vs">;</span></span>
<span id="cb89-3300"><a href="#cb89-3300" aria-hidden="true" tabindex="-1"></a><span class="vs">  padding: 0px 5px;</span></span>
<span id="cb89-3301"><a href="#cb89-3301" aria-hidden="true" tabindex="-1"></a><span class="vs">  border-radius: 4px;</span></span>
<span id="cb89-3302"><a href="#cb89-3302" aria-hidden="true" tabindex="-1"></a><span class="vs">  font-weight: 400;</span></span>
<span id="cb89-3303"><a href="#cb89-3303" aria-hidden="true" tabindex="-1"></a><span class="vs">  font-family: monospace;</span></span>
<span id="cb89-3304"><a href="#cb89-3304" aria-hidden="true" tabindex="-1"></a><span class="vs">}</span></span>
<span id="cb89-3305"><a href="#cb89-3305" aria-hidden="true" tabindex="-1"></a><span class="vs">.color0333 {</span></span>
<span id="cb89-3306"><a href="#cb89-3306" aria-hidden="true" tabindex="-1"></a><span class="vs">  background: hsl(</span><span class="sc">${</span>hues[<span class="fl">0.0333</span>]<span class="sc">}</span><span class="vs"> 100% 50%);</span></span>
<span id="cb89-3307"><a href="#cb89-3307" aria-hidden="true" tabindex="-1"></a><span class="vs">  color: </span><span class="sc">${</span><span class="fu">yiq</span>(<span class="vs">`hsl(</span><span class="sc">${</span>hues[<span class="fl">0.0333</span>]<span class="sc">}</span><span class="vs">, 100%, 50%)`</span>) <span class="op">&gt;</span> <span class="fl">0.51</span> <span class="op">?</span> <span class="st">"black"</span> <span class="op">:</span> <span class="st">"white"</span><span class="sc">}</span><span class="vs">;</span></span>
<span id="cb89-3308"><a href="#cb89-3308" aria-hidden="true" tabindex="-1"></a><span class="vs">  padding: 0px 5px;</span></span>
<span id="cb89-3309"><a href="#cb89-3309" aria-hidden="true" tabindex="-1"></a><span class="vs">  border-radius: 4px;</span></span>
<span id="cb89-3310"><a href="#cb89-3310" aria-hidden="true" tabindex="-1"></a><span class="vs">  font-weight: 400;</span></span>
<span id="cb89-3311"><a href="#cb89-3311" aria-hidden="true" tabindex="-1"></a><span class="vs">  font-family: monospace;</span></span>
<span id="cb89-3312"><a href="#cb89-3312" aria-hidden="true" tabindex="-1"></a><span class="vs">}</span></span>
<span id="cb89-3313"><a href="#cb89-3313" aria-hidden="true" tabindex="-1"></a><span class="vs">.color0416 {</span></span>
<span id="cb89-3314"><a href="#cb89-3314" aria-hidden="true" tabindex="-1"></a><span class="vs">  background: hsl(</span><span class="sc">${</span>hues[<span class="fl">0.0416</span>]<span class="sc">}</span><span class="vs"> 100% 50%);</span></span>
<span id="cb89-3315"><a href="#cb89-3315" aria-hidden="true" tabindex="-1"></a><span class="vs">  color: </span><span class="sc">${</span><span class="fu">yiq</span>(<span class="vs">`hsl(</span><span class="sc">${</span>hues[<span class="fl">0.0416</span>]<span class="sc">}</span><span class="vs">, 100%, 50%)`</span>) <span class="op">&gt;</span> <span class="fl">0.51</span> <span class="op">?</span> <span class="st">"black"</span> <span class="op">:</span> <span class="st">"white"</span><span class="sc">}</span><span class="vs">;</span></span>
<span id="cb89-3316"><a href="#cb89-3316" aria-hidden="true" tabindex="-1"></a><span class="vs">  padding: 0px 5px;</span></span>
<span id="cb89-3317"><a href="#cb89-3317" aria-hidden="true" tabindex="-1"></a><span class="vs">  border-radius: 4px;</span></span>
<span id="cb89-3318"><a href="#cb89-3318" aria-hidden="true" tabindex="-1"></a><span class="vs">  font-weight: 400;</span></span>
<span id="cb89-3319"><a href="#cb89-3319" aria-hidden="true" tabindex="-1"></a><span class="vs">  font-family: monospace;</span></span>
<span id="cb89-3320"><a href="#cb89-3320" aria-hidden="true" tabindex="-1"></a><span class="vs">}</span></span>
<span id="cb89-3321"><a href="#cb89-3321" aria-hidden="true" tabindex="-1"></a><span class="vs">.color429 {</span></span>
<span id="cb89-3322"><a href="#cb89-3322" aria-hidden="true" tabindex="-1"></a><span class="vs">  background: hsl(</span><span class="sc">${</span>hues[<span class="fl">0.429</span>]<span class="sc">}</span><span class="vs"> 100% 50%);</span></span>
<span id="cb89-3323"><a href="#cb89-3323" aria-hidden="true" tabindex="-1"></a><span class="vs">  color: </span><span class="sc">${</span><span class="fu">yiq</span>(<span class="vs">`hsl(</span><span class="sc">${</span>hues[<span class="fl">0.429</span>]<span class="sc">}</span><span class="vs">, 100%, 50%)`</span>) <span class="op">&gt;</span> <span class="fl">0.51</span> <span class="op">?</span> <span class="st">"black"</span> <span class="op">:</span> <span class="st">"white"</span><span class="sc">}</span><span class="vs">;</span></span>
<span id="cb89-3324"><a href="#cb89-3324" aria-hidden="true" tabindex="-1"></a><span class="vs">  padding: 0px 5px;</span></span>
<span id="cb89-3325"><a href="#cb89-3325" aria-hidden="true" tabindex="-1"></a><span class="vs">  border-radius: 4px;</span></span>
<span id="cb89-3326"><a href="#cb89-3326" aria-hidden="true" tabindex="-1"></a><span class="vs">  font-weight: 400;</span></span>
<span id="cb89-3327"><a href="#cb89-3327" aria-hidden="true" tabindex="-1"></a><span class="vs">  font-family: monospace;</span></span>
<span id="cb89-3328"><a href="#cb89-3328" aria-hidden="true" tabindex="-1"></a><span class="vs">}</span></span>
<span id="cb89-3329"><a href="#cb89-3329" aria-hidden="true" tabindex="-1"></a><span class="vs">.color05 {</span></span>
<span id="cb89-3330"><a href="#cb89-3330" aria-hidden="true" tabindex="-1"></a><span class="vs">  background: hsl(</span><span class="sc">${</span>hues[<span class="fl">0.05</span>]<span class="sc">}</span><span class="vs"> 100% 50%);</span></span>
<span id="cb89-3331"><a href="#cb89-3331" aria-hidden="true" tabindex="-1"></a><span class="vs">  color: </span><span class="sc">${</span><span class="fu">yiq</span>(<span class="vs">`hsl(</span><span class="sc">${</span>hues[<span class="fl">0.05</span>]<span class="sc">}</span><span class="vs">, 100%, 50%)`</span>) <span class="op">&gt;</span> <span class="fl">0.51</span> <span class="op">?</span> <span class="st">"black"</span> <span class="op">:</span> <span class="st">"white"</span><span class="sc">}</span><span class="vs">;</span></span>
<span id="cb89-3332"><a href="#cb89-3332" aria-hidden="true" tabindex="-1"></a><span class="vs">  padding: 0px 5px;</span></span>
<span id="cb89-3333"><a href="#cb89-3333" aria-hidden="true" tabindex="-1"></a><span class="vs">  border-radius: 4px;</span></span>
<span id="cb89-3334"><a href="#cb89-3334" aria-hidden="true" tabindex="-1"></a><span class="vs">  font-weight: 400;</span></span>
<span id="cb89-3335"><a href="#cb89-3335" aria-hidden="true" tabindex="-1"></a><span class="vs">  font-family: monospace;</span></span>
<span id="cb89-3336"><a href="#cb89-3336" aria-hidden="true" tabindex="-1"></a><span class="vs">}</span></span>
<span id="cb89-3337"><a href="#cb89-3337" aria-hidden="true" tabindex="-1"></a><span class="vs">.color533 {</span></span>
<span id="cb89-3338"><a href="#cb89-3338" aria-hidden="true" tabindex="-1"></a><span class="vs">  background: hsl(</span><span class="sc">${</span>hues[<span class="fl">0.533</span>]<span class="sc">}</span><span class="vs"> 100% 50%);</span></span>
<span id="cb89-3339"><a href="#cb89-3339" aria-hidden="true" tabindex="-1"></a><span class="vs">  color: </span><span class="sc">${</span><span class="fu">yiq</span>(<span class="vs">`hsl(</span><span class="sc">${</span>hues[<span class="fl">0.533</span>]<span class="sc">}</span><span class="vs">, 100%, 50%)`</span>) <span class="op">&gt;</span> <span class="fl">0.51</span> <span class="op">?</span> <span class="st">"black"</span> <span class="op">:</span> <span class="st">"white"</span><span class="sc">}</span><span class="vs">;</span></span>
<span id="cb89-3340"><a href="#cb89-3340" aria-hidden="true" tabindex="-1"></a><span class="vs">  padding: 0px 5px;</span></span>
<span id="cb89-3341"><a href="#cb89-3341" aria-hidden="true" tabindex="-1"></a><span class="vs">  border-radius: 4px;</span></span>
<span id="cb89-3342"><a href="#cb89-3342" aria-hidden="true" tabindex="-1"></a><span class="vs">  font-weight: 400;</span></span>
<span id="cb89-3343"><a href="#cb89-3343" aria-hidden="true" tabindex="-1"></a><span class="vs">  font-family: monospace;</span></span>
<span id="cb89-3344"><a href="#cb89-3344" aria-hidden="true" tabindex="-1"></a><span class="vs">}</span></span>
<span id="cb89-3345"><a href="#cb89-3345" aria-hidden="true" tabindex="-1"></a><span class="vs">.color969 {</span></span>
<span id="cb89-3346"><a href="#cb89-3346" aria-hidden="true" tabindex="-1"></a><span class="vs">  background: hsl(</span><span class="sc">${</span>hues[<span class="fl">0.969</span>]<span class="sc">}</span><span class="vs"> 100% 50%);</span></span>
<span id="cb89-3347"><a href="#cb89-3347" aria-hidden="true" tabindex="-1"></a><span class="vs">  color: </span><span class="sc">${</span><span class="fu">yiq</span>(<span class="vs">`hsl(</span><span class="sc">${</span>hues[<span class="fl">0.969</span>]<span class="sc">}</span><span class="vs">, 100%, 50%)`</span>) <span class="op">&gt;</span> <span class="fl">0.51</span> <span class="op">?</span> <span class="st">"black"</span> <span class="op">:</span> <span class="st">"white"</span><span class="sc">}</span><span class="vs">;</span></span>
<span id="cb89-3348"><a href="#cb89-3348" aria-hidden="true" tabindex="-1"></a><span class="vs">  padding: 0px 5px;</span></span>
<span id="cb89-3349"><a href="#cb89-3349" aria-hidden="true" tabindex="-1"></a><span class="vs">  border-radius: 4px;</span></span>
<span id="cb89-3350"><a href="#cb89-3350" aria-hidden="true" tabindex="-1"></a><span class="vs">  font-weight: 400;</span></span>
<span id="cb89-3351"><a href="#cb89-3351" aria-hidden="true" tabindex="-1"></a><span class="vs">  font-family: monospace;</span></span>
<span id="cb89-3352"><a href="#cb89-3352" aria-hidden="true" tabindex="-1"></a><span class="vs">}</span></span>
<span id="cb89-3353"><a href="#cb89-3353" aria-hidden="true" tabindex="-1"></a><span class="vs">.color999 {</span></span>
<span id="cb89-3354"><a href="#cb89-3354" aria-hidden="true" tabindex="-1"></a><span class="vs">  background: hsl(</span><span class="sc">${</span>hues[<span class="fl">0.999</span>]<span class="sc">}</span><span class="vs"> 100% 50%);</span></span>
<span id="cb89-3355"><a href="#cb89-3355" aria-hidden="true" tabindex="-1"></a><span class="vs">  color: </span><span class="sc">${</span><span class="fu">yiq</span>(<span class="vs">`hsl(</span><span class="sc">${</span>hues[<span class="fl">0.999</span>]<span class="sc">}</span><span class="vs">, 100%, 50%)`</span>) <span class="op">&gt;</span> <span class="fl">0.51</span> <span class="op">?</span> <span class="st">"black"</span> <span class="op">:</span> <span class="st">"white"</span><span class="sc">}</span><span class="vs">;</span></span>
<span id="cb89-3356"><a href="#cb89-3356" aria-hidden="true" tabindex="-1"></a><span class="vs">  padding: 0px 5px;</span></span>
<span id="cb89-3357"><a href="#cb89-3357" aria-hidden="true" tabindex="-1"></a><span class="vs">  border-radius: 4px;</span></span>
<span id="cb89-3358"><a href="#cb89-3358" aria-hidden="true" tabindex="-1"></a><span class="vs">  font-weight: 400;</span></span>
<span id="cb89-3359"><a href="#cb89-3359" aria-hidden="true" tabindex="-1"></a><span class="vs">  font-family: monospace;</span></span>
<span id="cb89-3360"><a href="#cb89-3360" aria-hidden="true" tabindex="-1"></a><span class="vs">}</span></span>
<span id="cb89-3361"><a href="#cb89-3361" aria-hidden="true" tabindex="-1"></a><span class="vs">.color1by320 {</span></span>
<span id="cb89-3362"><a href="#cb89-3362" aria-hidden="true" tabindex="-1"></a><span class="vs">  background: hsl(</span><span class="sc">${</span>h1by320<span class="sc">}</span><span class="vs"> 100% 50%);</span></span>
<span id="cb89-3363"><a href="#cb89-3363" aria-hidden="true" tabindex="-1"></a><span class="vs">  color: </span><span class="sc">${</span><span class="fu">yiq</span>(<span class="vs">`hsl(</span><span class="sc">${</span>h1by320<span class="sc">}</span><span class="vs">, 100%, 50%)`</span>) <span class="op">&gt;</span> <span class="fl">0.51</span> <span class="op">?</span> <span class="st">"black"</span> <span class="op">:</span> <span class="st">"white"</span><span class="sc">}</span><span class="vs">;</span></span>
<span id="cb89-3364"><a href="#cb89-3364" aria-hidden="true" tabindex="-1"></a><span class="vs">  padding: 0px 5px;</span></span>
<span id="cb89-3365"><a href="#cb89-3365" aria-hidden="true" tabindex="-1"></a><span class="vs">  border-radius: 4px;</span></span>
<span id="cb89-3366"><a href="#cb89-3366" aria-hidden="true" tabindex="-1"></a><span class="vs">  font-weight: 400;</span></span>
<span id="cb89-3367"><a href="#cb89-3367" aria-hidden="true" tabindex="-1"></a><span class="vs">  font-family: monospace;</span></span>
<span id="cb89-3368"><a href="#cb89-3368" aria-hidden="true" tabindex="-1"></a><span class="vs">}</span></span>
<span id="cb89-3369"><a href="#cb89-3369" aria-hidden="true" tabindex="-1"></a><span class="vs">.colorD121 {</span></span>
<span id="cb89-3370"><a href="#cb89-3370" aria-hidden="true" tabindex="-1"></a><span class="vs">  background: hsl(</span><span class="sc">${</span>hD121<span class="sc">}</span><span class="vs"> 100% 50%);</span></span>
<span id="cb89-3371"><a href="#cb89-3371" aria-hidden="true" tabindex="-1"></a><span class="vs">  color: </span><span class="sc">${</span><span class="fu">yiq</span>(<span class="vs">`hsl(</span><span class="sc">${</span>hD121<span class="sc">}</span><span class="vs">, 100%, 50%)`</span>) <span class="op">&gt;</span> <span class="fl">0.51</span> <span class="op">?</span> <span class="st">"black"</span> <span class="op">:</span> <span class="st">"white"</span><span class="sc">}</span><span class="vs">;</span></span>
<span id="cb89-3372"><a href="#cb89-3372" aria-hidden="true" tabindex="-1"></a><span class="vs">  padding: 0px 5px;</span></span>
<span id="cb89-3373"><a href="#cb89-3373" aria-hidden="true" tabindex="-1"></a><span class="vs">  border-radius: 4px;</span></span>
<span id="cb89-3374"><a href="#cb89-3374" aria-hidden="true" tabindex="-1"></a><span class="vs">  font-weight: 400;</span></span>
<span id="cb89-3375"><a href="#cb89-3375" aria-hidden="true" tabindex="-1"></a><span class="vs">  font-family: monospace;</span></span>
<span id="cb89-3376"><a href="#cb89-3376" aria-hidden="true" tabindex="-1"></a><span class="vs">}</span></span>
<span id="cb89-3377"><a href="#cb89-3377" aria-hidden="true" tabindex="-1"></a><span class="vs">.colorD268 {</span></span>
<span id="cb89-3378"><a href="#cb89-3378" aria-hidden="true" tabindex="-1"></a><span class="vs">  background: hsl(</span><span class="sc">${</span>hD268<span class="sc">}</span><span class="vs"> 100% 50%);</span></span>
<span id="cb89-3379"><a href="#cb89-3379" aria-hidden="true" tabindex="-1"></a><span class="vs">  color: </span><span class="sc">${</span><span class="fu">yiq</span>(<span class="vs">`hsl(</span><span class="sc">${</span>hD268<span class="sc">}</span><span class="vs">, 100%, 50%)`</span>) <span class="op">&gt;</span> <span class="fl">0.51</span> <span class="op">?</span> <span class="st">"black"</span> <span class="op">:</span> <span class="st">"white"</span><span class="sc">}</span><span class="vs">;</span></span>
<span id="cb89-3380"><a href="#cb89-3380" aria-hidden="true" tabindex="-1"></a><span class="vs">  padding: 0px 5px;</span></span>
<span id="cb89-3381"><a href="#cb89-3381" aria-hidden="true" tabindex="-1"></a><span class="vs">  border-radius: 4px;</span></span>
<span id="cb89-3382"><a href="#cb89-3382" aria-hidden="true" tabindex="-1"></a><span class="vs">  font-weight: 400;</span></span>
<span id="cb89-3383"><a href="#cb89-3383" aria-hidden="true" tabindex="-1"></a><span class="vs">  font-family: monospace;</span></span>
<span id="cb89-3384"><a href="#cb89-3384" aria-hidden="true" tabindex="-1"></a><span class="vs">}</span></span>
<span id="cb89-3385"><a href="#cb89-3385" aria-hidden="true" tabindex="-1"></a><span class="vs">.colorD305 {</span></span>
<span id="cb89-3386"><a href="#cb89-3386" aria-hidden="true" tabindex="-1"></a><span class="vs">  background: hsl(</span><span class="sc">${</span>hD305<span class="sc">}</span><span class="vs"> 100% 50%);</span></span>
<span id="cb89-3387"><a href="#cb89-3387" aria-hidden="true" tabindex="-1"></a><span class="vs">  color: </span><span class="sc">${</span><span class="fu">yiq</span>(<span class="vs">`hsl(</span><span class="sc">${</span>hD305<span class="sc">}</span><span class="vs">, 100%, 50%)`</span>) <span class="op">&gt;</span> <span class="fl">0.51</span> <span class="op">?</span> <span class="st">"black"</span> <span class="op">:</span> <span class="st">"white"</span><span class="sc">}</span><span class="vs">;</span></span>
<span id="cb89-3388"><a href="#cb89-3388" aria-hidden="true" tabindex="-1"></a><span class="vs">  padding: 0px 5px;</span></span>
<span id="cb89-3389"><a href="#cb89-3389" aria-hidden="true" tabindex="-1"></a><span class="vs">  border-radius: 4px;</span></span>
<span id="cb89-3390"><a href="#cb89-3390" aria-hidden="true" tabindex="-1"></a><span class="vs">  font-weight: 400;</span></span>
<span id="cb89-3391"><a href="#cb89-3391" aria-hidden="true" tabindex="-1"></a><span class="vs">  font-family: monospace;</span></span>
<span id="cb89-3392"><a href="#cb89-3392" aria-hidden="true" tabindex="-1"></a><span class="vs">}</span></span>
<span id="cb89-3393"><a href="#cb89-3393" aria-hidden="true" tabindex="-1"></a><span class="vs">.colorD306 {</span></span>
<span id="cb89-3394"><a href="#cb89-3394" aria-hidden="true" tabindex="-1"></a><span class="vs">  background: hsl(</span><span class="sc">${</span>hD306<span class="sc">}</span><span class="vs"> 100% 50%);</span></span>
<span id="cb89-3395"><a href="#cb89-3395" aria-hidden="true" tabindex="-1"></a><span class="vs">  color: </span><span class="sc">${</span><span class="fu">yiq</span>(<span class="vs">`hsl(</span><span class="sc">${</span>hD306<span class="sc">}</span><span class="vs">, 100%, 50%)`</span>) <span class="op">&gt;</span> <span class="fl">0.51</span> <span class="op">?</span> <span class="st">"black"</span> <span class="op">:</span> <span class="st">"white"</span><span class="sc">}</span><span class="vs">;</span></span>
<span id="cb89-3396"><a href="#cb89-3396" aria-hidden="true" tabindex="-1"></a><span class="vs">  padding: 0px 5px;</span></span>
<span id="cb89-3397"><a href="#cb89-3397" aria-hidden="true" tabindex="-1"></a><span class="vs">  border-radius: 4px;</span></span>
<span id="cb89-3398"><a href="#cb89-3398" aria-hidden="true" tabindex="-1"></a><span class="vs">  font-weight: 400;</span></span>
<span id="cb89-3399"><a href="#cb89-3399" aria-hidden="true" tabindex="-1"></a><span class="vs">  font-family: monospace;</span></span>
<span id="cb89-3400"><a href="#cb89-3400" aria-hidden="true" tabindex="-1"></a><span class="vs">}</span></span>
<span id="cb89-3401"><a href="#cb89-3401" aria-hidden="true" tabindex="-1"></a><span class="vs">&lt;/style&gt;</span></span>
<span id="cb89-3402"><a href="#cb89-3402" aria-hidden="true" tabindex="-1"></a><span class="vs">`</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-display hidden">
<div id="ojs-cell-29" data-nodetype="expression">

</div>
</div>
</div>
<style>
html, body {
    max-width: 100%;
}
div.cell:has(svg.barclock) {
  margin-top: -28px;
}
div.cell:has(form#formEl) {
  max-width: 100%;
  margin-top: -8px;
}
form#formEl * {
  max-width: 100%;
}
svg.barclock {
  width: 100%;
  overflow: visible;
}
.tickLabel, .tickLabel1, .tickLabel2, .timeLabel {
  font-family: monospace;
  text-anchor: middle;
}
.timeLabel {
  text-anchor: start;
}
.timeBar, .timeBarFull, .timeBarFullN {
  x: 1px;
  height: 25px;
  rx: 5px;
  stroke: #aaa;
}
.tickDek, .tickDotd, .tickDotd1, .tickC, .tickC1, .tickM, .tickM1, .tickB, .tickB1 {
  stroke: none;
  fill: #666;
  width: 1px;
}
.analogclock {
  stroke: #000;
  font-family: "HelveticaNeue-Light", "Helvetica Neue Light", "Helvetica Neue", Helvetica, Arial, "Lucida Grande", sans-serif;
  overflow: visible;
}
.analogclock #rim {
  fill: none;
  stroke: #999;
  stroke-width: 3px;
}
.analogclock .second-hand {
  stroke-width: 3;
}
.analogclock .minute-hand {
  stroke-width: 8;
  stroke-linecap: round;
}
.analogclock .hour-hand {
  stroke-width: 12;
  stroke-linecap: round;
}
.analogclock .hands-cover {
  stroke-width: 3;
  fill: #fff;
}
.analogclock .second-tick {
  stroke-width: 3;
  fill: #000;
}
.analogclock .hour-tick {
  stroke-width: 8; // same as the minute hand
}
.analogclock .second-label {
  font-size: 22px;
}
.analogclock .hour-label {
  font-size: 32px
}
.clocks * {
  overflow: visible;
  margin: -10px 0px 10px 0px;
  padding: 0px;
  text-align: center;
}
#title-block-header > div:nth-child(2) {
  display: none;
}
h4.hiddenheading, h5.hiddenheading {
  display: none;
}
div.cell-output:has(#daylightapp) {
  overflow: visible;
}
#daylightapp {
  overflow: visible;
  max-width: 100%;
}
#daylightapp * {
  overflow: visible;
}
#solar-system * {
  overflow: visible;
}
#timezonepopstackedbar {
  overflow: visible;
}
#timezonepoptoggles div {
  display: flex;
}
#timezonepoptoggles div form {
  max-width: 180px;
}
#timezonepoptoggles div form label {
  max-width: 120px;
}
#timezonepoptoggles div form:nth-child(1) {
  margin-right: 8px;
}
#timezonepoptoggles div form:nth-child(2) label {
  max-width: 110px;
}
#timezonepoptoggles input[type=checkbox] {
  margin-top: 8px;
}
div:has(form#formEl) {
  overflow: visible;
  position: relative;
  z-index: 1;
}
form#formEl div {
  max-width: 100%;
  position: relative;
  z-index: 1;
}
div.cell-output:has(#formEl) {
  margin-top: 0px;
  overflow: visible;
}
#daylightapp, #btmclock, #btmbar  {
  overflow: visible;
  position: relative;
  z-index: 99;
}
@media (max-width: 767.98px) {
  #onlymargin, #maptable {
    display: none;
  }
}
div#distmap {
  display: flex;
  justify-content: center;
  overflow-x: visible;
}
.marginInputs {
  position: relative;
  top: -220px;
  z-index: 99;
  line-height: 1;
}
#maptable {
  overflow: visible;
  display: flex;
  justify-content: center;
  line-height: 1.5;
}
#projselect > div {
  margin-top: -4px;
}
#maptable > div {
  margin-top: -16px;
}
#projselect {
  overflow: visible;
}
div#projselect > div, div#sizeinput > div, div#speedinput > div,  div#yawinput > div, div#pitchinput > div, div#rollinput > div {
  overflow-x: clip;
}
div#sizeinput label, div#speedinput label, div#yawinput label, div#pitchinput label, div#rollinput label {
  width: 30px;
}
button#rstbtn:hover {
  box-shadow: 0 4px 12px rgba(0, 0, 0, .08);
  text-decoration: none;
  transform: translateY(-1px);
}
#sizeinput #yawinput #pitchinput #rollinput {
  display: flex;
  align-items: center;
  justify-content: center;
}
input[type="number"], #sizeinput input[type="number"], #yawinput input[type="number"], #pitchinput input[type="number"], #rollinput input[type="number"] {
  width: 63px;
}
input[type="range"], #sizeinput input[type="range"], #yawinput input[type="range"], #pitchinput input[type="range"], #rollinput input[type="range"]  {
  width: 72%;
}
div#toggles {
  display: flex;
  align-items: center;
  justify-content: center;
  flex-wrap: nowrap;
  margin-top: -20px;
  margin-bottom: 9px;
}
div#toggles * {
  overflow: visible;
}
div#toggles form.oi-3a86ea-toggle#bordertoggle {
  width: 100px;
}
div#toggles form.oi-3a86ea-toggle#bordertoggle > label {
  width: 50px;
}
div#toggles form.oi-3a86ea-toggle#gridtoggle {
  width: 80px;
}
div#toggles form.oi-3a86ea-toggle#gridtoggle > label {
  width: 31px;
}
div#toggles form.oi-3a86ea-toggle#suntoggle {
  width: 75px;
}
div#toggles form.oi-3a86ea-toggle#suntoggle > label {
  width: 28px;
}
div#toggles form.oi-3a86ea-toggle#utctoggle {
  width: 80px;
}
div#toggles form.oi-3a86ea-toggle#utctoggle > label {
  width: 32px;
}
div#toggles form.oi-3a86ea-toggle > label {
  margin-top: -4px;
}
div#toggles input.oi-3a86ea-input[type="checkbox"] {
  margin-top: 1px;
}
div#toggles button#rstbtn {
  overflow: visible;
  margin-top: -6px;
}
div#maptable form {
  padding: 0px;
}
#maptable table * {
  font-size: 15px;
  padding: 0px 4px 0px 4px;
}
</style>


<!-- -->

<div class="ojs-auto-generated hidden">
<script type="ojs-module-contents">
eyJjb250ZW50cyI6WyAgeyJtZXRob2ROYW1lIjoiaW50ZXJwcmV0IiwiaW5saW5lIjoidHJ1ZSIsInNvdXJjZSI6Imh0bC5odG1sYDxzcGFuPiR7ZGVjVGltZX08L3NwYW4+YCIsICJjZWxsTmFtZSI6Im9qcy1lbGVtZW50LWlkLTEifSwgIHsibWV0aG9kTmFtZSI6ImludGVycHJldCIsImlubGluZSI6InRydWUiLCJzb3VyY2UiOiJodGwuaHRtbGA8c3Bhbj4ke2RlY1RpbWVOfTwvc3Bhbj5gIiwgImNlbGxOYW1lIjoib2pzLWVsZW1lbnQtaWQtMiJ9LCAgeyJtZXRob2ROYW1lIjoiaW50ZXJwcmV0IiwiaW5saW5lIjoidHJ1ZSIsInNvdXJjZSI6Imh0bC5odG1sYDxzcGFuPiR7ZGVjWm9uZUhzbH08L3NwYW4+YCIsICJjZWxsTmFtZSI6Im9qcy1lbGVtZW50LWlkLTMifSwgIHsibWV0aG9kTmFtZSI6ImludGVycHJldCIsImlubGluZSI6InRydWUiLCJzb3VyY2UiOiJodGwuaHRtbGA8c3Bhbj4ke3NlbERhdGVIc2x9PC9zcGFuPmAiLCAiY2VsbE5hbWUiOiJvanMtZWxlbWVudC1pZC00In0sICB7Im1ldGhvZE5hbWUiOiJpbnRlcnByZXQiLCJpbmxpbmUiOiJ0cnVlIiwic291cmNlIjoiaHRsLmh0bWxgPHNwYW4+JHtzZWxUaW1lRGF5fTwvc3Bhbj5gIiwgImNlbGxOYW1lIjoib2pzLWVsZW1lbnQtaWQtNSJ9LCAgeyJtZXRob2ROYW1lIjoiaW50ZXJwcmV0IiwiaW5saW5lIjoidHJ1ZSIsInNvdXJjZSI6Imh0bC5odG1sYDxzcGFuPiR7c2VsWWRhRGF5fTwvc3Bhbj5gIiwgImNlbGxOYW1lIjoib2pzLWVsZW1lbnQtaWQtNiJ9LCAgeyJtZXRob2ROYW1lIjoiaW50ZXJwcmV0IiwiaW5saW5lIjoidHJ1ZSIsInNvdXJjZSI6Imh0bC5odG1sYDxzcGFuPiR7emVyb1lkYUhzbH08L3NwYW4+YCIsICJjZWxsTmFtZSI6Im9qcy1lbGVtZW50LWlkLTcifSwgIHsibWV0aG9kTmFtZSI6ImludGVycHJldCIsImlubGluZSI6InRydWUiLCJzb3VyY2UiOiJodGwuaHRtbGA8c3Bhbj4ke3plcm9UaW1lSHNsMH08L3NwYW4+YCIsICJjZWxsTmFtZSI6Im9qcy1lbGVtZW50LWlkLTgifSwgIHsibWV0aG9kTmFtZSI6ImludGVycHJldCIsImlubGluZSI6InRydWUiLCJzb3VyY2UiOiJodGwuaHRtbGA8c3Bhbj4ke3plcm9Eb3RlSHNsfTwvc3Bhbj5gIiwgImNlbGxOYW1lIjoib2pzLWVsZW1lbnQtaWQtOSJ9LCAgeyJtZXRob2ROYW1lIjoiaW50ZXJwcmV0IiwiaW5saW5lIjoidHJ1ZSIsInNvdXJjZSI6Imh0bC5odG1sYDxzcGFuPiR7emVyb1RpbWVIc2wxfTwvc3Bhbj5gIiwgImNlbGxOYW1lIjoib2pzLWVsZW1lbnQtaWQtMTAifSwgIHsibWV0aG9kTmFtZSI6ImludGVycHJldCIsImlubGluZSI6InRydWUiLCJzb3VyY2UiOiJodGwuaHRtbGA8c3Bhbj4ke2xlYXBDb3VudEhzbH08L3NwYW4+YCIsICJjZWxsTmFtZSI6Im9qcy1lbGVtZW50LWlkLTExIn0sICB7Im1ldGhvZE5hbWUiOiJpbnRlcnByZXQiLCJpbmxpbmUiOiJ0cnVlIiwic291cmNlIjoiaHRsLmh0bWxgPHNwYW4+JHtsZWFwVHpvSHNsMH08L3NwYW4+YCIsICJjZWxsTmFtZSI6Im9qcy1lbGVtZW50LWlkLTEyIn0sICB7Im1ldGhvZE5hbWUiOiJpbnRlcnByZXQiLCJpbmxpbmUiOiJ0cnVlIiwic291cmNlIjoiaHRsLmh0bWxgPHNwYW4+JHtobXNUem9Ic2x9PC9zcGFuPmAiLCAiY2VsbE5hbWUiOiJvanMtZWxlbWVudC1pZC0xMyJ9LCAgeyJtZXRob2ROYW1lIjoiaW50ZXJwcmV0IiwiaW5saW5lIjoidHJ1ZSIsInNvdXJjZSI6Imh0bC5odG1sYDxzcGFuPiR7aG1zUm9kSHNsfTwvc3Bhbj5gIiwgImNlbGxOYW1lIjoib2pzLWVsZW1lbnQtaWQtMTQifSwgIHsibWV0aG9kTmFtZSI6ImludGVycHJldCIsImlubGluZSI6InRydWUiLCJzb3VyY2UiOiJodGwuaHRtbGA8c3Bhbj4ke2htc1JlZkhzbH08L3NwYW4+YCIsICJjZWxsTmFtZSI6Im9qcy1lbGVtZW50LWlkLTE1In0sICB7Im1ldGhvZE5hbWUiOiJpbnRlcnByZXQiLCJpbmxpbmUiOiJ0cnVlIiwic291cmNlIjoiaHRsLmh0bWxgPHNwYW4+JHtwYXJzZUZsb2F0KGRheXRpbWVEdXJhdGlvbi50b0ZpeGVkKDYpKX08L3NwYW4+YCIsICJjZWxsTmFtZSI6Im9qcy1lbGVtZW50LWlkLTE2In0sICB7Im1ldGhvZE5hbWUiOiJpbnRlcnByZXQiLCJpbmxpbmUiOiJ0cnVlIiwic291cmNlIjoiaHRsLmh0bWxgPHNwYW4+JHtkZWNZZWFyfTwvc3Bhbj5gIiwgImNlbGxOYW1lIjoib2pzLWVsZW1lbnQtaWQtMTcifSwgIHsibWV0aG9kTmFtZSI6ImludGVycHJldCIsImlubGluZSI6InRydWUiLCJzb3VyY2UiOiJodGwuaHRtbGA8c3Bhbj4ke2RlY0RhdGV9PC9zcGFuPmAiLCAiY2VsbE5hbWUiOiJvanMtZWxlbWVudC1pZC0xOCJ9LCAgeyJtZXRob2ROYW1lIjoiaW50ZXJwcmV0IiwiaW5saW5lIjoidHJ1ZSIsInNvdXJjZSI6Imh0bC5odG1sYDxzcGFuPiR7ZGVjWWVhcn08L3NwYW4+YCIsICJjZWxsTmFtZSI6Im9qcy1lbGVtZW50LWlkLTE5In0sICB7Im1ldGhvZE5hbWUiOiJpbnRlcnByZXQiLCJpbmxpbmUiOiJ0cnVlIiwic291cmNlIjoiaHRsLmh0bWxgPHNwYW4+JHtkZWNEYXRlfTwvc3Bhbj5gIiwgImNlbGxOYW1lIjoib2pzLWVsZW1lbnQtaWQtMjAifSwgIHsibWV0aG9kTmFtZSI6ImludGVycHJldCIsImlubGluZSI6InRydWUiLCJzb3VyY2UiOiJodGwuaHRtbGA8c3Bhbj4ke2RlY1llYXJ9PC9zcGFuPmAiLCAiY2VsbE5hbWUiOiJvanMtZWxlbWVudC1pZC0yMSJ9LCAgeyJtZXRob2ROYW1lIjoiaW50ZXJwcmV0IiwiaW5saW5lIjoidHJ1ZSIsInNvdXJjZSI6Imh0bC5odG1sYDxzcGFuPiR7ZGVjRGF0ZX08L3NwYW4+YCIsICJjZWxsTmFtZSI6Im9qcy1lbGVtZW50LWlkLTIyIn0sICB7Im1ldGhvZE5hbWUiOiJpbnRlcnByZXQiLCJpbmxpbmUiOiJ0cnVlIiwic291cmNlIjoiaHRsLmh0bWxgPHNwYW4+JHtkZWNZZWFyfTwvc3Bhbj5gIiwgImNlbGxOYW1lIjoib2pzLWVsZW1lbnQtaWQtMjMifSwgIHsibWV0aG9kTmFtZSI6ImludGVycHJldCIsImlubGluZSI6InRydWUiLCJzb3VyY2UiOiJodGwuaHRtbGA8c3Bhbj4ke2RlY0RhdGV9PC9zcGFuPmAiLCAiY2VsbE5hbWUiOiJvanMtZWxlbWVudC1pZC0yNCJ9LCAgeyJtZXRob2ROYW1lIjoiaW50ZXJwcmV0IiwiaW5saW5lIjoidHJ1ZSIsInNvdXJjZSI6Imh0bC5odG1sYDxzcGFuPiR7ZGVjWWVhcn08L3NwYW4+YCIsICJjZWxsTmFtZSI6Im9qcy1lbGVtZW50LWlkLTI1In0sICB7Im1ldGhvZE5hbWUiOiJpbnRlcnByZXQiLCJpbmxpbmUiOiJ0cnVlIiwic291cmNlIjoiaHRsLmh0bWxgPHNwYW4+JHtkZWNEYXRlfTwvc3Bhbj5gIiwgImNlbGxOYW1lIjoib2pzLWVsZW1lbnQtaWQtMjYifV19
</script>
</div>
</section><a onclick="window.scrollTo(0, 0); return false;" role="button" id="quarto-back-to-top"><i class="bi bi-arrow-up"></i> Back to top</a><div id="quarto-appendix" class="default"><section class="quarto-appendix-contents" id="quarto-reuse"><h2 class="anchored quarto-appendix-heading">Reuse</h2><div class="quarto-appendix-contents"><div><a rel="license" href="https://creativecommons.org/licenses/by-sa/4.0/">CC BY-SA 4.0</a></div></div></section><section class="quarto-appendix-contents" id="quarto-citation"><h2 class="anchored quarto-appendix-heading">Citation</h2><div><div class="quarto-appendix-secondary-label">BibTeX citation:</div><pre class="sourceCode code-with-copy quarto-appendix-bibtex"><code class="sourceCode bibtex">@online{laptev2024,
  author = {Laptev, Martin},
  title = {Dec {Time}},
  date = {2024},
  urldate = {2024},
  url = {https://maptv.github.io/dec/time},
  langid = {en}
}
</code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre><div class="quarto-appendix-secondary-label">For attribution, please cite this work as:</div><div id="ref-laptev2024" class="csl-entry quarto-appendix-citeas" role="listitem">
Laptev, Martin. 2024. <span>“Dec Time.”</span> 2024. <a href="https://maptv.github.io/dec/time">https://maptv.github.io/dec/time</a>.
</div></div></section></div></main><!-- /main --><script src="../../asset/cite.js"></script><style>
#title-block-header > div.quarto-title-banner.page-columns.page-full { margin: 0px; padding: 0px; }
#title-block-header { margin: 0px; }
main#quarto-document-content { margin: 0px; padding: 0px; }
ul.navbar-nav.navbar-nav-scroll { -webkit-flex-direction: row; }
#quarto-sidebar { padding: 0px; overflow-x: hidden !important; }
#quarto-sidebar > * { padding: 0px; }
div.quarto-title-meta { padding-bottom: 8px; }
h2, h3 { margin: 0px; }
h3 { margin-top: 17px !important; }
div.cell.page-columns.page-full { height: 0px !important; }
@media only screen and (max-width: 991px) { #quarto-search { display: none !important; } #quarto-sidebar { padding: 0px 9px 0px 9px !important; } }
@media only screen and (max-width: 767px) { div.cell.page-columns.page-full { display: none !important; } }
nav.quarto-secondary-nav { padding: 0px !important; }
nav.quarto-secondary-nav > div.container-fluid.d-flex { margin-top: -12px !important; margin-bottom: -14px !important; }
.quarto-secondary-nav-title { margin-top: 10px !important; }
.navbar-logo { max-height: 40px !important; }
section#cite a.uri { word-break: break-all !important; }
a.navbar-brand { overflow: visible !important; }
.vinculum { position: relative; }
.vinculum::before { content: ""; position: absolute; top: .5px; left: 0; width: 100%; border-top: 1.5px solid; }
</style>
<script src="../../asset/stamp.js"></script><script>
const tooltipTriggerList = document.querySelectorAll('[data-bs-toggle="tooltip"]')
const tooltipList = [...tooltipTriggerList].map(tooltipTriggerEl => new bootstrap.Tooltip(tooltipTriggerEl))
</script><script type="ojs-module-contents">
eyJjb250ZW50cyI6W3sibWV0aG9kTmFtZSI6ImludGVycHJldCIsImNlbGxOYW1lIjoib2pzLWNlbGwtMSIsImlubGluZSI6ZmFsc2UsInNvdXJjZSI6InZpZXdvZiBib3JkZXJ0b2dnbGUgPSBsYWJlbFRvZ2dsZShJbnB1dHMudG9nZ2xlLCBcIkJvcmRlclwiLCBmYWxzZSwgXCJib3JkZXJ0b2dnbGVcIilcbnZpZXdvZiBncmlkdG9nZ2xlID0gbGFiZWxUb2dnbGUoSW5wdXRzLnRvZ2dsZSwgXCJHcmlkXCIsIGZhbHNlLCBcImdyaWR0b2dnbGVcIilcbnZpZXdvZiB1dGN0b2dnbGUgPSBsYWJlbFRvZ2dsZShJbnB1dHMudG9nZ2xlLCBcIlVUQ1wiLCBmYWxzZSwgXCJ1dGN0b2dnbGVcIilcbnZpZXdvZiBzdW50b2dnbGUgPSBsYWJlbFRvZ2dsZShJbnB1dHMudG9nZ2xlLCBcIlN1blwiLCBmYWxzZSwgXCJzdW50b2dnbGVcIilcbnJzdGJ0bi5ub2RlKCk7XG4ifSx7Im1ldGhvZE5hbWUiOiJpbnRlcnByZXQiLCJjZWxsTmFtZSI6Im9qcy1jZWxsLTIiLCJpbmxpbmUiOmZhbHNlLCJzb3VyY2UiOiIvLyBodHRwczovL29ic2VydmFibGVocS5jb20vQGZoZXllbi9iYXJjaGFydC1jbG9ja1xuYmFyQ2hhcnQgPSB7XG4gIGNvbnN0IFcgPSA4MDA7XG4gIGNvbnN0IEggPSA4ODtcbiAgY29uc3QgYmFyWCA9IDE7XG4gIGNvbnN0IGZpcnN0QmFyWSA9IDE7XG4gIGNvbnN0IHN2ZyA9IGQzXG4gICAgLmNyZWF0ZShcInN2Z1wiKVxuICAgIC5hdHRyKFwid2lkdGhcIiwgVylcbiAgICAuYXR0cihcInZpZXdCb3hcIiwgWzAsIDAsIFcgLyAxLjE0LCBIXSk7XG4gIGNvbnN0IHhSYW5nZSA9IFswLCBXIC0gMTAwXTtcbiAgY29uc3Qgc2NhbGVERCA9IGQzLnNjYWxlTGluZWFyKClcbiAgICAuZG9tYWluKFswLCAxMF0pXG4gICAgLnJhbmdlKHhSYW5nZSk7XG4gIGNvbnN0IHNjYWxlTWFuZEIgPSBkMy5zY2FsZUxpbmVhcigpXG4gICAgLmRvbWFpbihbMCwgMTAwXSlcbiAgICAucmFuZ2UoeFJhbmdlKTtcbiAgLy8gQmFja2dyb3VuZCBiYXJzIHRvIHNob3cgd2hlcmUgMTAwJSBsaWVzXG4gIHN2Zy5zZWxlY3RBbGwoJy5iYWNrZ3JvdW5kJylcbiAgICAuZGF0YShbXG4gICAgICAnZGQnLCBcIm1pbHNcIiwgJ2JlYXRzJ10pXG4gICAgLmVudGVyKClcbiAgICAuYXBwZW5kKCdyZWN0JylcbiAgICAuYXR0cignY2xhc3MnLCAnYmFja2dyb3VuZCB0aW1lQmFyJylcbiAgICAuYXR0cignd2lkdGgnLCBXLTEwMClcbiAgICAuYXR0cigneScsIChkLGkpPT5pKjMwK2ZpcnN0QmFyWSlcbiAgLy8gQmVhdHNcbiAgc3ZnXG4gICAgLmFwcGVuZCgncmVjdCcpXG4gICAgLmF0dHIoJ2NsYXNzJywgJ3RpbWVCYXInKVxuICAgIC5hdHRyKCd5JywgZmlyc3RCYXJZKzYwKVxuICAgIC5hdHRyKCd3aWR0aCcsIGQgPT4gc2NhbGVNYW5kQihOdW1iZXIoYmFyQmVhdHMpKSlcbiAgc3ZnXG4gICAgLmFwcGVuZCgncmVjdCcpXG4gICAgLmF0dHIoJ2NsYXNzJywgJ3RpbWVCYXJGdWxsJylcbiAgICAuYXR0cigneScsIGZpcnN0QmFyWSs2MClcbiAgICAuYXR0cignd2lkdGgnLCBkID0+IHNjYWxlTWFuZEIoYmFyQmVhdHMpKVxuICAvLyBDZW50cy9NaWxzXG4gIHN2Z1xuICAgIC5hcHBlbmQoJ3JlY3QnKVxuICAgIC5hdHRyKCdjbGFzcycsICd0aW1lQmFyJylcbiAgICAuYXR0cigneScsIGZpcnN0QmFyWSlcbiAgICAuYXR0cignd2lkdGgnLCBkID0+IHNjYWxlREQoTnVtYmVyKGJhckREKStOdW1iZXIoYmFyTWlscykvMTAwK051bWJlcihiYXJCZWF0cykvMTAwMDApKVxuICBzdmdcbiAgICAuYXBwZW5kKCdyZWN0JylcbiAgICAuYXR0cignY2xhc3MnLCAndGltZUJhckZ1bGwnKVxuICAgIC5hdHRyKCd5JywgZmlyc3RCYXJZKVxuICAgIC5hdHRyKCd3aWR0aCcsIGQgPT4gc2NhbGVERChiYXJERCkpXG4gIHN2Z1xuICAgIC5hcHBlbmQoJ3JlY3QnKVxuICAgIC5hdHRyKCdjbGFzcycsICd0aW1lQmFyJylcbiAgICAuYXR0cigneScsIGZpcnN0QmFyWSszMClcbiAgICAuYXR0cignd2lkdGgnLCBkID0+IHNjYWxlTWFuZEIoTnVtYmVyKGJhck1pbHMpK051bWJlcihiYXJCZWF0cykvMTAwKSlcbiAgc3ZnXG4gICAgLmFwcGVuZCgncmVjdCcpXG4gICAgLmF0dHIoJ2NsYXNzJywgJ3RpbWVCYXJGdWxsJylcbiAgICAuYXR0cigneScsIGZpcnN0QmFyWSszMClcbiAgICAuYXR0cignd2lkdGgnLCBkID0+IHNjYWxlTWFuZEIoYmFyTWlscykpXG4gIC8vIENlbnQgdGlja3NcbiAgc3ZnLnNlbGVjdEFsbCgnLnRpY2tDJylcbiAgICAuZGF0YShkMy5yYW5nZSh3aWR0aCA+IDUwMCA/IDEwIDogMTAsIDEwMCkpXG4gICAgLmVudGVyKClcbiAgICAuYXBwZW5kKCdyZWN0JylcbiAgICAuYXR0cignY2xhc3MnLCAndGlja0MnKVxuICAgIC5hdHRyKCd4JywgZD0+c2NhbGVERChkLzEwKStiYXJYKVxuICAgIC5hdHRyKCd5JywgZmlyc3RCYXJZKzMwKVxuICAgIC5hdHRyKCdoZWlnaHQnLCBkPT5kJTI9PT0wPyA4OjUpXG4gIHN2Zy5zZWxlY3RBbGwoJy50aWNrQjEnKVxuICAgIC5kYXRhKGQzLnJhbmdlKHdpZHRoID4gNTAwID8gMTAgOiAxMCwgMTAwKSlcbiAgICAuZW50ZXIoKVxuICAgIC5hcHBlbmQoJ3JlY3QnKVxuICAgIC5hdHRyKCdjbGFzcycsICd0aWNrQjEnKVxuICAgIC5hdHRyKCd4JywgZD0+c2NhbGVERChkLzEwKStiYXJYKVxuICAgIC5hdHRyKCd5JywgZD0+ZCUyPT09MD8gZmlyc3RCYXJZKzc3OmZpcnN0QmFyWSs4MClcbiAgICAuYXR0cignaGVpZ2h0JywgZD0+ZCUyPT09MD8gODo1KVxuICBzdmcuc2VsZWN0QWxsKCcudGlja0MxJylcbiAgICAuZGF0YShkMy5yYW5nZSh3aWR0aCA+IDUwMCA/IDEwIDogMTAsIDEwMCkpXG4gICAgLmVudGVyKClcbiAgICAuYXBwZW5kKCdyZWN0JylcbiAgICAuYXR0cignY2xhc3MnLCAndGlja0MxJylcbiAgICAuYXR0cigneCcsIGQ9PnNjYWxlREQoZC8xMCkrYmFyWClcbiAgICAuYXR0cigneScsIGQ9PmQlMj09PTA/IGZpcnN0QmFyWSs0NzpmaXJzdEJhclkrNTApXG4gICAgLmF0dHIoJ2hlaWdodCcsIGQ9PmQlMj09PTA/IDg6NSlcbiAgLy8gTWlsIHRpY2tzXG4gIHN2Zy5zZWxlY3RBbGwoJy50aWNrTScpXG4gICAgLmRhdGEoZDMucmFuZ2Uod2lkdGggPiA1MDAgPyAxIDogMSwgMTApKVxuICAgIC5lbnRlcigpXG4gICAgLmFwcGVuZCgncmVjdCcpXG4gICAgLmF0dHIoJ2NsYXNzJywgJ3RpY2tNJylcbiAgICAuYXR0cigneCcsIGQ9PnNjYWxlREQoZCkrYmFyWClcbiAgICAuYXR0cigneScsIGZpcnN0QmFyWSsyMClcbiAgICAuYXR0cignaGVpZ2h0JywgNilcbiAgc3ZnLnNlbGVjdEFsbCgnLnRpY2tMYWJlbDEnKVxuICAgIC5kYXRhKGQzLnJhbmdlKHdpZHRoID4gNTAwID8gMSA6IDEsIDEwKSlcbiAgICAuZW50ZXIoKVxuICAgIC5hcHBlbmQoJ3RleHQnKVxuICAgIC5hdHRyKCdjbGFzcycsICd0aWNrTGFiZWwxJylcbiAgICAuYXR0cigneCcsIGQ9PnNjYWxlREQoZCkrYmFyWCsuNSlcbiAgICAuYXR0cigneScsIGZpcnN0QmFyWSsxOClcbiAgICAvLy5zdHlsZShcImZvbnQtc2l6ZVwiLCBge1cgPCA1NTAgPyAxMiA6IFcgPCA2NTAgPyAxNCA6IFcgPCA3NTAgPyAxNiA6IFcgPCA4NTAgPyAxOCA6IDIwfXB4YClcbiAgICAudGV4dChkPT5kKVxuICAvLyBDZW50IHRpY2tzXG4gIHN2Zy5zZWxlY3RBbGwoJy50aWNrQzInKVxuICAgIC5kYXRhKGQzLnJhbmdlKHdpZHRoID4gNTAwID8gMTAgOiAxMCwgMTAwKSlcbiAgICAuZW50ZXIoKVxuICAgIC5hcHBlbmQoJ3JlY3QnKVxuICAgIC5hdHRyKCdjbGFzcycsICd0aWNrQzInKVxuICAgIC5hdHRyKCd4JywgZD0+c2NhbGVERChkLzEwKStiYXJYKVxuICAgIC5hdHRyKCd5JywgZmlyc3RCYXJZKzEwKVxuICAgIC5hdHRyKCdoZWlnaHQnLCBkPT5kJTI9PT0wPyA5OjYpXG4gIC8vIEJlYXQgdGlja3NcbiAgc3ZnLnNlbGVjdEFsbCgnLnRpY2tCJylcbiAgICAuZGF0YShkMy5yYW5nZSh3aWR0aCA+IDUwMCA/IDEwIDogMTAsIDEwMCkpXG4gICAgLmVudGVyKClcbiAgICAuYXBwZW5kKCdyZWN0JylcbiAgICAuYXR0cignY2xhc3MnLCAndGlja0InKVxuICAgIC5hdHRyKCd4JywgZD0+c2NhbGVERChkLzEwKStiYXJYKVxuICAgIC5hdHRyKCd5JywgZmlyc3RCYXJZKzYwKVxuICAgIC5hdHRyKCdoZWlnaHQnLCBkPT5kJTI9PT0wPyA5OjYpXG4gIC8vIExhYmVsc1xuICBzdmcuc2VsZWN0QWxsKCcudGltZUxhYmVsJylcbiAgICAuZGF0YShbYCske2JhckREfWAsIGAke2Jhck1pbHN9YCwgYCR7YmFyQmVhdHN9YF0pXG4gICAgLmVudGVyKClcbiAgICAuYXBwZW5kKCd0ZXh0JylcbiAgICAuYXR0cignY2xhc3MnLCAndGltZUxhYmVsJylcbiAgICAuYXR0cigneCcsIGJhclgrMilcbiAgICAuYXR0cigneScsIChkLGkpPT5pKjMwK2ZpcnN0QmFyWSsyMClcbiAgICAuc3R5bGUoXCJmb250LXNpemVcIiwgYCR7VyA8IDMwMCA/IDE0IDogVyA8IDQwMCA/IDE2IDogVyA8IDUwMCA/IDE4IDogVyA8IDYwMCA/IDIwIDogMjJ9cHhgKVxuICAgIC50ZXh0KGQ9PmQpO1xuICBzdmcuYXR0cihcImlkXCIsIFwidG9wYmFyXCIpO1xuICBzdmcuYXR0cignY2xhc3MnLCAnYmFyY2xvY2snKVxuICByZXR1cm4gc3ZnLm5vZGUoKTtcbn1cbmJhckNoYXJ0MSA9IHtcbiAgY29uc3QgVyA9IDgwMDtcbiAgY29uc3QgSCA9IDg4O1xuICBjb25zdCBiYXJYID0gMTtcbiAgY29uc3QgZmlyc3RCYXJZID0gMTtcbiAgY29uc3Qgc3ZnID0gZDNcbiAgICAuY3JlYXRlKFwic3ZnXCIpXG4gICAgLmF0dHIoXCJ3aWR0aFwiLCBXKVxuICAgIC5hdHRyKFwidmlld0JveFwiLCBbMCwgMCwgVyAvIDEuMTQsIEhdKTtcbiAgY29uc3QgeFJhbmdlID0gWzAsIFcgLSAxMDBdO1xuICBjb25zdCBzY2FsZUREID0gZDMuc2NhbGVMaW5lYXIoKVxuICAgIC5kb21haW4oWzAsIDEwXSlcbiAgICAucmFuZ2UoeFJhbmdlKTtcbiAgY29uc3Qgc2NhbGVNYW5kQiA9IGQzLnNjYWxlTGluZWFyKClcbiAgICAuZG9tYWluKFswLCAxMDBdKVxuICAgIC5yYW5nZSh4UmFuZ2UpO1xuICAvLyBjb25zdCBzY2FsZURlayA9IGQzLnNjYWxlTGluZWFyKClcbiAgLy8gIC5kb21haW4oWzAsIDM3XSlcbiAgLy8gIC5yYW5nZSh4UmFuZ2UpO1xuICAvLyBCYWNrZ3JvdW5kIGJhcnMgdG8gc2hvdyB3aGVyZSAxMDAlIGxpZXNcbiAgc3ZnLnNlbGVjdEFsbCgnLmJhY2tncm91bmQnKVxuICAgIC5kYXRhKFtcbiAgICAgIC8vICdkZWsnLCAnZG90ZCcsXG4gICAgICAnZGQnLCBcIm1pbHNcIiwgJ2JlYXRzJ10pXG4gICAgLmVudGVyKClcbiAgICAuYXBwZW5kKCdyZWN0JylcbiAgICAuYXR0cignY2xhc3MnLCAnYmFja2dyb3VuZCB0aW1lQmFyJylcbiAgICAuYXR0cignd2lkdGgnLCBXLTEwMClcbiAgICAuYXR0cigneScsIChkLGkpPT5pKjMwK2ZpcnN0QmFyWSlcbiAgLy8gQmVhdHNcbiAgc3ZnXG4gICAgLmFwcGVuZCgncmVjdCcpXG4gICAgLmF0dHIoJ2NsYXNzJywgJ3RpbWVCYXInKVxuICAgIC5hdHRyKCd5JywgZmlyc3RCYXJZKzYwKVxuICAgIC5hdHRyKCd3aWR0aCcsIGQgPT4gc2NhbGVNYW5kQihOdW1iZXIoYmFyQmVhdHNOKSkpXG4gIHN2Z1xuICAgIC5hcHBlbmQoJ3JlY3QnKVxuICAgIC5hdHRyKCdjbGFzcycsICd0aW1lQmFyRnVsbE4nKVxuICAgIC5hdHRyKCd5JywgZmlyc3RCYXJZKzYwKVxuICAgIC5hdHRyKCd3aWR0aCcsIGQgPT4gc2NhbGVNYW5kQihiYXJCZWF0c04pKVxuICAvLyBDZW50cy9NaWxzXG4gIHN2Z1xuICAgIC5hcHBlbmQoJ3JlY3QnKVxuICAgIC5hdHRyKCdjbGFzcycsICd0aW1lQmFyJylcbiAgICAuYXR0cigneScsIGZpcnN0QmFyWSlcbiAgICAuYXR0cignd2lkdGgnLCBkID0+IHNjYWxlREQoTnVtYmVyKGJhckRETikrTnVtYmVyKGJhck1pbHNOKS8xMDArTnVtYmVyKGJhckJlYXRzTikvMTAwMDApKVxuICBzdmdcbiAgICAuYXBwZW5kKCdyZWN0JylcbiAgICAuYXR0cignY2xhc3MnLCAndGltZUJhckZ1bGxOJylcbiAgICAuYXR0cigneScsIGZpcnN0QmFyWSlcbiAgICAuYXR0cignd2lkdGgnLCBkID0+IHNjYWxlREQoYmFyREROKSlcbiAgc3ZnXG4gICAgLmFwcGVuZCgncmVjdCcpXG4gICAgLmF0dHIoJ2NsYXNzJywgJ3RpbWVCYXInKVxuICAgIC5hdHRyKCd5JywgZmlyc3RCYXJZKzMwKVxuICAgIC5hdHRyKCd3aWR0aCcsIGQgPT4gc2NhbGVNYW5kQihOdW1iZXIoYmFyTWlsc04pK051bWJlcihiYXJCZWF0c04pLzEwMCkpXG4gIHN2Z1xuICAgIC5hcHBlbmQoJ3JlY3QnKVxuICAgIC5hdHRyKCdjbGFzcycsICd0aW1lQmFyRnVsbE4nKVxuICAgIC5hdHRyKCd5JywgZmlyc3RCYXJZKzMwKVxuICAgIC5hdHRyKCd3aWR0aCcsIGQgPT4gc2NhbGVNYW5kQihiYXJNaWxzTikpXG4gIC8vIENlbnQgdGlja3NcbiAgc3ZnLnNlbGVjdEFsbCgnLnRpY2tDJylcbiAgICAuZGF0YShkMy5yYW5nZSh3aWR0aCA+IDUwMCA/IDEwIDogMTAsIDEwMCkpXG4gICAgLmVudGVyKClcbiAgICAuYXBwZW5kKCdyZWN0JylcbiAgICAuYXR0cignY2xhc3MnLCAndGlja0MnKVxuICAgIC5hdHRyKCd4JywgZD0+c2NhbGVERChkLzEwKStiYXJYKVxuICAgIC5hdHRyKCd5JywgZmlyc3RCYXJZKzMwKVxuICAgIC5hdHRyKCdoZWlnaHQnLCBkPT5kJTI9PT0wPyA4OjUpXG4gIHN2Zy5zZWxlY3RBbGwoJy50aWNrQjEnKVxuICAgIC5kYXRhKGQzLnJhbmdlKHdpZHRoID4gNTAwID8gMTAgOiAxMCwgMTAwKSlcbiAgICAuZW50ZXIoKVxuICAgIC5hcHBlbmQoJ3JlY3QnKVxuICAgIC5hdHRyKCdjbGFzcycsICd0aWNrQjEnKVxuICAgIC5hdHRyKCd4JywgZD0+c2NhbGVERChkLzEwKStiYXJYKVxuICAgIC5hdHRyKCd5JywgZD0+ZCUyPT09MD8gZmlyc3RCYXJZKzc3OmZpcnN0QmFyWSs4MClcbiAgICAuYXR0cignaGVpZ2h0JywgZD0+ZCUyPT09MD8gODo1KVxuICBzdmcuc2VsZWN0QWxsKCcudGlja0MxJylcbiAgICAuZGF0YShkMy5yYW5nZSh3aWR0aCA+IDUwMCA/IDEwIDogMTAsIDEwMCkpXG4gICAgLmVudGVyKClcbiAgICAuYXBwZW5kKCdyZWN0JylcbiAgICAuYXR0cignY2xhc3MnLCAndGlja0MxJylcbiAgICAuYXR0cigneCcsIGQ9PnNjYWxlREQoZC8xMCkrYmFyWClcbiAgICAuYXR0cigneScsIGQ9PmQlMj09PTA/IGZpcnN0QmFyWSs0NzpmaXJzdEJhclkrNTApXG4gICAgLmF0dHIoJ2hlaWdodCcsIGQ9PmQlMj09PTA/IDg6NSlcbiAgLy8gTWlsIHRpY2tzXG4gIHN2Zy5zZWxlY3RBbGwoJy50aWNrTScpXG4gICAgLmRhdGEoZDMucmFuZ2Uod2lkdGggPiA1MDAgPyAxIDogMSwgMTApKVxuICAgIC5lbnRlcigpXG4gICAgLmFwcGVuZCgncmVjdCcpXG4gICAgLmF0dHIoJ2NsYXNzJywgJ3RpY2tNJylcbiAgICAuYXR0cigneCcsIGQ9PnNjYWxlREQoZCkrYmFyWClcbiAgICAuYXR0cigneScsIGZpcnN0QmFyWSsyMClcbiAgICAuYXR0cignaGVpZ2h0JywgNilcbiAgc3ZnLnNlbGVjdEFsbCgnLnRpY2tMYWJlbDEnKVxuICAgIC5kYXRhKGQzLnJhbmdlKHdpZHRoID4gNTAwID8gMSA6IDEsIDEwKSlcbiAgICAuZW50ZXIoKVxuICAgIC5hcHBlbmQoJ3RleHQnKVxuICAgIC5hdHRyKCdjbGFzcycsICd0aWNrTGFiZWwxJylcbiAgICAuYXR0cigneCcsIGQ9PnNjYWxlREQoZCkrYmFyWCsuNSlcbiAgICAuYXR0cigneScsIGZpcnN0QmFyWSsxOClcbiAgICAvLy5zdHlsZShcImZvbnQtc2l6ZVwiLCBge1cgPCAzNTAgPyAxMiA6IFcgPCA0NTAgPyAxNCA6IFcgPCA1NTAgPyAxNiA6IFcgPCA2NTAgPyAxOCA6IDIwfXB4YClcbiAgICAudGV4dChkPT5kKVxuICAvLyBDZW50IHRpY2tzXG4gIHN2Zy5zZWxlY3RBbGwoJy50aWNrQzInKVxuICAgIC5kYXRhKGQzLnJhbmdlKHdpZHRoID4gNTAwID8gMTAgOiAxMCwgMTAwKSlcbiAgICAuZW50ZXIoKVxuICAgIC5hcHBlbmQoJ3JlY3QnKVxuICAgIC5hdHRyKCdjbGFzcycsICd0aWNrQzInKVxuICAgIC5hdHRyKCd4JywgZD0+c2NhbGVERChkLzEwKStiYXJYKVxuICAgIC5hdHRyKCd5JywgZmlyc3RCYXJZKzEwKVxuICAgIC5hdHRyKCdoZWlnaHQnLCBkPT5kJTI9PT0wPyA5OjYpXG4gIC8vIEJlYXQgdGlja3NcbiAgc3ZnLnNlbGVjdEFsbCgnLnRpY2tCJylcbiAgICAuZGF0YShkMy5yYW5nZSh3aWR0aCA+IDUwMCA/IDEwIDogMTAsIDEwMCkpXG4gICAgLmVudGVyKClcbiAgICAuYXBwZW5kKCdyZWN0JylcbiAgICAuYXR0cignY2xhc3MnLCAndGlja0InKVxuICAgIC5hdHRyKCd4JywgZD0+c2NhbGVERChkLzEwKStiYXJYKVxuICAgIC5hdHRyKCd5JywgZmlyc3RCYXJZKzYwKVxuICAgIC5hdHRyKCdoZWlnaHQnLCBkPT5kJTI9PT0wPyA5OjYpXG4gIC8vIExhYmVsc1xuICBzdmcuc2VsZWN0QWxsKCcudGltZUxhYmVsJylcbiAgICAuZGF0YShbYC0ke2JhckRETn1gLCBgJHtiYXJNaWxzTn1gLCBgJHtiYXJCZWF0c059YF0pXG4gICAgLmVudGVyKClcbiAgICAuYXBwZW5kKCd0ZXh0JylcbiAgICAuYXR0cignY2xhc3MnLCAndGltZUxhYmVsJylcbiAgICAuYXR0cigneCcsIGJhclgrMilcbiAgICAuYXR0cigneScsIChkLGkpPT5pKjMwK2ZpcnN0QmFyWSsyMClcbiAgICAuc3R5bGUoXCJmb250LXNpemVcIiwgYCR7VyA8IDMwMCA/IDE0IDogVyA8IDQwMCA/IDE2IDogVyA8IDUwMCA/IDE4IDogVyA8IDYwMCA/IDIwIDogMjJ9cHhgKVxuICAgIC50ZXh0KGQ9PmQpO1xuICBzdmcuYXR0cihcImlkXCIsIFwiYnRtYmFyXCIpO1xuICBzdmcuYXR0cignY2xhc3MnLCAnYmFyY2xvY2snKVxuICByZXR1cm4gc3ZnLm5vZGUoKTtcbn1cbiJ9LHsibWV0aG9kTmFtZSI6ImludGVycHJldCIsImNlbGxOYW1lIjoib2pzLWNlbGwtMyIsImlubGluZSI6ZmFsc2UsInNvdXJjZSI6InZpZXdvZiB5YXcgPSBJbnB1dHMucmFuZ2UoWzAsIDEwMDBdLCB7bGFiZWw6IFwiWWF3XCIsIHZhbHVlOiA1MDAsIHN0ZXA6IDF9KVxuIn0seyJtZXRob2ROYW1lIjoiaW50ZXJwcmV0IiwiY2VsbE5hbWUiOiJvanMtY2VsbC00IiwiaW5saW5lIjpmYWxzZSwic291cmNlIjoidmlld29mIHBpdGNoID0gSW5wdXRzLnJhbmdlKFstNTAwLCA1MDBdLCB7bGFiZWw6IFwiUGl0Y2hcIiwgdmFsdWU6IDAsIHN0ZXA6IDF9KVxuIn0seyJtZXRob2ROYW1lIjoiaW50ZXJwcmV0IiwiY2VsbE5hbWUiOiJvanMtY2VsbC01IiwiaW5saW5lIjpmYWxzZSwic291cmNlIjoidmlld29mIHJvbGwgPSBJbnB1dHMucmFuZ2UoWy01MDAsIDUwMF0sIHtsYWJlbDogXCJSb2xsXCIsIHZhbHVlOiAwLCBzdGVwOiAxfSlcbiJ9LHsibWV0aG9kTmFtZSI6ImludGVycHJldCIsImNlbGxOYW1lIjoib2pzLWNlbGwtNiIsImlubGluZSI6ZmFsc2UsInNvdXJjZSI6InZpZXdvZiBtYXBzaXplID0gSW5wdXRzLnJhbmdlKFswLCAxMDBdLCB7bGFiZWw6IFwiU2l6ZVwiLCB2YWx1ZTogMTAwLCBzdGVwOiAxfSlcbiJ9LHsibWV0aG9kTmFtZSI6ImludGVycHJldCIsImNlbGxOYW1lIjoib2pzLWNlbGwtNyIsImlubGluZSI6ZmFsc2UsInNvdXJjZSI6InZpZXdvZiBzZWxlY3QgPSBJbnB1dHMuc2VsZWN0KFxuICBwcm9qZWN0aW9ucywge2Zvcm1hdDogeCA9PiB4Lm5hbWUsIHZhbHVlOiBwcm9qZWN0aW9ucy5maW5kKHQgPT4gdC5uYW1lID09PSBcIkVxdWlyZWN0YW5ndWxhciAocGxhdGUgY2FycsOpZSlcIil9KVxuIn0seyJtZXRob2ROYW1lIjoiaW50ZXJwcmV0IiwiY2VsbE5hbWUiOiJvanMtY2VsbC04IiwiaW5saW5lIjpmYWxzZSwic291cmNlIjoidGFibGUgPSBjcmVhdGVUYWJsZShbXG4gIHsgTWlsbGlwYXJhbGxlbDogODAwLCBNaWxsaW1lcmlkaWFuOiAwIH0sXG5dLCB7IGhlYWRlckVkaXRhYmxlOiBmYWxzZSwgYXBwZW5kUm93czogZmFsc2UgfSlcbi8vICAge1BvaW50OiAwLCBNaWxsaXBhcmFsbGVsOiBgJHtNYXRoLmZsb29yKGxvbmcydHVybihQbGFjZV9BWzBdLCAzKSl9YCwgTWlsbGltZXJpZGlhbjogYCR7TWF0aC5mbG9vcihsYXRpMnR1cm4oUGxhY2VfQVsxXSwgMykpfWAsIE1pbGxpd2luZHJvc2U6IGAke01hdGguZmxvb3IobGF0aTJ0dXJuKGNvb3IyYmVhcihQbGFjZV9BLCBQbGFjZV9CKSkpfWB9LFxuLy8gICB7UG9pbnQ6IDEsIE1pbGxpcGFyYWxsZWw6IGAke01hdGguZmxvb3IobG9uZzJ0dXJuKFBsYWNlX0JbMF0sIDMpKX1gLCBNaWxsaW1lcmlkaWFuOiBgJHtNYXRoLmZsb29yKGxhdGkydHVybihQbGFjZV9CWzFdLCAzKSl9YCwgTWlsbGl3aW5kcm9zZTogYCR7TWF0aC5mbG9vcihsYXRpMnR1cm4oY29vcjJiZWFyKFBsYWNlX0IsIFBsYWNlX0EpKSl9YH0sXG4vLyBdLCB7aGVhZGVyRWRpdGFibGU6IGZhbHNlLCBhcHBlbmRSb3dzOiBmYWxzZX0pXG4ifSx7Im1ldGhvZE5hbWUiOiJpbnRlcnByZXQiLCJjZWxsTmFtZSI6Im9qcy1jZWxsLTkiLCJpbmxpbmUiOmZhbHNlLCJzb3VyY2UiOiJ2aWV3b2YgbG9jYXRpb24gPSB3b3JsZE1hcENvb3JkaW5hdGVzKFtbMTYyLCAwXSwgcHJvamVjdGlvbl0sIFt3aWR0aCwgaGVpZ2h0ICogbWFwc2l6ZSAvIDEwMF0pXG4ifSx7Im1ldGhvZE5hbWUiOiJpbnRlcnByZXQiLCJjZWxsTmFtZSI6Im9qcy1jZWxsLTEwIiwiaW5saW5lIjpmYWxzZSwic291cmNlIjoiLy8gaHR0cHM6Ly9vYnNlcnZhYmxlaHEuY29tL0BkYnJpZGdlcy92aXN1YWxpemluZy1zZWFzb25hbC1kYXlsaWdodFxuYXBwID0ge1xuICBjb25zdCBzdmcgPSBkMy5zZWxlY3QoRE9NLnN2Zyh3aWR0aCwgaGVpZ2h0ICogKHdpZHRoIDwgMzAwID8gLjk3IDogd2lkdGggPCAzNTAgPyAuOTYgOiB3aWR0aCA8IDQwMCA/IC45NSA6IHdpZHRoIDwgNDUwID8gLjk0IDogd2lkdGggPCA1MDAgPyAuOTMgOiB3aWR0aCA8IDU1MCA/IC45MiA6IHdpZHRoIDwgNjAwID8gLjkgOiB3aWR0aCA8IDY1MCA/IC44NiA6IHdpZHRoIDwgNzAwID8gLjgyIDogd2lkdGggPCA4MDAgPyAuODEgOiB3aWR0aCA8IDkwMCA/IC44MCA6IHdpZHRoIDwgMTAwMCA/IC43NiA6IHdpZHRoIDwgMTEwMCA/IC43NCA6IHdpZHRoIDwgMTIwMCA/IC43MiA6IC43KSkpO1xuICBzdmcuc3R5bGUoXCJ1c2VyLXNlbGVjdFwiLCBcIm5vbmVcIikuc3R5bGUoXCItd2Via2l0LXVzZXItc2VsZWN0XCIsIFwibm9uZVwiKS5hdHRyKFwiaWRcIiwgXCJkYXlsaWdodGFwcFwiKTtcbiAgY29uc3QgbWFyZ2luID0ge3RvcDogMCwgbGVmdDogMTYsIHJpZ2h0OiAxNiwgYm90dG9tOiAwLCBpbm5lcjogMzJ9O1xuICBjb25zdCBjb250ZW50V2lkdGggPSB3aWR0aCAtIG1hcmdpbi5sZWZ0IC0gbWFyZ2luLnJpZ2h0IC0gbWFyZ2luLmlubmVyO1xuICBjb25zdCBjb2x1bW5XaWR0aCA9IGNvbnRlbnRXaWR0aCAvIDI7XG4gIGxldCBzZWxlY3Rpb24gPSB7XG4gICAgZGF0ZTogdGhpcy52YWx1ZSAhPSBudWxsID8gdGhpcy52YWx1ZS5kYXRlIDogbmV3IERhdGUoMjAyMiwgbmV3IERhdGUoKS5nZXRNb250aCgpLCBuZXcgRGF0ZSgpLmdldERhdGUoKSwgbmV3IERhdGUoKS5nZXRIb3VycygpKSxcbiAgICBob3VyOiB0aGlzLnZhbHVlICE9IG51bGwgPyB0aGlzLnZhbHVlLmhvdXIgOiBuZXcgRGF0ZSgyMDIyLCBuZXcgRGF0ZSgpLmdldE1vbnRoKCksIG5ldyBEYXRlKCkuZ2V0RGF0ZSgpLCBuZXcgRGF0ZSgpLmdldEhvdXJzKCkpLmdldEhvdXJzKClcbiAgfVxuICBjb25zdCByZW5kZXJQbG90ID0gKCkgPT4ge1xuICAgIHN2Zy5zZWxlY3RBbGwoXCIjcGxvdCAqXCIpLnJlbW92ZSgpO1xuICAgIHN2Zy5zZWxlY3QoXCIjcGxvdFwiKS5jYWxsKGRheWxpZ2h0UGxvdCwge1xuICAgIHZpendpZHRoOiBjb2x1bW5XaWR0aCAvICh3aWR0aCA8IDMwMCA/IDEgOiB3aWR0aCA8IDQwMCA/IDEuMDUgOiB3aWR0aCA8IDQ1MCA/IDEuMSA6IHdpZHRoIDwgNTAwID8gMS4xNSA6IHdpZHRoIDwgNTUwID8gMS4yIDogd2lkdGggPCA2MDAgPyAxLjI1IDogd2lkdGggPCA2NTAgPyAxLjMgOiB3aWR0aCA8IDcwMCA/IDEuNCA6IDEuNDgpLFxuICAgICAgaGVpZ2h0OiBoZWlnaHQgKiAod2lkdGggPCA0MDAgPyAxLjYyIDogd2lkdGggPCA1MDAgPyAxLjYgOiB3aWR0aCA8IDYwMCA/IDEuNTQgOiB3aWR0aCA8IDgwMCA/IDEuNTQgOiB3aWR0aCA8IDkwMCA/IDEuNTQgOiB3aWR0aCA8IDEwMDAgPyAxLjU0IDogd2lkdGggPCAxMTAwID8gMS41NCA6IHdpZHRoIDwgMTIwMCA/IDEuNTQgOiB3aWR0aCA8IDEzMDAgPyAxLjU0IDogd2lkdGggPCAxNDAwID8gMS41NCA6IDEuNTYpLFxuICAgICAgeWVhcjogMjAyMixcbiAgICAgIGxhdGl0dWRlOiBsb2NhdGlvblsxXSxcbiAgICAgIGRlZmF1bHREYXRlOiBzZWxlY3Rpb24uZGF0ZSxcbiAgICAgIGRlZmF1bHRIb3VyOiBzZWxlY3Rpb24uaG91clxuICAgIH0pXG4gIH1cbiAgY29uc3QgcmVuZGVyU29sYXJTeXN0ZW0gPSAoKSA9PiB7XG4gICAgc3ZnLnNlbGVjdEFsbChcIiNzb2xhci1zeXN0ZW0gKlwiKS5yZW1vdmUoKTtcbiAgICBzdmcuc2VsZWN0QWxsKFwiI3NvbGFyLXN5c3RlbVwiKS5jYWxsKHNvbGFyU3lzdGVtLFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNvbHVtbldpZHRoICogMi4wMixcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBsb2NhdGlvbixcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBzZWxlY3Rpb24uZGF0ZSxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBzZWxlY3Rpb24uaG91cixcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB3aW5kb3cuZGFya21vZGUpO1xuICB9XG4gIC8vIGNvbnN0IHJlbmRlckdsb2JlID0gKCkgPT4ge1xuICAvLyAgIHN2Zy5zZWxlY3RBbGwoXCIjZ2xvYmUgKlwiKS5yZW1vdmUoKTtcbiAgLy8gICBzdmcuc2VsZWN0QWxsKFwiI2dsb2JlXCIpLmNhbGwoZ2xvYmUsIHsgdml6d2lkdGg6IGNvbHVtbldpZHRoIC8gMS4yOCwgbG9jYXRpb24sIC4uLnNlbGVjdGlvbiB9KTtcbiAgLy8gfVxuICBjb25zdCBzZXRTZWxlY3Rpb24gPSAobmV3U2VsZWN0aW9uLCBmb3JjZVJlbmRlciA9IGZhbHNlKSA9PiB7XG4gICAgY29uc3QgcHJldiA9IHsuLi5zZWxlY3Rpb259O1xuICAgIHNlbGVjdGlvbiA9IG5ld1NlbGVjdGlvbjtcbiAgICBzdmcubm9kZSgpLnZhbHVlID0gc2VsZWN0aW9uO1xuICAgIHRoaXMudmFsdWUgPSBzZWxlY3Rpb247XG4gICAgc2V0KHZpZXdvZiBzZWxlY3RlZERhdGUsIHNlbGVjdGlvbi5kYXRlKTtcbiAgICBzZXQodmlld29mIHNlbGVjdGVkSG91ciwgc2VsZWN0aW9uLmhvdXIpO1xuICAgIGlmIChmb3JjZVJlbmRlcikge1xuICAgICAgcmVuZGVyUGxvdCgpO1xuICAgICAgcmVuZGVyU29sYXJTeXN0ZW0oKTtcbiAgLy8gICAgcmVuZGVyR2xvYmUoKTtcbiAgICB9IGVsc2UgaWYgKHByZXYuaG91ciAhPT0gc2VsZWN0aW9uLmhvdXIgfHwgcHJldi5kYXRlICE9PSBzZWxlY3Rpb24uZGF0ZSkge1xuICAgICAgcmVuZGVyU29sYXJTeXN0ZW0oKTtcbiAgLy8gICAgcmVuZGVyR2xvYmUoKTtcbn1cbiAgfVxuICBjb25zdCBwbG90ID0gc3ZnLmFwcGVuZChcImdcIilcbiAgICAuYXR0cihcImlkXCIsIFwicGxvdFwiKVxuICAgIC5hdHRyKFwidHJhbnNmb3JtXCIsIGB0cmFuc2xhdGUoJHttYXJnaW4ubGVmdCArICh3aWR0aCA8IDUwMCA/IDI2IDogd2lkdGggPCA2MDAgPyAyNCA6IHdpZHRoIDwgNzAwID8gMjIgOiB3aWR0aCA8IDgwMCA/IDIwIDogd2lkdGggPCA5MDAgPyAxOCA6IHdpZHRoIDwgOTUwID8gMTYgOiB3aWR0aCA8IDEwMDAgPyAxNSA6IHdpZHRoIDwgMTEwMCA/IDIyIDogd2lkdGggPCAxMjAwID8gMjAgOiB3aWR0aCA8IDEzMDAgPyAxNSA6IHdpZHRoIDwgMTQwMCA/IDEwIDogd2lkdGggPCAxNTAwID8gNSA6IDApfSwgJHt3aWR0aCA8IDUwMCA/IC00IDogd2lkdGggPCA2MDAgPyAtMTIgOiB3aWR0aCA8IDcwMCA/IC0yMCA6IHdpZHRoIDwgODAwID8gLTI4IDogd2lkdGggPCA5MDAgPyAtMzYgOiB3aWR0aCA8IDk1MCA/IC00NCA6IHdpZHRoIDwgMTAwMCA/IC00OCA6IHdpZHRoIDwgMTEwMCA/IC01MiA6IHdpZHRoIDwgMTIwMCA/IC01NCA6IHdpZHRoIDwgMTMwMCA/IC01NiA6IHdpZHRoIDwgMTQwMCA/IC02MCA6IHdpZHRoIDwgMTQ1MCA/IC02MiA6IC03Nn0pYCk7XG4gIHN2Zy5hcHBlbmQoXCJnXCIpXG4gICAgLmF0dHIoXCJpZFwiLCBcInNvbGFyLXN5c3RlbVwiKVxuICAgIC5hdHRyKFwidHJhbnNmb3JtXCIsIGB0cmFuc2xhdGUoJHttYXJnaW4ubGVmdCArIDEyfSwgJHttYXJnaW4udG9wICsgaGVpZ2h0IC8gMS42ICsgNiArIDUgKiAod2lkdGggPCA0MDApfSlgKTtcbiAgLy8gc3ZnLmFwcGVuZChcImdcIilcbiAgLy8gICAuYXR0cihcImlkXCIsIFwiZ2xvYmVcIilcbiAgLy8gICAuYXR0cihcInRyYW5zZm9ybVwiLCBgdHJhbnNsYXRlKCR7bWFyZ2luLmxlZnQgKyBtYXJnaW4uaW5uZXIgKyBjb2x1bW5XaWR0aCAvIDIgKyAyMH0sICR7bWFyZ2luLnRvcCArIGhlaWdodCAvIDEuMiArIDR9KWApO1xuICBzZXRTZWxlY3Rpb24oc2VsZWN0aW9uLCB0cnVlKTtcbiAgY29uc3QgaGFuZGxlRGF0ZUhvdXJDaGFuZ2UgPSAoeyB0YXJnZXQsIGRldGFpbDogeyBkYXRlLCBob3VyIH19KSA9PiB7XG4gICAgaWYgKGRhdGUgIT0gbnVsbCAmJiBob3VyICE9IG51bGwpIHNldFNlbGVjdGlvbih7Li4uc2VsZWN0aW9uLCBkYXRlLCBob3VyfSk7XG4gIH1cbiAgc3ZnLm5vZGUoKS5hZGRFdmVudExpc3RlbmVyKEV2ZW50VHlwZS5EYXRlSG91ckNoYW5nZSwgaGFuZGxlRGF0ZUhvdXJDaGFuZ2UsIGZhbHNlKTtcbiAgcmV0dXJuIHN2Zy5ub2RlKCk7XG59XG4ifSx7Im1ldGhvZE5hbWUiOiJpbnRlcnByZXQiLCJjZWxsTmFtZSI6Im9qcy1jZWxsLTExIiwiaW5saW5lIjpmYWxzZSwic291cmNlIjoid2lkdGhcbiJ9LHsibWV0aG9kTmFtZSI6ImludGVycHJldCIsImNlbGxOYW1lIjoib2pzLWNlbGwtMTIiLCJpbmxpbmUiOmZhbHNlLCJzb3VyY2UiOiJobXMgPSBuZXcgRGF0ZSgpO1xuaG1zLmdldFVUQ0hvdXJzKCkgLyAyNCArXG5obXMuZ2V0VVRDTWludXRlcygpIC8gMTQ0MCArXG5obXMuZ2V0VVRDU2Vjb25kcygpIC8gODY0MDAgK1xuaG1zLmdldFVUQ01pbGxpc2Vjb25kcygpIC8gODY0ZTU7XG5obXMuZ2V0VGltZSgpIC8gODY0ZTUgJSAxO1xuIn0seyJtZXRob2ROYW1lIjoiaW50ZXJwcmV0IiwiY2VsbE5hbWUiOiJvanMtY2VsbC0xMyIsImlubGluZSI6ZmFsc2UsInNvdXJjZSI6ImRzYSA9IERhdGUubm93KCkgLyA4NjRlNSAlIDEgKiA4NjQwMDtcbmhzYSA9IGRzYSAlIDM2MDA7XG5bZHNhIC8gMzYwMCwgaHNhIC8gNjAsIGhzYSAlIDYwXS5tYXAoTWF0aC5mbG9vcilcbiJ9LHsibWV0aG9kTmFtZSI6ImludGVycHJldCIsImNlbGxOYW1lIjoib2pzLWNlbGwtMTQiLCJpbmxpbmUiOmZhbHNlLCJzb3VyY2UiOiJ2aWV3b2YgbGVhcFNlY29uZFllYXIgPSBJbnB1dHMucmFuZ2UoWzE5NzAsIDIwMjBdLCB7bGFiZWw6IFwiWWVhclwiLCB2YWx1ZTogMTk5NSwgc3RlcDogMX0pXG52aWV3b2YgbGVhcFNlY29uZERhdGUgPSBJbnB1dHMucmFuZ2UoWzAsIDM2NV0sIHtsYWJlbDogXCJEYXlcIiwgdmFsdWU6IDE4Miwgc3RlcDogMX0pXG4ifSx7Im1ldGhvZE5hbWUiOiJpbnRlcnByZXQiLCJjZWxsTmFtZSI6Im9qcy1jZWxsLTE1IiwiaW5saW5lIjpmYWxzZSwic291cmNlIjoidmlld29mIGhtc2lucHV0ID0gSW5wdXRzLmZvcm0oW1xuICBJbnB1dHMucmFuZ2UoWzAsIDIzXSwge2xhYmVsOiBcIkhvdXJcIiwgdmFsdWU6IDExLCBzdGVwOiAxfSksXG4gIElucHV0cy5yYW5nZShbMCwgNTldLCB7bGFiZWw6IFwiTWludXRlXCIsIHZhbHVlOiAwLCBzdGVwOiAxfSksXG4gIElucHV0cy5yYW5nZShbMCwgNTldLCB7bGFiZWw6IFwiU2Vjb25kXCIsIHZhbHVlOiAwLCBzdGVwOiAxfSksXG5dKVxuIn0seyJtZXRob2ROYW1lIjoiaW50ZXJwcmV0IiwiY2VsbE5hbWUiOiJvanMtY2VsbC0xNiIsImlubGluZSI6ZmFsc2UsInNvdXJjZSI6InZpZXdvZiBkaWdpdHMgPSBJbnB1dHMucmFuZ2UoWzEsIDldLCB7bGFiZWw6IFwiRGlnaXRzXCIsIHZhbHVlOiAzLCBzdGVwOiAxfSlcbiJ9LHsibWV0aG9kTmFtZSI6ImludGVycHJldCIsImNlbGxOYW1lIjoib2pzLWNlbGwtMTciLCJpbmxpbmUiOmZhbHNlLCJzb3VyY2UiOiIvLyBodHRwczovL29ic2VydmFibGVocS5jb20vQG1hdHRkenVnYW4vcG9wdWxhdGlvbi1ieS10aW1lLXpvbmUtY3JlYXRpbmctYS1kYXRhc2V0XG52aWV3b2Ygc29ydFBhcmFtcyA9IElucHV0cy5mb3JtKFtcbiAgSW5wdXRzLnRvZ2dsZSh7IGxhYmVsOiBcIlNvcnQgYXNjZW5kaW5nXCIgfSksXG4gIElucHV0cy50b2dnbGUoeyBsYWJlbDogXCJTb3J0IGJ5IG9mZnNldFwiIH0pLFxuICBdKVxuIn0seyJtZXRob2ROYW1lIjoiaW50ZXJwcmV0IiwiY2VsbE5hbWUiOiJvanMtY2VsbC0xOCIsImlubGluZSI6ZmFsc2UsInNvdXJjZSI6Ii8vIGh0dHBzOi8vb2JzZXJ2YWJsZWhxLmNvbS9AbWF0dGR6dWdhbi9wb3B1bGF0aW9uLWJ5LXRpbWUtem9uZS1jcmVhdGluZy1hLWRhdGFzZXRcblBsb3QucGxvdCh7XG4gIHdpZHRoOiB3aWR0aCxcbiAgbWFyZ2luQm90dG9tOiA1MCxcbiAgc3R5bGU6IGBvdmVyZmxvdzogdmlzaWJsZTtmb250LXNpemU6MTZweDtgLFxuICBjb2xvcjoge3NjaGVtZTogXCJSZEJ1XCIsIGNsYXNzTmFtZTogXCJiYXJQbG90TGVnZW5kXCJ9LFxuICBtYXJnaW5MZWZ0OiA3NSxcbiAgeTogeyBsYWJlbDogbnVsbCB9LFxuICB4OiB7IGdyaWQ6IHRydWUsIGxhYmVsOiBcIlBvcHVsYXRpb24gKGJpbGxpb25zKVwiLCBsYWJlbE9mZnNldDogMzgsIHRyYW5zZm9ybTogZCA9PiBkIC8gMWU5IH0sXG4gIG1hcmtzOiBbXG4gICAgUGxvdC5iYXJYKHNvcnRlZFBvcCwge3g6IFwicG9wXCIsIHk6IFwiU2lnblwiLCBmaWxsOiBcIk9mZnNldFwiLCBzdHJva2U6IFwiYmxhY2tcIiwgdGlwOiB0cnVlIH0pLFxuICBdXG59KVxuIn0seyJtZXRob2ROYW1lIjoiaW50ZXJwcmV0IiwiY2VsbE5hbWUiOiJvanMtY2VsbC0xOSIsImlubGluZSI6ZmFsc2UsInNvdXJjZSI6InNpbmNvc3BpID0gcmVxdWlyZShcbiAgJ2h0dHBzOi8vY2RuLmpzZGVsaXZyLm5ldC9naC9zdGRsaWItanMvbWF0aC1iYXNlLXNwZWNpYWwtc2luY29zcGlAdW1kL2Jyb3dzZXIuanMnXG4gIClcbmZ1bmN0aW9uIHNpbmNvc3RhdSh0dXJuKSB7XG4gIHJldHVybiBzaW5jb3NwaSgyICogdHVybik7XG59XG5mdW5jdGlvbiBzaW5jb3ModHVybikge1xuICB0dXJuICo9IDIgKiBNYXRoLlBJXG4gIHJldHVybiBbTWF0aC5zaW4odHVybiksIE1hdGguY29zKHR1cm4pXVxufVxuc2luY29zdGF1KDAuMjUpXG5zaW5jb3N0YXUoMC41KVxuc2luY29zKDAuMjUpXG5zaW5jb3MoMC41KVxuIn0seyJtZXRob2ROYW1lIjoiaW50ZXJwcmV0IiwiY2VsbE5hbWUiOiJvanMtY2VsbC0yMCIsImlubGluZSI6ZmFsc2UsInNvdXJjZSI6Ii8vIGh0dHBzOi8vb2JzZXJ2YWJsZWhxLmNvbS9AbWNtY2NsdXIvcGxvdC1mb3ItbWF0aGVtYXRpY2lhbnNcbntcbiAgbGV0IHcgPSA4MDA7XG4gIGxldCBoID0gMC42MjUgKiB3O1xuICBsZXQgc2FtcGxlcyA9IGJ1aWxkX3NhbXBsZXMoXG4gICAgZ2V0RW90LCAtMzY2LCAzNjUsIHsgTjogMTUwIH1cbiAgKTtcbiAgbGV0IHBsb3QgPSBQbG90LnBsb3Qoe1xuICAgIG1hcmdpbkxlZnQ6IDYwLFxuICAgIHdpZHRoOiB3LFxuICAgIGhlaWdodDogaCxcbiAgICBzdHlsZTogXCJmb250LXNpemU6MTk7XCIsXG4gICAgeToge2xhYmVsOiBcIm1pbGxpZGF5IGVvdCh0b3kpXCJ9LFxuICAgIHg6IHtsYWJlbDogXCJkYXkgb2YgeWVhclwifSxcbiAgICBtYXJrczogW1xuICAgICAgUGxvdC5saW5lKHNhbXBsZXMsIHtcbiAgICAgICAgc3Ryb2tlV2lkdGg6IDQsXG4gICAgICAgIHN0cm9rZTogXCJzdGVlbGJsdWVcIixcbiAgICAgICAgdGlwOiB0cnVlXG4gICAgICB9KSxcbiAgICAgIFBsb3QucnVsZVgoWy0zNjZdKSxcbiAgICAgIFBsb3QucnVsZVkoWzBdKSxcbiAgICAgIFBsb3QuYXhpc1goeyB5OiAwIH0pLFxuICAgICAgUGxvdC5heGlzWSh7IHg6IC0zNjYgfSlcbiAgICBdXG4gIH0pO1xuICByZXR1cm4gcGxvdDtcbn1cbiJ9LHsibWV0aG9kTmFtZSI6ImludGVycHJldCIsImNlbGxOYW1lIjoib2pzLWNlbGwtMjEiLCJpbmxpbmUiOmZhbHNlLCJzb3VyY2UiOiJ2aWV3b2YgbGF0SW5wdXQgPSBJbnB1dHMucmFuZ2UoWy0yNTAsIDI1MF0sIHtsYWJlbDogXCJMYXRpdHVkZVwiLCB2YWx1ZTogMCwgc3RlcDogMX0pXG4ifSx7Im1ldGhvZE5hbWUiOiJpbnRlcnByZXQiLCJjZWxsTmFtZSI6Im9qcy1jZWxsLTIyIiwiaW5saW5lIjpmYWxzZSwic291cmNlIjoidmlld29mIGRveUlucHV0ID0gSW5wdXRzLnJhbmdlKFswLCAzNjVdLCB7bGFiZWw6IFwiRGF5IG9mIHllYXJcIiwgdmFsdWU6IDE4Mywgc3RlcDogMX0pXG4ifSx7Im1ldGhvZE5hbWUiOiJpbnRlcnByZXQiLCJjZWxsTmFtZSI6Im9qcy1jZWxsLTIzIiwiaW5saW5lIjpmYWxzZSwic291cmNlIjoiZGF5dGltZUR1cmF0aW9uXG5sYXRJbnB1dCAvIDEwMDBcbiJ9LHsibWV0aG9kTmFtZSI6ImludGVycHJldCIsImNlbGxOYW1lIjoib2pzLWNlbGwtMjQiLCJpbmxpbmUiOmZhbHNlLCJzb3VyY2UiOiJ2aWV3b2YgbG9uSW5wdXQgPSBJbnB1dHMucmFuZ2UoWzAsIDEwMDBdLCB7bGFiZWw6IFwiTG9uZ2l0dWRlXCIsIHZhbHVlOiA1MDAsIHN0ZXA6IDF9KVxuIn0seyJtZXRob2ROYW1lIjoiaW50ZXJwcmV0IiwiY2VsbE5hbWUiOiJvanMtY2VsbC0yNSIsImlubGluZSI6ZmFsc2UsInNvdXJjZSI6ImZ1bmN0aW9uIHVuaXgyZG90ZSh1bml4LCB6b25lLCBvZmZzZXQgPSA3MTk0NjgpIHtcbiAgcmV0dXJuIFsodW5peCA/PyBEYXRlLm5vdygpKSAvIDg2NDAwMDAwICsgKFxuICAgIHpvbmUgPSB6b25lID8/IC1NYXRoLnJvdW5kKFxuICAgICAgKG5ldyBEYXRlKS5nZXRUaW1lem9uZU9mZnNldCgpIC8gMTQ0KVxuICAgICkgLyAxMCArIG9mZnNldCwgem9uZV1cbn1cbmZ1bmN0aW9uIHVuaXgyZG90ZTEodW5peCwgem9uZSwgb2Zmc2V0ID0gNzE5NDY4KSB7XG4gIHJldHVybiBbXG4gICAgKHVuaXggPz8gRGF0ZS5ub3coKSkgLyA4NjQwMDAwMFxuICAgICsgKHpvbmUgPSB6b25lID8/ICgxMCAtIE1hdGgucm91bmQoXG4gICAgICAgIChuZXcgRGF0ZSkuZ2V0VGltZXpvbmVPZmZzZXQoKSAvIDE0NCkpICUgMTBcbiAgICAgICkgLyAxMCArIG9mZnNldCwgem9uZV1cbn1cbmZ1bmN0aW9uIGRvdGUyZGF0ZShkb3RlLCB6b25lID0gMCkge1xuICBjb25zdCBjb3RlID0gTWF0aC5mbG9vcigoXG4gICAgICBkb3RlID49IDAgPyBkb3RlXG4gICAgICA6IGRvdGUgLSAxNDYwOTZcbiAgICApIC8gMTQ2MDk3KSxcbiAgZG90YyA9IGRvdGUgLSBjb3RlICogMTQ2MDk3LFxuICB5b3RjID0gTWF0aC5mbG9vcigoZG90Y1xuICAgIC0gTWF0aC5mbG9vcihkb3RjIC8gMTQ2MClcbiAgICArIE1hdGguZmxvb3IoZG90YyAvIDM2NTI0KVxuICAgIC0gTWF0aC5mbG9vcihkb3RjIC8gMTQ2MDk2KVxuICApIC8gMzY1KTtcbiAgcmV0dXJuIFtcbiAgICB5b3RjICsgY290ZSAqIDQwMCxcbiAgICBkb3RjIC0gKHlvdGMgKiAzNjVcbiAgICAgICsgTWF0aC5mbG9vcih5b3RjIC8gNClcbiAgICAgIC0gTWF0aC5mbG9vcih5b3RjIC8gMTAwKVxuICApLCB6b25lXX1cbmZ1bmN0aW9uIGdldEVvdChkYXkpIHtcbiAgY29uc3QgZ2FtbWEgPSAyICogTWF0aC5QSSAqIGRheSAvIDM2NVxuICAgIHJldHVybiAoXG4gICAgICAwLjAwMTExMTQzODY4NjkwMDIyMzUgK1xuICAgICAgLTQuMTU1MTI0NDAwNDA0OTE4ICAgICogTWF0aC5jb3MoZ2FtbWEpICtcbiAgICAgIC0yLjk3MTA4NzMyMjUzMDM3NTYgICAqIE1hdGguc2luKGdhbW1hKSArXG4gICAgICAtNC42MzU1NzA0MTQ1OTA4MDEgICAgKiBNYXRoLmNvcygyICogZ2FtbWEpICtcbiAgICAgIDUuMTE2MTc2OTQwMzY0MjY0ICAgICAqIE1hdGguc2luKDIgKiBnYW1tYSlcbiAgICApXG59XG5mdW5jdGlvbiBnZXRTZGEoZGF5KSB7XG4gIGNvbnN0IGdhbW1hID0gMiAqIE1hdGguUEkgKiBkYXkgLyAzNjVcbiAgICByZXR1cm4gKFxuICAgICAgMC4wMDEwOTE1NTMwNzk5NjA3NjEgICtcbiAgICAgIC0wLjAyMzExNzcwODU2MjE5NzIwNiAqIE1hdGguY29zKGdhbW1hKSArXG4gICAgICAwLjA2MDMyMDQyMzY5OTY4MTcwNiAgKiBNYXRoLnNpbihnYW1tYSkgK1xuICAgICAgMC4wMDA2MTUyNjMxMTI1NTI2MDgxICogTWF0aC5jb3MoMiAqIGdhbW1hKSArXG4gICAgICAwLjAwMDg5ODE3NDU3OTg3NzgxOTUgKiBNYXRoLnNpbigyICogZ2FtbWEpXG4gICAgKVxufVxuZnVuY3Rpb24gZ2V0U2hhKGxhdGl0dWRlLCBzb2xhckRlY2xpbmF0aW9uQW5nbGUsIHNvbGFyWmVuaXRoQW5nbGUgPSAwLjI1MjMxNCkge1xuICBjb25zdCByYXRpbyA9IChcbiAgICBjb3N0YXUoLjI1MjMxNCkgLSBzaW50YXUobGF0aXR1ZGUpICogc2ludGF1KHNvbGFyRGVjbGluYXRpb25BbmdsZSkpIC8gKFxuICAgIGNvc3RhdShsYXRpdHVkZSkgKiBjb3N0YXUoc29sYXJEZWNsaW5hdGlvbkFuZ2xlKSlcbiAgcmV0dXJuIHJhdGlvID49IDEgPyAwIDogcmF0aW8gPD0gLTEgPyBNYXRoLlBJIDogTWF0aC5hY29zKHJhdGlvKVxufVxuY29zcGkgPSByZXF1aXJlKCAnaHR0cHM6Ly9jZG4uanNkZWxpdnIubmV0L2doL3N0ZGxpYi1qcy9tYXRoLWJhc2Utc3BlY2lhbC1jb3NwaUB1bWQvYnJvd3Nlci5qcycgKVxuc2lucGkgPSByZXF1aXJlKCAnaHR0cHM6Ly9jZG4uanNkZWxpdnIubmV0L2doL3N0ZGxpYi1qcy9tYXRoLWJhc2Utc3BlY2lhbC1zaW5waUB1bWQvYnJvd3Nlci5qcycgKVxuZnVuY3Rpb24gc2ludGF1KHR1cm4pIHtcbiAgcmV0dXJuIHNpbnBpKDIgKiB0dXJuKTtcbn1cbmZ1bmN0aW9uIGNvc3RhdSh0dXJuKSB7XG4gIHJldHVybiBjb3NwaSgyICogdHVybik7XG59XG5zaGFSYWRpTWFwUGxvdCA9IGdldFNoYShsYXRUdXJuTWFwUGxvdCwgZ2V0U2RhKHNlbFlkYSkpXG5zaGFIYWxmTWFwUGxvdCA9IHNoYVJhZGlNYXBQbG90IC8gTWF0aC5QSVxuc2hhVHVybk1hcFBsb3QgPSBzaGFIYWxmTWFwUGxvdCAvIDJcbnNoYURlZ3JNYXBQbG90ID0gc2hhSGFsZk1hcFBsb3QgKiAxODBcbmVvdFR1cm5NYXBQbG90ID0gZ2V0RW90KHNlbFlkYSkgLyAxMDAwXG5sb25UdXJuTWFwUGxvdCA9IGxvbmcydHVybihsb2NhdGlvblswXSwgMClcbmxhdFR1cm5NYXBQbG90ID0gbGF0aTJ0dXJuKGxvY2F0aW9uWzFdLCAwKVxuYXN0RGVjTWFwUGxvdCA9ICgwLjk1ICsgemVyb1RpbWUgKyBsb25UdXJuTWFwUGxvdCArIGVvdFR1cm5NYXBQbG90KSAlIDEgKiAxMFxuYXN0RGVnTWFwUGxvdCA9IGFzdERlY01hcFBsb3QgKiAzNlxuc2hhRG95SW5wdXQgPSBnZXRTaGEobGF0SW5wdXQgLyAxMDAwLCBnZXRTZGEoZG95SW5wdXQpKVxuZGF5dGltZUR1cmF0aW9uID0gc2hhRG95SW5wdXQgLyBNYXRoLlBJXG5ub29uRGlmZiA9IGRheXRpbWVEdXJhdGlvbiAvIDJcbmR6ID0gdW5peDJkb3RlKG5vdylcbmRlY1llYXIgPSB5ZHpbMF0udG9TdHJpbmcoKS5wYWRTdGFydCg0LCBcIjBcIilcbnplcm9Eb3RlID0gdW5peDJkb3RlKG5vdywgMClbMF1cbnplcm9UaW1lID0gemVyb0RvdGUgJSAxXG56ZXJvRGF0ZSA9IGRvdGUyZGF0ZSh6ZXJvRG90ZSlcbnplcm9ZZWFyID0gemVyb0RhdGVbMF1cbnplcm9ZZGEgPSB6ZXJvRGF0ZVsxXVxuemVyb0RveSA9IE1hdGguZmxvb3IoemVyb1lkYSlcbnplcm9Jc0xlYXAgPSBpc0xlYXBZZWFyKHplcm9ZZWFyKVxuemVyb1lkYUhzbCA9IHRleHRjb2xvcih6ZXJvWWRhLnRvRml4ZWQoNSksIGQzLmNvbG9yKHBpZWNld2lzZUNvbG9yKHplcm9ZZGEgLyAoMzY1ICsgemVyb0lzTGVhcCkpKS5mb3JtYXRIZXgoKSlcbnplcm9UaW1lSHNsMCA9IHRleHRjb2xvcih6ZXJvVGltZS50b0ZpeGVkKDUpLnNsaWNlKDEpLCBkMy5jb2xvcihwaWVjZXdpc2VDb2xvcih6ZXJvVGltZSkpLmZvcm1hdEhleCgpKVxuemVyb1RpbWVIc2wxID0gdGV4dGNvbG9yKHplcm9UaW1lLnRvRml4ZWQoNSkuc2xpY2UoMSksIGQzLmNvbG9yKHBpZWNld2lzZUNvbG9yKHplcm9UaW1lKSkuZm9ybWF0SGV4KCkpXG56ZXJvVGltZUhzbDIgPSB0ZXh0Y29sb3IoKHplcm9UaW1lICogMTApLnRvRml4ZWQoNCksIGQzLmNvbG9yKHBpZWNld2lzZUNvbG9yKHplcm9UaW1lKSkuZm9ybWF0SGV4KCkpXG56ZXJvVGltZUhzbDMgPSB0ZXh0Y29sb3IoKHplcm9UaW1lICogMTApLnRvRml4ZWQoNCksIGQzLmNvbG9yKHBpZWNld2lzZUNvbG9yKHplcm9UaW1lKSkuZm9ybWF0SGV4KCkpXG56ZXJvVGltZUhzbDQgPSB0ZXh0Y29sb3IoKHplcm9UaW1lICogMTApLnRvRml4ZWQoNCksIGQzLmNvbG9yKHBpZWNld2lzZUNvbG9yKHplcm9UaW1lKSkuZm9ybWF0SGV4KCkpXG56ZXJvVGltZUhzbDUgPSB0ZXh0Y29sb3IoKHplcm9UaW1lICogMTApLnRvRml4ZWQoNSksIGQzLmNvbG9yKHBpZWNld2lzZUNvbG9yKHplcm9UaW1lKSkuZm9ybWF0SGV4KCkpXG56ZXJvRG90eUhzbCA9IHRleHRjb2xvcih6ZXJvRG95LnRvU3RyaW5nKCkucGFkU3RhcnQoMywgXCIwXCIpLCBkMy5jb2xvcihwaWVjZXdpc2VDb2xvcih6ZXJvRG95IC8gKDM2NSArIHplcm9Jc0xlYXApKSkuZm9ybWF0SGV4KCkpXG56ZXJvRG90ZUhzbCA9IHRleHRjb2xvcih6ZXJvRG90ZS50b0ZpeGVkKDUpLCBkMy5jb2xvcihwaWVjZXdpc2VDb2xvcih6ZXJvRG90ZSAlIDEpKS5mb3JtYXRIZXgoKSlcbnplcm9ZZWFySHNsID0gdGV4dGNvbG9yKHplcm9ZZWFyLCBkMy5jb2xvcihwaWVjZXdpc2VDb2xvcih6ZXJvWWVhciAlIDEwMDAgLyAxMDAwKSkuZm9ybWF0SGV4KCkpXG5icm93c2VyRG90ZSA9IHVuaXgyZG90ZShub3cpXG5icm93c2VyVGltZSA9IGJyb3dzZXJEb3RlWzBdICUgMSAqIDEwXG5icm93c2VyWm9uZSA9IGJyb3dzZXJEb3RlWzFdXG5icm93c2VyU2lnbiA9IGJyb3dzZXJab25lID4gMCA/IFwiLVwiIDogXCIrXCJcbnpvbmUwdGltZSA9IChicm93c2VyVGltZSAtIGJyb3dzZXJab25lICsgMTApICUgMTBcbmhvdXJzID0gYnJvd3NlclRpbWUgKiAyLjRcbm1pbnV0ZXMgPSBob3VycyAlIDEgKiA2MFxuc2Vjb25kcyA9IG1pbnV0ZXMgJSAxICogNjBcbnNlbGVjdGVkRG90ZSA9IHVuaXgyZG90ZShub3csIGxvbmcyem9uZShsb2NhdGlvblswXSkpXG5zZWxlY3RlZEV4YWN0ID0gc2VsZWN0ZWREb3RlWzBdICUgMVxuc2VsZWN0ZWRFeGFjdE4gPSAoMSAtIHNlbGVjdGVkRXhhY3QpICUgMVxuc2VsZWN0ZWRab25lID0gc2VsZWN0ZWREb3RlWzFdXG55ZHogPSBkb3RlMmRhdGUoLi4uc2VsZWN0ZWREb3RlKVxuZGVjRGF0ZSA9IE1hdGguZmxvb3IoeWR6WzFdKVxuZGVjVGltZSA9IChzZWxlY3RlZEV4YWN0ICogMTApLnRvRml4ZWQoNClcbmRlY1RpbWVOID0gKHNlbGVjdGVkRXhhY3ROICogMTApLnRvRml4ZWQoNClcbmJhckREID0gZGVjVGltZVswXVxuYmFyREROID0gZGVjVGltZU5bMF1cbmJhck1pbHMgPSBkZWNUaW1lLnNsaWNlKDIsIDQpXG5iYXJNaWxzTiA9IGRlY1RpbWVOLnNsaWNlKDIsIDQpXG5iYXJCZWF0cyA9IGRlY1RpbWUuc2xpY2UoNCwgNilcbmJhckJlYXRzTiA9IGRlY1RpbWVOLnNsaWNlKDQsIDYpXG5mdW5jdGlvbiBsYXRpMnR1cm4oZGVncmVlcyA9IC0xODAsIGUgPSAzKSB7XG4gIC8vIHR1cm5zOiBlPTAsIGRlY2l0dXJuczogZT0xLCBldGMuXG4gIHJldHVybiAoZGVncmVlcyAlPSAzNjApIC8gKDM2MCAvIDEwKiplKSAlIDEwKiplO1xufVxuZ3JhdGljdWxlID0gZDMuZ2VvR3JhdGljdWxlKCkuc3RlcE1pbm9yKFszNiwzNl0pLnN0ZXBNYWpvcihbMzYsMzZdKSgpXG5ncmF0aWN1bGUuY29vcmRpbmF0ZXMgPSBncmF0aWN1bGUuY29vcmRpbmF0ZXMubWFwKFxuICBpID0+IGkubWFwKGogPT4gai5tYXAoKGssIGluZGV4LCBhcnIpID0+IGkubGVuZ3RoID09PSAzICYmIGluZGV4ID09PSAwID8gayAtIDE4IDogaykpXG4pXG5mdW5jdGlvbiB0dXJuMmRlZ3IodHVybnMgPSAtNTAwLCBlID0gMykge1xuICAvLyB0dXJuczogZT0wLCBkZWNpdHVybnM6IGU9MSwgZXRjLlxuICByZXR1cm4gdHVybnMgJSAxMCoqZSAqICgzNjAgLyAxMCoqZSlcbn1cbmZ1bmN0aW9uIHR1cm4ybG9uZyh0dXJucyA9IC01MDAsIGUgPSAzKSB7XG4gIC8vIHR1cm5zOiBlPTAsIGRlY2l0dXJuczogZT0xLCBldGMuXG4gIHJldHVybiB0dXJucyAlIDEwKiplICogKDM2MCAvIDEwKiplKSAtIDE4XG59XG5mdW5jdGlvbiBsb25nMnR1cm4oZGVncmVlcyA9IC0xODAsIGUgPSAzKSB7XG4gIC8vIHR1cm5zOiBlPTAsIGRlY2l0dXJuczogZT0xLCBldGMuXG4gIHJldHVybiAoKChkZWdyZWVzICU9IDM2MCkgPCAwID8gZGVncmVlcyArIDM2MCA6IGRlZ3JlZXMpICsgMTgpIC8gKDM2MCAvIDEwKiplKSAlIDEwKiplO1xufVxuLy8gaHR0cHM6Ly9naXRodWIuY29tL3RvcG9qc29uL3dvcmxkLWF0bGFzXG53b3JsZCA9IGQzLmpzb24oXCJodHRwczovL2Nkbi5qc2RlbGl2ci5uZXQvbnBtL3dvcmxkLWF0bGFzQDIvY291bnRyaWVzLTExMG0uanNvblwiKVxuLy8gY291bnRyaWVzID0gdG9wb2pzb24uZmVhdHVyZSh3b3JsZCwgd29ybGQub2JqZWN0cy5jb3VudHJpZXMpXG50b3BvanNvbiA9IHJlcXVpcmUoXCJ0b3BvanNvbi1jbGllbnRAM1wiKVxuZnVuY3Rpb24gbG9uZzJ6b25lKGRlZ3JlZXMgPSAtMTgwKSB7XG4gIHJldHVybiBNYXRoLmZsb29yKGxvbmcydHVybihkZWdyZWVzLCAxKSk7XG59XG5mdW5jdGlvbiB5ZWFyMmxlYXAoeWVhciA9IDE5NzApIHtcbiAgICByZXR1cm4geWVhciAlIDQgPT0gMCAmJiB5ZWFyICUgMTAwICE9IDAgfHwgeWVhciAlIDQwMCA9PSAwO1xufVxuLy8gaHR0cHM6Ly9vYnNlcnZhYmxlaHEuY29tL0BkYnJpZGdlcy92aXN1YWxpemluZy1zZWFzb25hbC1kYXlsaWdodFxuc29sYXJTeXN0ZW0gPSAocm9vdCwgdml6d2lkdGgsIGxvY2F0aW9uLCBkYXRlLCBob3VyLCBkYXJrbW9kZSkgPT4ge1xuICBjb25zdCBlYXJ0aFJhZGl1cyA9IDAuMDY1ICogdml6d2lkdGg7XG4gIC8vIGNvbnN0IHN1blJhZGl1cyA9IDAuMDE1ICogdml6d2lkdGg7XG4gIGNvbnN0IHNvbGFyU3lzdGVtUmFkaXVzID0gdml6d2lkdGggLyAyIC0gKHZpendpZHRoIDwgNTAwID8gNCA6IDIwKTtcbiAgY29uc3Qgc3RyZXRjaCA9IDAuMDY7XG4gIGNvbnN0IHNvbGFyQW5nbGUgPSBnZXRTb2xhckFuZ2xlKGRhdGUpO1xuICBjb25zdCBzb2xhckFuZ2xlRGVnID0gKHNvbGFyQW5nbGUgKiAxODApIC8gTWF0aC5QSTtcbiAgY29uc3QgeCA9IHNvbGFyU3lzdGVtUmFkaXVzICogTWF0aC5zaW4oc29sYXJBbmdsZSk7XG4gIGNvbnN0IHkgPSBzdHJldGNoICogc29sYXJTeXN0ZW1SYWRpdXMgKiBNYXRoLmNvcyhzb2xhckFuZ2xlKTtcbiAgY29uc3Qgc3BpbiA9IDE4MCArIC1sb2NhdGlvblswXSArIHNvbGFyQW5nbGVEZWcgKyAzNjAgKiAoKGhvdXIgKyAxMikgLyAyNCk7XG4gIGNvbnN0IGVhcnRoR2VvID0geyB0eXBlOiBcIlNwaGVyZVwiIH07XG4gIGNvbnN0IHByb2plY3Rpb24gPSBkM1xuICAgIC5nZW9PcnRob2dyYXBoaWMoKVxuICAgIC5maXRXaWR0aChlYXJ0aFJhZGl1cyAqIDIsIGVhcnRoR2VvKVxuICAgIC5yb3RhdGUoW3NwaW4sIDAsIDIzLjVdKVxuICAgIC50cmFuc2xhdGUoWzAsIDBdKTtcbiAgY29uc3Qgc3RhdGljUHJvamVjdGlvbiA9IGQzXG4gICAgLmdlb09ydGhvZ3JhcGhpYygpXG4gICAgLmZpdFdpZHRoKGVhcnRoUmFkaXVzICogMiwgZWFydGhHZW8pXG4gICAgLnJvdGF0ZShbc29sYXJBbmdsZURlZyAtIDkwLCAwXSlcbiAgICAudHJhbnNsYXRlKFswLCAwXSk7XG4gIGNvbnN0IHBhdGggPSBkMy5nZW9QYXRoKHByb2plY3Rpb24pLnBvaW50UmFkaXVzKDEuNSk7XG4gIGNvbnN0IHN0YXRpY1BhdGggPSBkMy5nZW9QYXRoKHN0YXRpY1Byb2plY3Rpb24pO1xuICBjb25zdCBvY2VhbkNvbG9yID0gZGFya21vZGUgPyBcIiMwMDdGRkZcIiA6IG1hcGNvbG9ycy5vY2VhbjtcbiAgY29uc3QgbGFuZENvbG9yID0gZGFya21vZGUgPyBcIiMwODA4XCIgOiBtYXBjb2xvcnMubGFuZDtcbiAgY29uc3QgYm9yZGVyQ29sb3IgPSBkYXJrbW9kZSA/IFwiI2VlZVwiIDogXCIjMzMzXCI7XG4gIGNvbnN0IHNvbGFyU3lzdGVtID0gcm9vdFxuICAgIC5hcHBlbmQoXCJnXCIpXG4gICAgLmF0dHIoXCJ0cmFuc2Zvcm1cIiwgYHRyYW5zbGF0ZSgke3ZpendpZHRoIC8gMn0pYCk7XG4gIC8vIHNvbGFyU3lzdGVtLmFwcGVuZChcImNpcmNsZVwiKS5hdHRyKFwiclwiLCBzdW5SYWRpdXMpLmF0dHIoXCJmaWxsXCIsIGNvbG9ycy5zdW4pO1xuICAvKiBEcmF3IG9yYml0ICovXG4gICAgc29sYXJTeXN0ZW1cbiAgICAgIC5hcHBlbmQoXCJlbGxpcHNlXCIpXG4gICAgICAuYXR0cihcInJ4XCIsIHNvbGFyU3lzdGVtUmFkaXVzKVxuICAgICAgLmF0dHIoXCJyeVwiLCBzdHJldGNoICogc29sYXJTeXN0ZW1SYWRpdXMpXG4gICAgICAuYXR0cihcImZpbGxcIiwgXCJub25lXCIpXG4gICAgICAuYXR0cihcInN0cm9rZS13aWR0aFwiLCBcIjEuMjVcIilcbiAgICAgIC5hdHRyKFwic3Ryb2tlXCIsIFwiYmxhY2tcIik7XG4gICAgLyogRHJhdyBtb250aCB0aWNrcyAqL1xuICAgIGQzLnJhbmdlKDEyKS5tYXAoKG0pID0+IHtcbiAgICAgIGNvbnN0IGQgPSBuZXcgRGF0ZShkYXRlLmdldEZ1bGxZZWFyKCksIG0sIDEpO1xuICAgICAgY29uc3QgYW5nbGUgPSBnZXRTb2xhckFuZ2xlKGQpO1xuICAgICAgc29sYXJTeXN0ZW1cbiAgICAgICAgLmFwcGVuZChcImxpbmVcIilcbiAgICAgICAgLmF0dHIoXCJ4MVwiLCAoc29sYXJTeXN0ZW1SYWRpdXMgKyA5KSAqIE1hdGguc2luKGFuZ2xlKSlcbiAgICAgICAgLmF0dHIoXCJ5MVwiLCAoc29sYXJTeXN0ZW1SYWRpdXMgKyA5KSAqIHN0cmV0Y2ggKiBNYXRoLmNvcyhhbmdsZSkpXG4gICAgICAgIC5hdHRyKFwieDJcIiwgKHNvbGFyU3lzdGVtUmFkaXVzIC0gOSkgKiBNYXRoLnNpbihhbmdsZSkpXG4gICAgICAgIC5hdHRyKFwieTJcIiwgKHNvbGFyU3lzdGVtUmFkaXVzIC0gOSkgKiBzdHJldGNoICogTWF0aC5jb3MoYW5nbGUpKVxuICAgICAgICAuYXR0cihcInN0cm9rZS13aWR0aFwiLCBcIjMuNzVcIilcbiAgICAgICAgLmF0dHIoXCJzdHJva2VcIiwgXCJibGFja1wiKTtcbiAgICAgIGNvbnN0IHN0YXJ0TW9udGhBbmdsZSA9IGdldFNvbGFyQW5nbGUobmV3IERhdGUoZGF0ZS5nZXRGdWxsWWVhcigpLCBtLCAxKSk7XG4gICAgICBzb2xhclN5c3RlbVxuICAgICAgICAuYXBwZW5kKFwidGV4dFwiKVxuICAgICAgICAudGV4dChkYXRlMmRvdHkoZCkpXG4gICAgICAgIC5hdHRyKFwieFwiLCAoc29sYXJTeXN0ZW1SYWRpdXMgKyAxOCAtIHdpZHRoIC8gNTApICogTWF0aC5zaW4oc3RhcnRNb250aEFuZ2xlKSAqIDEuMSlcbiAgICAgICAgLmF0dHIoXG4gICAgICAgICAgXCJ5XCIsXG4gICAgICAgICAgKHNvbGFyU3lzdGVtUmFkaXVzICsgMiAtIHdpZHRoIC8gMi44KSAqIDYuMiAqIHN0cmV0Y2ggKiBNYXRoLmNvcyhzdGFydE1vbnRoQW5nbGUpICsgTWF0aC5zaWduKE1hdGguY29zKHN0YXJ0TW9udGhBbmdsZSkpICogMTJcbiAgICAgICAgKVxuICAgICAgICAuYXR0cihcInRleHQtYW5jaG9yXCIsIFwibWlkZGxlXCIpXG4gICAgICAgIC5hdHRyKFwiZG9taW5hbnQtYmFzZWxpbmVcIiwgXCJtaWRkbGVcIilcbiAgICAgICAgLmF0dHIoXCJmb250LXNpemVcIiwgZm9udFNpemUgKiAod2lkdGggPCAzMDAgPyAuOSA6IHdpZHRoIDwgNDAwID8gLjk1IDogd2lkdGggPCA1MDAgPyAxIDogd2lkdGggPCA2MDAgPyAxLjA1IDogd2lkdGggPCA3MDAgPyAxLjEgOiAxLjIpICsgd2lkdGggLyAxMDApXG4gICAgICAgIC5hdHRyKFwiZm9udC1mYW1pbHlcIiwgXCJzYW5zLXNlcmlmXCIpXG4gICAgICAgIC5hdHRyKFwiZmlsbFwiLCBcImJsYWNrXCIpO1xuICAgIH0pO1xuICAgIGNvbnN0IGVhcnRoID0gc29sYXJTeXN0ZW1cbiAgICAgIC5hcHBlbmQoXCJnXCIpXG4gICAgICAuYXR0cihcInRyYW5zZm9ybVwiLCBgdHJhbnNsYXRlKCR7eH0sICR7eX0pYCk7XG4gICAgZnVuY3Rpb24gZHJhd0VhcnRoKCkge1xuICAgICAgZWFydGguYXBwZW5kKFwibGluZVwiKS5hdHRyKFwieTFcIiwgLTEuNSAqIGVhcnRoUmFkaXVzKS5hdHRyKFwieTJcIiwgMS41ICogZWFydGhSYWRpdXMpLmF0dHIoXCJzdHJva2VcIiwgXCJibHVlXCIpLmF0dHIoXCJ0cmFuc2Zvcm1cIiwgYHJvdGF0ZSgtMjMuNSlgKTtcbiAgICAgIGVhcnRoLmFwcGVuZChcInBhdGhcIikuYXR0cihcImRcIiwgcGF0aChlYXJ0aEdlbykpLmF0dHIoXCJmaWxsXCIsIGRhcmttb2RlID8gXCIjMDA3RkZGXCIgOiBtYXBjb2xvcnMub2NlYW4pLmF0dHIoXCJpZFwiLCBcImdsb2JlT2NlYW5cIik7XG4gICAgICBlYXJ0aC5hcHBlbmQoXCJwYXRoXCIpLmF0dHIoXCJkXCIsIHBhdGgobGFuZCkpLmF0dHIoXCJmaWxsXCIsIGRhcmttb2RlID8gXCIjMDgwOFwiIDogbWFwY29sb3JzLmxhbmQpLmF0dHIoXCJpZFwiLCBcImdsb2JlTGFuZFwiKTtcbiAgICAgIGVhcnRoLmFwcGVuZChcInBhdGhcIikuYXR0cihcImRcIiwgcGF0aChjb3VudHJpZXMpKS5hdHRyKFwic3Ryb2tlLXdpZHRoXCIsIFwiLjA4XCIpLmF0dHIoXCJmaWxsXCIsIFwibm9uZVwiKS5hdHRyKFwic3Ryb2tlXCIsIGRhcmttb2RlID8gXCIjZWVlXCIgOiBcIiMzMzNcIikuYXR0cihcImlkXCIsIFwiZ2xvYmVCb3JkZXJzXCIpO1xuICAgICAgcGF0aC5wb2ludFJhZGl1cyg1LjUpO1xuICAgICAgZWFydGguYXBwZW5kKFwicGF0aFwiKS5hdHRyKFwiZFwiLCBwYXRoKHsgdHlwZTogXCJQb2ludFwiLCBjb29yZGluYXRlczogbG9jYXRpb24gfSkpLmF0dHIoXCJmaWxsXCIsIFwibm9uZVwiKS5hdHRyKFwic3Ryb2tlLXdpZHRoXCIsIC42KS5hdHRyKFwic3Ryb2tlXCIsIFwiYmxhY2tcIik7XG4gICAgICBwYXRoLnBvaW50UmFkaXVzKDQuNSk7XG4gICAgICBlYXJ0aC5hcHBlbmQoXCJwYXRoXCIpLmF0dHIoXCJkXCIsIHBhdGgoeyB0eXBlOiBcIlBvaW50XCIsIGNvb3JkaW5hdGVzOiBsb2NhdGlvbiB9KSkuYXR0cihcImZpbGxcIiwgXCJub25lXCIpLmF0dHIoXCJzdHJva2Utd2lkdGhcIiwgMi4yNSkuYXR0cihcInN0cm9rZVwiLCBcInJlZFwiKTtcbiAgfVxuICBkcmF3RWFydGgoKTtcbn1cbmZ1bmN0aW9uIGdyZWcyZG90eShtb250aCA9IDEsIGRheSA9IDEpIHtcbiAgICByZXR1cm4gTWF0aC5mbG9vcihcbiAgICAgICAgKDE1MyAqIChtb250aCA+IDIgPyBtb250aCAtIDMgOiBtb250aCArIDkpICsgMikgLyA1ICsgZGF5IC0gMVxuKX1cbmZ1bmN0aW9uIGRhdGUyZG90eShkYXRlKSB7XG4gIHJldHVybiBncmVnMmRvdHkoZGF0ZS5nZXRNb250aCgpICsgMSwgZGF0ZS5nZXREYXRlKCkpXG59XG5mdW5jdGlvbiBkYXRlMmRvdHkxKGRhdGUpIHtcbiAgcmV0dXJuIGdyZWcyZG90eShkYXRlLmdldE1vbnRoKCkgKyAxLCBkYXRlLmdldERhdGUoKSlcbn1cbi8vIGh0dHBzOi8vb2JzZXJ2YWJsZWhxLmNvbS9AZGJyaWRnZXMvdmlzdWFsaXppbmctc2Vhc29uYWwtZGF5bGlnaHRcbi8vIGdsb2JlID0gKHJvb3QsIHsgdml6d2lkdGgsIGxvY2F0aW9uLCBkYXRlLCBob3VyIH0pID0+IHtcbi8vICAgY29uc3Qgc29sYXJBbmdsZSA9IGdldFNvbGFyQW5nbGUoZGF0ZSk7XG4vLyAgIGNvbnN0IHNvbGFyQW5nbGVEZWcgPSB0b0RlZ3JlZXMoc29sYXJBbmdsZSk7XG4vLyAgIGNvbnN0IGhvdXJTcGluID0gMzYwICogKChob3VyICsgMTIpIC8gMjQpO1xuLy8gICBjb25zdCBzcGluID0gKDE4MCArIC1sb2NhdGlvblswXSArIHNvbGFyQW5nbGVEZWcgKyBob3VyU3Bpbik7XG4vLyAgIGNvbnN0IHRpbHQgPSAtMTU7XG4vLyAgIGNvbnN0IHByb2plY3Rpb24gPSBkMy5nZW9PcnRob2dyYXBoaWMoKVxuLy8gICAgICAgICAgICAgICAgICAgICAgICAuZml0V2lkdGgodml6d2lkdGgsIGdyYXRpY3VsZSlcbi8vICAgICAgICAgICAgICAgICAgICAgICAgLnJvdGF0ZShbc3BpbiwgdGlsdCwgMjMuNV0pO1xuLy8gICBjb25zdCBwYXRoID0gZDMuZ2VvUGF0aChwcm9qZWN0aW9uKTtcbi8vICAgY29uc3QgdW5DbGlwcGVkUHJvamVjdGlvbiA9IGQzLmdlb09ydGhvZ3JhcGhpYygpXG4vLyAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIC5jbGlwQW5nbGUobnVsbClcbi8vICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgLmZpdFdpZHRoKHZpendpZHRoLCBncmF0aWN1bGUpXG4vLyAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIC5yb3RhdGUoW3NwaW4sIHRpbHQsIDIzLjVdKTtcbi8vICAgY29uc3QgdW5DbGlwcGVkUGF0aCA9IGQzLmdlb1BhdGgodW5DbGlwcGVkUHJvamVjdGlvbik7XG4vLyAgIGNvbnN0IHN0YXRpY1Byb2plY3Rpb24gPSBkMy5nZW9PcnRob2dyYXBoaWMoKVxuLy8gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAuZml0V2lkdGgodml6d2lkdGgsIGdyYXRpY3VsZSlcbi8vICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgLnJvdGF0ZShbc29sYXJBbmdsZURlZyAtIDkwLCB0aWx0XSk7XG4vLyAgIGNvbnN0IHN0YXRpY1BhdGggPSBkMy5nZW9QYXRoKHN0YXRpY1Byb2plY3Rpb24pO1xuLy8gICBjb25zdCBiYWNrZ3JvdW5kID0gcm9vdC5hcHBlbmQoXCJnXCIpO1xuLy8gICBjb25zdCBlYXJ0aCA9IHJvb3QuYXBwZW5kKFwiZ1wiKS5zdHlsZShcIm9wYWNpdHlcIiwgMC43NSk7XG4vLyAgIGNvbnN0IGZvcmVncm91bmQgPSByb290LmFwcGVuZChcImdcIik7XG4vLyAgIGVhcnRoLmFwcGVuZChcInBhdGhcIilcbi8vICAgICAuYXR0cihcImRcIiwgcGF0aCh7dHlwZTogXCJTcGhlcmVcIn0pKVxuLy8gICAgIC5hdHRyKFwiZmlsbFwiLCBtYXBjb2xvcnMub2NlYW4pXG4vLyAgICAgLmF0dHIoXCJzdHJva2VcIiwgXCIjOWVjYmRhXCIpO1xuLy8gICBlYXJ0aC5hcHBlbmQoXCJwYXRoXCIpXG4vLyAgICAgLmF0dHIoXCJkXCIsIHBhdGgobGFuZCkpXG4vLyAgICAgLmF0dHIoXCJmaWxsXCIsIG1hcGNvbG9ycy5sYW5kKTtcbi8vICAgZWFydGguYXBwZW5kKFwicGF0aFwiKVxuLy8gICAgIC5hdHRyKFwiZFwiLCBwYXRoKGNvdW50cmllcykpXG4vLyAgICAgLmF0dHIoXCJzdHJva2Utd2lkdGhcIiwgXCIxXCIpXG4vLyAgICAgLmF0dHIoXCJmaWxsXCIsIFwibm9uZVwiKVxuLy8gICAgIC5hdHRyKFwic3Ryb2tlXCIsIFwiIzAwMFwiKTtcbi8vICAgYmFja2dyb3VuZC5hcHBlbmQoXCJwYXRoXCIpXG4vLyAgICAgLmF0dHIoXCJkXCIsIHVuQ2xpcHBlZFBhdGgoe3R5cGU6IFwiUG9pbnRcIiwgY29vcmRpbmF0ZXM6IGxvY2F0aW9ufSkpXG4vLyAgICAgLmF0dHIoXCJmaWxsXCIsIFwicmVkXCIpO1xuLy8gICBjb25zdCBsYXRpdHVkZUNvb3JkcyA9IChsYXRpdHVkZSwgc3RhcnQsIGVuZCkgPT4ge1xuLy8gICAgIGNvbnN0IGxvbmdpdHVkZXMgPSBkMy5yYW5nZShzdGFydCwgZW5kLCAyKS5jb25jYXQoZW5kKTtcbi8vICAgICByZXR1cm4gbG9uZ2l0dWRlcy5tYXAoZCA9PiBbZCwgbGF0aXR1ZGVdKTtcbi8vICAgfVxuLy8gICBjb25zdCBjb3JyZWN0U3BpbiA9IGQzLmdlb1JvdGF0aW9uKFstaG91clNwaW4sIDBdKTtcbi8vICAgY29uc3QgY29ycmVjdFRpbHQgPSBkMy5nZW9Sb3RhdGlvbihbNiwgMCwgMF0pO1xuLy8gICAvKiB0b3RhbCBhbmd1bGFyIGV4dGVudCBvZiBkYXkvbmlnaHQgKi9cbi8vICAgY29uc3QgZGF5RXh0ZW50ID0gMzYwICogZGF5TGVuZ3RoKGRhdGUsIGxvY2F0aW9uWzFdKSAvIDI0O1xuLy8gICBjb25zdCBuaWdodEV4dGVudCA9IDM2MCAtIGRheUV4dGVudDtcbi8vICAgY29uc3QgZGF5TGluZSA9IHtcbi8vICAgICB0eXBlOiBcIkxpbmVTdHJpbmdcIixcbi8vICAgICBjb29yZGluYXRlczogbGF0aXR1ZGVDb29yZHMobG9jYXRpb25bMV0sXG4vLyAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGxvY2F0aW9uWzBdIC0gZGF5RXh0ZW50IC8gMixcbi8vICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgbG9jYXRpb25bMF0gKyBkYXlFeHRlbnQgLyAyKS5tYXAoZCA9PiBjb3JyZWN0U3BpbihkKSlcbi8vICAgfTtcbi8vICAgY29uc3QgbmlnaHRMaW5lID0ge1xuLy8gICAgIHR5cGU6IFwiTGluZVN0cmluZ1wiLFxuLy8gICAgIGNvb3JkaW5hdGVzOiBsYXRpdHVkZUNvb3Jkcyhsb2NhdGlvblsxXSxcbi8vICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgbG9jYXRpb25bMF0gLSBkYXlFeHRlbnQgLyAyIC0gbmlnaHRFeHRlbnQsXG4vLyAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGxvY2F0aW9uWzBdIC0gZGF5RXh0ZW50IC8gMikubWFwKGQgPT4gY29ycmVjdFNwaW4oZCkpXG4vLyAgIH07XG4vLyAgIGJhY2tncm91bmQuYXBwZW5kKFwicGF0aFwiKVxuLy8gICAgIC5hdHRyKFwiZFwiLCB1bkNsaXBwZWRQYXRoKGRheUxpbmUpKVxuLy8gICAgIC5hdHRyKFwiZmlsbFwiLCBcIm5vbmVcIilcbi8vICAgICAuYXR0cihcInN0cm9rZVwiLCBtYXBjb2xvcnMuZGF5KVxuLy8gICAgIC5hdHRyKFwic3Ryb2tlLXdpZHRoXCIsIDMpO1xuLy8gICBiYWNrZ3JvdW5kLmFwcGVuZChcInBhdGhcIilcbi8vICAgICAuYXR0cihcImRcIiwgdW5DbGlwcGVkUGF0aChuaWdodExpbmUpKVxuLy8gICAgIC5hdHRyKFwiZmlsbFwiLCBcIm5vbmVcIilcbi8vICAgICAuYXR0cihcInN0cm9rZVwiLCBtYXBjb2xvcnMubmlnaHQpXG4vLyAgICAgLmF0dHIoXCJzdHJva2Utd2lkdGhcIiwgMyk7XG4vLyAgIGZvcmVncm91bmQuYXBwZW5kKFwicGF0aFwiKVxuLy8gICAgIC5hdHRyKFwiZFwiLCBwYXRoKGRheUxpbmUpKVxuLy8gICAgIC5hdHRyKFwiZmlsbFwiLCBcIm5vbmVcIilcbi8vICAgICAuYXR0cihcInN0cm9rZVwiLCBtYXBjb2xvcnMuZGF5KVxuLy8gICAgIC5hdHRyKFwic3Ryb2tlLXdpZHRoXCIsIDMpO1xuLy8gICBmb3JlZ3JvdW5kLmFwcGVuZChcInBhdGhcIilcbi8vICAgICAuYXR0cihcImRcIiwgcGF0aChuaWdodExpbmUpKVxuLy8gICAgIC5hdHRyKFwiZmlsbFwiLCBcIm5vbmVcIilcbi8vICAgICAuYXR0cihcInN0cm9rZVwiLCBtYXBjb2xvcnMubmlnaHQpXG4vLyAgICAgLmF0dHIoXCJzdHJva2Utd2lkdGhcIiwgMyk7XG4vLyAgIGZvcmVncm91bmQuYXBwZW5kKFwicGF0aFwiKVxuLy8gICAgIC5hdHRyKFwiZFwiLCBwYXRoKHt0eXBlOiBcIlBvaW50XCIsIGNvb3JkaW5hdGVzOiBsb2NhdGlvbn0pKVxuLy8gICAgIC5hdHRyKFwic3Ryb2tlLXdpZHRoXCIsIC41KVxuLy8gICAgIC5hdHRyKFwic3Ryb2tlXCIsIFwiYmxhY2tcIilcbi8vICAgICAuYXR0cihcImZpbGxcIiwgXCJyZWRcIik7XG4vLyAgIGNvbnN0IHNoYWRvd1BvbHlnb24gPSBbWzAsIC05MF0sIFswLCAwXSwgWzAsIDkwXSwgWzE4MCwgMF0sIFswLCAtOTBdXS5tYXAoZCA9PiBjb3JyZWN0VGlsdChkKSk7XG4vLyAgIGZvcmVncm91bmQuYXBwZW5kKFwicGF0aFwiKVxuLy8gICAgIC5hdHRyKFwiZFwiLCBzdGF0aWNQYXRoKHt0eXBlOiBcIlBvbHlnb25cIiwgY29vcmRpbmF0ZXM6IFtzaGFkb3dQb2x5Z29uXX0pKVxuLy8gICAgIC5hdHRyKFwiZmlsbFwiLCBcInJnYmEoMCwgMCwgMCwgMC4yNSlcIik7XG4vLyB9XG5kYXlPZlllYXIgPSAoZGF0ZSkgPT4ge1xuICBjb25zdCB5ZWFyU3RhcnQgPSBuZXcgRGF0ZShkYXRlLmdldEZ1bGxZZWFyKCksIDAsIDErNjApO1xuICByZXR1cm4gTWF0aC5mbG9vcigoZGF0ZS5nZXRUaW1lKCkgLSB5ZWFyU3RhcnQuZ2V0VGltZSgpKS84NjQwMDAwMCkgKyAxXG59XG4vLyBodHRwczovL29ic2VydmFibGVocS5jb20vQGRicmlkZ2VzL3Zpc3VhbGl6aW5nLXNlYXNvbmFsLWRheWxpZ2h0XG5kYXlsaWdodFBsb3QgPSAoXG4gIHJvb3QsXG4gIHsgdml6d2lkdGgsIGhlaWdodCwgeWVhciwgbGF0aXR1ZGUsIGRlZmF1bHREYXRlLCBkZWZhdWx0SG91ciB9XG4pID0+IHtcbiAgY29uc3QgbWFyZ2luID0geyB0b3A6IDMyLCBib3R0b206IDMyLCBsZWZ0OiAzMiwgcmlnaHQ6IDAgfTtcbiAgY29uc3QgY2hhcnRXaWR0aCA9IHZpendpZHRoIC0gbWFyZ2luLmxlZnQgLSBtYXJnaW4ucmlnaHQ7XG4gIGNvbnN0IGNoYXJ0SGVpZ2h0ID0gaGVpZ2h0IC0gbWFyZ2luLnRvcCAtIG1hcmdpbi5ib3R0b207XG4gIGNvbnN0IHlUaWNrVmFsdWVzID1cbiAgICB3aWR0aCA+IDM4MCA/IFszLCA2LCA5LCAxMiwgMTUsIDE4LCAyMV0gOiB3aWR0aCA+IDkwID8gWzYsIDEyLCAxOF0gOiBbMTJdO1xuICBjb25zdCB5U2NhbGUgPSBkM1xuICAgIC5zY2FsZUxpbmVhcigpXG4gICAgLmRvbWFpbihbMCwgMjRdKVxuICAgIC5yYW5nZShbbWFyZ2luLmxlZnQsIG1hcmdpbi5sZWZ0ICsgY2hhcnRXaWR0aF0pXG4gICAgLmNsYW1wKHRydWUpO1xuICAvLyB5LWF4aXMgc2NhbGVcbiAgY29uc3QgeFNjYWxlID0gZDNcbiAgICAuc2NhbGVUaW1lKClcbiAgICAuZG9tYWluKFtuZXcgRGF0ZSh5ZWFyLCAwLCA2MSksIG5ldyBEYXRlKHllYXIsIDExLCA5MSldKVxuICAgIC5yYW5nZShbbWFyZ2luLnRvcCwgbWFyZ2luLnRvcCArIGNoYXJ0SGVpZ2h0XSlcbiAgICAuY2xhbXAodHJ1ZSk7XG4gIC8vIHktYXhpcyBsYWJlbHNcbiAgY29uc3QgeEF4aXMgPSBkM1xuICAgIC5heGlzQm90dG9tKHhTY2FsZSlcbiAgICAudGlja1ZhbHVlcyhkMy50aW1lTW9udGgucmFuZ2UobmV3IERhdGUoeWVhciwgMCwgNjApLCBuZXcgRGF0ZSh5ZWFyLCAxMiwgNTcpKSlcbiAgICAudGlja1NpemUoY2hhcnRXaWR0aClcbiAgICAudGlja0Zvcm1hdChkYXRlMmRvdHkxKTtcbiAgY29uc3QgeUF4aXMgPSBkM1xuICAgIC5heGlzTGVmdCh5U2NhbGUpXG4gICAgLnRpY2tWYWx1ZXMoeVRpY2tWYWx1ZXMpXG4gICAgLnRpY2tTaXplKGNoYXJ0SGVpZ2h0KVxuICAgIC50aWNrRm9ybWF0KChkKSA9PiB7IHJldHVybiBgJHtkIC8gLjAyNH1gIH0pO1xuICBsZXQgZGF0ZSA9IGRlZmF1bHREYXRlIHx8IG5ldyBEYXRlKCk7XG4gIGxldCBob3VyID0gZGVmYXVsdEhvdXIgIT0gbnVsbCA/IGRlZmF1bHRIb3VyIDogZGF0ZS5nZXRIb3VycygpO1xuICBjb25zdCBoYW5kbGVNb3VzZU1vdmUgPSAoZSkgPT4ge307XG4gIHJvb3RcbiAgICAuYXBwZW5kKFwicmVjdFwiKVxuICAgIC5hdHRyKFwieVwiLCBtYXJnaW4ubGVmdClcbiAgICAuYXR0cihcInhcIiwgbWFyZ2luLnRvcClcbiAgICAuYXR0cihcImhlaWdodFwiLCBjaGFydFdpZHRoKVxuICAgIC5hdHRyKFwid2lkdGhcIiwgY2hhcnRIZWlnaHQpXG4gICAgLmF0dHIoXCJyeVwiLCAwLjA1ICogdml6d2lkdGgpXG4gICAgLmF0dHIoXCJmaWxsXCIsIG1hcGNvbG9ycy5uaWdodCk7XG4gIHJvb3RcbiAgICAuYXBwZW5kKFwiZ1wiKVxuICAgIC5hdHRyKFwidHJhbnNmb3JtXCIsIGB0cmFuc2xhdGUoMCwgJHttYXJnaW4udG9wfSlgKVxuICAgIC5jYWxsKHhBeGlzKVxuICAgIC5jYWxsKChnKSA9PiBnLnNlbGVjdChcIi5kb21haW5cIikucmVtb3ZlKCkpXG4gICAgLmNhbGwoKGcpID0+IGcuc2VsZWN0QWxsKFwiLnRpY2tcIikuYXR0cihcImNvbG9yXCIsIG1hcGNvbG9ycy5ncmlkKSlcbiAgICAuY2FsbCgoZykgPT4gZy5zZWxlY3RBbGwoXCIudGljayB0ZXh0XCIpLmF0dHIoXCJmb250LXNpemVcIiwgKHdpZHRoIDwgMzAwID8gLjcgOiB3aWR0aCA8IDMyNSA/IC43MjUgOiB3aWR0aCA8IDM1MCA/IC43NSA6IHdpZHRoIDwgMzc1ID8gLjggOiB3aWR0aCA8IDQwMCA/IC45IDogd2lkdGggPCA0NTAgPyAuOTUgOiB3aWR0aCA8IDUwMCA/IDEgOiB3aWR0aCA8IDYwMCA/IDEuMiA6IHdpZHRoIDwgNzAwID8gMS4zIDogd2lkdGggPCA4MDAgPyAxLjQgOiB3aWR0aCA8IDkwMCA/IDEuNSA6IHdpZHRoIDwgMTAwMCA/IDEuNyA6IHdpZHRoIDwgMTEwMCA/IDEuOCA6IHdpZHRoIDwgMTIwMCA/IDEuOSA6IDIpICogZm9udFNpemUpKVxuICAgIC5jYWxsKChnKSA9PiBnLnNlbGVjdEFsbChcIi50aWNrIHRleHRcIikuYXR0cihcImNvbG9yXCIsIFwiYmxhY2tcIikpXG4gICAgLmNhbGwoKGcpID0+IGcuc2VsZWN0QWxsKFwiLnRpY2sgbGluZVwiKS5hdHRyKFwic3Ryb2tlLWRhc2hhcnJheVwiLCBcIjUgM1wiKSk7XG4gIHJvb3RcbiAgICAuYXBwZW5kKFwiZ1wiKVxuICAgIC5hdHRyKFwidHJhbnNmb3JtXCIsIGB0cmFuc2xhdGUoJHttYXJnaW4ubGVmdCArIGNoYXJ0SGVpZ2h0fSwgMClgKVxuICAgIC5jYWxsKHlBeGlzKVxuICAgIC5jYWxsKChnKSA9PiBnLnNlbGVjdChcIi5kb21haW5cIikucmVtb3ZlKCkpXG4gICAgLmNhbGwoKGcpID0+IGcuc2VsZWN0QWxsKFwiLnRpY2tcIikuYXR0cihcImNvbG9yXCIsIG1hcGNvbG9ycy5ncmlkKSlcbiAgICAuY2FsbCgoZykgPT4gZy5zZWxlY3RBbGwoXCIudGljayB0ZXh0XCIpLmF0dHIoXCJmb250LXNpemVcIiwgKHdpZHRoIDwgNDAwID8gLjkgOiB3aWR0aCA8IDQ1MCA/IC45NSA6IHdpZHRoIDwgNTAwID8gMSA6IHdpZHRoIDwgNjAwID8gMS4yIDogd2lkdGggPCA3MDAgPyAxLjMgOiB3aWR0aCA8IDgwMCA/IDEuNCA6IHdpZHRoIDwgOTAwID8gMS41IDogd2lkdGggPCAxMDAwID8gMS43IDogd2lkdGggPCAxMTAwID8gMS44IDogd2lkdGggPCAxMjAwID8gMS45IDogMikgKiBmb250U2l6ZSkpXG4gICAgLmNhbGwoKGcpID0+IGcuc2VsZWN0QWxsKFwiLnRpY2sgdGV4dFwiKS5hdHRyKFwiY29sb3JcIiwgXCJibGFja1wiKSlcbiAgICAuY2FsbCgoZykgPT4gZy5zZWxlY3RBbGwoXCIudGljayBsaW5lXCIpLmF0dHIoXCJzdHJva2UtZGFzaGFycmF5XCIsIFwiNSAzXCIpKTtcbiAgcm9vdFxuICAgIC5hcHBlbmQoXCJ0ZXh0XCIpXG4gICAgLnRleHQoXCJUaW1lIG9mIGRheVwiKVxuICAgIC5hdHRyKFwieFwiLCAtY2hhcnRIZWlnaHQgLyA1ICsgKHdpZHRoIDwgMjc1ID8gLTIgOiB3aWR0aCA8IDMwMCA/IC02IDogd2lkdGggPCAzMjUgPyAtOCA6IHdpZHRoIDwgMzUwID8gLTE1IDogd2lkdGggPCAzNzUgPyAtMjAgOiB3aWR0aCA8IDQwMCA/IC0yOCA6IHdpZHRoIDwgNDI1ID8gLTMwIDogd2lkdGggPCA0NTAgPyAtMzIgOiB3aWR0aCA8IDQ3NSA/IC0zNiA6IHdpZHRoIDwgNTAwID8gLTQxIDogd2lkdGggPCA1MjUgPyAtNDIgOiB3aWR0aCA8IDU1MCA/IC00OCA6IHdpZHRoIDwgNTc1ID8gLTQ5IDogd2lkdGggPCA2MDAgPyAtNCA6IHdpZHRoIDwgNjUwID8gLTcgOiB3aWR0aCA8IDY3NSA/IC0xMiA6IHdpZHRoIDwgNzAwID8gLTE2IDogd2lkdGggPCA3MjUgPyAtMTUgOiB3aWR0aCA8IDc1MCA/IC0yMCA6IHdpZHRoIDwgNzc1ID8gLTUgOiB3aWR0aCA8IDg3NSA/IC0zIDogd2lkdGggPCA5NzUgPyAxMyA6IHdpZHRoIDwgMTAyNSA/IDM2IDogd2lkdGggPCAxMDc1ID8gMjggOiB3aWR0aCA8IDExMjUgPyAyOCA6IHdpZHRoIDwgMTE3NSA/IDI4IDogd2lkdGggPCAxMjc1ID8gMzUgOiAzMikpXG4gICAgLmF0dHIoXCJ5XCIsIG1hcmdpbi5sZWZ0IC0gKHdpZHRoIDwgMjc1ID8gMTIgOiB3aWR0aCA8IDMwMCA/IDE2IDogd2lkdGggPCAzMjUgPyAxNyA6IHdpZHRoIDwgMzUwID8gMTggOiB3aWR0aCA8IDM3NSA/IDE5IDogd2lkdGggPCA0MDAgPyAyMCA6IHdpZHRoIDwgNDI1ID8gMjEgOiB3aWR0aCA8IDQ1MCA/IDIyIDogd2lkdGggPCA0NzUgPyAyMyA6IHdpZHRoIDwgNTAwID8gMjQgOiB3aWR0aCA8IDUyNSA/IDI1IDogd2lkdGggPCA1NTAgPyAyNiA6IHdpZHRoIDwgNTc1ID8gMjcgOiB3aWR0aCA8IDYwMCA/IDI4IDogd2lkdGggPCA2NTAgPyAyOSA6IHdpZHRoIDwgNjc1ID8gMzAgOiB3aWR0aCA8IDcwMCA/IDMxIDogd2lkdGggPCA3MjUgPyA0MCA6IHdpZHRoIDwgNzUwID8gNDkgOiB3aWR0aCA8IDc3NSA/IDQ2IDogd2lkdGggPCA4NzUgPyA0NyA6IHdpZHRoIDwgOTI1ID8gNTIgOiB3aWR0aCA8IDk3NSA/IDUzIDogd2lkdGggPCAxMDI1ID8gNTQgOiB3aWR0aCA8IDEwNzUgPyA1NSA6IHdpZHRoIDwgMTE3NSA/IDY0IDogd2lkdGggPCAxMjc1ID8gNjggOiA2NCkpXG4gICAgLmF0dHIoXCJ0ZXh0LWFuY2hvclwiLCBcIm1pZGRsZVwiKVxuICAgIC5hdHRyKFwiZm9udC1zaXplXCIsIGZvbnRTaXplICogKHdpZHRoIDwgMzAwID8gLjggOiB3aWR0aCA8IDQwMCA/IC45IDogd2lkdGggPCA1MDAgPyAxIDogd2lkdGggPCA2MDAgPyAxLjEgOiB3aWR0aCA8IDcwMCA/IDEuMiA6IDEuMjUpICsgd2lkdGggLyAxMDApXG4gICAgLmF0dHIoXCJmb250LWZhbWlseVwiLCBcInNhbnMtc2VyaWZcIilcbiAgICAuYXR0cihcInRyYW5zZm9ybVwiLCBcInJvdGF0ZSgtOTApXCIpXG4gICAgLmF0dHIoXCJmaWxsXCIsIFwiYmxhY2tcIik7XG4gIHJvb3RcbiAgICAuYXBwZW5kKFwidGV4dFwiKVxuICAgIC50ZXh0KFwiRGF5IG9mIHllYXJcIilcbiAgICAuYXR0cihcInhcIiwgbWFyZ2luLmxlZnQgKyB3aWR0aCAvIDIgLSAod2lkdGggPCA1MDAgPyAzMCA6IHdpZHRoIDwgNjAwID8gMjggOiB3aWR0aCA8IDcwMCA/IDI0IDogMjIpKVxuICAgIC5hdHRyKFwieVwiLCBtYXJnaW4udG9wICsgY2hhcnRIZWlnaHQgLyA0ICsgbWFyZ2luLmJvdHRvbSArICh3aWR0aCA8IDI3NSA/IDEwIDogd2lkdGggPCAzMDAgPyAxOCA6IHdpZHRoIDwgMzI1ID8gMTkgOiB3aWR0aCA8IDM1MCA/IDIyIDogd2lkdGggPCAzNzUgPyAzMCA6IHdpZHRoIDwgNDAwID8gMzcgOiB3aWR0aCA8IDQ1MCA/IDM5IDogd2lkdGggPCA0NzUgPyA0MCA6IHdpZHRoIDwgNTAwID8gNDQgOiB3aWR0aCA8IDU1MCA/IDUwIDogd2lkdGggPCA2MDAgPyA1MSA6IHdpZHRoIDwgNjUwID8gNDUgOiB3aWR0aCA8IDcwMCA/IDM5IDogd2lkdGggPCA3NTAgPyAzNSA6IHdpZHRoIDwgODUwID8gNDUgOiB3aWR0aCA8IDk1MCA/IDU1IDogd2lkdGggPCAxMDUwID8gNjUgOiB3aWR0aCA8IDExNTAgPyA3NSA6IHdpZHRoIDwgMTI1MCA/IDg1IDogd2lkdGggPCAxMzUwID8gOTUgOiAxMDkpKVxuICAgIC5hdHRyKFwidGV4dC1hbmNob3JcIiwgXCJtaWRkbGVcIilcbiAgICAuYXR0cihcImZvbnQtc2l6ZVwiLCBmb250U2l6ZSAqICh3aWR0aCA8IDMwMCA/IC45NSA6IHdpZHRoIDwgNDAwID8gMSA6IHdpZHRoIDwgNTAwID8gMS4wNSA6IHdpZHRoIDwgNjAwID8gMS4xNSA6IHdpZHRoIDwgNzAwID8gMS4yIDogMS4yNSkgKyB3aWR0aCAvIDEwMClcbiAgICAuYXR0cihcImZvbnQtZmFtaWx5XCIsIFwic2Fucy1zZXJpZlwiKVxuICAgIC5hdHRyKFwiZmlsbFwiLCBcImJsYWNrXCIpO1xuICBjb25zdCBkYXRhID0geWVhckRhdGVzKHllYXIpXG4gICAgLm1hcCgoZCkgPT4gW2QsIGRheUxlbmd0aChkLCBsYXRpdHVkZSldKVxuICAgIC5maWx0ZXIoKFtfLCBkXSkgPT4gZCA+IDApO1xuICAvKiBSZW5kZXIgc2VwYXJhdGUgcG9seWdvbnMgZm9yIGVhY2ggY29udGludW91cyBzZXF1ZW5jZSBvZlxuICAgKiBkYXlzIHdpdGggbW9yZSB0aGFuIDAgaG91cnMgb2YgZGF5IGxpZ2h0XG4gICAqL1xuICBjb25zdCBwb2x5cyA9IFtdO1xuICBsZXQgY3VycmVudFBvbHkgPSBbXTtcbiAgZm9yIChsZXQgaSA9IDA7IGkgPCBkYXRhLmxlbmd0aDsgaSsrKSB7XG4gICAgY29uc3QgY3VycmVudERhdGUgPSBkYXRhW2ldWzBdO1xuICAgIGNvbnN0IHByZXZEYXRlID0gKGRhdGFbaSAtIDFdIHx8IFtdKVswXTtcbiAgICBpZiAoXG4gICAgICBpID09PSAwIHx8XG4gICAgICBjdXJyZW50RGF0ZS5nZXRUaW1lKCkgLSBwcmV2RGF0ZS5nZXRUaW1lKCkgPCAzNjAwICogMjQgKiAxMDAwICogMS41XG4gICAgKSB7XG4gICAgICBjdXJyZW50UG9seS5wdXNoKGRhdGFbaV0pO1xuICAgIH0gZWxzZSB7XG4gICAgICBwb2x5cy5wdXNoKGN1cnJlbnRQb2x5KTtcbiAgICAgIGN1cnJlbnRQb2x5ID0gW2RhdGFbaV1dO1xuICAgIH1cbiAgfVxuICBwb2x5cy5wdXNoKGN1cnJlbnRQb2x5KTtcbiAgcG9seXMuZm9yRWFjaCgocCkgPT4ge1xuICAgIGNvbnN0IHBvaW50cyA9IFtcbiAgICAgIC4uLnAubWFwKChbZCwgbF0pID0+IGAke3hTY2FsZShkKX0sJHt5U2NhbGUoMTIgLSBsIC8gMil9YCksXG4gICAgICAuLi5wLnJldmVyc2UoKS5tYXAoKFtkLCBsXSkgPT4gYCR7eFNjYWxlKGQpfSwke3lTY2FsZSgxMiArIGwgLyAyKX1gKVxuICAgIF0uam9pbihcIiBcIik7XG4gICAgcm9vdC5hcHBlbmQoXCJwb2x5Z29uXCIpLmF0dHIoXCJwb2ludHNcIiwgcG9pbnRzKS5hdHRyKFwiZmlsbFwiLCBtYXBjb2xvcnMuZGF5KTtcbiAgfSk7XG4gIC8qIExlZ2VuZCAqL1xuICBjb25zdCBsZWdlbmQgPSByb290XG4gICAgLmFwcGVuZChcImdcIilcbiAgICAuYXR0cihcInRyYW5zZm9ybVwiLCBgdHJhbnNsYXRlKCR7bWFyZ2luLmxlZnQgKyBjaGFydFdpZHRoIC8gMiAtIDY0fSlgKTtcbiAgbGVnZW5kXG4gICAgLmFwcGVuZChcInJlY3RcIilcbiAgICAuYXR0cihcInhcIiwgY2hhcnRXaWR0aCAvIDIwICsgKHdpZHRoIDwgMjc1ID8gMSA6IHdpZHRoIDwgMzAwID8gMiA6IHdpZHRoIDwgMzI1ID8gMyA6IHdpZHRoIDwgMzUwID8gNCA6IHdpZHRoIDwgMzc1ID8gNSA6IHdpZHRoIDwgNDAwID8gNiA6IHdpZHRoIDwgNDUwID8gNyA6IHdpZHRoIDwgNDc1ID8gOCA6IHdpZHRoIDwgNTAwID8gOSA6IHdpZHRoIDwgNTUwID8gMTAgOiB3aWR0aCA8IDYwMCA/IDExIDogd2lkdGggPCA2NTAgPyAxMiA6IHdpZHRoIDwgNzAwID8gMTMgOiB3aWR0aCA8IDc1MCA/IDE0IDogd2lkdGggPCA4NTAgPyA1IDogd2lkdGggPCA5NTAgPyAtNiA6IHdpZHRoIDwgMTA1MCA/IC04IDogd2lkdGggPCAxMTUwID8gLTggOiB3aWR0aCA8IDEyNTAgPyAtOCA6IHdpZHRoIDwgMTM1MCA/IC04IDogd2lkdGggPCAxNDAwID8gLTggOiAtMTAwKSlcbiAgICAuYXR0cihcInlcIiwgY2hhcnRIZWlnaHQgLyA0ICsgKHdpZHRoIDwgMzAwID8gODEgOiB3aWR0aCA8IDQwMCA/IDgyIDogd2lkdGggPCA0NTAgPyA4MyA6IHdpZHRoIDwgNTAwID8gNTIgOiB3aWR0aCA8IDYwMCA/IDU0IDogd2lkdGggPCA3MDAgPyA4NSA6IHdpZHRoIDwgODAwID8gOTQgOiB3aWR0aCA8IDkwMCA/IDk5IDogd2lkdGggPCAxMDAwID8gMTA5IDogd2lkdGggPCAxMTAwID8gMTM5IDogd2lkdGggPCAxMjAwID8gMTc5IDogMTU0KSlcbiAgICAuYXR0cihcInJ4XCIsIDUpXG4gICAgLmF0dHIoXCJ3aWR0aFwiLCBmb250U2l6ZSAqICh3aWR0aCA8IDMwMCA/IC45NSA6IHdpZHRoIDwgNDAwID8gMSA6IHdpZHRoIDwgNTAwID8gMS4wNSA6IHdpZHRoIDwgNjAwID8gMS4xNSA6IHdpZHRoIDwgNzAwID8gMS4yIDogMS4yNSkgKyB3aWR0aCAvIDEwMClcbiAgICAuYXR0cihcImhlaWdodFwiLCBmb250U2l6ZSAqICh3aWR0aCA8IDMwMCA/IC45NSA6IHdpZHRoIDwgNDAwID8gMSA6IHdpZHRoIDwgNTAwID8gMS4wNSA6IHdpZHRoIDwgNjAwID8gMS4xNSA6IHdpZHRoIDwgNzAwID8gMS4yIDogMS4yNSkgKyB3aWR0aCAvIDEwMClcbiAgICAuYXR0cihcImZpbGxcIiwgbWFwY29sb3JzLmRheSk7XG4gIGxlZ2VuZFxuICAgIC5hcHBlbmQoXCJ0ZXh0XCIpXG4gICAgLmF0dHIoXCJ4XCIsIGNoYXJ0V2lkdGggLyAyMCArICh3aWR0aCA8IDI3NSA/IDEgOiB3aWR0aCA8IDMwMCA/IDIgOiB3aWR0aCA8IDMyNSA/IDMgOiB3aWR0aCA8IDM1MCA/IDQgOiB3aWR0aCA8IDM3NSA/IDUgOiB3aWR0aCA8IDQwMCA/IDYgOiB3aWR0aCA8IDQ1MCA/IDcgOiB3aWR0aCA8IDQ3NSA/IDggOiB3aWR0aCA8IDUwMCA/IDkgOiB3aWR0aCA8IDU1MCA/IDEwIDogd2lkdGggPCA2MDAgPyAxMSA6IHdpZHRoIDwgNjUwID8gMTIgOiB3aWR0aCA8IDcwMCA/IDEzIDogd2lkdGggPCA3NTAgPyAxNCA6IHdpZHRoIDwgODUwID8gMTkgOiB3aWR0aCA8IDk1MCA/IDI5IDogd2lkdGggPCAxMDUwID8gMjkgOiB3aWR0aCA8IDExNTAgPyAyOSA6IHdpZHRoIDwgMTI1MCA/IDI5IDogd2lkdGggPCAxMzUwID8gMjkgOiB3aWR0aCA8IDE0MDAgPyAzMyA6IC02MikpXG4gICAgLmF0dHIoXCJ5XCIsIGNoYXJ0SGVpZ2h0IC8gNCArICh3aWR0aCA8IDMwMCA/IDcyIDogd2lkdGggPCA0MDAgPyA3MyA6IHdpZHRoIDwgNDUwID8gNzQgOiB3aWR0aCA8IDUwMCA/IDY4IDogd2lkdGggPCA2MDAgPyA3MCA6IHdpZHRoIDwgNzAwID8gNzQgOiB3aWR0aCA8IDgwMCA/IDcyIDogd2lkdGggPCA5MDAgPyAxMjIgOiB3aWR0aCA8IDEwMDAgPyAxMzIgOiB3aWR0aCA8IDExMDAgPyAxNDIgOiB3aWR0aCA8IDEyMDAgPyAxNTIgOiAxODIpKVxuICAgIC5hdHRyKFwiZm9udC1zaXplXCIsIGZvbnRTaXplICogKHdpZHRoIDwgMzAwID8gLjk1IDogd2lkdGggPCA0MDAgPyAxIDogd2lkdGggPCA1MDAgPyAxLjA1IDogd2lkdGggPCA2MDAgPyAxLjE1IDogd2lkdGggPCA3MDAgPyAxLjIgOiAxLjI1KSArIHdpZHRoIC8gMTAwKVxuICAgIC5hdHRyKFwiZm9udC1mYW1pbHlcIiwgXCJzYW5zLXNlcmlmXCIpXG4gICAgLnRleHQoXCJEYXlcIik7XG4gIGxlZ2VuZFxuICAgIC5hcHBlbmQoXCJyZWN0XCIpXG4gICAgLmF0dHIoXCJ4XCIsIGNoYXJ0V2lkdGggLyAyMCArICh3aWR0aCA8IDI3NSA/IC01OSA6IHdpZHRoIDwgMzAwID8gLTU4IDogd2lkdGggPCAzMjUgPyAtNTcgOiB3aWR0aCA8IDM1MCA/IC01NiA6IHdpZHRoIDwgMzc1ID8gLTU1IDogd2lkdGggPCA0MDAgPyAtNTQgOiB3aWR0aCA8IDQ1MCA/IC01MyA6IHdpZHRoIDwgNDc1ID8gLTUyIDogd2lkdGggPCA1MDAgPyAtNTEgOiB3aWR0aCA8IDU1MCA/IC01MCA6IHdpZHRoIDwgNjAwID8gLTUxIDogd2lkdGggPCA2NTAgPyAtNTIgOiB3aWR0aCA8IDcwMCA/IC01MyA6IHdpZHRoIDwgNzUwID8gLTc0IDogd2lkdGggPCA4NTAgPyAtMTMyIDogd2lkdGggPCA5NTAgPyAtMTMyIDogd2lkdGggPCAxMDUwID8gLTEzMiA6IHdpZHRoIDwgMTE1MCA/IC0xMzIgOiB3aWR0aCA8IDEyNTAgPyAtMTMyIDogd2lkdGggPCAxMzUwID8gLTEzMiA6IHdpZHRoIDwgMTQwMCA/IC0xNDggOiAtMjQwKSlcbiAgICAuYXR0cihcInlcIiwgY2hhcnRIZWlnaHQgLyA0ICsgKHdpZHRoIDwgMzAwID8gODEgOiB3aWR0aCA8IDQwMCA/IDgyIDogd2lkdGggPCA0NTAgPyA4MyA6IHdpZHRoIDwgNTAwID8gNTIgOiB3aWR0aCA8IDYwMCA/IDU0IDogd2lkdGggPCA3MDAgPyA4NSA6IHdpZHRoIDwgODAwID8gOTQgOiB3aWR0aCA8IDkwMCA/IDk5IDogd2lkdGggPCAxMDAwID8gMTA5IDogd2lkdGggPCAxMTAwID8gMTM5IDogd2lkdGggPCAxMjAwID8gMTc5IDogMTU0KSlcbiAgICAuYXR0cihcInJ4XCIsIDUpXG4gICAgLmF0dHIoXCJ3aWR0aFwiLCBmb250U2l6ZSAqICh3aWR0aCA8IDMwMCA/IC45NSA6IHdpZHRoIDwgNDAwID8gMSA6IHdpZHRoIDwgNTAwID8gMS4wNSA6IHdpZHRoIDwgNjAwID8gMS4xNSA6IHdpZHRoIDwgNzAwID8gMS4yIDogMS4yNSkgKyB3aWR0aCAvIDEwMClcbiAgICAuYXR0cihcImhlaWdodFwiLCBmb250U2l6ZSAqICh3aWR0aCA8IDMwMCA/IC45NSA6IHdpZHRoIDwgNDAwID8gMSA6IHdpZHRoIDwgNTAwID8gMS4wNSA6IHdpZHRoIDwgNjAwID8gMS4xNSA6IHdpZHRoIDwgNzAwID8gMS4yIDogMS4yNSkgKyB3aWR0aCAvIDEwMClcbiAgICAuYXR0cihcImZpbGxcIiwgbWFwY29sb3JzLm5pZ2h0KTtcbiAgbGVnZW5kXG4gICAgLmFwcGVuZChcInRleHRcIilcbiAgICAuYXR0cihcInhcIiwgY2hhcnRXaWR0aCAvIDIwICsgKHdpZHRoIDwgMjc1ID8gOSA6IHdpZHRoIDwgMzAwID8gOCA6IHdpZHRoIDwgMzI1ID8gNyA6IHdpZHRoIDwgMzUwID8gNiA6IHdpZHRoIDwgMzc1ID8gNSA6IHdpZHRoIDwgNDAwID8gNCA6IHdpZHRoIDwgNDUwID8gMyA6IHdpZHRoIDwgNDc1ID8gMiA6IHdpZHRoIDwgNTAwID8gMSA6IHdpZHRoIDwgNTUwID8gMCA6IHdpZHRoIDwgNjAwID8gLTEgOiB3aWR0aCA8IDY1MCA/IC0yIDogd2lkdGggPCA3MDAgPyAtMyA6IHdpZHRoIDwgNzUwID8gLTE5IDogd2lkdGggPCA4NTAgPyAtOTggOiB3aWR0aCA8IDk1MCA/IC05OCA6IHdpZHRoIDwgMTA1MCA/IC05OCA6IHdpZHRoIDwgMTE1MCA/IC05OCA6IHdpZHRoIDwgMTI1MCA/IC05OCA6IHdpZHRoIDwgMTM1MCA/IC05OCA6IHdpZHRoIDwgMTQwMCA/IC0xMDggOiAtMjAxKSlcbiAgICAuYXR0cihcInlcIiwgY2hhcnRIZWlnaHQgLyA0ICsgKHdpZHRoIDwgMzAwID8gNzIgOiB3aWR0aCA8IDQwMCA/IDczIDogd2lkdGggPCA0NTAgPyA3NCA6IHdpZHRoIDwgNTAwID8gNjggOiB3aWR0aCA8IDYwMCA/IDcwIDogd2lkdGggPCA3MDAgPyA3NCA6IHdpZHRoIDwgODAwID8gNzIgOiB3aWR0aCA8IDkwMCA/IDEyMiA6IHdpZHRoIDwgMTAwMCA/IDEzMiA6IHdpZHRoIDwgMTEwMCA/IDE0MiA6IHdpZHRoIDwgMTIwMCA/IDE1MiA6IDE4MikpXG4gICAgLmF0dHIoXCJmb250LXNpemVcIiwgZm9udFNpemUgKiAod2lkdGggPCAzMDAgPyAuOTUgOiB3aWR0aCA8IDQwMCA/IDEgOiB3aWR0aCA8IDUwMCA/IDEuMDUgOiB3aWR0aCA8IDYwMCA/IDEuMTUgOiB3aWR0aCA8IDcwMCA/IDEuMiA6IDEuMjUpICsgd2lkdGggLyAxMDApXG4gICAgLmF0dHIoXCJmb250LWZhbWlseVwiLCBcInNhbnMtc2VyaWZcIilcbiAgICAudGV4dChcIk5pZ2h0XCIpO1xuICAvKiBUaW1lIGFuZCBkYXRlIGNvbnRyb2xzICovXG4gIGNvbnN0IGRhdGVMaW5lID0gcm9vdC5hcHBlbmQoXCJnXCIpO1xuICBjb25zdCB1cGRhdGVDb250cm9sUG9zaXRpb25zID0gKCkgPT4ge1xuICAgIGRhdGVMaW5lXG4gICAgICAuc2VsZWN0KFwibGluZVwiKVxuICAgICAgLmF0dHIoXCJ5MVwiLCB5U2NhbGUoMCkpXG4gICAgICAuYXR0cihcIngxXCIsIHhTY2FsZShkYXRlKSlcbiAgICAgIC5hdHRyKFwieTJcIiwgeVNjYWxlKDI0KSlcbiAgICAgIC5hdHRyKFwieDJcIiwgeFNjYWxlKGRhdGUpKTtcbiAgICBkYXRlTGluZVxuICAgICAgLnNlbGVjdChcInJlY3RcIilcbiAgICAgIC5hdHRyKFwieVwiLCB5U2NhbGUoMCkpXG4gICAgICAuYXR0cihcInhcIiwgeFNjYWxlKGRhdGUpIC0gNCk7XG4gICAgcm9vdFxuICAgICAgLnNlbGVjdChcIiN0aW1lLWNvbnRyb2xcIilcbiAgICAgIC5hdHRyKFwiY3lcIiwgeVNjYWxlKGhvdXIpKVxuICAgICAgLmF0dHIoXCJjeFwiLCB4U2NhbGUoZGF0ZSkpO1xuICB9O1xuICBjb25zdCBkaXNwYXRjaERhdGVIb3VyQ2hhbmdlID0gKCkgPT4ge1xuICAgIGNvbnN0IGRldGFpbCA9IHsgZGF0ZSwgaG91ciB9O1xuICAgIGNvbnN0IGNoYW5nZUV2ZW50ID0gbmV3IEN1c3RvbUV2ZW50KEV2ZW50VHlwZS5EYXRlSG91ckNoYW5nZSwge1xuICAgICAgZGV0YWlsLFxuICAgICAgYnViYmxlczogdHJ1ZVxuICAgIH0pO1xuICAgIHJvb3Qubm9kZSgpLmRpc3BhdGNoRXZlbnQoY2hhbmdlRXZlbnQpO1xuICB9O1xuICBjb25zdCBoYW5kbGVEYXRlTGluZURyYWcgPSAoeyB4IH0pID0+IHtcbiAgICBkYXRlID0geFNjYWxlLmludmVydCh4KTtcbiAgICB1cGRhdGVDb250cm9sUG9zaXRpb25zKCk7XG4gICAgZGlzcGF0Y2hEYXRlSG91ckNoYW5nZSgpO1xuICB9O1xuICBjb25zdCBoYW5kbGVUaW1lQ2lyY2xlRHJhZyA9ICh7IHkgfSkgPT4ge1xuICAgIGhvdXIgPSB5U2NhbGUuaW52ZXJ0KHkpO1xuICAgIHVwZGF0ZUNvbnRyb2xQb3NpdGlvbnMoKTtcbiAgICBkaXNwYXRjaERhdGVIb3VyQ2hhbmdlKCk7XG4gIH07XG4gIGRhdGVMaW5lLmFwcGVuZChcImxpbmVcIikuYXR0cihcInN0cm9rZS13aWR0aFwiLCA0KS5hdHRyKFwic3Ryb2tlXCIsIFwicmVkXCIpO1xuICBkYXRlTGluZVxuICAgIC5hcHBlbmQoXCJyZWN0XCIpXG4gICAgLmF0dHIoXCJoZWlnaHRcIiwgY2hhcnRXaWR0aClcbiAgICAuYXR0cihcIndpZHRoXCIsIDgpXG4gICAgLmF0dHIoXCJmaWxsXCIsIFwicmdiYSgwLCAwLCAwLCAwKVwiKVxuICAgIC5zdHlsZShcImN1cnNvclwiLCBcInJvdy1yZXNpemVcIilcbiAgICAuY2FsbChkMy5kcmFnKCkub24oXCJkcmFnXCIsIGhhbmRsZURhdGVMaW5lRHJhZykpO1xuICByb290XG4gICAgLmFwcGVuZChcImNpcmNsZVwiKVxuICAgIC5hdHRyKFwiaWRcIiwgXCJ0aW1lLWNvbnRyb2xcIilcbiAgICAuYXR0cihcInJcIiwgMTIpXG4gICAgLmF0dHIoXCJmaWxsXCIsIFwicmVkXCIpXG4gICAgLmF0dHIoXCJzdHJva2Utd2lkdGhcIiwgLjYpXG4gICAgLmF0dHIoXCJzdHJva2VcIiwgXCJibGFja1wiKVxuICAgIC5zdHlsZShcImN1cnNvclwiLCBcInBvaW50ZXJcIilcbiAgICAuY2FsbChkMy5kcmFnKCkub24oXCJkcmFnXCIsIGhhbmRsZVRpbWVDaXJjbGVEcmFnKSk7XG4gIHVwZGF0ZUNvbnRyb2xQb3NpdGlvbnMoKTtcbn1cbmZvbnRTaXplID0gMTQ7XG5nZXRTb2xhckFuZ2xlID0gKGRhdGUpID0+IChkYXlPZlllYXIoZGF0ZSkgKyAxMCkgLyAzNjUgKiBNYXRoLlBJICogMiAtIE1hdGguUEkgLyAyO1xuLypcbiAqIEZvcm11bGFzIHVzZXMgdGhlIENCTSBtb2RlbCBhcyByZXZpZXdlZCBoZXJlOlxuICogaHR0cHM6Ly93d3cuaWtoZWJlZW52cmFhZy5iZS9tZWRpYXN0b3JhZ2UvRlNEb2N1bWVudC8xNzEvRm9yc3l0aGUrLStBK21vZGVsK2NvbXBhcmlzb24rZm9yK2RheWxlbmd0aCthcythK2Z1bmN0aW9uK29mK2xhdGl0dWRlK2FuZCtkYXkrb2YreWVhcistKzE5OTUucGRmXG4gKi9cbmRheUxlbmd0aCA9IChkYXRlLCBsYXRpdHVkZSkgPT4ge1xuICBjb25zdCB5ZWFyU3RhcnQgPSBuZXcgRGF0ZShkYXRlLmdldEZ1bGxZZWFyKCksIDAsIDEpO1xuICBjb25zdCBkYXlPZlllYXIgPSBNYXRoLmZsb29yKChkYXRlLmdldFRpbWUoKSAtIHllYXJTdGFydC5nZXRUaW1lKCkpLzg2NDAwMDAwKSArIDE7XG4gIGNvbnN0IHJldkFuZ2xlID0gMC4yMTYzMTA4ICsgMiAqIE1hdGguYXRhbigwLjk2NzEzOTYgKiBNYXRoLnRhbigwLjAwODYwICogKGRheU9mWWVhciAtIDE4NikpKTtcbiAgY29uc3QgZGVjQW5nbGUgPSBNYXRoLmFzaW4oMC4zOTc5NSAqIE1hdGguY29zKHJldkFuZ2xlKSk7XG4gIC8qIGRheWxpZ2h0IGNvZWZmaWNpZW50IHNlbGVjdGVkIGZvciBhcHBhcmVudCBzdW5yaXNlL3N1bnNldCAqL1xuICBjb25zdCBwID0gMC44MzMzXG4gIGNvbnN0IGludFJlc3VsdCA9XG4gICAgKE1hdGguc2luKChwICogTWF0aC5QSSkgLyAxODApICtcbiAgICAgIE1hdGguc2luKChsYXRpdHVkZSAqIE1hdGguUEkpIC8gMTgwKSAqIE1hdGguc2luKGRlY0FuZ2xlKSkgL1xuICAgIChNYXRoLmNvcygobGF0aXR1ZGUgKiBNYXRoLlBJKSAvIDE4MCkgKiBNYXRoLmNvcyhkZWNBbmdsZSkpO1xuICBpZiAoaW50UmVzdWx0ID49IDEpIHJldHVybiAyNDtcbiAgaWYgKGludFJlc3VsdCA8PSAtMSkgcmV0dXJuIDA7XG4gIHJldHVybiAyNCAtIDI0ICogTWF0aC5hY29zKGludFJlc3VsdCkgLyBNYXRoLlBJO1xufVxueWVhckRhdGVzID0gKHllYXIpID0+IHtcbiAgY29uc3Qgc3RhcnREYXRlID0gbmV3IERhdGUoeWVhciwgMCwgMSs2MCk7XG4gIGNvbnN0IGVuZERhdGUgPSBuZXcgRGF0ZSh5ZWFyICsgMSwgMCwgMSs2MCk7XG4gIHJldHVybiBkMy50aW1lRGF5LnJhbmdlKHN0YXJ0RGF0ZSwgZW5kRGF0ZSk7XG59XG5oZWlnaHQgPSB7XG4gIGNvbnN0IFtbeDAsIHkwXSwgW3gxLCB5MV1dID0gZDMuZ2VvUGF0aChwcm9qZWN0aW9uLmZpdFdpZHRoKHdpZHRoLCBzcGhlcmUpKS5ib3VuZHMoc3BoZXJlKTtcbiAgY29uc3QgZHkgPSBNYXRoLmNlaWwoeTEgLSB5MCksIGwgPSBNYXRoLm1pbihNYXRoLmNlaWwoeDEgLSB4MCksIGR5KTtcbiAgcHJvamVjdGlvbi5zY2FsZShwcm9qZWN0aW9uLnNjYWxlKCkgKiAobCAtIDEpIC8gbCkucHJlY2lzaW9uKDAuMik7XG4gIHJldHVybiBkeTtcbn1cbnNwaGVyZSA9ICh7dHlwZTogXCJTcGhlcmVcIn0pXG5zZWxlY3RlZFByb2plY3Rpb24gPSBzZWxlY3QgPyBzZWxlY3QudmFsdWUoKSA6IGQzLmdlb0VxdWlyZWN0YW5ndWxhcigpXG5wcm9qZWN0aW9uID0ge1xuICBsZXQgcHJvaiA9IHNlbGVjdGVkUHJvamVjdGlvbjtcbiAgaWYgKHByb2oucm90YXRlKSBwcm9qLnJvdGF0ZShbLXR1cm4ybG9uZyh5YXcpLCAtdHVybjJkZWdyKHBpdGNoKSwgdHVybjJkZWdyKHJvbGwpXSk7XG4gIHJldHVybiBwcm9qO1xufVxuLy8gaHR0cHM6Ly9vYnNlcnZhYmxlaHEuY29tL0BmaWwvZDMtcHJvamVjdGlvbnNcbnByb2plY3Rpb25zID0gW1xuICB7IG5hbWU6IFwiQWlyb2NlYW5cIiwgdmFsdWU6IGQzLmdlb0Fpcm9jZWFuIH0sXG4gIHsgbmFtZTogXCJBaXJ54oCZcyBtaW5pbXVtIGVycm9yXCIsIHZhbHVlOiBkMy5nZW9BaXJ5IH0sXG4gIHsgbmFtZTogXCJBaXRvZmZcIiwgdmFsdWU6IGQzLmdlb0FpdG9mZiB9LFxuICB7IG5hbWU6IFwiQW1lcmljYW4gcG9seWNvbmljXCIsIHZhbHVlOiBkMy5nZW9Qb2x5Y29uaWMgfSxcbiAgeyBuYW1lOiBcIkFybWFkaWxsb1wiLCB2YWx1ZTogZDMuZ2VvQXJtYWRpbGxvLCBvcHRpb25zOiB7IGNsaXA6IHsgdHlwZTogXCJTcGhlcmVcIiB9IH0gfSxcbiAgeyBuYW1lOiBcIkF1Z3VzdFwiLCB2YWx1ZTogZDMuZ2VvQXVndXN0IH0sXG4gIHsgbmFtZTogXCJhemltdXRoYWwgZXF1YWwtYXJlYVwiLCB2YWx1ZTogZDMuZ2VvQXppbXV0aGFsRXF1YWxBcmVhIH0sXG4gIHsgbmFtZTogXCJhemltdXRoYWwgZXF1aWRpc3RhbnRcIiwgdmFsdWU6IGQzLmdlb0F6aW11dGhhbEVxdWlkaXN0YW50IH0sXG4gIHsgbmFtZTogXCJCYWtlciBkaW5vbWljXCIsIHZhbHVlOiBkMy5nZW9CYWtlciB9LFxuICB7IG5hbWU6IFwiQmVyZ2hhdXPigJkgc3RhclwiLCB2YWx1ZTogZDMuZ2VvQmVyZ2hhdXMsIG9wdGlvbnM6IHsgY2xpcDogeyB0eXBlOiBcIlNwaGVyZVwiIH0gfSB9LFxuICB7IG5hbWU6IFwiQmVydGlu4oCZcyAxOTUzXCIsIHZhbHVlOiBkMy5nZW9CZXJ0aW4xOTUzIH0sXG4gIHsgbmFtZTogXCJCb2dnc+KAmSBldW1vcnBoaWNcIiwgdmFsdWU6IGQzLmdlb0JvZ2dzIH0sXG4gIHsgbmFtZTogXCJCb2dnc+KAmSBldW1vcnBoaWMgKGludGVycnVwdGVkKVwiLCB2YWx1ZTogZDMuZ2VvSW50ZXJydXB0ZWRCb2dncywgb3B0aW9uczogeyBjbGlwOiB7IHR5cGU6IFwiU3BoZXJlXCIgfSB9IH0sXG4gIHsgbmFtZTogXCJCb25uZVwiLCB2YWx1ZTogZDMuZ2VvQm9ubmUgfSxcbiAgeyBuYW1lOiBcIkJvdHRvbWxleVwiLCB2YWx1ZTogZDMuZ2VvQm90dG9tbGV5IH0sXG4gIHsgbmFtZTogXCJCcm9tbGV5XCIsIHZhbHVlOiBkMy5nZW9Ccm9tbGV5IH0sXG4gIHsgbmFtZTogXCJCdXR0ZXJmbHkgKGdub21vbmljKVwiLCB2YWx1ZTogZDMuZ2VvUG9seWhlZHJhbEJ1dHRlcmZseSB9LFxuICB7IG5hbWU6IFwiQnV0dGVyZmx5IChDb2xsaWdub24pXCIsIHZhbHVlOiBkMy5nZW9Qb2x5aGVkcmFsQ29sbGlnbm9uIH0sXG4gIHsgbmFtZTogXCJCdXR0ZXJmbHkgKFdhdGVybWFuKVwiLCB2YWx1ZTogZDMuZ2VvUG9seWhlZHJhbFdhdGVybWFuIH0sXG4gIHsgbmFtZTogXCJDYWhpbGwtS2V5ZXNcIiwgdmFsdWU6IGQzLmdlb0NhaGlsbEtleWVzIH0sXG4gIHsgbmFtZTogXCJDb2xsaWdub25cIiwgdmFsdWU6IGQzLmdlb0NvbGxpZ25vbiB9LFxuICB7IG5hbWU6IFwiY29uaWMgZXF1YWwtYXJlYVwiLCB2YWx1ZTogZDMuZ2VvQ29uaWNFcXVhbEFyZWEgfSxcbiAgeyBuYW1lOiBcImNvbmljIGVxdWlkaXN0YW50XCIsIHZhbHVlOiBkMy5nZW9Db25pY0VxdWlkaXN0YW50IH0sXG4gIHsgbmFtZTogXCJDcmFpZyByZXRyb2F6aW11dGhhbFwiLCB2YWx1ZTogZDMuZ2VvQ3JhaWcgfSxcbiAgeyBuYW1lOiBcIkNyYXN0ZXIgcGFyYWJvbGljXCIsIHZhbHVlOiBkMy5nZW9DcmFzdGVyIH0sXG4gIHsgbmFtZTogXCJDb3hcIiwgdmFsdWU6IGQzLmdlb0NveCB9LFxuICB7IG5hbWU6IFwiY3ViaWNcIiwgdmFsdWU6IGQzLmdlb0N1YmljIH0sXG4gIHsgbmFtZTogXCJjeWxpbmRyaWNhbCBlcXVhbC1hcmVhXCIsIHZhbHVlOiBkMy5nZW9DeWxpbmRyaWNhbEVxdWFsQXJlYSB9LFxuICB7IG5hbWU6IFwiY3lsaW5kcmljYWwgc3RlcmVvZ3JhcGhpY1wiLCB2YWx1ZTogZDMuZ2VvQ3lsaW5kcmljYWxTdGVyZW9ncmFwaGljIH0sXG4gIHsgbmFtZTogXCJkb2RlY2FoZWRyYWxcIiwgdmFsdWU6IGQzLmdlb0RvZGVjYWhlZHJhbCB9LFxuICB7IG5hbWU6IFwiRWNrZXJ0IElcIiwgdmFsdWU6IGQzLmdlb0Vja2VydDEgfSxcbiAgeyBuYW1lOiBcIkVja2VydCBJSVwiLCB2YWx1ZTogZDMuZ2VvRWNrZXJ0MiB9LFxuICB7IG5hbWU6IFwiRWNrZXJ0IElJSVwiLCB2YWx1ZTogZDMuZ2VvRWNrZXJ0MyB9LFxuICB7IG5hbWU6IFwiRWNrZXJ0IElWXCIsIHZhbHVlOiBkMy5nZW9FY2tlcnQ0IH0sXG4gIHsgbmFtZTogXCJFY2tlcnQgVlwiLCB2YWx1ZTogZDMuZ2VvRWNrZXJ0NSB9LFxuICB7IG5hbWU6IFwiRWNrZXJ0IFZJXCIsIHZhbHVlOiBkMy5nZW9FY2tlcnQ2IH0sXG4gIHsgbmFtZTogXCJFaXNlbmxvaHIgY29uZm9ybWFsXCIsIHZhbHVlOiBkMy5nZW9FaXNlbmxvaHIgfSxcbiAgeyBuYW1lOiBcIkVxdWFsIEVhcnRoXCIsIHZhbHVlOiBkMy5nZW9FcXVhbEVhcnRoIH0sXG4gIHsgbmFtZTogXCJFcXVpcmVjdGFuZ3VsYXIgKHBsYXRlIGNhcnLDqWUpXCIsIHZhbHVlOiBkMy5nZW9FcXVpcmVjdGFuZ3VsYXIgfSxcbiAgeyBuYW1lOiBcIkZhaGV5IHBzZXVkb2N5bGluZHJpY2FsXCIsIHZhbHVlOiBkMy5nZW9GYWhleSB9LFxuICB7IG5hbWU6IFwiZmxhdC1wb2xhciBwYXJhYm9saWNcIiwgdmFsdWU6IGQzLmdlb010RmxhdFBvbGFyUGFyYWJvbGljIH0sXG4gIHsgbmFtZTogXCJmbGF0LXBvbGFyIHF1YXJ0aWNcIiwgdmFsdWU6IGQzLmdlb010RmxhdFBvbGFyUXVhcnRpYyB9LFxuICB7IG5hbWU6IFwiZmxhdC1wb2xhciBzaW51c29pZGFsXCIsIHZhbHVlOiBkMy5nZW9NdEZsYXRQb2xhclNpbnVzb2lkYWwgfSxcbiAgeyBuYW1lOiBcIkZvdWNhdXTigJlzIHN0ZXJlb2dyYXBoaWMgZXF1aXZhbGVudFwiLCB2YWx1ZTogZDMuZ2VvRm91Y2F1dCB9LFxuICB7IG5hbWU6IFwiRm91Y2F1dOKAmXMgc2ludXNvaWRhbFwiLCB2YWx1ZTogZDMuZ2VvRm91Y2F1dFNpbnVzb2lkYWwgfSxcbiAgeyBuYW1lOiBcImdlbmVyYWwgcGVyc3BlY3RpdmVcIiwgdmFsdWU6IGQzLmdlb1NhdGVsbGl0ZSB9LFxuICB7IG5hbWU6IFwiR2luZ2VyeVwiLCB2YWx1ZTogZDMuZ2VvR2luZ2VyeSwgb3B0aW9uczogeyBjbGlwOiB7IHR5cGU6IFwiU3BoZXJlXCIgfSB9IH0sXG4gIHsgbmFtZTogXCJHaW56YnVyZyBWXCIsIHZhbHVlOiBkMy5nZW9HaW56YnVyZzUgfSxcbiAgeyBuYW1lOiBcIkdpbnpidXJnIFZJXCIsIHZhbHVlOiBkMy5nZW9HaW56YnVyZzYgfSxcbiAgeyBuYW1lOiBcIkdpbnpidXJnIFZJSUlcIiwgdmFsdWU6IGQzLmdlb0dpbnpidXJnOCB9LFxuICB7IG5hbWU6IFwiR2luemJ1cmcgSVhcIiwgdmFsdWU6IGQzLmdlb0dpbnpidXJnOSB9LFxuICB7IG5hbWU6IFwiR29vZGXigJlzIGhvbW9sb3NpbmVcIiwgdmFsdWU6IGQzLmdlb0hvbW9sb3NpbmV9LFxuICB7IG5hbWU6IFwiR29vZGXigJlzIGhvbW9sb3NpbmUgKGludGVycnVwdGVkKVwiLCB2YWx1ZTogZDMuZ2VvSW50ZXJydXB0ZWRIb21vbG9zaW5lLCBvcHRpb25zOiB7IGNsaXA6IHsgdHlwZTogXCJTcGhlcmVcIiB9IH0gIH0sXG4gIHsgbmFtZTogXCJnbm9tb25pY1wiLCB2YWx1ZTogZDMuZ2VvR25vbW9uaWMgfSxcbiAgeyBuYW1lOiBcIkdyaW5nb3J0ZW4gc3F1YXJlXCIsIHZhbHVlOiBkMy5nZW9HcmluZ29ydGVuIH0sXG4gIHsgbmFtZTogXCJHcmluZ29ydGVuIHF1aW5jdW5jaWFsXCIsIHZhbHVlOiBkMy5nZW9HcmluZ29ydGVuUXVpbmN1bmNpYWwgfSxcbiAgeyBuYW1lOiBcIkd1eW91IHNxdWFyZVwiLCB2YWx1ZTogZDMuZ2VvR3V5b3UgfSxcbiAgeyBuYW1lOiBcIkhhbW1lclwiLCB2YWx1ZTogZDMuZ2VvSGFtbWVyIH0sXG4gIHsgbmFtZTogXCJIYW1tZXIgcmV0cm9hemltdXRoYWxcIiwgdmFsdWU6IGQzLmdlb0hhbW1lclJldHJvYXppbXV0aGFsLCBvcHRpb25zOiB7IGNsaXA6IHsgdHlwZTogXCJTcGhlcmVcIiB9IH0gfSxcbiAgeyBuYW1lOiBcIkhFQUxQaXhcIiwgdmFsdWU6IGQzLmdlb0hlYWxwaXgsIG9wdGlvbnM6IHsgY2xpcDogeyB0eXBlOiBcIlNwaGVyZVwiIH0gfSB9LFxuICB7IG5hbWU6IFwiSGlsbCBldWN5Y2xpY1wiLCB2YWx1ZTogZDMuZ2VvSGlsbCB9LFxuICB7IG5hbWU6IFwiSHVmbmFnZWwgcHNldWRvY3lsaW5kcmljYWxcIiwgdmFsdWU6IGQzLmdlb0h1Zm5hZ2VsIH0sXG4gIHsgbmFtZTogXCJpY29zYWhlZHJhbFwiLCB2YWx1ZTogZDMuZ2VvSWNvc2FoZWRyYWwgfSxcbiAgeyBuYW1lOiBcIkltYWdvXCIsIHZhbHVlOiBkMy5nZW9JbWFnbyB9LFxuICB7IG5hbWU6IFwiS2F2cmF5c2tpeSBWSUlcIiwgdmFsdWU6IGQzLmdlb0thdnJheXNraXk3IH0sXG4gIHsgbmFtZTogXCJMYWdyYW5nZSBjb25mb3JtYWxcIiwgdmFsdWU6IGQzLmdlb0xhZ3JhbmdlIH0sXG4gIHsgbmFtZTogXCJMYXJyaXbDqWVcIiwgdmFsdWU6IGQzLmdlb0xhcnJpdmVlIH0sXG4gIHsgbmFtZTogXCJMYXNrb3dza2kgdHJpLW9wdGltYWxcIiwgdmFsdWU6IGQzLmdlb0xhc2tvd3NraSB9LFxuICB7IG5hbWU6IFwiTG94aW11dGhhbFwiLCB2YWx1ZTogZDMuZ2VvTG94aW11dGhhbCB9LFxuICB7IG5hbWU6IFwiTWVyY2F0b3JcIiwgdmFsdWU6IGQzLmdlb01lcmNhdG9yIH0sXG4gIHsgbmFtZTogXCJNaWxsZXIgY3lsaW5kcmljYWxcIiwgdmFsdWU6IGQzLmdlb01pbGxlciB9LFxuICB7IG5hbWU6IFwiTW9sbHdlaWRlXCIsIHZhbHVlOiBkMy5nZW9Nb2xsd2VpZGUgfSxcbiAgeyBuYW1lOiBcIk1vbGx3ZWlkZSAoR29vZGXigJlzIGludGVycnVwdGVkKVwiLCB2YWx1ZTogZDMuZ2VvSW50ZXJydXB0ZWRNb2xsd2VpZGUsIG9wdGlvbnM6IHsgY2xpcDogeyB0eXBlOiBcIlNwaGVyZVwiIH0gfSB9LFxuICB7IG5hbWU6IFwiTW9sbHdlaWRlIChpbnRlcnJ1cHRlZCBoZW1pc3BoZXJlcylcIiwgdmFsdWU6IGQzLmdlb0ludGVycnVwdGVkTW9sbHdlaWRlSGVtaXNwaGVyZXMsIG9wdGlvbnM6IHsgY2xpcDogeyB0eXBlOiBcIlNwaGVyZVwiIH0gfSB9LFxuICB7IG5hbWU6IFwiTmF0dXJhbCBFYXJ0aFwiLCB2YWx1ZTogZDMuZ2VvTmF0dXJhbEVhcnRoMSB9LFxuICB7IG5hbWU6IFwiTmF0dXJhbCBFYXJ0aCBJSVwiLCB2YWx1ZTogZDMuZ2VvTmF0dXJhbEVhcnRoMiB9LFxuICB7IG5hbWU6IFwiTmVsbOKAk0hhbW1lclwiLCB2YWx1ZTogZDMuZ2VvTmVsbEhhbW1lciB9LFxuICB7IG5hbWU6IFwiTmljb2xvc2kgZ2xvYnVsYXJcIiwgdmFsdWU6IGQzLmdlb05pY29sb3NpIH0sXG4gIHsgbmFtZTogXCJvcnRob2dyYXBoaWNcIiwgdmFsdWU6IGQzLmdlb09ydGhvZ3JhcGhpYyB9LFxuICB7IG5hbWU6IFwiUGF0dGVyc29uIGN5bGluZHJpY2FsXCIsIHZhbHVlOiBkMy5nZW9QYXR0ZXJzb24gfSxcbiAgeyBuYW1lOiBcIlBlaXJjZSBxdWluY3VuY2lhbFwiLCB2YWx1ZTogZDMuZ2VvUGVpcmNlUXVpbmN1bmNpYWwgfSxcbiAgeyBuYW1lOiBcInJlY3Rhbmd1bGFyIHBvbHljb25pY1wiLCB2YWx1ZTogZDMuZ2VvUmVjdGFuZ3VsYXJQb2x5Y29uaWMgfSxcbiAgeyBuYW1lOiBcIlJvYmluc29uXCIsIHZhbHVlOiBkMy5nZW9Sb2JpbnNvbiB9LFxuICB7IG5hbWU6IFwic2ludXNvaWRhbFwiLCB2YWx1ZTogZDMuZ2VvU2ludXNvaWRhbCB9LFxuICB7IG5hbWU6IFwic2ludXNvaWRhbCAoaW50ZXJydXB0ZWQpXCIsIHZhbHVlOiBkMy5nZW9JbnRlcnJ1cHRlZFNpbnVzb2lkYWwsIG9wdGlvbnM6IHsgY2xpcDogeyB0eXBlOiBcIlNwaGVyZVwiIH0gfSB9LFxuICB7IG5hbWU6IFwic2ludS1Nb2xsd2VpZGVcIiwgdmFsdWU6IGQzLmdlb1NpbnVNb2xsd2VpZGUgfSxcbiAgeyBuYW1lOiBcInNpbnUtTW9sbHdlaWRlIChpbnRlcnJ1cHRlZClcIiwgdmFsdWU6IGQzLmdlb0ludGVycnVwdGVkU2ludU1vbGx3ZWlkZSwgb3B0aW9uczogeyBjbGlwOiB7IHR5cGU6IFwiU3BoZXJlXCIgfSB9IH0sXG4gIHsgbmFtZTogXCJzdGVyZW9ncmFwaGljXCIsIHZhbHVlOiBkMy5nZW9TdGVyZW9ncmFwaGljIH0sXG4gIHsgbmFtZTogXCJMZWXigJlzIHRldHJhaGVkYWxcIiwgdmFsdWU6IGQzLmdlb1RldHJhaGVkcmFsTGVlIH0sXG4gIHsgbmFtZTogXCJUaW1lc1wiLCB2YWx1ZTogZDMuZ2VvVGltZXMgfSxcbiAgeyBuYW1lOiBcIlRvYmxlciBoeXBlcmVsbGlwdGljYWxcIiwgdmFsdWU6IGQzLmdlb0h5cGVyZWxsaXB0aWNhbCB9LFxuICB7IG5hbWU6IFwidHJhbnN2ZXJzZSBNZXJjYXRvclwiLCB2YWx1ZTogZDMuZ2VvVHJhbnN2ZXJzZU1lcmNhdG9yIH0sXG4gIHsgbmFtZTogXCJWYW4gZGVyIEdyaW50ZW5cIiwgdmFsdWU6IGQzLmdlb1ZhbkRlckdyaW50ZW4gfSxcbiAgeyBuYW1lOiBcIlZhbiBkZXIgR3JpbnRlbiBJSVwiLCB2YWx1ZTogZDMuZ2VvVmFuRGVyR3JpbnRlbjIgfSxcbiAgeyBuYW1lOiBcIlZhbiBkZXIgR3JpbnRlbiBJSUlcIiwgdmFsdWU6IGQzLmdlb1ZhbkRlckdyaW50ZW4zIH0sXG4gIHsgbmFtZTogXCJWYW4gZGVyIEdyaW50ZW4gSVZcIiwgdmFsdWU6IGQzLmdlb1ZhbkRlckdyaW50ZW40IH0sXG4gIHsgbmFtZTogXCJXYWduZXIgSVZcIiwgdmFsdWU6IGQzLmdlb1dhZ25lcjQgfSxcbiAgeyBuYW1lOiBcIldhZ25lciBWSVwiLCB2YWx1ZTogZDMuZ2VvV2FnbmVyNiB9LFxuICB7IG5hbWU6IFwiV2FnbmVyIFZJSVwiLCB2YWx1ZTogZDMuZ2VvV2FnbmVyNyB9LFxuICB7IG5hbWU6IFwiV2VybmVyXCIsIHZhbHVlOiBkMy5nZW9Cb25uZSA/ICgpID0+IGQzLmdlb0Jvbm5lKCkucGFyYWxsZWwoOTApIDogbnVsbCB9LFxuICB7IG5hbWU6IFwiV2llY2hlbFwiLCB2YWx1ZTogZDMuZ2VvV2llY2hlbCB9LFxuICB7IG5hbWU6IFwiV2lua2VsIHRyaXBlbFwiLCB2YWx1ZTogZDMuZ2VvV2lua2VsMyB9XG5dXG5FdmVudFR5cGUgPSAoe1xuICBMb2NhdGlvbkNoYW5nZTogXCJMT0NBVElPTl9DSEFOR0VcIixcbiAgRGF0ZUhvdXJDaGFuZ2U6IFwiREFURV9IT1VSX0NIQU5HRVwiXG59KVxubWFwY29sb3JzID0gKHtcbiAgbmlnaHQ6IFwiIzcxOWZiNlwiLFxuICBkYXk6IFwiI2ZmZTQzOFwiLFxuICBncmlkOiBcIiM0YjZhNzlcIixcbiAgb2NlYW46IFwiI2FkZWVmZlwiLFxuICBsYW5kOiBcIiM5MGZmNzg4OFwiLFxuICBzdW46IFwiI2ZmYjQzOFwiXG59KVxudG9SYWRpYW5zID0gKHZhbCkgPT4gdmFsICogTWF0aC5QSSAvIDE4MFxudG9EZWdyZWVzID0gKHZhbCkgPT4gdmFsICogMTgwIC8gTWF0aC5QSTtcbmxhbmQgPSB0b3BvanNvbi5mZWF0dXJlKHdvcmxkLCB3b3JsZC5vYmplY3RzLmxhbmQpO1xuZDMgPSByZXF1aXJlKFwiZDNAN1wiLCBcImQzLWdlby1wcm9qZWN0aW9uQDNcIilcbmZ1bmN0aW9uIGlucHV0KGNvbmZpZykge1xuICBsZXQge1xuICAgIGZvcm0sXG4gICAgdHlwZSA9IFwidGV4dFwiLFxuICAgIGF0dHJpYnV0ZXMgPSB7fSxcbiAgICBhY3Rpb24sXG4gICAgZ2V0VmFsdWUsXG4gICAgdGl0bGUsXG4gICAgZGVzY3JpcHRpb24sXG4gICAgZm9ybWF0LFxuICAgIGRpc3BsYXksXG4gICAgc3VibWl0LFxuICAgIG9wdGlvbnNcbiAgfSA9IGNvbmZpZztcbiAgY29uc3Qgd3JhcHBlciA9IGh0bWxgPGRpdj48L2Rpdj5gO1xuICBpZiAoIWZvcm0pXG4gICAgZm9ybSA9IGh0bWxgPGZvcm0+XG4gIDxpbnB1dCBuYW1lPWlucHV0IHR5cGU9JHt0eXBlfSAvPlxuICA8L2Zvcm0+YDtcbiAgT2JqZWN0LmtleXMoYXR0cmlidXRlcykuZm9yRWFjaChrZXkgPT4ge1xuICAgIGNvbnN0IHZhbCA9IGF0dHJpYnV0ZXNba2V5XTtcbiAgICBpZiAodmFsICE9IG51bGwpIGZvcm0uaW5wdXQuc2V0QXR0cmlidXRlKGtleSwgdmFsKTtcbiAgfSk7XG4gIGlmIChzdWJtaXQpXG4gICAgZm9ybS5hcHBlbmQoXG4gICAgICBodG1sYDxpbnB1dCBuYW1lPXN1Ym1pdCB0eXBlPXN1Ym1pdCBzdHlsZT1cIm1hcmdpbjogMCAwLjc1ZW1cIiB2YWx1ZT1cIiR7XG4gICAgICAgIHR5cGVvZiBzdWJtaXQgPT0gXCJzdHJpbmdcIiA/IHN1Ym1pdCA6IFwiU3VibWl0XCJcbiAgICAgIH1cIiAvPmBcbiAgICApO1xuICBmb3JtLmFwcGVuZChcbiAgICBodG1sYDxvdXRwdXQgbmFtZT1vdXRwdXQgc3R5bGU9XCJmb250OiAxNHB4IE1lbmxvLCBDb25zb2xhcywgbW9ub3NwYWNlOyBtYXJnaW4tbGVmdDogMC4xZW07IHRleHQtYWxpZ246Y2VudGVyO1wiPjwvb3V0cHV0PmBcbiAgKTtcbiAgaWYgKHRpdGxlKVxuICAgIGZvcm0ucHJlcGVuZChcbiAgICAgIGh0bWxgPGRpdiBzdHlsZT1cImZvbnQ6IDcwMCAwLjlyZW0gc2Fucy1zZXJpZjsgbWFyZ2luLWJvdHRvbTogM3B4O1wiPiR7dGl0bGV9PC9kaXY+YFxuICAgICk7XG4gIGlmIChkZXNjcmlwdGlvbilcbiAgICBmb3JtLmFwcGVuZChcbiAgICAgIGh0bWxgPGRpdiBzdHlsZT1cImZvbnQtc2l6ZTogMC44NXJlbTsgZm9udC1zdHlsZTogaXRhbGljOyBtYXJnaW4tdG9wOiAzcHg7XCI+JHtkZXNjcmlwdGlvbn08L2Rpdj5gXG4gICAgKTtcbiAgaWYgKGZvcm1hdClcbiAgICBmb3JtYXQgPSB0eXBlb2YgZm9ybWF0ID09PSBcImZ1bmN0aW9uXCIgPyBmb3JtYXQgOiBkM2Zvcm1hdC5mb3JtYXQoZm9ybWF0KTtcbiAgaWYgKGFjdGlvbikge1xuICAgIGFjdGlvbihmb3JtKTtcbiAgfSBlbHNlIHtcbiAgICBjb25zdCB2ZXJiID0gc3VibWl0XG4gICAgICA/IFwib25zdWJtaXRcIlxuICAgICAgOiB0eXBlID09IFwiYnV0dG9uXCJcbiAgICAgID8gXCJvbmNsaWNrXCJcbiAgICAgIDogdHlwZSA9PSBcImNoZWNrYm94XCIgfHwgdHlwZSA9PSBcInJhZGlvXCJcbiAgICAgID8gXCJvbmNoYW5nZVwiXG4gICAgICA6IFwib25pbnB1dFwiO1xuICAgIGZvcm1bdmVyYl0gPSBlID0+IHtcbiAgICAgIGUgJiYgZS5wcmV2ZW50RGVmYXVsdCgpO1xuICAgICAgY29uc3QgdmFsdWUgPSBnZXRWYWx1ZSA/IGdldFZhbHVlKGZvcm0uaW5wdXQpIDogZm9ybS5pbnB1dC52YWx1ZTtcbiAgICAgIGlmIChmb3JtLm91dHB1dCkge1xuICAgICAgICBjb25zdCBvdXQgPSBkaXNwbGF5ID8gZGlzcGxheSh2YWx1ZSkgOiBmb3JtYXQgPyBmb3JtYXQodmFsdWUpIDogdmFsdWU7XG4gICAgICAgIGlmIChvdXQgaW5zdGFuY2VvZiB3aW5kb3cuRWxlbWVudCkge1xuICAgICAgICAgIHdoaWxlIChmb3JtLm91dHB1dC5oYXNDaGlsZE5vZGVzKCkpIHtcbiAgICAgICAgICAgIGZvcm0ub3V0cHV0LnJlbW92ZUNoaWxkKGZvcm0ub3V0cHV0Lmxhc3RDaGlsZCk7XG4gICAgICAgICAgfVxuICAgICAgICAgIGZvcm0ub3V0cHV0LmFwcGVuZChvdXQpO1xuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgIGZvcm0ub3V0cHV0LnZhbHVlID0gb3V0O1xuICAgICAgICB9XG4gICAgICB9XG4gICAgICBmb3JtLnZhbHVlID0gdmFsdWU7XG4gICAgICBpZiAodmVyYiAhPT0gXCJvbmlucHV0XCIpXG4gICAgICAgIGZvcm0uZGlzcGF0Y2hFdmVudChuZXcgQ3VzdG9tRXZlbnQoXCJpbnB1dFwiLCB7IGJ1YmJsZXM6IHRydWUgfSkpO1xuICAgIH07XG4gICAgaWYgKHZlcmIgIT09IFwib25pbnB1dFwiKVxuICAgICAgd3JhcHBlci5vbmlucHV0ID0gZSA9PiBlICYmIGUuc3RvcFByb3BhZ2F0aW9uKCkgJiYgZS5wcmV2ZW50RGVmYXVsdCgpO1xuICAgIGlmICh2ZXJiICE9PSBcIm9uc3VibWl0XCIpIGZvcm0ub25zdWJtaXQgPSBlID0+IGUgJiYgZS5wcmV2ZW50RGVmYXVsdCgpO1xuICAgIGZvcm1bdmVyYl0oKTtcbiAgfVxuICB3aGlsZSAoZm9ybS5jaGlsZE5vZGVzLmxlbmd0aCkge1xuICAgIHdyYXBwZXIuYXBwZW5kQ2hpbGQoZm9ybS5jaGlsZE5vZGVzWzBdKTtcbiAgfVxuICBmb3JtLmFwcGVuZCh3cmFwcGVyKTtcbiAgcmV0dXJuIGZvcm07XG59XG5kM2Zvcm1hdCA9IHJlcXVpcmUoXCJkMy1mb3JtYXRAMVwiKVxuLy8gaHR0cHM6Ly9vYnNlcnZhYmxlaHEuY29tL0BlbmphbG90L2RyYWdnYWJsZS13b3JsZC1tYXAtY29vcmRpbmF0ZXMtaW5wdXRcbmZ1bmN0aW9uIHdvcmxkTWFwQ29vcmRpbmF0ZXMoY29uZmlnID0ge30sIGRpbWVuc2lvbnMpIHtcbiAgY29uc3Qge1xuICAgIHZhbHVlID0gW10sIHRpdGxlLCBkZXNjcmlwdGlvbiwgd2lkdGggPSBkaW1lbnNpb25zWzBdXG4gIH0gPSBBcnJheS5pc0FycmF5KGNvbmZpZykgPyB7dmFsdWU6IGNvbmZpZ1swXX0gOiBjb25maWc7XG4gIGNvbnN0IGhlaWdodCA9IGRpbWVuc2lvbnNbMV07XG4gIGxldCBbbG9uLCBsYXRdID0gdmFsdWU7XG4gIGxvbiA9IGxvbiAhPSBudWxsID8gbG9uIDogbnVsbDtcbiAgbGF0ID0gbGF0ICE9IG51bGwgPyBsYXQgOiBudWxsO1xuICBjb25zdCBmb3JtRWwgPSBodG1sYDxmb3JtIGlkPVwiZm9ybUVsXCIgc3R5bGU9XCJ3aWR0aDogJHt3aWR0aH1weDtcIj48L2Zvcm0+YDtcbiAgY29uc3QgY29udGV4dCA9IERPTS5jb250ZXh0MmQod2lkdGgsIGhlaWdodCk7XG4gIGNvbnN0IGNhbnZhcyA9IGNvbnRleHQuY2FudmFzO1xuICBjYW52YXMuc3R5bGUubWFyZ2luID0gYDEwcHggMHB4IDBweCAwcHhgO1xuICBjb25zdCBwcm9qZWN0aW9uID0gY29uZmlnWzFdXG4gICAgLnByZWNpc2lvbigwLjEpXG4gICAgLmZpdFNpemUoW3dpZHRoLCBoZWlnaHRdLCB7IHR5cGU6IFwiU3BoZXJlXCIgfSk7XG4gIGNvbnN0IHBhdGggPSBkMy5nZW9QYXRoKHByb2plY3Rpb24sIGNvbnRleHQpLnBvaW50UmFkaXVzKDIuNSk7XG4gIGZvcm1FbC5hcHBlbmQoY2FudmFzKTtcbiAgZnVuY3Rpb24gZmlsbE1lc2goZikge1xuICAgIGNvbnRleHQuYmVnaW5QYXRoKCk7XG4gICAgcGF0aChmKTtcbiAgICBjb250ZXh0LmZpbGxTdHlsZSA9IHpvbmVjb2xvcihmLnByb3BlcnRpZXMuem9uZSk7XG4gICAgY29udGV4dC5maWxsKCk7XG4gICAgY29udGV4dC5pbm5lckhUTUwgPSBgPHRpdGxlPiR7Zi5wcm9wZXJ0aWVzLnBsYWNlc30gJHtmLnByb3BlcnRpZXMudGltZV96b25lfTwvdGl0bGU+YDtcbiAgfVxuICBmdW5jdGlvbiBkcmF3KCkge1xuICAgIGlmICghdXRjdG9nZ2xlKSB7XG4gICAgICBjb250ZXh0LmJlZ2luUGF0aCgpOyBwYXRoKHt0eXBlOiBcIlNwaGVyZVwifSk7XG4gICAgICBjb250ZXh0LmZpbGxTdHlsZSA9IHdpbmRvdy5kYXJrbW9kZSA/IFwiIzAwN0ZGRlwiIDogbWFwY29sb3JzLm9jZWFuO1xuICAgICAgY29udGV4dC5maWxsKCk7XG4gICAgICBpZiAoZ3JpZHRvZ2dsZSkge1xuICAgICAgICBkZWN6b25lcy5tYXAoKGYsIGkpID0+ICB7XG4gICAgICAgICAgY29udGV4dC5iZWdpblBhdGgoKTtcbiAgICAgICAgICBwYXRoKGYpO1xuICAgICAgICAgIGNvbnRleHQuZmlsbFN0eWxlID0gaHNsYTEwW2ldO1xuICAgICAgICAgIGNvbnRleHQuZmlsbCgpO1xuICAgICAgICB9KVxuICAgICAgfVxuICAgIH1cbiAgICBpZiAodXRjdG9nZ2xlKSB7XG4gICAgICB6b25lcy5tYXAoZiA9PiBmaWxsTWVzaChmKSlcbiAgICB9XG4gICAgY29udGV4dC5iZWdpblBhdGgoKTtcbiAgICBwYXRoKGxhbmQpO1xuICAgIGlmICghdXRjdG9nZ2xlKSB7XG4gICAgICBjb250ZXh0LmZpbGxTdHlsZSA9IHdpbmRvdy5kYXJrbW9kZSA/IFwiIzA4MDhcIiA6IG1hcGNvbG9ycy5sYW5kO1xuICAgICAgY29udGV4dC5maWxsKCk7XG4gICAgfVxuICAgIGNvbnRleHQuc3Ryb2tlU3R5bGUgPSBgIzAwMGA7XG4gICAgY29udGV4dC5zdHJva2UoKTtcbiAgICBpZiAoYm9yZGVydG9nZ2xlKSB7XG4gICAgICBjb250ZXh0LmJlZ2luUGF0aCgpO1xuICAgICAgcGF0aChib3JkZXJzKTtcbiAgICAgIGNvbnRleHQubGluZVdpZHRoID0gMS4yNTtcbiAgICAgIGNvbnRleHQuc3Ryb2tlU3R5bGUgPSB3aW5kb3cuZGFya21vZGUgPyBcIiNhYWFcIiA6IFwiIzMzM1wiO1xuICAgICAgY29udGV4dC5zdHJva2UoKTtcbiAgICB9XG4gICAgaWYgKHV0Y3RvZ2dsZSkge1xuICAgICAgY29udGV4dC5iZWdpblBhdGgoKTtcbiAgICAgIHBhdGgobWVzaCk7XG4gICAgICBjb250ZXh0LmxpbmVXaWR0aCA9IDEuMjU7XG4gICAgICBjb250ZXh0LnN0cm9rZVN0eWxlID0gYCM5OTlgO1xuICAgICAgY29udGV4dC5zdHJva2UoKTtcbiAgICB9XG4gICAgaWYgKGdyaWR0b2dnbGUpIHtcbiAgICAgIGNvbnRleHQuYmVnaW5QYXRoKCk7XG4gICAgICBwYXRoKGdyYXRpY3VsZSk7XG4gICAgICBjb250ZXh0LmxpbmVXaWR0aCA9IDEuMjU7XG4gICAgICBjb250ZXh0LnN0cm9rZVN0eWxlID0gdXRjdG9nZ2xlIHx8ICF3aW5kb3cuZGFya21vZGUgPyBcIiMwMDBcIiA6IFwiI2ZmZlwiO1xuICAgICAgY29udGV4dC5zdHJva2UoKTtcbiAgICAgIGNvbnRleHQuZmlsbFN0eWxlID0gXCIjMDAwXCI7XG4gICAgICBjb250ZXh0LmZvbnQgPSB3aWR0aCA8IDc2MCA/IFwiMTRweCBzZXJpZlwiIDogd2lkdGggPCA5OTAgPyBcIjE3cHggc2VyaWZcIiA6IFwiMjNweCBzZXJpZlwiO1xuICAgICAgZDMucmFuZ2UoLTEuNSwgMzQyICsgMSwgMzYpLm1hcCh4ID0+ICBjb250ZXh0LmZpbGxUZXh0KGxvbmcyem9uZSh4KSwgLi4ucHJvamVjdGlvbihbeCwgNTQuN10pKSk7XG4gICAgICBkMy5yYW5nZSgtMS41LCAzNDIgKyAxLCAzNikubWFwKHggPT4gIGNvbnRleHQuZmlsbFRleHQobG9uZzJ6b25lKHgpLCAuLi5wcm9qZWN0aW9uKFt4LCAtNTkuN10pKSk7XG4gICAgICAvLyBjb250ZXh0LmZvbnQgPSB3aWR0aCA8IDc2MCA/IFwiMTJweCBzZXJpZlwiIDogXCIyMXB4IHNlcmlmXCI7XG4gICAgICAvLyBjb250ZXh0LmZpbGxTdHlsZSA9IGAjMDAwYDtcbiAgICAgIC8vIGQzLnJhbmdlKC0xLjUsIDM0MiArIDEsIDM2KS5tYXAoeCA9PiAgY29udGV4dC5maWxsVGV4dChsb25nMnpvbmUoeCksIC4uLnByb2plY3Rpb24oW3gsIDI3LjVdKSkpO1xuICAgICAgLy8gZDMucmFuZ2UoLTEuNSwgMzQyICsgMSwgMzYpLm1hcCh4ID0+ICBjb250ZXh0LmZpbGxUZXh0KGxvbmcyem9uZSh4KSwgLi4ucHJvamVjdGlvbihbeCwgLTQ4XSkpKTtcbiAgICAgIC8vIGQzLnJhbmdlKC0xOCwgMzM2ICsgMSwgMzYpLm1hcCh4ID0+IGNvbnRleHQuZmlsbFRleHQoZm9ybWF0TG9uZ2l0dWRlKHgpLCAuLi5wcm9qZWN0aW9uKFt4LCA5MF0pKSk7XG4gICAgICAvLyBkMy5yYW5nZSgtMTgsIDMzNiArIDEsIDM2KS5tYXAoeCA9PiBjb250ZXh0LmZpbGxUZXh0KGZvcm1hdExvbmdpdHVkZSh4KSwgLi4ucHJvamVjdGlvbihbeCwgLTkwXSkpKTtcbiAgICB9XG4gICAgaWYgKHN1bnRvZ2dsZSkge1xuICAgICAgY29udGV4dC5iZWdpblBhdGgoKTtcbiAgICAgIHBhdGgobmlnaHQpO1xuICAgICAgY29udGV4dC5maWxsU3R5bGUgPSBcInJnYmEoMCwwLDI1NSwwLjMpXCI7XG4gICAgICBjb250ZXh0LmZpbGwoKTtcbiAgICAgIGNvbnRleHQuYmVnaW5QYXRoKCk7XG4gICAgICBwYXRoLnBvaW50UmFkaXVzKHdpZHRoIC8gODQgKyA1KTtcbiAgICAgIHBhdGgoe3R5cGU6IFwiUG9pbnRcIiwgY29vcmRpbmF0ZXM6IHN1bn0pO1xuICAgICAgY29udGV4dC5zdHJva2VTdHlsZSA9IFwiIzAwMDlcIjtcbiAgICAgIGNvbnRleHQuZmlsbFN0eWxlID0gXCIjZmYwYlwiO1xuICAgICAgY29udGV4dC5saW5lV2lkdGggPSAxO1xuICAgICAgY29udGV4dC5zdHJva2UoKTtcbiAgICAgIGNvbnRleHQuZmlsbCgpO1xuICAgIH1cbiAgICBpZiAobG9uICE9IG51bGwgJiYgbGF0ICE9IG51bGwpIHtcbiAgICAgIHBhdGgucG9pbnRSYWRpdXMoMTcpOyBjb250ZXh0LnN0cm9rZVN0eWxlID0gXCJibGFja1wiO1xuICAgICAgY29udGV4dC5iZWdpblBhdGgoKTsgcGF0aCh7dHlwZTogXCJQb2ludFwiLCBjb29yZGluYXRlczogW2xvbiwgbGF0XX0pOyBjb250ZXh0LmxpbmVXaWR0aCA9IDE7IGNvbnRleHQuc3Ryb2tlKCk7XG4gICAgICBjb250ZXh0LmxpbmVXaWR0aCA9IDY7XG4gICAgICBwYXRoLnBvaW50UmFkaXVzKDE0KTsgY29udGV4dC5zdHJva2VTdHlsZSA9IFwicmVkXCI7XG4gICAgICBjb250ZXh0LmJlZ2luUGF0aCgpOyBwYXRoKHt0eXBlOiBcIlBvaW50XCIsIGNvb3JkaW5hdGVzOiBbbG9uLCBsYXRdfSk7IGNvbnRleHQuc3Ryb2tlKCk7XG4gICAgICBjb250ZXh0LmxpbmVXaWR0aCA9IDE7XG4gICAgfVxuICB9XG4gIGxldCBkcmFnID0gZDMuZHJhZygpXG4gICAgLm9uKFwiZHJhZ1wiLCAoZXZlbnQpID0+IHtcbiAgICAgIGxldCBjb29yZHMgPSBwcm9qZWN0aW9uLmludmVydChbZXZlbnQueCwgZXZlbnQueV0pO1xuICAgICAgbG9uID0gK2Nvb3Jkc1swXS50b0ZpeGVkKDIpO1xuICAgICAgbGF0ID0gK2Nvb3Jkc1sxXS50b0ZpeGVkKDIpO1xuICAgICAgZHJhdygpO1xuICAgICAgY2FudmFzLmRpc3BhdGNoRXZlbnQobmV3IEN1c3RvbUV2ZW50KFwiaW5wdXRcIiwgeyBidWJibGVzOiB0cnVlIH0pKTtcbiAgICB9KVxuICBkMy5zZWxlY3QoY2FudmFzKS5jYWxsKGRyYWcpXG4gIGNhbnZhcy5vbmNsaWNrID0gZnVuY3Rpb24oZXYpIHtcbiAgICBjb25zdCB7IG9mZnNldFgsIG9mZnNldFkgfSA9IGV2O1xuICAgIGxldCBjb29yZHMgPSBwcm9qZWN0aW9uLmludmVydChbb2Zmc2V0WCwgb2Zmc2V0WV0pO1xuICAgIGxvbiA9ICtjb29yZHNbMF0udG9GaXhlZCgyKTtcbiAgICBsYXQgPSArY29vcmRzWzFdLnRvRml4ZWQoMik7XG4gICAgZHJhdygpO1xuICAgIGNhbnZhcy5kaXNwYXRjaEV2ZW50KG5ldyBDdXN0b21FdmVudChcImlucHV0XCIsIHsgYnViYmxlczogdHJ1ZSB9KSk7XG4gIH07XG4gIGRyYXcoKTtcbiAgZnVuY3Rpb24gcmVzZXRsYXRsb24oKSB7XG4gICAgbG9uID0gMTYwO1xuICAgIGxhdCA9IDA7XG4gICAgc2V0KHZpZXdvZiBib3JkZXJ0b2dnbGUsIGZhbHNlKTtcbiAgICBzZXQodmlld29mIGdyaWR0b2dnbGUsIGZhbHNlKTtcbiAgICBzZXQodmlld29mIHN1bnRvZ2dsZSwgZmFsc2UpO1xuICAgIHNldCh2aWV3b2YgdXRjdG9nZ2xlLCBmYWxzZSk7XG4gICAgc2V0KHZpZXdvZiB5YXcsIDUwMCk7XG4gICAgc2V0KHZpZXdvZiBwaXRjaCwgMCk7XG4gICAgc2V0KHZpZXdvZiByb2xsLCAwKTtcbiAgICBzZXQodmlld29mIHNlbGVjdCwgcHJvamVjdGlvbnMuZmluZCh0ID0+IHQubmFtZSA9PT0gXCJFcXVpcmVjdGFuZ3VsYXIgKHBsYXRlIGNhcnLDqWUpXCIpKTtcbiAgICBkcmF3KGxvbiwgbGF0KTtcbiAgICBjYW52YXMuZGlzcGF0Y2hFdmVudChuZXcgQ3VzdG9tRXZlbnQoXCJpbnB1dFwiLCB7IGJ1YmJsZXM6IHRydWUgfSkpO1xuICB9XG4gIHJzdGJ0bi5vbignY2xpY2snLCByZXNldGxhdGxvbik7XG4gIGNvbnN0IGZvcm0gPSBpbnB1dCh7XG4gICAgdHlwZTogXCJ3b3JsZE1hcENvb3JkaW5hdGVzXCIsXG4gICAgdGl0bGUsXG4gICAgZGVzY3JpcHRpb24sXG4gICAgZGlzcGxheTogdiA9PiAod2lkdGggPiAzMDApID8gaHRtbGA8ZGl2IHN0eWxlPVwid2lkdGg6ICR7d2lkdGh9cHg7IHBvaW50ZXItZXZlbnRzOiBub25lOyB3aGl0ZS1zcGFjZTogbm93cmFwOyBjb2xvcjogd2luZG93LmRhcmttb2RlID8gI2ZmZiA6ICMwMDA7IHRleHQtYWxpZ246IGNlbnRlcjsgZm9udDogJHt3aWR0aCA+IDEwMDAgPyB3aWR0aCAvIDUwIDogd2lkdGggLyA0MH1weCBtb25vc3BhY2U7IHBvc2l0aW9uOiByZWxhdGl2ZTsgdG9wOiAkey0yOCAtIHdpZHRoIC8gMjV9cHg7ICBtYXJnaW4tYm90dG9tOiAtLjRlbTtcIj5cbiAgICAgICAgICAgIDxzcGFuIHN0eWxlPVwiY29sb3I6IHdpbmRvdy5kYXJrbW9kZSA/ICNmZmYgOiAjMDAwO1wiPlpvbmU6PC9zcGFuPiAke2xvbiAhPSBudWxsID8gbG9uZzJ6b25lKGxvbikgOiBcIlwifVxuICAgICAgICAgICAgJm5ic3A7ICZuYnNwO1xuICAgICAgICAgICAgPHNwYW4gc3R5bGU9XCJjb2xvcjogd2luZG93LmRhcmttb2RlID8gI2ZmZiA6ICMwMDA7XCI+TG9uZ2l0dWRlOjwvc3Bhbj4gJHtsb24gIT0gbnVsbCA/IChsb25nMnR1cm4obG9uKSkudG9GaXhlZCgwKSA6IFwiXCJ9XG4gICAgICAgICAgICAmbmJzcDsgJm5ic3A7XG4gICAgICAgICAgICA8c3BhbiBzdHlsZT1cImNvbG9yOiB3aW5kb3cuZGFya21vZGUgPyAjZmZmIDogIzAwMDtcIj5MYXRpdHVkZTo8L3NwYW4+ICR7bGF0ICE9IG51bGwgPyAobGF0aTJ0dXJuKGxhdCkpLnRvRml4ZWQoMCkgOiBcIlwifVxuICAgICAgICAgIDwvZGl2PmAgOiAnJyxcbiAgICBnZXRWYWx1ZTogKCkgPT4gW2xvbiAhPSBudWxsID8gbG9uIDogbnVsbCwgbGF0ICE9IG51bGwgPyBsYXQgOiBudWxsXSxcbiAgICBmb3JtOiBmb3JtRWxcbiAgfSk7XG4gIHJldHVybiBmb3JtO1xufVxud2luZG93LmRhcmttb2RlID0gZG9jdW1lbnQuZ2V0RWxlbWVudHNCeVRhZ05hbWUoXCJib2R5XCIpWzBdLmNsYXNzTmFtZS5tYXRjaCgvcXVhcnRvLWRhcmsvKSA/IHRydWUgOiBmYWxzZTtcbmRvY3VtZW50LmdldEVsZW1lbnRzQnlDbGFzc05hbWUoXCJxdWFydG8tY29sb3Itc2NoZW1lLXRvZ2dsZVwiKVswXS5vbmNsaWNrID0gZnVuY3Rpb24gKGUpIHtcbiAgd2luZG93LnF1YXJ0b1RvZ2dsZUNvbG9yU2NoZW1lKCk7XG4gIHdpbmRvdy5kYXJrbW9kZSA9IGRvY3VtZW50LmdldEVsZW1lbnRzQnlUYWdOYW1lKFwiYm9keVwiKVswXS5jbGFzc05hbWUubWF0Y2goL3F1YXJ0by1kYXJrLykgPyB0cnVlIDogZmFsc2U7XG4gIHdvcmxkTWFwQ29vcmRpbmF0ZXMuZHJhdygpO1xuICBhcHAuZHJhd0VhcnRoKCk7XG4gIHJldHVybiBmYWxzZTtcbn07XG5zdW4gPSB7XG4gIGNvbnN0IG5vdyA9IG5ldyBEYXRlO1xuICBjb25zdCBkYXkgPSBuZXcgRGF0ZSgrbm93KS5zZXRVVENIb3VycygwLCAwLCAwLCAwKTtcbiAgY29uc3QgdCA9IHNvbGFyLmNlbnR1cnkobm93KTtcbiAgY29uc3QgbG9uZ2l0dWRlID0gKGRheSAtIG5vdykgLyA4NjRlNSAqIDM2MCAtIDE4MDtcbiAgcmV0dXJuIFtsb25naXR1ZGUgLSBzb2xhci5lcXVhdGlvbk9mVGltZSh0KSAvIDQsIHNvbGFyLmRlY2xpbmF0aW9uKHQpXTtcbn1cbm5pZ2h0ID0gZDMuZ2VvQ2lyY2xlKClcbiAgICAucmFkaXVzKDkwKVxuICAgIC5jZW50ZXIoYW50aXBvZGUoc3VuKSlcbiAgKClcbmFudGlwb2RlID0gKFtsb25naXR1ZGUsIGxhdGl0dWRlXSkgPT4gW2xvbmdpdHVkZSArIDE4MCwgLWxhdGl0dWRlXVxuc29sYXIgPSByZXF1aXJlKFwic29sYXItY2FsY3VsYXRvckAwLjMvZGlzdC9zb2xhci1jYWxjdWxhdG9yLm1pbi5qc1wiKVxudmlld29mIGZhbmN5U2Vjb25kc09GRiA9IElucHV0cy50b2dnbGUoe1xuICBsYWJlbDogXCJUaWNraW5nIGNsb2NrXCIsXG4gIHZhbHVlOiB0cnVlLFxufSlcbmZ1bmN0aW9uIHNldFN0eWxlKGNvbnRlbnQsIHN0eWxlID0ge30pIHtcbiAgZnVuY3Rpb24geWlxKGNvbG9yKSB7XG4gICAgY29uc3Qge3IsIGcsIGJ9ID0gZDMucmdiKGNvbG9yKTtcbiAgICByZXR1cm4gKHIgKiAyOTkgKyBnICogNTg3ICsgYiAqIDExNCkgLyAxMDAwIC8gMjU1OyAvLyByZXR1cm5zIHZhbHVlcyBiZXR3ZWVuIDAgYW5kIDFcbiAgfVxuICBjb25zdCB7XG4gICAgYmFja2dyb3VuZCxcbiAgICBjb2xvciA9IHlpcShiYWNrZ3JvdW5kKSA+PSAwLjYgPyBcIiMxMTFcIiA6IFwid2hpdGVcIixcbiAgICBwYWRkaW5nID0gXCIwIDFweFwiLFxuICAgIGJvcmRlclJhZGl1cyA9IFwiNHB4XCIsXG4gICAgZm9udFdlaWdodCA9IDkwMCxcbiAgICBmb250U2l6ZSA9IFwiMWVtXCIsXG4gICAgLi4ucmVzdFxuICB9ID0gdHlwZW9mIHN0eWxlID09PSBcInN0cmluZ1wiID8ge2JhY2tncm91bmQ6IHN0eWxlfSA6IHN0eWxlO1xuICByZXR1cm4gaHRsLmh0bWxgPHNwYW4gc3R5bGU9JHt7XG4gICAgYmFja2dyb3VuZCxcbiAgICBjb2xvcixcbiAgICBwYWRkaW5nLFxuICAgIGJvcmRlclJhZGl1cyxcbiAgICBmb250V2VpZ2h0LFxuICAgIC4uLnJlc3RcbiAgfX0+JHtjb250ZW50fTwvc3Bhbj5gO1xufVxuZnVuY3Rpb24geWlxKGNvbG9yKSB7XG4gIGNvbnN0IHtyLCBnLCBifSA9IGQzLnJnYihjb2xvcik7XG4gIHJldHVybiAociAqIDI5OSArIGcgKiA1ODcgKyBiICogMTE0KSAvIDEwMDAgLyAyNTU7IC8vIHJldHVybnMgdmFsdWVzIGJldHdlZW4gMCBhbmQgMVxufVxuZnVuY3Rpb24gdGV4dGNvbG9yKGNvbnRlbnQsIHN0eWxlID0ge30pIHtcbiAgY29uc3Qge1xuICAgIGJhY2tncm91bmQsXG4gICAgY29sb3IgPSB5aXEoYmFja2dyb3VuZCkgPiAwLjUxID8gXCIjMDAwXCIgOiBcIndoaXRlXCIsXG4gICAgcGFkZGluZyA9IFwiMCA1cHhcIixcbiAgICBib3JkZXJSYWRpdXMgPSBcIjRweFwiLFxuICAgIGZvbnRXZWlnaHQgPSA0MDAsXG4gICAgZm9udEZhbWlseSA9IFwibW9ub3NwYWNlXCIsXG4gICAgLi4ucmVzdFxuICB9ID0gdHlwZW9mIHN0eWxlID09PSBcInN0cmluZ1wiID8ge2JhY2tncm91bmQ6IHN0eWxlfSA6IHN0eWxlO1xuICByZXR1cm4gaHRsLmh0bWxgPHNwYW4gc3R5bGU9JHt7XG4gICAgYmFja2dyb3VuZCxcbiAgICBjb2xvcixcbiAgICBwYWRkaW5nLFxuICAgIGJvcmRlclJhZGl1cyxcbiAgICBmb250V2VpZ2h0LFxuICAgIGZvbnRGYW1pbHksXG4gICAgLi4ucmVzdFxuICB9fT4ke2NvbnRlbnR9PC9zcGFuPmA7XG59XG5mdW5jdGlvbiBpc0xlYXBZZWFyKHkpIHtcbiAgeSArPSAxO1xuICByZXR1cm4geSAlIDQgPT0gMCAmJiB5ICUgMTAwICE9IDAgfHwgeSAlIDQwMCA9PSAwO1xufVxuZWxhcHNlZCA9IHtcbiAgbGV0IGkgPSAwO1xuICB3aGlsZSAodHJ1ZSkge1xuICAgIHlpZWxkIFByb21pc2VzLnRpY2soODY0LCArK2kpO1xuICB9XG59XG5waWVjZXdpc2VDb2xvciA9IGQzLnBpZWNld2lzZShkMy5pbnRlcnBvbGF0ZVJnYiwgW1xuICBcIiNmMDBcIiwgICAgLy8gIDAgICAwIHJlZFxuICBcIiNmNTBcIiwgICAgLy8gIDAuMjUgIDIwIHlyXG4gIFwiI2Y2MFwiLCAgICAvLyAgMC41ICAgMjQgeXIgb3JhbmdlcmVkXG4gIFwiI2Y3MFwiLCAgICAvLyAgMC43NSAgMjggeXJcbiAgXCIjZjkwXCIsICAgIC8vICAxICAgICAzNiB5ciBvcmFuZ2VcbiAgXCIjZmIwXCIsICAgIC8vICAxLjI1ICA0NCB5clxuICBcIiNmYzBcIiwgICAgLy8gIDEuNSAgIDQ4IHlyIHllbGxvd29yYW5nZVxuICBcIiNmZDBcIiwgICAgLy8gIDEuNzUgIDUyIHlyXG4gIFwiI2ZmMFwiLCAgICAvLyAgMiAgICAgNjAgeWVsbG93XG4gIFwiI2VmMFwiLCAgICAvLyAgMi4yNSAgNjQgZ3lcbiAgXCIjZGYwXCIsICAgIC8vICAyLjUgICA2OCBneSBsaW1leWVsbG93XG4gIFwiI2NmMFwiLCAgICAvLyAgMi43NSAgNzIgZ3lcbiAgXCIjYWYwXCIsICAgIC8vICAzICAgICA4MCBneSBsaW1lXG4gIFwiIzhmMFwiLCAgICAvLyAgMy4yNSAgODggZ3lcbiAgXCIjN2YwXCIsICAgIC8vICAzLjUgICA5MiBneSBncmVlbmxpbWVcbiAgXCIjNmYwXCIsICAgIC8vICAzLjc1ICA5NiBneVxuICBcIiMwZjBcIiwgICAgLy8gIDQgICAgMTIwIGdyZWVuXG4gIFwiIzBmN1wiLCAgICAvLyAgNC4yNSAxNDggY2dcbiAgXCIjMGY5XCIsICAgIC8vICA0LjUgIDE1NiBjZyBjeWFuZ3JlZW5cbiAgXCIjMGZiXCIsICAgIC8vICA0Ljc1IDE2NCBjZ1xuICBcIiMwZmZcIiwgICAgLy8gIDUgICAgMTgwIGN5YW5cbiAgXCIjMGNmXCIsICAgIC8vICA1LjI1IDE5MiBiY1xuICBcIiMwYmZcIiwgICAgLy8gIDUuNSAgMTk2IGJjIGF6dXJlY3lhblxuICBcIiMwYWZcIiwgICAgLy8gIDUuNzUgMjAwIGJjXG4gIFwiIzA4ZlwiLCAgICAvLyAgNiAgICAyMDggYmMgYXp1cmVcbiAgXCIjMDZmXCIsICAgIC8vICA2LjI1IDIxNiBiY1xuICBcIiMwNWZcIiwgICAgLy8gIDYuNSAgMjIwIGJjIGJsdWVhenVyZVxuICBcIiMwNGZcIiwgICAgLy8gIDYuNzUgMjI0IGJjXG4gIFwiIzAwZlwiLCAgICAvLyAgNyAgICAyNDAgYmx1ZVxuICBcIiM1MGZcIiwgICAgLy8gIDcuMjUgMjYwIG1iXG4gIFwiIzYwZlwiLCAgICAvLyAgNy41ICAyNjQgbWIgcHVycGxlYmx1ZVxuICBcIiM3MGZcIiwgICAgLy8gIDcuNzUgMjY4IG1iXG4gIFwiIzkwZlwiLCAgICAvLyAgOCAgICAyNzYgbWIgcHVycGxlXG4gIFwiI2IwZlwiLCAgICAvLyAgOC4yNSAyODQgbWJcbiAgXCIjYzBmXCIsICAgIC8vICA4LjUgIDI4OCBtYiB2aW9sZXRwdXJwbGVcbiAgXCIjZDBmXCIsICAgIC8vICA4Ljc1IDI5MiBtYlxuICBcIiNmMGZcIiwgICAgLy8gIDkgICAgMzAwIG1hZ2VudGFcbiAgXCIjZjBhXCIsICAgIC8vICA5LjI1IDMyMCBybVxuICBcIiNmMDhcIiwgICAgLy8gIDkuNSAgMzI4IHJtXG4gIFwiI2YwNlwiLCAgICAvLyAgOS43NSAzMzYgcm1cbiAgXCIjZjAwXCIsICAgIC8vICAwICAgICAgICAwIHJlZFxuXSlcbnNsU3RyID0gYCwgMTAwJSwgNTAlKWBcbmVsYVRpbWUgPSBlbGFwc2VkICUgMWU1XG5lbGFUaW1lSHNsID0gdGV4dGNvbG9yKGVsYVRpbWUsIGBoc2woJHtkMy5oc2wocGllY2V3aXNlQ29sb3IoZWxhVGltZSAlIDEwMDAgLyAxMDAwKSkuaH1gICsgc2xTdHIpXG5kZWNNb3R5ID0gTWF0aC5mbG9vcigoNSAqIGRlY0RhdGUgKyAyKSAvIDE1Mylcbmlzb1llYXIgPSBkZWNZZWFyICsgKGRlY01vdHkgPiA5KVxubW9udGggPSBkZWNNb3R5IDwgMTAgPyBkZWNNb3R5ICsgMyA6IGRlY01vdHkgLSA5XG5kZWNIb3VyID0gZGVjVGltZSAqIDI0XG5kZWNNaW51dGUgPSAoZGVjSG91ciAlIDEpICogNjBcbmRlY1NlY29uZCA9IChkZWNNaW51dGUgJSAxKSAqIDYwXG5pc29Ib3VyID0gTWF0aC5mbG9vcihkZWNIb3VyKVxuaXNvTWludXRlID0gTWF0aC5mbG9vcihkZWNNaW51dGUpXG5pc29TZWNvbmQgPSBNYXRoLmZsb29yKGRlY1NlY29uZClcbmRlY0RlayA9IE1hdGguZmxvb3IoZGVjRGF0ZSAvIDEwKVxuZGVjRG9kID0gZGVjRGF0ZSAlIDEwXG5kZWNEb3RtID0gTWF0aC5mbG9vcihkZWNEYXRlIC0gKDE1MyAqIGRlY01vdHkgKyAyKSAvIDUgKyAxKVxuc2VsRG90ZSA9IHVuaXgyZG90ZShzZWxlY3RlZERhdGUuZ2V0VGltZSgpIC0gODY0MDAwMDAsIDApXG5zZWxEYXRlID0gTWF0aC5mbG9vcihkb3RlMmRhdGUoLi4uc2VsRG90ZSlbMV0pXG5zZWxUaW1lID0gc2VsZWN0ZWRIb3VyIC8gMjRcbnNlbFRpbWVPbmUgPSBzZWxUaW1lICUgMVxuc2VsVGltZVRlbiA9IHNlbFRpbWUgKiAxMCAlIDEwXG5zZWxZZGEgPSBzZWxEYXRlICsgc2VsVGltZVxuc2VsTGF0aSA9IGxhdGkydHVybihsb2NhdGlvblsxXSlcbmRlY0RvZEhzbCA9IHRleHRjb2xvcihkZWNEb2QsIGQzLmNvbG9yKHBpZWNld2lzZUNvbG9yKGRlY0RvZCAvIDEwKSkuZm9ybWF0SGV4KCkpXG5kZWNEYXRlSHNsID0gdGV4dGNvbG9yKGRlY0RhdGUudG9TdHJpbmcoKS5wYWRTdGFydCgzLCBcIjBcIiksIGQzLmNvbG9yKHBpZWNld2lzZUNvbG9yKGRlY0RhdGUgLyAoMzY1ICsgaXNMZWFwWWVhcihkZWNZZWFyKSkpKS5mb3JtYXRIZXgoKSlcbmRlY1RpbWVIc2wgPSB0ZXh0Y29sb3IoZGVjVGltZSwgZDMuY29sb3IocGllY2V3aXNlQ29sb3IoZGVjVGltZSAvIDEwKSkuZm9ybWF0SGV4KCkpXG5zZWxEYXRlSHNsID0gdGV4dGNvbG9yKHNlbERhdGUudG9TdHJpbmcoKS5wYWRTdGFydCgzLCBcIjBcIiksIGQzLmNvbG9yKHBpZWNld2lzZUNvbG9yKHNlbERhdGUgLyAzNjUpKS5mb3JtYXRIZXgoKSlcbnNlbExhdGlIc2wgPSB0ZXh0Y29sb3Ioc2VsTGF0aS50b0ZpeGVkKDApLCBkMy5jb2xvcihwaWVjZXdpc2VDb2xvcigoc2VsTGF0aSArIDI1MCkgJSAyNTAgLyAyNTApKS5mb3JtYXRIZXgoKSlcbnNlbFRpbWVEYXkgPSB0ZXh0Y29sb3Ioc2VsVGltZU9uZS50b0ZpeGVkKDMpLnNsaWNlKDIpLCBkMy5jb2xvcihwaWVjZXdpc2VDb2xvcihzZWxUaW1lKSkuZm9ybWF0SGV4KCkpXG5zZWxUaW1lSHNsMCA9IHRleHRjb2xvcihzZWxUaW1lVGVuLnRvRml4ZWQoNCksIGQzLmNvbG9yKHBpZWNld2lzZUNvbG9yKHNlbFRpbWUpKS5mb3JtYXRIZXgoKSlcbnNlbFRpbWVIc2wxID0gdGV4dGNvbG9yKHNlbFRpbWVUZW4udG9GaXhlZCg0KSwgZDMuY29sb3IocGllY2V3aXNlQ29sb3Ioc2VsVGltZSkpLmZvcm1hdEhleCgpKVxuc2VsWm9uZUhzbCA9IHRleHRjb2xvcihzZWxlY3RlZFpvbmUsIGQzLmNvbG9yKHBpZWNld2lzZUNvbG9yKHNlbGVjdGVkWm9uZSAvIDEwKSkuZm9ybWF0SGV4KCkpXG5zZWxZZGFEYXkgPSB0ZXh0Y29sb3Ioc2VsWWRhLnRvRml4ZWQoMykucGFkU3RhcnQoNiwgXCIwXCIpLCBkMy5jb2xvcihwaWVjZXdpc2VDb2xvcihzZWxZZGEgLyAzNjUpKS5mb3JtYXRIZXgoKSlcbnNlbFlkYURlYyA9IHRleHRjb2xvcigoc2VsWWRhICogMTApLnRvRml4ZWQoNCkucGFkU3RhcnQoOSwgXCIwXCIpLCBkMy5jb2xvcihwaWVjZXdpc2VDb2xvcihzZWxZZGEgLyAzNjUpKS5mb3JtYXRIZXgoKSlcbmRlY1pvbmVIc2wgPSB0ZXh0Y29sb3Ioc2VsZWN0ZWRab25lLCBkMy5jb2xvcihwaWVjZXdpc2VDb2xvcihzZWxlY3RlZFpvbmUgLyAxMCkpLmZvcm1hdEhleCgpKVxudmlld29mIHNlbGVjdGVkRGF0ZSA9IElucHV0cy5pbnB1dChuZXcgRGF0ZSgyMDIyLCBuZXcgRGF0ZSgpLmdldE1vbnRoKCksIG5ldyBEYXRlKCkuZ2V0RGF0ZSgpLCBuZXcgRGF0ZSgpLmdldEhvdXJzKCkpKVxudmlld29mIHNlbGVjdGVkSG91ciA9IElucHV0cy5pbnB1dChuZXcgRGF0ZSgyMDIyLCBuZXcgRGF0ZSgpLmdldE1vbnRoKCksIG5ldyBEYXRlKCkuZ2V0RGF0ZSgpLCBuZXcgRGF0ZSgpLmdldEhvdXJzKCkpLmdldEhvdXJzKCkpXG5mdW5jdGlvbiBzZXQoaW5wdXQsIHZhbHVlKSB7XG4gIGlucHV0LnZhbHVlID0gdmFsdWU7XG4gIGlucHV0LmRpc3BhdGNoRXZlbnQobmV3IEV2ZW50KFwiaW5wdXRcIiwge2J1YmJsZXM6IHRydWV9KSk7XG59XG5oRDEyMSA9IGQzLmhzbChwaWVjZXdpc2VDb2xvcigxMjEgLyAzNjUpKS5oXG5oRDI2OCA9IGQzLmhzbChwaWVjZXdpc2VDb2xvcigyNjggLyAzNjUpKS5oXG5oRDMwNSA9IGQzLmhzbChwaWVjZXdpc2VDb2xvcigzMDUgLyAzNjUpKS5oXG5oRDMwNiA9IGQzLmhzbChwaWVjZXdpc2VDb2xvcigzMDYgLyAzNjUpKS5oXG5oMWJ5MzIwID0gZDMuaHNsKHBpZWNld2lzZUNvbG9yKDEgLyAzMjApKS5oXG5oMWJ5ODY0MCA9IGQzLmhzbChwaWVjZXdpc2VDb2xvcigxIC8gODY0MCkpLmhcbmh1ZXMgPSBPYmplY3QuZnJvbUVudHJpZXMoW1xuICAuMDA4MyxcbiAgLjAxNjYsXG4gIC4wMjI5LFxuICAuMDI1LFxuICAuMjg3LFxuICAuMDMzMyxcbiAgLjA0MTYsXG4gIC4wNSxcbiAgLjEyNSxcbiAgLjMzMyxcbiAgLjM3NSxcbiAgLjQyOSxcbiAgLjUzMyxcbiAgLjk2OSxcbiAgLjk5OSxcbiAgXS5tYXAoaSA9PiBbaSwgZDMuaHNsKHBpZWNld2lzZUNvbG9yKGkpKS5oXSlcbik7XG4vLyBodHRwczovL29ic2VydmFibGVocS5jb20vQG1hdHRkenVnYW4vcG9wdWxhdGlvbi1ieS10aW1lLXpvbmUtY3JlYXRpbmctYS1kYXRhc2V0XG5wb3B1bGF0aW9uQnlUaW1lWm9uZSA9IEZpbGVBdHRhY2htZW50KFwiLi4vLi4vYXNzZXQvcG9wdWxhdGlvbkJ5VGltZVpvbmUuanNvblwiKS5qc29uKCk7XG5zb3J0ZWRQb3AgPSBwb3B1bGF0aW9uQnlUaW1lWm9uZS5zb3J0KFxuICAoYSwgYikgPT4gc29ydFBhcmFtc1sxXSA/IHNvcnRGdW5jKGEubnVtYmVyLCBiLm51bWJlcikgOiBzb3J0RnVuYyhhLnBvcCwgYi5wb3ApXG4pXG5zb3J0RnVuYyA9IHNvcnRQYXJhbXNbMF0gPyBkMy5hc2NlbmRpbmcgOiBkMy5kZXNjZW5kaW5nXG5wb3BCeVNpZ24gPSBkMy5yb2xsdXAoc29ydGVkUG9wLCB2ID0+IGQzLnN1bSh2LCBkID0+IGQucG9wIC8gMWU5KSwgZCA9PiBkLlNpZ24pXG50b3RhbFBvcCA9IGQzLnN1bShzb3J0ZWRQb3AsIGQgPT4gZC5wb3AgLyAxZTkpXG51dGNPZmZzZXRNID0gLShuZXcgRGF0ZSkuZ2V0VGltZXpvbmVPZmZzZXQoKVxudXRjT2Zmc2V0RCA9IHV0Y09mZnNldE0gLyAxNDRcbnV0Y09mZnNldFAgPSAodXRjT2Zmc2V0RCArIDEwKSAlIDEwXG5kZWNab25lID0geWR6WzJdXG5kZWNab25lUG9zID0gKGRlY1pvbmUgKyAxMCkgJSAxMFxudXRjT2ZmRGlmZiA9IHBhcnNlRmxvYXQoKE1hdGgucm91bmQodXRjT2Zmc2V0RCkgLSB1dGNPZmZzZXREKS50b0ZpeGVkKDIpKVxudXRjT2ZmSHNsTSA9IHRleHRjb2xvcih1dGNPZmZzZXRNLCBgaHNsKCR7ZDMuaHNsKHBpZWNld2lzZUNvbG9yKHV0Y09mZnNldFAgLyAxMCkpLmh9YCArIHNsU3RyKVxudXRjT2ZmSHNsRCA9IHRleHRjb2xvcihwYXJzZUZsb2F0KHV0Y09mZnNldEQudG9GaXhlZCgyKSksIGBoc2woJHtkMy5oc2wocGllY2V3aXNlQ29sb3IodXRjT2Zmc2V0UCAvIDEwKSkuaH1gICsgc2xTdHIpXG5kZWNab25Ic2xQID0gdGV4dGNvbG9yKGRlY1pvbmVQb3MsIGBoc2woJHtkMy5oc2wocGllY2V3aXNlQ29sb3IoZGVjWm9uZVBvcyAvIDEwKSkuaH1gICsgc2xTdHIpXG51dGNPZmZzZXRNZGlmZkhzbCA9IHRleHRjb2xvcihwYXJzZUZsb2F0KCh1dGNPZmZEaWZmICogMTQ0KS50b0ZpeGVkKDIpKSwgYGhzbCgke2QzLmhzbChwaWVjZXdpc2VDb2xvcih1dGNPZmZEaWZmIC8gMTApKS5ofWAgKyBzbFN0cilcbnV0Y09mZkRpZmZIc2wgPSB0ZXh0Y29sb3IodXRjT2ZmRGlmZiwgYGhzbCgke2QzLmhzbChwaWVjZXdpc2VDb2xvcih1dGNPZmZEaWZmIC8gMTApKS5ofWAgKyBzbFN0cilcbmZ1bmN0aW9uIGRhdGUyZG90ZSh5ZWFyID0gMTk2OSwgZG90eSA9IDMwNiwgem9uZSA9IDApIHtcbiAgICBjb25zdCBjb3RlID0gTWF0aC5mbG9vcigoeWVhciA+PSAwID8geWVhciA6IHllYXIgLSAzOTkpIC8gNDAwKSwgeW90ZSA9IHllYXIgLSBjb3RlICogNDAwO1xuICAgIHJldHVybiBbY290ZSAqIDE0NjA5NyArIHlvdGUgKiAzNjUgKyBNYXRoLmZsb29yKHlvdGUgLyA0KSAtIE1hdGguZmxvb3IoeW90ZSAvIDEwMCkgKyBkb3R5LCB6b25lXVxufVxubGVhcFNlY29uZERvdGVzID0gW1xuICBbMTk3MiwgMTIxXSxcbiAgWzE5NzIsIDMwNV0sXG4gIFsxOTczLCAzMDVdLFxuICBbMTk3NCwgMzA1XSxcbiAgWzE5NzUsIDMwNV0sXG4gIFsxOTc2LCAzMDVdLFxuICBbMTk3NywgMzA1XSxcbiAgWzE5NzgsIDMwNV0sXG4gIFsxOTc5LCAzMDVdLFxuICBbMTk4MSwgMTIxXSxcbiAgWzE5ODIsIDEyMV0sXG4gIFsxOTgzLCAxMjFdLFxuICBbMTk4NSwgMTIxXSxcbiAgWzE5ODcsIDMwNV0sXG4gIFsxOTg5LCAzMDVdLFxuICBbMTk5MCwgMzA1XSxcbiAgWzE5OTIsIDEyMV0sXG4gIFsxOTkzLCAxMjFdLFxuICBbMTk5NCwgMTIxXSxcbiAgWzE5OTUsIDMwNV0sXG4gIFsxOTk3LCAxMjFdLFxuICBbMTk5OCwgMzA1XSxcbiAgWzIwMDUsIDMwNV0sXG4gIFsyMDA4LCAzMDVdLFxuICBbMjAxMiwgMTIxXSxcbiAgWzIwMTUsIDEyMV0sXG4gIFsyMDE2LCAzMDVdLFxuXS5tYXAoeCA9PiBkYXRlMmRvdGUoLi4ueClbMF0pXG5sZWFwU2Vjb25kRG90ZSA9IGRhdGUyZG90ZShsZWFwU2Vjb25kWWVhciwgbGVhcFNlY29uZERhdGUpWzBdXG5sZWFwQ291bnQgPSBsZWFwU2Vjb25kRG90ZXMuZmlsdGVyKGRvdGUgPT4gbGVhcFNlY29uZERvdGUgPiBkb3RlKS5sZW5ndGg7XG5sZWFwQ29sb3IgPSBkMy5jb2xvcihwaWVjZXdpc2VDb2xvcihsZWFwQ291bnQgLyA4NjQwMCkpLmZvcm1hdEhleCgpXG5sZWFwQ291bnRIc2wgPSB0ZXh0Y29sb3IobGVhcENvdW50LCBsZWFwQ29sb3IpXG5mcmFjID0gcmVxdWlyZShcImZyYWN0aW9uLmpzXCIpXG5sZWFwRnJhYyA9IGZyYWMobGVhcENvdW50KS5kaXYoODY0MCkudG9GcmFjdGlvbigpXG5sZWFwVHpvSHNsMCA9IHRleHRjb2xvcihsZWFwRnJhYywgbGVhcENvbG9yKVxubGVhcFR6b0hzbDEgPSB0ZXh0Y29sb3IobGVhcEZyYWMsIGxlYXBDb2xvcilcbmxlYXBUem9Ic2wyID0gdGV4dGNvbG9yKGxlYXBGcmFjLCBsZWFwQ29sb3IpXG5obXNUem8gPSBmcmFjKGhtc2lucHV0WzBdKS5kaXYoMjQpLmFkZChobXNpbnB1dFsxXSwgMTQ0MCkuYWRkKGhtc2lucHV0WzJdLCA4NjQwMCkubW9kKDEpXG5obXNUem94MTAgPSBobXNUem8ubXVsKDEwKVxucGx1cmFseDEwID0gaG1zVHpveDEwLmVxdWFscygxKSA/IFwiXCIgOiBcInNcIlxuaG1zUm91bmRlZCA9IGhtc1R6b3gxMC5yb3VuZChkaWdpdHMgLSAxKVxuaG1zUmVmID0gaG1zUm91bmRlZC5zdWIoaG1zVHpveDEwKVxuaG1zUmVmSHNsID0gdGV4dGNvbG9yKGhtc1JlZi5hYnMoKS50b0ZyYWN0aW9uKCksIGQzLmNvbG9yKHBpZWNld2lzZUNvbG9yKE51bWJlcihobXNSZWYuZGl2KDEwKSkpKS5mb3JtYXRIZXgoKSlcbmhtc1JlZlNpZ24gPSBobXNSZWYubHQoMCkgPyBcIi1cIiA6IFwiK1wiXG5obXNUem9Ic2wgPSB0ZXh0Y29sb3IoaG1zVHpveDEwLnRvRnJhY3Rpb24oKSwgZDMuY29sb3IocGllY2V3aXNlQ29sb3IoTnVtYmVyKGhtc1R6bykpKS5mb3JtYXRIZXgoKSlcbmhtc1JvZEhzbCA9IHRleHRjb2xvcihobXNSb3VuZGVkLCBkMy5jb2xvcihwaWVjZXdpc2VDb2xvcihOdW1iZXIoaG1zUm91bmRlZC5kaXYoMTApKSkpLmZvcm1hdEhleCgpKVxuaG1zVG9kID0gKHplcm9UaW1lICsgaG1zVHpvKSAlIDFcbmhtc1RvZEhzbCA9IHRleHRjb2xvcigoaG1zVG9kICogMTApLnRvRml4ZWQoNCksIGQzLmNvbG9yKHBpZWNld2lzZUNvbG9yKGhtc1RvZCkpLmZvcm1hdEhleCgpKVxubGVhcFRvZCA9ICh6ZXJvVGltZSArIGxlYXBDb3VudCAvIDg2NDAwKSAlIDFcbmxlYXBEZWNpZGF5VG9kID0gKGxlYXBUb2QgKiAxMCkudG9GaXhlZCg0KVxubGVhcFRvZEhzbDAgPSB0ZXh0Y29sb3IobGVhcERlY2lkYXlUb2QsIGQzLmNvbG9yKHBpZWNld2lzZUNvbG9yKGxlYXBUb2QpKS5mb3JtYXRIZXgoKSlcbmxlYXBUb2RIc2wxID0gdGV4dGNvbG9yKGxlYXBEZWNpZGF5VG9kLCBkMy5jb2xvcihwaWVjZXdpc2VDb2xvcihsZWFwVG9kKSkuZm9ybWF0SGV4KCkpXG5sb25nSW5wdXRIc2wgPSB0ZXh0Y29sb3IobG9uSW5wdXQsIGQzLmNvbG9yKHBpZWNld2lzZUNvbG9yKGxvbklucHV0IC8gMTApKS5mb3JtYXRIZXgoKSlcbmVvdCA9IGdldEVvdChsZWFwU2Vjb25kRGF0ZSlcbmFzdFR6byA9IGVvdCArIGxvbklucHV0XG5hc3RUem9Ic2wgPSB0ZXh0Y29sb3IoYXN0VHpvLnRvRml4ZWQoNCksIGQzLmNvbG9yKHBpZWNld2lzZUNvbG9yKGFzdFR6byAvIDEwKSkuZm9ybWF0SGV4KCkpXG5lb3RIc2wgPSB0ZXh0Y29sb3IoZW90LnRvRml4ZWQoNCksIGQzLmNvbG9yKHBpZWNld2lzZUNvbG9yKGVvdCAvIDEwKSkuZm9ybWF0SGV4KCkpXG5lb3RTdW0gPSAoemVyb1RpbWUgKyBhc3RUem8gKyAxMCkgJSAxMFxuZW90U3VtSHNsID0gdGV4dGNvbG9yKGVvdFN1bS50b0ZpeGVkKDQpLCBkMy5jb2xvcihwaWVjZXdpc2VDb2xvcihlb3RTdW0gLyAxMCkpLmZvcm1hdEhleCgpKVxuLy8gaHR0cHM6Ly9vYnNlcnZhYmxlaHEuY29tL0BtY21jY2x1ci9hZGFwdGl2ZS1wbG90dGVyXG5mdW5jdGlvbiBidWlsZF9zYW1wbGVzKGYsIGEsIGIsIG9wdHMgPSB7fSkge1xuICBsZXQgeyBOID0gOSwgbWF4X2RlcHRoID0gNiB9ID0gb3B0cztcbiAgbGV0IGR4ID0gKGIgLSBhKSAvIE47XG4gIGxldCByb290X2ludGVydmFscyA9IEFycmF5LmZyb20oeyBsZW5ndGg6IE4gfSkubWFwKFxuICAgIChfLCBpKSA9PiBuZXcgSW50ZXJ2YWwoYSArIGkgKiBkeCwgYSArIChpICsgMSkgKiBkeCwgMClcbiAgKTtcbiAgcm9vdF9pbnRlcnZhbHMuZm9yRWFjaCgoSSkgPT4ge1xuICAgIEkuZmEgPSBmKEkuYSk7XG4gICAgSS5mYiA9IGYoSS5iKTtcbiAgfSk7XG4gIHJvb3RfaW50ZXJ2YWxzLnJldmVyc2UoKTtcbiAgbGV0IHN0YWNrID0gcm9vdF9pbnRlcnZhbHM7XG4gIGxldCBjbnQgPSAwO1xuICBsZXQgcHRzID0gW107XG4gIGxldCBub2RlUmlnaHQsIG5vZGVMZWZ0O1xuICB3aGlsZSAoc3RhY2subGVuZ3RoID4gMCAmJiBjbnQrKyA8IDEwMDAwMCkge1xuICAgIGxldCBub2RlID0gc3RhY2sucG9wKCk7XG4gICAgaWYgKHRlc3QoZiwgbm9kZSwgb3B0cykpIHtcbiAgICAgIGxldCBtaWRwb2ludCA9IG5vZGUubWlkcG9pbnQ7XG4gICAgICBsZXQgbmV3X2RlcHRoID0gbm9kZS5kZXB0aCArIDE7XG4gICAgICBpZiAobmV3X2RlcHRoIDw9IG1heF9kZXB0aCkge1xuICAgICAgICBsZXQgYV9sZWZ0ID0gbm9kZS5hO1xuICAgICAgICBsZXQgYl9sZWZ0ID0gbWlkcG9pbnQ7XG4gICAgICAgIG5vZGVMZWZ0ID0gbmV3IEludGVydmFsKGFfbGVmdCwgYl9sZWZ0LCBuZXdfZGVwdGgpO1xuICAgICAgICBub2RlTGVmdC5mYSA9IGYoYV9sZWZ0KTtcbiAgICAgICAgbm9kZUxlZnQuZmIgPSBmKGJfbGVmdCk7XG4gICAgICAgIG5vZGUubGVmdCA9IG5vZGVMZWZ0O1xuICAgICAgICBsZXQgYV9yaWdodCA9IG1pZHBvaW50O1xuICAgICAgICBsZXQgYl9yaWdodCA9IG5vZGUuYjtcbiAgICAgICAgbm9kZVJpZ2h0ID0gbmV3IEludGVydmFsKGFfcmlnaHQsIGJfcmlnaHQsIG5ld19kZXB0aCk7XG4gICAgICAgIG5vZGVSaWdodC5mYSA9IGYoYV9sZWZ0KTtcbiAgICAgICAgbm9kZVJpZ2h0LmZiID0gZihiX2xlZnQpO1xuICAgICAgICBub2RlLnJpZ2h0ID0gbm9kZVJpZ2h0O1xuICAgICAgICBzdGFjay5wdXNoKG5vZGVSaWdodCk7XG4gICAgICAgIHN0YWNrLnB1c2gobm9kZUxlZnQpO1xuICAgICAgfSBlbHNlIHtcbiAgICAgICAgcHRzLnB1c2gobm9kZS5hKTtcbiAgICAgIH1cbiAgICB9IGVsc2Uge1xuICAgICAgcHRzLnB1c2gobm9kZS5hKTtcbiAgICB9XG4gIH1cbiAgcHRzLnB1c2goYik7XG4gIC8vICBwdHMgPSBwdHMubWFwKHggPT4gKHsgeDogeCwgeTogZih4KSB9KSk7XG4gIHB0cyA9IHB0cy5tYXAoKHgpID0+IFt4LCBmKHgpXSk7XG4gIGlmIChvcHRzLnNob3dfcm9vdHMpIHtcbiAgICBsZXQgZnVuY3Rpb25fcm9vdHMgPSBbXTtcbiAgICBwdHMuZm9yRWFjaChmdW5jdGlvbiAobywgaSkge1xuICAgICAgaWYgKGkgPCBwdHMubGVuZ3RoIC0gMSAmJiBNYXRoLnNpZ24oby55KSAhPSBNYXRoLnNpZ24ocHRzW2kgKyAxXS55KSkge1xuICAgICAgICBmdW5jdGlvbl9yb290cy5wdXNoKChvLnggKyBwdHNbaSArIDFdLngpIC8gMik7XG4gICAgICB9XG4gICAgfSk7XG4gICAgcHRzLmZ1bmN0aW9uX3Jvb3RzID0gZnVuY3Rpb25fcm9vdHM7XG4gIH1cbiAgcmV0dXJuIHB0cztcbn1cbmZ1bmN0aW9uIHRlc3QoZiwgSSwgb3B0cyA9IHt9KSB7XG4gIGxldCB7IGFuZ2xlX3RvbGVyYW5jZSA9IDAuMDEsIGNoZWNrX3Jvb3RzID0gZmFsc2UgfSA9IG9wdHM7XG4gIGxldCBhID0gSS5hO1xuICBsZXQgYiA9IEkuYjtcbiAgbGV0IGR4MiA9IChiIC0gYSkgLyAyO1xuICBsZXQgbSA9IChhICsgYikgLyAyO1xuICBsZXQgZm0gPSBmKG0pO1xuICBJLm1pZHBvaW50ID0gbTtcbiAgSS5mX21pZCA9IGZtO1xuICBpZiAoY2hlY2tfcm9vdHMgJiYgTWF0aC5zaWduKEkuZmEpICE9IE1hdGguc2lnbihJLmZiKSkge1xuICAgIHJldHVybiB0cnVlO1xuICB9XG4gIGxldCBhbHBoYSA9IE1hdGguYXRhbigoSS5mX21pZCAtIEkuZmEpIC8gZHgyKTtcbiAgbGV0IGJldGEgPSBNYXRoLmF0YW4oKEkuZmIgLSBJLmZfbWlkKSAvIGR4Mik7XG4gIHJldHVybiBNYXRoLmFicyhhbHBoYSAtIGJldGEpID4gYW5nbGVfdG9sZXJhbmNlO1xufVxuY2xhc3MgSW50ZXJ2YWwge1xuICBjb25zdHJ1Y3RvcihhLCBiLCBkZXB0aCkge1xuICAgIHRoaXMuYSA9IGE7XG4gICAgdGhpcy5iID0gYjtcbiAgICB0aGlzLmRlcHRoID0gZGVwdGg7XG4gIH1cbn1cbmNvbG9ycyA9ICh7XG4gIG5pZ2h0OiBcIiM3MTlmYjZcIixcbiAgZGF5OiBcIiNmZmU0MzhcIixcbiAgZ3JpZDogXCIjNGI2YTc5XCIsXG4gIG9jZWFuOiBcImxpZ2h0Ymx1ZVwiLFxuICBsYW5kOiBcIiNmNWYxZGNcIixcbiAgc3VuOiBcIiNmZmU0MzhcIlxufSlcbi8vIGh0dHBzOi8vb2JzZXJ2YWJsZWhxLmNvbS9AcGFybGFudC9lZGl0YWJsZS10YWJsZVxuZnVuY3Rpb24gY3JlYXRlVGFibGUoZGF0YSwgb3B0aW9ucykge1xuICBsZXQgdGFibGUgPSBodG1sYDx0YWJsZSBjbGFzcz1cImVkaXRhYmxlLXRhYmxlXCI+PC90YWJsZT5gO1xuICB0YWJsZS5pbm5lckhUTUwgPSB4c3MuZmlsdGVyWFNTKHRhYmxlaWZ5LmRlZmF1bHQoZGF0YSkpO1xuICBtYWtlVGFibGVFZGl0YWJsZSh0YWJsZSwgb3B0aW9ucyk7XG4gIHJldHVybiB0YWJsZTtcbn1cbnRhYmxlLnNldEF0dHJpYnV0ZShcImNsYXNzXCIsIFwidGFibGVcIilcbnRhYmxlaWZ5ID0gaW1wb3J0KFwiaHR0cHM6Ly9jZG4uc2t5cGFjay5kZXYvdGFibGVpZnlAMS4xLjE/bWluXCIpXG54c3MgPSBpbXBvcnQoXCJodHRwczovL2Nkbi5za3lwYWNrLmRldi94c3NAMS4wLjE0P21pblwiKVxuZnVuY3Rpb24gY3JlYXRlQ2VsbERpdih2YWx1ZSwgbWF4KSB7XG4gIHJldHVybiBgPGRpdiBzdHlsZT1cIlxuICAgIHdpZHRoOiAke01hdGguYWJzKHZhbHVlKSAvIG1heH0lO1xuICAgIGZsb2F0OiBsZWZ0O1xuICAgIHBhZGRpbmc6IDBweCAwcHggMHB4IDJweDtcbiAgICB0ZXh0LWluZGVudDogMnB4O1xuICAgIGJveC1zaXppbmc6IGJvcmRlci1ib3g7XG4gICAgb3ZlcmZsb3c6IHZpc2libGU7XG4gICAgd2hpdGUtc3BhY2U6IG5vd3JhcDtcbiAgICBkaXNwbGF5OiBmbGV4O1xuICAgIGp1c3RpZnktY29udGVudDogc3RhcnQ7XCI+JHtNYXRoLnJvdW5kKHZhbHVlKX08L2Rpdj5gXG59XG5saXZlVGFibGUgPSBvYnNlcnZlVGFibGUodGFibGUpXG5mdW5jdGlvbiBtYWtlVGFibGVFZGl0YWJsZSh0YWJsZSwgb3B0aW9ucykge1xuICBjb25zdCBkZWZhdWx0cyA9IHtoZWFkZXJFZGl0YWJsZTogZmFsc2UsIGFwcGVuZFJvd3M6IHRydWV9O1xuICBvcHRpb25zID0gb3B0aW9ucyA9PT0gdW5kZWZpbmVkID8ge30gOiBvcHRpb25zO1xuICBmb3IgKGxldCBrZXkgaW4gZGVmYXVsdHMpIHtcbiAgICBvcHRpb25zW2tleV0gPSBvcHRpb25zW2tleV0gPT09IHVuZGVmaW5lZCA/IGRlZmF1bHRzW2tleV0gOiBvcHRpb25zW2tleV07XG4gIH1cbiAgcmV0dXJuIEdlbmVyYXRvcnMub2JzZXJ2ZSgoX25vdGlmeSkgPT4ge1xuICAgIGNvbnN0IG5hdmlnYXRlID0gKGV2ZW50KSA9PiB7XG4gICAgICBjb25zdCBjZWxsID0gZXZlbnQudGFyZ2V0O1xuICAgICAgY29uc3Qgcm93ID0gY2VsbC5jbG9zZXN0KCd0cicpO1xuICAgICAgY29uc3QgdGFibGUgPSByb3cuY2xvc2VzdCgndGFibGUnKTtcbiAgICAgIGNvbnN0IGlzQm9keSA9IHJvdy5wYXJlbnROb2RlLnRhZ05hbWUgPT09ICdUQk9EWSc7XG4gICAgICBjb25zdCBpc0hlYWRlciA9IHJvdy5wYXJlbnROb2RlLnRhZ05hbWUgPT09ICdUSEVBRCc7XG4gICAgICBjb25zdCBjb2xJbmRleCA9IGNlbGwuY2VsbEluZGV4O1xuICAgICAgY29uc3QgY29sQ291bnQgPSByb3cuY2VsbHMubGVuZ3RoO1xuICAgICAgY29uc3Qgcm93SW5kZXggPSByb3cucm93SW5kZXg7XG4gICAgICBjb25zdCByb3dDb3VudCA9IHRhYmxlLnJvd3MubGVuZ3RoO1xuICAgICAgY29uc3QgaGVhZFN0b3AgPSBvcHRpb25zLmhlYWRlckVkaXRhYmxlID8gMCA6IDE7XG4gICAgICBsZXQgZGlyZWN0aW9uID0gbnVsbDtcbiAgICAgIGxldCB4ID0gY29sSW5kZXg7XG4gICAgICBsZXQgeSA9IHJvd0luZGV4O1xuICAgICAgaWYgKCFbXG4gICAgICAvLyBodHRwczovL3d3dy5mcmVlY29kZWNhbXAub3JnL25ld3MvamF2YXNjcmlwdC1rZXljb2RlLWxpc3Qta2V5cHJlc3MtZXZlbnQta2V5LWNvZGVzI2hlYWRpbmctYS1mdWxsLWxpc3Qtb2Yta2V5LWV2ZW50LXZhbHVlc1xuICAgICAgICA4LCA5LCAxMywgMTYsIDE3LCAxOCwgMjcsIDMzLCAzNCwgMzUsIDM2LCAzNywgMzgsIDM5LCA0MCwgNDYsIDQ4LCA0OSwgNTAsIDUxLCA1MiwgNTMsIDU0LCA1NSwgNTYsIDU3LCAxMDksIDE4OVxuICAgICAgXS5pbmNsdWRlcyhldmVudC53aGljaCkpIHtcbiAgICAgICAgZXZlbnQucHJldmVudERlZmF1bHQoKTtcbiAgICAgIH1cbiAgICAgIGVsc2Uge1xuICAgICAgc3dpdGNoKGV2ZW50LmNvZGUpIHtcbiAgICAgICAgLy8gVGFiIGN5Y2xlcyB0aHJvdWdoIHRoZSB0YWJsZSwgYWRkaW5nIG5ldyByb3dzIGFzIG5lZWRlZC5cbiAgICAgICAgY2FzZSAnVGFiJzpcbiAgICAgICAgICBldmVudC5wcmV2ZW50RGVmYXVsdCgpO1xuICAgICAgICAgIGlmIChldmVudC5hbHRLZXkgfHwgZXZlbnQuc2hpZnRLZXkpIHtcbiAgICAgICAgICAgIGRpcmVjdGlvbiA9IC0xO1xuICAgICAgICAgICAgaWYgKHggLSAxIDwgMCkge1xuICAgICAgICAgICAgICBpZiAoeSAtIDEgPCBoZWFkU3RvcCkgYnJlYWs7XG4gICAgICAgICAgICAgIHggPSBjb2xDb3VudCAtIDE7XG4gICAgICAgICAgICAgIHkgPSB5IC0gMTtcbiAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgIHggPSB4IC0gMTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgZGlyZWN0aW9uID0gMTtcbiAgICAgICAgICAgIGlmICh4ICsgMSA9PT0gY29sQ291bnQpIHtcbiAgICAgICAgICAgICAgeCA9IDA7XG4gICAgICAgICAgICAgIHkgPSB5ICsgMTtcbiAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgIHggPSB4ICsgMTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICB9XG4gICAgICAgICAgYnJlYWs7XG4gICAgICAgIC8vIFBsYWluIEVudGVyIG5hdmlnYXRlcyBkb3dud2FyZHMuXG4gICAgICAgIC8vIFNoaWZ0ICsgRW50ZXIgb3IgQWx0ICsgRW50ZXIgZ29lcyB1cCB0byB0aGUgY2VsbCBhYm92ZS5cbiAgICAgICAgY2FzZSAnRW50ZXInOlxuICAgICAgICAgIGV2ZW50LnByZXZlbnREZWZhdWx0KCk7XG4gICAgICAgICAgaWYgKGV2ZW50LmFsdEtleSB8fCBldmVudC5zaGlmdEtleSkge1xuICAgICAgICAgICAgZGlyZWN0aW9uID0gLTE7XG4gICAgICAgICAgICB4ID0geDtcbiAgICAgICAgICAgIHkgPSB5IC0gMTtcbiAgICAgICAgICB9XG4gICAgICAgICAgZWxzZSB7XG4gICAgICAgICAgICBkaXJlY3Rpb24gPSAxO1xuICAgICAgICAgICAgeCA9IHg7XG4gICAgICAgICAgICB5ID0geSArIDE7XG4gICAgICAgICAgfVxuICAgICAgICAgIGJyZWFrO1xuICAgICAgICAvLyBUaGUgYXJyb3cga2V5cyBhbGxvdyB5b3UgdG8gbmF2aWdhdGUgdGhyb3VnaCBjZWxscy5cbiAgICAgICAgLy8gTm8gbmV3IHJvd3MgYXJlIGFkZGVkLlxuICAgICAgICBjYXNlICdBcnJvd1VwJzpcbiAgICAgICAgY2FzZSAnQXJyb3dEb3duJzpcbiAgICAgICAgY2FzZSAnQXJyb3dMZWZ0JzpcbiAgICAgICAgY2FzZSAnQXJyb3dSaWdodCc6XG4gICAgICAgIGNhc2UgJ0VudGVyJzpcbiAgICAgICAgICBpZiAoIWV2ZW50LmFsdEtleSkgYnJlYWs7XG4gICAgICAgICAgZXZlbnQucHJldmVudERlZmF1bHQoKTtcbiAgICAgICAgICBzd2l0Y2goZXZlbnQuY29kZSkge1xuICAgICAgICAgICAgY2FzZSAnQXJyb3dVcCc6XG4gICAgICAgICAgICAgIGRpcmVjdGlvbiA9IC0xO1xuICAgICAgICAgICAgICB5ID0gTWF0aC5tYXgoeSAtIDEsIGhlYWRTdG9wKTtcbiAgICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgICAgICBjYXNlICdBcnJvd0Rvd24nOlxuICAgICAgICAgICAgICBkaXJlY3Rpb24gPSAxO1xuICAgICAgICAgICAgICB5ID0gTWF0aC5taW4oeSArIDEsIHJvd0NvdW50IC0gMSk7XG4gICAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgICAgY2FzZSAnQXJyb3dMZWZ0JzpcbiAgICAgICAgICAgICAgZGlyZWN0aW9uID0gLTE7XG4gICAgICAgICAgICAgIHggPSBNYXRoLm1heCh4IC0gMSwgMCk7XG4gICAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgICAgY2FzZSAnQXJyb3dSaWdodCc6XG4gICAgICAgICAgICAgIGRpcmVjdGlvbiA9IDE7XG4gICAgICAgICAgICAgIHggPSBNYXRoLm1pbih4ICsgMSwgY29sQ291bnQgLSAxKTtcbiAgICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgICAgfVxuICAgICAgICAgIGJyZWFrO1xuICAgICAgfVxuICAgICAgaWYgKGRpcmVjdGlvbiAhPT0gbnVsbCkge1xuICAgICAgICBsZXQgbmV4dFJvdztcbiAgICAgICAgaWYgKHkgPT09IHJvd0NvdW50KSB7XG4gICAgICAgICAgbmV4dFJvdyA9IG9wdGlvbnMuYXBwZW5kUm93cyA/IGFkZFJvd1JlbGF0aXZlVG8ocm93LCBkaXJlY3Rpb24pIDogcm93O1xuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgIG5leHRSb3cgPSB0YWJsZS5yb3dzW3ldO1xuICAgICAgICB9XG4gICAgICAgIGxldCBuZXh0Q2VsbCA9IG5leHRSb3cuY2VsbHNbeF07XG4gICAgICAgIGZvY3VzQ2VsbChuZXh0Q2VsbCk7XG4gICAgICB9XG4gICAgfTtcbiAgICB9XG4gICAgdGFibGUuYWRkRXZlbnRMaXN0ZW5lcihcImtleWRvd25cIiwgbmF2aWdhdGUsIGZhbHNlKTtcbiAgICBpZiAodGFibGUucm93cy5sZW5ndGggPiAwKSB7XG4gICAgICBmb3IgKGxldCByb3cgb2YgdGFibGUucm93cykge1xuICAgICAgICBpZiAoIW9wdGlvbnMuaGVhZGVyRWRpdGFibGUgJiYgcm93LnJvd0luZGV4ID09PSAwKSBjb250aW51ZTtcbiAgICAgICAgZm9yIChsZXQgY2VsbCBvZiByb3cuY2VsbHMpIHtcbiAgICAgICAgaWYgKGNlbGwuY2VsbEluZGV4ID09PSAwKSBjb250aW51ZTtcbiAgICAgICAgICBsZXQgY2VsbFZhbHVlID0gY2VsbC5pbm5lclRleHRcbiAgICAgICAgICBjZWxsLmlubmVySFRNTCA9IGA8ZGl2IHN0eWxlPVwiXG4gICAgICAgICAgICB3aWR0aDogJHtNYXRoLmFicyhjZWxsVmFsdWUpIC8gKGNlbGwuY2VsbEluZGV4ID09PSAyID8gMi41IDogMTApfSU7XG4gICAgICAgICAgICBmbG9hdDogbGVmdDtcbiAgICAgICAgICAgIHBhZGRpbmc6IDBweCAwcHggMHB4IDJweDtcbiAgICAgICAgICAgIHRleHQtaW5kZW50OiAycHg7XG4gICAgICAgICAgICBib3gtc2l6aW5nOiBib3JkZXItYm94O1xuICAgICAgICAgICAgb3ZlcmZsb3c6IHZpc2libGU7XG4gICAgICAgICAgICB3aGl0ZS1zcGFjZTogbm93cmFwO1xuICAgICAgICAgICAgZGlzcGxheTogZmxleDtcbiAgICAgICAgICAgIGp1c3RpZnktY29udGVudDogc3RhcnQ7XCI+JHtjZWxsVmFsdWV9PC9kaXY+YFxuICAgICAgICBpZiAoY2VsbC5jZWxsSW5kZXggPT09IDMpIGNvbnRpbnVlO1xuICAgICAgICAgIGNlbGwuY29udGVudEVkaXRhYmxlID0gdHJ1ZTtcbiAgICAgICAgfVxuICAgICAgfVxuICAgIH1cbiAgICByZXR1cm4gKCkgPT4gdGFibGUucmVtb3ZlRXZlbnRMaXN0ZW5lcihcImtleWRvd25cIiwgbmF2aWdhdGUpO1xuICB9KTtcbn1cbmZ1bmN0aW9uIG9ic2VydmVUYWJsZSh0YWJsZSkge1xuICByZXR1cm4gR2VuZXJhdG9ycy5vYnNlcnZlKChub3RpZnkpID0+IHtcbiAgICBjb25zdCBrZXlpbnB1dCA9IChldmVudCkgPT4gbm90aWZ5KHBhcnNlVGFibGVEYXRhKHRhYmxlKSk7XG4gICAgdGFibGUuYWRkRXZlbnRMaXN0ZW5lcihcImlucHV0XCIsIGtleWlucHV0LCBmYWxzZSk7XG4gICAgbm90aWZ5KHBhcnNlVGFibGVEYXRhKHRhYmxlKSk7XG4gICAgcmV0dXJuICgpID0+IHdpbmRvdy5yZW1vdmVFdmVudExpc3RlbmVyKFwiaW5wdXRcIiwga2V5aW5wdXQpO1xuICB9KTtcbn1cbmZ1bmN0aW9uIHBhcnNlVGFibGVEYXRhKHRhYmxlKSB7XG4gIGNvbnN0IGhlYWRlciA9IFtdO1xuICBjb25zdCBkYXRhID0gW107XG4gIGZvciAobGV0IHJvdyBvZiB0YWJsZS5yb3dzKSB7XG4gICAgY29uc3Qgcm93SW5kZXggPSByb3cucm93SW5kZXg7XG4gICAgY29uc3QgaXNIZWFkZXIgPSByb3cucGFyZW50Tm9kZS50YWdOYW1lID09PSAnVEhFQUQnICYmIHJvd0luZGV4ID09PSAwO1xuICAgIGxldCBvYmogPSB7fTtcbiAgICBmb3IgKGxldCBjZWxsIG9mIHJvdy5jZWxscykge1xuICAgICAgY29uc3QgaGVhZCA9IGhlYWRlcltjZWxsLmNlbGxJbmRleF07XG4gICAgICBpZiAoaXNIZWFkZXIpIHtcbiAgICAgICAgaGVhZGVyLnB1c2goY2VsbC5pbm5lclRleHQpO1xuICAgICAgfSBlbHNlIHtcbiAgICAgICAgb2JqW2hlYWRdID0gY2VsbC5pbm5lclRleHQ7XG4gICAgICB9XG4gICAgfVxuICAgIGlmICghaXNIZWFkZXIpIGRhdGEucHVzaChvYmopO1xuICB9XG4gIHJldHVybiBKU09OLnBhcnNlKEpTT04uc3RyaW5naWZ5KGRhdGEpKTtcbn1cbmZ1bmN0aW9uIGZvY3VzQ2VsbCh0ZCkge1xuICBjb25zdCBzID0gd2luZG93LmdldFNlbGVjdGlvbigpO1xuICBjb25zdCByID0gZG9jdW1lbnQuY3JlYXRlUmFuZ2UoKTtcbiAgbGV0IHRleHROb2RlID0gdGQuY2hpbGROb2Rlc1swXTtcbiAgY29uc3QgaSA9IHRkLmlubmVyVGV4dC5sZW5ndGg7XG4gIHRkLmZvY3VzKCk7XG4gIGlmICh0ZXh0Tm9kZSkge1xuICAgIHIuc2V0U3RhcnQodGV4dE5vZGUsIGkpO1xuICAgIHIuc2V0RW5kKHRleHROb2RlLCBpKTtcbiAgfSBlbHNlIHtcbiAgICByLnNlbGVjdE5vZGUodGQpO1xuICB9XG4gIHMucmVtb3ZlQWxsUmFuZ2VzKCk7XG4gIHMuYWRkUmFuZ2Uocik7XG59XG5mdW5jdGlvbiBhZGRSb3dSZWxhdGl2ZVRvKHRyLCBkaXJlY3Rpb24pIHtcbiAgY29uc3QgbmV3VHIgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCd0cicpO1xuICBjb25zdCBpbnNlcnRQb3NpdGlvbiA9IGRpcmVjdGlvbiA9PSAxID8gJ2FmdGVyZW5kJyA6ICdiZWZvcmViZWdpbic7XG4gIHRyLmluc2VydEFkamFjZW50RWxlbWVudChpbnNlcnRQb3NpdGlvbiwgbmV3VHIpO1xuICBmb3IgKGxldCBfdGQgb2YgQXJyYXkuZnJvbSh0ci5jaGlsZHJlbikpIHtcbiAgICBjb25zdCBuZXdUZCA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ3RkJyk7XG4gICAgbmV3VGQuYXBwZW5kQ2hpbGQoZG9jdW1lbnQuY3JlYXRlVGV4dE5vZGUoJycpKTtcbiAgICBuZXdUZC5jb250ZW50RWRpdGFibGUgPSB0cnVlO1xuICAgIG5ld1RyLmFwcGVuZENoaWxkKG5ld1RkKTtcbiAgfVxuICByZXR1cm4gbmV3VHI7XG59XG4vLyBodHRwczovL29ic2VydmFibGVocS5jb20vQG9ic2VydmFibGVocS90ZXh0LWNvbG9yLWFubm90YXRpb25zLWluLW1hcmtkb3duXG5yc3RidG4gPSBkMy5jcmVhdGUoJ2J1dHRvbicpLmh0bWwoJ1Jlc2V0JykuYXR0cihcImlkXCIsIFwicnN0YnRuXCIpLmF0dHIoXCJjbGFzc1wiLCBcImJ0biBidG4tcXVhcnRvXCIpO1xuLy8gaHR0cHM6Ly9vYnNlcnZhYmxlaHEuY29tL0ByZWNpZnMvYWRkLWEtY2xhc3MtdG8tYW4tb2JzZXJ2YWJsZS1pbnB1dC0tc3VwcG9ydFxuZnVuY3Rpb24gbGFiZWxUb2dnbGUoaW5wdXRUeXBlLCBpbnB1dExhYmVsLCBpbnB1dFZhbHVlLCBpbnB1dElkKSB7XG4gIGNvbnN0IGlucHV0ID0gaW5wdXRUeXBlKHtsYWJlbDogaW5wdXRMYWJlbCwgdmFsdWU6IGlucHV0VmFsdWV9KTtcbiAgaW5wdXQuc2V0QXR0cmlidXRlKFwiaWRcIiwgaW5wdXRJZCk7XG4gIHJldHVybiBpbnB1dDtcbn1cbnRpbWV6b25lcyA9IEZpbGVBdHRhY2htZW50KFwiLi4vLi4vYXNzZXQvdGltZXpvbmVzLmpzb25cIikuanNvbigpXG56b25lcyA9IHRvcG9qc29uLmZlYXR1cmUodGltZXpvbmVzLCB0aW1lem9uZXMub2JqZWN0cy50aW1lem9uZXMpLmZlYXR1cmVzXG5tZXNoID0gdG9wb2pzb24ubWVzaCh0aW1lem9uZXMsIHRpbWV6b25lcy5vYmplY3RzLnRpbWV6b25lcylcbnpvbmVjb2xvciA9IGQzLnNjYWxlU2VxdWVudGlhbChkMy5pbnRlcnBvbGF0ZVJkQnUpLmRvbWFpbihbLTEyLCAxNF0pXG5jb29yID0gW1tbLTE4LCAtODkuOThdLCBbLTE4LCA4OS45OF0sIFsxOCwgODkuOThdLCBbMTgsIC04OS45OF0sIFstMTgsIC04OS45OF0sIF1dXG5kZWN6b25lcyA9IFsuLi5BcnJheSgxMCkua2V5cygpXS5tYXAoXG4gIGkgPT4gKHtcbiAgICBcInR5cGVcIjogXCJGZWF0dXJlXCIsXG4gICAgXCJnZW9tZXRyeVwiOiB7XG4gICAgICBcInR5cGVcIjogXCJQb2x5Z29uXCIsXG4gICAgICBcImNvb3JkaW5hdGVzXCI6IFtjb29yWzBdLm1hcCh0ID0+IFt0WzBdKzM2KmksIHRbMV1dKV1cbiAgICAgIH0sXG4gICAgXCJwcm9wZXJ0aWVzXCI6IFtdXG4gIH0pXG4pXG5oc2xhMTAgPSBbXG4gIGBoc2xhKDAsICAgMTAwJSwgNTAlLCAxMDAlKWAsIC8vIHJlZFxuICBgaHNsYSgzNiwgIDEwMCUsIDUwJSwgMTAwJSlgLCAvLyBvcmFuZ2VcbiAgYGhzbGEoNjAsICAxMDAlLCA1MCUsIDEwMCUpYCwgLy8geWVsbG93XG4gIGBoc2xhKDgwLCAgMTAwJSwgNTAlLCAxMDAlKWAsIC8vIGxpbWVcbiAgYGhzbGEoMTIwLCAxMDAlLCA1MCUsIDEwMCUpYCwgLy8gZ3JlZW5cbiAgYGhzbGEoMTgwLCAxMDAlLCA1MCUsIDEwMCUpYCwgLy8gY3lhblxuICBgaHNsYSgyMDgsIDEwMCUsIDUwJSwgMTAwJSlgLCAvLyBhenVyZVxuICBgaHNsYSgyNDAsIDEwMCUsIDUwJSwgMTAwJSlgLCAvLyBibHVlXG4gIGBoc2xhKDI3NiwgMTAwJSwgNTAlLCAxMDAlKWAsIC8vIHZpb2xldFxuICBgaHNsYSgzMDAsIDEwMCUsIDUwJSwgMTAwJSlgLCAvLyBtYWdlbnRhXG4gIGBoc2xhKDAsICAgMTAwJSwgNTAlLCAxMDAlKWAsIC8vIHJlZFxuXVxuYm9yZGVycyA9IHRvcG9qc29uLm1lc2goY291bnRyaWVzLCBjb3VudHJpZXMub2JqZWN0cy5jb3VudHJpZXMsIChhLCBiKSA9PiBhICE9PSBiKVxuY291bnRyaWVzID0gZmV0Y2goXCJodHRwczovL2Nkbi5qc2RlbGl2ci5uZXQvbnBtL3dvcmxkLWF0bGFzQDIvY291bnRyaWVzLTUwbS5qc29uXCIpLnRoZW4ocmVzcG9uc2UgPT4gcmVzcG9uc2UuanNvbigpKVxuIn0seyJtZXRob2ROYW1lIjoiaW50ZXJwcmV0IiwiY2VsbE5hbWUiOiJvanMtY2VsbC0yNiIsImlubGluZSI6ZmFsc2UsInNvdXJjZSI6Ii8vIGh0dHBzOi8vb2JzZXJ2YWJsZWhxLmNvbS9AZDMvc2ltcGxlLWNsb2NrXG4vLyBodHRwczovL29ic2VydmFibGVocS5jb20vQGRyaW8vbGV0cy1idWlsZC1hbi1hbmFsb2ctY2xvY2tcbmNsb2NrID0ge1xuICBjb25zdCBjbG9ja1JhZGl1cyA9IDIwMCxcbiAgICBtYXJnaW4gPSA1MCxcbiAgICB3ID0gKGNsb2NrUmFkaXVzICsgbWFyZ2luKSAqIDIsXG4gICAgaCA9IChjbG9ja1JhZGl1cyArIG1hcmdpbikgKiAyLFxuICAgIGhvdXJIYW5kTGVuZ3RoID0gKDIgKiBjbG9ja1JhZGl1cykgLyAzLFxuICAgIG1pbnV0ZUhhbmRMZW5ndGggPSBjbG9ja1JhZGl1cyxcbiAgICBzZWNvbmRIYW5kTGVuZ3RoID0gY2xvY2tSYWRpdXMgLSAxMixcbiAgICBzZWNvbmRIYW5kQmFsYW5jZSA9IDMwLFxuICAgIHNlY29uZFRpY2tTdGFydCA9IGNsb2NrUmFkaXVzLFxuICAgIHNlY29uZFRpY2tMZW5ndGggPSAtMTAsXG4gICAgaG91clRpY2tTdGFydCA9IGNsb2NrUmFkaXVzLFxuICAgIGhvdXJUaWNrTGVuZ3RoID0gLTE4LFxuICAgIHNlY29uZExhYmVsUmFkaXVzID0gY2xvY2tSYWRpdXMgKyAxNixcbiAgICBzZWNvbmRMYWJlbFlPZmZzZXQgPSA1LFxuICAgIGhvdXJMYWJlbFJhZGl1cyA9IGNsb2NrUmFkaXVzIC0gNDAsXG4gICAgaG91ckxhYmVsWU9mZnNldCA9IDcsXG4gICAgcmFkaWFucyA9IE1hdGguUEkgLyAxODA7XG4gIGNvbnN0IHRlbiA9IGQzXG4gICAgLnNjYWxlTGluZWFyKClcbiAgICAucmFuZ2UoWzAsIDM2MF0pXG4gICAgLmRvbWFpbihbMCwgMTBdKTtcbiAgY29uc3Qgc3RvID0gZDNcbiAgICAuc2NhbGVMaW5lYXIoKVxuICAgIC5yYW5nZShbMCwgMzYwXSlcbiAgICAuZG9tYWluKFswLCAxMDBdKTtcbiAgY29uc3QgaGFuZERhdGEgPSBbXG4gICAge1xuICAgICAgdHlwZTogXCJob3VyXCIsXG4gICAgICB2YWx1ZTogMCxcbiAgICAgIGxlbmd0aDogLWhvdXJIYW5kTGVuZ3RoLFxuICAgICAgc2NhbGU6IHRlblxuICAgIH0sXG4gICAge1xuICAgICAgdHlwZTogXCJtaW51dGVcIixcbiAgICAgIHZhbHVlOiAwLFxuICAgICAgbGVuZ3RoOiAtbWludXRlSGFuZExlbmd0aCxcbiAgICAgIHNjYWxlOiBzdG9cbiAgICB9LFxuICAgIHtcbiAgICAgIHR5cGU6IFwic2Vjb25kXCIsXG4gICAgICB2YWx1ZTogMCxcbiAgICAgIGxlbmd0aDogLXNlY29uZEhhbmRMZW5ndGgsXG4gICAgICBzY2FsZTogc3RvLFxuICAgICAgYmFsYW5jZTogc2Vjb25kSGFuZEJhbGFuY2VcbiAgICB9XG4gIF07XG4gIGZ1bmN0aW9uIGRyYXdDbG9jaygpIHtcbiAgICAvLyBjcmVhdGUgYWxsIHRoZSBjbG9jayBlbGVtZW50c1xuICAgIHVwZGF0ZURhdGEoKTsgLy9kcmF3IHRoZW0gaW4gdGhlIGNvcnJlY3Qgc3RhcnRpbmcgcG9zaXRpb25cbiAgICBjb25zdCBmYWNlID0gc3ZnXG4gICAgICAuYXBwZW5kKFwiZ1wiKVxuICAgICAgLmF0dHIoXCJpZFwiLCBcImNsb2NrLWZhY2VcIilcbiAgICAgIC5hdHRyKFwidHJhbnNmb3JtXCIsIGB0cmFuc2xhdGUoJHtbdyAvIDIsIGggLyAyXX0pYCk7XG4gICAgLy8gYWRkIG1hcmtzIGZvciBzZWNvbmRzXG4gICAgZmFjZVxuICAgICAgLnNlbGVjdEFsbChcIi5zZWNvbmQtdGlja1wiKVxuICAgICAgLmRhdGEoZDMucmFuZ2UoMCwgMTAwKSlcbiAgICAgIC5lbnRlcigpXG4gICAgICAuYXBwZW5kKFwibGluZVwiKVxuICAgICAgLmF0dHIoXCJjbGFzc1wiLCBcInNlY29uZC10aWNrXCIpXG4gICAgICAuYXR0cihcIngxXCIsIDApXG4gICAgICAuYXR0cihcIngyXCIsIDApXG4gICAgICAuYXR0cihcInkxXCIsIHNlY29uZFRpY2tTdGFydClcbiAgICAgIC5hdHRyKFwieTJcIiwgc2Vjb25kVGlja1N0YXJ0ICsgc2Vjb25kVGlja0xlbmd0aClcbiAgICAgIC5hdHRyKFwidHJhbnNmb3JtXCIsIGQgPT4gYHJvdGF0ZSgke3N0byhkKX0pYCk7XG4gICAgLy8gYW5kIGxhYmVscy4uLlxuICAgIGZhY2VcbiAgICAgIC5zZWxlY3RBbGwoXCIuc2Vjb25kLWxhYmVsXCIpXG4gICAgICAuZGF0YShkMy5yYW5nZSgwLCAxMDAsIDUpKVxuICAgICAgLmVudGVyKClcbiAgICAgIC5hcHBlbmQoXCJ0ZXh0XCIpXG4gICAgICAuYXR0cihcImNsYXNzXCIsIFwic2Vjb25kLWxhYmVsXCIpXG4gICAgICAuYXR0cihcInRleHQtYW5jaG9yXCIsIFwibWlkZGxlXCIpXG4gICAgICAuYXR0cihcInhcIiwgZCA9PiBzZWNvbmRMYWJlbFJhZGl1cyAqIE1hdGguc2luKHN0byhkKSAqIHJhZGlhbnMpKVxuICAgICAgLmF0dHIoXG4gICAgICAgIFwieVwiLFxuICAgICAgICBkID0+XG4gICAgICAgICAgLXNlY29uZExhYmVsUmFkaXVzICogTWF0aC5jb3Moc3RvKGQpICogcmFkaWFucykgKyBzZWNvbmRMYWJlbFlPZmZzZXRcbiAgICAgIClcbiAgICAgIC50ZXh0KGQgPT4gZCk7XG4gICAgLy8gLi4uIGFuZCBob3Vyc1xuICAgIGZhY2VcbiAgICAgIC5zZWxlY3RBbGwoXCIuaG91ci10aWNrXCIpXG4gICAgICAuZGF0YShkMy5yYW5nZSgwLCAxMCwgMSkpXG4gICAgICAuZW50ZXIoKVxuICAgICAgLmFwcGVuZChcImxpbmVcIilcbiAgICAgIC5hdHRyKFwiY2xhc3NcIiwgXCJob3VyLXRpY2tcIilcbiAgICAgIC5hdHRyKFwieDFcIiwgMClcbiAgICAgIC5hdHRyKFwieDJcIiwgMClcbiAgICAgIC5hdHRyKFwieTFcIiwgaG91clRpY2tTdGFydClcbiAgICAgIC5hdHRyKFwieTJcIiwgaG91clRpY2tTdGFydCArIGhvdXJUaWNrTGVuZ3RoKVxuICAgICAgLmF0dHIoXCJ0cmFuc2Zvcm1cIiwgZCA9PiBgcm90YXRlKCR7dGVuKGQpfSlgKTtcbiAgICBmYWNlXG4gICAgICAuc2VsZWN0QWxsKFwiLmhvdXItbGFiZWxcIilcbiAgICAgIC5kYXRhKGQzLnJhbmdlKDAsIDEwLCAxKSlcbiAgICAgIC5lbnRlcigpXG4gICAgICAuYXBwZW5kKFwidGV4dFwiKVxuICAgICAgLmF0dHIoXCJjbGFzc1wiLCBcImhvdXItbGFiZWxcIilcbiAgICAgIC5hdHRyKFwidGV4dC1hbmNob3JcIiwgXCJtaWRkbGVcIilcbiAgICAgIC5hdHRyKFwieFwiLCBkID0+IGhvdXJMYWJlbFJhZGl1cyAqIE1hdGguc2luKHRlbihkKSAqIHJhZGlhbnMpKVxuICAgICAgLmF0dHIoXG4gICAgICAgIFwieVwiLFxuICAgICAgICBkID0+IC1ob3VyTGFiZWxSYWRpdXMgKiBNYXRoLmNvcyh0ZW4oZCkgKiByYWRpYW5zKSArIGhvdXJMYWJlbFlPZmZzZXRcbiAgICAgIClcbiAgICAgIC50ZXh0KGQgPT4gZCk7XG4gICAgY29uc3QgaGFuZHMgPSBmYWNlLmFwcGVuZChcImdcIikuYXR0cihcImlkXCIsIFwiY2xvY2staGFuZHNcIik7XG4gICAgaGFuZHNcbiAgICAgIC5zZWxlY3RBbGwoXCJsaW5lXCIpXG4gICAgICAuZGF0YShoYW5kRGF0YSlcbiAgICAgIC5lbnRlcigpXG4gICAgICAuYXBwZW5kKFwibGluZVwiKVxuICAgICAgLmF0dHIoXCJjbGFzc1wiLCBkID0+IGQudHlwZSArIFwiLWhhbmRcIilcbiAgICAgIC5hdHRyKFwieDFcIiwgMClcbiAgICAgIC5hdHRyKFwieTFcIiwgZCA9PiBkLmJhbGFuY2UgfHwgMClcbiAgICAgIC5hdHRyKFwieDJcIiwgMClcbiAgICAgIC5hdHRyKFwieTJcIiwgZCA9PiBkLmxlbmd0aClcbiAgICAgIC5hdHRyKFwidHJhbnNmb3JtXCIsIGQgPT4gYHJvdGF0ZSgke2Quc2NhbGUoZC52YWx1ZSl9KWApO1xuICAgIGZhY2VcbiAgICAgIC5hcHBlbmQoXCJnXCIpXG4gICAgICAuYXR0cihcImlkXCIsIFwiZmFjZS1vdmVybGF5XCIpXG4gICAgICAuYXBwZW5kKFwiY2lyY2xlXCIpXG4gICAgICAuYXR0cihcImNsYXNzXCIsIFwiaGFuZHMtY292ZXJcIilcbiAgICAgIC5hdHRyKFwieFwiLCAwKVxuICAgICAgLmF0dHIoXCJ5XCIsIDApXG4gICAgICAuYXR0cihcInJcIiwgY2xvY2tSYWRpdXMgLyAyMCk7XG4gIH1cbiAgZnVuY3Rpb24gbW92ZUhhbmRzKCkge1xuICAgIGNvbnN0IHNlbCA9IGQzXG4gICAgICAuc2VsZWN0KFwiI2Nsb2NrLWhhbmRzLWZpbmFsXCIpXG4gICAgICAuc2VsZWN0QWxsKFwibGluZVwiKVxuICAgICAgLmRhdGEoaGFuZERhdGEpXG4gICAgICAudHJhbnNpdGlvbigpO1xuICAgIGlmIChmYW5jeVNlY29uZHNPRkYpIHNlbC5lYXNlKGQzLmVhc2VFbGFzdGljLnBlcmlvZCgwLjUpKTtcbiAgICBzZWwuYXR0cihcInRyYW5zZm9ybVwiLCBkID0+IGByb3RhdGUoJHtkLnNjYWxlKGQudmFsdWUpfSlgKTtcbiAgfVxuICBmdW5jdGlvbiB1cGRhdGVEYXRhKCkge1xuICAgIGhhbmREYXRhWzBdLnZhbHVlID0gIWZhbmN5U2Vjb25kc09GRiA/IE1hdGguZmxvb3Ioc2VsZWN0ZWRFeGFjdCAqIDEwKSA6IGRlY1RpbWVbMF07XG4gICAgaGFuZERhdGFbMV0udmFsdWUgPSAhZmFuY3lTZWNvbmRzT0ZGID8gTWF0aC5mbG9vcihzZWxlY3RlZEV4YWN0ICogMTAgJSAxICogMTAwKSA6IGRlY1RpbWUuc2xpY2UoMiwgNCk7XG4gICAgaGFuZERhdGFbMl0udmFsdWUgPSAhZmFuY3lTZWNvbmRzT0ZGID8gc2VsZWN0ZWRFeGFjdCAqIDEwICUgMSAqIDEwMCAlIDEgKiAxMDAgOiBkZWNUaW1lLnNsaWNlKDQsIDYpO1xuICB9XG4gIGNvbnN0IHN2ZyA9IGQzXG4gICAgLmNyZWF0ZShcInN2Z1wiKVxuICAgIC5hdHRyKFwidmlld0JveFwiLCBbMCwgMCwgdywgaF0pXG4gICAgLnN0eWxlKFwibWF4LXdpZHRoXCIsIGAke3dpZHRoIC8gMi4xfXB4YClcbiAgICAuYXR0cihcImNsYXNzXCIsIFwiYW5hbG9nY2xvY2tcIilcbiAgICAuYXR0cihcImlkXCIsIFwidG9wY2xvY2tcIik7XG4gIHN2Z1xuICAgIC5hcHBlbmQoXCJ0ZXh0XCIpXG4gICAgLnRleHQoYCske2RlY1RpbWV9LSR7c2VsZWN0ZWRab25lfWApXG4gICAgLmF0dHIoXCJ4XCIsIGNsb2NrUmFkaXVzICsgbWFyZ2luKVxuICAgIC5hdHRyKFwieVwiLCBjbG9ja1JhZGl1cyAqIDIgKyBtYXJnaW4gKiAyLjEpXG4gICAgLmF0dHIoXCJ0ZXh0LWFuY2hvclwiLCBcIm1pZGRsZVwiKVxuICAgIC5hdHRyKFwiZm9udC1zaXplXCIsIDMyKVxuICAgIC5hdHRyKFwiZm9udC1mYW1pbHlcIiwgXCJtb25vc3BhY2VcIik7XG4gIGRyYXdDbG9jaygpO1xuICAvLyBBbmltYXRpb25cbiAgY29uc3QgaW50ZXJ2YWwgPSBzZXRJbnRlcnZhbChcbiAgICAoKSA9PiB7XG4gICAgICB1cGRhdGVEYXRhKCk7XG4gICAgICBtb3ZlSGFuZHMoKTtcbiAgICB9LFxuICAgICFmYW5jeVNlY29uZHNPRkYgPyAxMCA6IDg2NFxuICApO1xuICBpbnZhbGlkYXRpb24udGhlbigoKSA9PiBjbGVhckludGVydmFsKGludGVydmFsKSk7XG4gIHJldHVybiBzdmcubm9kZSgpO1xufVxuIn0seyJtZXRob2ROYW1lIjoiaW50ZXJwcmV0IiwiY2VsbE5hbWUiOiJvanMtY2VsbC0yNyIsImlubGluZSI6ZmFsc2UsInNvdXJjZSI6Ii8vIGh0dHBzOi8vb2JzZXJ2YWJsZWhxLmNvbS9AZDMvc2ltcGxlLWNsb2NrXG4vLyBodHRwczovL29ic2VydmFibGVocS5jb20vQGRyaW8vbGV0cy1idWlsZC1hbi1hbmFsb2ctY2xvY2tcbmNsb2NrMSA9IHtcbiAgY29uc3QgY2xvY2tSYWRpdXMgPSAyMDAsXG4gICAgbWFyZ2luID0gNTAsXG4gICAgdyA9IChjbG9ja1JhZGl1cyArIG1hcmdpbikgKiAyLFxuICAgIGggPSAoY2xvY2tSYWRpdXMgKyBtYXJnaW4pICogMixcbiAgICBob3VySGFuZExlbmd0aCA9ICgyICogY2xvY2tSYWRpdXMpIC8gMyxcbiAgICBtaW51dGVIYW5kTGVuZ3RoID0gY2xvY2tSYWRpdXMsXG4gICAgc2Vjb25kSGFuZExlbmd0aCA9IGNsb2NrUmFkaXVzIC0gMTIsXG4gICAgc2Vjb25kSGFuZEJhbGFuY2UgPSAzMCxcbiAgICBzZWNvbmRUaWNrU3RhcnQgPSBjbG9ja1JhZGl1cyxcbiAgICBzZWNvbmRUaWNrTGVuZ3RoID0gLTEwLFxuICAgIGhvdXJUaWNrU3RhcnQgPSBjbG9ja1JhZGl1cyxcbiAgICBob3VyVGlja0xlbmd0aCA9IC0xOCxcbiAgICBzZWNvbmRMYWJlbFJhZGl1cyA9IGNsb2NrUmFkaXVzICsgMTYsXG4gICAgc2Vjb25kTGFiZWxZT2Zmc2V0ID0gNSxcbiAgICBob3VyTGFiZWxSYWRpdXMgPSBjbG9ja1JhZGl1cyAtIDQwLFxuICAgIGhvdXJMYWJlbFlPZmZzZXQgPSA3LFxuICAgIHJhZGlhbnMgPSBNYXRoLlBJIC8gMTgwO1xuICBjb25zdCB0ZW4gPSBkM1xuICAgIC5zY2FsZUxpbmVhcigpXG4gICAgLnJhbmdlKFswLCAzNjBdKVxuICAgIC5kb21haW4oWzAsIDEwXSk7XG4gIGNvbnN0IHN0byA9IGQzXG4gICAgLnNjYWxlTGluZWFyKClcbiAgICAucmFuZ2UoWzAsIDM2MF0pXG4gICAgLmRvbWFpbihbMCwgMTAwXSk7XG4gIGNvbnN0IGhhbmREYXRhID0gW1xuICAgIHtcbiAgICAgIHR5cGU6IFwiaG91clwiLFxuICAgICAgdmFsdWU6IDAsXG4gICAgICBsZW5ndGg6IC1ob3VySGFuZExlbmd0aCxcbiAgICAgIHNjYWxlOiB0ZW5cbiAgICB9LFxuICAgIHtcbiAgICAgIHR5cGU6IFwibWludXRlXCIsXG4gICAgICB2YWx1ZTogMCxcbiAgICAgIGxlbmd0aDogLW1pbnV0ZUhhbmRMZW5ndGgsXG4gICAgICBzY2FsZTogc3RvXG4gICAgfSxcbiAgICB7XG4gICAgICB0eXBlOiBcInNlY29uZFwiLFxuICAgICAgdmFsdWU6IDAsXG4gICAgICBsZW5ndGg6IC1zZWNvbmRIYW5kTGVuZ3RoLFxuICAgICAgc2NhbGU6IHN0byxcbiAgICAgIGJhbGFuY2U6IHNlY29uZEhhbmRCYWxhbmNlXG4gICAgfVxuICBdO1xuICBmdW5jdGlvbiBkcmF3Q2xvY2soKSB7XG4gICAgLy8gY3JlYXRlIGFsbCB0aGUgY2xvY2sgZWxlbWVudHNcbiAgICB1cGRhdGVEYXRhKCk7IC8vZHJhdyB0aGVtIGluIHRoZSBjb3JyZWN0IHN0YXJ0aW5nIHBvc2l0aW9uXG4gICAgY29uc3QgZmFjZSA9IHN2Z1xuICAgICAgLmFwcGVuZChcImdcIilcbiAgICAgIC5hdHRyKFwiaWRcIiwgXCJjbG9jay1mYWNlXCIpXG4gICAgICAuYXR0cihcInRyYW5zZm9ybVwiLCBgdHJhbnNsYXRlKCR7W3cgLyAyLCBoIC8gMl19KWApO1xuICAgIC8vIGFkZCBtYXJrcyBmb3Igc2Vjb25kc1xuICAgIGZhY2VcbiAgICAgIC5zZWxlY3RBbGwoXCIuc2Vjb25kLXRpY2tcIilcbiAgICAgIC5kYXRhKGQzLnJhbmdlKDAsIDEwMCkpXG4gICAgICAuZW50ZXIoKVxuICAgICAgLmFwcGVuZChcImxpbmVcIilcbiAgICAgIC5hdHRyKFwiY2xhc3NcIiwgXCJzZWNvbmQtdGlja1wiKVxuICAgICAgLmF0dHIoXCJ4MVwiLCAwKVxuICAgICAgLmF0dHIoXCJ4MlwiLCAwKVxuICAgICAgLmF0dHIoXCJ5MVwiLCBzZWNvbmRUaWNrU3RhcnQpXG4gICAgICAuYXR0cihcInkyXCIsIHNlY29uZFRpY2tTdGFydCArIHNlY29uZFRpY2tMZW5ndGgpXG4gICAgICAuYXR0cihcInRyYW5zZm9ybVwiLCBkID0+IGByb3RhdGUoJHtzdG8oZCl9KWApO1xuICAgIC8vIGFuZCBsYWJlbHMuLi5cbiAgICBmYWNlXG4gICAgICAuc2VsZWN0QWxsKFwiLnNlY29uZC1sYWJlbFwiKVxuICAgICAgLmRhdGEoZDMucmFuZ2UoMCwgMTAwLCA1KSlcbiAgICAgIC5lbnRlcigpXG4gICAgICAuYXBwZW5kKFwidGV4dFwiKVxuICAgICAgLmF0dHIoXCJjbGFzc1wiLCBcInNlY29uZC1sYWJlbFwiKVxuICAgICAgLmF0dHIoXCJ0ZXh0LWFuY2hvclwiLCBcIm1pZGRsZVwiKVxuICAgICAgLmF0dHIoXCJ4XCIsIGQgPT4gc2Vjb25kTGFiZWxSYWRpdXMgKiBNYXRoLnNpbihzdG8oZCkgKiByYWRpYW5zKSlcbiAgICAgIC5hdHRyKFxuICAgICAgICBcInlcIixcbiAgICAgICAgZCA9PlxuICAgICAgICAgIC1zZWNvbmRMYWJlbFJhZGl1cyAqIE1hdGguY29zKHN0byhkKSAqIHJhZGlhbnMpICsgc2Vjb25kTGFiZWxZT2Zmc2V0XG4gICAgICApXG4gICAgICAudGV4dChkID0+IGQpO1xuICAgIC8vIC4uLiBhbmQgaG91cnNcbiAgICBmYWNlXG4gICAgICAuc2VsZWN0QWxsKFwiLmhvdXItdGlja1wiKVxuICAgICAgLmRhdGEoZDMucmFuZ2UoMCwgMTAsIDEpKVxuICAgICAgLmVudGVyKClcbiAgICAgIC5hcHBlbmQoXCJsaW5lXCIpXG4gICAgICAuYXR0cihcImNsYXNzXCIsIFwiaG91ci10aWNrXCIpXG4gICAgICAuYXR0cihcIngxXCIsIDApXG4gICAgICAuYXR0cihcIngyXCIsIDApXG4gICAgICAuYXR0cihcInkxXCIsIGhvdXJUaWNrU3RhcnQpXG4gICAgICAuYXR0cihcInkyXCIsIGhvdXJUaWNrU3RhcnQgKyBob3VyVGlja0xlbmd0aClcbiAgICAgIC5hdHRyKFwidHJhbnNmb3JtXCIsIGQgPT4gYHJvdGF0ZSgke3RlbihkKX0pYCk7XG4gICAgZmFjZVxuICAgICAgLnNlbGVjdEFsbChcIi5ob3VyLWxhYmVsXCIpXG4gICAgICAuZGF0YShkMy5yYW5nZSgwLCAxMCwgMSkpXG4gICAgICAuZW50ZXIoKVxuICAgICAgLmFwcGVuZChcInRleHRcIilcbiAgICAgIC5hdHRyKFwiY2xhc3NcIiwgXCJob3VyLWxhYmVsXCIpXG4gICAgICAuYXR0cihcInRleHQtYW5jaG9yXCIsIFwibWlkZGxlXCIpXG4gICAgICAuYXR0cihcInhcIiwgZCA9PiBob3VyTGFiZWxSYWRpdXMgKiBNYXRoLnNpbih0ZW4oZCkgKiByYWRpYW5zKSlcbiAgICAgIC5hdHRyKFxuICAgICAgICBcInlcIixcbiAgICAgICAgZCA9PiAtaG91ckxhYmVsUmFkaXVzICogTWF0aC5jb3ModGVuKGQpICogcmFkaWFucykgKyBob3VyTGFiZWxZT2Zmc2V0XG4gICAgICApXG4gICAgICAudGV4dChkID0+IGQpO1xuICAgIGNvbnN0IGhhbmRzID0gZmFjZS5hcHBlbmQoXCJnXCIpLmF0dHIoXCJpZFwiLCBcImNsb2NrLWhhbmRzXCIpO1xuICAgIGhhbmRzXG4gICAgICAuc2VsZWN0QWxsKFwibGluZVwiKVxuICAgICAgLmRhdGEoaGFuZERhdGEpXG4gICAgICAuZW50ZXIoKVxuICAgICAgLmFwcGVuZChcImxpbmVcIilcbiAgICAgIC5hdHRyKFwiY2xhc3NcIiwgZCA9PiBkLnR5cGUgKyBcIi1oYW5kXCIpXG4gICAgICAuYXR0cihcIngxXCIsIDApXG4gICAgICAuYXR0cihcInkxXCIsIGQgPT4gZC5iYWxhbmNlIHx8IDApXG4gICAgICAuYXR0cihcIngyXCIsIDApXG4gICAgICAuYXR0cihcInkyXCIsIGQgPT4gZC5sZW5ndGgpXG4gICAgICAuYXR0cihcInRyYW5zZm9ybVwiLCBkID0+IGByb3RhdGUoJHtkLnNjYWxlKGQudmFsdWUpfSlgKTtcbiAgICBmYWNlXG4gICAgICAuYXBwZW5kKFwiZ1wiKVxuICAgICAgLmF0dHIoXCJpZFwiLCBcImZhY2Utb3ZlcmxheVwiKVxuICAgICAgLmFwcGVuZChcImNpcmNsZVwiKVxuICAgICAgLmF0dHIoXCJjbGFzc1wiLCBcImhhbmRzLWNvdmVyXCIpXG4gICAgICAuYXR0cihcInhcIiwgMClcbiAgICAgIC5hdHRyKFwieVwiLCAwKVxuICAgICAgLmF0dHIoXCJyXCIsIGNsb2NrUmFkaXVzIC8gMjApO1xuICB9XG4gIGZ1bmN0aW9uIG1vdmVIYW5kcygpIHtcbiAgICBjb25zdCBzZWwgPSBkM1xuICAgICAgLnNlbGVjdChcIiNjbG9jay1oYW5kcy1maW5hbFwiKVxuICAgICAgLnNlbGVjdEFsbChcImxpbmVcIilcbiAgICAgIC5kYXRhKGhhbmREYXRhKVxuICAgICAgLnRyYW5zaXRpb24oKTtcbiAgICBpZiAoZmFuY3lTZWNvbmRzT0ZGKSBzZWwuZWFzZShkMy5lYXNlRWxhc3RpYy5wZXJpb2QoMC41KSk7XG4gICAgc2VsLmF0dHIoXCJ0cmFuc2Zvcm1cIiwgZCA9PiBgcm90YXRlKCR7ZC5zY2FsZShkLnZhbHVlKX0pYCk7XG4gIH1cbiAgZnVuY3Rpb24gdXBkYXRlRGF0YSgpIHtcbiAgICBoYW5kRGF0YVswXS52YWx1ZSA9ICFmYW5jeVNlY29uZHNPRkYgPyBNYXRoLmZsb29yKHNlbGVjdGVkRXhhY3ROICogMTApIDogZGVjVGltZU5bMF07XG4gICAgaGFuZERhdGFbMV0udmFsdWUgPSAhZmFuY3lTZWNvbmRzT0ZGID8gTWF0aC5mbG9vcihzZWxlY3RlZEV4YWN0TiAqIDEwICUgMSAqIDEwMCkgOiBkZWNUaW1lTi5zbGljZSgyLCA0KTtcbiAgICBoYW5kRGF0YVsyXS52YWx1ZSA9ICFmYW5jeVNlY29uZHNPRkYgPyBzZWxlY3RlZEV4YWN0TiAqIDEwICUgMSAqIDEwMCAlIDEgKiAxMDAgOiBkZWNUaW1lTi5zbGljZSg0LCA2KTtcbiAgfVxuICBjb25zdCBzdmcgPSBkM1xuICAgIC5jcmVhdGUoXCJzdmdcIilcbiAgICAuYXR0cihcInZpZXdCb3hcIiwgWzAsIDAsIHcsIGhdKVxuICAgIC5zdHlsZShcIm1heC13aWR0aFwiLCBgJHt3aWR0aCAvIDIuMX1weGApXG4gICAgLmF0dHIoXCJjbGFzc1wiLCBcImFuYWxvZ2Nsb2NrXCIpXG4gICAgLmF0dHIoXCJpZFwiLCBcIm1pZGNsb2NrXCIpO1xuICBzdmdcbiAgICAuYXBwZW5kKFwidGV4dFwiKVxuICAgIC50ZXh0KGAtJHtkZWNUaW1lTn0tJHtzZWxlY3RlZFpvbmV9YClcbiAgICAuYXR0cihcInhcIiwgY2xvY2tSYWRpdXMgKyBtYXJnaW4pXG4gICAgLmF0dHIoXCJ5XCIsIGNsb2NrUmFkaXVzICogMiArIG1hcmdpbiAqIDIuMSlcbiAgICAuYXR0cihcInRleHQtYW5jaG9yXCIsIFwibWlkZGxlXCIpXG4gICAgLmF0dHIoXCJmb250LXNpemVcIiwgMzIpXG4gICAgLmF0dHIoXCJmb250LWZhbWlseVwiLCBcIm1vbm9zcGFjZVwiKTtcbiAgZHJhd0Nsb2NrKCk7XG4gIC8vIEFuaW1hdGlvblxuICBjb25zdCBpbnRlcnZhbCA9IHNldEludGVydmFsKFxuICAgICgpID0+IHtcbiAgICAgIHVwZGF0ZURhdGEoKTtcbiAgICAgIG1vdmVIYW5kcygpO1xuICAgIH0sXG4gICAgIWZhbmN5U2Vjb25kc09GRiA/IDEwIDogODY0XG4gICk7XG4gIGludmFsaWRhdGlvbi50aGVuKCgpID0+IGNsZWFySW50ZXJ2YWwoaW50ZXJ2YWwpKTtcbiAgcmV0dXJuIHN2Zy5ub2RlKCk7XG59XG4ifSx7Im1ldGhvZE5hbWUiOiJpbnRlcnByZXQiLCJjZWxsTmFtZSI6Im9qcy1jZWxsLTI4IiwiaW5saW5lIjpmYWxzZSwic291cmNlIjoiLy8gaHR0cHM6Ly9vYnNlcnZhYmxlaHEuY29tL0BsZGdycC9hcHBsZS13YXRjaC1zb2xhci1kaWFsLXNpbXVsYXRpb25cbnN1bmNsb2NrID0ge1xuICBjb25zdCByYWRpdXMgPSAyMDA7XG4gIGNvbnN0IHdpZHRoID0gcmFkaXVzICogMjtcbiAgY29uc3QgaGVpZ2h0ID0gcmFkaXVzICogMjtcbiAgLy9sZXQgX21pbnV0ZXMgPSAwO1xuICBjb25zdCBzdmcgPSBkM1xuICAgIC5jcmVhdGUoXCJzdmdcIilcbiAgICAuYXR0cihcImlkXCIsIFwiYnRtY2xvY2tcIilcbiAgICAuYXR0cihcInZpZXdCb3hcIiwgWzAsIDAsIHdpZHRoLCBoZWlnaHRdKVxuICAgIC5zdHlsZShcIm1hcmdpbi10b3BcIiwgXCIxcHhcIilcbiAgICAuc3R5bGUoXCJtYXgtd2lkdGhcIiwgXCIyMDBweFwiKTtcbiAgY29uc3QgZmFjZSA9IHN2Z1xuICAgIC5hcHBlbmQoXCJnXCIpXG4gICAgLmF0dHIoXCJ0cmFuc2Zvcm1cIiwgYHRyYW5zbGF0ZSgke3dpZHRoIC8gMn0sICR7aGVpZ2h0IC8gMn0pYCk7XG4gIGZvciAoY29uc3QgYW5nbGUgb2YgYW5nbGVzKSB7XG4gICAgY29uc3QgYXJjID0gZDNcbiAgICAgIC5hcmMoKVxuICAgICAgLmlubmVyUmFkaXVzKDApXG4gICAgICAub3V0ZXJSYWRpdXMocmFkaXVzKVxuICAgICAgLnN0YXJ0QW5nbGUoYW5nbGUuc3RhcnQpXG4gICAgICAuZW5kQW5nbGUoYW5nbGUuZW5kKTtcbiAgICBmYWNlLmFwcGVuZChcInBhdGhcIikuYXR0cihcImRcIiwgYXJjKS5hdHRyKFwiZmlsbFwiLCBhbmdsZS5jb2xvcik7XG4gIH1cbiAgY29uc3Qgc3VuID0gZmFjZVxuICAgIC5hcHBlbmQoXCJjaXJjbGVcIilcbiAgICAuYXR0cihcInJcIiwgMTUpXG4gICAgLmF0dHIoXCJjeFwiLCAxMjUgKiAtc2luKGFzdERlZ01hcFBsb3QpKVxuICAgIC5hdHRyKFwiY3lcIiwgMTI1ICogY29zKGFzdERlZ01hcFBsb3QpKVxuICAgIC5zdHlsZShcImZpbGxcIiwgXCJ3aGl0ZVwiKTtcbiAgY29uc3QgcmluZ0NvbnRhaW5lciA9IHN2Z1xuICAgIC5hcHBlbmQoXCJnXCIpXG4gICAgLmF0dHIoXCJ0cmFuc2Zvcm1cIiwgYHRyYW5zbGF0ZSgke3dpZHRoIC8gMn0sICR7aGVpZ2h0IC8gMn0pYCk7XG4gIGNvbnN0IHJpbmcgPSByaW5nQ29udGFpbmVyXG4gICAgLmFwcGVuZChcImNpcmNsZVwiKVxuICAgIC5hdHRyKFwiclwiLCAxMjUpXG4gICAgLnN0eWxlKFwib3BhY2l0eVwiLCAwLjIpXG4gICAgLnN0eWxlKFwiZmlsbFwiLCBcInRyYW5zcGFyZW50XCIpXG4gICAgLnN0eWxlKFwic3Ryb2tlXCIsIFwid2hpdGVcIilcbiAgICAuc3R5bGUoXCJzdHJva2Utd2lkdGhcIiwgMyk7XG4gIGNvbnN0IGV2ZW50cyA9IFtcbiAgICBkYXRhLmFzdHJvbm9taWNhbFN1bnJpc2UsXG4gICAgZGF0YS5hc3Ryb25vbWljYWxTdW5zZXQsXG4gICAgZGF0YS5uYXV0aWNhbFN1bnJpc2UsXG4gICAgZGF0YS5uYXV0aWNhbFN1bnNldCxcbiAgICBkYXRhLmNpdmlsU3VucmlzZSxcbiAgICBkYXRhLmNpdmlsU3Vuc2V0LFxuICAgIGRhdGEuc3VucmlzZSxcbiAgICBkYXRhLnN1bnNldCxcbiAgICBkYXRhLnNvbGFyTm9vblxuICBdO1xuICBmb3IgKGNvbnN0IGUgb2YgZXZlbnRzKSB7XG4gICAgcmluZ0NvbnRhaW5lclxuICAgICAgLmFwcGVuZChcImNpcmNsZVwiKVxuICAgICAgLmF0dHIoXCJyXCIsIDUpXG4gICAgICAuYXR0cihcImN4XCIsIDEyNSAqIE1hdGguc2luKGUpKVxuICAgICAgLmF0dHIoXCJjeVwiLCAxMjUgKiAtTWF0aC5jb3MoZSkpXG4gICAgICAuc3R5bGUoXCJvcGFjaXR5XCIsIDAuNClcbiAgICAgIC5zdHlsZShcImZpbGxcIiwgXCJ3aGl0ZVwiKTtcbiAgfVxuICBjb25zdCBkaWdpdGFsQ2xvY2sgPSBzdmdcbiAgICAuYXBwZW5kKFwiZ1wiKVxuICAgIC5hdHRyKFxuICAgICAgXCJ0cmFuc2Zvcm1cIixcbiAgICAgIGB0cmFuc2xhdGUoJHt3aWR0aCAvIDIgKyA0NSAqIHNpbihhc3REZWdNYXBQbG90KX0sICR7XG4gICAgICAgIGhlaWdodCAvIDIgKyA0NSAqIC1jb3MoYXN0RGVnTWFwUGxvdClcbiAgICAgIH0pYFxuICAgICk7XG4gIGNvbnN0IGRpZ2l0YWxDbG9ja0Jhc2UgPSBkaWdpdGFsQ2xvY2tcbiAgICAuYXBwZW5kKFwiY2lyY2xlXCIpXG4gICAgLmF0dHIoXCJyXCIsIDEwMClcbiAgICAuc3R5bGUoXCJvcGFjaXR5XCIsIDAuMjEpXG4gICAgLnN0eWxlKFwiZmlsbFwiLCBcIndoaXRlXCIpO1xuLy8gIGNvbnN0IGRpZ2l0YWxDbG9ja1RpY2tzID0gZGlnaXRhbENsb2NrXG4vLyAgICAuc2VsZWN0QWxsKFwiLmRpZ2l0YWwtY2xvY2stdGlja1wiKVxuLy8gICAgLmRhdGEoZDMucmFuZ2UoMCwgNjApKVxuLy8gICAgLmVudGVyKClcbi8vICAgIC5hcHBlbmQoXCJsaW5lXCIpXG4vLyAgICAuYXR0cihcImNsYXNzXCIsIFwiZGlnaXRhbC1jbG9jay10aWNrXCIpXG4vLyAgICAuYXR0cihcIngxXCIsIDApXG4vLyAgICAuYXR0cihcIngyXCIsIDApXG4vLyAgICAuYXR0cihcInkxXCIsIDEwMCAtIDUpXG4vLyAgICAuYXR0cihcInkyXCIsIDEwMCAtIDEwKVxuLy8gICAgLmF0dHIoXCJzdHJva2VcIiwgKGQpID0+IChkID4gc2Vjb25kcyA/IFwiYmxhY2tcIiA6IFwid2hpdGVcIikpXG4vLyAgICAuYXR0cihcInN0cm9rZS13aWR0aFwiLCBcIjNcIilcbi8vICAgIC5hdHRyKFwic3Ryb2tlLWxpbmVjYXBcIiwgXCJyb3VuZFwiKVxuLy8gICAgLnN0eWxlKFwibWl4LWJsZW5kLW1vZGVcIiwgXCJsdW1pbmFuY2VcIilcbi8vICAgIC5zdHlsZShcIm9wYWNpdHlcIiwgMC42KVxuLy8gICAgLmF0dHIoXCJ0cmFuc2Zvcm1cIiwgKGQpID0+IGByb3RhdGUoJHsxODAgKyBkICogNn0pYCk7XG4gIGNvbnN0IGNsb2NrVGV4dCA9IGRpZ2l0YWxDbG9ja1xuICAgIC5hcHBlbmQoXCJ0ZXh0XCIpXG4gICAgLmF0dHIoXCJ5XCIsIDI1KVxuICAgIC5hdHRyKFwiZmlsbFwiLCBcIndoaXRlXCIpXG4gICAgLmF0dHIoXCJ0ZXh0LWFuY2hvclwiLCBcIm1pZGRsZVwiKVxuICAgIC5hdHRyKFwiZm9udC1mYW1pbHlcIiwgXCJIZWx2ZXRpY2EsIEFyaWFsLCBzYW5zLXNlcmlmXCIpXG4gICAgLnN0eWxlKFwib3BhY2l0eVwiLCAxKVxuICAgIC5hdHRyKFwiZm9udC13ZWlnaHRcIiwgNjAwKVxuICAgIC5hdHRyKFwiZm9udC1zaXplXCIsIFwiNzVweFwiKVxuICAgIC50ZXh0KGFzdERlY01hcFBsb3QudG9GaXhlZCgyKSk7XG4gIGNvbnN0IHRpY2tzID0gZmFjZVxuICAgIC5zZWxlY3RBbGwoXCIudGlja1wiKVxuICAgIC5kYXRhKGQzLnJhbmdlKDAsIDIwKSlcbiAgICAuZW50ZXIoKVxuICAgIC5hcHBlbmQoXCJsaW5lXCIpXG4gICAgLmF0dHIoXCJjbGFzc1wiLCBcInRpY2tcIilcbiAgICAuYXR0cihcIngxXCIsIDApXG4gICAgLmF0dHIoXCJ4MlwiLCAwKVxuICAgIC5hdHRyKFwieTFcIiwgcmFkaXVzIC0gNSlcbiAgICAuYXR0cihcInkyXCIsIHJhZGl1cyAtIDIwKVxuICAgIC5hdHRyKFwic3Ryb2tlXCIsIFwid2hpdGVcIilcbiAgICAuYXR0cihcInN0cm9rZS13aWR0aFwiLCBcIjNcIilcbiAgICAuYXR0cihcInN0cm9rZS1saW5lY2FwXCIsIFwicm91bmRcIilcbiAgICAuc3R5bGUoXCJtaXgtYmxlbmQtbW9kZVwiLCBcInNjcmVlblwiKVxuICAgIC5zdHlsZShcIm9wYWNpdHlcIiwgMSlcbiAgICAuYXR0cihcInRyYW5zZm9ybVwiLCAoZCkgPT4gYHJvdGF0ZSgke2QgKiAxOH0pYCk7XG4gIGNvbnN0IG1pbnV0ZVRpY2tzID0gZmFjZVxuICAgIC5zZWxlY3RBbGwoXCIudGlja1wiKVxuICAgIC5kYXRhKGQzLnJhbmdlKDAsIDIwMCkpXG4gICAgLmVudGVyKClcbiAgICAuYXBwZW5kKFwibGluZVwiKVxuICAgIC5hdHRyKFwiY2xhc3NcIiwgXCJ0aWNrXCIpXG4gICAgLmF0dHIoXCJ4MVwiLCAwKVxuICAgIC5hdHRyKFwieDJcIiwgMClcbiAgICAuYXR0cihcInkxXCIsIHJhZGl1cyAtIDUpXG4gICAgLmF0dHIoXCJ5MlwiLCByYWRpdXMgLSAxNSlcbiAgICAuYXR0cihcInN0cm9rZVwiLCBcIndoaXRlXCIpXG4gICAgLmF0dHIoXCJzdHJva2Utd2lkdGhcIiwgXCIyXCIpXG4gICAgLmF0dHIoXCJzdHJva2UtbGluZWNhcFwiLCBcInJvdW5kXCIpXG4gICAgLnN0eWxlKFwibWl4LWJsZW5kLW1vZGVcIiwgXCJzY3JlZW5cIilcbiAgICAuc3R5bGUoXCJvcGFjaXR5XCIsIDAuNilcbiAgICAuYXR0cihcInRyYW5zZm9ybVwiLCAoZCkgPT4gYHJvdGF0ZSgke2QgKiAyfSlgKTtcbiAgY29uc3QgaG91ckxhYmVscyA9IGZhY2VcbiAgICAuc2VsZWN0QWxsKFwiLmhvdXItbGFiZWxcIilcbiAgICAuZGF0YShkMy5yYW5nZSgwLCAxMCkpXG4gICAgLmVudGVyKClcbiAgICAuYXBwZW5kKFwidGV4dFwiKVxuICAgIC5hdHRyKFwiY2xhc3NcIiwgXCJob3VyLWxhYmVsXCIpXG4gICAgLmF0dHIoXCJ4XCIsIChkKSA9PiAxNjAgKiAtTWF0aC5zaW4odG9SYWRpYW5zKChkIC8gMTApICogMzYwKSkpXG4gICAgLmF0dHIoXCJ5XCIsIChkKSA9PiAxNjAgKiBNYXRoLmNvcyh0b1JhZGlhbnMoKGQgLyAxMCkgKiAzNjApKSArIDEyKVxuICAgIC5hdHRyKFwiZmlsbFwiLCBcIndoaXRlXCIpXG4gICAgLmF0dHIoXCJ0ZXh0LWFuY2hvclwiLCBcIm1pZGRsZVwiKVxuICAgIC5hdHRyKFwiZm9udC1mYW1pbHlcIiwgXCJIZWx2ZXRpY2EsIEFyaWFsLCBzYW5zLXNlcmlmXCIpXG4gICAgLmF0dHIoXCJmb250LXdlaWdodFwiLCA2MDApXG4gICAgLmF0dHIoXCJmb250LXNpemVcIiwgXCIzOHB4XCIpXG4gICAgLnN0eWxlKFwib3BhY2l0eVwiLCAwLjcpXG4gICAgLnRleHQoKGQpID0+IChTdHJpbmcoZCkpKTtcbiAgcmV0dXJuIHN2Zy5ub2RlKCk7XG59XG5taW51dGVzQW5kU2Vjb25kcyA9IHtcbiAgd2hpbGUgKHRydWUpIHtcbiAgICBhd2FpdCBQcm9taXNlcy5kZWxheSgxMDAwKTtcbiAgICBjb25zdCBkYXRlID0gbmV3IERhdGUoKTtcbiAgICB5aWVsZCB7XG4gICAgICBtaW51dGVzOiBkYXRlLmdldEhvdXJzKCkgKiA2MCArIGRhdGUuZ2V0TWludXRlcygpLFxuICAgICAgc2Vjb25kczogZGF0ZS5nZXRTZWNvbmRzKClcbiAgICB9O1xuICB9XG59XG5mdW5jdGlvbiBtaW51dGVzVG8xMkhvdXJUaW1lKG1pbnV0ZXMpIHtcbiAgY29uc3QgZGVjaWRheXMgPSBtaW51dGVzIC8gMTQ0ICUgMTBcbiAgcmV0dXJuIGRlY2lkYXlzLnRvRml4ZWQoMik7XG59XG52aWV3b2YgZGF0ZSA9IElucHV0cy5kYXRlKHsgbGFiZWw6IFwiRGF0ZVwiLCB2YWx1ZTogRGF0ZS5ub3coKSB9KVxuSkQgPSBnZXRKdWxpYW5EYXRlKGRhdGUpXG5UID0gKEpEIC0gMjQ1MTU0NS4wKSAvIDM2NTI1XG5zdW5fZ2VvbWV0cmljX21lYW5fbG9uZ2l0dWRlID0gMjgwLjQ2NjQ2ICsgMzYwMDAuNzY5ODMgKiBUICsgMC4wMDAzMDMyICogVCAqKiAyXG5zdW5fbWVhbl9hbm9tYWx5ID0gMzU3LjUyOTExICsgMzU5OTkuMDUwMjkgKiBUIC0gMC4wMDAxNTM3ICogVCAqKiAyXG5lYXJ0aF9lY2NlbnRyaWNpdHlfb3JiaXQgPSAwLjAxNjcwODYzNCAtIDAuMDAwMDQyMDM3ICogVCAtIDAuMDAwMDAwMTI2NyAqIFQgKiogMlxuc3VuX2VxdWF0aW9uX29mX3RoZV9jZW50ZXIgPSAoMS45MTQ2MDIgLSAwLjAwNDgxNyAqIFQgLSAwLjAwMDAxNCAqIFQgKiogMikgKiBzaW4oc3VuX21lYW5fYW5vbWFseSkgKyAoMC4wMTk5OTMgLSAwLjAwMDEwMSAqIFQpICogc2luKDIgKiBzdW5fbWVhbl9hbm9tYWx5KSArIDAuMDAwMjg5ICogc2luKDMgKiBzdW5fbWVhbl9hbm9tYWx5KVxuc3VuX3RydWVfbG9uZ2l0dWRlID0gc3VuX2dlb21ldHJpY19tZWFuX2xvbmdpdHVkZSArIHN1bl9lcXVhdGlvbl9vZl90aGVfY2VudGVyXG5zdW5fdHJ1ZV9hbm9tYWx5ID0gc3VuX21lYW5fYW5vbWFseSArIHN1bl9lcXVhdGlvbl9vZl90aGVfY2VudGVyXG5vbWVnYSA9IDEyNS4wNCAtIDE5MzQuMTM2ICogVFxuc3VuX2FwYXJyZW50X2xvbmdpdHVkZSA9IHN1bl90cnVlX2xvbmdpdHVkZSAtIDAuMDA1NjkgLSAwLjAwNDc4ICogc2luKG9tZWdhKVxuc3VuX2VjbGlwdGljX29ibGlxdWl0eSA9IDIzICsgKDI2ICsgKDIxLjQ0OCAtIDQ2LjgxNSAqIFQgLSAwLjAwMDU5ICogVCAqKiAyICsgMC4wMDE4MTMgKiBUICoqIDMpIC8gNjApIC8gNjBcbnN1bl9lY2xpcHRpY19vYmxpcXVpdHlfY29ycmVjdGVkID0gc3VuX2VjbGlwdGljX29ibGlxdWl0eSArIDAuMDAyNTYgKiBjb3Mob21lZ2EpXG5zdW5fcmlnaHRfYXNjZW5zaW9uID0gTWF0aC5hdGFuMihcbiAgY29zKHN1bl9lY2xpcHRpY19vYmxpcXVpdHlfY29ycmVjdGVkKSAqIHNpbihzdW5fYXBhcnJlbnRfbG9uZ2l0dWRlKSxcbiAgY29zKHN1bl9hcGFycmVudF9sb25naXR1ZGUpXG4pXG5zdW5fZGVjbGluYXRpb24gPSBNYXRoLmFzaW4oXG4gIHNpbihzdW5fZWNsaXB0aWNfb2JsaXF1aXR5X2NvcnJlY3RlZCkgKiBzaW4oc3VuX2FwYXJyZW50X2xvbmdpdHVkZSlcbilcbnkgPSBNYXRoLnRhbih0b1JhZGlhbnMoc3VuX2VjbGlwdGljX29ibGlxdWl0eV9jb3JyZWN0ZWQpIC8gMikgKiogMlxuZXF1YXRpb25fb2ZfdGltZSA9IHRvRGVncmVlcyhcbiAgeSAqIHNpbigyICogKHN1bl9nZW9tZXRyaWNfbWVhbl9sb25naXR1ZGUpKSAtXG4gICAgMiAqIGVhcnRoX2VjY2VudHJpY2l0eV9vcmJpdCAqIHNpbigoc3VuX21lYW5fYW5vbWFseSkpICtcbiAgICA0ICogZWFydGhfZWNjZW50cmljaXR5X29yYml0ICogeSAqIHNpbigoc3VuX21lYW5fYW5vbWFseSkpICogY29zKDIgKiAoc3VuX2dlb21ldHJpY19tZWFuX2xvbmdpdHVkZSkpIC1cbiAgICAoMSAvIDIpICogeSAqKiAyICogc2luKDQgKiAoc3VuX2dlb21ldHJpY19tZWFuX2xvbmdpdHVkZSkpIC1cbiAgICAoNSAvIDQpICogZWFydGhfZWNjZW50cmljaXR5X29yYml0ICoqIDIgKiBzaW4oMiAqIChzdW5fbWVhbl9hbm9tYWx5KSlcbikgKiA0XG5ob3VyX2FuZ2xlID0gc2hhRGVnck1hcFBsb3RcbnN1bl90cmFuc2l0ID0gc29sYXJOb29uTWludVxuc3VuX3Jpc2UgPSBzdW5fdHJhbnNpdCAtIGhvdXJfYW5nbGUgKiA0XG5zdW5fc2V0ID0gc3VuX3RyYW5zaXQgKyBob3VyX2FuZ2xlICogNFxuc3VuX2R1cmF0aW9uID0gc3VuX3NldCAtIHN1bl9yaXNlXG5zdW5fY2l2aWxfcmlzZSA9IHN1bl90cmFuc2l0IC0gKGhvdXJfYW5nbGUgKyA2KSAqIDRcbnN1bl9uYXV0aWNhbF9yaXNlID0gc3VuX3RyYW5zaXQgLSAoaG91cl9hbmdsZSArIDEyKSAqIDRcbnN1bl9hc3Ryb25vbWljYWxfcmlzZSA9IHN1bl90cmFuc2l0IC0gKGhvdXJfYW5nbGUgKyAxOCkgKiA0XG5zdW5fY2l2aWxfc2V0ID0gc3VuX3RyYW5zaXQgKyAoaG91cl9hbmdsZSArIDYpICogNFxuc3VuX25hdXRpY2FsX3NldCA9IHN1bl90cmFuc2l0ICsgKGhvdXJfYW5nbGUgKyAxMikgKiA0XG5zdW5fYXN0cm9ub21pY2FsX3NldCA9IHN1bl90cmFuc2l0ICsgKGhvdXJfYW5nbGUgKyAxOCkgKiA0XG5kYXRhID0gKHtcbiAgYXN0cm9ub21pY2FsU3VucmlzZTpcbiAgICB0b1JhZGlhbnMoKHN1bl9hc3Ryb25vbWljYWxfcmlzZSAvIDE0NDApICogMzYwKSArIE1hdGguUEksXG4gIG5hdXRpY2FsU3VucmlzZTogdG9SYWRpYW5zKChzdW5fbmF1dGljYWxfcmlzZSAvIDE0NDApICogMzYwKSArIE1hdGguUEksXG4gIGNpdmlsU3VucmlzZTogdG9SYWRpYW5zKChzdW5fY2l2aWxfcmlzZSAvIDE0NDApICogMzYwKSArIE1hdGguUEksXG4gIHN1bnJpc2U6IHRvUmFkaWFucygoc3VuX3Jpc2UgLyAxNDQwKSAqIDM2MCkgKyBNYXRoLlBJLFxuICBzdW5zZXQ6IHRvUmFkaWFucygoc3VuX3NldCAvIDE0NDApICogMzYwKSArIE1hdGguUEksXG4gIGNpdmlsU3Vuc2V0OiB0b1JhZGlhbnMoKHN1bl9jaXZpbF9zZXQgLyAxNDQwKSAqIDM2MCkgKyBNYXRoLlBJLFxuICBuYXV0aWNhbFN1bnNldDogdG9SYWRpYW5zKChzdW5fbmF1dGljYWxfc2V0IC8gMTQ0MCkgKiAzNjApICsgTWF0aC5QSSxcbiAgYXN0cm9ub21pY2FsU3Vuc2V0OiB0b1JhZGlhbnMoKHN1bl9hc3Ryb25vbWljYWxfc2V0IC8gMTQ0MCkgKiAzNjApICsgTWF0aC5QSSxcbiAgc29sYXJOb29uOiB0b1JhZGlhbnMoKHN1bl90cmFuc2l0IC8gMTQ0MCkgKiAzNjApICsgTWF0aC5QSSxcbiAgZGF5TGVuZ3RoOiBzdW5fZHVyYXRpb25cbn0pXG5hbmdsZXMgPSBbXG4gIHtcbiAgICBzdGFydDogZGF0YS5hc3Ryb25vbWljYWxTdW5yaXNlLFxuICAgIGVuZDogZGF0YS5uYXV0aWNhbFN1bnJpc2UsXG4gICAgY29sb3I6IFwicmdiKDE3LDQ5LDg2KVwiXG4gIH0sXG4gIHtcbiAgICBzdGFydDogZGF0YS5uYXV0aWNhbFN1bnJpc2UsXG4gICAgZW5kOiBkYXRhLmNpdmlsU3VucmlzZSxcbiAgICBjb2xvcjogXCJyZ2IoMjMsNjEsMTEyKVwiXG4gIH0sXG4gIHsgc3RhcnQ6IGRhdGEuY2l2aWxTdW5yaXNlLCBlbmQ6IGRhdGEuc3VucmlzZSwgY29sb3I6IFwicmdiKDM1LDg1LDE1NSlcIiB9LFxuICB7IHN0YXJ0OiBkYXRhLnN1bnJpc2UsIGVuZDogZGF0YS5zdW5zZXQsIGNvbG9yOiBcInJnYig3MCwxNTUsMjQ1KVwiIH0sXG4gIHsgc3RhcnQ6IGRhdGEuc3Vuc2V0LCBlbmQ6IGRhdGEuY2l2aWxTdW5zZXQsIGNvbG9yOiBcInJnYigzNSw4NSwxNTUpXCIgfSxcbiAge1xuICAgIHN0YXJ0OiBkYXRhLmNpdmlsU3Vuc2V0LFxuICAgIGVuZDogZGF0YS5uYXV0aWNhbFN1bnNldCxcbiAgICBjb2xvcjogXCJyZ2IoMjMsNjEsMTEyKVwiXG4gIH0sXG4gIHtcbiAgICBzdGFydDogZGF0YS5uYXV0aWNhbFN1bnNldCxcbiAgICBlbmQ6IGRhdGEuYXN0cm9ub21pY2FsU3Vuc2V0LFxuICAgIGNvbG9yOiBcInJnYigxNyw0OSw4NilcIlxuICB9LFxuICB7XG4gICAgc3RhcnQ6IGRhdGEuYXN0cm9ub21pY2FsU3Vuc2V0LFxuICAgIGVuZDogZGF0YS5hc3Ryb25vbWljYWxTdW5yaXNlICsgTWF0aC5QSSAqIDIsXG4gICAgY29sb3I6IFwicmdiKDEwLDM0LDU4KVwiXG4gIH1cbl1cbmdldEp1bGlhbkRhdGUgPSAodGltZXN0YW1wKSA9PiB7XG4gIHJldHVybiBuZXcgRGF0ZSh0aW1lc3RhbXApIC8gODY0MDAwMDAgKyAyNDQwNTg3LjU7XG59XG5zaW4gPSAoeCkgPT4gTWF0aC5zaW4odG9SYWRpYW5zKHgpKVxuY29zID0gKHgpID0+IE1hdGguY29zKHRvUmFkaWFucyh4KSlcbnNvbGFyTm9vblR1cm4gPSAoOS41NSArIHNlbGVjdGVkWm9uZSAvIDEwIC0gbG9uVHVybk1hcFBsb3QgLSBlb3RUdXJuTWFwUGxvdCkgJSAxXG5zb2xhck5vb25NaW51ID0gc29sYXJOb29uVHVybiAqIDE0NDBcbiJ9LHsibWV0aG9kTmFtZSI6ImludGVycHJldCIsImNlbGxOYW1lIjoib2pzLWNlbGwtMjkiLCJpbmxpbmUiOmZhbHNlLCJzb3VyY2UiOiJodG1sYFxuPHN0eWxlPlxuLmNvbG9yTmlnaHQge1xuICBiYWNrZ3JvdW5kOiAjNDE2Zjg2O1xuICBjb2xvcjogd2hpdGU7XG4gIHBhZGRpbmc6IDBweCAycHggMHB4IDRweDtcbiAgYm9yZGVyLXJhZGl1czogNHB4O1xuICBmb250LXdlaWdodDogNDAwO1xuICBmb250LWZhbWlseTogbW9ub3NwYWNlO1xufVxuLmNvbG9yRGF5IHtcbiAgYmFja2dyb3VuZDogI2ZmZTQzODtcbiAgY29sb3I6IGJsYWNrO1xuICBwYWRkaW5nOiAwcHggM3B4IDBweCA0cHg7XG4gIGJvcmRlci1yYWRpdXM6IDRweDtcbiAgZm9udC13ZWlnaHQ6IDQwMDtcbiAgZm9udC1mYW1pbHk6IG1vbm9zcGFjZTtcbn1cbi5jb2xvckJrZyB7XG4gIGJhY2tncm91bmQ6ICR7d2luZG93LmRhcmttb2RlID8gXCJibGFja1wiIDogXCJ3aGl0ZVwifTtcbiAgY29sb3I6ICR7d2luZG93LmRhcmttb2RlID8gXCJ3aGl0ZVwiIDogXCJibGFja1wifTtcbiAgcGFkZGluZzogMHB4IDVweDtcbiAgYm9yZGVyLXJhZGl1czogNHB4O1xuICBmb250LXdlaWdodDogNDAwO1xuICBmb250LWZhbWlseTogbW9ub3NwYWNlO1xufVxuLmNvbG9yMCB7XG4gIGJhY2tncm91bmQ6IGhzbCgwIDEwMCUgNTAlKTtcbiAgY29sb3I6ICR7eWlxKGBoc2woMCwgMTAwJSwgNTAlKWApID4gMC41MSA/IFwiYmxhY2tcIiA6IFwid2hpdGVcIn07XG4gIHBhZGRpbmc6IDBweCA1cHg7XG4gIGJvcmRlci1yYWRpdXM6IDRweDtcbiAgZm9udC13ZWlnaHQ6IDQwMDtcbiAgZm9udC1mYW1pbHk6IG1vbm9zcGFjZTtcbn1cbi5jb2xvcjFieTg2NDAge1xuICBiYWNrZ3JvdW5kOiBoc2woJHtoMWJ5ODY0MH0gMTAwJSA1MCUpO1xuICBjb2xvcjogJHt5aXEoYGhzbCgke2gxYnk4NjQwfSwgMTAwJSwgNTAlKWApID4gMC41MSA/IFwiYmxhY2tcIiA6IFwid2hpdGVcIn07XG4gIHBhZGRpbmc6IDBweCA1cHg7XG4gIGJvcmRlci1yYWRpdXM6IDRweDtcbiAgZm9udC13ZWlnaHQ6IDQwMDtcbiAgZm9udC1mYW1pbHk6IG1vbm9zcGFjZTtcbn1cbi5jb2xvcjEge1xuICBiYWNrZ3JvdW5kOiBoc2woMzAwIDEwMCUgNTAlKTtcbiAgY29sb3I6ICR7eWlxKGBoc2woMzAwLCAxMDAlLCA1MCUpYCkgPiAwLjUxID8gXCJibGFja1wiIDogXCJ3aGl0ZVwifTtcbiAgcGFkZGluZzogMHB4IDVweDtcbiAgYm9yZGVyLXJhZGl1czogNHB4O1xuICBmb250LXdlaWdodDogNDAwO1xuICBmb250LWZhbWlseTogbW9ub3NwYWNlO1xufVxuLmNvbG9yMiB7XG4gIGJhY2tncm91bmQ6IGhzbCgyODAgMTAwJSA1MCUpO1xuICBjb2xvcjogJHt5aXEoYGhzbCgyODAsIDEwMCUsIDUwJSlgKSA+IDAuNTEgPyBcImJsYWNrXCIgOiBcIndoaXRlXCJ9O1xuICBwYWRkaW5nOiAwcHggNXB4O1xuICBib3JkZXItcmFkaXVzOiA0cHg7XG4gIGZvbnQtd2VpZ2h0OiA0MDA7XG4gIGZvbnQtZmFtaWx5OiBtb25vc3BhY2U7XG59XG4uY29sb3IzIHtcbiAgYmFja2dyb3VuZDogaHNsKDI0MCAxMDAlIDUwJSk7XG4gIGNvbG9yOiAke3lpcShgaHNsKDI0MCwgMTAwJSwgNTAlKWApID4gMC41MSA/IFwiYmxhY2tcIiA6IFwid2hpdGVcIn07XG4gIHBhZGRpbmc6IDBweCA1cHg7XG4gIGJvcmRlci1yYWRpdXM6IDRweDtcbiAgZm9udC13ZWlnaHQ6IDQwMDtcbiAgZm9udC1mYW1pbHk6IG1vbm9zcGFjZTtcbn1cbi5jb2xvcjQge1xuICBiYWNrZ3JvdW5kOiBoc2woMjAwIDEwMCUgNTAlKTtcbiAgY29sb3I6ICR7eWlxKGBoc2woMjAwLCAxMDAlLCA1MCUpYCkgPiAwLjUxID8gXCJibGFja1wiIDogXCJ3aGl0ZVwifTtcbiAgcGFkZGluZzogMHB4IDVweDtcbiAgYm9yZGVyLXJhZGl1czogNHB4O1xuICBmb250LXdlaWdodDogNDAwO1xuICBmb250LWZhbWlseTogbW9ub3NwYWNlO1xufVxuLmNvbG9yNSB7XG4gIGJhY2tncm91bmQ6IGhzbCgxODAgMTAwJSA1MCUpO1xuICBjb2xvcjogJHt5aXEoYGhzbCgxODAsIDEwMCUsIDUwJSlgKSA+IDAuNTEgPyBcImJsYWNrXCIgOiBcIndoaXRlXCJ9O1xuICBwYWRkaW5nOiAwcHggNXB4O1xuICBib3JkZXItcmFkaXVzOiA0cHg7XG4gIGZvbnQtd2VpZ2h0OiA0MDA7XG4gIGZvbnQtZmFtaWx5OiBtb25vc3BhY2U7XG59XG4uY29sb3I1ODMge1xuICBiYWNrZ3JvdW5kOiBoc2woMTI5Ljg4MjM1Mjk0MTE3NjQ2IDEwMCUgNTAlKTtcbiAgY29sb3I6ICR7eWlxKGBoc2woMTI5Ljg4MjM1Mjk0MTE3NjQ2LCAxMDAlLCA1MCUpYCkgPiAwLjUxID8gXCJibGFja1wiIDogXCJ3aGl0ZVwifTtcbiAgcGFkZGluZzogMHB4IDVweDtcbiAgYm9yZGVyLXJhZGl1czogNHB4O1xuICBmb250LXdlaWdodDogNDAwO1xuICBmb250LWZhbWlseTogbW9ub3NwYWNlO1xufVxuLmNvbG9yNiB7XG4gIGJhY2tncm91bmQ6IGhzbCgxMjAgMTAwJSA1MCUpO1xuICBjb2xvcjogJHt5aXEoYGhzbCgxMjAsIDEwMCUsIDUwJSlgKSA+IDAuNTEgPyBcImJsYWNrXCIgOiBcIndoaXRlXCJ9O1xuICBwYWRkaW5nOiAwcHggNXB4O1xuICBib3JkZXItcmFkaXVzOiA0cHg7XG4gIGZvbnQtd2VpZ2h0OiA0MDA7XG4gIGZvbnQtZmFtaWx5OiBtb25vc3BhY2U7XG59XG4uY29sb3I3IHtcbiAgYmFja2dyb3VuZDogaHNsKDgwIDEwMCUgNTAlKTtcbiAgY29sb3I6ICR7eWlxKGBoc2woODAsIDEwMCUsIDUwJSlgKSA+IDAuNTEgPyBcImJsYWNrXCIgOiBcIndoaXRlXCJ9O1xuICBwYWRkaW5nOiAwcHggNXB4O1xuICBib3JkZXItcmFkaXVzOiA0cHg7XG4gIGZvbnQtd2VpZ2h0OiA0MDA7XG4gIGZvbnQtZmFtaWx5OiBtb25vc3BhY2U7XG59XG4uY29sb3I4IHtcbiAgYmFja2dyb3VuZDogaHNsKDYwIDEwMCUgNTAlKTtcbiAgY29sb3I6ICR7eWlxKGBoc2woNjAsIDEwMCUsIDUwJSlgKSA+IDAuNTEgPyBcImJsYWNrXCIgOiBcIndoaXRlXCJ9O1xuICBwYWRkaW5nOiAwcHggNXB4O1xuICBib3JkZXItcmFkaXVzOiA0cHg7XG4gIGZvbnQtd2VpZ2h0OiA0MDA7XG4gIGZvbnQtZmFtaWx5OiBtb25vc3BhY2U7XG59XG4uY29sb3I5IHtcbiAgYmFja2dyb3VuZDogaHNsKDQwIDEwMCUgNTAlKTtcbiAgY29sb3I6ICR7eWlxKGBoc2woNDAsIDEwMCUsIDUwJSlgKSA+IDAuNTEgPyBcImJsYWNrXCIgOiBcIndoaXRlXCJ9O1xuICBwYWRkaW5nOiAwcHggNXB4O1xuICBib3JkZXItcmFkaXVzOiA0cHg7XG4gIGZvbnQtd2VpZ2h0OiA0MDA7XG4gIGZvbnQtZmFtaWx5OiBtb25vc3BhY2U7XG59XG4uY29sb3IzNzUge1xuICBiYWNrZ3JvdW5kOiBoc2woJHtodWVzWzAuMzc1XX0gMTAwJSA1MCUpO1xuICBjb2xvcjogJHt5aXEoYGhzbCgke2h1ZXNbMC4zNzVdfSwgMTAwJSwgNTAlKWApID4gMC41MSA/IFwiYmxhY2tcIiA6IFwid2hpdGVcIn07XG4gIHBhZGRpbmc6IDBweCA1cHg7XG4gIGJvcmRlci1yYWRpdXM6IDRweDtcbiAgZm9udC13ZWlnaHQ6IDQwMDtcbiAgZm9udC1mYW1pbHk6IG1vbm9zcGFjZTtcbn1cbi5jb2xvcjAwODMge1xuICBiYWNrZ3JvdW5kOiBoc2woJHtodWVzWzAuMDA4M119IDEwMCUgNTAlKTtcbiAgY29sb3I6ICR7eWlxKGBoc2woJHtodWVzWzAuMDA4M119LCAxMDAlLCA1MCUpYCkgPiAwLjUxID8gXCJibGFja1wiIDogXCJ3aGl0ZVwifTtcbiAgcGFkZGluZzogMHB4IDVweDtcbiAgYm9yZGVyLXJhZGl1czogNHB4O1xuICBmb250LXdlaWdodDogNDAwO1xuICBmb250LWZhbWlseTogbW9ub3NwYWNlO1xufVxuLmNvbG9yMDE2NiB7XG4gIGJhY2tncm91bmQ6IGhzbCgke2h1ZXNbMC4wMTY2XX0gMTAwJSA1MCUpO1xuICBjb2xvcjogJHt5aXEoYGhzbCgke2h1ZXNbMC4wMTY2XX0sIDEwMCUsIDUwJSlgKSA+IDAuNTEgPyBcImJsYWNrXCIgOiBcIndoaXRlXCJ9O1xuICBwYWRkaW5nOiAwcHggNXB4O1xuICBib3JkZXItcmFkaXVzOiA0cHg7XG4gIGZvbnQtd2VpZ2h0OiA0MDA7XG4gIGZvbnQtZmFtaWx5OiBtb25vc3BhY2U7XG59XG4uY29sb3I1NWJ5MjQge1xuICBiYWNrZ3JvdW5kOiBoc2woJHtodWVzWy4wMjI5XX0gMTAwJSA1MCUpO1xuICBjb2xvcjogJHt5aXEoYGhzbCgke2h1ZXNbLjAyMjldfSwgMTAwJSwgNTAlKWApID4gMC41MSA/IFwiYmxhY2tcIiA6IFwid2hpdGVcIn07XG4gIHBhZGRpbmc6IDBweCA1cHg7XG4gIGJvcmRlci1yYWRpdXM6IDRweDtcbiAgZm9udC13ZWlnaHQ6IDQwMDtcbiAgZm9udC1mYW1pbHk6IG1vbm9zcGFjZTtcbn1cbi5jb2xvcjEyNSB7XG4gIGJhY2tncm91bmQ6IGhzbCgke2h1ZXNbLjEyNV19IDEwMCUgNTAlKTtcbiAgY29sb3I6ICR7eWlxKGBoc2woJHtodWVzWy4xMjVdfSwgMTAwJSwgNTAlKWApID4gMC41MSA/IFwiYmxhY2tcIiA6IFwid2hpdGVcIn07XG4gIHBhZGRpbmc6IDBweCA1cHg7XG4gIGJvcmRlci1yYWRpdXM6IDRweDtcbiAgZm9udC13ZWlnaHQ6IDQwMDtcbiAgZm9udC1mYW1pbHk6IG1vbm9zcGFjZTtcbn1cbi5jb2xvcjAyNSB7XG4gIGJhY2tncm91bmQ6IGhzbCgke2h1ZXNbMC4wMjVdfSAxMDAlIDUwJSk7XG4gIGNvbG9yOiAke3lpcShgaHNsKCR7aHVlc1swLjAyNV19LCAxMDAlLCA1MCUpYCkgPiAwLjUxID8gXCJibGFja1wiIDogXCJ3aGl0ZVwifTtcbiAgcGFkZGluZzogMHB4IDVweDtcbiAgYm9yZGVyLXJhZGl1czogNHB4O1xuICBmb250LXdlaWdodDogNDAwO1xuICBmb250LWZhbWlseTogbW9ub3NwYWNlO1xufVxuLmNvbG9yMjg3IHtcbiAgYmFja2dyb3VuZDogaHNsKCR7aHVlc1swLjI4N119IDEwMCUgNTAlKTtcbiAgY29sb3I6ICR7eWlxKGBoc2woJHtodWVzWzAuMjg3XX0sIDEwMCUsIDUwJSlgKSA+IDAuNTEgPyBcImJsYWNrXCIgOiBcIndoaXRlXCJ9O1xuICBwYWRkaW5nOiAwcHggNXB4O1xuICBib3JkZXItcmFkaXVzOiA0cHg7XG4gIGZvbnQtd2VpZ2h0OiA0MDA7XG4gIGZvbnQtZmFtaWx5OiBtb25vc3BhY2U7XG59XG4uY29sb3IzMzMge1xuICBiYWNrZ3JvdW5kOiBoc2woJHtodWVzWzAuMzMzXX0gMTAwJSA1MCUpO1xuICBjb2xvcjogJHt5aXEoYGhzbCgke2h1ZXNbMC4zMzNdfSwgMTAwJSwgNTAlKWApID4gMC41MSA/IFwiYmxhY2tcIiA6IFwid2hpdGVcIn07XG4gIHBhZGRpbmc6IDBweCA1cHg7XG4gIGJvcmRlci1yYWRpdXM6IDRweDtcbiAgZm9udC13ZWlnaHQ6IDQwMDtcbiAgZm9udC1mYW1pbHk6IG1vbm9zcGFjZTtcbn1cbi5jb2xvcjAzMzMge1xuICBiYWNrZ3JvdW5kOiBoc2woJHtodWVzWzAuMDMzM119IDEwMCUgNTAlKTtcbiAgY29sb3I6ICR7eWlxKGBoc2woJHtodWVzWzAuMDMzM119LCAxMDAlLCA1MCUpYCkgPiAwLjUxID8gXCJibGFja1wiIDogXCJ3aGl0ZVwifTtcbiAgcGFkZGluZzogMHB4IDVweDtcbiAgYm9yZGVyLXJhZGl1czogNHB4O1xuICBmb250LXdlaWdodDogNDAwO1xuICBmb250LWZhbWlseTogbW9ub3NwYWNlO1xufVxuLmNvbG9yMDQxNiB7XG4gIGJhY2tncm91bmQ6IGhzbCgke2h1ZXNbMC4wNDE2XX0gMTAwJSA1MCUpO1xuICBjb2xvcjogJHt5aXEoYGhzbCgke2h1ZXNbMC4wNDE2XX0sIDEwMCUsIDUwJSlgKSA+IDAuNTEgPyBcImJsYWNrXCIgOiBcIndoaXRlXCJ9O1xuICBwYWRkaW5nOiAwcHggNXB4O1xuICBib3JkZXItcmFkaXVzOiA0cHg7XG4gIGZvbnQtd2VpZ2h0OiA0MDA7XG4gIGZvbnQtZmFtaWx5OiBtb25vc3BhY2U7XG59XG4uY29sb3I0Mjkge1xuICBiYWNrZ3JvdW5kOiBoc2woJHtodWVzWzAuNDI5XX0gMTAwJSA1MCUpO1xuICBjb2xvcjogJHt5aXEoYGhzbCgke2h1ZXNbMC40MjldfSwgMTAwJSwgNTAlKWApID4gMC41MSA/IFwiYmxhY2tcIiA6IFwid2hpdGVcIn07XG4gIHBhZGRpbmc6IDBweCA1cHg7XG4gIGJvcmRlci1yYWRpdXM6IDRweDtcbiAgZm9udC13ZWlnaHQ6IDQwMDtcbiAgZm9udC1mYW1pbHk6IG1vbm9zcGFjZTtcbn1cbi5jb2xvcjA1IHtcbiAgYmFja2dyb3VuZDogaHNsKCR7aHVlc1swLjA1XX0gMTAwJSA1MCUpO1xuICBjb2xvcjogJHt5aXEoYGhzbCgke2h1ZXNbMC4wNV19LCAxMDAlLCA1MCUpYCkgPiAwLjUxID8gXCJibGFja1wiIDogXCJ3aGl0ZVwifTtcbiAgcGFkZGluZzogMHB4IDVweDtcbiAgYm9yZGVyLXJhZGl1czogNHB4O1xuICBmb250LXdlaWdodDogNDAwO1xuICBmb250LWZhbWlseTogbW9ub3NwYWNlO1xufVxuLmNvbG9yNTMzIHtcbiAgYmFja2dyb3VuZDogaHNsKCR7aHVlc1swLjUzM119IDEwMCUgNTAlKTtcbiAgY29sb3I6ICR7eWlxKGBoc2woJHtodWVzWzAuNTMzXX0sIDEwMCUsIDUwJSlgKSA+IDAuNTEgPyBcImJsYWNrXCIgOiBcIndoaXRlXCJ9O1xuICBwYWRkaW5nOiAwcHggNXB4O1xuICBib3JkZXItcmFkaXVzOiA0cHg7XG4gIGZvbnQtd2VpZ2h0OiA0MDA7XG4gIGZvbnQtZmFtaWx5OiBtb25vc3BhY2U7XG59XG4uY29sb3I5Njkge1xuICBiYWNrZ3JvdW5kOiBoc2woJHtodWVzWzAuOTY5XX0gMTAwJSA1MCUpO1xuICBjb2xvcjogJHt5aXEoYGhzbCgke2h1ZXNbMC45NjldfSwgMTAwJSwgNTAlKWApID4gMC41MSA/IFwiYmxhY2tcIiA6IFwid2hpdGVcIn07XG4gIHBhZGRpbmc6IDBweCA1cHg7XG4gIGJvcmRlci1yYWRpdXM6IDRweDtcbiAgZm9udC13ZWlnaHQ6IDQwMDtcbiAgZm9udC1mYW1pbHk6IG1vbm9zcGFjZTtcbn1cbi5jb2xvcjk5OSB7XG4gIGJhY2tncm91bmQ6IGhzbCgke2h1ZXNbMC45OTldfSAxMDAlIDUwJSk7XG4gIGNvbG9yOiAke3lpcShgaHNsKCR7aHVlc1swLjk5OV19LCAxMDAlLCA1MCUpYCkgPiAwLjUxID8gXCJibGFja1wiIDogXCJ3aGl0ZVwifTtcbiAgcGFkZGluZzogMHB4IDVweDtcbiAgYm9yZGVyLXJhZGl1czogNHB4O1xuICBmb250LXdlaWdodDogNDAwO1xuICBmb250LWZhbWlseTogbW9ub3NwYWNlO1xufVxuLmNvbG9yMWJ5MzIwIHtcbiAgYmFja2dyb3VuZDogaHNsKCR7aDFieTMyMH0gMTAwJSA1MCUpO1xuICBjb2xvcjogJHt5aXEoYGhzbCgke2gxYnkzMjB9LCAxMDAlLCA1MCUpYCkgPiAwLjUxID8gXCJibGFja1wiIDogXCJ3aGl0ZVwifTtcbiAgcGFkZGluZzogMHB4IDVweDtcbiAgYm9yZGVyLXJhZGl1czogNHB4O1xuICBmb250LXdlaWdodDogNDAwO1xuICBmb250LWZhbWlseTogbW9ub3NwYWNlO1xufVxuLmNvbG9yRDEyMSB7XG4gIGJhY2tncm91bmQ6IGhzbCgke2hEMTIxfSAxMDAlIDUwJSk7XG4gIGNvbG9yOiAke3lpcShgaHNsKCR7aEQxMjF9LCAxMDAlLCA1MCUpYCkgPiAwLjUxID8gXCJibGFja1wiIDogXCJ3aGl0ZVwifTtcbiAgcGFkZGluZzogMHB4IDVweDtcbiAgYm9yZGVyLXJhZGl1czogNHB4O1xuICBmb250LXdlaWdodDogNDAwO1xuICBmb250LWZhbWlseTogbW9ub3NwYWNlO1xufVxuLmNvbG9yRDI2OCB7XG4gIGJhY2tncm91bmQ6IGhzbCgke2hEMjY4fSAxMDAlIDUwJSk7XG4gIGNvbG9yOiAke3lpcShgaHNsKCR7aEQyNjh9LCAxMDAlLCA1MCUpYCkgPiAwLjUxID8gXCJibGFja1wiIDogXCJ3aGl0ZVwifTtcbiAgcGFkZGluZzogMHB4IDVweDtcbiAgYm9yZGVyLXJhZGl1czogNHB4O1xuICBmb250LXdlaWdodDogNDAwO1xuICBmb250LWZhbWlseTogbW9ub3NwYWNlO1xufVxuLmNvbG9yRDMwNSB7XG4gIGJhY2tncm91bmQ6IGhzbCgke2hEMzA1fSAxMDAlIDUwJSk7XG4gIGNvbG9yOiAke3lpcShgaHNsKCR7aEQzMDV9LCAxMDAlLCA1MCUpYCkgPiAwLjUxID8gXCJibGFja1wiIDogXCJ3aGl0ZVwifTtcbiAgcGFkZGluZzogMHB4IDVweDtcbiAgYm9yZGVyLXJhZGl1czogNHB4O1xuICBmb250LXdlaWdodDogNDAwO1xuICBmb250LWZhbWlseTogbW9ub3NwYWNlO1xufVxuLmNvbG9yRDMwNiB7XG4gIGJhY2tncm91bmQ6IGhzbCgke2hEMzA2fSAxMDAlIDUwJSk7XG4gIGNvbG9yOiAke3lpcShgaHNsKCR7aEQzMDZ9LCAxMDAlLCA1MCUpYCkgPiAwLjUxID8gXCJibGFja1wiIDogXCJ3aGl0ZVwifTtcbiAgcGFkZGluZzogMHB4IDVweDtcbiAgYm9yZGVyLXJhZGl1czogNHB4O1xuICBmb250LXdlaWdodDogNDAwO1xuICBmb250LWZhbWlseTogbW9ub3NwYWNlO1xufVxuPC9zdHlsZT5cbmBcbiJ9LHsibWV0aG9kTmFtZSI6ImludGVycHJldFF1aWV0Iiwic291cmNlIjoic2hpbnlJbnB1dCgnYm9yZGVydG9nZ2xlJykifSx7Im1ldGhvZE5hbWUiOiJpbnRlcnByZXRRdWlldCIsInNvdXJjZSI6InNoaW55SW5wdXQoJ2dyaWR0b2dnbGUnKSJ9LHsibWV0aG9kTmFtZSI6ImludGVycHJldFF1aWV0Iiwic291cmNlIjoic2hpbnlJbnB1dCgndXRjdG9nZ2xlJykifSx7Im1ldGhvZE5hbWUiOiJpbnRlcnByZXRRdWlldCIsInNvdXJjZSI6InNoaW55SW5wdXQoJ3N1bnRvZ2dsZScpIn0seyJtZXRob2ROYW1lIjoiaW50ZXJwcmV0UXVpZXQiLCJzb3VyY2UiOiJzaGlueUlucHV0KCd5YXcnKSJ9LHsibWV0aG9kTmFtZSI6ImludGVycHJldFF1aWV0Iiwic291cmNlIjoic2hpbnlJbnB1dCgncGl0Y2gnKSJ9LHsibWV0aG9kTmFtZSI6ImludGVycHJldFF1aWV0Iiwic291cmNlIjoic2hpbnlJbnB1dCgncm9sbCcpIn0seyJtZXRob2ROYW1lIjoiaW50ZXJwcmV0UXVpZXQiLCJzb3VyY2UiOiJzaGlueUlucHV0KCdtYXBzaXplJykifSx7Im1ldGhvZE5hbWUiOiJpbnRlcnByZXRRdWlldCIsInNvdXJjZSI6InNoaW55SW5wdXQoJ3NlbGVjdCcpIn0seyJtZXRob2ROYW1lIjoiaW50ZXJwcmV0UXVpZXQiLCJzb3VyY2UiOiJzaGlueUlucHV0KCdsb2NhdGlvbicpIn0seyJtZXRob2ROYW1lIjoiaW50ZXJwcmV0UXVpZXQiLCJzb3VyY2UiOiJzaGlueUlucHV0KCdsZWFwU2Vjb25kWWVhcicpIn0seyJtZXRob2ROYW1lIjoiaW50ZXJwcmV0UXVpZXQiLCJzb3VyY2UiOiJzaGlueUlucHV0KCdsZWFwU2Vjb25kRGF0ZScpIn0seyJtZXRob2ROYW1lIjoiaW50ZXJwcmV0UXVpZXQiLCJzb3VyY2UiOiJzaGlueUlucHV0KCdobXNpbnB1dCcpIn0seyJtZXRob2ROYW1lIjoiaW50ZXJwcmV0UXVpZXQiLCJzb3VyY2UiOiJzaGlueUlucHV0KCdkaWdpdHMnKSJ9LHsibWV0aG9kTmFtZSI6ImludGVycHJldFF1aWV0Iiwic291cmNlIjoic2hpbnlJbnB1dCgnc29ydFBhcmFtcycpIn0seyJtZXRob2ROYW1lIjoiaW50ZXJwcmV0UXVpZXQiLCJzb3VyY2UiOiJzaGlueUlucHV0KCdsYXRJbnB1dCcpIn0seyJtZXRob2ROYW1lIjoiaW50ZXJwcmV0UXVpZXQiLCJzb3VyY2UiOiJzaGlueUlucHV0KCdkb3lJbnB1dCcpIn0seyJtZXRob2ROYW1lIjoiaW50ZXJwcmV0UXVpZXQiLCJzb3VyY2UiOiJzaGlueUlucHV0KCdsb25JbnB1dCcpIn0seyJtZXRob2ROYW1lIjoiaW50ZXJwcmV0UXVpZXQiLCJzb3VyY2UiOiJzaGlueUlucHV0KCdmYW5jeVNlY29uZHNPRkYnKSJ9LHsibWV0aG9kTmFtZSI6ImludGVycHJldFF1aWV0Iiwic291cmNlIjoic2hpbnlJbnB1dCgnc2VsZWN0ZWREYXRlJykifSx7Im1ldGhvZE5hbWUiOiJpbnRlcnByZXRRdWlldCIsInNvdXJjZSI6InNoaW55SW5wdXQoJ3NlbGVjdGVkSG91cicpIn0seyJtZXRob2ROYW1lIjoiaW50ZXJwcmV0UXVpZXQiLCJzb3VyY2UiOiJzaGlueUlucHV0KCdkYXRlJykifV19
</script><script type="module">
if (window.location.protocol === "file:") { alert("The OJS runtime does not work with file:// URLs. Please use a web server to view this document."); }
window._ojs.paths.runtimeToDoc = "../../dec/time";
window._ojs.paths.runtimeToRoot = "../..";
window._ojs.paths.docToRoot = "../..";
window._ojs.selfContained = false;
window._ojs.runtime.interpretFromScriptTags();
</script><script id="quarto-html-after-body" type="application/javascript">
  window.document.addEventListener("DOMContentLoaded", function (event) {
    // Ensure there is a toggle, if there isn't float one in the top right
    if (window.document.querySelector('.quarto-color-scheme-toggle') === null) {
      const a = window.document.createElement('a');
      a.classList.add('top-right');
      a.classList.add('quarto-color-scheme-toggle');
      a.href = "";
      a.onclick = function() { try { window.quartoToggleColorScheme(); } catch {} return false; };
      const i = window.document.createElement("i");
      i.classList.add('bi');
      a.appendChild(i);
      window.document.body.appendChild(a);
    }
    setColorSchemeToggle(hasAlternateSentinel())
    const icon = "";
    const anchorJS = new window.AnchorJS();
    anchorJS.options = {
      placement: 'right',
      icon: icon
    };
    anchorJS.add('.anchored');
    const isCodeAnnotation = (el) => {
      for (const clz of el.classList) {
        if (clz.startsWith('code-annotation-')) {                     
          return true;
        }
      }
      return false;
    }
    const onCopySuccess = function(e) {
      // button target
      const button = e.trigger;
      // don't keep focus
      button.blur();
      // flash "checked"
      button.classList.add('code-copy-button-checked');
      var currentTitle = button.getAttribute("title");
      button.setAttribute("title", "Copied!");
      let tooltip;
      if (window.bootstrap) {
        button.setAttribute("data-bs-toggle", "tooltip");
        button.setAttribute("data-bs-placement", "left");
        button.setAttribute("data-bs-title", "Copied!");
        tooltip = new bootstrap.Tooltip(button, 
          { trigger: "manual", 
            customClass: "code-copy-button-tooltip",
            offset: [0, -8]});
        tooltip.show();    
      }
      setTimeout(function() {
        if (tooltip) {
          tooltip.hide();
          button.removeAttribute("data-bs-title");
          button.removeAttribute("data-bs-toggle");
          button.removeAttribute("data-bs-placement");
        }
        button.setAttribute("title", currentTitle);
        button.classList.remove('code-copy-button-checked');
      }, 1000);
      // clear code selection
      e.clearSelection();
    }
    const getTextToCopy = function(trigger) {
      const outerScaffold = trigger.parentElement.cloneNode(true);
      const codeEl = outerScaffold.querySelector('code');
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
    }
    const clipboard = new window.ClipboardJS('.code-copy-button:not([data-in-quarto-modal])', {
      text: getTextToCopy
    });
    clipboard.on('success', onCopySuccess);
    if (window.document.getElementById('quarto-embedded-source-code-modal')) {
      const clipboardModal = new window.ClipboardJS('.code-copy-button[data-in-quarto-modal]', {
        text: getTextToCopy,
        container: window.document.getElementById('quarto-embedded-source-code-modal')
      });
      clipboardModal.on('success', onCopySuccess);
    }
    const viewSource = window.document.getElementById('quarto-view-source') ||
                       window.document.getElementById('quarto-code-tools-source');
    if (viewSource) {
      const sourceUrl = viewSource.getAttribute("data-quarto-source-url");
      viewSource.addEventListener("click", function(e) {
        if (sourceUrl) {
          // rstudio viewer pane
          if (/\bcapabilities=\b/.test(window.location)) {
            window.open(sourceUrl);
          } else {
            window.location.href = sourceUrl;
          }
        } else {
          const modal = new bootstrap.Modal(document.getElementById('quarto-embedded-source-code-modal'));
          modal.show();
        }
        return false;
      });
    }
    function toggleCodeHandler(show) {
      return function(e) {
        const detailsSrc = window.document.querySelectorAll(".cell > details > .sourceCode");
        for (let i=0; i<detailsSrc.length; i++) {
          const details = detailsSrc[i].parentElement;
          if (show) {
            details.open = true;
          } else {
            details.removeAttribute("open");
          }
        }
        const cellCodeDivs = window.document.querySelectorAll(".cell > .sourceCode");
        const fromCls = show ? "hidden" : "unhidden";
        const toCls = show ? "unhidden" : "hidden";
        for (let i=0; i<cellCodeDivs.length; i++) {
          const codeDiv = cellCodeDivs[i];
          if (codeDiv.classList.contains(fromCls)) {
            codeDiv.classList.remove(fromCls);
            codeDiv.classList.add(toCls);
          } 
        }
        return false;
      }
    }
    const hideAllCode = window.document.getElementById("quarto-hide-all-code");
    if (hideAllCode) {
      hideAllCode.addEventListener("click", toggleCodeHandler(false));
    }
    const showAllCode = window.document.getElementById("quarto-show-all-code");
    if (showAllCode) {
      showAllCode.addEventListener("click", toggleCodeHandler(true));
    }
      var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
      var mailtoRegex = new RegExp(/^mailto:/);
        var filterRegex = new RegExp("https:\/\/maptv\.github\.io");
      var isInternal = (href) => {
          return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
      }
      // Inspect non-navigation links and adorn them if external
     var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
      for (var i=0; i<links.length; i++) {
        const link = links[i];
        if (!isInternal(link.href)) {
          // undo the damage that might have been done by quarto-nav.js in the case of
          // links that we want to consider external
          if (link.dataset.originalHref !== undefined) {
            link.href = link.dataset.originalHref;
          }
            // target, if specified
            link.setAttribute("target", "_blank");
            if (link.getAttribute("rel") === null) {
              link.setAttribute("rel", "noopener");
            }
        }
      }
    function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
      const config = {
        allowHTML: true,
        maxWidth: 500,
        delay: 100,
        arrow: false,
        appendTo: function(el) {
            return el.parentElement;
        },
        interactive: true,
        interactiveBorder: 10,
        theme: 'quarto',
        placement: 'bottom-start',
      };
      if (contentFn) {
        config.content = contentFn;
      }
      if (onTriggerFn) {
        config.onTrigger = onTriggerFn;
      }
      if (onUntriggerFn) {
        config.onUntrigger = onUntriggerFn;
      }
      window.tippy(el, config); 
    }
    const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
    for (var i=0; i<noterefs.length; i++) {
      const ref = noterefs[i];
      tippyHover(ref, function() {
        // use id or data attribute instead here
        let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
        try { href = new URL(href).hash; } catch {}
        const id = href.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note) {
          return note.innerHTML;
        } else {
          return "";
        }
      });
    }
    const xrefs = window.document.querySelectorAll('a.quarto-xref');
    const processXRef = (id, note) => {
      // Strip column container classes
      const stripColumnClz = (el) => {
        el.classList.remove("page-full", "page-columns");
        if (el.children) {
          for (const child of el.children) {
            stripColumnClz(child);
          }
        }
      }
      stripColumnClz(note)
      if (id === null || id.startsWith('sec-')) {
        // Special case sections, only their first couple elements
        const container = document.createElement("div");
        if (note.children && note.children.length > 2) {
          container.appendChild(note.children[0].cloneNode(true));
          for (let i = 1; i < note.children.length; i++) {
            const child = note.children[i];
            if (child.tagName === "P" && child.innerText === "") {
              continue;
            } else {
              container.appendChild(child.cloneNode(true));
              break;
            }
          }
          if (window.Quarto?.typesetMath) {
            window.Quarto.typesetMath(container);
          }
          return container.innerHTML
        } else {
          if (window.Quarto?.typesetMath) {
            window.Quarto.typesetMath(note);
          }
          return note.innerHTML;
        }
      } else {
        // Remove any anchor links if they are present
        const anchorLink = note.querySelector('a.anchorjs-link');
        if (anchorLink) {
          anchorLink.remove();
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        if (note.classList.contains("callout")) {
          return note.outerHTML;
        } else {
          return note.innerHTML;
        }
      }
    }
    for (var i=0; i<xrefs.length; i++) {
      const xref = xrefs[i];
      tippyHover(xref, undefined, function(instance) {
        instance.disable();
        let url = xref.getAttribute('href');
        let hash = undefined; 
        if (url.startsWith('#')) {
          hash = url;
        } else {
          try { hash = new URL(url).hash; } catch {}
        }
        if (hash) {
          const id = hash.replace(/^#\/?/, "");
          const note = window.document.getElementById(id);
          if (note !== null) {
            try {
              const html = processXRef(id, note.cloneNode(true));
              instance.setContent(html);
            } finally {
              instance.enable();
              instance.show();
            }
          } else {
            // See if we can fetch this
            fetch(url.split('#')[0])
            .then(res => res.text())
            .then(html => {
              const parser = new DOMParser();
              const htmlDoc = parser.parseFromString(html, "text/html");
              const note = htmlDoc.getElementById(id);
              if (note !== null) {
                const html = processXRef(id, note);
                instance.setContent(html);
              } 
            }).finally(() => {
              instance.enable();
              instance.show();
            });
          }
        } else {
          // See if we can fetch a full url (with no hash to target)
          // This is a special case and we should probably do some content thinning / targeting
          fetch(url)
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.querySelector('main.content');
            if (note !== null) {
              // This should only happen for chapter cross references
              // (since there is no id in the URL)
              // remove the first header
              if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
                note.children[0].remove();
              }
              const html = processXRef(null, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      }, function(instance) {
      });
    }
        let selectedAnnoteEl;
        const selectorForAnnotation = ( cell, annotation) => {
          let cellAttr = 'data-code-cell="' + cell + '"';
          let lineAttr = 'data-code-annotation="' +  annotation + '"';
          const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
          return selector;
        }
        const selectCodeLines = (annoteEl) => {
          const doc = window.document;
          const targetCell = annoteEl.getAttribute("data-target-cell");
          const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
          const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
          const lines = annoteSpan.getAttribute("data-code-lines").split(",");
          const lineIds = lines.map((line) => {
            return targetCell + "-" + line;
          })
          let top = null;
          let height = null;
          let parent = null;
          if (lineIds.length > 0) {
              //compute the position of the single el (top and bottom and make a div)
              const el = window.document.getElementById(lineIds[0]);
              top = el.offsetTop;
              height = el.offsetHeight;
              parent = el.parentElement.parentElement;
            if (lineIds.length > 1) {
              const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
              const bottom = lastEl.offsetTop + lastEl.offsetHeight;
              height = bottom - top;
            }
            if (top !== null && height !== null && parent !== null) {
              // cook up a div (if necessary) and position it 
              let div = window.document.getElementById("code-annotation-line-highlight");
              if (div === null) {
                div = window.document.createElement("div");
                div.setAttribute("id", "code-annotation-line-highlight");
                div.style.position = 'absolute';
                parent.appendChild(div);
              }
              div.style.top = top - 2 + "px";
              div.style.height = height + 4 + "px";
              div.style.left = 0;
              let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
              if (gutterDiv === null) {
                gutterDiv = window.document.createElement("div");
                gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
                gutterDiv.style.position = 'absolute';
                const codeCell = window.document.getElementById(targetCell);
                const gutter = codeCell.querySelector('.code-annotation-gutter');
                gutter.appendChild(gutterDiv);
              }
              gutterDiv.style.top = top - 2 + "px";
              gutterDiv.style.height = height + 4 + "px";
            }
            selectedAnnoteEl = annoteEl;
          }
        };
        const unselectCodeLines = () => {
          const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
          elementsIds.forEach((elId) => {
            const div = window.document.getElementById(elId);
            if (div) {
              div.remove();
            }
          });
          selectedAnnoteEl = undefined;
        };
          // Handle positioning of the toggle
      window.addEventListener(
        "resize",
        throttle(() => {
          elRect = undefined;
          if (selectedAnnoteEl) {
            selectCodeLines(selectedAnnoteEl);
          }
        }, 10)
      );
      function throttle(fn, ms) {
      let throttle = false;
      let timer;
        return (...args) => {
          if(!throttle) { // first call gets through
              fn.apply(this, args);
              throttle = true;
          } else { // all the others get throttled
              if(timer) clearTimeout(timer); // cancel #2
              timer = setTimeout(() => {
                fn.apply(this, args);
                timer = throttle = false;
              }, ms);
          }
        };
      }
        // Attach click handler to the DT
        const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
        for (const annoteDlNode of annoteDls) {
          annoteDlNode.addEventListener('click', (event) => {
            const clickedEl = event.target;
            if (clickedEl !== selectedAnnoteEl) {
              unselectCodeLines();
              const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
              if (activeEl) {
                activeEl.classList.remove('code-annotation-active');
              }
              selectCodeLines(clickedEl);
              clickedEl.classList.add('code-annotation-active');
            } else {
              // Unselect the line
              unselectCodeLines();
              clickedEl.classList.remove('code-annotation-active');
            }
          });
        }
    const findCites = (el) => {
      const parentEl = el.parentElement;
      if (parentEl) {
        const cites = parentEl.dataset.cites;
        if (cites) {
          return {
            el,
            cites: cites.split(' ')
          };
        } else {
          return findCites(el.parentElement)
        }
      } else {
        return undefined;
      }
    };
    var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
    for (var i=0; i<bibliorefs.length; i++) {
      const ref = bibliorefs[i];
      const citeInfo = findCites(ref);
      if (citeInfo) {
        tippyHover(citeInfo.el, function() {
          var popup = window.document.createElement('div');
          citeInfo.cites.forEach(function(cite) {
            var citeDiv = window.document.createElement('div');
            citeDiv.classList.add('hanging-indent');
            citeDiv.classList.add('csl-entry');
            var biblioDiv = window.document.getElementById('ref-' + cite);
            if (biblioDiv) {
              citeDiv.innerHTML = biblioDiv.innerHTML;
            }
            popup.appendChild(citeDiv);
          });
          return popup.innerHTML;
        });
      }
    }
  });
  </script><nav class="page-navigation column-body"><div class="nav-page nav-page-previous">
      <a href="../../dec/date/index.html" class="pagination-link" aria-label="Date">
        <i class="bi bi-arrow-left-short"></i> <span class="nav-page-text">Date</span>
      </a>          
  </div>
  <div class="nav-page nav-page-next">
      <a href="../../dec/snap/index.html" class="pagination-link" aria-label="Snap">
        <span class="nav-page-text">Snap</span> <i class="bi bi-arrow-right-short"></i>
      </a>
  </div>
</nav><div class="modal fade" id="quarto-embedded-source-code-modal" tabindex="-1" aria-labelledby="quarto-embedded-source-code-modal-label" aria-hidden="true"><div class="modal-dialog modal-dialog-scrollable"><div class="modal-content"><div class="modal-header"><h5 class="modal-title" id="quarto-embedded-source-code-modal-label">Source Code</h5><button class="btn-close" data-bs-dismiss="modal"></button></div><div class="modal-body"><div class="">
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb90" data-shortcodes="false"><pre class="sourceCode markdown code-with-copy"><code class="sourceCode markdown"><span id="cb90-1"><a href="#cb90-1" aria-hidden="true" tabindex="-1"></a><span class="co">---</span></span>
<span id="cb90-2"><a href="#cb90-2" aria-hidden="true" tabindex="-1"></a><span class="an">title:</span><span class="co"> Dec Time</span></span>
<span id="cb90-3"><a href="#cb90-3" aria-hidden="true" tabindex="-1"></a><span class="an">author:</span></span>
<span id="cb90-4"><a href="#cb90-4" aria-hidden="true" tabindex="-1"></a><span class="co">  - name: Martin Laptev</span></span>
<span id="cb90-5"><a href="#cb90-5" aria-hidden="true" tabindex="-1"></a><span class="co">    url: https://maptv.github.io</span></span>
<span id="cb90-6"><a href="#cb90-6" aria-hidden="true" tabindex="-1"></a><span class="an">image:</span><span class="co"> /asset/daywide.svg</span></span>
<span id="cb90-7"><a href="#cb90-7" aria-hidden="true" tabindex="-1"></a><span class="an">description:</span><span class="co"> &gt;</span></span>
<span id="cb90-8"><a href="#cb90-8" aria-hidden="true" tabindex="-1"></a><span class="co">  Introducing Declock, a timekeeping system that displays time in decimal days using math notation without the need for hours, minutes, or seconds.</span></span>
<span id="cb90-9"><a href="#cb90-9" aria-hidden="true" tabindex="-1"></a><span class="an">draft:</span><span class="co"> true</span></span>
<span id="cb90-10"><a href="#cb90-10" aria-hidden="true" tabindex="-1"></a><span class="an">citation:</span></span>
<span id="cb90-11"><a href="#cb90-11" aria-hidden="true" tabindex="-1"></a><span class="co">  url: https://maptv.github.io/dec/time</span></span>
<span id="cb90-12"><a href="#cb90-12" aria-hidden="true" tabindex="-1"></a><span class="an">aliases:</span></span>
<span id="cb90-13"><a href="#cb90-13" aria-hidden="true" tabindex="-1"></a><span class="co">  - /time</span></span>
<span id="cb90-14"><a href="#cb90-14" aria-hidden="true" tabindex="-1"></a><span class="co">  - /dt</span></span>
<span id="cb90-15"><a href="#cb90-15" aria-hidden="true" tabindex="-1"></a><span class="an">license:</span><span class="co"> CC BY-SA</span></span>
<span id="cb90-16"><a href="#cb90-16" aria-hidden="true" tabindex="-1"></a><span class="an">lightbox:</span><span class="co"> false</span></span>
<span id="cb90-17"><a href="#cb90-17" aria-hidden="true" tabindex="-1"></a><span class="an">toc:</span><span class="co"> true</span></span>
<span id="cb90-18"><a href="#cb90-18" aria-hidden="true" tabindex="-1"></a><span class="an">toc-depth:</span><span class="co"> 5</span></span>
<span id="cb90-19"><a href="#cb90-19" aria-hidden="true" tabindex="-1"></a><span class="an">bread-crumbs:</span><span class="co"> false</span></span>
<span id="cb90-20"><a href="#cb90-20" aria-hidden="true" tabindex="-1"></a><span class="an">format:</span></span>
<span id="cb90-21"><a href="#cb90-21" aria-hidden="true" tabindex="-1"></a><span class="co">  html:</span></span>
<span id="cb90-22"><a href="#cb90-22" aria-hidden="true" tabindex="-1"></a><span class="co">    grid:</span></span>
<span id="cb90-23"><a href="#cb90-23" aria-hidden="true" tabindex="-1"></a><span class="co">      body-width: 900px</span></span>
<span id="cb90-24"><a href="#cb90-24" aria-hidden="true" tabindex="-1"></a><span class="co">    shift-heading-level-by: 3</span></span>
<span id="cb90-25"><a href="#cb90-25" aria-hidden="true" tabindex="-1"></a><span class="co">    include-after-body:</span></span>
<span id="cb90-26"><a href="#cb90-26" aria-hidden="true" tabindex="-1"></a><span class="co">      - ../../asset/cite.html</span></span>
<span id="cb90-27"><a href="#cb90-27" aria-hidden="true" tabindex="-1"></a><span class="co">      - ../../asset/style.html</span></span>
<span id="cb90-28"><a href="#cb90-28" aria-hidden="true" tabindex="-1"></a><span class="co">      - ../../asset/stamp.html</span></span>
<span id="cb90-29"><a href="#cb90-29" aria-hidden="true" tabindex="-1"></a><span class="co">      - ../../asset/tooltip.html</span></span>
<span id="cb90-30"><a href="#cb90-30" aria-hidden="true" tabindex="-1"></a><span class="co">  commonmark: default</span></span>
<span id="cb90-31"><a href="#cb90-31" aria-hidden="true" tabindex="-1"></a><span class="an">notebook-view:</span><span class="co"> false</span></span>
<span id="cb90-32"><a href="#cb90-32" aria-hidden="true" tabindex="-1"></a><span class="an">format-links:</span></span>
<span id="cb90-33"><a href="#cb90-33" aria-hidden="true" tabindex="-1"></a><span class="co">  - html</span></span>
<span id="cb90-34"><a href="#cb90-34" aria-hidden="true" tabindex="-1"></a><span class="co">  - text: Quarto markdown (qmd)</span></span>
<span id="cb90-35"><a href="#cb90-35" aria-hidden="true" tabindex="-1"></a><span class="co">    icon: file-code</span></span>
<span id="cb90-36"><a href="#cb90-36" aria-hidden="true" tabindex="-1"></a><span class="co">    href: index.qmd</span></span>
<span id="cb90-37"><a href="#cb90-37" aria-hidden="true" tabindex="-1"></a><span class="co">  - format: commonmark</span></span>
<span id="cb90-38"><a href="#cb90-38" aria-hidden="true" tabindex="-1"></a><span class="co">    text: CommonMark markdown (md)</span></span>
<span id="cb90-39"><a href="#cb90-39" aria-hidden="true" tabindex="-1"></a><span class="co">    icon: file-code</span></span>
<span id="cb90-40"><a href="#cb90-40" aria-hidden="true" tabindex="-1"></a><span class="co">  - text: Python notebook (ipynb)</span></span>
<span id="cb90-41"><a href="#cb90-41" aria-hidden="true" tabindex="-1"></a><span class="co">    icon: file-code</span></span>
<span id="cb90-42"><a href="#cb90-42" aria-hidden="true" tabindex="-1"></a><span class="co">    href: eot.ipynb</span></span>
<span id="cb90-43"><a href="#cb90-43" aria-hidden="true" tabindex="-1"></a><span class="an">filters:</span></span>
<span id="cb90-44"><a href="#cb90-44" aria-hidden="true" tabindex="-1"></a><span class="co">  - ../../asset/date.lua</span></span>
<span id="cb90-45"><a href="#cb90-45" aria-hidden="true" tabindex="-1"></a><span class="an">engine:</span><span class="co"> knitr</span></span>
<span id="cb90-46"><a href="#cb90-46" aria-hidden="true" tabindex="-1"></a><span class="co">---</span></span>
<span id="cb90-47"><a href="#cb90-47" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb90-48"><a href="#cb90-48" aria-hidden="true" tabindex="-1"></a>::: {#timenav}</span>
<span id="cb90-49"><a href="#cb90-49" aria-hidden="true" tabindex="-1"></a>{{&lt; include /asset/_decnav.qmd &gt;}}</span>
<span id="cb90-50"><a href="#cb90-50" aria-hidden="true" tabindex="-1"></a>:::</span>
<span id="cb90-51"><a href="#cb90-51" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb90-52"><a href="#cb90-52" aria-hidden="true" tabindex="-1"></a>My website provides many examples of the <span class="co">[</span><span class="ot">Quarto</span><span class="co">](https://quarto.org)</span> publishing and the <span class="co">[</span><span class="ot">Dec</span><span class="co">](/dec)</span> measurement systems in action. I leverage Quarto support for the <span class="co">[</span><span class="ot">Observable</span><span class="co">](https://observablehq.com/)</span> data analysis and visualization system to create animated and interactive graphics like the <span class="co">[</span><span class="ot">bar📊charts</span><span class="co">](https://en.wikipedia.org/wiki/Bar_chart)</span> clocks🕓, <span class="co">[</span><span class="ot">solar☀️terminator</span><span class="co">](https://en.wikipedia.org/wiki/Terminator_%28solar%29#:~:text=a%20moving%20line%20that%20divides%20the%20daylit%20side%20and%20the%20dark%20night%20side%20of%20a%20planetary%20body)</span> map🗺, <span class="co">[</span><span class="ot">Earth🌍orbit</span><span class="co">](https://en.wikipedia.org/wiki/Earth%27s_orbit)</span> diagram, and <span class="co">[</span><span class="ot">daylight</span><span class="co">](https://en.wikipedia.org/wiki/Daylight#:~:text=the%20combination%20of%20all%20direct%20and%20indirect%20sunlight%20during%20the%20daytime)</span> <span class="co">[</span><span class="ot">area chart</span><span class="co">](https://en.wikipedia.org/wiki/Area_chart#:~:text=The%20area%20between%20axis%20and%20line%20are%20commonly%20emphasized%20with%20colors)</span> below.</span>
<span id="cb90-53"><a href="#cb90-53" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb90-54"><a href="#cb90-54" aria-hidden="true" tabindex="-1"></a>Dec times are measured in <span class="co">[</span><span class="ot">fractional days</span><span class="co">](https://en.wikipedia.org/wiki/Decimal_time#Fractional_days:~:text=a%20decimal%20fraction%20of%20a%20day)</span>, often using <span class="co">[</span><span class="ot">metric prefixes</span><span class="co">](https://en.wikipedia.org/wiki/Metric_prefix#:~:text=a%20unit%20prefix%20that%20precedes%20a%20basic%20unit%20of%20measure%20to%20indicate%20a%20multiple%20or%20submultiple%20of%20the%20unit)</span> like <span class="co">[</span><span class="ot">deci</span><span class="co">](https://en.wikipedia.org/wiki/Deci-#:~:text=a%20decimal%20unit%20prefix%20in%20the%20metric%20system%20denoting%20a%20factor%20of%20one%20tenth)</span>, <span class="co">[</span><span class="ot">centi</span><span class="co">](https://en.wikipedia.org/wiki/Centi-#:~:text=a%20unit%20prefix%20in%20the%20metric%20system%20denoting%20a%20factor%20of%20one%20hundredth)</span>, or <span class="co">[</span><span class="ot">milli</span><span class="co">](https://en.wikipedia.org/wiki/Milli-#:~:text=a%20unit%20prefix%20in%20the%20metric%20system%20denoting%20a%20factor%20of%20one%20thousandth)</span>. The top, middle, and bottom bars📊indicate the <span class="co">[</span><span class="ot">decidays</span><span class="co">](https://en.wikipedia.org/wiki/Decimal_time#:~:text=dividing%20the%20day%20into%2010%20decidays)</span>{.tool data-bs-toggle="tooltip" data-bs-title="tenths of a day"}, <span class="co">[</span><span class="ot">millidays</span><span class="co">](https://en.wikipedia.org/wiki/Unit_of_time#:~:text=1.44%20minutes%2C%20or%2086.4%20seconds)</span>{.tool data-bs-toggle="tooltip" data-bs-title="thousandths of a day"}, and <span class="co">[</span><span class="ot">centimillidays</span><span class="co">](https://en.wikipedia.org/wiki/Decimal_time#:~:text=which%20would%20be-,1/100%2C000%20day,-%2C%20or%20864%20milliseconds)</span>{.tool data-bs-toggle="tooltip" data-bs-title="hundred thousandths of a day"}, respectively, of the time since the start, <span class="co">[</span><span class="ot">+\${decTime}</span><span class="co">]</span>{.point1}, or until the end, <span class="co">[</span><span class="ot">-\${decTimeN}</span><span class="co">]</span>{.point0}, of the day in the Dec <span class="co">[</span><span class="ot">time zone</span><span class="co">](https://en.wikipedia.org/wiki/Time_zone#:~:text=an%20area%20which%20observes%20a%20uniform%20standard%20time)</span>, \${decZoneHsl}, at the location of the red⭕️circle on the map🗺️beneath the bars📊.</span>
<span id="cb90-55"><a href="#cb90-55" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb90-56"><a href="#cb90-56" aria-hidden="true" tabindex="-1"></a>To rotate the globe🌐in the Earth🌏orbit diagram, drag the red⭕️circle horizontally↔️or slide the red🔴dot on the daylight area chart vertically↕. The red⭕️circle's vertical↕position determines the yearly daylight pattern visualized by the area chart. Shift the red<span class="dt">&lt;</span><span class="kw">font</span><span class="ot"> color</span><span class="op">=</span><span class="st">red</span><span class="dt">&gt;</span>—<span class="dt">&lt;/</span><span class="kw">font</span><span class="dt">&gt;</span>line on the area chart horizontally↔️to move the globe🌐along the ellipse of the Earth🌎orbit.</span>
<span id="cb90-57"><a href="#cb90-57" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb90-60"><a href="#cb90-60" aria-hidden="true" tabindex="-1"></a><span class="in">```{ojs}</span></span>
<span id="cb90-61"><a href="#cb90-61" aria-hidden="true" tabindex="-1"></a><span class="co">//| echo: false</span></span>
<span id="cb90-62"><a href="#cb90-62" aria-hidden="true" tabindex="-1"></a><span class="co">//| label: toggles</span></span>
<span id="cb90-63"><a href="#cb90-63" aria-hidden="true" tabindex="-1"></a>viewof bordertoggle <span class="op">=</span> <span class="fu">labelToggle</span>(Inputs<span class="op">.</span><span class="at">toggle</span><span class="op">,</span> <span class="st">"Border"</span><span class="op">,</span> <span class="kw">false</span><span class="op">,</span> <span class="st">"bordertoggle"</span>)</span>
<span id="cb90-64"><a href="#cb90-64" aria-hidden="true" tabindex="-1"></a>viewof gridtoggle <span class="op">=</span> <span class="fu">labelToggle</span>(Inputs<span class="op">.</span><span class="at">toggle</span><span class="op">,</span> <span class="st">"Grid"</span><span class="op">,</span> <span class="kw">false</span><span class="op">,</span> <span class="st">"gridtoggle"</span>)</span>
<span id="cb90-65"><a href="#cb90-65" aria-hidden="true" tabindex="-1"></a>viewof utctoggle <span class="op">=</span> <span class="fu">labelToggle</span>(Inputs<span class="op">.</span><span class="at">toggle</span><span class="op">,</span> <span class="st">"UTC"</span><span class="op">,</span> <span class="kw">false</span><span class="op">,</span> <span class="st">"utctoggle"</span>)</span>
<span id="cb90-66"><a href="#cb90-66" aria-hidden="true" tabindex="-1"></a>viewof suntoggle <span class="op">=</span> <span class="fu">labelToggle</span>(Inputs<span class="op">.</span><span class="at">toggle</span><span class="op">,</span> <span class="st">"Sun"</span><span class="op">,</span> <span class="kw">false</span><span class="op">,</span> <span class="st">"suntoggle"</span>)</span>
<span id="cb90-67"><a href="#cb90-67" aria-hidden="true" tabindex="-1"></a>rstbtn<span class="op">.</span><span class="fu">node</span>()<span class="op">;</span></span>
<span id="cb90-68"><a href="#cb90-68" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb90-69"><a href="#cb90-69" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb90-70"><a href="#cb90-70" aria-hidden="true" tabindex="-1"></a><span class="fu">## Bar chart clocks {#bcc .hiddenheading}</span></span>
<span id="cb90-71"><a href="#cb90-71" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb90-74"><a href="#cb90-74" aria-hidden="true" tabindex="-1"></a><span class="in">```{ojs}</span></span>
<span id="cb90-75"><a href="#cb90-75" aria-hidden="true" tabindex="-1"></a><span class="co">//| echo: false</span></span>
<span id="cb90-76"><a href="#cb90-76" aria-hidden="true" tabindex="-1"></a><span class="co">// https://observablehq.com/@fheyen/barchart-clock</span></span>
<span id="cb90-77"><a href="#cb90-77" aria-hidden="true" tabindex="-1"></a>barChart <span class="op">=</span> {</span>
<span id="cb90-78"><a href="#cb90-78" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> W <span class="op">=</span> <span class="dv">800</span><span class="op">;</span></span>
<span id="cb90-79"><a href="#cb90-79" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> H <span class="op">=</span> <span class="dv">88</span><span class="op">;</span></span>
<span id="cb90-80"><a href="#cb90-80" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> barX <span class="op">=</span> <span class="dv">1</span><span class="op">;</span></span>
<span id="cb90-81"><a href="#cb90-81" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> firstBarY <span class="op">=</span> <span class="dv">1</span><span class="op">;</span></span>
<span id="cb90-82"><a href="#cb90-82" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> svg <span class="op">=</span> d3</span>
<span id="cb90-83"><a href="#cb90-83" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">create</span>(<span class="st">"svg"</span>)</span>
<span id="cb90-84"><a href="#cb90-84" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">"width"</span><span class="op">,</span> W)</span>
<span id="cb90-85"><a href="#cb90-85" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">"viewBox"</span><span class="op">,</span> [<span class="dv">0</span><span class="op">,</span> <span class="dv">0</span><span class="op">,</span> W <span class="op">/</span> <span class="fl">1.14</span><span class="op">,</span> H])<span class="op">;</span></span>
<span id="cb90-86"><a href="#cb90-86" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> xRange <span class="op">=</span> [<span class="dv">0</span><span class="op">,</span> W <span class="op">-</span> <span class="dv">100</span>]<span class="op">;</span></span>
<span id="cb90-87"><a href="#cb90-87" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> scaleDD <span class="op">=</span> d3<span class="op">.</span><span class="fu">scaleLinear</span>()</span>
<span id="cb90-88"><a href="#cb90-88" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">domain</span>([<span class="dv">0</span><span class="op">,</span> <span class="dv">10</span>])</span>
<span id="cb90-89"><a href="#cb90-89" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">range</span>(xRange)<span class="op">;</span></span>
<span id="cb90-90"><a href="#cb90-90" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> scaleMandB <span class="op">=</span> d3<span class="op">.</span><span class="fu">scaleLinear</span>()</span>
<span id="cb90-91"><a href="#cb90-91" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">domain</span>([<span class="dv">0</span><span class="op">,</span> <span class="dv">100</span>])</span>
<span id="cb90-92"><a href="#cb90-92" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">range</span>(xRange)<span class="op">;</span></span>
<span id="cb90-93"><a href="#cb90-93" aria-hidden="true" tabindex="-1"></a>  <span class="co">// Background bars to show where 100% lies</span></span>
<span id="cb90-94"><a href="#cb90-94" aria-hidden="true" tabindex="-1"></a>  svg<span class="op">.</span><span class="fu">selectAll</span>(<span class="st">'.background'</span>)</span>
<span id="cb90-95"><a href="#cb90-95" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">data</span>([</span>
<span id="cb90-96"><a href="#cb90-96" aria-hidden="true" tabindex="-1"></a>      <span class="st">'dd'</span><span class="op">,</span> <span class="st">"mils"</span><span class="op">,</span> <span class="st">'beats'</span>])</span>
<span id="cb90-97"><a href="#cb90-97" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">enter</span>()</span>
<span id="cb90-98"><a href="#cb90-98" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">append</span>(<span class="st">'rect'</span>)</span>
<span id="cb90-99"><a href="#cb90-99" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">'class'</span><span class="op">,</span> <span class="st">'background timeBar'</span>)</span>
<span id="cb90-100"><a href="#cb90-100" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">'width'</span><span class="op">,</span> W<span class="op">-</span><span class="dv">100</span>)</span>
<span id="cb90-101"><a href="#cb90-101" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">'y'</span><span class="op">,</span> (d<span class="op">,</span>i)<span class="kw">=&gt;</span>i<span class="op">*</span><span class="dv">30</span><span class="op">+</span>firstBarY)</span>
<span id="cb90-102"><a href="#cb90-102" aria-hidden="true" tabindex="-1"></a>  <span class="co">// Beats</span></span>
<span id="cb90-103"><a href="#cb90-103" aria-hidden="true" tabindex="-1"></a>  svg</span>
<span id="cb90-104"><a href="#cb90-104" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">append</span>(<span class="st">'rect'</span>)</span>
<span id="cb90-105"><a href="#cb90-105" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">'class'</span><span class="op">,</span> <span class="st">'timeBar'</span>)</span>
<span id="cb90-106"><a href="#cb90-106" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">'y'</span><span class="op">,</span> firstBarY<span class="op">+</span><span class="dv">60</span>)</span>
<span id="cb90-107"><a href="#cb90-107" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">'width'</span><span class="op">,</span> d <span class="kw">=&gt;</span> <span class="fu">scaleMandB</span>(<span class="bu">Number</span>(barBeats)))</span>
<span id="cb90-108"><a href="#cb90-108" aria-hidden="true" tabindex="-1"></a>  svg</span>
<span id="cb90-109"><a href="#cb90-109" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">append</span>(<span class="st">'rect'</span>)</span>
<span id="cb90-110"><a href="#cb90-110" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">'class'</span><span class="op">,</span> <span class="st">'timeBarFull'</span>)</span>
<span id="cb90-111"><a href="#cb90-111" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">'y'</span><span class="op">,</span> firstBarY<span class="op">+</span><span class="dv">60</span>)</span>
<span id="cb90-112"><a href="#cb90-112" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">'width'</span><span class="op">,</span> d <span class="kw">=&gt;</span> <span class="fu">scaleMandB</span>(barBeats))</span>
<span id="cb90-113"><a href="#cb90-113" aria-hidden="true" tabindex="-1"></a>  <span class="co">// Cents/Mils</span></span>
<span id="cb90-114"><a href="#cb90-114" aria-hidden="true" tabindex="-1"></a>  svg</span>
<span id="cb90-115"><a href="#cb90-115" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">append</span>(<span class="st">'rect'</span>)</span>
<span id="cb90-116"><a href="#cb90-116" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">'class'</span><span class="op">,</span> <span class="st">'timeBar'</span>)</span>
<span id="cb90-117"><a href="#cb90-117" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">'y'</span><span class="op">,</span> firstBarY)</span>
<span id="cb90-118"><a href="#cb90-118" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">'width'</span><span class="op">,</span> d <span class="kw">=&gt;</span> <span class="fu">scaleDD</span>(<span class="bu">Number</span>(barDD)<span class="op">+</span><span class="bu">Number</span>(barMils)<span class="op">/</span><span class="dv">100</span><span class="op">+</span><span class="bu">Number</span>(barBeats)<span class="op">/</span><span class="dv">10000</span>))</span>
<span id="cb90-119"><a href="#cb90-119" aria-hidden="true" tabindex="-1"></a>  svg</span>
<span id="cb90-120"><a href="#cb90-120" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">append</span>(<span class="st">'rect'</span>)</span>
<span id="cb90-121"><a href="#cb90-121" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">'class'</span><span class="op">,</span> <span class="st">'timeBarFull'</span>)</span>
<span id="cb90-122"><a href="#cb90-122" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">'y'</span><span class="op">,</span> firstBarY)</span>
<span id="cb90-123"><a href="#cb90-123" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">'width'</span><span class="op">,</span> d <span class="kw">=&gt;</span> <span class="fu">scaleDD</span>(barDD))</span>
<span id="cb90-124"><a href="#cb90-124" aria-hidden="true" tabindex="-1"></a>  svg</span>
<span id="cb90-125"><a href="#cb90-125" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">append</span>(<span class="st">'rect'</span>)</span>
<span id="cb90-126"><a href="#cb90-126" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">'class'</span><span class="op">,</span> <span class="st">'timeBar'</span>)</span>
<span id="cb90-127"><a href="#cb90-127" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">'y'</span><span class="op">,</span> firstBarY<span class="op">+</span><span class="dv">30</span>)</span>
<span id="cb90-128"><a href="#cb90-128" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">'width'</span><span class="op">,</span> d <span class="kw">=&gt;</span> <span class="fu">scaleMandB</span>(<span class="bu">Number</span>(barMils)<span class="op">+</span><span class="bu">Number</span>(barBeats)<span class="op">/</span><span class="dv">100</span>))</span>
<span id="cb90-129"><a href="#cb90-129" aria-hidden="true" tabindex="-1"></a>  svg</span>
<span id="cb90-130"><a href="#cb90-130" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">append</span>(<span class="st">'rect'</span>)</span>
<span id="cb90-131"><a href="#cb90-131" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">'class'</span><span class="op">,</span> <span class="st">'timeBarFull'</span>)</span>
<span id="cb90-132"><a href="#cb90-132" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">'y'</span><span class="op">,</span> firstBarY<span class="op">+</span><span class="dv">30</span>)</span>
<span id="cb90-133"><a href="#cb90-133" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">'width'</span><span class="op">,</span> d <span class="kw">=&gt;</span> <span class="fu">scaleMandB</span>(barMils))</span>
<span id="cb90-134"><a href="#cb90-134" aria-hidden="true" tabindex="-1"></a>  <span class="co">// Cent ticks</span></span>
<span id="cb90-135"><a href="#cb90-135" aria-hidden="true" tabindex="-1"></a>  svg<span class="op">.</span><span class="fu">selectAll</span>(<span class="st">'.tickC'</span>)</span>
<span id="cb90-136"><a href="#cb90-136" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">data</span>(d3<span class="op">.</span><span class="fu">range</span>(width <span class="op">&gt;</span> <span class="dv">500</span> <span class="op">?</span> <span class="dv">10</span> <span class="op">:</span> <span class="dv">10</span><span class="op">,</span> <span class="dv">100</span>))</span>
<span id="cb90-137"><a href="#cb90-137" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">enter</span>()</span>
<span id="cb90-138"><a href="#cb90-138" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">append</span>(<span class="st">'rect'</span>)</span>
<span id="cb90-139"><a href="#cb90-139" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">'class'</span><span class="op">,</span> <span class="st">'tickC'</span>)</span>
<span id="cb90-140"><a href="#cb90-140" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">'x'</span><span class="op">,</span> d<span class="kw">=&gt;</span><span class="fu">scaleDD</span>(d<span class="op">/</span><span class="dv">10</span>)<span class="op">+</span>barX)</span>
<span id="cb90-141"><a href="#cb90-141" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">'y'</span><span class="op">,</span> firstBarY<span class="op">+</span><span class="dv">30</span>)</span>
<span id="cb90-142"><a href="#cb90-142" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">'height'</span><span class="op">,</span> d<span class="kw">=&gt;</span>d<span class="op">%</span><span class="dv">2</span><span class="op">===</span><span class="dv">0</span><span class="op">?</span> <span class="dv">8</span><span class="op">:</span><span class="dv">5</span>)</span>
<span id="cb90-143"><a href="#cb90-143" aria-hidden="true" tabindex="-1"></a>  svg<span class="op">.</span><span class="fu">selectAll</span>(<span class="st">'.tickB1'</span>)</span>
<span id="cb90-144"><a href="#cb90-144" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">data</span>(d3<span class="op">.</span><span class="fu">range</span>(width <span class="op">&gt;</span> <span class="dv">500</span> <span class="op">?</span> <span class="dv">10</span> <span class="op">:</span> <span class="dv">10</span><span class="op">,</span> <span class="dv">100</span>))</span>
<span id="cb90-145"><a href="#cb90-145" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">enter</span>()</span>
<span id="cb90-146"><a href="#cb90-146" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">append</span>(<span class="st">'rect'</span>)</span>
<span id="cb90-147"><a href="#cb90-147" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">'class'</span><span class="op">,</span> <span class="st">'tickB1'</span>)</span>
<span id="cb90-148"><a href="#cb90-148" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">'x'</span><span class="op">,</span> d<span class="kw">=&gt;</span><span class="fu">scaleDD</span>(d<span class="op">/</span><span class="dv">10</span>)<span class="op">+</span>barX)</span>
<span id="cb90-149"><a href="#cb90-149" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">'y'</span><span class="op">,</span> d<span class="kw">=&gt;</span>d<span class="op">%</span><span class="dv">2</span><span class="op">===</span><span class="dv">0</span><span class="op">?</span> firstBarY<span class="op">+</span><span class="dv">77</span><span class="op">:</span>firstBarY<span class="op">+</span><span class="dv">80</span>)</span>
<span id="cb90-150"><a href="#cb90-150" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">'height'</span><span class="op">,</span> d<span class="kw">=&gt;</span>d<span class="op">%</span><span class="dv">2</span><span class="op">===</span><span class="dv">0</span><span class="op">?</span> <span class="dv">8</span><span class="op">:</span><span class="dv">5</span>)</span>
<span id="cb90-151"><a href="#cb90-151" aria-hidden="true" tabindex="-1"></a>  svg<span class="op">.</span><span class="fu">selectAll</span>(<span class="st">'.tickC1'</span>)</span>
<span id="cb90-152"><a href="#cb90-152" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">data</span>(d3<span class="op">.</span><span class="fu">range</span>(width <span class="op">&gt;</span> <span class="dv">500</span> <span class="op">?</span> <span class="dv">10</span> <span class="op">:</span> <span class="dv">10</span><span class="op">,</span> <span class="dv">100</span>))</span>
<span id="cb90-153"><a href="#cb90-153" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">enter</span>()</span>
<span id="cb90-154"><a href="#cb90-154" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">append</span>(<span class="st">'rect'</span>)</span>
<span id="cb90-155"><a href="#cb90-155" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">'class'</span><span class="op">,</span> <span class="st">'tickC1'</span>)</span>
<span id="cb90-156"><a href="#cb90-156" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">'x'</span><span class="op">,</span> d<span class="kw">=&gt;</span><span class="fu">scaleDD</span>(d<span class="op">/</span><span class="dv">10</span>)<span class="op">+</span>barX)</span>
<span id="cb90-157"><a href="#cb90-157" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">'y'</span><span class="op">,</span> d<span class="kw">=&gt;</span>d<span class="op">%</span><span class="dv">2</span><span class="op">===</span><span class="dv">0</span><span class="op">?</span> firstBarY<span class="op">+</span><span class="dv">47</span><span class="op">:</span>firstBarY<span class="op">+</span><span class="dv">50</span>)</span>
<span id="cb90-158"><a href="#cb90-158" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">'height'</span><span class="op">,</span> d<span class="kw">=&gt;</span>d<span class="op">%</span><span class="dv">2</span><span class="op">===</span><span class="dv">0</span><span class="op">?</span> <span class="dv">8</span><span class="op">:</span><span class="dv">5</span>)</span>
<span id="cb90-159"><a href="#cb90-159" aria-hidden="true" tabindex="-1"></a>  <span class="co">// Mil ticks</span></span>
<span id="cb90-160"><a href="#cb90-160" aria-hidden="true" tabindex="-1"></a>  svg<span class="op">.</span><span class="fu">selectAll</span>(<span class="st">'.tickM'</span>)</span>
<span id="cb90-161"><a href="#cb90-161" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">data</span>(d3<span class="op">.</span><span class="fu">range</span>(width <span class="op">&gt;</span> <span class="dv">500</span> <span class="op">?</span> <span class="dv">1</span> <span class="op">:</span> <span class="dv">1</span><span class="op">,</span> <span class="dv">10</span>))</span>
<span id="cb90-162"><a href="#cb90-162" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">enter</span>()</span>
<span id="cb90-163"><a href="#cb90-163" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">append</span>(<span class="st">'rect'</span>)</span>
<span id="cb90-164"><a href="#cb90-164" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">'class'</span><span class="op">,</span> <span class="st">'tickM'</span>)</span>
<span id="cb90-165"><a href="#cb90-165" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">'x'</span><span class="op">,</span> d<span class="kw">=&gt;</span><span class="fu">scaleDD</span>(d)<span class="op">+</span>barX)</span>
<span id="cb90-166"><a href="#cb90-166" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">'y'</span><span class="op">,</span> firstBarY<span class="op">+</span><span class="dv">20</span>)</span>
<span id="cb90-167"><a href="#cb90-167" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">'height'</span><span class="op">,</span> <span class="dv">6</span>)</span>
<span id="cb90-168"><a href="#cb90-168" aria-hidden="true" tabindex="-1"></a>  svg<span class="op">.</span><span class="fu">selectAll</span>(<span class="st">'.tickLabel1'</span>)</span>
<span id="cb90-169"><a href="#cb90-169" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">data</span>(d3<span class="op">.</span><span class="fu">range</span>(width <span class="op">&gt;</span> <span class="dv">500</span> <span class="op">?</span> <span class="dv">1</span> <span class="op">:</span> <span class="dv">1</span><span class="op">,</span> <span class="dv">10</span>))</span>
<span id="cb90-170"><a href="#cb90-170" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">enter</span>()</span>
<span id="cb90-171"><a href="#cb90-171" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">append</span>(<span class="st">'text'</span>)</span>
<span id="cb90-172"><a href="#cb90-172" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">'class'</span><span class="op">,</span> <span class="st">'tickLabel1'</span>)</span>
<span id="cb90-173"><a href="#cb90-173" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">'x'</span><span class="op">,</span> d<span class="kw">=&gt;</span><span class="fu">scaleDD</span>(d)<span class="op">+</span>barX<span class="op">+.</span><span class="dv">5</span>)</span>
<span id="cb90-174"><a href="#cb90-174" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">'y'</span><span class="op">,</span> firstBarY<span class="op">+</span><span class="dv">18</span>)</span>
<span id="cb90-175"><a href="#cb90-175" aria-hidden="true" tabindex="-1"></a>    <span class="co">//.style("font-size", `{W &lt; 550 ? 12 : W &lt; 650 ? 14 : W &lt; 750 ? 16 : W &lt; 850 ? 18 : 20}px`)</span></span>
<span id="cb90-176"><a href="#cb90-176" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">text</span>(d<span class="kw">=&gt;</span>d)</span>
<span id="cb90-177"><a href="#cb90-177" aria-hidden="true" tabindex="-1"></a>  <span class="co">// Cent ticks</span></span>
<span id="cb90-178"><a href="#cb90-178" aria-hidden="true" tabindex="-1"></a>  svg<span class="op">.</span><span class="fu">selectAll</span>(<span class="st">'.tickC2'</span>)</span>
<span id="cb90-179"><a href="#cb90-179" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">data</span>(d3<span class="op">.</span><span class="fu">range</span>(width <span class="op">&gt;</span> <span class="dv">500</span> <span class="op">?</span> <span class="dv">10</span> <span class="op">:</span> <span class="dv">10</span><span class="op">,</span> <span class="dv">100</span>))</span>
<span id="cb90-180"><a href="#cb90-180" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">enter</span>()</span>
<span id="cb90-181"><a href="#cb90-181" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">append</span>(<span class="st">'rect'</span>)</span>
<span id="cb90-182"><a href="#cb90-182" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">'class'</span><span class="op">,</span> <span class="st">'tickC2'</span>)</span>
<span id="cb90-183"><a href="#cb90-183" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">'x'</span><span class="op">,</span> d<span class="kw">=&gt;</span><span class="fu">scaleDD</span>(d<span class="op">/</span><span class="dv">10</span>)<span class="op">+</span>barX)</span>
<span id="cb90-184"><a href="#cb90-184" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">'y'</span><span class="op">,</span> firstBarY<span class="op">+</span><span class="dv">10</span>)</span>
<span id="cb90-185"><a href="#cb90-185" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">'height'</span><span class="op">,</span> d<span class="kw">=&gt;</span>d<span class="op">%</span><span class="dv">2</span><span class="op">===</span><span class="dv">0</span><span class="op">?</span> <span class="dv">9</span><span class="op">:</span><span class="dv">6</span>)</span>
<span id="cb90-186"><a href="#cb90-186" aria-hidden="true" tabindex="-1"></a>  <span class="co">// Beat ticks</span></span>
<span id="cb90-187"><a href="#cb90-187" aria-hidden="true" tabindex="-1"></a>  svg<span class="op">.</span><span class="fu">selectAll</span>(<span class="st">'.tickB'</span>)</span>
<span id="cb90-188"><a href="#cb90-188" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">data</span>(d3<span class="op">.</span><span class="fu">range</span>(width <span class="op">&gt;</span> <span class="dv">500</span> <span class="op">?</span> <span class="dv">10</span> <span class="op">:</span> <span class="dv">10</span><span class="op">,</span> <span class="dv">100</span>))</span>
<span id="cb90-189"><a href="#cb90-189" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">enter</span>()</span>
<span id="cb90-190"><a href="#cb90-190" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">append</span>(<span class="st">'rect'</span>)</span>
<span id="cb90-191"><a href="#cb90-191" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">'class'</span><span class="op">,</span> <span class="st">'tickB'</span>)</span>
<span id="cb90-192"><a href="#cb90-192" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">'x'</span><span class="op">,</span> d<span class="kw">=&gt;</span><span class="fu">scaleDD</span>(d<span class="op">/</span><span class="dv">10</span>)<span class="op">+</span>barX)</span>
<span id="cb90-193"><a href="#cb90-193" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">'y'</span><span class="op">,</span> firstBarY<span class="op">+</span><span class="dv">60</span>)</span>
<span id="cb90-194"><a href="#cb90-194" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">'height'</span><span class="op">,</span> d<span class="kw">=&gt;</span>d<span class="op">%</span><span class="dv">2</span><span class="op">===</span><span class="dv">0</span><span class="op">?</span> <span class="dv">9</span><span class="op">:</span><span class="dv">6</span>)</span>
<span id="cb90-195"><a href="#cb90-195" aria-hidden="true" tabindex="-1"></a>  <span class="co">// Labels</span></span>
<span id="cb90-196"><a href="#cb90-196" aria-hidden="true" tabindex="-1"></a>  svg<span class="op">.</span><span class="fu">selectAll</span>(<span class="st">'.timeLabel'</span>)</span>
<span id="cb90-197"><a href="#cb90-197" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">data</span>([<span class="vs">`+</span><span class="sc">${</span>barDD<span class="sc">}</span><span class="vs">`</span><span class="op">,</span> <span class="vs">`</span><span class="sc">${</span>barMils<span class="sc">}</span><span class="vs">`</span><span class="op">,</span> <span class="vs">`</span><span class="sc">${</span>barBeats<span class="sc">}</span><span class="vs">`</span>])</span>
<span id="cb90-198"><a href="#cb90-198" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">enter</span>()</span>
<span id="cb90-199"><a href="#cb90-199" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">append</span>(<span class="st">'text'</span>)</span>
<span id="cb90-200"><a href="#cb90-200" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">'class'</span><span class="op">,</span> <span class="st">'timeLabel'</span>)</span>
<span id="cb90-201"><a href="#cb90-201" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">'x'</span><span class="op">,</span> barX<span class="op">+</span><span class="dv">2</span>)</span>
<span id="cb90-202"><a href="#cb90-202" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">'y'</span><span class="op">,</span> (d<span class="op">,</span>i)<span class="kw">=&gt;</span>i<span class="op">*</span><span class="dv">30</span><span class="op">+</span>firstBarY<span class="op">+</span><span class="dv">20</span>)</span>
<span id="cb90-203"><a href="#cb90-203" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">style</span>(<span class="st">"font-size"</span><span class="op">,</span> <span class="vs">`</span><span class="sc">${</span>W <span class="op">&lt;</span> <span class="dv">300</span> <span class="op">?</span> <span class="dv">14</span> <span class="op">:</span> W <span class="op">&lt;</span> <span class="dv">400</span> <span class="op">?</span> <span class="dv">16</span> <span class="op">:</span> W <span class="op">&lt;</span> <span class="dv">500</span> <span class="op">?</span> <span class="dv">18</span> <span class="op">:</span> W <span class="op">&lt;</span> <span class="dv">600</span> <span class="op">?</span> <span class="dv">20</span> <span class="op">:</span> <span class="dv">22</span><span class="sc">}</span><span class="vs">px`</span>)</span>
<span id="cb90-204"><a href="#cb90-204" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">text</span>(d<span class="kw">=&gt;</span>d)<span class="op">;</span></span>
<span id="cb90-205"><a href="#cb90-205" aria-hidden="true" tabindex="-1"></a>  svg<span class="op">.</span><span class="fu">attr</span>(<span class="st">"id"</span><span class="op">,</span> <span class="st">"topbar"</span>)<span class="op">;</span></span>
<span id="cb90-206"><a href="#cb90-206" aria-hidden="true" tabindex="-1"></a>  svg<span class="op">.</span><span class="fu">attr</span>(<span class="st">'class'</span><span class="op">,</span> <span class="st">'barclock'</span>)</span>
<span id="cb90-207"><a href="#cb90-207" aria-hidden="true" tabindex="-1"></a>  <span class="cf">return</span> svg<span class="op">.</span><span class="fu">node</span>()<span class="op">;</span></span>
<span id="cb90-208"><a href="#cb90-208" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb90-209"><a href="#cb90-209" aria-hidden="true" tabindex="-1"></a>barChart1 <span class="op">=</span> {</span>
<span id="cb90-210"><a href="#cb90-210" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> W <span class="op">=</span> <span class="dv">800</span><span class="op">;</span></span>
<span id="cb90-211"><a href="#cb90-211" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> H <span class="op">=</span> <span class="dv">88</span><span class="op">;</span></span>
<span id="cb90-212"><a href="#cb90-212" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> barX <span class="op">=</span> <span class="dv">1</span><span class="op">;</span></span>
<span id="cb90-213"><a href="#cb90-213" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> firstBarY <span class="op">=</span> <span class="dv">1</span><span class="op">;</span></span>
<span id="cb90-214"><a href="#cb90-214" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> svg <span class="op">=</span> d3</span>
<span id="cb90-215"><a href="#cb90-215" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">create</span>(<span class="st">"svg"</span>)</span>
<span id="cb90-216"><a href="#cb90-216" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">"width"</span><span class="op">,</span> W)</span>
<span id="cb90-217"><a href="#cb90-217" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">"viewBox"</span><span class="op">,</span> [<span class="dv">0</span><span class="op">,</span> <span class="dv">0</span><span class="op">,</span> W <span class="op">/</span> <span class="fl">1.14</span><span class="op">,</span> H])<span class="op">;</span></span>
<span id="cb90-218"><a href="#cb90-218" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> xRange <span class="op">=</span> [<span class="dv">0</span><span class="op">,</span> W <span class="op">-</span> <span class="dv">100</span>]<span class="op">;</span></span>
<span id="cb90-219"><a href="#cb90-219" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> scaleDD <span class="op">=</span> d3<span class="op">.</span><span class="fu">scaleLinear</span>()</span>
<span id="cb90-220"><a href="#cb90-220" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">domain</span>([<span class="dv">0</span><span class="op">,</span> <span class="dv">10</span>])</span>
<span id="cb90-221"><a href="#cb90-221" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">range</span>(xRange)<span class="op">;</span></span>
<span id="cb90-222"><a href="#cb90-222" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> scaleMandB <span class="op">=</span> d3<span class="op">.</span><span class="fu">scaleLinear</span>()</span>
<span id="cb90-223"><a href="#cb90-223" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">domain</span>([<span class="dv">0</span><span class="op">,</span> <span class="dv">100</span>])</span>
<span id="cb90-224"><a href="#cb90-224" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">range</span>(xRange)<span class="op">;</span></span>
<span id="cb90-225"><a href="#cb90-225" aria-hidden="true" tabindex="-1"></a>  <span class="co">// const scaleDek = d3.scaleLinear()</span></span>
<span id="cb90-226"><a href="#cb90-226" aria-hidden="true" tabindex="-1"></a>  <span class="co">//  .domain([0, 37])</span></span>
<span id="cb90-227"><a href="#cb90-227" aria-hidden="true" tabindex="-1"></a>  <span class="co">//  .range(xRange);</span></span>
<span id="cb90-228"><a href="#cb90-228" aria-hidden="true" tabindex="-1"></a>  <span class="co">// Background bars to show where 100% lies</span></span>
<span id="cb90-229"><a href="#cb90-229" aria-hidden="true" tabindex="-1"></a>  svg<span class="op">.</span><span class="fu">selectAll</span>(<span class="st">'.background'</span>)</span>
<span id="cb90-230"><a href="#cb90-230" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">data</span>([</span>
<span id="cb90-231"><a href="#cb90-231" aria-hidden="true" tabindex="-1"></a>      <span class="co">// 'dek', 'dotd',</span></span>
<span id="cb90-232"><a href="#cb90-232" aria-hidden="true" tabindex="-1"></a>      <span class="st">'dd'</span><span class="op">,</span> <span class="st">"mils"</span><span class="op">,</span> <span class="st">'beats'</span>])</span>
<span id="cb90-233"><a href="#cb90-233" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">enter</span>()</span>
<span id="cb90-234"><a href="#cb90-234" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">append</span>(<span class="st">'rect'</span>)</span>
<span id="cb90-235"><a href="#cb90-235" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">'class'</span><span class="op">,</span> <span class="st">'background timeBar'</span>)</span>
<span id="cb90-236"><a href="#cb90-236" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">'width'</span><span class="op">,</span> W<span class="op">-</span><span class="dv">100</span>)</span>
<span id="cb90-237"><a href="#cb90-237" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">'y'</span><span class="op">,</span> (d<span class="op">,</span>i)<span class="kw">=&gt;</span>i<span class="op">*</span><span class="dv">30</span><span class="op">+</span>firstBarY)</span>
<span id="cb90-238"><a href="#cb90-238" aria-hidden="true" tabindex="-1"></a>  <span class="co">// Beats</span></span>
<span id="cb90-239"><a href="#cb90-239" aria-hidden="true" tabindex="-1"></a>  svg</span>
<span id="cb90-240"><a href="#cb90-240" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">append</span>(<span class="st">'rect'</span>)</span>
<span id="cb90-241"><a href="#cb90-241" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">'class'</span><span class="op">,</span> <span class="st">'timeBar'</span>)</span>
<span id="cb90-242"><a href="#cb90-242" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">'y'</span><span class="op">,</span> firstBarY<span class="op">+</span><span class="dv">60</span>)</span>
<span id="cb90-243"><a href="#cb90-243" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">'width'</span><span class="op">,</span> d <span class="kw">=&gt;</span> <span class="fu">scaleMandB</span>(<span class="bu">Number</span>(barBeatsN)))</span>
<span id="cb90-244"><a href="#cb90-244" aria-hidden="true" tabindex="-1"></a>  svg</span>
<span id="cb90-245"><a href="#cb90-245" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">append</span>(<span class="st">'rect'</span>)</span>
<span id="cb90-246"><a href="#cb90-246" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">'class'</span><span class="op">,</span> <span class="st">'timeBarFullN'</span>)</span>
<span id="cb90-247"><a href="#cb90-247" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">'y'</span><span class="op">,</span> firstBarY<span class="op">+</span><span class="dv">60</span>)</span>
<span id="cb90-248"><a href="#cb90-248" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">'width'</span><span class="op">,</span> d <span class="kw">=&gt;</span> <span class="fu">scaleMandB</span>(barBeatsN))</span>
<span id="cb90-249"><a href="#cb90-249" aria-hidden="true" tabindex="-1"></a>  <span class="co">// Cents/Mils</span></span>
<span id="cb90-250"><a href="#cb90-250" aria-hidden="true" tabindex="-1"></a>  svg</span>
<span id="cb90-251"><a href="#cb90-251" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">append</span>(<span class="st">'rect'</span>)</span>
<span id="cb90-252"><a href="#cb90-252" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">'class'</span><span class="op">,</span> <span class="st">'timeBar'</span>)</span>
<span id="cb90-253"><a href="#cb90-253" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">'y'</span><span class="op">,</span> firstBarY)</span>
<span id="cb90-254"><a href="#cb90-254" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">'width'</span><span class="op">,</span> d <span class="kw">=&gt;</span> <span class="fu">scaleDD</span>(<span class="bu">Number</span>(barDDN)<span class="op">+</span><span class="bu">Number</span>(barMilsN)<span class="op">/</span><span class="dv">100</span><span class="op">+</span><span class="bu">Number</span>(barBeatsN)<span class="op">/</span><span class="dv">10000</span>))</span>
<span id="cb90-255"><a href="#cb90-255" aria-hidden="true" tabindex="-1"></a>  svg</span>
<span id="cb90-256"><a href="#cb90-256" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">append</span>(<span class="st">'rect'</span>)</span>
<span id="cb90-257"><a href="#cb90-257" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">'class'</span><span class="op">,</span> <span class="st">'timeBarFullN'</span>)</span>
<span id="cb90-258"><a href="#cb90-258" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">'y'</span><span class="op">,</span> firstBarY)</span>
<span id="cb90-259"><a href="#cb90-259" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">'width'</span><span class="op">,</span> d <span class="kw">=&gt;</span> <span class="fu">scaleDD</span>(barDDN))</span>
<span id="cb90-260"><a href="#cb90-260" aria-hidden="true" tabindex="-1"></a>  svg</span>
<span id="cb90-261"><a href="#cb90-261" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">append</span>(<span class="st">'rect'</span>)</span>
<span id="cb90-262"><a href="#cb90-262" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">'class'</span><span class="op">,</span> <span class="st">'timeBar'</span>)</span>
<span id="cb90-263"><a href="#cb90-263" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">'y'</span><span class="op">,</span> firstBarY<span class="op">+</span><span class="dv">30</span>)</span>
<span id="cb90-264"><a href="#cb90-264" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">'width'</span><span class="op">,</span> d <span class="kw">=&gt;</span> <span class="fu">scaleMandB</span>(<span class="bu">Number</span>(barMilsN)<span class="op">+</span><span class="bu">Number</span>(barBeatsN)<span class="op">/</span><span class="dv">100</span>))</span>
<span id="cb90-265"><a href="#cb90-265" aria-hidden="true" tabindex="-1"></a>  svg</span>
<span id="cb90-266"><a href="#cb90-266" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">append</span>(<span class="st">'rect'</span>)</span>
<span id="cb90-267"><a href="#cb90-267" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">'class'</span><span class="op">,</span> <span class="st">'timeBarFullN'</span>)</span>
<span id="cb90-268"><a href="#cb90-268" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">'y'</span><span class="op">,</span> firstBarY<span class="op">+</span><span class="dv">30</span>)</span>
<span id="cb90-269"><a href="#cb90-269" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">'width'</span><span class="op">,</span> d <span class="kw">=&gt;</span> <span class="fu">scaleMandB</span>(barMilsN))</span>
<span id="cb90-270"><a href="#cb90-270" aria-hidden="true" tabindex="-1"></a>  <span class="co">// Cent ticks</span></span>
<span id="cb90-271"><a href="#cb90-271" aria-hidden="true" tabindex="-1"></a>  svg<span class="op">.</span><span class="fu">selectAll</span>(<span class="st">'.tickC'</span>)</span>
<span id="cb90-272"><a href="#cb90-272" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">data</span>(d3<span class="op">.</span><span class="fu">range</span>(width <span class="op">&gt;</span> <span class="dv">500</span> <span class="op">?</span> <span class="dv">10</span> <span class="op">:</span> <span class="dv">10</span><span class="op">,</span> <span class="dv">100</span>))</span>
<span id="cb90-273"><a href="#cb90-273" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">enter</span>()</span>
<span id="cb90-274"><a href="#cb90-274" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">append</span>(<span class="st">'rect'</span>)</span>
<span id="cb90-275"><a href="#cb90-275" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">'class'</span><span class="op">,</span> <span class="st">'tickC'</span>)</span>
<span id="cb90-276"><a href="#cb90-276" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">'x'</span><span class="op">,</span> d<span class="kw">=&gt;</span><span class="fu">scaleDD</span>(d<span class="op">/</span><span class="dv">10</span>)<span class="op">+</span>barX)</span>
<span id="cb90-277"><a href="#cb90-277" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">'y'</span><span class="op">,</span> firstBarY<span class="op">+</span><span class="dv">30</span>)</span>
<span id="cb90-278"><a href="#cb90-278" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">'height'</span><span class="op">,</span> d<span class="kw">=&gt;</span>d<span class="op">%</span><span class="dv">2</span><span class="op">===</span><span class="dv">0</span><span class="op">?</span> <span class="dv">8</span><span class="op">:</span><span class="dv">5</span>)</span>
<span id="cb90-279"><a href="#cb90-279" aria-hidden="true" tabindex="-1"></a>  svg<span class="op">.</span><span class="fu">selectAll</span>(<span class="st">'.tickB1'</span>)</span>
<span id="cb90-280"><a href="#cb90-280" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">data</span>(d3<span class="op">.</span><span class="fu">range</span>(width <span class="op">&gt;</span> <span class="dv">500</span> <span class="op">?</span> <span class="dv">10</span> <span class="op">:</span> <span class="dv">10</span><span class="op">,</span> <span class="dv">100</span>))</span>
<span id="cb90-281"><a href="#cb90-281" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">enter</span>()</span>
<span id="cb90-282"><a href="#cb90-282" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">append</span>(<span class="st">'rect'</span>)</span>
<span id="cb90-283"><a href="#cb90-283" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">'class'</span><span class="op">,</span> <span class="st">'tickB1'</span>)</span>
<span id="cb90-284"><a href="#cb90-284" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">'x'</span><span class="op">,</span> d<span class="kw">=&gt;</span><span class="fu">scaleDD</span>(d<span class="op">/</span><span class="dv">10</span>)<span class="op">+</span>barX)</span>
<span id="cb90-285"><a href="#cb90-285" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">'y'</span><span class="op">,</span> d<span class="kw">=&gt;</span>d<span class="op">%</span><span class="dv">2</span><span class="op">===</span><span class="dv">0</span><span class="op">?</span> firstBarY<span class="op">+</span><span class="dv">77</span><span class="op">:</span>firstBarY<span class="op">+</span><span class="dv">80</span>)</span>
<span id="cb90-286"><a href="#cb90-286" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">'height'</span><span class="op">,</span> d<span class="kw">=&gt;</span>d<span class="op">%</span><span class="dv">2</span><span class="op">===</span><span class="dv">0</span><span class="op">?</span> <span class="dv">8</span><span class="op">:</span><span class="dv">5</span>)</span>
<span id="cb90-287"><a href="#cb90-287" aria-hidden="true" tabindex="-1"></a>  svg<span class="op">.</span><span class="fu">selectAll</span>(<span class="st">'.tickC1'</span>)</span>
<span id="cb90-288"><a href="#cb90-288" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">data</span>(d3<span class="op">.</span><span class="fu">range</span>(width <span class="op">&gt;</span> <span class="dv">500</span> <span class="op">?</span> <span class="dv">10</span> <span class="op">:</span> <span class="dv">10</span><span class="op">,</span> <span class="dv">100</span>))</span>
<span id="cb90-289"><a href="#cb90-289" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">enter</span>()</span>
<span id="cb90-290"><a href="#cb90-290" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">append</span>(<span class="st">'rect'</span>)</span>
<span id="cb90-291"><a href="#cb90-291" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">'class'</span><span class="op">,</span> <span class="st">'tickC1'</span>)</span>
<span id="cb90-292"><a href="#cb90-292" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">'x'</span><span class="op">,</span> d<span class="kw">=&gt;</span><span class="fu">scaleDD</span>(d<span class="op">/</span><span class="dv">10</span>)<span class="op">+</span>barX)</span>
<span id="cb90-293"><a href="#cb90-293" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">'y'</span><span class="op">,</span> d<span class="kw">=&gt;</span>d<span class="op">%</span><span class="dv">2</span><span class="op">===</span><span class="dv">0</span><span class="op">?</span> firstBarY<span class="op">+</span><span class="dv">47</span><span class="op">:</span>firstBarY<span class="op">+</span><span class="dv">50</span>)</span>
<span id="cb90-294"><a href="#cb90-294" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">'height'</span><span class="op">,</span> d<span class="kw">=&gt;</span>d<span class="op">%</span><span class="dv">2</span><span class="op">===</span><span class="dv">0</span><span class="op">?</span> <span class="dv">8</span><span class="op">:</span><span class="dv">5</span>)</span>
<span id="cb90-295"><a href="#cb90-295" aria-hidden="true" tabindex="-1"></a>  <span class="co">// Mil ticks</span></span>
<span id="cb90-296"><a href="#cb90-296" aria-hidden="true" tabindex="-1"></a>  svg<span class="op">.</span><span class="fu">selectAll</span>(<span class="st">'.tickM'</span>)</span>
<span id="cb90-297"><a href="#cb90-297" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">data</span>(d3<span class="op">.</span><span class="fu">range</span>(width <span class="op">&gt;</span> <span class="dv">500</span> <span class="op">?</span> <span class="dv">1</span> <span class="op">:</span> <span class="dv">1</span><span class="op">,</span> <span class="dv">10</span>))</span>
<span id="cb90-298"><a href="#cb90-298" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">enter</span>()</span>
<span id="cb90-299"><a href="#cb90-299" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">append</span>(<span class="st">'rect'</span>)</span>
<span id="cb90-300"><a href="#cb90-300" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">'class'</span><span class="op">,</span> <span class="st">'tickM'</span>)</span>
<span id="cb90-301"><a href="#cb90-301" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">'x'</span><span class="op">,</span> d<span class="kw">=&gt;</span><span class="fu">scaleDD</span>(d)<span class="op">+</span>barX)</span>
<span id="cb90-302"><a href="#cb90-302" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">'y'</span><span class="op">,</span> firstBarY<span class="op">+</span><span class="dv">20</span>)</span>
<span id="cb90-303"><a href="#cb90-303" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">'height'</span><span class="op">,</span> <span class="dv">6</span>)</span>
<span id="cb90-304"><a href="#cb90-304" aria-hidden="true" tabindex="-1"></a>  svg<span class="op">.</span><span class="fu">selectAll</span>(<span class="st">'.tickLabel1'</span>)</span>
<span id="cb90-305"><a href="#cb90-305" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">data</span>(d3<span class="op">.</span><span class="fu">range</span>(width <span class="op">&gt;</span> <span class="dv">500</span> <span class="op">?</span> <span class="dv">1</span> <span class="op">:</span> <span class="dv">1</span><span class="op">,</span> <span class="dv">10</span>))</span>
<span id="cb90-306"><a href="#cb90-306" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">enter</span>()</span>
<span id="cb90-307"><a href="#cb90-307" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">append</span>(<span class="st">'text'</span>)</span>
<span id="cb90-308"><a href="#cb90-308" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">'class'</span><span class="op">,</span> <span class="st">'tickLabel1'</span>)</span>
<span id="cb90-309"><a href="#cb90-309" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">'x'</span><span class="op">,</span> d<span class="kw">=&gt;</span><span class="fu">scaleDD</span>(d)<span class="op">+</span>barX<span class="op">+.</span><span class="dv">5</span>)</span>
<span id="cb90-310"><a href="#cb90-310" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">'y'</span><span class="op">,</span> firstBarY<span class="op">+</span><span class="dv">18</span>)</span>
<span id="cb90-311"><a href="#cb90-311" aria-hidden="true" tabindex="-1"></a>    <span class="co">//.style("font-size", `{W &lt; 350 ? 12 : W &lt; 450 ? 14 : W &lt; 550 ? 16 : W &lt; 650 ? 18 : 20}px`)</span></span>
<span id="cb90-312"><a href="#cb90-312" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">text</span>(d<span class="kw">=&gt;</span>d)</span>
<span id="cb90-313"><a href="#cb90-313" aria-hidden="true" tabindex="-1"></a>  <span class="co">// Cent ticks</span></span>
<span id="cb90-314"><a href="#cb90-314" aria-hidden="true" tabindex="-1"></a>  svg<span class="op">.</span><span class="fu">selectAll</span>(<span class="st">'.tickC2'</span>)</span>
<span id="cb90-315"><a href="#cb90-315" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">data</span>(d3<span class="op">.</span><span class="fu">range</span>(width <span class="op">&gt;</span> <span class="dv">500</span> <span class="op">?</span> <span class="dv">10</span> <span class="op">:</span> <span class="dv">10</span><span class="op">,</span> <span class="dv">100</span>))</span>
<span id="cb90-316"><a href="#cb90-316" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">enter</span>()</span>
<span id="cb90-317"><a href="#cb90-317" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">append</span>(<span class="st">'rect'</span>)</span>
<span id="cb90-318"><a href="#cb90-318" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">'class'</span><span class="op">,</span> <span class="st">'tickC2'</span>)</span>
<span id="cb90-319"><a href="#cb90-319" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">'x'</span><span class="op">,</span> d<span class="kw">=&gt;</span><span class="fu">scaleDD</span>(d<span class="op">/</span><span class="dv">10</span>)<span class="op">+</span>barX)</span>
<span id="cb90-320"><a href="#cb90-320" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">'y'</span><span class="op">,</span> firstBarY<span class="op">+</span><span class="dv">10</span>)</span>
<span id="cb90-321"><a href="#cb90-321" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">'height'</span><span class="op">,</span> d<span class="kw">=&gt;</span>d<span class="op">%</span><span class="dv">2</span><span class="op">===</span><span class="dv">0</span><span class="op">?</span> <span class="dv">9</span><span class="op">:</span><span class="dv">6</span>)</span>
<span id="cb90-322"><a href="#cb90-322" aria-hidden="true" tabindex="-1"></a>  <span class="co">// Beat ticks</span></span>
<span id="cb90-323"><a href="#cb90-323" aria-hidden="true" tabindex="-1"></a>  svg<span class="op">.</span><span class="fu">selectAll</span>(<span class="st">'.tickB'</span>)</span>
<span id="cb90-324"><a href="#cb90-324" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">data</span>(d3<span class="op">.</span><span class="fu">range</span>(width <span class="op">&gt;</span> <span class="dv">500</span> <span class="op">?</span> <span class="dv">10</span> <span class="op">:</span> <span class="dv">10</span><span class="op">,</span> <span class="dv">100</span>))</span>
<span id="cb90-325"><a href="#cb90-325" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">enter</span>()</span>
<span id="cb90-326"><a href="#cb90-326" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">append</span>(<span class="st">'rect'</span>)</span>
<span id="cb90-327"><a href="#cb90-327" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">'class'</span><span class="op">,</span> <span class="st">'tickB'</span>)</span>
<span id="cb90-328"><a href="#cb90-328" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">'x'</span><span class="op">,</span> d<span class="kw">=&gt;</span><span class="fu">scaleDD</span>(d<span class="op">/</span><span class="dv">10</span>)<span class="op">+</span>barX)</span>
<span id="cb90-329"><a href="#cb90-329" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">'y'</span><span class="op">,</span> firstBarY<span class="op">+</span><span class="dv">60</span>)</span>
<span id="cb90-330"><a href="#cb90-330" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">'height'</span><span class="op">,</span> d<span class="kw">=&gt;</span>d<span class="op">%</span><span class="dv">2</span><span class="op">===</span><span class="dv">0</span><span class="op">?</span> <span class="dv">9</span><span class="op">:</span><span class="dv">6</span>)</span>
<span id="cb90-331"><a href="#cb90-331" aria-hidden="true" tabindex="-1"></a>  <span class="co">// Labels</span></span>
<span id="cb90-332"><a href="#cb90-332" aria-hidden="true" tabindex="-1"></a>  svg<span class="op">.</span><span class="fu">selectAll</span>(<span class="st">'.timeLabel'</span>)</span>
<span id="cb90-333"><a href="#cb90-333" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">data</span>([<span class="vs">`-</span><span class="sc">${</span>barDDN<span class="sc">}</span><span class="vs">`</span><span class="op">,</span> <span class="vs">`</span><span class="sc">${</span>barMilsN<span class="sc">}</span><span class="vs">`</span><span class="op">,</span> <span class="vs">`</span><span class="sc">${</span>barBeatsN<span class="sc">}</span><span class="vs">`</span>])</span>
<span id="cb90-334"><a href="#cb90-334" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">enter</span>()</span>
<span id="cb90-335"><a href="#cb90-335" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">append</span>(<span class="st">'text'</span>)</span>
<span id="cb90-336"><a href="#cb90-336" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">'class'</span><span class="op">,</span> <span class="st">'timeLabel'</span>)</span>
<span id="cb90-337"><a href="#cb90-337" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">'x'</span><span class="op">,</span> barX<span class="op">+</span><span class="dv">2</span>)</span>
<span id="cb90-338"><a href="#cb90-338" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">'y'</span><span class="op">,</span> (d<span class="op">,</span>i)<span class="kw">=&gt;</span>i<span class="op">*</span><span class="dv">30</span><span class="op">+</span>firstBarY<span class="op">+</span><span class="dv">20</span>)</span>
<span id="cb90-339"><a href="#cb90-339" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">style</span>(<span class="st">"font-size"</span><span class="op">,</span> <span class="vs">`</span><span class="sc">${</span>W <span class="op">&lt;</span> <span class="dv">300</span> <span class="op">?</span> <span class="dv">14</span> <span class="op">:</span> W <span class="op">&lt;</span> <span class="dv">400</span> <span class="op">?</span> <span class="dv">16</span> <span class="op">:</span> W <span class="op">&lt;</span> <span class="dv">500</span> <span class="op">?</span> <span class="dv">18</span> <span class="op">:</span> W <span class="op">&lt;</span> <span class="dv">600</span> <span class="op">?</span> <span class="dv">20</span> <span class="op">:</span> <span class="dv">22</span><span class="sc">}</span><span class="vs">px`</span>)</span>
<span id="cb90-340"><a href="#cb90-340" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">text</span>(d<span class="kw">=&gt;</span>d)<span class="op">;</span></span>
<span id="cb90-341"><a href="#cb90-341" aria-hidden="true" tabindex="-1"></a>  svg<span class="op">.</span><span class="fu">attr</span>(<span class="st">"id"</span><span class="op">,</span> <span class="st">"btmbar"</span>)<span class="op">;</span></span>
<span id="cb90-342"><a href="#cb90-342" aria-hidden="true" tabindex="-1"></a>  svg<span class="op">.</span><span class="fu">attr</span>(<span class="st">'class'</span><span class="op">,</span> <span class="st">'barclock'</span>)</span>
<span id="cb90-343"><a href="#cb90-343" aria-hidden="true" tabindex="-1"></a>  <span class="cf">return</span> svg<span class="op">.</span><span class="fu">node</span>()<span class="op">;</span></span>
<span id="cb90-344"><a href="#cb90-344" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb90-345"><a href="#cb90-345" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb90-346"><a href="#cb90-346" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb90-347"><a href="#cb90-347" aria-hidden="true" tabindex="-1"></a>:::{.marginInputs}</span>
<span id="cb90-350"><a href="#cb90-350" aria-hidden="true" tabindex="-1"></a><span class="in">```{ojs}</span></span>
<span id="cb90-351"><a href="#cb90-351" aria-hidden="true" tabindex="-1"></a><span class="co">//| echo: false</span></span>
<span id="cb90-352"><a href="#cb90-352" aria-hidden="true" tabindex="-1"></a><span class="co">//| label: yawinput</span></span>
<span id="cb90-353"><a href="#cb90-353" aria-hidden="true" tabindex="-1"></a><span class="co">//| column: margin</span></span>
<span id="cb90-354"><a href="#cb90-354" aria-hidden="true" tabindex="-1"></a>viewof yaw <span class="op">=</span> Inputs<span class="op">.</span><span class="fu">range</span>([<span class="dv">0</span><span class="op">,</span> <span class="dv">1000</span>]<span class="op">,</span> {<span class="dt">label</span><span class="op">:</span> <span class="st">"Yaw"</span><span class="op">,</span> <span class="dt">value</span><span class="op">:</span> <span class="dv">500</span><span class="op">,</span> <span class="dt">step</span><span class="op">:</span> <span class="dv">1</span>})</span>
<span id="cb90-355"><a href="#cb90-355" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb90-356"><a href="#cb90-356" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb90-359"><a href="#cb90-359" aria-hidden="true" tabindex="-1"></a><span class="in">```{ojs}</span></span>
<span id="cb90-360"><a href="#cb90-360" aria-hidden="true" tabindex="-1"></a><span class="co">//| echo: false</span></span>
<span id="cb90-361"><a href="#cb90-361" aria-hidden="true" tabindex="-1"></a><span class="co">//| label: pitchinput</span></span>
<span id="cb90-362"><a href="#cb90-362" aria-hidden="true" tabindex="-1"></a><span class="co">//| column: margin</span></span>
<span id="cb90-363"><a href="#cb90-363" aria-hidden="true" tabindex="-1"></a>viewof pitch <span class="op">=</span> Inputs<span class="op">.</span><span class="fu">range</span>([<span class="op">-</span><span class="dv">500</span><span class="op">,</span> <span class="dv">500</span>]<span class="op">,</span> {<span class="dt">label</span><span class="op">:</span> <span class="st">"Pitch"</span><span class="op">,</span> <span class="dt">value</span><span class="op">:</span> <span class="dv">0</span><span class="op">,</span> <span class="dt">step</span><span class="op">:</span> <span class="dv">1</span>})</span>
<span id="cb90-364"><a href="#cb90-364" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb90-365"><a href="#cb90-365" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb90-368"><a href="#cb90-368" aria-hidden="true" tabindex="-1"></a><span class="in">```{ojs}</span></span>
<span id="cb90-369"><a href="#cb90-369" aria-hidden="true" tabindex="-1"></a><span class="co">//| echo: false</span></span>
<span id="cb90-370"><a href="#cb90-370" aria-hidden="true" tabindex="-1"></a><span class="co">//| label: rollinput</span></span>
<span id="cb90-371"><a href="#cb90-371" aria-hidden="true" tabindex="-1"></a><span class="co">//| column: margin</span></span>
<span id="cb90-372"><a href="#cb90-372" aria-hidden="true" tabindex="-1"></a>viewof roll <span class="op">=</span> Inputs<span class="op">.</span><span class="fu">range</span>([<span class="op">-</span><span class="dv">500</span><span class="op">,</span> <span class="dv">500</span>]<span class="op">,</span> {<span class="dt">label</span><span class="op">:</span> <span class="st">"Roll"</span><span class="op">,</span> <span class="dt">value</span><span class="op">:</span> <span class="dv">0</span><span class="op">,</span> <span class="dt">step</span><span class="op">:</span> <span class="dv">1</span>})</span>
<span id="cb90-373"><a href="#cb90-373" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb90-374"><a href="#cb90-374" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb90-377"><a href="#cb90-377" aria-hidden="true" tabindex="-1"></a><span class="in">```{ojs}</span></span>
<span id="cb90-378"><a href="#cb90-378" aria-hidden="true" tabindex="-1"></a><span class="co">//| echo: false</span></span>
<span id="cb90-379"><a href="#cb90-379" aria-hidden="true" tabindex="-1"></a><span class="co">//| label: sizeinput</span></span>
<span id="cb90-380"><a href="#cb90-380" aria-hidden="true" tabindex="-1"></a><span class="co">//| column: margin</span></span>
<span id="cb90-381"><a href="#cb90-381" aria-hidden="true" tabindex="-1"></a>viewof mapsize <span class="op">=</span> Inputs<span class="op">.</span><span class="fu">range</span>([<span class="dv">0</span><span class="op">,</span> <span class="dv">100</span>]<span class="op">,</span> {<span class="dt">label</span><span class="op">:</span> <span class="st">"Size"</span><span class="op">,</span> <span class="dt">value</span><span class="op">:</span> <span class="dv">100</span><span class="op">,</span> <span class="dt">step</span><span class="op">:</span> <span class="dv">1</span>})</span>
<span id="cb90-382"><a href="#cb90-382" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb90-383"><a href="#cb90-383" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb90-386"><a href="#cb90-386" aria-hidden="true" tabindex="-1"></a><span class="in">```{ojs}</span></span>
<span id="cb90-387"><a href="#cb90-387" aria-hidden="true" tabindex="-1"></a><span class="co">//| echo: false</span></span>
<span id="cb90-388"><a href="#cb90-388" aria-hidden="true" tabindex="-1"></a><span class="co">//| label: projselect</span></span>
<span id="cb90-389"><a href="#cb90-389" aria-hidden="true" tabindex="-1"></a><span class="co">//| column: margin</span></span>
<span id="cb90-390"><a href="#cb90-390" aria-hidden="true" tabindex="-1"></a>viewof select <span class="op">=</span> Inputs<span class="op">.</span><span class="fu">select</span>(</span>
<span id="cb90-391"><a href="#cb90-391" aria-hidden="true" tabindex="-1"></a>  projections<span class="op">,</span> {<span class="dt">format</span><span class="op">:</span> x <span class="kw">=&gt;</span> x<span class="op">.</span><span class="at">name</span><span class="op">,</span> <span class="dt">value</span><span class="op">:</span> projections<span class="op">.</span><span class="fu">find</span>(t <span class="kw">=&gt;</span> t<span class="op">.</span><span class="at">name</span> <span class="op">===</span> <span class="st">"Equirectangular (plate carrée)"</span>)})</span>
<span id="cb90-392"><a href="#cb90-392" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb90-393"><a href="#cb90-393" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb90-396"><a href="#cb90-396" aria-hidden="true" tabindex="-1"></a><span class="in">```{ojs}</span></span>
<span id="cb90-397"><a href="#cb90-397" aria-hidden="true" tabindex="-1"></a><span class="co">//| echo: false</span></span>
<span id="cb90-398"><a href="#cb90-398" aria-hidden="true" tabindex="-1"></a><span class="co">//| label: maptable</span></span>
<span id="cb90-399"><a href="#cb90-399" aria-hidden="true" tabindex="-1"></a><span class="co">//| column: margin</span></span>
<span id="cb90-400"><a href="#cb90-400" aria-hidden="true" tabindex="-1"></a>table <span class="op">=</span> <span class="fu">createTable</span>([</span>
<span id="cb90-401"><a href="#cb90-401" aria-hidden="true" tabindex="-1"></a>  { <span class="dt">Milliparallel</span><span class="op">:</span> <span class="dv">800</span><span class="op">,</span> <span class="dt">Millimeridian</span><span class="op">:</span> <span class="dv">0</span> }<span class="op">,</span></span>
<span id="cb90-402"><a href="#cb90-402" aria-hidden="true" tabindex="-1"></a>]<span class="op">,</span> { <span class="dt">headerEditable</span><span class="op">:</span> <span class="kw">false</span><span class="op">,</span> <span class="dt">appendRows</span><span class="op">:</span> <span class="kw">false</span> })</span>
<span id="cb90-403"><a href="#cb90-403" aria-hidden="true" tabindex="-1"></a><span class="co">//   {Point: 0, Milliparallel: `${Math.floor(long2turn(Place_A[0], 3))}`, Millimeridian: `${Math.floor(lati2turn(Place_A[1], 3))}`, Milliwindrose: `${Math.floor(lati2turn(coor2bear(Place_A, Place_B)))}`},</span></span>
<span id="cb90-404"><a href="#cb90-404" aria-hidden="true" tabindex="-1"></a><span class="co">//   {Point: 1, Milliparallel: `${Math.floor(long2turn(Place_B[0], 3))}`, Millimeridian: `${Math.floor(lati2turn(Place_B[1], 3))}`, Milliwindrose: `${Math.floor(lati2turn(coor2bear(Place_B, Place_A)))}`},</span></span>
<span id="cb90-405"><a href="#cb90-405" aria-hidden="true" tabindex="-1"></a><span class="co">// ], {headerEditable: false, appendRows: false})</span></span>
<span id="cb90-406"><a href="#cb90-406" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb90-407"><a href="#cb90-407" aria-hidden="true" tabindex="-1"></a>:::</span>
<span id="cb90-408"><a href="#cb90-408" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb90-409"><a href="#cb90-409" aria-hidden="true" tabindex="-1"></a><span class="fu">## Longitude latitude map {#llm .hiddenheading}</span></span>
<span id="cb90-410"><a href="#cb90-410" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb90-411"><a href="#cb90-411" aria-hidden="true" tabindex="-1"></a>::: {.column-screen}</span>
<span id="cb90-414"><a href="#cb90-414" aria-hidden="true" tabindex="-1"></a><span class="in">```{ojs}</span></span>
<span id="cb90-415"><a href="#cb90-415" aria-hidden="true" tabindex="-1"></a><span class="co">//| echo: false</span></span>
<span id="cb90-416"><a href="#cb90-416" aria-hidden="true" tabindex="-1"></a><span class="co">//| label: distmap</span></span>
<span id="cb90-417"><a href="#cb90-417" aria-hidden="true" tabindex="-1"></a>viewof location <span class="op">=</span> <span class="fu">worldMapCoordinates</span>([[<span class="dv">162</span><span class="op">,</span> <span class="dv">0</span>]<span class="op">,</span> projection]<span class="op">,</span> [width<span class="op">,</span> height <span class="op">*</span> mapsize <span class="op">/</span> <span class="dv">100</span>])</span>
<span id="cb90-418"><a href="#cb90-418" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb90-419"><a href="#cb90-419" aria-hidden="true" tabindex="-1"></a>:::</span>
<span id="cb90-420"><a href="#cb90-420" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb90-421"><a href="#cb90-421" aria-hidden="true" tabindex="-1"></a><span class="fu">## Daylight area chart {#dac .hiddenheading}</span></span>
<span id="cb90-422"><a href="#cb90-422" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb90-423"><a href="#cb90-423" aria-hidden="true" tabindex="-1"></a>::: {.column-page}</span>
<span id="cb90-426"><a href="#cb90-426" aria-hidden="true" tabindex="-1"></a><span class="in">```{ojs}</span></span>
<span id="cb90-427"><a href="#cb90-427" aria-hidden="true" tabindex="-1"></a><span class="co">//| echo: false</span></span>
<span id="cb90-428"><a href="#cb90-428" aria-hidden="true" tabindex="-1"></a><span class="co">// https://observablehq.com/@dbridges/visualizing-seasonal-daylight</span></span>
<span id="cb90-429"><a href="#cb90-429" aria-hidden="true" tabindex="-1"></a>app <span class="op">=</span> {</span>
<span id="cb90-430"><a href="#cb90-430" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> svg <span class="op">=</span> d3<span class="op">.</span><span class="fu">select</span>(DOM<span class="op">.</span><span class="fu">svg</span>(width<span class="op">,</span> height <span class="op">*</span> (width <span class="op">&lt;</span> <span class="dv">300</span> <span class="op">?</span> <span class="op">.</span><span class="dv">97</span> <span class="op">:</span> width <span class="op">&lt;</span> <span class="dv">350</span> <span class="op">?</span> <span class="op">.</span><span class="dv">96</span> <span class="op">:</span> width <span class="op">&lt;</span> <span class="dv">400</span> <span class="op">?</span> <span class="op">.</span><span class="dv">95</span> <span class="op">:</span> width <span class="op">&lt;</span> <span class="dv">450</span> <span class="op">?</span> <span class="op">.</span><span class="dv">94</span> <span class="op">:</span> width <span class="op">&lt;</span> <span class="dv">500</span> <span class="op">?</span> <span class="op">.</span><span class="dv">93</span> <span class="op">:</span> width <span class="op">&lt;</span> <span class="dv">550</span> <span class="op">?</span> <span class="op">.</span><span class="dv">92</span> <span class="op">:</span> width <span class="op">&lt;</span> <span class="dv">600</span> <span class="op">?</span> <span class="op">.</span><span class="dv">9</span> <span class="op">:</span> width <span class="op">&lt;</span> <span class="dv">650</span> <span class="op">?</span> <span class="op">.</span><span class="dv">86</span> <span class="op">:</span> width <span class="op">&lt;</span> <span class="dv">700</span> <span class="op">?</span> <span class="op">.</span><span class="dv">82</span> <span class="op">:</span> width <span class="op">&lt;</span> <span class="dv">800</span> <span class="op">?</span> <span class="op">.</span><span class="dv">81</span> <span class="op">:</span> width <span class="op">&lt;</span> <span class="dv">900</span> <span class="op">?</span> <span class="op">.</span><span class="dv">80</span> <span class="op">:</span> width <span class="op">&lt;</span> <span class="dv">1000</span> <span class="op">?</span> <span class="op">.</span><span class="dv">76</span> <span class="op">:</span> width <span class="op">&lt;</span> <span class="dv">1100</span> <span class="op">?</span> <span class="op">.</span><span class="dv">74</span> <span class="op">:</span> width <span class="op">&lt;</span> <span class="dv">1200</span> <span class="op">?</span> <span class="op">.</span><span class="dv">72</span> <span class="op">:</span> <span class="op">.</span><span class="dv">7</span>)))<span class="op">;</span></span>
<span id="cb90-431"><a href="#cb90-431" aria-hidden="true" tabindex="-1"></a>  svg<span class="op">.</span><span class="fu">style</span>(<span class="st">"user-select"</span><span class="op">,</span> <span class="st">"none"</span>)<span class="op">.</span><span class="fu">style</span>(<span class="st">"-webkit-user-select"</span><span class="op">,</span> <span class="st">"none"</span>)<span class="op">.</span><span class="fu">attr</span>(<span class="st">"id"</span><span class="op">,</span> <span class="st">"daylightapp"</span>)<span class="op">;</span></span>
<span id="cb90-432"><a href="#cb90-432" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> margin <span class="op">=</span> {<span class="dt">top</span><span class="op">:</span> <span class="dv">0</span><span class="op">,</span> <span class="dt">left</span><span class="op">:</span> <span class="dv">16</span><span class="op">,</span> <span class="dt">right</span><span class="op">:</span> <span class="dv">16</span><span class="op">,</span> <span class="dt">bottom</span><span class="op">:</span> <span class="dv">0</span><span class="op">,</span> <span class="dt">inner</span><span class="op">:</span> <span class="dv">32</span>}<span class="op">;</span></span>
<span id="cb90-433"><a href="#cb90-433" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> contentWidth <span class="op">=</span> width <span class="op">-</span> margin<span class="op">.</span><span class="at">left</span> <span class="op">-</span> margin<span class="op">.</span><span class="at">right</span> <span class="op">-</span> margin<span class="op">.</span><span class="at">inner</span><span class="op">;</span></span>
<span id="cb90-434"><a href="#cb90-434" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> columnWidth <span class="op">=</span> contentWidth <span class="op">/</span> <span class="dv">2</span><span class="op">;</span></span>
<span id="cb90-435"><a href="#cb90-435" aria-hidden="true" tabindex="-1"></a>  <span class="kw">let</span> selection <span class="op">=</span> {</span>
<span id="cb90-436"><a href="#cb90-436" aria-hidden="true" tabindex="-1"></a>    <span class="dt">date</span><span class="op">:</span> <span class="kw">this</span><span class="op">.</span><span class="at">value</span> <span class="op">!=</span> <span class="kw">null</span> <span class="op">?</span> <span class="kw">this</span><span class="op">.</span><span class="at">value</span><span class="op">.</span><span class="at">date</span> <span class="op">:</span> <span class="kw">new</span> <span class="bu">Date</span>(<span class="dv">2022</span><span class="op">,</span> <span class="kw">new</span> <span class="bu">Date</span>()<span class="op">.</span><span class="fu">getMonth</span>()<span class="op">,</span> <span class="kw">new</span> <span class="bu">Date</span>()<span class="op">.</span><span class="fu">getDate</span>()<span class="op">,</span> <span class="kw">new</span> <span class="bu">Date</span>()<span class="op">.</span><span class="fu">getHours</span>())<span class="op">,</span></span>
<span id="cb90-437"><a href="#cb90-437" aria-hidden="true" tabindex="-1"></a>    <span class="dt">hour</span><span class="op">:</span> <span class="kw">this</span><span class="op">.</span><span class="at">value</span> <span class="op">!=</span> <span class="kw">null</span> <span class="op">?</span> <span class="kw">this</span><span class="op">.</span><span class="at">value</span><span class="op">.</span><span class="at">hour</span> <span class="op">:</span> <span class="kw">new</span> <span class="bu">Date</span>(<span class="dv">2022</span><span class="op">,</span> <span class="kw">new</span> <span class="bu">Date</span>()<span class="op">.</span><span class="fu">getMonth</span>()<span class="op">,</span> <span class="kw">new</span> <span class="bu">Date</span>()<span class="op">.</span><span class="fu">getDate</span>()<span class="op">,</span> <span class="kw">new</span> <span class="bu">Date</span>()<span class="op">.</span><span class="fu">getHours</span>())<span class="op">.</span><span class="fu">getHours</span>()</span>
<span id="cb90-438"><a href="#cb90-438" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb90-439"><a href="#cb90-439" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> renderPlot <span class="op">=</span> () <span class="kw">=&gt;</span> {</span>
<span id="cb90-440"><a href="#cb90-440" aria-hidden="true" tabindex="-1"></a>    svg<span class="op">.</span><span class="fu">selectAll</span>(<span class="st">"#plot *"</span>)<span class="op">.</span><span class="fu">remove</span>()<span class="op">;</span></span>
<span id="cb90-441"><a href="#cb90-441" aria-hidden="true" tabindex="-1"></a>    svg<span class="op">.</span><span class="fu">select</span>(<span class="st">"#plot"</span>)<span class="op">.</span><span class="fu">call</span>(daylightPlot<span class="op">,</span> {</span>
<span id="cb90-442"><a href="#cb90-442" aria-hidden="true" tabindex="-1"></a>    <span class="dt">vizwidth</span><span class="op">:</span> columnWidth <span class="op">/</span> (width <span class="op">&lt;</span> <span class="dv">300</span> <span class="op">?</span> <span class="dv">1</span> <span class="op">:</span> width <span class="op">&lt;</span> <span class="dv">400</span> <span class="op">?</span> <span class="fl">1.05</span> <span class="op">:</span> width <span class="op">&lt;</span> <span class="dv">450</span> <span class="op">?</span> <span class="fl">1.1</span> <span class="op">:</span> width <span class="op">&lt;</span> <span class="dv">500</span> <span class="op">?</span> <span class="fl">1.15</span> <span class="op">:</span> width <span class="op">&lt;</span> <span class="dv">550</span> <span class="op">?</span> <span class="fl">1.2</span> <span class="op">:</span> width <span class="op">&lt;</span> <span class="dv">600</span> <span class="op">?</span> <span class="fl">1.25</span> <span class="op">:</span> width <span class="op">&lt;</span> <span class="dv">650</span> <span class="op">?</span> <span class="fl">1.3</span> <span class="op">:</span> width <span class="op">&lt;</span> <span class="dv">700</span> <span class="op">?</span> <span class="fl">1.4</span> <span class="op">:</span> <span class="fl">1.48</span>)<span class="op">,</span></span>
<span id="cb90-443"><a href="#cb90-443" aria-hidden="true" tabindex="-1"></a>      <span class="dt">height</span><span class="op">:</span> height <span class="op">*</span> (width <span class="op">&lt;</span> <span class="dv">400</span> <span class="op">?</span> <span class="fl">1.62</span> <span class="op">:</span> width <span class="op">&lt;</span> <span class="dv">500</span> <span class="op">?</span> <span class="fl">1.6</span> <span class="op">:</span> width <span class="op">&lt;</span> <span class="dv">600</span> <span class="op">?</span> <span class="fl">1.54</span> <span class="op">:</span> width <span class="op">&lt;</span> <span class="dv">800</span> <span class="op">?</span> <span class="fl">1.54</span> <span class="op">:</span> width <span class="op">&lt;</span> <span class="dv">900</span> <span class="op">?</span> <span class="fl">1.54</span> <span class="op">:</span> width <span class="op">&lt;</span> <span class="dv">1000</span> <span class="op">?</span> <span class="fl">1.54</span> <span class="op">:</span> width <span class="op">&lt;</span> <span class="dv">1100</span> <span class="op">?</span> <span class="fl">1.54</span> <span class="op">:</span> width <span class="op">&lt;</span> <span class="dv">1200</span> <span class="op">?</span> <span class="fl">1.54</span> <span class="op">:</span> width <span class="op">&lt;</span> <span class="dv">1300</span> <span class="op">?</span> <span class="fl">1.54</span> <span class="op">:</span> width <span class="op">&lt;</span> <span class="dv">1400</span> <span class="op">?</span> <span class="fl">1.54</span> <span class="op">:</span> <span class="fl">1.56</span>)<span class="op">,</span></span>
<span id="cb90-444"><a href="#cb90-444" aria-hidden="true" tabindex="-1"></a>      <span class="dt">year</span><span class="op">:</span> <span class="dv">2022</span><span class="op">,</span></span>
<span id="cb90-445"><a href="#cb90-445" aria-hidden="true" tabindex="-1"></a>      <span class="dt">latitude</span><span class="op">:</span> location[<span class="dv">1</span>]<span class="op">,</span></span>
<span id="cb90-446"><a href="#cb90-446" aria-hidden="true" tabindex="-1"></a>      <span class="dt">defaultDate</span><span class="op">:</span> selection<span class="op">.</span><span class="at">date</span><span class="op">,</span></span>
<span id="cb90-447"><a href="#cb90-447" aria-hidden="true" tabindex="-1"></a>      <span class="dt">defaultHour</span><span class="op">:</span> selection<span class="op">.</span><span class="at">hour</span></span>
<span id="cb90-448"><a href="#cb90-448" aria-hidden="true" tabindex="-1"></a>    })</span>
<span id="cb90-449"><a href="#cb90-449" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb90-450"><a href="#cb90-450" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> renderSolarSystem <span class="op">=</span> () <span class="kw">=&gt;</span> {</span>
<span id="cb90-451"><a href="#cb90-451" aria-hidden="true" tabindex="-1"></a>    svg<span class="op">.</span><span class="fu">selectAll</span>(<span class="st">"#solar-system *"</span>)<span class="op">.</span><span class="fu">remove</span>()<span class="op">;</span></span>
<span id="cb90-452"><a href="#cb90-452" aria-hidden="true" tabindex="-1"></a>    svg<span class="op">.</span><span class="fu">selectAll</span>(<span class="st">"#solar-system"</span>)<span class="op">.</span><span class="fu">call</span>(solarSystem<span class="op">,</span></span>
<span id="cb90-453"><a href="#cb90-453" aria-hidden="true" tabindex="-1"></a>                                        columnWidth <span class="op">*</span> <span class="fl">2.02</span><span class="op">,</span></span>
<span id="cb90-454"><a href="#cb90-454" aria-hidden="true" tabindex="-1"></a>                                        location<span class="op">,</span></span>
<span id="cb90-455"><a href="#cb90-455" aria-hidden="true" tabindex="-1"></a>                                        selection<span class="op">.</span><span class="at">date</span><span class="op">,</span></span>
<span id="cb90-456"><a href="#cb90-456" aria-hidden="true" tabindex="-1"></a>                                        selection<span class="op">.</span><span class="at">hour</span><span class="op">,</span></span>
<span id="cb90-457"><a href="#cb90-457" aria-hidden="true" tabindex="-1"></a>                                        <span class="bu">window</span><span class="op">.</span><span class="at">darkmode</span>)<span class="op">;</span></span>
<span id="cb90-458"><a href="#cb90-458" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb90-459"><a href="#cb90-459" aria-hidden="true" tabindex="-1"></a>  <span class="co">// const renderGlobe = () =&gt; {</span></span>
<span id="cb90-460"><a href="#cb90-460" aria-hidden="true" tabindex="-1"></a>  <span class="co">//   svg.selectAll("#globe *").remove();</span></span>
<span id="cb90-461"><a href="#cb90-461" aria-hidden="true" tabindex="-1"></a>  <span class="co">//   svg.selectAll("#globe").call(globe, { vizwidth: columnWidth / 1.28, location, ...selection });</span></span>
<span id="cb90-462"><a href="#cb90-462" aria-hidden="true" tabindex="-1"></a>  <span class="co">// }</span></span>
<span id="cb90-463"><a href="#cb90-463" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> setSelection <span class="op">=</span> (newSelection<span class="op">,</span> forceRender <span class="op">=</span> <span class="kw">false</span>) <span class="kw">=&gt;</span> {</span>
<span id="cb90-464"><a href="#cb90-464" aria-hidden="true" tabindex="-1"></a>    <span class="kw">const</span> prev <span class="op">=</span> {<span class="op">...</span>selection}<span class="op">;</span></span>
<span id="cb90-465"><a href="#cb90-465" aria-hidden="true" tabindex="-1"></a>    selection <span class="op">=</span> newSelection<span class="op">;</span></span>
<span id="cb90-466"><a href="#cb90-466" aria-hidden="true" tabindex="-1"></a>    svg<span class="op">.</span><span class="fu">node</span>()<span class="op">.</span><span class="at">value</span> <span class="op">=</span> selection<span class="op">;</span></span>
<span id="cb90-467"><a href="#cb90-467" aria-hidden="true" tabindex="-1"></a>    <span class="kw">this</span><span class="op">.</span><span class="at">value</span> <span class="op">=</span> selection<span class="op">;</span></span>
<span id="cb90-468"><a href="#cb90-468" aria-hidden="true" tabindex="-1"></a>    <span class="kw">set</span>(viewof selectedDate<span class="op">,</span> selection<span class="op">.</span><span class="at">date</span>)<span class="op">;</span></span>
<span id="cb90-469"><a href="#cb90-469" aria-hidden="true" tabindex="-1"></a>    <span class="kw">set</span>(viewof selectedHour<span class="op">,</span> selection<span class="op">.</span><span class="at">hour</span>)<span class="op">;</span></span>
<span id="cb90-470"><a href="#cb90-470" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> (forceRender) {</span>
<span id="cb90-471"><a href="#cb90-471" aria-hidden="true" tabindex="-1"></a>      <span class="fu">renderPlot</span>()<span class="op">;</span></span>
<span id="cb90-472"><a href="#cb90-472" aria-hidden="true" tabindex="-1"></a>      <span class="fu">renderSolarSystem</span>()<span class="op">;</span></span>
<span id="cb90-473"><a href="#cb90-473" aria-hidden="true" tabindex="-1"></a>  <span class="co">//    renderGlobe();</span></span>
<span id="cb90-474"><a href="#cb90-474" aria-hidden="true" tabindex="-1"></a>    } <span class="cf">else</span> <span class="cf">if</span> (prev<span class="op">.</span><span class="at">hour</span> <span class="op">!==</span> selection<span class="op">.</span><span class="at">hour</span> <span class="op">||</span> prev<span class="op">.</span><span class="at">date</span> <span class="op">!==</span> selection<span class="op">.</span><span class="at">date</span>) {</span>
<span id="cb90-475"><a href="#cb90-475" aria-hidden="true" tabindex="-1"></a>      <span class="fu">renderSolarSystem</span>()<span class="op">;</span></span>
<span id="cb90-476"><a href="#cb90-476" aria-hidden="true" tabindex="-1"></a>  <span class="co">//    renderGlobe();</span></span>
<span id="cb90-477"><a href="#cb90-477" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb90-478"><a href="#cb90-478" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb90-479"><a href="#cb90-479" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> plot <span class="op">=</span> svg<span class="op">.</span><span class="fu">append</span>(<span class="st">"g"</span>)</span>
<span id="cb90-480"><a href="#cb90-480" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">"id"</span><span class="op">,</span> <span class="st">"plot"</span>)</span>
<span id="cb90-481"><a href="#cb90-481" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">"transform"</span><span class="op">,</span> <span class="vs">`translate(</span><span class="sc">${</span>margin<span class="op">.</span><span class="at">left</span> <span class="op">+</span> (width <span class="op">&lt;</span> <span class="dv">500</span> <span class="op">?</span> <span class="dv">26</span> <span class="op">:</span> width <span class="op">&lt;</span> <span class="dv">600</span> <span class="op">?</span> <span class="dv">24</span> <span class="op">:</span> width <span class="op">&lt;</span> <span class="dv">700</span> <span class="op">?</span> <span class="dv">22</span> <span class="op">:</span> width <span class="op">&lt;</span> <span class="dv">800</span> <span class="op">?</span> <span class="dv">20</span> <span class="op">:</span> width <span class="op">&lt;</span> <span class="dv">900</span> <span class="op">?</span> <span class="dv">18</span> <span class="op">:</span> width <span class="op">&lt;</span> <span class="dv">950</span> <span class="op">?</span> <span class="dv">16</span> <span class="op">:</span> width <span class="op">&lt;</span> <span class="dv">1000</span> <span class="op">?</span> <span class="dv">15</span> <span class="op">:</span> width <span class="op">&lt;</span> <span class="dv">1100</span> <span class="op">?</span> <span class="dv">22</span> <span class="op">:</span> width <span class="op">&lt;</span> <span class="dv">1200</span> <span class="op">?</span> <span class="dv">20</span> <span class="op">:</span> width <span class="op">&lt;</span> <span class="dv">1300</span> <span class="op">?</span> <span class="dv">15</span> <span class="op">:</span> width <span class="op">&lt;</span> <span class="dv">1400</span> <span class="op">?</span> <span class="dv">10</span> <span class="op">:</span> width <span class="op">&lt;</span> <span class="dv">1500</span> <span class="op">?</span> <span class="dv">5</span> <span class="op">:</span> <span class="dv">0</span>)<span class="sc">}</span><span class="vs">, </span><span class="sc">${</span>width <span class="op">&lt;</span> <span class="dv">500</span> <span class="op">?</span> <span class="op">-</span><span class="dv">4</span> <span class="op">:</span> width <span class="op">&lt;</span> <span class="dv">600</span> <span class="op">?</span> <span class="op">-</span><span class="dv">12</span> <span class="op">:</span> width <span class="op">&lt;</span> <span class="dv">700</span> <span class="op">?</span> <span class="op">-</span><span class="dv">20</span> <span class="op">:</span> width <span class="op">&lt;</span> <span class="dv">800</span> <span class="op">?</span> <span class="op">-</span><span class="dv">28</span> <span class="op">:</span> width <span class="op">&lt;</span> <span class="dv">900</span> <span class="op">?</span> <span class="op">-</span><span class="dv">36</span> <span class="op">:</span> width <span class="op">&lt;</span> <span class="dv">950</span> <span class="op">?</span> <span class="op">-</span><span class="dv">44</span> <span class="op">:</span> width <span class="op">&lt;</span> <span class="dv">1000</span> <span class="op">?</span> <span class="op">-</span><span class="dv">48</span> <span class="op">:</span> width <span class="op">&lt;</span> <span class="dv">1100</span> <span class="op">?</span> <span class="op">-</span><span class="dv">52</span> <span class="op">:</span> width <span class="op">&lt;</span> <span class="dv">1200</span> <span class="op">?</span> <span class="op">-</span><span class="dv">54</span> <span class="op">:</span> width <span class="op">&lt;</span> <span class="dv">1300</span> <span class="op">?</span> <span class="op">-</span><span class="dv">56</span> <span class="op">:</span> width <span class="op">&lt;</span> <span class="dv">1400</span> <span class="op">?</span> <span class="op">-</span><span class="dv">60</span> <span class="op">:</span> width <span class="op">&lt;</span> <span class="dv">1450</span> <span class="op">?</span> <span class="op">-</span><span class="dv">62</span> <span class="op">:</span> <span class="op">-</span><span class="dv">76</span><span class="sc">}</span><span class="vs">)`</span>)<span class="op">;</span></span>
<span id="cb90-482"><a href="#cb90-482" aria-hidden="true" tabindex="-1"></a>  svg<span class="op">.</span><span class="fu">append</span>(<span class="st">"g"</span>)</span>
<span id="cb90-483"><a href="#cb90-483" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">"id"</span><span class="op">,</span> <span class="st">"solar-system"</span>)</span>
<span id="cb90-484"><a href="#cb90-484" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">"transform"</span><span class="op">,</span> <span class="vs">`translate(</span><span class="sc">${</span>margin<span class="op">.</span><span class="at">left</span> <span class="op">+</span> <span class="dv">12</span><span class="sc">}</span><span class="vs">, </span><span class="sc">${</span>margin<span class="op">.</span><span class="at">top</span> <span class="op">+</span> height <span class="op">/</span> <span class="fl">1.6</span> <span class="op">+</span> <span class="dv">6</span> <span class="op">+</span> <span class="dv">5</span> <span class="op">*</span> (width <span class="op">&lt;</span> <span class="dv">400</span>)<span class="sc">}</span><span class="vs">)`</span>)<span class="op">;</span></span>
<span id="cb90-485"><a href="#cb90-485" aria-hidden="true" tabindex="-1"></a>  <span class="co">// svg.append("g")</span></span>
<span id="cb90-486"><a href="#cb90-486" aria-hidden="true" tabindex="-1"></a>  <span class="co">//   .attr("id", "globe")</span></span>
<span id="cb90-487"><a href="#cb90-487" aria-hidden="true" tabindex="-1"></a>  <span class="co">//   .attr("transform", `translate(${margin.left + margin.inner + columnWidth / 2 + 20}, ${margin.top + height / 1.2 + 4})`);</span></span>
<span id="cb90-488"><a href="#cb90-488" aria-hidden="true" tabindex="-1"></a>  <span class="fu">setSelection</span>(selection<span class="op">,</span> <span class="kw">true</span>)<span class="op">;</span></span>
<span id="cb90-489"><a href="#cb90-489" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> handleDateHourChange <span class="op">=</span> ({ target<span class="op">,</span> <span class="dt">detail</span><span class="op">:</span> { date<span class="op">,</span> hour }}) <span class="kw">=&gt;</span> {</span>
<span id="cb90-490"><a href="#cb90-490" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> (date <span class="op">!=</span> <span class="kw">null</span> <span class="op">&amp;&amp;</span> hour <span class="op">!=</span> <span class="kw">null</span>) <span class="fu">setSelection</span>({<span class="op">...</span>selection<span class="op">,</span> date<span class="op">,</span> hour})<span class="op">;</span></span>
<span id="cb90-491"><a href="#cb90-491" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb90-492"><a href="#cb90-492" aria-hidden="true" tabindex="-1"></a>  svg<span class="op">.</span><span class="fu">node</span>()<span class="op">.</span><span class="fu">addEventListener</span>(EventType<span class="op">.</span><span class="at">DateHourChange</span><span class="op">,</span> handleDateHourChange<span class="op">,</span> <span class="kw">false</span>)<span class="op">;</span></span>
<span id="cb90-493"><a href="#cb90-493" aria-hidden="true" tabindex="-1"></a>  <span class="cf">return</span> svg<span class="op">.</span><span class="fu">node</span>()<span class="op">;</span></span>
<span id="cb90-494"><a href="#cb90-494" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb90-495"><a href="#cb90-495" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb90-496"><a href="#cb90-496" aria-hidden="true" tabindex="-1"></a>:::</span>
<span id="cb90-497"><a href="#cb90-497" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb90-500"><a href="#cb90-500" aria-hidden="true" tabindex="-1"></a><span class="in">```{ojs}</span></span>
<span id="cb90-501"><a href="#cb90-501" aria-hidden="true" tabindex="-1"></a>width</span>
<span id="cb90-502"><a href="#cb90-502" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb90-503"><a href="#cb90-503" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb90-504"><a href="#cb90-504" aria-hidden="true" tabindex="-1"></a><span class="fu">## Yearly day aggregate (yda) {#yda .hiddenheading}</span></span>
<span id="cb90-505"><a href="#cb90-505" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb90-506"><a href="#cb90-506" aria-hidden="true" tabindex="-1"></a>The red<span class="dt">&lt;</span><span class="kw">font</span><span class="ot"> color</span><span class="op">=</span><span class="st">red</span><span class="dt">&gt;</span>—<span class="dt">&lt;/</span><span class="kw">font</span><span class="dt">&gt;</span>line indicates a "day of year" (<span class="co">[</span><span class="ot">doy</span><span class="co">]</span>{.tool data-bs-toggle="tooltip" data-bs-title="day of year"}), \${selDateHsl}, and the red🔴dot denotes a "time of day" (<span class="co">[</span><span class="ot">tod</span><span class="co">]</span>{.tool data-bs-toggle="tooltip" data-bs-title="time of day"}): \${selTimeDay}. A <span class="co">[</span><span class="ot">doy</span><span class="co">]</span>{.tool data-bs-toggle="tooltip" data-bs-title="day of year"} identifies a day in a year like a <span class="co">[</span><span class="ot">Gregorian calendar</span><span class="co">](https://en.wikipedia.org/wiki/Gregorian_calendar#:~:text=the%20calendar%20used%20in%20most%20parts%20of%20the%20world)</span> month and "day of month" (<span class="co">[</span><span class="ot">dom</span><span class="co">]</span>{.tool data-bs-toggle="tooltip" data-bs-title="day of month"}). A <span class="co">[</span><span class="ot">tod</span><span class="co">]</span>{.tool data-bs-toggle="tooltip" data-bs-title="time of day"} specifies a point in a day like an "hour minute second" (<span class="co">[</span><span class="ot">hms</span><span class="co">]</span>{.tool data-bs-toggle="tooltip" data-bs-title="hour minute second"}) triplet.</span>
<span id="cb90-507"><a href="#cb90-507" aria-hidden="true" tabindex="-1"></a>Together, a <span class="co">[</span><span class="ot">doy</span><span class="co">]</span>{.tool data-bs-toggle="tooltip" data-bs-title="day of year"} and <span class="co">[</span><span class="ot">tod</span><span class="co">]</span>{.tool data-bs-toggle="tooltip" data-bs-title="time of day"} can form a "yearly day aggregate" (<span class="co">[</span><span class="ot">yda</span><span class="co">]</span>{.tool data-bs-toggle="tooltip" data-bs-title="yearly day aggregate"}): \${selYdaDay}.</span>
<span id="cb90-508"><a href="#cb90-508" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb90-509"><a href="#cb90-509" aria-hidden="true" tabindex="-1"></a>$$\text{yda} = \text{doy} + \text{tod}$$</span>
<span id="cb90-510"><a href="#cb90-510" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb90-511"><a href="#cb90-511" aria-hidden="true" tabindex="-1"></a>$$\lfloor\text{yda}\rfloor = \text{doy}$$</span>
<span id="cb90-512"><a href="#cb90-512" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb90-513"><a href="#cb90-513" aria-hidden="true" tabindex="-1"></a>$$\text{yda} - \text{doy} = \text{tod}$$</span>
<span id="cb90-514"><a href="#cb90-514" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb90-515"><a href="#cb90-515" aria-hidden="true" tabindex="-1"></a>As their names suggest, <span class="co">[</span><span class="ot">doys</span><span class="co">]</span>{.tool data-bs-toggle="tooltip" data-bs-title="days of year"} and <span class="co">[</span><span class="ot">ydas</span><span class="co">]</span>{.tool data-bs-toggle="tooltip" data-bs-title="yearly day aggregates"} are measured in days. The <span class="co">[</span><span class="ot">measurement unit</span><span class="co">](https://en.wikipedia.org/wiki/Unit_of_measurement#:~:text=a%20definite%20magnitude%20of%20a%20quantity)</span> of a <span class="co">[</span><span class="ot">tod</span><span class="co">]</span>{.tool data-bs-toggle="tooltip" data-bs-title="time of day"} can be a day or a <span class="co">[</span><span class="ot">submultiple</span><span class="co">](https://en.wikipedia.org/wiki/Multiple_%28mathematics%29#Submultiple:~:text=of%20%22a%20being-,a%20unit%20fraction,-of%20b%22%20)</span> of a day. By changing how a decimal <span class="co">[</span><span class="ot">tod</span><span class="co">]</span>{.tool data-bs-toggle="tooltip" data-bs-title="time of day"} is measured, we can shift its <span class="co">[</span><span class="ot">decimal separator</span><span class="co">](https://en.wikipedia.org/wiki/Decimal_separator#:~:text=a%20symbol%20that%20separates%20the%20integer%20part%20from%20the%20fractional%20part%20of%20a%20number)</span> or turn it into an integer. The <span class="co">[</span><span class="ot">tods</span><span class="co">]</span>{.tool data-bs-toggle="tooltip" data-bs-title="times of day"} along the y-axis of the area chart are integers because they have three digits and are measured in <span class="co">[</span><span class="ot">millidays</span><span class="co">]</span>{.tool data-bs-toggle="tooltip" data-bs-title="thousandths of a day"}.</span>
<span id="cb90-516"><a href="#cb90-516" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb90-517"><a href="#cb90-517" aria-hidden="true" tabindex="-1"></a><span class="fu">## Epochal day aggregate (eda) {#eda .hiddenheading}</span></span>
<span id="cb90-518"><a href="#cb90-518" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb90-519"><a href="#cb90-519" aria-hidden="true" tabindex="-1"></a>We can replace an <span class="co">[</span><span class="ot">yda</span><span class="co">]</span>{.tool data-bs-toggle="tooltip" data-bs-title="yearly day aggregate"} with a <span class="co">[</span><span class="ot">tod</span><span class="co">]</span>{.tool data-bs-toggle="tooltip" data-bs-title="time of day"} by <span class="co">[</span><span class="ot">keeping the remainder after dividing</span><span class="co">](https://en.wikipedia.org/wiki/Modulo#:~:text=returns%20the%20remainder)</span> by one to isolate the <span class="co">[</span><span class="ot">decimal part</span><span class="co">](https://en.wikipedia.org/wiki/Fractional_part#:~:text=the%20excess%20beyond%20that%20number%27s%20integer%20part)</span> of the <span class="co">[</span><span class="ot">quotient</span><span class="co">](https://en.wikipedia.org/wiki/Quotient#:~:text=a%20quantity%20produced%20by%20the%20division%20of%20two%20numbers)</span>: \${zeroYdaHsl} <span class="co">[</span><span class="ot">mod</span><span class="co">](https://en.wikipedia.org/wiki/Modulo#:~:text=returns%20the%20remainder)</span> 1 = \${zeroTimeHsl0}. We can use this same approach to obtain a <span class="co">[</span><span class="ot">tod</span><span class="co">]</span>{.tool data-bs-toggle="tooltip" data-bs-title="time of day"} from an "epochal day aggregate" (<span class="co">[</span><span class="ot">eda</span><span class="co">]</span>{.tool data-bs-toggle="tooltip" data-bs-title="epochal day aggregate"}): \${zeroDoteHsl} mod 1 = \${zeroTimeHsl1}. The current <span class="co">[</span><span class="ot">eda</span><span class="co">]</span>{.tool data-bs-toggle="tooltip" data-bs-title="epochal day aggregate"} tells us how many days have passed since the Dec <span class="co">[</span><span class="ot">epoch</span><span class="co">](https://en.wikipedia.org/wiki/Epoch#:~:text=an%20instant%20in%20time%20chosen%20as%20the%20origin%20of%20a%20particular%20calendar%20era)</span>.</span>
<span id="cb90-520"><a href="#cb90-520" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb90-521"><a href="#cb90-521" aria-hidden="true" tabindex="-1"></a>$$\text{tod} = \text{yda mod } 1 = \text{eda mod } 1$$</span>
<span id="cb90-522"><a href="#cb90-522" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb90-523"><a href="#cb90-523" aria-hidden="true" tabindex="-1"></a><span class="fu">## UNIX time equation {#ute .hiddenheading}</span></span>
<span id="cb90-524"><a href="#cb90-524" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb90-525"><a href="#cb90-525" aria-hidden="true" tabindex="-1"></a>Similarly, <span class="co">[</span><span class="ot">UNIX time</span><span class="co">](https://en.wikipedia.org/wiki/Unix_time#:~:text=the%20number%20of%20non%2Dleap%20seconds%20that%20have%20elapsed%20since%2000%3A00%3A00%20UTC%20on%201%C2%A0January%201970%2C%20the%20Unix%20epoch)</span> tallies the seconds since the <span class="co">[</span><span class="ot">UNIX epoch</span><span class="co">](https://en.wikipedia.org/wiki/Unix_time#:~:text=00%3A00%3A00%20UTC%20on%201%C2%A0January%201970)</span>, which is exactly 719468 days after the Dec epoch. To get the <span class="co">[</span><span class="ot">tod</span><span class="co">]</span>{.tool data-bs-toggle="tooltip" data-bs-title="time of day"} in Zone <span class="co">[</span><span class="ot">0</span><span class="co">]</span>{.color0}, the Dec time zone that is in between the two leftmost vertical lines on the map🗺️, we can divide UNIX time by the <span class="co">[</span><span class="ot">number of seconds in a day</span><span class="co">]</span>(https://en.wikipedia.org/wiki/Day#:~:text=average%2C%20this%20is-,24%20hours%20(86%2C400%20seconds),-.%20As%20a%20day) and then keep the remainder after dividing the resulting days by one:</span>
<span id="cb90-526"><a href="#cb90-526" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb90-527"><a href="#cb90-527" aria-hidden="true" tabindex="-1"></a>$$\text{tod} = \text{unix} \div 86400 \text{ mod } 1$$</span>
<span id="cb90-528"><a href="#cb90-528" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb90-529"><a href="#cb90-529" aria-hidden="true" tabindex="-1"></a><span class="fu">## Julian time equation {#jte .hiddenheading}</span></span>
<span id="cb90-530"><a href="#cb90-530" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb90-531"><a href="#cb90-531" aria-hidden="true" tabindex="-1"></a><span class="co">[</span><span class="ot">Julian dates</span><span class="co">](https://en.wikipedia.org/wiki/Julian_day#:~:text=the%20Julian%20day%20number%20plus%20the%20fraction%20of%20a%20day%20since%20the%20preceding%20noon)</span> track the days since the beginning of the <span class="co">[</span><span class="ot">Julian period</span><span class="co">](https://en.wikipedia.org/wiki/Julian_day#:~:text=a%20chronological%20interval%20of%207980%C2%A0years%2C%20derived%20from%20three%20multi%2Dyear%20cycles:%20the%20Indiction%2C%20Solar%2C%20and%20Lunar%20cycles)</span> and thus are akin to <span class="co">[</span><span class="ot">edas</span><span class="co">]</span>{.tool data-bs-toggle="tooltip" data-bs-title="epochal day aggregates"}. We can produce a Zone <span class="co">[</span><span class="ot">5</span><span class="co">]</span>{.color5} <span class="co">[</span><span class="ot">tod</span><span class="co">]</span>{.tool data-bs-toggle="tooltip" data-bs-title="time of day"} from a <span class="co">[</span><span class="ot">Julian date</span><span class="co">](https://en.wikipedia.org/wiki/Julian_day#:~:text=the%20Julian%20day%20number%20plus%20the%20fraction%20of%20a%20day%20since%20the%20preceding%20noon)</span> simply by keeping the remainder after dividing by one. If we want a Zone <span class="co">[</span><span class="ot">0</span><span class="co">]</span>{.color0} <span class="co">[</span><span class="ot">tod</span><span class="co">]</span>{.tool data-bs-toggle="tooltip" data-bs-title="time of day"} instead, we should add <span class="co">[</span><span class="ot">5</span><span class="co">]</span>{.color5} <span class="co">[</span><span class="ot">decidays</span><span class="co">]</span>{.tool data-bs-toggle="tooltip" data-bs-title="tenths of a day"} to the Julian date before converting it to a <span class="co">[</span><span class="ot">tod</span><span class="co">]</span>{.tool data-bs-toggle="tooltip" data-bs-title="time of day"} to ensure that the final result is less than one day:</span>
<span id="cb90-532"><a href="#cb90-532" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb90-533"><a href="#cb90-533" aria-hidden="true" tabindex="-1"></a>$$\text{tod} = (\text{julian} + 0.5) \text{ mod } 1$$</span>
<span id="cb90-534"><a href="#cb90-534" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb90-535"><a href="#cb90-535" aria-hidden="true" tabindex="-1"></a><span class="fu">## Hour minute second {#hms .hiddenheading}</span></span>
<span id="cb90-536"><a href="#cb90-536" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb90-537"><a href="#cb90-537" aria-hidden="true" tabindex="-1"></a>We can also obtain a Zone <span class="co">[</span><span class="ot">0</span><span class="co">]</span>{.color0} <span class="co">[</span><span class="ot">tod</span><span class="co">]</span>{.tool data-bs-toggle="tooltip" data-bs-title="time of day"} from a <span class="co">[</span><span class="ot">Coordinated Universal Time</span><span class="co">](https://en.wikipedia.org/wiki/Coordinated_Universal_Time#:~:text=the%20primary%20time%20standard%20globally%20used%20to%20regulate%20clocks%20and%20time)</span> (<span class="co">[</span><span class="ot">UTC</span><span class="co">]</span>{.tool data-bs-toggle="tooltip" data-bs-title="Coordinated Universal Time"}) <span class="co">[</span><span class="ot">hms</span><span class="co">]</span>{.tool data-bs-toggle="tooltip" data-bs-title="hour minute second"} triplet by summing its components after converting them to fractional days, as shown in the equation below. The <span class="co">[</span><span class="ot">computer programming</span><span class="co">](https://en.wikipedia.org/wiki/Computer_programming#:~:text=the%20composition%20of%20sequences%20of%20instructions%2C%20called%20programs%2C%20that%20computers%20can%20follow%20to%20perform%20tasks)</span> code in the <span class="co">[</span><span class="ot">tabset panel</span><span class="co">](https://quarto.org/docs/interactive/layout.html#tabset-panel)</span> beneath the equation compares <span class="co">[</span><span class="ot">tods</span><span class="co">]</span>{.tool data-bs-toggle="tooltip" data-bs-title="times of day"} derived from <span class="co">[</span><span class="ot">UTC</span><span class="co">]</span>{.tool data-bs-toggle="tooltip" data-bs-title="Coordinated Universal Time"} and UNIX time as Quarto was <span class="co">[</span><span class="ot">rendering</span><span class="co">](https://quarto.org/docs/get-started/hello/rstudio.html#rendering:~:text=When%20rendering%2C%20Quarto%20generates%20a%20new%20file%20that%20contains%20selected%20text%2C%20code%2C%20and%20results)</span> this webpage.</span>
<span id="cb90-538"><a href="#cb90-538" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb90-539"><a href="#cb90-539" aria-hidden="true" tabindex="-1"></a>$$\text{tod} = \frac{\text{hour}}{24} + \frac{\text{minute}}{1440} + \frac{\text{second}}{86400}$$</span>
<span id="cb90-540"><a href="#cb90-540" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb90-541"><a href="#cb90-541" aria-hidden="true" tabindex="-1"></a>:::{.panel-tabset group="language"}</span>
<span id="cb90-542"><a href="#cb90-542" aria-hidden="true" tabindex="-1"></a><span class="fu">### Julia</span></span>
<span id="cb90-543"><a href="#cb90-543" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb90-546"><a href="#cb90-546" aria-hidden="true" tabindex="-1"></a><span class="in">```{julia}</span></span>
<span id="cb90-547"><a href="#cb90-547" aria-hidden="true" tabindex="-1"></a><span class="im">using</span> <span class="bu">Dates</span></span>
<span id="cb90-548"><a href="#cb90-548" aria-hidden="true" tabindex="-1"></a>hms <span class="op">=</span> <span class="fu">now</span>(UTC)</span>
<span id="cb90-549"><a href="#cb90-549" aria-hidden="true" tabindex="-1"></a><span class="fu">hour</span>(hms) <span class="op">/</span> <span class="fl">24</span> <span class="op">+</span></span>
<span id="cb90-550"><a href="#cb90-550" aria-hidden="true" tabindex="-1"></a><span class="fu">minute</span>(hms) <span class="op">/</span> <span class="fl">1440</span> <span class="op">+</span></span>
<span id="cb90-551"><a href="#cb90-551" aria-hidden="true" tabindex="-1"></a><span class="fu">second</span>(hms) <span class="op">/</span> <span class="fl">86400</span> <span class="op">+</span></span>
<span id="cb90-552"><a href="#cb90-552" aria-hidden="true" tabindex="-1"></a><span class="fu">millisecond</span>(hms) <span class="op">/</span> <span class="fl">864e5</span></span>
<span id="cb90-553"><a href="#cb90-553" aria-hidden="true" tabindex="-1"></a><span class="fu">datetime2unix</span>(hms) <span class="op">/</span> <span class="fl">86400</span> <span class="op">%</span> <span class="fl">1</span></span>
<span id="cb90-554"><a href="#cb90-554" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb90-555"><a href="#cb90-555" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb90-556"><a href="#cb90-556" aria-hidden="true" tabindex="-1"></a><span class="fu">### Observable JavaScript</span></span>
<span id="cb90-557"><a href="#cb90-557" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb90-560"><a href="#cb90-560" aria-hidden="true" tabindex="-1"></a><span class="in">```{ojs}</span></span>
<span id="cb90-561"><a href="#cb90-561" aria-hidden="true" tabindex="-1"></a>hms <span class="op">=</span> <span class="kw">new</span> <span class="bu">Date</span>()<span class="op">;</span></span>
<span id="cb90-562"><a href="#cb90-562" aria-hidden="true" tabindex="-1"></a>hms<span class="op">.</span><span class="fu">getUTCHours</span>() <span class="op">/</span> <span class="dv">24</span> <span class="op">+</span></span>
<span id="cb90-563"><a href="#cb90-563" aria-hidden="true" tabindex="-1"></a>hms<span class="op">.</span><span class="fu">getUTCMinutes</span>() <span class="op">/</span> <span class="dv">1440</span> <span class="op">+</span></span>
<span id="cb90-564"><a href="#cb90-564" aria-hidden="true" tabindex="-1"></a>hms<span class="op">.</span><span class="fu">getUTCSeconds</span>() <span class="op">/</span> <span class="dv">86400</span> <span class="op">+</span></span>
<span id="cb90-565"><a href="#cb90-565" aria-hidden="true" tabindex="-1"></a>hms<span class="op">.</span><span class="fu">getUTCMilliseconds</span>() <span class="op">/</span> <span class="fl">864e5</span><span class="op">;</span></span>
<span id="cb90-566"><a href="#cb90-566" aria-hidden="true" tabindex="-1"></a>hms<span class="op">.</span><span class="fu">getTime</span>() <span class="op">/</span> <span class="fl">864e5</span> <span class="op">%</span> <span class="dv">1</span><span class="op">;</span></span>
<span id="cb90-567"><a href="#cb90-567" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb90-568"><a href="#cb90-568" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb90-569"><a href="#cb90-569" aria-hidden="true" tabindex="-1"></a><span class="fu">### Python</span></span>
<span id="cb90-570"><a href="#cb90-570" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb90-573"><a href="#cb90-573" aria-hidden="true" tabindex="-1"></a><span class="in">```{python}</span></span>
<span id="cb90-574"><a href="#cb90-574" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> datetime <span class="im">import</span> datetime, timezone</span>
<span id="cb90-575"><a href="#cb90-575" aria-hidden="true" tabindex="-1"></a>hms <span class="op">=</span> datetime.now(timezone.utc)</span>
<span id="cb90-576"><a href="#cb90-576" aria-hidden="true" tabindex="-1"></a>hms.hour <span class="op">/</span> <span class="dv">24</span> <span class="op">+</span> <span class="op">\</span></span>
<span id="cb90-577"><a href="#cb90-577" aria-hidden="true" tabindex="-1"></a>hms.minute <span class="op">/</span> <span class="dv">1440</span> <span class="op">+</span> <span class="op">\</span></span>
<span id="cb90-578"><a href="#cb90-578" aria-hidden="true" tabindex="-1"></a>hms.second <span class="op">/</span> <span class="dv">86400</span> <span class="op">+</span> <span class="op">\</span></span>
<span id="cb90-579"><a href="#cb90-579" aria-hidden="true" tabindex="-1"></a>hms.microsecond <span class="op">/</span> <span class="fl">864e8</span></span>
<span id="cb90-580"><a href="#cb90-580" aria-hidden="true" tabindex="-1"></a>hms.timestamp() <span class="op">/</span> <span class="dv">86400</span> <span class="op">%</span> <span class="dv">1</span></span>
<span id="cb90-581"><a href="#cb90-581" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb90-582"><a href="#cb90-582" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb90-583"><a href="#cb90-583" aria-hidden="true" tabindex="-1"></a><span class="fu">### R</span></span>
<span id="cb90-584"><a href="#cb90-584" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb90-587"><a href="#cb90-587" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb90-588"><a href="#cb90-588" aria-hidden="true" tabindex="-1"></a>hms <span class="ot">&lt;-</span> <span class="fu">as.POSIXlt</span>(<span class="fu">Sys.time</span>(), <span class="at">tz =</span> <span class="st">"UTC"</span>)</span>
<span id="cb90-589"><a href="#cb90-589" aria-hidden="true" tabindex="-1"></a>hms<span class="sc">$</span>hour <span class="sc">/</span> <span class="dv">24</span> <span class="sc">+</span></span>
<span id="cb90-590"><a href="#cb90-590" aria-hidden="true" tabindex="-1"></a>hms<span class="sc">$</span>min <span class="sc">/</span> <span class="dv">1440</span> <span class="sc">+</span></span>
<span id="cb90-591"><a href="#cb90-591" aria-hidden="true" tabindex="-1"></a>hms<span class="sc">$</span>sec <span class="sc">/</span> <span class="dv">86400</span></span>
<span id="cb90-592"><a href="#cb90-592" aria-hidden="true" tabindex="-1"></a>(<span class="fu">as.numeric</span>(<span class="fu">as.POSIXct</span>(hms)) <span class="sc">/</span> <span class="dv">86400</span>) <span class="sc">%%</span> <span class="dv">1</span></span>
<span id="cb90-593"><a href="#cb90-593" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb90-594"><a href="#cb90-594" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb90-595"><a href="#cb90-595" aria-hidden="true" tabindex="-1"></a>:::</span>
<span id="cb90-596"><a href="#cb90-596" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb90-597"><a href="#cb90-597" aria-hidden="true" tabindex="-1"></a>The equations below convert UNIX time or a Zone <span class="co">[</span><span class="ot">0</span><span class="co">]</span>{.color0} <span class="co">[</span><span class="ot">tod</span><span class="co">]</span>{.tool data-bs-toggle="tooltip" data-bs-title="time of day"} into the three components of an <span class="co">[</span><span class="ot">hms</span><span class="co">]</span>{.tool data-bs-toggle="tooltip" data-bs-title="hour minute second"} triplet: the "hour of day" (<span class="co">[</span><span class="ot">hod</span><span class="co">]</span>{.tool data-bs-toggle="tooltip" data-bs-title="hour of day"}), "minute of hour" (<span class="co">[</span><span class="ot">moh</span><span class="co">]</span>{.tool data-bs-toggle="tooltip" data-bs-title="minute of hour"}), and "second of minute" (<span class="co">[</span><span class="ot">som</span><span class="co">]</span>{.tool data-bs-toggle="tooltip" data-bs-title="second of minute"}), using a "daily second aggregate" (<span class="co">[</span><span class="ot">dsa</span><span class="co">]</span>{.tool data-bs-toggle="tooltip" data-bs-title="daily second aggregate"}) and "hourly second aggregate" (<span class="co">[</span><span class="ot">hsa</span><span class="co">]</span>{.tool data-bs-toggle="tooltip" data-bs-title="hourly second aggregate"}). While both count seconds, <span class="co">[</span><span class="ot">dsas</span><span class="co">]</span>{.tool data-bs-toggle="tooltip" data-bs-title="daily second aggregates"} start at midnight and <span class="co">[</span><span class="ot">hsas</span><span class="co">]</span>{.tool data-bs-toggle="tooltip" data-bs-title="hourly second aggregates"} begin at the <span class="co">[</span><span class="ot">top of the hour</span><span class="co">](https://en.wiktionary.org/wiki/top_of_the_hour)</span>.</span>
<span id="cb90-598"><a href="#cb90-598" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb90-599"><a href="#cb90-599" aria-hidden="true" tabindex="-1"></a>$$\text{dsa} = \text{tod} \times 86400 = \text{unix mod } 86400$$</span>
<span id="cb90-600"><a href="#cb90-600" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb90-601"><a href="#cb90-601" aria-hidden="true" tabindex="-1"></a>$$\text{hsa} = \text{dsa mod } 3600$$</span>
<span id="cb90-602"><a href="#cb90-602" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb90-603"><a href="#cb90-603" aria-hidden="true" tabindex="-1"></a>$$\text{hod} = \lfloor \text{dsa} \div 3600 \rfloor$$</span>
<span id="cb90-604"><a href="#cb90-604" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb90-605"><a href="#cb90-605" aria-hidden="true" tabindex="-1"></a>$$\text{moh} = \lfloor \text{hsa} \div 60 \rfloor$$</span>
<span id="cb90-606"><a href="#cb90-606" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb90-607"><a href="#cb90-607" aria-hidden="true" tabindex="-1"></a>$$\text{som} = \lfloor \text{hsa mod } 60 \rfloor$$</span>
<span id="cb90-608"><a href="#cb90-608" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb90-609"><a href="#cb90-609" aria-hidden="true" tabindex="-1"></a>:::{.panel-tabset group="language"}</span>
<span id="cb90-610"><a href="#cb90-610" aria-hidden="true" tabindex="-1"></a><span class="fu">### Julia</span></span>
<span id="cb90-611"><a href="#cb90-611" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb90-614"><a href="#cb90-614" aria-hidden="true" tabindex="-1"></a><span class="in">```{julia}</span></span>
<span id="cb90-615"><a href="#cb90-615" aria-hidden="true" tabindex="-1"></a><span class="im">using</span> <span class="bu">Dates</span></span>
<span id="cb90-616"><a href="#cb90-616" aria-hidden="true" tabindex="-1"></a>dsa <span class="op">=</span> <span class="fu">datetime2unix</span>(<span class="fu">now</span>(UTC)) <span class="op">/</span> <span class="fl">86400</span> <span class="op">%</span> <span class="fl">1</span> <span class="op">*</span> <span class="fl">86400</span></span>
<span id="cb90-617"><a href="#cb90-617" aria-hidden="true" tabindex="-1"></a>hsa <span class="op">=</span> dsa <span class="op">%</span> <span class="fl">3600</span></span>
<span id="cb90-618"><a href="#cb90-618" aria-hidden="true" tabindex="-1"></a><span class="fu">map</span>(x <span class="op">-&gt;</span> <span class="fu">floor</span>(<span class="dt">Int</span>, x), (dsa <span class="op">/</span> <span class="fl">3600</span>, hsa <span class="op">/</span> <span class="fl">60</span>, hsa <span class="op">%</span> <span class="fl">60</span>))</span>
<span id="cb90-619"><a href="#cb90-619" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb90-620"><a href="#cb90-620" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb90-621"><a href="#cb90-621" aria-hidden="true" tabindex="-1"></a><span class="fu">### Observable JavaScript</span></span>
<span id="cb90-622"><a href="#cb90-622" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb90-625"><a href="#cb90-625" aria-hidden="true" tabindex="-1"></a><span class="in">```{ojs}</span></span>
<span id="cb90-626"><a href="#cb90-626" aria-hidden="true" tabindex="-1"></a>dsa <span class="op">=</span> <span class="bu">Date</span><span class="op">.</span><span class="fu">now</span>() <span class="op">/</span> <span class="fl">864e5</span> <span class="op">%</span> <span class="dv">1</span> <span class="op">*</span> <span class="dv">86400</span><span class="op">;</span></span>
<span id="cb90-627"><a href="#cb90-627" aria-hidden="true" tabindex="-1"></a>hsa <span class="op">=</span> dsa <span class="op">%</span> <span class="dv">3600</span><span class="op">;</span></span>
<span id="cb90-628"><a href="#cb90-628" aria-hidden="true" tabindex="-1"></a>[dsa <span class="op">/</span> <span class="dv">3600</span><span class="op">,</span> hsa <span class="op">/</span> <span class="dv">60</span><span class="op">,</span> hsa <span class="op">%</span> <span class="dv">60</span>]<span class="op">.</span><span class="fu">map</span>(<span class="bu">Math</span><span class="op">.</span><span class="fu">floor</span>)</span>
<span id="cb90-629"><a href="#cb90-629" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb90-630"><a href="#cb90-630" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb90-631"><a href="#cb90-631" aria-hidden="true" tabindex="-1"></a><span class="fu">### Python</span></span>
<span id="cb90-632"><a href="#cb90-632" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb90-635"><a href="#cb90-635" aria-hidden="true" tabindex="-1"></a><span class="in">```{python}</span></span>
<span id="cb90-636"><a href="#cb90-636" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> datetime <span class="im">import</span> datetime, timezone</span>
<span id="cb90-637"><a href="#cb90-637" aria-hidden="true" tabindex="-1"></a>dsa <span class="op">=</span> datetime.now(timezone.utc).timestamp() <span class="op">/</span> <span class="dv">86400</span> <span class="op">%</span> <span class="dv">1</span> <span class="op">*</span> <span class="dv">86400</span></span>
<span id="cb90-638"><a href="#cb90-638" aria-hidden="true" tabindex="-1"></a>hsa <span class="op">=</span> dsa <span class="op">%</span> <span class="dv">3600</span></span>
<span id="cb90-639"><a href="#cb90-639" aria-hidden="true" tabindex="-1"></a><span class="bu">tuple</span>(<span class="bu">map</span>(<span class="bu">int</span>, [dsa <span class="op">//</span> <span class="dv">3600</span>, hsa <span class="op">//</span> <span class="dv">60</span>, hsa <span class="op">%</span> <span class="dv">60</span> <span class="op">//</span> <span class="dv">1</span>]))</span>
<span id="cb90-640"><a href="#cb90-640" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb90-641"><a href="#cb90-641" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb90-642"><a href="#cb90-642" aria-hidden="true" tabindex="-1"></a><span class="fu">### R</span></span>
<span id="cb90-643"><a href="#cb90-643" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb90-646"><a href="#cb90-646" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb90-647"><a href="#cb90-647" aria-hidden="true" tabindex="-1"></a>dsa <span class="ot">&lt;-</span> (<span class="fu">as.numeric</span>(<span class="fu">as.POSIXct</span>(<span class="fu">Sys.time</span>())) <span class="sc">/</span> <span class="dv">86400</span>) <span class="sc">%%</span> <span class="dv">1</span> <span class="sc">*</span> <span class="dv">86400</span></span>
<span id="cb90-648"><a href="#cb90-648" aria-hidden="true" tabindex="-1"></a>hsa <span class="ot">&lt;-</span> dsa <span class="sc">%%</span> <span class="dv">3600</span></span>
<span id="cb90-649"><a href="#cb90-649" aria-hidden="true" tabindex="-1"></a><span class="fu">sapply</span>(<span class="fu">c</span>(dsa <span class="sc">%/%</span> <span class="dv">3600</span>, hsa <span class="sc">%/%</span> <span class="dv">60</span>, hsa <span class="sc">%%</span> <span class="dv">60</span>), as.integer)</span>
<span id="cb90-650"><a href="#cb90-650" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb90-651"><a href="#cb90-651" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb90-652"><a href="#cb90-652" aria-hidden="true" tabindex="-1"></a>:::</span>
<span id="cb90-653"><a href="#cb90-653" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb90-654"><a href="#cb90-654" aria-hidden="true" tabindex="-1"></a><span class="fu">## Universal time offset {.hiddenheading #uto}</span></span>
<span id="cb90-655"><a href="#cb90-655" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb90-656"><a href="#cb90-656" aria-hidden="true" tabindex="-1"></a>The <span class="co">[</span><span class="ot">Global Positioning System</span><span class="co">](https://en.wikipedia.org/wiki/Global_Positioning_System#:~:text=a%20satellite%2Dbased%20hyperbolic%20navigation%20system)</span>, <span class="co">[</span><span class="ot">BeiDou</span><span class="co">](https://en.wikipedia.org/wiki/BeiDou#:~:text=a%20satellite%2Dbased%20radio%20navigation%20system)</span>, and <span class="co">[</span><span class="ot">Galileo</span><span class="co">]</span>(https://en.wikipedia.org/wiki/Galileo_(satellite_navigation)#:~:text=a%20global%20navigation%20satellite%20system%20(GNSS)%20created%20by%20the%20European%20Union) <span class="co">[</span><span class="ot">global navigation satellite systems</span><span class="co">](https://en.wikipedia.org/wiki/Satellite_navigation#:~:text=a%20satellite%20navigation%20system%20with%20global%20coverage)</span> along with most --- if not all --- <span class="co">[</span><span class="ot">programming languages</span><span class="co">](https://en.wikipedia.org/wiki/Programming_language#:~:text=a%20system%20of%20notation%20for%20writing%20source%20code%20such%20as%20used%20to%20produce%20a%20computer%20program)</span> do not account for <span class="co">[</span><span class="ot">leap seconds</span><span class="co">](https://en.wikipedia.org/wiki/Leap_second#:~:text=one%2Dsecond%20adjustment)</span>, which appears to be for the best given that leap seconds will be <span class="co">[</span><span class="ot">abolished by 2035</span><span class="co">](https://en.wikipedia.org/wiki/Leap_second#:~:text=at%20the%2027th%20General%20Conference%20on%20Weights%20and%20Measures%2C%20it%20was%20decided%20to%20abandon%20the%20leap%20second%20by%20or%20before%202035)</span>. The goal of leap seconds is to keep <span class="co">[</span><span class="ot">UTC</span><span class="co">]</span>{.tool data-bs-toggle="tooltip" data-bs-title="Coordinated Universal Time"} within <span class="co">[</span><span class="ot">25/24</span><span class="co">](https://en.wikipedia.org/wiki/Leap_second#:~:text=to%20ensure%20that%20the%20difference%20between%20the%20UTC%20and%20UT1%20readings%20will%20never%20exceed%200.9%20seconds)</span> <span class="co">[</span><span class="ot">centimillidays</span><span class="co">]</span>{.tool data-bs-toggle="tooltip" data-bs-title="hundred thousands of a day"} (<span class="co">[</span><span class="ot">cmds</span><span class="co">]</span>{.tool data-bs-toggle="tooltip" data-bs-title="centimillidays"}) of <span class="co">[</span><span class="ot">Universal Time</span><span class="co">](https://en.wikipedia.org/wiki/Universal_Time#Versions:~:text=a%20time%20standard%20based%20on%20Earth%27s%20rotation)</span> (<span class="co">[</span><span class="ot">UT</span><span class="co">]</span>{.tool data-bs-toggle="tooltip" data-bs-title="Universal Time"}).</span>
<span id="cb90-657"><a href="#cb90-657" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb90-658"><a href="#cb90-658" aria-hidden="true" tabindex="-1"></a>Instead of leap seconds, Dec matches <span class="co">[</span><span class="ot">UT</span><span class="co">]</span>{.tool data-bs-toggle="tooltip" data-bs-title="Universal Time"} using a "<span class="co">[</span><span class="ot">universal time offset</span><span class="co">]</span>(https://en.wikipedia.org/wiki/UTC_offset#:~:text=the%20difference%20in%20hours%20and%20minutes%20between%20Coordinated%20Universal%20Time%20(UTC)%20and%20the%20standard%20time%20at%20a%20particular%20place)" (<span class="co">[</span><span class="ot">uto</span><span class="co">]</span>{.tool data-bs-toggle="tooltip" data-bs-title="universal time offset"}). With the <span class="co">[</span><span class="ot">leap second insertion dates</span><span class="co">](https://en.wikipedia.org/wiki/Leap_second#:~:text=Announced%20leap%20seconds%20to%20date)</span> provided by the <span class="co">[</span><span class="ot">International Earth Rotation and Reference Systems Service</span><span class="co">](https://en.wikipedia.org/wiki/International_Earth_Rotation_and_Reference_Systems_Service#:~:text=the%20body%20responsible%20for%20maintaining%20global%20time%20and%20reference%20frame%20standards)</span>, we can approximate the <span class="co">[</span><span class="ot">uto</span><span class="co">]</span>{.tool data-bs-toggle="tooltip" data-bs-title="universal time offset"} that yields <span class="co">[</span><span class="ot">UT</span><span class="co">]</span>{.tool data-bs-toggle="tooltip" data-bs-title="Universal Time"} when added to the Zone <span class="co">[</span><span class="ot">0</span><span class="co">]</span>{.color0} <span class="co">[</span><span class="ot">tod</span><span class="co">]</span>{.tool data-bs-toggle="tooltip" data-bs-title="time of day"} on the <span class="co">[</span><span class="ot">Dec date</span><span class="co">](/dec/date)</span> chosen by the <span class="co">[</span><span class="ot">range</span><span class="co">](https://observablehq.com/framework/inputs/range)</span>🎚️inputs below: \${leapCountHsl} <span class="dv">&amp;div;</span> 8640 = \${leapTzoHsl0}.</span>
<span id="cb90-659"><a href="#cb90-659" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb90-662"><a href="#cb90-662" aria-hidden="true" tabindex="-1"></a><span class="in">```{ojs}</span></span>
<span id="cb90-663"><a href="#cb90-663" aria-hidden="true" tabindex="-1"></a><span class="co">//| echo: false</span></span>
<span id="cb90-664"><a href="#cb90-664" aria-hidden="true" tabindex="-1"></a><span class="co">//| label: dateinput</span></span>
<span id="cb90-665"><a href="#cb90-665" aria-hidden="true" tabindex="-1"></a>viewof leapSecondYear <span class="op">=</span> Inputs<span class="op">.</span><span class="fu">range</span>([<span class="dv">1970</span><span class="op">,</span> <span class="dv">2020</span>]<span class="op">,</span> {<span class="dt">label</span><span class="op">:</span> <span class="st">"Year"</span><span class="op">,</span> <span class="dt">value</span><span class="op">:</span> <span class="dv">1995</span><span class="op">,</span> <span class="dt">step</span><span class="op">:</span> <span class="dv">1</span>})</span>
<span id="cb90-666"><a href="#cb90-666" aria-hidden="true" tabindex="-1"></a>viewof leapSecondDate <span class="op">=</span> Inputs<span class="op">.</span><span class="fu">range</span>([<span class="dv">0</span><span class="op">,</span> <span class="dv">365</span>]<span class="op">,</span> {<span class="dt">label</span><span class="op">:</span> <span class="st">"Day"</span><span class="op">,</span> <span class="dt">value</span><span class="op">:</span> <span class="dv">182</span><span class="op">,</span> <span class="dt">step</span><span class="op">:</span> <span class="dv">1</span>})</span>
<span id="cb90-667"><a href="#cb90-667" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb90-668"><a href="#cb90-668" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb90-669"><a href="#cb90-669" aria-hidden="true" tabindex="-1"></a><span class="fu">## Rounded offset decimal {#rod .hiddenheading}</span></span>
<span id="cb90-670"><a href="#cb90-670" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb90-671"><a href="#cb90-671" aria-hidden="true" tabindex="-1"></a>Of the twenty eight <span class="co">[</span><span class="ot">utos</span><span class="co">]</span>{.tool data-bs-toggle="tooltip" data-bs-title="universal time offsets"} that can be shown in the equation above, one is an integer, one is a <span class="co">[</span><span class="ot">terminating decimal</span><span class="co">](https://en.wikipedia.org/wiki/Repeating_decimal#:~:text=a%20finite%20number%20of%20nonzero%20digits)</span>, and the rest are <span class="co">[</span><span class="ot">repeating decimals</span><span class="co">](https://en.wikipedia.org/wiki/Repeating_decimal#:~:text=the%20same%20sequence%20of%20digits%20is%20repeated%20forever)</span>. To express a repeating decimal <span class="co">[</span><span class="ot">uto</span><span class="co">]</span>{.tool data-bs-toggle="tooltip" data-bs-title="universal time offset"}, Dec uses an <span class="co">[</span><span class="ot">irreducible fraction</span><span class="co">](https://en.wikipedia.org/wiki/Irreducible_fraction#:~:text=a%20fraction%20in%20which%20the%20numerator%20and%20denominator%20are%20integers%20that%20have%20no%20other%20common%20divisors%20than%201)</span> that is called an "exact offset fraction" (<span class="co">[</span><span class="ot">eof</span><span class="co">]</span>{.tool data-bs-toggle="tooltip" data-bs-title="exact offset fraction"}) when by itself or a "<span class="co">[</span><span class="ot">rounding error</span><span class="co">](https://en.wikipedia.org/wiki/Round-off_error#:~:text=the%20difference%20between%20the%20result%20produced%20by%20a%20given%20algorithm%20using%20exact%20arithmetic%20and%20the%20result%20produced%20by%20the%20same%20algorithm%20using%20finite%2Dprecision%2C%20rounded%20arithmetic)</span> fraction" (<span class="co">[</span><span class="ot">ref</span><span class="co">]</span>{.tool data-bs-toggle="tooltip" data-bs-title="roundoff error fraction"}) if it follows a "rounded offset decimal" (<span class="co">[</span><span class="ot">rod</span><span class="co">]</span>{.tool data-bs-toggle="tooltip" data-bs-title="rounded offset decimal"}).</span>
<span id="cb90-672"><a href="#cb90-672" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb90-673"><a href="#cb90-673" aria-hidden="true" tabindex="-1"></a>In the equation below, the <span class="co">[</span><span class="ot">uto</span><span class="co">]</span>{.tool data-bs-toggle="tooltip" data-bs-title="universal time offset"} is the minuend, the <span class="co">[</span><span class="ot">rod</span><span class="co">]</span>{.tool data-bs-toggle="tooltip" data-bs-title="rounded offset decimal"} is the subtrahend, and the <span class="co">[</span><span class="ot">ref</span><span class="co">]</span>{.tool data-bs-toggle="tooltip" data-bs-title="roundoff error fraction"} is the difference. Dec uses the term minuend expansion to describe the replacement of a minuend with a subtrahend and a difference. By replacing a repeating decimal <span class="co">[</span><span class="ot">uto</span><span class="co">]</span>{.tool data-bs-toggle="tooltip" data-bs-title="universal time offset"} with a <span class="co">[</span><span class="ot">rod</span><span class="co">]</span>{.tool data-bs-toggle="tooltip" data-bs-title="rounded offset decimal"} and a <span class="co">[</span><span class="ot">ref</span><span class="co">]</span>{.tool data-bs-toggle="tooltip" data-bs-title="roundoff error fraction"}, we can show the initial digits of the <span class="co">[</span><span class="ot">uto</span><span class="co">]</span>{.tool data-bs-toggle="tooltip" data-bs-title="universal time offset"} as a decimal and the rest as a fraction.</span>
<span id="cb90-674"><a href="#cb90-674" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb90-675"><a href="#cb90-675" aria-hidden="true" tabindex="-1"></a>$$\text{uto} - \text{rod} = \text{ref}$$</span>
<span id="cb90-676"><a href="#cb90-676" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb90-677"><a href="#cb90-677" aria-hidden="true" tabindex="-1"></a>Use the first three range🎚️inputs below to select an <span class="co">[</span><span class="ot">hms</span><span class="co">]</span>{.tool data-bs-toggle="tooltip" data-bs-title="hour minute second"} triplet to be converted to <span class="co">[</span><span class="ot">decidays</span><span class="co">]</span>{.tool data-bs-toggle="tooltip" data-bs-title="tenths of a day"}, plugged into the equation above as the <span class="co">[</span><span class="ot">uto</span><span class="co">]</span>{.tool data-bs-toggle="tooltip" data-bs-title="universal time offset"}, rounded to the number of digits chosen by the fourth range🎚️input, and inserted into the equation as the <span class="co">[</span><span class="ot">rod</span><span class="co">]</span>{.tool data-bs-toggle="tooltip" data-bs-title="rounded offset decimal"}. Once the left-hand side of the equation is complete, we can solve it to get the <span class="co">[</span><span class="ot">ref</span><span class="co">]</span>{.tool data-bs-toggle="tooltip" data-bs-title="roundoff error fraction"}: \${hmsTzoHsl} -- \${hmsRodHsl} = \${hmsRefHsl}.</span>
<span id="cb90-678"><a href="#cb90-678" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb90-681"><a href="#cb90-681" aria-hidden="true" tabindex="-1"></a><span class="in">```{ojs}</span></span>
<span id="cb90-682"><a href="#cb90-682" aria-hidden="true" tabindex="-1"></a><span class="co">//| echo: false</span></span>
<span id="cb90-683"><a href="#cb90-683" aria-hidden="true" tabindex="-1"></a><span class="co">//| label: hmsinput</span></span>
<span id="cb90-684"><a href="#cb90-684" aria-hidden="true" tabindex="-1"></a>viewof hmsinput <span class="op">=</span> Inputs<span class="op">.</span><span class="fu">form</span>([</span>
<span id="cb90-685"><a href="#cb90-685" aria-hidden="true" tabindex="-1"></a>  Inputs<span class="op">.</span><span class="fu">range</span>([<span class="dv">0</span><span class="op">,</span> <span class="dv">23</span>]<span class="op">,</span> {<span class="dt">label</span><span class="op">:</span> <span class="st">"Hour"</span><span class="op">,</span> <span class="dt">value</span><span class="op">:</span> <span class="dv">11</span><span class="op">,</span> <span class="dt">step</span><span class="op">:</span> <span class="dv">1</span>})<span class="op">,</span></span>
<span id="cb90-686"><a href="#cb90-686" aria-hidden="true" tabindex="-1"></a>  Inputs<span class="op">.</span><span class="fu">range</span>([<span class="dv">0</span><span class="op">,</span> <span class="dv">59</span>]<span class="op">,</span> {<span class="dt">label</span><span class="op">:</span> <span class="st">"Minute"</span><span class="op">,</span> <span class="dt">value</span><span class="op">:</span> <span class="dv">0</span><span class="op">,</span> <span class="dt">step</span><span class="op">:</span> <span class="dv">1</span>})<span class="op">,</span></span>
<span id="cb90-687"><a href="#cb90-687" aria-hidden="true" tabindex="-1"></a>  Inputs<span class="op">.</span><span class="fu">range</span>([<span class="dv">0</span><span class="op">,</span> <span class="dv">59</span>]<span class="op">,</span> {<span class="dt">label</span><span class="op">:</span> <span class="st">"Second"</span><span class="op">,</span> <span class="dt">value</span><span class="op">:</span> <span class="dv">0</span><span class="op">,</span> <span class="dt">step</span><span class="op">:</span> <span class="dv">1</span>})<span class="op">,</span></span>
<span id="cb90-688"><a href="#cb90-688" aria-hidden="true" tabindex="-1"></a>])</span>
<span id="cb90-689"><a href="#cb90-689" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb90-690"><a href="#cb90-690" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb90-693"><a href="#cb90-693" aria-hidden="true" tabindex="-1"></a><span class="in">```{ojs}</span></span>
<span id="cb90-694"><a href="#cb90-694" aria-hidden="true" tabindex="-1"></a><span class="co">//| echo: false</span></span>
<span id="cb90-695"><a href="#cb90-695" aria-hidden="true" tabindex="-1"></a><span class="co">//| label: diginput</span></span>
<span id="cb90-696"><a href="#cb90-696" aria-hidden="true" tabindex="-1"></a>viewof digits <span class="op">=</span> Inputs<span class="op">.</span><span class="fu">range</span>([<span class="dv">1</span><span class="op">,</span> <span class="dv">9</span>]<span class="op">,</span> {<span class="dt">label</span><span class="op">:</span> <span class="st">"Digits"</span><span class="op">,</span> <span class="dt">value</span><span class="op">:</span> <span class="dv">3</span><span class="op">,</span> <span class="dt">step</span><span class="op">:</span> <span class="dv">1</span>})</span>
<span id="cb90-697"><a href="#cb90-697" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb90-698"><a href="#cb90-698" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb90-699"><a href="#cb90-699" aria-hidden="true" tabindex="-1"></a><span class="fu"># Time zone offset {.hiddenheading #tzo}</span></span>
<span id="cb90-700"><a href="#cb90-700" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb90-701"><a href="#cb90-701" aria-hidden="true" tabindex="-1"></a>In Dec, a <span class="co">[</span><span class="ot">uto</span><span class="co">]</span>{.tool data-bs-toggle="tooltip" data-bs-title="universal time offset"} can be any type of number, a "time zone offset" (<span class="co">[</span><span class="ot">tzo</span><span class="co">]</span>{.tool data-bs-toggle="tooltip" data-bs-title="time zone offset"}) is an integer, a "solar time offset" (<span class="co">[</span><span class="ot">sto</span><span class="co">]</span>{.tool data-bs-toggle="tooltip" data-bs-title="solar time offset"}) is a terminating decimal, and an <span class="co">[</span><span class="ot">eof</span><span class="co">]</span>{.tool data-bs-toggle="tooltip" data-bs-title="exact offset fraction"} is a repeating decimal. If we derived <span class="co">[</span><span class="ot">deciday</span><span class="co">]</span>{.tool data-bs-toggle="tooltip" data-bs-title="a tenth of a day"} offsets from all 86400 of the <span class="co">[</span><span class="ot">hms</span><span class="co">]</span>{.tool data-bs-toggle="tooltip" data-bs-title="hour minute second"} triplets that can be selected by the range🎚️inputs above, we would have 10 <span class="co">[</span><span class="ot">tzos</span><span class="co">]</span>{.tool data-bs-toggle="tooltip" data-bs-title="time zone offsets"}, 3190 <span class="co">[</span><span class="ot">stos</span><span class="co">]</span>{.tool data-bs-toggle="tooltip" data-bs-title="solar time offsets"}, and 83200 <span class="co">[</span><span class="ot">eofs</span><span class="co">]</span>{.tool data-bs-toggle="tooltip" data-bs-title="exact offset fractions"} or <span class="co">[</span><span class="ot">rod</span><span class="co">]</span>{.tool data-bs-toggle="tooltip" data-bs-title="rounded offset decimal"} and <span class="co">[</span><span class="ot">ref</span><span class="co">]</span>{.tool data-bs-toggle="tooltip" data-bs-title="roundoff error fraction"} pairs.</span>
<span id="cb90-702"><a href="#cb90-702" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb90-703"><a href="#cb90-703" aria-hidden="true" tabindex="-1"></a><span class="fu">## Coordinated Universal Time (UTC) {#utc .hiddenheading}</span></span>
<span id="cb90-704"><a href="#cb90-704" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb90-705"><a href="#cb90-705" aria-hidden="true" tabindex="-1"></a>When we do the same to the <span class="co">[</span><span class="ot">38</span><span class="co">](https://en.wikipedia.org/wiki/List_of_UTC_offsets)</span> <span class="co">[</span><span class="ot">UTC</span><span class="co">]</span>{.tool data-bs-toggle="tooltip" data-bs-title="Coordinated Universal Time"} offsets, we get only <span class="co">[</span><span class="ot">eofs</span><span class="co">]</span>{.tool data-bs-toggle="tooltip" data-bs-title="exact offset fractions"} or <span class="co">[</span><span class="ot">rod</span><span class="co">]</span>{.tool data-bs-toggle="tooltip" data-bs-title="rounded offset decimal"} and <span class="co">[</span><span class="ot">ref</span><span class="co">]</span>{.tool data-bs-toggle="tooltip" data-bs-title="roundoff error fraction"} pairs unless the number of leaps seconds included is zero or a multiple of 27. If the leap second count is zero or a multiple of 8640, we will get 3 <span class="co">[</span><span class="ot">tzos</span><span class="co">]</span>{.tool data-bs-toggle="tooltip" data-bs-title="time zone offsets"}, 9 <span class="co">[</span><span class="ot">stos</span><span class="co">]</span>{.tool data-bs-toggle="tooltip" data-bs-title="solar time offsets"}, and 26 <span class="co">[</span><span class="ot">eofs</span><span class="co">]</span>{.tool data-bs-toggle="tooltip" data-bs-title="exact offset fractions"} or <span class="co">[</span><span class="ot">rod</span><span class="co">]</span>{.tool data-bs-toggle="tooltip" data-bs-title="rounded offset decimal"} and <span class="co">[</span><span class="ot">ref</span><span class="co">]</span>{.tool data-bs-toggle="tooltip" data-bs-title="roundoff error fraction"} pairs. The 3 <span class="co">[</span><span class="ot">tzos</span><span class="co">]</span>{.tool data-bs-toggle="tooltip" data-bs-title="time zone offsets"} will be <span class="co">[</span><span class="ot">stos</span><span class="co">]</span>{.tool data-bs-toggle="tooltip" data-bs-title="solar time offsets"} if the number of leap seconds is a multiple of 27 but not 8640.</span>
<span id="cb90-706"><a href="#cb90-706" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb90-707"><a href="#cb90-707" aria-hidden="true" tabindex="-1"></a>There are 14 negative and 24 positive <span class="co">[</span><span class="ot">UTC</span><span class="co">]</span>{.tool data-bs-toggle="tooltip" data-bs-title="Coordinated Universal Time"} offsets. The <span class="co">[</span><span class="ot">UTC</span><span class="co">]</span>{.tool data-bs-toggle="tooltip" data-bs-title="Coordinated Universal Time"} time zone with <span class="co">[</span><span class="ot">the most negative offset</span><span class="co">](https://en.wikipedia.org/wiki/UTC%E2%88%9212:00#:~:text=a%20nautical%20time%20zone%20comprising%20the%20high%20seas%20between%20180%C2%B0%20and%20172%C2%B030%E2%80%B2W%20longitude)</span> is completely uninhabited. The bar📊chart below visualizes <span class="co">[</span><span class="ot">Socioeconomic Data and Applications Center</span><span class="co">](https://www.earthdata.nasa.gov/centers/sedac-daac)</span> data from 2020 regarding the population of each <span class="co">[</span><span class="ot">UTC</span><span class="co">]</span>{.tool data-bs-toggle="tooltip" data-bs-title="Coordinated Universal Time"} time zone. The vast majority of all people live in <span class="co">[</span><span class="ot">UTC</span><span class="co">]</span>{.tool data-bs-toggle="tooltip" data-bs-title="Coordinated Universal Time"} time zones with positive offsets.</span>
<span id="cb90-708"><a href="#cb90-708" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb90-711"><a href="#cb90-711" aria-hidden="true" tabindex="-1"></a><span class="in">```{ojs}</span></span>
<span id="cb90-712"><a href="#cb90-712" aria-hidden="true" tabindex="-1"></a><span class="co">//| echo: false</span></span>
<span id="cb90-713"><a href="#cb90-713" aria-hidden="true" tabindex="-1"></a><span class="co">//| label: timezonepoptoggles</span></span>
<span id="cb90-714"><a href="#cb90-714" aria-hidden="true" tabindex="-1"></a><span class="co">//| class: /togs</span></span>
<span id="cb90-715"><a href="#cb90-715" aria-hidden="true" tabindex="-1"></a><span class="co">// https://observablehq.com/@mattdzugan/population-by-time-zone-creating-a-dataset</span></span>
<span id="cb90-716"><a href="#cb90-716" aria-hidden="true" tabindex="-1"></a>viewof sortParams <span class="op">=</span> Inputs<span class="op">.</span><span class="fu">form</span>([</span>
<span id="cb90-717"><a href="#cb90-717" aria-hidden="true" tabindex="-1"></a>  Inputs<span class="op">.</span><span class="fu">toggle</span>({ <span class="dt">label</span><span class="op">:</span> <span class="st">"Sort ascending"</span> })<span class="op">,</span></span>
<span id="cb90-718"><a href="#cb90-718" aria-hidden="true" tabindex="-1"></a>  Inputs<span class="op">.</span><span class="fu">toggle</span>({ <span class="dt">label</span><span class="op">:</span> <span class="st">"Sort by offset"</span> })<span class="op">,</span></span>
<span id="cb90-719"><a href="#cb90-719" aria-hidden="true" tabindex="-1"></a>  ])</span>
<span id="cb90-720"><a href="#cb90-720" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb90-721"><a href="#cb90-721" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb90-724"><a href="#cb90-724" aria-hidden="true" tabindex="-1"></a><span class="in">```{ojs}</span></span>
<span id="cb90-725"><a href="#cb90-725" aria-hidden="true" tabindex="-1"></a><span class="co">//| echo: false</span></span>
<span id="cb90-726"><a href="#cb90-726" aria-hidden="true" tabindex="-1"></a><span class="co">//| label: timezonepopstackedbar</span></span>
<span id="cb90-727"><a href="#cb90-727" aria-hidden="true" tabindex="-1"></a><span class="co">//| class: stackedBar</span></span>
<span id="cb90-728"><a href="#cb90-728" aria-hidden="true" tabindex="-1"></a><span class="co">// https://observablehq.com/@mattdzugan/population-by-time-zone-creating-a-dataset</span></span>
<span id="cb90-729"><a href="#cb90-729" aria-hidden="true" tabindex="-1"></a>Plot<span class="op">.</span><span class="fu">plot</span>({</span>
<span id="cb90-730"><a href="#cb90-730" aria-hidden="true" tabindex="-1"></a>  <span class="dt">width</span><span class="op">:</span> width<span class="op">,</span></span>
<span id="cb90-731"><a href="#cb90-731" aria-hidden="true" tabindex="-1"></a>  <span class="dt">marginBottom</span><span class="op">:</span> <span class="dv">50</span><span class="op">,</span></span>
<span id="cb90-732"><a href="#cb90-732" aria-hidden="true" tabindex="-1"></a>  <span class="dt">style</span><span class="op">:</span> <span class="vs">`overflow: visible;font-size:16px;`</span><span class="op">,</span></span>
<span id="cb90-733"><a href="#cb90-733" aria-hidden="true" tabindex="-1"></a>  <span class="dt">color</span><span class="op">:</span> {<span class="dt">scheme</span><span class="op">:</span> <span class="st">"RdBu"</span><span class="op">,</span> <span class="dt">className</span><span class="op">:</span> <span class="st">"barPlotLegend"</span>}<span class="op">,</span></span>
<span id="cb90-734"><a href="#cb90-734" aria-hidden="true" tabindex="-1"></a>  <span class="dt">marginLeft</span><span class="op">:</span> <span class="dv">75</span><span class="op">,</span></span>
<span id="cb90-735"><a href="#cb90-735" aria-hidden="true" tabindex="-1"></a>  <span class="dt">y</span><span class="op">:</span> { <span class="dt">label</span><span class="op">:</span> <span class="kw">null</span> }<span class="op">,</span></span>
<span id="cb90-736"><a href="#cb90-736" aria-hidden="true" tabindex="-1"></a>  <span class="dt">x</span><span class="op">:</span> { <span class="dt">grid</span><span class="op">:</span> <span class="kw">true</span><span class="op">,</span> <span class="dt">label</span><span class="op">:</span> <span class="st">"Population (billions)"</span><span class="op">,</span> <span class="dt">labelOffset</span><span class="op">:</span> <span class="dv">38</span><span class="op">,</span> <span class="dt">transform</span><span class="op">:</span> d <span class="kw">=&gt;</span> d <span class="op">/</span> <span class="fl">1e9</span> }<span class="op">,</span></span>
<span id="cb90-737"><a href="#cb90-737" aria-hidden="true" tabindex="-1"></a>  <span class="dt">marks</span><span class="op">:</span> [</span>
<span id="cb90-738"><a href="#cb90-738" aria-hidden="true" tabindex="-1"></a>    Plot<span class="op">.</span><span class="fu">barX</span>(sortedPop<span class="op">,</span> {<span class="dt">x</span><span class="op">:</span> <span class="st">"pop"</span><span class="op">,</span> <span class="dt">y</span><span class="op">:</span> <span class="st">"Sign"</span><span class="op">,</span> <span class="dt">fill</span><span class="op">:</span> <span class="st">"Offset"</span><span class="op">,</span> <span class="dt">stroke</span><span class="op">:</span> <span class="st">"black"</span><span class="op">,</span> <span class="dt">tip</span><span class="op">:</span> <span class="kw">true</span> })<span class="op">,</span></span>
<span id="cb90-739"><a href="#cb90-739" aria-hidden="true" tabindex="-1"></a>  ]</span>
<span id="cb90-740"><a href="#cb90-740" aria-hidden="true" tabindex="-1"></a>})</span>
<span id="cb90-741"><a href="#cb90-741" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb90-742"><a href="#cb90-742" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb90-743"><a href="#cb90-743" aria-hidden="true" tabindex="-1"></a>Negative <span class="co">[</span><span class="ot">UTC</span><span class="co">]</span>{.tool data-bs-toggle="tooltip" data-bs-title="Coordinated Universal Time"} offsets only exist in <span class="co">[</span><span class="ot">the Americas</span><span class="co">](https://en.wikipedia.org/wiki/Americas#:~:text=a%20landmass%20comprising%20the%20totality%20of%20North%20America%20and%20South%20America)</span> and islands in the <span class="co">[</span><span class="ot">Atlantic</span><span class="co">](https://en.wikipedia.org/wiki/List_of_islands_in_the_Atlantic_Ocean)</span> and <span class="co">[</span><span class="ot">Pacific</span><span class="co">](https://en.wikipedia.org/wiki/List_of_islands_in_the_Pacific_Ocean)</span> Oceans. Therefore, the bar📊chart above is essentially comparing the Americas to the rest of the world. According to 2021 <span class="co">[</span><span class="ot">United Nations Department of Economic and Social Affairs</span><span class="co">](https://en.wikipedia.org/wiki/United_Nations_Department_of_Economic_and_Social_Affairs#:~:text=part%20of%20the%20United%20Nations%20Secretariat)</span> data, about one billion out of a total of almost eight billion people live in the Americas.</span>
<span id="cb90-744"><a href="#cb90-744" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb90-745"><a href="#cb90-745" aria-hidden="true" tabindex="-1"></a>Whenever a negative offset is associated with a Dec date, a <span class="co">[</span><span class="ot">tod</span><span class="co">]</span>{.tool data-bs-toggle="tooltip" data-bs-title="time of day"}, or both a date and a <span class="co">[</span><span class="ot">tod</span><span class="co">]</span>{.tool data-bs-toggle="tooltip" data-bs-title="time of day"}, Dec will add one day to the date and ten <span class="co">[</span><span class="ot">decidays</span><span class="co">]</span>{.tool data-bs-toggle="tooltip" data-bs-title="tenths of a day"} to the offset without modifying the <span class="co">[</span><span class="ot">tod</span><span class="co">]</span>{.tool data-bs-toggle="tooltip" data-bs-title="time of day"}. This typically occurs after the conversion of an <span class="co">[</span><span class="ot">hms</span><span class="co">]</span>{.tool data-bs-toggle="tooltip" data-bs-title="hour minute second"} triplet to a <span class="co">[</span><span class="ot">tod</span><span class="co">]</span>{.tool data-bs-toggle="tooltip" data-bs-title="time of day"} or a "year month day" (<span class="co">[</span><span class="ot">ymd</span><span class="co">]</span>{.tool data-bs-toggle="tooltip" data-bs-title="year month day"}) triplet to a Dec date. As a result, all Dec dates and <span class="co">[</span><span class="ot">tods</span><span class="co">]</span>{.tool data-bs-toggle="tooltip" data-bs-title="times of day"} have positive offsets.</span>
<span id="cb90-746"><a href="#cb90-746" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb90-747"><a href="#cb90-747" aria-hidden="true" tabindex="-1"></a>Dec will not change a negative offset or its associated <span class="co">[</span><span class="ot">doy</span><span class="co">]</span>{.tool data-bs-toggle="tooltip" data-bs-title="day of year"} if the result of adding one day to the <span class="co">[</span><span class="ot">doy</span><span class="co">]</span>{.tool data-bs-toggle="tooltip" data-bs-title="day of year"} is uncertain. This uncertainly can only exist if we do not know whether a <span class="co">[</span><span class="ot">doy</span><span class="co">]</span>{.tool data-bs-toggle="tooltip" data-bs-title="day of year"} that is equal to 364 belongs to a common or leap year. The day after Day <span class="co">[</span><span class="ot">364</span><span class="co">]</span>{.tool data-bs-toggle="tooltip" data-bs-title="February 28"} of a common year is Day <span class="co">[</span><span class="ot">0</span><span class="co">]</span>{.tool data-bs-toggle="tooltip" data-bs-title="March 1"} of the subsequent year. In a leap year, Day <span class="co">[</span><span class="ot">364</span><span class="co">]</span>{.tool data-bs-toggle="tooltip" data-bs-title="February 28"} precedes Day <span class="co">[</span><span class="ot">365</span><span class="co">]</span>{.tool data-bs-toggle="tooltip" data-bs-title="February 29"}.</span>
<span id="cb90-748"><a href="#cb90-748" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb90-749"><a href="#cb90-749" aria-hidden="true" tabindex="-1"></a><span class="fu">## Day of week {#dow .hiddenheading}</span></span>
<span id="cb90-750"><a href="#cb90-750" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb90-751"><a href="#cb90-751" aria-hidden="true" tabindex="-1"></a>Even though it has no effect on the <span class="co">[</span><span class="ot">tod</span><span class="co">]</span>{.tool data-bs-toggle="tooltip" data-bs-title="time of day"}, adding one day to the <span class="co">[</span><span class="ot">doy</span><span class="co">]</span>{.tool data-bs-toggle="tooltip" data-bs-title="day of year"} also increments the "day of month" (<span class="co">[</span><span class="ot">dom</span><span class="co">]</span>{.tool data-bs-toggle="tooltip" data-bs-title="day of month"}) and "day of week" (<span class="co">[</span><span class="ot">dow</span><span class="co">]</span>{.tool data-bs-toggle="tooltip" data-bs-title="day of week"}) shown by Dec. The table below shows how someone accustomed to a negative offset could intrepret Dec <span class="co">[</span><span class="ot">dow</span><span class="co">]</span>{.tool data-bs-toggle="tooltip" data-bs-title="day of week"} numbers. From the perspective of a negative offset user, the <span class="co">[</span><span class="ot">dom</span><span class="co">]</span>{.tool data-bs-toggle="tooltip" data-bs-title="day of month"} and <span class="co">[</span><span class="ot">dow</span><span class="co">]</span>{.tool data-bs-toggle="tooltip" data-bs-title="day of week"} in Dec will be one day ahead.</span>
<span id="cb90-752"><a href="#cb90-752" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb90-753"><a href="#cb90-753" aria-hidden="true" tabindex="-1"></a>:::{.overflowtable style="overflow-x:auto;overflow-y:hidden;"}</span>
<span id="cb90-754"><a href="#cb90-754" aria-hidden="true" tabindex="-1"></a><span class="pp">|</span> Saturday <span class="pp">|</span> Sunday <span class="pp">|</span> Monday <span class="pp">|</span> Tuesday <span class="pp">|</span> Wednesday <span class="pp">|</span> Thursday <span class="pp">|</span> Friday <span class="pp">|</span></span>
<span id="cb90-755"><a href="#cb90-755" aria-hidden="true" tabindex="-1"></a><span class="pp">| --------</span> <span class="pp">| ------</span> <span class="pp">| ------</span> <span class="pp">| -------</span> <span class="pp">| ---------</span> <span class="pp">| --------</span> <span class="pp">| ------</span> <span class="pp">|</span></span>
<span id="cb90-756"><a href="#cb90-756" aria-hidden="true" tabindex="-1"></a><span class="pp">|</span>    0     <span class="pp">|</span>   1    <span class="pp">|</span>   2    <span class="pp">|</span>    3    <span class="pp">|</span>     4     <span class="pp">|</span>    5     <span class="pp">|</span>   6    <span class="pp">|</span></span>
<span id="cb90-757"><a href="#cb90-757" aria-hidden="true" tabindex="-1"></a><span class="pp">|</span>   -7     <span class="pp">|</span>  -6    <span class="pp">|</span>  -5    <span class="pp">|</span>   -4    <span class="pp">|</span>    -3     <span class="pp">|</span>   -2     <span class="pp">|</span>  -1    <span class="pp">|</span></span>
<span id="cb90-758"><a href="#cb90-758" aria-hidden="true" tabindex="-1"></a>:::</span>
<span id="cb90-759"><a href="#cb90-759" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb90-760"><a href="#cb90-760" aria-hidden="true" tabindex="-1"></a>The one day difference between positive and negative offsets may make Dec <span class="co">[</span><span class="ot">dow</span><span class="co">]</span>{.tool data-bs-toggle="tooltip" data-bs-title="day of week"} numbers more intuitive than <span class="co">[</span><span class="ot">POSIX</span><span class="co">]</span>(https://pubs.opengroup.org/onlinepubs/007904875/utilities/date.html#:~:text=weekday%20as%20a%20decimal%20number%20%5B0%2C6%5D%20(0%3Dsunday)) <span class="co">[</span><span class="ot">dow</span><span class="co">]</span>{.tool data-bs-toggle="tooltip" data-bs-title="day of week"} numbers for people who consider <span class="co">[</span><span class="ot">Sunday to be the first [dow]{.tool data-bs-toggle="tooltip" data-bs-title="day of week"}</span><span class="co">](https://en.wikipedia.org/wiki/Names_of_the_days_of_the_week#:~:text=Sunday%20comes%20first,-in%20order%20in)</span>. According to the <span class="co">[</span><span class="ot">Common Locale Data Repository</span><span class="co">](https://en.wikipedia.org/wiki/Week#:~:text=World%20map%20showing%20the%20first%20day%20of%20the%20week%20used%20in%20different%20countries)</span> and a <span class="co">[</span><span class="ot">2023 population ranking</span><span class="co">](https://en.wikipedia.org/w/index.php?title=List_of_countries_in_the_Americas_by_population&amp;oldid=1310903194#Table)</span>, over 89% of people in the Americas live in a country that starts the week on Sunday.</span>
<span id="cb90-761"><a href="#cb90-761" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb90-762"><a href="#cb90-762" aria-hidden="true" tabindex="-1"></a><span class="fu">## Longitude and offsets {.hiddenheading #lao}</span></span>
<span id="cb90-763"><a href="#cb90-763" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb90-764"><a href="#cb90-764" aria-hidden="true" tabindex="-1"></a>In Dec, offsets are closely related to <span class="co">[</span><span class="ot">longitude</span><span class="co">](https://en.wikipedia.org/wiki/Longitude#:~:text=denoted%20by%20the%20Greek%20letter%20lambda)</span>. Dec measures longitude in <span class="co">[</span><span class="ot">parallels</span><span class="co">]</span>(https://en.wikipedia.org/wiki/Circle_of_latitude#:~:text=an%20abstract%20east%E2%80%93west%20small%20circle%20connecting%20all%20locations%20around%20Earth%20(ignoring%20elevation)%20at%20a%20given%20latitude%20coordinate%20line) (<span class="co">[</span><span class="ot">&amp;lambda;</span><span class="co">]</span>{.tool data-bs-toggle="tooltip" data-bs-title="parallel"}) or submultiples of <span class="co">[</span><span class="ot">&amp;lambda;</span><span class="co">]</span>{.tool data-bs-toggle="tooltip" data-bs-title="parallels"} like <span class="co">[</span><span class="ot">deci[parallels](https://en.wikipedia.org/wiki/Circle_of_latitude#:~:text=an%20abstract%20east%E2%80%93west%20small%20circle%20connecting%20all%20locations%20around%20Earth%20(ignoring%20elevation)%20at%20a%20given%20latitude%20coordinate%20line)</span><span class="co">]</span>{.tool data-bs-toggle="tooltip" data-bs-title="a tenth of a parallel"} (<span class="co">[</span><span class="ot">d&amp;lambda;</span><span class="co">]</span>{.tool data-bs-toggle="tooltip" data-bs-title="deciparallels"}). A <span class="co">[</span><span class="ot">tzo</span><span class="co">]</span>{.tool data-bs-toggle="tooltip" data-bs-title="time zone offset"} is essentially a <span class="co">[</span><span class="ot">d&amp;lambda;</span><span class="co">]</span>{.tool data-bs-toggle="tooltip" data-bs-title="deciparallel"} longitude that had its decimal part removed via <span class="co">[</span><span class="ot">rounding</span><span class="co">](https://en.wikipedia.org/wiki/Rounding#:~:text=the%20process%20of%20adjusting%20a%20number%20to%20an%20approximate%2C%20more%20convenient%20value)</span>, <span class="co">[</span><span class="ot">flooring</span><span class="co">](https://en.wikipedia.org/wiki/Floor_and_ceiling_functions#:~:text=takes%20as%20input%20a%20real%20number%20x%2C%20and%20gives%20as%20output%20the%20greatest%20integer%20less%20than%20or%20equal%20to%20x)</span>, <span class="co">[</span><span class="ot">truncation</span><span class="co">](https://en.wikipedia.org/wiki/Truncation#Truncation_and_floor_function:~:text=truncation%20is%20limiting%20the%20number%20of%20digits%20right%20of%20the%20decimal%20point)</span>, or <span class="co">[</span><span class="ot">ceiling</span><span class="co">](https://en.wikipedia.org/wiki/Floor_and_ceiling_functions#:~:text=maps%20x%20to%20the%20least%20integer%20greater%20than%20or%20equal%20to%20x)</span>. Whereas <span class="co">[</span><span class="ot">tzos</span><span class="co">]</span>{.tool data-bs-toggle="tooltip" data-bs-title="time zone offsets"} have one digit, <span class="co">[</span><span class="ot">deciday</span><span class="co">]</span>{.tool data-bs-toggle="tooltip" data-bs-title="a tenth of a day"} <span class="co">[</span><span class="ot">tods</span><span class="co">]</span>{.tool data-bs-toggle="tooltip" data-bs-title="times of day"} and <span class="co">[</span><span class="ot">stos</span><span class="co">]</span>{.tool data-bs-toggle="tooltip" data-bs-title="solar time offsets"} typically have up to four digits after the <span class="co">[</span><span class="ot">decimal separator</span><span class="co">](https://en.wikipedia.org/wiki/Decimal_separator#:~:text=a%20symbol%20that%20separates%20the%20integer%20part%20from%20the%20fractional%20part%20of%20a%20number)</span>.</span>
<span id="cb90-765"><a href="#cb90-765" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb90-766"><a href="#cb90-766" aria-hidden="true" tabindex="-1"></a>The fourth digit in the decimal part of any current deciday <span class="co">[</span><span class="ot">tod</span><span class="co">]</span>{.tool data-bs-toggle="tooltip" data-bs-title="time of day"} increments <span class="co">[</span><span class="ot">10^5^</span><span class="co">]</span>{.tool data-bs-toggle="tooltip" data-bs-title="a hundred thousand"} times per day, 100 times per <span class="co">[</span><span class="ot">milliday</span><span class="co">]</span>{.tool data-bs-toggle="tooltip" data-bs-title="a thousandth of a day"}, or once per <span class="co">[</span><span class="ot">beat</span><span class="co">]</span>{.tool data-bs-toggle="tooltip" data-bs-title="a hundred thousandth of a day"} (<span class="co">[</span><span class="ot">iob</span><span class="co">]</span>{.tool data-bs-toggle="tooltip" data-bs-title="inverse of beat"}), which is the <span class="co">[</span><span class="ot">lower bound</span><span class="co">](https://en.wikipedia.org/wiki/Upper_and_lower_bounds#:~:text=an%20element%20of%20K%20that%20is%20less%20than%20or%20equal%20to%20every%20element%20of%20S)</span> of the <span class="co">[</span><span class="ot">normal resting heart rate</span><span class="co">](https://en.wikipedia.org/wiki/Heart_rate#:~:text=normal%20resting%20adult%20human%20heart%20rate%20is%2060–100%20bpm)</span> of an adult.</span>
<span id="cb90-767"><a href="#cb90-767" aria-hidden="true" tabindex="-1"></a>For <span class="co">[</span><span class="ot">everyday life</span><span class="co">](https://en.wikipedia.org/wiki/Everyday_life)</span>, we should limit the length of <span class="co">[</span><span class="ot">tods</span><span class="co">]</span>{.tool data-bs-toggle="tooltip" data-bs-title="times of day"} to the three digits needed to show <span class="co">[</span><span class="ot">millidays</span><span class="co">]</span>{.tool data-bs-toggle="tooltip" data-bs-title="thousandths of a day"} (<span class="co">[</span><span class="ot">md</span><span class="co">]</span>{.tool data-bs-toggle="tooltip" data-bs-title="millidays"}) or the five digits required to display <span class="co">[</span><span class="ot">beats</span><span class="co">]</span>{.tool data-bs-toggle="tooltip" data-bs-title="hundred thousandths of a day"} (<span class="co">[</span><span class="ot">b</span><span class="co">]</span>{.tool data-bs-toggle="tooltip" data-bs-title="beats"}).</span>
<span id="cb90-768"><a href="#cb90-768" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb90-769"><a href="#cb90-769" aria-hidden="true" tabindex="-1"></a>When the current <span class="co">[</span><span class="ot">tod</span><span class="co">]</span>{.tool data-bs-toggle="tooltip" data-bs-title="time of day"} has seven digits, the sixth digit changes too quickly to be read out loud and the seventh changes so fast that it appears as a blur. Near the Equator, a longitude that has seven digits is accurate to within about ten <span class="co">[</span><span class="ot">zems</span><span class="co">]</span>{.tool data-bs-toggle="tooltip" data-bs-title="zone equatorial meters"} (z) or four <span class="co">[</span><span class="ot">meters</span><span class="co">](https://en.wikipedia.org/wiki/Metre#:~:text=the%20base%20unit%20of%20length%20in%20the%20International%20System%20of%20Units)</span>, which is roughly the length of a <span class="co">[</span><span class="ot">subcompact car</span><span class="co">](https://www.dimensions.com/collection/subcompact-cars-b-segment)</span> or the width of a <span class="co">[</span><span class="ot">U-shaped living room layout</span><span class="co">](https://www.dimensions.com/collection/living-room-layouts)</span>.</span>
<span id="cb90-770"><a href="#cb90-770" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb90-771"><a href="#cb90-771" aria-hidden="true" tabindex="-1"></a>The Equator is approximately (<span class="co">[</span><span class="ot">~</span><span class="co">]</span>{.tool data-bs-toggle="tooltip" data-bs-title="approximately"}) <span class="co">[</span><span class="ot">10^3^</span><span class="co">]</span>{.tool data-bs-toggle="tooltip" data-bs-title="one thousand"} <span class="co">[</span><span class="ot">millitaurs</span><span class="co">]</span>{.tool data-bs-toggle="tooltip" data-bs-title="thousandths of a taur"} (<span class="co">[</span><span class="ot">mc</span><span class="co">]</span>{.tool data-bs-toggle="tooltip" data-bs-title="millitaurs"}), <span class="co">[</span><span class="ot">~</span><span class="co">]</span>{.tool data-bs-toggle="tooltip" data-bs-title="approximately"}4 <span class="dv">&amp;times;</span> <span class="co">[</span><span class="ot">10^4^</span><span class="co">]</span>{.tool data-bs-toggle="tooltip" data-bs-title="ten thousand"} <span class="co">[</span><span class="ot">kilometers</span><span class="co">]</span>{.tool data-bs-toggle="tooltip" data-bs-title="thousands of meters"} (<span class="co">[</span><span class="ot">km</span><span class="co">]</span>{.tool data-bs-toggle="tooltip" data-bs-title="kilometers"}), or <span class="co">[</span><span class="ot">~</span><span class="co">]</span>{.tool data-bs-toggle="tooltip" data-bs-title="approximately"}<span class="co">[</span><span class="ot">10^5^</span><span class="co">]</span>{.tool data-bs-toggle="tooltip" data-bs-title="a hundred thousand"} <span class="co">[</span><span class="ot">kilozems</span><span class="co">]</span>{.tool data-bs-toggle="tooltip" data-bs-title="thousands of zone equatorial meters"} (<span class="co">[</span><span class="ot">kz</span><span class="co">]</span>{.tool data-bs-toggle="tooltip" data-bs-title="kilozems"}) long. If we are near the Equator and move 1 <span class="co">[</span><span class="ot">mc</span><span class="co">]</span>{.tool data-bs-toggle="tooltip" data-bs-title="millitaurs"}, 40 <span class="co">[</span><span class="ot">km</span><span class="co">]</span>{.tool data-bs-toggle="tooltip" data-bs-title="kilometers"}, or 100 <span class="co">[</span><span class="ot">kz</span><span class="co">]</span>{.tool data-bs-toggle="tooltip" data-bs-title="kilozems"} to the East or West, our <span class="co">[</span><span class="ot">sto</span><span class="co">]</span>{.tool data-bs-toggle="tooltip" data-bs-title="solar time offset"} will change by <span class="co">[</span><span class="ot">~</span><span class="co">]</span>{.tool data-bs-toggle="tooltip" data-bs-title="approximately"}1 <span class="co">[</span><span class="ot">md</span><span class="co">]</span>{.tool data-bs-toggle="tooltip" data-bs-title="millidays"}, <span class="co">[</span><span class="ot">~</span><span class="co">]</span>{.tool data-bs-toggle="tooltip" data-bs-title="approximately"}1.44 minutes, or <span class="co">[</span><span class="ot">~</span><span class="co">]</span>{.tool data-bs-toggle="tooltip" data-bs-title="approximately"}100 <span class="co">[</span><span class="ot">b</span><span class="co">]</span>{.tool data-bs-toggle="tooltip" data-bs-title="beat"} and our longitude will shift by <span class="co">[</span><span class="ot">~</span><span class="co">]</span>{.tool data-bs-toggle="tooltip" data-bs-title="approximately"}0.36 degrees, <span class="co">[</span><span class="ot">~</span><span class="co">]</span>{.tool data-bs-toggle="tooltip" data-bs-title="approximately"}1 <span class="co">[</span><span class="ot">m&amp;lambda;</span><span class="co">]</span>{.tool data-bs-toggle="tooltip" data-bs-title="milliparallel"}, <span class="co">[</span><span class="ot">~</span><span class="co">]</span>{.tool data-bs-toggle="tooltip" data-bs-title="approximately"}21.6 <span class="co">[</span><span class="ot">arcminutes</span><span class="co">](https://en.wikipedia.org/wiki/Minute_and_second_of_arc)</span>{.tool data-bs-toggle="tooltip" data-bs-title="a sixtieth of a degree"}, or <span class="co">[</span><span class="ot">~</span><span class="co">]</span>{.tool data-bs-toggle="tooltip" data-bs-title="approximately"}100 arcbeats (<span class="co">[</span><span class="ot">ab</span><span class="co">]</span>{.tool data-bs-toggle="tooltip" data-bs-title="arcbeats"}).</span>
<span id="cb90-772"><a href="#cb90-772" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb90-773"><a href="#cb90-773" aria-hidden="true" tabindex="-1"></a>For precise <span class="co">[</span><span class="ot">geopositioning</span><span class="co">](https://en.wikipedia.org/wiki/Geopositioning#:~:text=estimating%20the%20geographic%20position%20of%20an%20object%20or%20a%20person)</span>, it may be helpful to show <span class="co">[</span><span class="ot">geographic coordinates</span><span class="co">](https://en.wikipedia.org/wiki/Geographic_coordinate_system#:~:text=for%20measuring%20and%20communicating%20positions%20directly%20on%20Earth%20as%20latitude%20and%20longitude)</span> in submultiples of <span class="co">[</span><span class="ot">ab</span><span class="co">]</span>{.tool data-bs-toggle="tooltip" data-bs-title="arcbeats"}, but we are unlikely to benefit from units smaller than <span class="co">[</span><span class="ot">md</span><span class="co">]</span>{.tool data-bs-toggle="tooltip" data-bs-title="millidays"} when displaying the <span class="co">[</span><span class="ot">solar time</span><span class="co">](https://en.wikipedia.org/wiki/Solar_time#:~:text=a%20calculation%20of%20the%20passage%20of%20time%20based%20on%20the%20position%20of%20the%20Sun%20in%20the%20sky)</span> or estimates of what the <span class="co">[</span><span class="ot">tod</span><span class="co">]</span>{.tool data-bs-toggle="tooltip" data-bs-title="time of day"} will be when the Sun rises, reaches its <span class="co">[</span><span class="ot">zenith</span><span class="co">](https://en.m.wikipedia.org/wiki/Noon#:~:text=highest%20position%20above%20the%20horizon)</span>, or sets on a given day. By default, Dec uses three digits to show each solar time and <span class="co">[</span><span class="ot">sto</span><span class="co">]</span>{.tool data-bs-toggle="tooltip" data-bs-title="solar time offset"}.</span>
<span id="cb90-774"><a href="#cb90-774" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb90-775"><a href="#cb90-775" aria-hidden="true" tabindex="-1"></a><span class="fu">## Equation of time {.hiddenheading #eot}</span></span>
<span id="cb90-776"><a href="#cb90-776" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb90-777"><a href="#cb90-777" aria-hidden="true" tabindex="-1"></a>The two types of <span class="co">[</span><span class="ot">solar time</span><span class="co">](https://en.wikipedia.org/wiki/Solar_time#:~:text=a%20calculation%20of%20the%20passage%20of%20time%20based%20on%20the%20position%20of%20the%20Sun%20in%20the%20sky)</span> are <span class="co">[</span><span class="ot">"mean solar time"</span><span class="co">](https://en.wikipedia.org/wiki/Solar_time#Mean_solar_time:~:text=it%20follows%20an%20imaginary%20%22mean%20Sun%22%20that%20moves%20along%20the%20celestial%20equator%20at%20a%20constant%20rate%20that%20matches%20the%20real%20Sun%27s%20average%20rate%20over%20the%20year)</span> (<span class="co">[</span><span class="ot">mst</span><span class="co">]</span>{.tool data-bs-toggle="tooltip" data-bs-title="mean solar time"}) and <span class="co">[</span><span class="ot">"apparent solar time"</span><span class="co">](https://en.wikipedia.org/wiki/Solar_time#Mean_solar_time:~:text=it%20follows%20an%20imaginary%20%22mean%20Sun%22%20that%20moves%20along%20the%20celestial%20equator%20at%20a%20constant%20rate%20that%20matches%20the%20real%20Sun%27s%20average%20rate%20over%20the%20year)</span> (<span class="co">[</span><span class="ot">ast</span><span class="co">]</span>{.tool data-bs-toggle="tooltip" data-bs-title="apparent solar time"}). To calculate <span class="co">[</span><span class="ot">mst</span><span class="co">]</span>{.tool data-bs-toggle="tooltip" data-bs-title="mean solar time"}, we keep only the decimal part of the sum of 0.95, the Zone <span class="co">[</span><span class="ot">0</span><span class="co">]</span>{.color0} <span class="co">[</span><span class="ot">tod</span><span class="co">]</span>{.tool data-bs-toggle="tooltip" data-bs-title="time of day"} measured in days, and our longitude measured in <span class="co">[</span><span class="ot">&amp;lambda;</span><span class="co">]</span>{.tool data-bs-toggle="tooltip" data-bs-title="parallel"}. If we want <span class="co">[</span><span class="ot">ast</span><span class="co">]</span>{.tool data-bs-toggle="tooltip" data-bs-title="apparent solar time"} instead of <span class="co">[</span><span class="ot">mst</span><span class="co">]</span>{.tool data-bs-toggle="tooltip" data-bs-title="mean solar time"}, the sum needs to include the result of plugging the "time of year" (<span class="co">[</span><span class="ot">toy</span><span class="co">]</span>{.tool data-bs-toggle="tooltip" data-bs-title="time of year"}) into the <span class="co">[</span><span class="ot">equation of time</span><span class="co">](https://en.wikipedia.org/wiki/Equation_of_time#:~:text=the%20discrepancy%20between%20two%20kinds%20of%20solar%20time)</span> (<span class="co">[</span><span class="ot">eot</span><span class="co">]</span>{.tool data-bs-toggle="tooltip" data-bs-title="equation of time"}).</span>
<span id="cb90-778"><a href="#cb90-778" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb90-779"><a href="#cb90-779" aria-hidden="true" tabindex="-1"></a>$$\text{toy} = \text{yda} \div \text{n}$$</span>
<span id="cb90-780"><a href="#cb90-780" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb90-781"><a href="#cb90-781" aria-hidden="true" tabindex="-1"></a>$$\text{mst} = (0.95 + \text{tod} + \lambda) \text{ mod } 1$$</span>
<span id="cb90-782"><a href="#cb90-782" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb90-783"><a href="#cb90-783" aria-hidden="true" tabindex="-1"></a>$$\text{ast} = (0.95 + \text{tod} + \lambda +  \text{eot(toy)}) \text{ mod } 1$$</span>
<span id="cb90-784"><a href="#cb90-784" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb90-785"><a href="#cb90-785" aria-hidden="true" tabindex="-1"></a>To obtain the <span class="co">[</span><span class="ot">toy</span><span class="co">]</span>{.tool data-bs-toggle="tooltip" data-bs-title="time of year"}, we divide the <span class="co">[</span><span class="ot">yda</span><span class="co">]</span>{.tool data-bs-toggle="tooltip" data-bs-title="yearly day aggregate"} by the number of days in the year (<span class="co">[</span><span class="ot">n</span><span class="co">]</span>{.tool data-bs-toggle="tooltip" data-bs-title="the number of days in the year"}). If we use <span class="co">[</span><span class="ot">trigonometric functions</span><span class="co">](https://en.wikipedia.org/wiki/Trigonometric_functions#:~:text=functions%20which%20relate%20an%20angle%20of%20a%20right%2Dangled%20triangle%20to%20ratios%20of%20two%20side%20lengths)</span> that are designed to work with <span class="co">[</span><span class="ot">radians</span><span class="co">](https://en.wikipedia.org/wiki/Radian#:~:text=the%20unit%20of%20angle%20in%20the%20International%20System%20of%20Units)</span>, we will have to multiply the <span class="co">[</span><span class="ot">toy</span><span class="co">]</span>{.tool data-bs-toggle="tooltip" data-bs-title="time of year"} by $2\pi$ or $\tau$. We do not need to modify the <span class="co">[</span><span class="ot">toy</span><span class="co">]</span>{.tool data-bs-toggle="tooltip" data-bs-title="time of year"} before passing it to the <span class="co">[</span><span class="ot">eot</span><span class="co">]</span>{.tool data-bs-toggle="tooltip" data-bs-title="equation of time"}() function defined below because its trigonometric functions expect <span class="co">[</span><span class="ot">turns</span><span class="co">](https://en.wikipedia.org/wiki/Turn_%28angle%29#:~:text=a%20unit%20of%20plane%20angle%20measurement%20equal%20to%202%CF%80%C2%A0radians%2C%20360%C2%A0degrees)</span> instead of radians.</span>
<span id="cb90-786"><a href="#cb90-786" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb90-787"><a href="#cb90-787" aria-hidden="true" tabindex="-1"></a>$$\begin{split}</span>
<span id="cb90-788"><a href="#cb90-788" aria-hidden="true" tabindex="-1"></a>\text{eot(toy)} &amp; = \beta_0 <span class="sc">\\</span></span>
<span id="cb90-789"><a href="#cb90-789" aria-hidden="true" tabindex="-1"></a>&amp; + \beta_1 \times \text{costau(toy)} <span class="sc">\\</span></span>
<span id="cb90-790"><a href="#cb90-790" aria-hidden="true" tabindex="-1"></a>&amp; + \beta_2 \times \text{costau(2} \times \text{toy)} <span class="sc">\\</span></span>
<span id="cb90-791"><a href="#cb90-791" aria-hidden="true" tabindex="-1"></a>&amp; + \beta_3 \times \text{sintau(toy)} <span class="sc">\\</span></span>
<span id="cb90-792"><a href="#cb90-792" aria-hidden="true" tabindex="-1"></a>&amp; + \beta_4 \times \text{sintau(2} \times \text{toy)}</span>
<span id="cb90-793"><a href="#cb90-793" aria-hidden="true" tabindex="-1"></a>\end{split}$$</span>
<span id="cb90-794"><a href="#cb90-794" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb90-795"><a href="#cb90-795" aria-hidden="true" tabindex="-1"></a>:::{.panel-tabset group="language"}</span>
<span id="cb90-796"><a href="#cb90-796" aria-hidden="true" tabindex="-1"></a><span class="fu">### Julia</span></span>
<span id="cb90-797"><a href="#cb90-797" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb90-800"><a href="#cb90-800" aria-hidden="true" tabindex="-1"></a><span class="in">```{julia}</span></span>
<span id="cb90-801"><a href="#cb90-801" aria-hidden="true" tabindex="-1"></a><span class="fu">sincostau</span>(turn) <span class="op">=</span> <span class="fu">sincospi</span>(<span class="fl">2</span> <span class="op">*</span> turn)</span>
<span id="cb90-802"><a href="#cb90-802" aria-hidden="true" tabindex="-1"></a><span class="fu">sincostau</span>(<span class="fl">0.25</span>)</span>
<span id="cb90-803"><a href="#cb90-803" aria-hidden="true" tabindex="-1"></a><span class="fu">sincostau</span>(<span class="fl">0.5</span>)</span>
<span id="cb90-804"><a href="#cb90-804" aria-hidden="true" tabindex="-1"></a><span class="fu">sincos</span>(<span class="fl">0.25</span> <span class="op">*</span> <span class="fl">2</span> <span class="op">*</span> <span class="cn">pi</span>)</span>
<span id="cb90-805"><a href="#cb90-805" aria-hidden="true" tabindex="-1"></a><span class="fu">sincos</span>(<span class="fl">0.5</span> <span class="op">*</span> <span class="fl">2</span> <span class="op">*</span> <span class="cn">pi</span>)</span>
<span id="cb90-806"><a href="#cb90-806" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb90-807"><a href="#cb90-807" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb90-808"><a href="#cb90-808" aria-hidden="true" tabindex="-1"></a><span class="fu">### Observable JavaScript</span></span>
<span id="cb90-809"><a href="#cb90-809" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb90-812"><a href="#cb90-812" aria-hidden="true" tabindex="-1"></a><span class="in">```{ojs}</span></span>
<span id="cb90-813"><a href="#cb90-813" aria-hidden="true" tabindex="-1"></a>sincospi <span class="op">=</span> <span class="pp">require</span>(</span>
<span id="cb90-814"><a href="#cb90-814" aria-hidden="true" tabindex="-1"></a>  <span class="st">'https://cdn.jsdelivr.net/gh/stdlib-js/math-base-special-sincospi@umd/browser.js'</span></span>
<span id="cb90-815"><a href="#cb90-815" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb90-816"><a href="#cb90-816" aria-hidden="true" tabindex="-1"></a><span class="kw">function</span> <span class="fu">sincostau</span>(turn) {</span>
<span id="cb90-817"><a href="#cb90-817" aria-hidden="true" tabindex="-1"></a>  <span class="cf">return</span> <span class="fu">sincospi</span>(<span class="dv">2</span> <span class="op">*</span> turn)<span class="op">;</span></span>
<span id="cb90-818"><a href="#cb90-818" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb90-819"><a href="#cb90-819" aria-hidden="true" tabindex="-1"></a><span class="kw">function</span> <span class="fu">sincos</span>(turn) {</span>
<span id="cb90-820"><a href="#cb90-820" aria-hidden="true" tabindex="-1"></a>  turn <span class="op">*=</span> <span class="dv">2</span> <span class="op">*</span> <span class="bu">Math</span><span class="op">.</span><span class="cn">PI</span></span>
<span id="cb90-821"><a href="#cb90-821" aria-hidden="true" tabindex="-1"></a>  <span class="cf">return</span> [<span class="bu">Math</span><span class="op">.</span><span class="fu">sin</span>(turn)<span class="op">,</span> <span class="bu">Math</span><span class="op">.</span><span class="fu">cos</span>(turn)]</span>
<span id="cb90-822"><a href="#cb90-822" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb90-823"><a href="#cb90-823" aria-hidden="true" tabindex="-1"></a><span class="fu">sincostau</span>(<span class="fl">0.25</span>)</span>
<span id="cb90-824"><a href="#cb90-824" aria-hidden="true" tabindex="-1"></a><span class="fu">sincostau</span>(<span class="fl">0.5</span>)</span>
<span id="cb90-825"><a href="#cb90-825" aria-hidden="true" tabindex="-1"></a><span class="fu">sincos</span>(<span class="fl">0.25</span>)</span>
<span id="cb90-826"><a href="#cb90-826" aria-hidden="true" tabindex="-1"></a><span class="fu">sincos</span>(<span class="fl">0.5</span>)</span>
<span id="cb90-827"><a href="#cb90-827" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb90-828"><a href="#cb90-828" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb90-829"><a href="#cb90-829" aria-hidden="true" tabindex="-1"></a><span class="fu">### Python</span></span>
<span id="cb90-830"><a href="#cb90-830" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb90-833"><a href="#cb90-833" aria-hidden="true" tabindex="-1"></a><span class="in">```{python}</span></span>
<span id="cb90-834"><a href="#cb90-834" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> math <span class="im">import</span> cos, sin, pi</span>
<span id="cb90-835"><a href="#cb90-835" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> mpmath <span class="im">import</span> cospi, sinpi</span>
<span id="cb90-836"><a href="#cb90-836" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb90-837"><a href="#cb90-837" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> sincostau(turn):</span>
<span id="cb90-838"><a href="#cb90-838" aria-hidden="true" tabindex="-1"></a>    turn <span class="op">*=</span> <span class="dv">2</span></span>
<span id="cb90-839"><a href="#cb90-839" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> sinpi(turn), cospi(turn)</span>
<span id="cb90-840"><a href="#cb90-840" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb90-841"><a href="#cb90-841" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> sincos(turn):</span>
<span id="cb90-842"><a href="#cb90-842" aria-hidden="true" tabindex="-1"></a>    turn <span class="op">*=</span> <span class="dv">2</span> <span class="op">*</span> pi</span>
<span id="cb90-843"><a href="#cb90-843" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> sin(turn), cos(turn)</span>
<span id="cb90-844"><a href="#cb90-844" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb90-845"><a href="#cb90-845" aria-hidden="true" tabindex="-1"></a>sincostau(<span class="fl">0.25</span>)</span>
<span id="cb90-846"><a href="#cb90-846" aria-hidden="true" tabindex="-1"></a>sincostau(<span class="fl">0.5</span>)</span>
<span id="cb90-847"><a href="#cb90-847" aria-hidden="true" tabindex="-1"></a>sincos(<span class="fl">0.25</span>)</span>
<span id="cb90-848"><a href="#cb90-848" aria-hidden="true" tabindex="-1"></a>sincos(<span class="fl">0.5</span>)</span>
<span id="cb90-849"><a href="#cb90-849" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb90-850"><a href="#cb90-850" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb90-851"><a href="#cb90-851" aria-hidden="true" tabindex="-1"></a><span class="fu">### R</span></span>
<span id="cb90-852"><a href="#cb90-852" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb90-855"><a href="#cb90-855" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb90-856"><a href="#cb90-856" aria-hidden="true" tabindex="-1"></a>sincostau <span class="ot">&lt;-</span> <span class="cf">function</span>(turn) {</span>
<span id="cb90-857"><a href="#cb90-857" aria-hidden="true" tabindex="-1"></a>  turn <span class="ot">&lt;-</span> <span class="dv">2</span> <span class="sc">*</span> turn</span>
<span id="cb90-858"><a href="#cb90-858" aria-hidden="true" tabindex="-1"></a>  <span class="fu">c</span>(<span class="fu">sinpi</span>(turn), <span class="fu">cospi</span>(turn))</span>
<span id="cb90-859"><a href="#cb90-859" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb90-860"><a href="#cb90-860" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb90-861"><a href="#cb90-861" aria-hidden="true" tabindex="-1"></a>sincos <span class="ot">&lt;-</span> <span class="cf">function</span>(turn) {</span>
<span id="cb90-862"><a href="#cb90-862" aria-hidden="true" tabindex="-1"></a>  turn <span class="ot">&lt;-</span> <span class="dv">2</span> <span class="sc">*</span> turn <span class="sc">*</span> pi</span>
<span id="cb90-863"><a href="#cb90-863" aria-hidden="true" tabindex="-1"></a>  <span class="fu">c</span>(<span class="fu">sin</span>(turn), <span class="fu">cos</span>(turn))</span>
<span id="cb90-864"><a href="#cb90-864" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb90-865"><a href="#cb90-865" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb90-866"><a href="#cb90-866" aria-hidden="true" tabindex="-1"></a><span class="fu">sincostau</span>(<span class="fl">0.25</span>)</span>
<span id="cb90-867"><a href="#cb90-867" aria-hidden="true" tabindex="-1"></a><span class="fu">sincostau</span>(<span class="fl">0.5</span>)</span>
<span id="cb90-868"><a href="#cb90-868" aria-hidden="true" tabindex="-1"></a><span class="fu">sincos</span>(<span class="fl">0.25</span>)</span>
<span id="cb90-869"><a href="#cb90-869" aria-hidden="true" tabindex="-1"></a><span class="fu">sincos</span>(<span class="fl">0.5</span>)</span>
<span id="cb90-870"><a href="#cb90-870" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb90-871"><a href="#cb90-871" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb90-872"><a href="#cb90-872" aria-hidden="true" tabindex="-1"></a>:::</span>
<span id="cb90-873"><a href="#cb90-873" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb90-874"><a href="#cb90-874" aria-hidden="true" tabindex="-1"></a>The code above compares two functions which return both the <span class="co">[</span><span class="ot">sine</span><span class="co">](https://en.wikipedia.org/wiki/Sine_and_cosine#:~:text=the%20ratio%20of%20the%20length%20of%20the%20side%20opposite%20that%20angle%20to%20the%20length%20of%20the%20longest%20side%20of%20the%20triangle)</span> and <span class="co">[</span><span class="ot">cosine</span><span class="co">](https://en.wikipedia.org/wiki/Sine_and_cosine#:~:text=the%20ratio%20of%20the%20length%20of%20the%20adjacent%20leg%20to%20that%20of%20the%20hypotenuse)</span> of their input. The sincos() function assumes it will receive radians and the sincostau() works with turns. In general, working with turns is more convenient and intuitive. The examples above demonstrate that using turns instead of radians can <span class="co">[</span><span class="ot">yield more accurate results</span><span class="co">](https://en.wikipedia.org/wiki/Sine_and_cosine#:~:text=Representing%20angles%20in%20turns%20or%20half%2Dturns%20has%20accuracy%20advantages)</span>.</span>
<span id="cb90-875"><a href="#cb90-875" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb90-876"><a href="#cb90-876" aria-hidden="true" tabindex="-1"></a>The values below are the coefficients of a model adapted from the <span class="co">[</span><span class="ot">National Oceanic and Atmospheric Administration</span><span class="co">](https://www.noaa.gov)</span> (<span class="co">[</span><span class="ot">NOAA</span><span class="co">]</span>{.tool data-bs-toggle="tooltip" data-bs-title="National Oceanic and Atmospheric Administration"}) <span class="co">[</span><span class="ot">General Solar Position Calculations</span><span class="co">](https://gml.noaa.gov/grad/solcalc/solareqns.PDF)</span>. Before <span class="co">[</span><span class="ot">fitting</span><span class="co">](https://docs.scipy.org/doc/scipy/reference/generated/scipy.optimize.curve_fit.html)</span> the model to <span class="co">[</span><span class="ot">NOAA</span><span class="co">]</span>{.tool data-bs-toggle="tooltip" data-bs-title="National Oceanic and Atmospheric Administration"} <span class="co">[</span><span class="ot">yearly solar data</span><span class="co">](https://gml.noaa.gov/grad/solcalc/calcdetails.html)</span>, we need to convert eot(<span class="co">[</span><span class="ot">toy</span><span class="co">]</span>{.tool data-bs-toggle="tooltip" data-bs-title="time of year"}) values from minutes to <span class="co">[</span><span class="ot">centidays</span><span class="co">](https://en.wikipedia.org/wiki/Unit_of_time#:~:text=14.4%20minutes%2C%20or%20864%20seconds)</span>{.tool data-bs-toggle="tooltip" data-bs-title="hundredths of a day"}, combine <span class="co">[</span><span class="ot">ymd</span><span class="co">]</span>{.tool data-bs-toggle="tooltip" data-bs-title="year month day"} triplet dates and <span class="co">[</span><span class="ot">hms</span><span class="co">]</span>{.tool data-bs-toggle="tooltip" data-bs-title="hour minute second"} triplet times into <span class="co">[</span><span class="ot">ydas</span><span class="co">]</span>{.tool data-bs-toggle="tooltip" data-bs-title="yearly day aggregates"}, and sort by <span class="co">[</span><span class="ot">yda</span><span class="co">]</span>{.tool data-bs-toggle="tooltip" data-bs-title="yearly day aggregate"}.</span>
<span id="cb90-877"><a href="#cb90-877" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb90-878"><a href="#cb90-878" aria-hidden="true" tabindex="-1"></a>{{&lt; embed eot.ipynb#eot &gt;}}</span>
<span id="cb90-879"><a href="#cb90-879" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb90-882"><a href="#cb90-882" aria-hidden="true" tabindex="-1"></a><span class="in">```{ojs}</span></span>
<span id="cb90-883"><a href="#cb90-883" aria-hidden="true" tabindex="-1"></a><span class="co">//| echo: false</span></span>
<span id="cb90-884"><a href="#cb90-884" aria-hidden="true" tabindex="-1"></a><span class="co">//| label: eotplot</span></span>
<span id="cb90-885"><a href="#cb90-885" aria-hidden="true" tabindex="-1"></a><span class="co">// https://observablehq.com/@mcmcclur/plot-for-mathematicians</span></span>
<span id="cb90-886"><a href="#cb90-886" aria-hidden="true" tabindex="-1"></a>{</span>
<span id="cb90-887"><a href="#cb90-887" aria-hidden="true" tabindex="-1"></a>  <span class="kw">let</span> w <span class="op">=</span> <span class="dv">800</span><span class="op">;</span></span>
<span id="cb90-888"><a href="#cb90-888" aria-hidden="true" tabindex="-1"></a>  <span class="kw">let</span> h <span class="op">=</span> <span class="fl">0.625</span> <span class="op">*</span> w<span class="op">;</span></span>
<span id="cb90-889"><a href="#cb90-889" aria-hidden="true" tabindex="-1"></a>  <span class="kw">let</span> samples <span class="op">=</span> <span class="fu">build_samples</span>(</span>
<span id="cb90-890"><a href="#cb90-890" aria-hidden="true" tabindex="-1"></a>    getEot<span class="op">,</span> <span class="op">-</span><span class="dv">366</span><span class="op">,</span> <span class="dv">365</span><span class="op">,</span> { <span class="dt">N</span><span class="op">:</span> <span class="dv">150</span> }</span>
<span id="cb90-891"><a href="#cb90-891" aria-hidden="true" tabindex="-1"></a>  )<span class="op">;</span></span>
<span id="cb90-892"><a href="#cb90-892" aria-hidden="true" tabindex="-1"></a>  <span class="kw">let</span> plot <span class="op">=</span> Plot<span class="op">.</span><span class="fu">plot</span>({</span>
<span id="cb90-893"><a href="#cb90-893" aria-hidden="true" tabindex="-1"></a>    <span class="dt">marginLeft</span><span class="op">:</span> <span class="dv">60</span><span class="op">,</span></span>
<span id="cb90-894"><a href="#cb90-894" aria-hidden="true" tabindex="-1"></a>    <span class="dt">width</span><span class="op">:</span> w<span class="op">,</span></span>
<span id="cb90-895"><a href="#cb90-895" aria-hidden="true" tabindex="-1"></a>    <span class="dt">height</span><span class="op">:</span> h<span class="op">,</span></span>
<span id="cb90-896"><a href="#cb90-896" aria-hidden="true" tabindex="-1"></a>    <span class="dt">style</span><span class="op">:</span> <span class="st">"font-size:19;"</span><span class="op">,</span></span>
<span id="cb90-897"><a href="#cb90-897" aria-hidden="true" tabindex="-1"></a>    <span class="dt">y</span><span class="op">:</span> {<span class="dt">label</span><span class="op">:</span> <span class="st">"milliday eot(toy)"</span>}<span class="op">,</span></span>
<span id="cb90-898"><a href="#cb90-898" aria-hidden="true" tabindex="-1"></a>    <span class="dt">x</span><span class="op">:</span> {<span class="dt">label</span><span class="op">:</span> <span class="st">"day of year"</span>}<span class="op">,</span></span>
<span id="cb90-899"><a href="#cb90-899" aria-hidden="true" tabindex="-1"></a>    <span class="dt">marks</span><span class="op">:</span> [</span>
<span id="cb90-900"><a href="#cb90-900" aria-hidden="true" tabindex="-1"></a>      Plot<span class="op">.</span><span class="fu">line</span>(samples<span class="op">,</span> {</span>
<span id="cb90-901"><a href="#cb90-901" aria-hidden="true" tabindex="-1"></a>        <span class="dt">strokeWidth</span><span class="op">:</span> <span class="dv">4</span><span class="op">,</span></span>
<span id="cb90-902"><a href="#cb90-902" aria-hidden="true" tabindex="-1"></a>        <span class="dt">stroke</span><span class="op">:</span> <span class="st">"steelblue"</span><span class="op">,</span></span>
<span id="cb90-903"><a href="#cb90-903" aria-hidden="true" tabindex="-1"></a>        <span class="dt">tip</span><span class="op">:</span> <span class="kw">true</span></span>
<span id="cb90-904"><a href="#cb90-904" aria-hidden="true" tabindex="-1"></a>      })<span class="op">,</span></span>
<span id="cb90-905"><a href="#cb90-905" aria-hidden="true" tabindex="-1"></a>      Plot<span class="op">.</span><span class="fu">ruleX</span>([<span class="op">-</span><span class="dv">366</span>])<span class="op">,</span></span>
<span id="cb90-906"><a href="#cb90-906" aria-hidden="true" tabindex="-1"></a>      Plot<span class="op">.</span><span class="fu">ruleY</span>([<span class="dv">0</span>])<span class="op">,</span></span>
<span id="cb90-907"><a href="#cb90-907" aria-hidden="true" tabindex="-1"></a>      Plot<span class="op">.</span><span class="fu">axisX</span>({ <span class="dt">y</span><span class="op">:</span> <span class="dv">0</span> })<span class="op">,</span></span>
<span id="cb90-908"><a href="#cb90-908" aria-hidden="true" tabindex="-1"></a>      Plot<span class="op">.</span><span class="fu">axisY</span>({ <span class="dt">x</span><span class="op">:</span> <span class="op">-</span><span class="dv">366</span> })</span>
<span id="cb90-909"><a href="#cb90-909" aria-hidden="true" tabindex="-1"></a>    ]</span>
<span id="cb90-910"><a href="#cb90-910" aria-hidden="true" tabindex="-1"></a>  })<span class="op">;</span></span>
<span id="cb90-911"><a href="#cb90-911" aria-hidden="true" tabindex="-1"></a>  <span class="cf">return</span> plot<span class="op">;</span></span>
<span id="cb90-912"><a href="#cb90-912" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb90-913"><a href="#cb90-913" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb90-914"><a href="#cb90-914" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb90-915"><a href="#cb90-915" aria-hidden="true" tabindex="-1"></a>The line📈chart above uses <span class="co">[</span><span class="ot">md</span><span class="co">]</span>{.tool data-bs-toggle="tooltip" data-bs-title="millidays"} to display <span class="co">[</span><span class="ot">eot</span><span class="co">]</span>{.tool data-bs-toggle="tooltip" data-bs-title="equation of time"}(<span class="co">[</span><span class="ot">toy</span><span class="co">]</span>{.tool data-bs-toggle="tooltip" data-bs-title="time of year"}) values as integers. There is little difference between <span class="co">[</span><span class="ot">mst</span><span class="co">]</span>{.tool data-bs-toggle="tooltip" data-bs-title="mean solar time"} and <span class="co">[</span><span class="ot">ast</span><span class="co">]</span>{.tool data-bs-toggle="tooltip" data-bs-title="apparent solar time"} around Days <span class="co">[</span><span class="ot">45</span><span class="co">]</span>{.tool data-bs-toggle="tooltip" data-bs-title="April 15"}, <span class="co">[</span><span class="ot">103</span><span class="co">]</span>{.tool data-bs-toggle="tooltip" data-bs-title="June 12"}, <span class="co">[</span><span class="ot">184</span><span class="co">]</span>{.tool data-bs-toggle="tooltip" data-bs-title="September 1"}, and <span class="co">[</span><span class="ot">299</span><span class="co">]</span>{.tool data-bs-toggle="tooltip" data-bs-title="December 25"}. The difference ranges from about -9.8 on <span class="co">[</span><span class="ot">Day 244</span><span class="co">]</span>{.tool data-bs-toggle="tooltip" data-bs-title="October 31"} to around 11.4 <span class="co">[</span><span class="ot">md</span><span class="co">]</span>{.tool data-bs-toggle="tooltip" data-bs-title="millidays"} on <span class="co">[</span><span class="ot">Day 350</span><span class="co">]</span>{.tool data-bs-toggle="tooltip" data-bs-title="February 14"}. We can calculate <span class="co">[</span><span class="ot">mst</span><span class="co">]</span>{.tool data-bs-toggle="tooltip" data-bs-title="mean solar time"} with just a <span class="co">[</span><span class="ot">tod</span><span class="co">]</span>{.tool data-bs-toggle="tooltip" data-bs-title="time of day"} and a longitude and we will be off by at most about a <span class="co">[</span><span class="ot">centiday</span><span class="co">]</span>{.tool data-bs-toggle="tooltip" data-bs-title="a hundredth of a day"} compared to <span class="co">[</span><span class="ot">ast</span><span class="co">]</span>{.tool data-bs-toggle="tooltip" data-bs-title="apparent solar time"}.</span>
<span id="cb90-916"><a href="#cb90-916" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb90-917"><a href="#cb90-917" aria-hidden="true" tabindex="-1"></a>Apart from turning a <span class="co">[</span><span class="ot">mst</span><span class="co">]</span>{.tool data-bs-toggle="tooltip" data-bs-title="mean solar time"} into an <span class="co">[</span><span class="ot">ast</span><span class="co">]</span>{.tool data-bs-toggle="tooltip" data-bs-title="apparent solar time"}, we can also use <span class="co">[</span><span class="ot">eot</span><span class="co">]</span>{.tool data-bs-toggle="tooltip" data-bs-title="equation of time"} to more accurately estimate the <span class="co">[</span><span class="ot">tods</span><span class="co">]</span>{.tool data-bs-toggle="tooltip" data-bs-title="times of day"} of <span class="co">[</span><span class="ot">solar noon</span><span class="co">](https://en.wikipedia.org/wiki/Noon#:~:text=reaching%20its%20highest%20position%20above%20the%20horizon%20on%20that%20day%20and%20casting%20the%20shortest%20shadow)</span>, sunrise, and sunset. The equation below creates a <span class="co">[</span><span class="ot">solar noon</span><span class="co">](https://en.wikipedia.org/wiki/Noon#:~:text=reaching%20its%20highest%20position%20above%20the%20horizon%20on%20that%20day%20and%20casting%20the%20shortest%20shadow)</span> <span class="co">[</span><span class="ot">tod</span><span class="co">]</span>{.tool data-bs-toggle="tooltip" data-bs-title="time of day"} measured in days by adding 9.55 to a longitude measured in <span class="co">[</span><span class="ot">&amp;lambda;</span><span class="co">]</span>{.tool data-bs-toggle="tooltip" data-bs-title="parallel"}, subtracting a <span class="co">[</span><span class="ot">tzo</span><span class="co">]</span>{.tool data-bs-toggle="tooltip" data-bs-title="time zone offset"} and a <span class="co">[</span><span class="ot">eot</span><span class="co">]</span>{.tool data-bs-toggle="tooltip" data-bs-title="equation of time"}(<span class="co">[</span><span class="ot">toy</span><span class="co">]</span>{.tool data-bs-toggle="tooltip" data-bs-title="time of year"}) value that are both measured in days, and keeping only the decimal part of the result.</span>
<span id="cb90-918"><a href="#cb90-918" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb90-919"><a href="#cb90-919" aria-hidden="true" tabindex="-1"></a>$$\text{noon} = (9.55 + \text{tzo} - \lambda - \text{eot(toy)) mod 1}$$</span>
<span id="cb90-920"><a href="#cb90-920" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb90-921"><a href="#cb90-921" aria-hidden="true" tabindex="-1"></a><span class="fu">## Cambridge and Cambridge {.hiddenheading #cac}</span></span>
<span id="cb90-922"><a href="#cb90-922" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb90-923"><a href="#cb90-923" aria-hidden="true" tabindex="-1"></a>To compare the solar noon <span class="co">[</span><span class="ot">tod</span><span class="co">]</span>{.tool data-bs-toggle="tooltip" data-bs-title="time of day"} in two cities, we can plug in the longitude of each city into the equation above. If all the variables in the equation other than longitude are set to zero, the result is almost five <span class="co">[</span><span class="ot">decidays</span><span class="co">]</span>{.tool data-bs-toggle="tooltip" data-bs-title="tenths of a day"} for <span class="co">[</span><span class="ot">Cambridge, England</span><span class="co">](https://en.wikipedia.org/wiki/Cambridge#:~:text=a%20city%20and%20non%2Dmetropolitan%20district%20in%20the%20county%20of%20Cambridgeshire%2C%20England)</span> in the <span class="co">[</span><span class="ot">United Kingdom</span><span class="co">](https://en.wikipedia.org/wiki/United_Kingdom#:~:text=a%20country%20in%20Northwestern%20Europe)</span> and nearly seven <span class="co">[</span><span class="ot">decidays</span><span class="co">]</span>{.tool data-bs-toggle="tooltip" data-bs-title="tenths of a day"} for <span class="co">[</span><span class="ot">Cambridge, Massachusetts</span><span class="co">](https://en.wikipedia.org/wiki/Cambridge,_Massachusetts#:~:text=a%20city%20in%20Middlesex%20County%2C%20Massachusetts%2C%20United%20States)</span> in the <span class="co">[</span><span class="ot">United States</span><span class="co">](https://en.wikipedia.org/wiki/United_States#:~:text=a%20country%20primarily%20located%20in%20North%20America)</span>.</span>
<span id="cb90-924"><a href="#cb90-924" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb90-925"><a href="#cb90-925" aria-hidden="true" tabindex="-1"></a>$$4.99635 = (9.55 - 0.050365) \text{ mod 1} \times 10$$</span>
<span id="cb90-926"><a href="#cb90-926" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb90-927"><a href="#cb90-927" aria-hidden="true" tabindex="-1"></a>$$6.97516 = (9.55 - 0.852484) \text{ mod 1} \times 10$$</span>
<span id="cb90-928"><a href="#cb90-928" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb90-929"><a href="#cb90-929" aria-hidden="true" tabindex="-1"></a>The two homonymous cities are about two <span class="co">[</span><span class="ot">d&amp;lambda;</span><span class="co">]</span>{.tool data-bs-toggle="tooltip" data-bs-title="deciparallels"} apart and thus will always differ by around two <span class="co">[</span><span class="ot">decidays</span><span class="co">]</span>{.tool data-bs-toggle="tooltip" data-bs-title="tenths of a day"} in solar time, regardless of what time zone we use as our frame of reference. England is in Zone <span class="co">[</span><span class="ot">0</span><span class="co">]</span>{.color0} and Massachusetts is in Zone <span class="co">[</span><span class="ot">8</span><span class="co">]</span>{.color8}. If we change the <span class="co">[</span><span class="ot">tzo</span><span class="co">]</span>{.tool data-bs-toggle="tooltip" data-bs-title="time zone offset"} from zero to eight <span class="co">[</span><span class="ot">decidays</span><span class="co">]</span>{.tool data-bs-toggle="tooltip" data-bs-title="tenths of a day"}, the solar noon <span class="co">[</span><span class="ot">tod</span><span class="co">]</span>{.tool data-bs-toggle="tooltip" data-bs-title="time of day"} for each city will be two <span class="co">[</span><span class="ot">decidays</span><span class="co">]</span>{.tool data-bs-toggle="tooltip" data-bs-title="tenths of a day"} earlier.</span>
<span id="cb90-930"><a href="#cb90-930" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb90-931"><a href="#cb90-931" aria-hidden="true" tabindex="-1"></a>$$2.99635 = (9.55 + 0.8 - 0.050365) \text{ mod 1} \times 10$$</span>
<span id="cb90-932"><a href="#cb90-932" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb90-933"><a href="#cb90-933" aria-hidden="true" tabindex="-1"></a>$$4.97516 = (9.55 + 0.8 - 0.852484) \text{ mod 1} \times 10$$</span>
<span id="cb90-934"><a href="#cb90-934" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb90-935"><a href="#cb90-935" aria-hidden="true" tabindex="-1"></a><span class="fu">## Solar declination angle {.hiddenheading #sda}</span></span>
<span id="cb90-936"><a href="#cb90-936" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb90-937"><a href="#cb90-937" aria-hidden="true" tabindex="-1"></a>The duration of <span class="co">[</span><span class="ot">daytime</span><span class="co">](https://en.wikipedia.org/wiki/Daytime#:~:text=the%20period%20of%20the%20day%20during%20which%20a%20given%20location%20experiences%20natural%20illumination%20from%20direct%20sunlight)</span> is the difference between the sunset and sunrise <span class="co">[</span><span class="ot">tods</span><span class="co">]</span>{.tool data-bs-toggle="tooltip" data-bs-title="times of day"}. To calculate the daytime duration, we only need a latitude and a "solar declination angle" (<span class="co">[</span><span class="ot">sda</span><span class="co">]</span>{.tool data-bs-toggle="tooltip" data-bs-title="solar declination angle"}). For simplicity, we can use the same model for the <span class="co">[</span><span class="ot">eot</span><span class="co">]</span>{.tool data-bs-toggle="tooltip" data-bs-title="equation of time"} and <span class="co">[</span><span class="ot">sda</span><span class="co">]</span>{.tool data-bs-toggle="tooltip" data-bs-title="solar declination angle"}, even though the <span class="co">[</span><span class="ot">NOAA</span><span class="co">]</span>{.tool data-bs-toggle="tooltip" data-bs-title="National Oceanic and Atmospheric Administration"} <span class="co">[</span><span class="ot">General Solar Position Calculations</span><span class="co">](https://gml.noaa.gov/grad/solcalc/solareqns.PDF)</span> propose the more complex model shown below.</span>
<span id="cb90-938"><a href="#cb90-938" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb90-939"><a href="#cb90-939" aria-hidden="true" tabindex="-1"></a>$$\begin{split}</span>
<span id="cb90-940"><a href="#cb90-940" aria-hidden="true" tabindex="-1"></a>\text{sda(toy)} &amp; = \beta_0 <span class="sc">\\</span></span>
<span id="cb90-941"><a href="#cb90-941" aria-hidden="true" tabindex="-1"></a>&amp; + \beta_1 \times \text{costau(toy)} <span class="sc">\\</span></span>
<span id="cb90-942"><a href="#cb90-942" aria-hidden="true" tabindex="-1"></a>&amp; + \beta_2 \times \text{sintau(toy)} <span class="sc">\\</span></span>
<span id="cb90-943"><a href="#cb90-943" aria-hidden="true" tabindex="-1"></a>&amp; + \beta_3 \times \text{costau(2} \times \text{toy)} <span class="sc">\\</span></span>
<span id="cb90-944"><a href="#cb90-944" aria-hidden="true" tabindex="-1"></a>&amp; + \beta_4 \times \text{sintau(2} \times \text{toy)} <span class="sc">\\</span></span>
<span id="cb90-945"><a href="#cb90-945" aria-hidden="true" tabindex="-1"></a>&amp; + \beta_5 \times \text{costau(3} \times \text{toy)} <span class="sc">\\</span></span>
<span id="cb90-946"><a href="#cb90-946" aria-hidden="true" tabindex="-1"></a>&amp; + \beta_6 \times \text{sintau(3} \times \text{toy)} <span class="sc">\\</span></span>
<span id="cb90-947"><a href="#cb90-947" aria-hidden="true" tabindex="-1"></a>\end{split}$$</span>
<span id="cb90-948"><a href="#cb90-948" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb90-949"><a href="#cb90-949" aria-hidden="true" tabindex="-1"></a>Dec measures latitude in turns called meridians (<span class="co">[</span><span class="ot">&amp;phi;</span><span class="co">]</span>{.tool data-bs-toggle="tooltip" data-bs-title="meridians"}). Like <span class="co">[</span><span class="ot">&amp;lambda;</span><span class="co">]</span>{.tool data-bs-toggle="tooltip" data-bs-title="parallels"}, we can pass <span class="co">[</span><span class="ot">&amp;phi;</span><span class="co">]</span>{.tool data-bs-toggle="tooltip" data-bs-title="meridians"} directly into trigonometric functions that accept turns. If the "solar zenith angle" (<span class="co">[</span><span class="ot">sza</span><span class="co">]</span>{.tool data-bs-toggle="tooltip" data-bs-title="solar zenith angle"}) in the equation below is 0.252314 turns, the equation will give us a "solar hour angle" (<span class="co">[</span><span class="ot">sha</span><span class="co">]</span>{.tool data-bs-toggle="tooltip" data-bs-title="solar hour angle"}) that we can use to find out how long the Sun will shine or when it will rise or set on a given <span class="co">[</span><span class="ot">doy</span><span class="co">]</span>{.tool data-bs-toggle="tooltip" data-bs-title="day of year"}.</span>
<span id="cb90-950"><a href="#cb90-950" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb90-951"><a href="#cb90-951" aria-hidden="true" tabindex="-1"></a>$$\text{sha} = \arccos\left( \frac{\text{costau(sza)} - \text{sintau($\phi$)} \times \text{sintau(sda)}}{\text{costau($\phi$)} \times \text{costau(sda)}} \right)$$</span>
<span id="cb90-952"><a href="#cb90-952" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb90-953"><a href="#cb90-953" aria-hidden="true" tabindex="-1"></a>Before being plugged into the <span class="co">[</span><span class="ot">sha</span><span class="co">]</span>{.tool data-bs-toggle="tooltip" data-bs-title="solar hour angle"} equation above, the <span class="co">[</span><span class="ot">m&amp;phi;</span><span class="co">]</span>{.tool data-bs-toggle="tooltip" data-bs-title="millimeridians"} latitude selected by the first range input below is divided by 1000 to convert it to <span class="co">[</span><span class="ot">&amp;phi;</span><span class="co">]</span>{.tool data-bs-toggle="tooltip" data-bs-title="meridians"} and the <span class="co">[</span><span class="ot">doy</span><span class="co">]</span>{.tool data-bs-toggle="tooltip" data-bs-title="day of year"} chosen by the second range input is turned into a <span class="co">[</span><span class="ot">toy</span><span class="co">]</span>{.tool data-bs-toggle="tooltip" data-bs-title="time of year"} and then into an <span class="co">[</span><span class="ot">sda</span><span class="co">]</span>{.tool data-bs-toggle="tooltip" data-bs-title="solar declination angle"}. When the <span class="co">[</span><span class="ot">sza</span><span class="co">]</span>{.tool data-bs-toggle="tooltip" data-bs-title="solar zenith angle"} is 0.252314, we can divide the result of the <span class="co">[</span><span class="ot">sha</span><span class="co">]</span>{.tool data-bs-toggle="tooltip" data-bs-title="solar hour angle"} equation by $\pi$ to obtain the daytime duration: \${parseFloat(daytimeDuration.toFixed(6))}.</span>
<span id="cb90-954"><a href="#cb90-954" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb90-955"><a href="#cb90-955" aria-hidden="true" tabindex="-1"></a>$$\text{sunset} - \text{sunrise} = \text{sha} \div \pi$$</span>
<span id="cb90-956"><a href="#cb90-956" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb90-959"><a href="#cb90-959" aria-hidden="true" tabindex="-1"></a><span class="in">```{ojs}</span></span>
<span id="cb90-960"><a href="#cb90-960" aria-hidden="true" tabindex="-1"></a><span class="co">//| echo: false</span></span>
<span id="cb90-961"><a href="#cb90-961" aria-hidden="true" tabindex="-1"></a><span class="co">//| label: latinput</span></span>
<span id="cb90-962"><a href="#cb90-962" aria-hidden="true" tabindex="-1"></a>viewof latInput <span class="op">=</span> Inputs<span class="op">.</span><span class="fu">range</span>([<span class="op">-</span><span class="dv">250</span><span class="op">,</span> <span class="dv">250</span>]<span class="op">,</span> {<span class="dt">label</span><span class="op">:</span> <span class="st">"Latitude"</span><span class="op">,</span> <span class="dt">value</span><span class="op">:</span> <span class="dv">0</span><span class="op">,</span> <span class="dt">step</span><span class="op">:</span> <span class="dv">1</span>})</span>
<span id="cb90-963"><a href="#cb90-963" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb90-964"><a href="#cb90-964" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb90-967"><a href="#cb90-967" aria-hidden="true" tabindex="-1"></a><span class="in">```{ojs}</span></span>
<span id="cb90-968"><a href="#cb90-968" aria-hidden="true" tabindex="-1"></a><span class="co">//| echo: false</span></span>
<span id="cb90-969"><a href="#cb90-969" aria-hidden="true" tabindex="-1"></a><span class="co">//| label: doyinput</span></span>
<span id="cb90-970"><a href="#cb90-970" aria-hidden="true" tabindex="-1"></a>viewof doyInput <span class="op">=</span> Inputs<span class="op">.</span><span class="fu">range</span>([<span class="dv">0</span><span class="op">,</span> <span class="dv">365</span>]<span class="op">,</span> {<span class="dt">label</span><span class="op">:</span> <span class="st">"Day of year"</span><span class="op">,</span> <span class="dt">value</span><span class="op">:</span> <span class="dv">183</span><span class="op">,</span> <span class="dt">step</span><span class="op">:</span> <span class="dv">1</span>})</span>
<span id="cb90-971"><a href="#cb90-971" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb90-972"><a href="#cb90-972" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb90-975"><a href="#cb90-975" aria-hidden="true" tabindex="-1"></a><span class="in">```{ojs}</span></span>
<span id="cb90-976"><a href="#cb90-976" aria-hidden="true" tabindex="-1"></a>daytimeDuration</span>
<span id="cb90-977"><a href="#cb90-977" aria-hidden="true" tabindex="-1"></a>latInput <span class="op">/</span> <span class="dv">1000</span></span>
<span id="cb90-978"><a href="#cb90-978" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb90-979"><a href="#cb90-979" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb90-980"><a href="#cb90-980" aria-hidden="true" tabindex="-1"></a>Like other trigonometric functions, the <span class="co">[</span><span class="ot">arcosine</span><span class="co">](https://en.wikipedia.org/wiki/Inverse_trigonometric_functions#:~:text=y%20%E2%89%A4%2090%C2%B0-,arccosine,-y%20%3D%20arccos)</span> function returns radians. We can divide by $\tau$ to convert radians to turns. After converting the <span class="co">[</span><span class="ot">sha</span><span class="co">]</span>{.tool data-bs-toggle="tooltip" data-bs-title="solar hour angle"} to turns, we can sum it with the solar noon to get the sunset <span class="co">[</span><span class="ot">tod</span><span class="co">]</span>{.tool data-bs-toggle="tooltip" data-bs-title="time of day"} or subtract it from the solar noon <span class="co">[</span><span class="ot">tod</span><span class="co">]</span>{.tool data-bs-toggle="tooltip" data-bs-title="time of day"} to obtain the sunrise <span class="co">[</span><span class="ot">tod</span><span class="co">]</span>{.tool data-bs-toggle="tooltip" data-bs-title="time of day"}. The sunrise and sunset <span class="co">[</span><span class="ot">tods</span><span class="co">]</span>{.tool data-bs-toggle="tooltip" data-bs-title="times of day"} are equidistant from the solar noon <span class="co">[</span><span class="ot">tod</span><span class="co">]</span>{.tool data-bs-toggle="tooltip" data-bs-title="time of day"}.</span>
<span id="cb90-981"><a href="#cb90-981" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb90-982"><a href="#cb90-982" aria-hidden="true" tabindex="-1"></a>$$\text{sunset} = \text{noon} + \text{sha} \div \tau$$</span>
<span id="cb90-983"><a href="#cb90-983" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb90-984"><a href="#cb90-984" aria-hidden="true" tabindex="-1"></a>$$\text{sunrise} = \text{noon} - \text{sha} \div \tau$$</span>
<span id="cb90-985"><a href="#cb90-985" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb90-986"><a href="#cb90-986" aria-hidden="true" tabindex="-1"></a>Before we insert the latitude selected by the second range input, we convert m<span class="dv">&amp;phi;</span> to <span class="dv">&amp;phi;</span>.</span>
<span id="cb90-987"><a href="#cb90-987" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb90-988"><a href="#cb90-988" aria-hidden="true" tabindex="-1"></a>$$\text{sha} \div \tau = \text{noon} - \text{sunrise} = \text{sunset} - \text{noon}$$</span>
<span id="cb90-989"><a href="#cb90-989" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb90-990"><a href="#cb90-990" aria-hidden="true" tabindex="-1"></a>When we divide the sha by $\tau$, we get the difference between the solar noon and sunrise <span class="co">[</span><span class="ot">tods</span><span class="co">]</span>{.tool data-bs-toggle="tooltip" data-bs-title="times of day"} or the sunset and solar noon <span class="co">[</span><span class="ot">tods</span><span class="co">]</span>{.tool data-bs-toggle="tooltip" data-bs-title="times of day"}. </span>
<span id="cb90-991"><a href="#cb90-991" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb90-992"><a href="#cb90-992" aria-hidden="true" tabindex="-1"></a><span class="fu">## Sunrise and sunset {.hiddenheading #sas}</span></span>
<span id="cb90-993"><a href="#cb90-993" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb90-994"><a href="#cb90-994" aria-hidden="true" tabindex="-1"></a><span class="fu">## Solar hour angle {.hiddenheading #sha}</span></span>
<span id="cb90-995"><a href="#cb90-995" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb90-998"><a href="#cb90-998" aria-hidden="true" tabindex="-1"></a><span class="in">```{ojs}</span></span>
<span id="cb90-999"><a href="#cb90-999" aria-hidden="true" tabindex="-1"></a><span class="co">//| echo: false</span></span>
<span id="cb90-1000"><a href="#cb90-1000" aria-hidden="true" tabindex="-1"></a><span class="co">//| label: loninput</span></span>
<span id="cb90-1001"><a href="#cb90-1001" aria-hidden="true" tabindex="-1"></a>viewof lonInput <span class="op">=</span> Inputs<span class="op">.</span><span class="fu">range</span>([<span class="dv">0</span><span class="op">,</span> <span class="dv">1000</span>]<span class="op">,</span> {<span class="dt">label</span><span class="op">:</span> <span class="st">"Longitude"</span><span class="op">,</span> <span class="dt">value</span><span class="op">:</span> <span class="dv">500</span><span class="op">,</span> <span class="dt">step</span><span class="op">:</span> <span class="dv">1</span>})</span>
<span id="cb90-1002"><a href="#cb90-1002" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb90-1003"><a href="#cb90-1003" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb90-1004"><a href="#cb90-1004" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb90-1005"><a href="#cb90-1005" aria-hidden="true" tabindex="-1"></a>The first range input above sets the doy that will be used to obtain the sda that along with the <span class="dv">&amp;phi;</span> selected by the second range input will be plugged into the sha equation above. Once we have the sha, we can double it to get the daylight duration in negative days, add it to the solar noon <span class="co">[</span><span class="ot">tod</span><span class="co">]</span>{.tool data-bs-toggle="tooltip" data-bs-title="time of day"} to get the sunrise <span class="co">[</span><span class="ot">tod</span><span class="co">]</span>{.tool data-bs-toggle="tooltip" data-bs-title="time of day"}, or subtract it from the solar noon <span class="co">[</span><span class="ot">tod</span><span class="co">]</span>{.tool data-bs-toggle="tooltip" data-bs-title="time of day"} to get the sunset <span class="co">[</span><span class="ot">tod</span><span class="co">]</span>{.tool data-bs-toggle="tooltip" data-bs-title="time of day"}.</span>
<span id="cb90-1006"><a href="#cb90-1006" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb90-1007"><a href="#cb90-1007" aria-hidden="true" tabindex="-1"></a>The difference between a solar noon and sunrise <span class="co">[</span><span class="ot">sha</span><span class="co">]</span>{.tool data-bs-toggle="tooltip" data-bs-title="solar hour angle"} is a sunrise <span class="co">[</span><span class="ot">tod</span><span class="co">]</span>{.tool data-bs-toggle="tooltip" data-bs-title="time of day"}. Likewise, the sum of a solar noon and sunrise <span class="co">[</span><span class="ot">sha</span><span class="co">]</span>{.tool data-bs-toggle="tooltip" data-bs-title="solar hour angle"} is a sunset <span class="co">[</span><span class="ot">tod</span><span class="co">]</span>{.tool data-bs-toggle="tooltip" data-bs-title="time of day"}. To get the daylight duration in decidays, we can either subtract the sunset <span class="co">[</span><span class="ot">tod</span><span class="co">]</span>{.tool data-bs-toggle="tooltip" data-bs-title="times of day"} from the sunrise <span class="co">[</span><span class="ot">tod</span><span class="co">]</span>{.tool data-bs-toggle="tooltip" data-bs-title="times of day"} or multiply the sunrise <span class="co">[</span><span class="ot">sha</span><span class="co">]</span>{.tool data-bs-toggle="tooltip" data-bs-title="solar hour angle"} by twenty.</span>
<span id="cb90-1008"><a href="#cb90-1008" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb90-1009"><a href="#cb90-1009" aria-hidden="true" tabindex="-1"></a>$$\text{sunrise} = \text{noon} + \text{sha}$$</span>
<span id="cb90-1010"><a href="#cb90-1010" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb90-1011"><a href="#cb90-1011" aria-hidden="true" tabindex="-1"></a>$$\text{sunset} = \text{noon} - \text{sha}$$</span>
<span id="cb90-1012"><a href="#cb90-1012" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb90-1013"><a href="#cb90-1013" aria-hidden="true" tabindex="-1"></a>$$\text{duration} = \text{sunset} - \text{sunrise} = \left|\text{sha} \times 2\right|$$</span>
<span id="cb90-1014"><a href="#cb90-1014" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb90-1015"><a href="#cb90-1015" aria-hidden="true" tabindex="-1"></a>The sunrise and sunset times in the equations above depend on the time zone of solar noon. To select a time zone  may be strange to consider The range🎚️inputs below set the <span class="co">[</span><span class="ot">geographic coordinates</span><span class="co">](https://en.wikipedia.org/wiki/Geographic_coordinate_system#:~:text=positions%20directly%20on%20Earth%20as%20latitude%20and%20longitude)</span> that are used for the equations above. The <span class="co">[</span><span class="ot">line chart</span><span class="co">](https://en.wikipedia.org/wiki/Line_chart#:~:text=a%20type%20of%20chart%20that%20displays%20information%20as%20a%20series%20of%20data%20points%20called%20%27markers%27%20connected%20by%20straight%20line%20segments)</span> beneath the inputs visualizes sunrise and sunset for every <span class="co">[</span><span class="ot">doy</span><span class="co">]</span>{.tool data-bs-toggle="tooltip" data-bs-title="day of year"}, similar to the daylight area chart beneath the map🗺above. The main difference between the charts is that the area chart shows local <span class="co">[</span><span class="ot">tods</span><span class="co">]</span>{.tool data-bs-toggle="tooltip" data-bs-title="times of day"} and thus is independent of longitude, whereas the line chart displays <span class="co">[</span><span class="ot">tzos</span><span class="co">]</span>{.tool data-bs-toggle="tooltip" data-bs-title="times of day"} and therefore changes with longitude.</span>
<span id="cb90-1016"><a href="#cb90-1016" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb90-1017"><a href="#cb90-1017" aria-hidden="true" tabindex="-1"></a>To find the UTC <span class="co">[</span><span class="ot">tzo</span><span class="co">]</span>{.tool data-bs-toggle="tooltip" data-bs-title="time zone offset"} of a given longitude and latitude, we could use an <span class="co">[</span><span class="ot">application programming interface</span><span class="co">](https://en.wikipedia.org/wiki/API#:~:text=a%20type%20of%20software%20interface%2C%20offering%20a%20service%20to%20other%20pieces%20of%20software)</span> (API) or a <span class="co">[</span><span class="ot">database</span><span class="co">](https://observablehq.com/@jcolot/time-zone-service)</span>. If we only have longitude, we need to first round degrees to zero or the nearest multiple of fifteen for whole hour <span class="co">[</span><span class="ot">tzos</span><span class="co">]</span>{.tool data-bs-toggle="tooltip" data-bs-title="time zone offsets"}, 7.5 for half hour <span class="co">[</span><span class="ot">tzos</span><span class="co">]</span>{.tool data-bs-toggle="tooltip" data-bs-title="time zone offsets"}, or 3.75 for quarter hour <span class="co">[</span><span class="ot">tzos</span><span class="co">]</span>{.tool data-bs-toggle="tooltip" data-bs-title="time zone offsets"} and then divide by fifteen to convert degrees to hours.</span>
<span id="cb90-1018"><a href="#cb90-1018" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb90-1019"><a href="#cb90-1019" aria-hidden="true" tabindex="-1"></a><span class="fu"># Next</span></span>
<span id="cb90-1020"><a href="#cb90-1020" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb90-1021"><a href="#cb90-1021" aria-hidden="true" tabindex="-1"></a>The next article in the <span class="co">[</span><span class="ot">Dec section</span><span class="co">](/dec)</span> of my <span class="co">[</span><span class="ot">site</span><span class="co">](/)</span> shows how we can combine <span class="co">[</span><span class="ot">Dec dates</span><span class="co">](/dec/date)</span> and times into <span class="co">[</span><span class="ot">Dec snaps</span><span class="co">](/dec/snap)</span>🫰, which are analogous to the <span class="co">[</span><span class="ot">combined date and time representations</span><span class="co">](https://en.wikipedia.org/wiki/ISO_8601#Combined_date_and_time_representations)</span> in the <span class="co">[</span><span class="ot">ISO 8601</span><span class="co">](https://en.wikipedia.org/wiki/ISO_8601#:~:text=an%20international%20standard%20covering%20the%20worldwide%20exchange%20and%20communication%20of%20date%20and%20time%2Drelated%20data)</span> international standard for dates and times. The final article in the Dec section demonstrates how Dec dates, times, and snaps🫰can be paired up to express <span class="co">[</span><span class="ot">time intervals</span><span class="co">](https://en.wikipedia.org/wiki/ISO_8601#Time_intervals:~:text=the%20intervening%20time%20between%20two%20time%20points)</span> called Dec <span class="co">[</span><span class="ot">spans</span><span class="co">](/dec/span)</span>🌈.</span>
<span id="cb90-1022"><a href="#cb90-1022" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb90-1023"><a href="#cb90-1023" aria-hidden="true" tabindex="-1"></a>::: {#timenav}</span>
<span id="cb90-1024"><a href="#cb90-1024" aria-hidden="true" tabindex="-1"></a>{{&lt; include /asset/_decnav.qmd &gt;}}</span>
<span id="cb90-1025"><a href="#cb90-1025" aria-hidden="true" tabindex="-1"></a>:::</span>
<span id="cb90-1026"><a href="#cb90-1026" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb90-1027"><a href="#cb90-1027" aria-hidden="true" tabindex="-1"></a><span class="fu"># Cite</span></span>
<span id="cb90-1028"><a href="#cb90-1028" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb90-1029"><a href="#cb90-1029" aria-hidden="true" tabindex="-1"></a>Please spread the good word about Dec using the citation information at the bottom of this article. You may also want to cite the Observable notebooks that I adapted into the clock🕓, bar📊chart, map🗺️, and daylight☀️plot visualizations in this article or the 2014 blog post which proposed a system of 20 decimal time zones, each 5 <span class="co">[</span><span class="ot">centidays</span><span class="co">]</span>{.tool data-bs-toggle="tooltip" data-bs-title="hundredths of a day"} wide, based on the <span class="co">[</span><span class="ot">Greenwich Meridian</span><span class="co">]</span>(https://en.wikipedia.org/wiki/Prime_meridian_(Greenwich)#:~:text=a%20geographical%20reference%20line%20that%20passes%20through%20the%20Royal%20Observatory%2C%20Greenwich%2C%20in%20London%2C%20England):</span>
<span id="cb90-1030"><a href="#cb90-1030" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb90-1031"><a href="#cb90-1031" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span><span class="co">[</span><span class="ot">Pearson, Tom</span><span class="co">](https://www.2x2.graphics)</span>. [<span class="co">[</span><span class="ot">2013</span><span class="co">]</span>{.underline}]{.yellow}<span class="co">[</span><span class="ot">+[124]{.cyan}</span><span class="co">]</span>{.underline}. “Simple D3 clock.” <span class="co">[</span><span class="ot">\${decYear}</span><span class="co">]</span>{.yellow}+<span class="co">[</span><span class="ot">\${decDate}</span><span class="co">]</span>{.cyan}. <span class="co">[</span><span class="ot">https://observablehq.com/\@d3/simple-clock</span><span class="co">](https://observablehq.com/@d3/simple-clock)</span>{.uri}.</span>
<span id="cb90-1032"><a href="#cb90-1032" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span><span class="co">[</span><span class="ot">Heyen, Frank</span><span class="co">](https://fheyen.github.io)</span>. [<span class="co">[</span><span class="ot">2021</span><span class="co">]</span>{.underline}]{.yellow}<span class="co">[</span><span class="ot">+[246]{.cyan}</span><span class="co">]</span>{.underline}. “BarChart Clock.” <span class="co">[</span><span class="ot">\${decYear}</span><span class="co">]</span>{.yellow}+<span class="co">[</span><span class="ot">\${decDate}</span><span class="co">]</span>{.cyan}. <span class="co">[</span><span class="ot">https://observablehq.com/\@fheyen/barchart-clock</span><span class="co">](https://observablehq.com/@fheyen/barchart-clock)</span>{.uri}.</span>
<span id="cb90-1033"><a href="#cb90-1033" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span><span class="co">[</span><span class="ot">Johnson, Ian</span><span class="co">](https://enjalot.github.io)</span>. [<span class="co">[</span><span class="ot">2021</span><span class="co">]</span>{.underline}]{.yellow}<span class="co">[</span><span class="ot">+[090]{.cyan}</span><span class="co">]</span>{.underline}. “Draggable World Map Coordinates Input.” <span class="co">[</span><span class="ot">\${decYear}</span><span class="co">]</span>{.yellow}+<span class="co">[</span><span class="ot">\${decDate}</span><span class="co">]</span>{.cyan}. <span class="co">[</span><span class="ot">https://observablehq.com/\@enjalot/draggable-world-map-coordinates-input</span><span class="co">](https://observablehq.com/@enjalot/draggable-world-map-coordinates-input)</span>{.uri}.</span>
<span id="cb90-1034"><a href="#cb90-1034" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span><span class="co">[</span><span class="ot">Bridges, Dan</span><span class="co">](https://www.danbridges.org)</span>. [<span class="co">[</span><span class="ot">2021</span><span class="co">]</span>{.underline}]{.yellow}<span class="co">[</span><span class="ot">+[311]{.cyan}</span><span class="co">]</span>{.underline}. “Visualizing Seasonal Daylight.” <span class="co">[</span><span class="ot">\${decYear}</span><span class="co">]</span>{.yellow}+<span class="co">[</span><span class="ot">\${decDate}</span><span class="co">]</span>{.cyan}. <span class="co">[</span><span class="ot">https://observablehq.com/\@dbridges/visualizing-seasonal-daylight</span><span class="co">](https://observablehq.com/@dbridges/visualizing-seasonal-daylight)</span>{.uri}.</span>
<span id="cb90-1035"><a href="#cb90-1035" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span><span class="co">[</span><span class="ot">Clements, John</span><span class="co">](https://www.brinckerhoff.org)</span>. [<span class="co">[</span><span class="ot">2014</span><span class="co">]</span>{.underline}]{.yellow}<span class="co">[</span><span class="ot">+[091]{.cyan}</span><span class="co">]</span>{.underline}, “Decimal Time Zones.” <span class="co">[</span><span class="ot">\${decYear}</span><span class="co">]</span>{.yellow}+<span class="co">[</span><span class="ot">\${decDate}</span><span class="co">]</span>{.cyan}. <span class="ot">&lt;https://www.brinckerhoff.org/blog/2014/05/31/decimal-time-zones&gt;</span>.</span>
<span id="cb90-1036"><a href="#cb90-1036" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb90-1039"><a href="#cb90-1039" aria-hidden="true" tabindex="-1"></a><span class="in">```{ojs}</span></span>
<span id="cb90-1040"><a href="#cb90-1040" aria-hidden="true" tabindex="-1"></a><span class="co">//| echo: false</span></span>
<span id="cb90-1041"><a href="#cb90-1041" aria-hidden="true" tabindex="-1"></a><span class="co">//| output: false</span></span>
<span id="cb90-1042"><a href="#cb90-1042" aria-hidden="true" tabindex="-1"></a><span class="kw">function</span> <span class="fu">unix2dote</span>(unix<span class="op">,</span> zone<span class="op">,</span> offset <span class="op">=</span> <span class="dv">719468</span>) {</span>
<span id="cb90-1043"><a href="#cb90-1043" aria-hidden="true" tabindex="-1"></a>  <span class="cf">return</span> [(unix <span class="op">??</span> <span class="bu">Date</span><span class="op">.</span><span class="fu">now</span>()) <span class="op">/</span> <span class="dv">86400000</span> <span class="op">+</span> (</span>
<span id="cb90-1044"><a href="#cb90-1044" aria-hidden="true" tabindex="-1"></a>    zone <span class="op">=</span> zone <span class="op">??</span> <span class="op">-</span><span class="bu">Math</span><span class="op">.</span><span class="fu">round</span>(</span>
<span id="cb90-1045"><a href="#cb90-1045" aria-hidden="true" tabindex="-1"></a>      (<span class="kw">new</span> <span class="bu">Date</span>)<span class="op">.</span><span class="fu">getTimezoneOffset</span>() <span class="op">/</span> <span class="dv">144</span>)</span>
<span id="cb90-1046"><a href="#cb90-1046" aria-hidden="true" tabindex="-1"></a>    ) <span class="op">/</span> <span class="dv">10</span> <span class="op">+</span> offset<span class="op">,</span> zone]</span>
<span id="cb90-1047"><a href="#cb90-1047" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb90-1048"><a href="#cb90-1048" aria-hidden="true" tabindex="-1"></a><span class="kw">function</span> <span class="fu">unix2dote1</span>(unix<span class="op">,</span> zone<span class="op">,</span> offset <span class="op">=</span> <span class="dv">719468</span>) {</span>
<span id="cb90-1049"><a href="#cb90-1049" aria-hidden="true" tabindex="-1"></a>  <span class="cf">return</span> [</span>
<span id="cb90-1050"><a href="#cb90-1050" aria-hidden="true" tabindex="-1"></a>    (unix <span class="op">??</span> <span class="bu">Date</span><span class="op">.</span><span class="fu">now</span>()) <span class="op">/</span> <span class="dv">86400000</span></span>
<span id="cb90-1051"><a href="#cb90-1051" aria-hidden="true" tabindex="-1"></a>    <span class="op">+</span> (zone <span class="op">=</span> zone <span class="op">??</span> (<span class="dv">10</span> <span class="op">-</span> <span class="bu">Math</span><span class="op">.</span><span class="fu">round</span>(</span>
<span id="cb90-1052"><a href="#cb90-1052" aria-hidden="true" tabindex="-1"></a>        (<span class="kw">new</span> <span class="bu">Date</span>)<span class="op">.</span><span class="fu">getTimezoneOffset</span>() <span class="op">/</span> <span class="dv">144</span>)) <span class="op">%</span> <span class="dv">10</span></span>
<span id="cb90-1053"><a href="#cb90-1053" aria-hidden="true" tabindex="-1"></a>      ) <span class="op">/</span> <span class="dv">10</span> <span class="op">+</span> offset<span class="op">,</span> zone]</span>
<span id="cb90-1054"><a href="#cb90-1054" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb90-1055"><a href="#cb90-1055" aria-hidden="true" tabindex="-1"></a><span class="kw">function</span> <span class="fu">dote2date</span>(dote<span class="op">,</span> zone <span class="op">=</span> <span class="dv">0</span>) {</span>
<span id="cb90-1056"><a href="#cb90-1056" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> cote <span class="op">=</span> <span class="bu">Math</span><span class="op">.</span><span class="fu">floor</span>((</span>
<span id="cb90-1057"><a href="#cb90-1057" aria-hidden="true" tabindex="-1"></a>      dote <span class="op">&gt;=</span> <span class="dv">0</span> <span class="op">?</span> dote</span>
<span id="cb90-1058"><a href="#cb90-1058" aria-hidden="true" tabindex="-1"></a>      <span class="op">:</span> dote <span class="op">-</span> <span class="dv">146096</span></span>
<span id="cb90-1059"><a href="#cb90-1059" aria-hidden="true" tabindex="-1"></a>    ) <span class="op">/</span> <span class="dv">146097</span>)<span class="op">,</span></span>
<span id="cb90-1060"><a href="#cb90-1060" aria-hidden="true" tabindex="-1"></a>  dotc <span class="op">=</span> dote <span class="op">-</span> cote <span class="op">*</span> <span class="dv">146097</span><span class="op">,</span></span>
<span id="cb90-1061"><a href="#cb90-1061" aria-hidden="true" tabindex="-1"></a>  yotc <span class="op">=</span> <span class="bu">Math</span><span class="op">.</span><span class="fu">floor</span>((dotc</span>
<span id="cb90-1062"><a href="#cb90-1062" aria-hidden="true" tabindex="-1"></a>    <span class="op">-</span> <span class="bu">Math</span><span class="op">.</span><span class="fu">floor</span>(dotc <span class="op">/</span> <span class="dv">1460</span>)</span>
<span id="cb90-1063"><a href="#cb90-1063" aria-hidden="true" tabindex="-1"></a>    <span class="op">+</span> <span class="bu">Math</span><span class="op">.</span><span class="fu">floor</span>(dotc <span class="op">/</span> <span class="dv">36524</span>)</span>
<span id="cb90-1064"><a href="#cb90-1064" aria-hidden="true" tabindex="-1"></a>    <span class="op">-</span> <span class="bu">Math</span><span class="op">.</span><span class="fu">floor</span>(dotc <span class="op">/</span> <span class="dv">146096</span>)</span>
<span id="cb90-1065"><a href="#cb90-1065" aria-hidden="true" tabindex="-1"></a>  ) <span class="op">/</span> <span class="dv">365</span>)<span class="op">;</span></span>
<span id="cb90-1066"><a href="#cb90-1066" aria-hidden="true" tabindex="-1"></a>  <span class="cf">return</span> [</span>
<span id="cb90-1067"><a href="#cb90-1067" aria-hidden="true" tabindex="-1"></a>    yotc <span class="op">+</span> cote <span class="op">*</span> <span class="dv">400</span><span class="op">,</span></span>
<span id="cb90-1068"><a href="#cb90-1068" aria-hidden="true" tabindex="-1"></a>    dotc <span class="op">-</span> (yotc <span class="op">*</span> <span class="dv">365</span></span>
<span id="cb90-1069"><a href="#cb90-1069" aria-hidden="true" tabindex="-1"></a>      <span class="op">+</span> <span class="bu">Math</span><span class="op">.</span><span class="fu">floor</span>(yotc <span class="op">/</span> <span class="dv">4</span>)</span>
<span id="cb90-1070"><a href="#cb90-1070" aria-hidden="true" tabindex="-1"></a>      <span class="op">-</span> <span class="bu">Math</span><span class="op">.</span><span class="fu">floor</span>(yotc <span class="op">/</span> <span class="dv">100</span>)</span>
<span id="cb90-1071"><a href="#cb90-1071" aria-hidden="true" tabindex="-1"></a>  )<span class="op">,</span> zone]}</span>
<span id="cb90-1072"><a href="#cb90-1072" aria-hidden="true" tabindex="-1"></a><span class="kw">function</span> <span class="fu">getEot</span>(day) {</span>
<span id="cb90-1073"><a href="#cb90-1073" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> gamma <span class="op">=</span> <span class="dv">2</span> <span class="op">*</span> <span class="bu">Math</span><span class="op">.</span><span class="cn">PI</span> <span class="op">*</span> day <span class="op">/</span> <span class="dv">365</span></span>
<span id="cb90-1074"><a href="#cb90-1074" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> (</span>
<span id="cb90-1075"><a href="#cb90-1075" aria-hidden="true" tabindex="-1"></a>      <span class="fl">0.0011114386869002235</span> <span class="op">+</span></span>
<span id="cb90-1076"><a href="#cb90-1076" aria-hidden="true" tabindex="-1"></a>      <span class="op">-</span><span class="fl">4.155124400404918</span>    <span class="op">*</span> <span class="bu">Math</span><span class="op">.</span><span class="fu">cos</span>(gamma) <span class="op">+</span></span>
<span id="cb90-1077"><a href="#cb90-1077" aria-hidden="true" tabindex="-1"></a>      <span class="op">-</span><span class="fl">2.9710873225303756</span>   <span class="op">*</span> <span class="bu">Math</span><span class="op">.</span><span class="fu">sin</span>(gamma) <span class="op">+</span></span>
<span id="cb90-1078"><a href="#cb90-1078" aria-hidden="true" tabindex="-1"></a>      <span class="op">-</span><span class="fl">4.635570414590801</span>    <span class="op">*</span> <span class="bu">Math</span><span class="op">.</span><span class="fu">cos</span>(<span class="dv">2</span> <span class="op">*</span> gamma) <span class="op">+</span></span>
<span id="cb90-1079"><a href="#cb90-1079" aria-hidden="true" tabindex="-1"></a>      <span class="fl">5.116176940364264</span>     <span class="op">*</span> <span class="bu">Math</span><span class="op">.</span><span class="fu">sin</span>(<span class="dv">2</span> <span class="op">*</span> gamma)</span>
<span id="cb90-1080"><a href="#cb90-1080" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb90-1081"><a href="#cb90-1081" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb90-1082"><a href="#cb90-1082" aria-hidden="true" tabindex="-1"></a><span class="kw">function</span> <span class="fu">getSda</span>(day) {</span>
<span id="cb90-1083"><a href="#cb90-1083" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> gamma <span class="op">=</span> <span class="dv">2</span> <span class="op">*</span> <span class="bu">Math</span><span class="op">.</span><span class="cn">PI</span> <span class="op">*</span> day <span class="op">/</span> <span class="dv">365</span></span>
<span id="cb90-1084"><a href="#cb90-1084" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> (</span>
<span id="cb90-1085"><a href="#cb90-1085" aria-hidden="true" tabindex="-1"></a>      <span class="fl">0.001091553079960761</span>  <span class="op">+</span></span>
<span id="cb90-1086"><a href="#cb90-1086" aria-hidden="true" tabindex="-1"></a>      <span class="op">-</span><span class="fl">0.023117708562197206</span> <span class="op">*</span> <span class="bu">Math</span><span class="op">.</span><span class="fu">cos</span>(gamma) <span class="op">+</span></span>
<span id="cb90-1087"><a href="#cb90-1087" aria-hidden="true" tabindex="-1"></a>      <span class="fl">0.060320423699681706</span>  <span class="op">*</span> <span class="bu">Math</span><span class="op">.</span><span class="fu">sin</span>(gamma) <span class="op">+</span></span>
<span id="cb90-1088"><a href="#cb90-1088" aria-hidden="true" tabindex="-1"></a>      <span class="fl">0.0006152631125526081</span> <span class="op">*</span> <span class="bu">Math</span><span class="op">.</span><span class="fu">cos</span>(<span class="dv">2</span> <span class="op">*</span> gamma) <span class="op">+</span></span>
<span id="cb90-1089"><a href="#cb90-1089" aria-hidden="true" tabindex="-1"></a>      <span class="fl">0.0008981745798778195</span> <span class="op">*</span> <span class="bu">Math</span><span class="op">.</span><span class="fu">sin</span>(<span class="dv">2</span> <span class="op">*</span> gamma)</span>
<span id="cb90-1090"><a href="#cb90-1090" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb90-1091"><a href="#cb90-1091" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb90-1092"><a href="#cb90-1092" aria-hidden="true" tabindex="-1"></a><span class="kw">function</span> <span class="fu">getSha</span>(latitude<span class="op">,</span> solarDeclinationAngle<span class="op">,</span> solarZenithAngle <span class="op">=</span> <span class="fl">0.252314</span>) {</span>
<span id="cb90-1093"><a href="#cb90-1093" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> ratio <span class="op">=</span> (</span>
<span id="cb90-1094"><a href="#cb90-1094" aria-hidden="true" tabindex="-1"></a>    <span class="fu">costau</span>(<span class="op">.</span><span class="dv">252314</span>) <span class="op">-</span> <span class="fu">sintau</span>(latitude) <span class="op">*</span> <span class="fu">sintau</span>(solarDeclinationAngle)) <span class="op">/</span> (</span>
<span id="cb90-1095"><a href="#cb90-1095" aria-hidden="true" tabindex="-1"></a>    <span class="fu">costau</span>(latitude) <span class="op">*</span> <span class="fu">costau</span>(solarDeclinationAngle))</span>
<span id="cb90-1096"><a href="#cb90-1096" aria-hidden="true" tabindex="-1"></a>  <span class="cf">return</span> ratio <span class="op">&gt;=</span> <span class="dv">1</span> <span class="op">?</span> <span class="dv">0</span> <span class="op">:</span> ratio <span class="op">&lt;=</span> <span class="op">-</span><span class="dv">1</span> <span class="op">?</span> <span class="bu">Math</span><span class="op">.</span><span class="cn">PI</span> <span class="op">:</span> <span class="bu">Math</span><span class="op">.</span><span class="fu">acos</span>(ratio)</span>
<span id="cb90-1097"><a href="#cb90-1097" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb90-1098"><a href="#cb90-1098" aria-hidden="true" tabindex="-1"></a>cospi <span class="op">=</span> <span class="pp">require</span>( <span class="st">'https://cdn.jsdelivr.net/gh/stdlib-js/math-base-special-cospi@umd/browser.js'</span> )</span>
<span id="cb90-1099"><a href="#cb90-1099" aria-hidden="true" tabindex="-1"></a>sinpi <span class="op">=</span> <span class="pp">require</span>( <span class="st">'https://cdn.jsdelivr.net/gh/stdlib-js/math-base-special-sinpi@umd/browser.js'</span> )</span>
<span id="cb90-1100"><a href="#cb90-1100" aria-hidden="true" tabindex="-1"></a><span class="kw">function</span> <span class="fu">sintau</span>(turn) {</span>
<span id="cb90-1101"><a href="#cb90-1101" aria-hidden="true" tabindex="-1"></a>  <span class="cf">return</span> <span class="fu">sinpi</span>(<span class="dv">2</span> <span class="op">*</span> turn)<span class="op">;</span></span>
<span id="cb90-1102"><a href="#cb90-1102" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb90-1103"><a href="#cb90-1103" aria-hidden="true" tabindex="-1"></a><span class="kw">function</span> <span class="fu">costau</span>(turn) {</span>
<span id="cb90-1104"><a href="#cb90-1104" aria-hidden="true" tabindex="-1"></a>  <span class="cf">return</span> <span class="fu">cospi</span>(<span class="dv">2</span> <span class="op">*</span> turn)<span class="op">;</span></span>
<span id="cb90-1105"><a href="#cb90-1105" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb90-1106"><a href="#cb90-1106" aria-hidden="true" tabindex="-1"></a>shaRadiMapPlot <span class="op">=</span> <span class="fu">getSha</span>(latTurnMapPlot<span class="op">,</span> <span class="fu">getSda</span>(selYda))</span>
<span id="cb90-1107"><a href="#cb90-1107" aria-hidden="true" tabindex="-1"></a>shaHalfMapPlot <span class="op">=</span> shaRadiMapPlot <span class="op">/</span> <span class="bu">Math</span><span class="op">.</span><span class="cn">PI</span></span>
<span id="cb90-1108"><a href="#cb90-1108" aria-hidden="true" tabindex="-1"></a>shaTurnMapPlot <span class="op">=</span> shaHalfMapPlot <span class="op">/</span> <span class="dv">2</span></span>
<span id="cb90-1109"><a href="#cb90-1109" aria-hidden="true" tabindex="-1"></a>shaDegrMapPlot <span class="op">=</span> shaHalfMapPlot <span class="op">*</span> <span class="dv">180</span></span>
<span id="cb90-1110"><a href="#cb90-1110" aria-hidden="true" tabindex="-1"></a>eotTurnMapPlot <span class="op">=</span> <span class="fu">getEot</span>(selYda) <span class="op">/</span> <span class="dv">1000</span></span>
<span id="cb90-1111"><a href="#cb90-1111" aria-hidden="true" tabindex="-1"></a>lonTurnMapPlot <span class="op">=</span> <span class="fu">long2turn</span>(location[<span class="dv">0</span>]<span class="op">,</span> <span class="dv">0</span>)</span>
<span id="cb90-1112"><a href="#cb90-1112" aria-hidden="true" tabindex="-1"></a>latTurnMapPlot <span class="op">=</span> <span class="fu">lati2turn</span>(location[<span class="dv">1</span>]<span class="op">,</span> <span class="dv">0</span>)</span>
<span id="cb90-1113"><a href="#cb90-1113" aria-hidden="true" tabindex="-1"></a>astDecMapPlot <span class="op">=</span> (<span class="fl">0.95</span> <span class="op">+</span> zeroTime <span class="op">+</span> lonTurnMapPlot <span class="op">+</span> eotTurnMapPlot) <span class="op">%</span> <span class="dv">1</span> <span class="op">*</span> <span class="dv">10</span></span>
<span id="cb90-1114"><a href="#cb90-1114" aria-hidden="true" tabindex="-1"></a>astDegMapPlot <span class="op">=</span> astDecMapPlot <span class="op">*</span> <span class="dv">36</span></span>
<span id="cb90-1115"><a href="#cb90-1115" aria-hidden="true" tabindex="-1"></a>shaDoyInput <span class="op">=</span> <span class="fu">getSha</span>(latInput <span class="op">/</span> <span class="dv">1000</span><span class="op">,</span> <span class="fu">getSda</span>(doyInput))</span>
<span id="cb90-1116"><a href="#cb90-1116" aria-hidden="true" tabindex="-1"></a>daytimeDuration <span class="op">=</span> shaDoyInput <span class="op">/</span> <span class="bu">Math</span><span class="op">.</span><span class="cn">PI</span></span>
<span id="cb90-1117"><a href="#cb90-1117" aria-hidden="true" tabindex="-1"></a>noonDiff <span class="op">=</span> daytimeDuration <span class="op">/</span> <span class="dv">2</span></span>
<span id="cb90-1118"><a href="#cb90-1118" aria-hidden="true" tabindex="-1"></a>dz <span class="op">=</span> <span class="fu">unix2dote</span>(now)</span>
<span id="cb90-1119"><a href="#cb90-1119" aria-hidden="true" tabindex="-1"></a>decYear <span class="op">=</span> ydz[<span class="dv">0</span>]<span class="op">.</span><span class="fu">toString</span>()<span class="op">.</span><span class="fu">padStart</span>(<span class="dv">4</span><span class="op">,</span> <span class="st">"0"</span>)</span>
<span id="cb90-1120"><a href="#cb90-1120" aria-hidden="true" tabindex="-1"></a>zeroDote <span class="op">=</span> <span class="fu">unix2dote</span>(now<span class="op">,</span> <span class="dv">0</span>)[<span class="dv">0</span>]</span>
<span id="cb90-1121"><a href="#cb90-1121" aria-hidden="true" tabindex="-1"></a>zeroTime <span class="op">=</span> zeroDote <span class="op">%</span> <span class="dv">1</span></span>
<span id="cb90-1122"><a href="#cb90-1122" aria-hidden="true" tabindex="-1"></a>zeroDate <span class="op">=</span> <span class="fu">dote2date</span>(zeroDote)</span>
<span id="cb90-1123"><a href="#cb90-1123" aria-hidden="true" tabindex="-1"></a>zeroYear <span class="op">=</span> zeroDate[<span class="dv">0</span>]</span>
<span id="cb90-1124"><a href="#cb90-1124" aria-hidden="true" tabindex="-1"></a>zeroYda <span class="op">=</span> zeroDate[<span class="dv">1</span>]</span>
<span id="cb90-1125"><a href="#cb90-1125" aria-hidden="true" tabindex="-1"></a>zeroDoy <span class="op">=</span> <span class="bu">Math</span><span class="op">.</span><span class="fu">floor</span>(zeroYda)</span>
<span id="cb90-1126"><a href="#cb90-1126" aria-hidden="true" tabindex="-1"></a>zeroIsLeap <span class="op">=</span> <span class="fu">isLeapYear</span>(zeroYear)</span>
<span id="cb90-1127"><a href="#cb90-1127" aria-hidden="true" tabindex="-1"></a>zeroYdaHsl <span class="op">=</span> <span class="fu">textcolor</span>(zeroYda<span class="op">.</span><span class="fu">toFixed</span>(<span class="dv">5</span>)<span class="op">,</span> d3<span class="op">.</span><span class="fu">color</span>(<span class="fu">piecewiseColor</span>(zeroYda <span class="op">/</span> (<span class="dv">365</span> <span class="op">+</span> zeroIsLeap)))<span class="op">.</span><span class="fu">formatHex</span>())</span>
<span id="cb90-1128"><a href="#cb90-1128" aria-hidden="true" tabindex="-1"></a>zeroTimeHsl0 <span class="op">=</span> <span class="fu">textcolor</span>(zeroTime<span class="op">.</span><span class="fu">toFixed</span>(<span class="dv">5</span>)<span class="op">.</span><span class="fu">slice</span>(<span class="dv">1</span>)<span class="op">,</span> d3<span class="op">.</span><span class="fu">color</span>(<span class="fu">piecewiseColor</span>(zeroTime))<span class="op">.</span><span class="fu">formatHex</span>())</span>
<span id="cb90-1129"><a href="#cb90-1129" aria-hidden="true" tabindex="-1"></a>zeroTimeHsl1 <span class="op">=</span> <span class="fu">textcolor</span>(zeroTime<span class="op">.</span><span class="fu">toFixed</span>(<span class="dv">5</span>)<span class="op">.</span><span class="fu">slice</span>(<span class="dv">1</span>)<span class="op">,</span> d3<span class="op">.</span><span class="fu">color</span>(<span class="fu">piecewiseColor</span>(zeroTime))<span class="op">.</span><span class="fu">formatHex</span>())</span>
<span id="cb90-1130"><a href="#cb90-1130" aria-hidden="true" tabindex="-1"></a>zeroTimeHsl2 <span class="op">=</span> <span class="fu">textcolor</span>((zeroTime <span class="op">*</span> <span class="dv">10</span>)<span class="op">.</span><span class="fu">toFixed</span>(<span class="dv">4</span>)<span class="op">,</span> d3<span class="op">.</span><span class="fu">color</span>(<span class="fu">piecewiseColor</span>(zeroTime))<span class="op">.</span><span class="fu">formatHex</span>())</span>
<span id="cb90-1131"><a href="#cb90-1131" aria-hidden="true" tabindex="-1"></a>zeroTimeHsl3 <span class="op">=</span> <span class="fu">textcolor</span>((zeroTime <span class="op">*</span> <span class="dv">10</span>)<span class="op">.</span><span class="fu">toFixed</span>(<span class="dv">4</span>)<span class="op">,</span> d3<span class="op">.</span><span class="fu">color</span>(<span class="fu">piecewiseColor</span>(zeroTime))<span class="op">.</span><span class="fu">formatHex</span>())</span>
<span id="cb90-1132"><a href="#cb90-1132" aria-hidden="true" tabindex="-1"></a>zeroTimeHsl4 <span class="op">=</span> <span class="fu">textcolor</span>((zeroTime <span class="op">*</span> <span class="dv">10</span>)<span class="op">.</span><span class="fu">toFixed</span>(<span class="dv">4</span>)<span class="op">,</span> d3<span class="op">.</span><span class="fu">color</span>(<span class="fu">piecewiseColor</span>(zeroTime))<span class="op">.</span><span class="fu">formatHex</span>())</span>
<span id="cb90-1133"><a href="#cb90-1133" aria-hidden="true" tabindex="-1"></a>zeroTimeHsl5 <span class="op">=</span> <span class="fu">textcolor</span>((zeroTime <span class="op">*</span> <span class="dv">10</span>)<span class="op">.</span><span class="fu">toFixed</span>(<span class="dv">5</span>)<span class="op">,</span> d3<span class="op">.</span><span class="fu">color</span>(<span class="fu">piecewiseColor</span>(zeroTime))<span class="op">.</span><span class="fu">formatHex</span>())</span>
<span id="cb90-1134"><a href="#cb90-1134" aria-hidden="true" tabindex="-1"></a>zeroDotyHsl <span class="op">=</span> <span class="fu">textcolor</span>(zeroDoy<span class="op">.</span><span class="fu">toString</span>()<span class="op">.</span><span class="fu">padStart</span>(<span class="dv">3</span><span class="op">,</span> <span class="st">"0"</span>)<span class="op">,</span> d3<span class="op">.</span><span class="fu">color</span>(<span class="fu">piecewiseColor</span>(zeroDoy <span class="op">/</span> (<span class="dv">365</span> <span class="op">+</span> zeroIsLeap)))<span class="op">.</span><span class="fu">formatHex</span>())</span>
<span id="cb90-1135"><a href="#cb90-1135" aria-hidden="true" tabindex="-1"></a>zeroDoteHsl <span class="op">=</span> <span class="fu">textcolor</span>(zeroDote<span class="op">.</span><span class="fu">toFixed</span>(<span class="dv">5</span>)<span class="op">,</span> d3<span class="op">.</span><span class="fu">color</span>(<span class="fu">piecewiseColor</span>(zeroDote <span class="op">%</span> <span class="dv">1</span>))<span class="op">.</span><span class="fu">formatHex</span>())</span>
<span id="cb90-1136"><a href="#cb90-1136" aria-hidden="true" tabindex="-1"></a>zeroYearHsl <span class="op">=</span> <span class="fu">textcolor</span>(zeroYear<span class="op">,</span> d3<span class="op">.</span><span class="fu">color</span>(<span class="fu">piecewiseColor</span>(zeroYear <span class="op">%</span> <span class="dv">1000</span> <span class="op">/</span> <span class="dv">1000</span>))<span class="op">.</span><span class="fu">formatHex</span>())</span>
<span id="cb90-1137"><a href="#cb90-1137" aria-hidden="true" tabindex="-1"></a>browserDote <span class="op">=</span> <span class="fu">unix2dote</span>(now)</span>
<span id="cb90-1138"><a href="#cb90-1138" aria-hidden="true" tabindex="-1"></a>browserTime <span class="op">=</span> browserDote[<span class="dv">0</span>] <span class="op">%</span> <span class="dv">1</span> <span class="op">*</span> <span class="dv">10</span></span>
<span id="cb90-1139"><a href="#cb90-1139" aria-hidden="true" tabindex="-1"></a>browserZone <span class="op">=</span> browserDote[<span class="dv">1</span>]</span>
<span id="cb90-1140"><a href="#cb90-1140" aria-hidden="true" tabindex="-1"></a>browserSign <span class="op">=</span> browserZone <span class="op">&gt;</span> <span class="dv">0</span> <span class="op">?</span> <span class="st">"-"</span> <span class="op">:</span> <span class="st">"+"</span></span>
<span id="cb90-1141"><a href="#cb90-1141" aria-hidden="true" tabindex="-1"></a>zone0time <span class="op">=</span> (browserTime <span class="op">-</span> browserZone <span class="op">+</span> <span class="dv">10</span>) <span class="op">%</span> <span class="dv">10</span></span>
<span id="cb90-1142"><a href="#cb90-1142" aria-hidden="true" tabindex="-1"></a>hours <span class="op">=</span> browserTime <span class="op">*</span> <span class="fl">2.4</span></span>
<span id="cb90-1143"><a href="#cb90-1143" aria-hidden="true" tabindex="-1"></a>minutes <span class="op">=</span> hours <span class="op">%</span> <span class="dv">1</span> <span class="op">*</span> <span class="dv">60</span></span>
<span id="cb90-1144"><a href="#cb90-1144" aria-hidden="true" tabindex="-1"></a>seconds <span class="op">=</span> minutes <span class="op">%</span> <span class="dv">1</span> <span class="op">*</span> <span class="dv">60</span></span>
<span id="cb90-1145"><a href="#cb90-1145" aria-hidden="true" tabindex="-1"></a>selectedDote <span class="op">=</span> <span class="fu">unix2dote</span>(now<span class="op">,</span> <span class="fu">long2zone</span>(location[<span class="dv">0</span>]))</span>
<span id="cb90-1146"><a href="#cb90-1146" aria-hidden="true" tabindex="-1"></a>selectedExact <span class="op">=</span> selectedDote[<span class="dv">0</span>] <span class="op">%</span> <span class="dv">1</span></span>
<span id="cb90-1147"><a href="#cb90-1147" aria-hidden="true" tabindex="-1"></a>selectedExactN <span class="op">=</span> (<span class="dv">1</span> <span class="op">-</span> selectedExact) <span class="op">%</span> <span class="dv">1</span></span>
<span id="cb90-1148"><a href="#cb90-1148" aria-hidden="true" tabindex="-1"></a>selectedZone <span class="op">=</span> selectedDote[<span class="dv">1</span>]</span>
<span id="cb90-1149"><a href="#cb90-1149" aria-hidden="true" tabindex="-1"></a>ydz <span class="op">=</span> <span class="fu">dote2date</span>(<span class="op">...</span>selectedDote)</span>
<span id="cb90-1150"><a href="#cb90-1150" aria-hidden="true" tabindex="-1"></a>decDate <span class="op">=</span> <span class="bu">Math</span><span class="op">.</span><span class="fu">floor</span>(ydz[<span class="dv">1</span>])</span>
<span id="cb90-1151"><a href="#cb90-1151" aria-hidden="true" tabindex="-1"></a>decTime <span class="op">=</span> (selectedExact <span class="op">*</span> <span class="dv">10</span>)<span class="op">.</span><span class="fu">toFixed</span>(<span class="dv">4</span>)</span>
<span id="cb90-1152"><a href="#cb90-1152" aria-hidden="true" tabindex="-1"></a>decTimeN <span class="op">=</span> (selectedExactN <span class="op">*</span> <span class="dv">10</span>)<span class="op">.</span><span class="fu">toFixed</span>(<span class="dv">4</span>)</span>
<span id="cb90-1153"><a href="#cb90-1153" aria-hidden="true" tabindex="-1"></a>barDD <span class="op">=</span> decTime[<span class="dv">0</span>]</span>
<span id="cb90-1154"><a href="#cb90-1154" aria-hidden="true" tabindex="-1"></a>barDDN <span class="op">=</span> decTimeN[<span class="dv">0</span>]</span>
<span id="cb90-1155"><a href="#cb90-1155" aria-hidden="true" tabindex="-1"></a>barMils <span class="op">=</span> decTime<span class="op">.</span><span class="fu">slice</span>(<span class="dv">2</span><span class="op">,</span> <span class="dv">4</span>)</span>
<span id="cb90-1156"><a href="#cb90-1156" aria-hidden="true" tabindex="-1"></a>barMilsN <span class="op">=</span> decTimeN<span class="op">.</span><span class="fu">slice</span>(<span class="dv">2</span><span class="op">,</span> <span class="dv">4</span>)</span>
<span id="cb90-1157"><a href="#cb90-1157" aria-hidden="true" tabindex="-1"></a>barBeats <span class="op">=</span> decTime<span class="op">.</span><span class="fu">slice</span>(<span class="dv">4</span><span class="op">,</span> <span class="dv">6</span>)</span>
<span id="cb90-1158"><a href="#cb90-1158" aria-hidden="true" tabindex="-1"></a>barBeatsN <span class="op">=</span> decTimeN<span class="op">.</span><span class="fu">slice</span>(<span class="dv">4</span><span class="op">,</span> <span class="dv">6</span>)</span>
<span id="cb90-1159"><a href="#cb90-1159" aria-hidden="true" tabindex="-1"></a><span class="kw">function</span> <span class="fu">lati2turn</span>(degrees <span class="op">=</span> <span class="op">-</span><span class="dv">180</span><span class="op">,</span> e <span class="op">=</span> <span class="dv">3</span>) {</span>
<span id="cb90-1160"><a href="#cb90-1160" aria-hidden="true" tabindex="-1"></a>  <span class="co">// turns: e=0, deciturns: e=1, etc.</span></span>
<span id="cb90-1161"><a href="#cb90-1161" aria-hidden="true" tabindex="-1"></a>  <span class="cf">return</span> (degrees <span class="op">%=</span> <span class="dv">360</span>) <span class="op">/</span> (<span class="dv">360</span> <span class="op">/</span> <span class="dv">10</span><span class="op">**</span>e) <span class="op">%</span> <span class="dv">10</span><span class="op">**</span>e<span class="op">;</span></span>
<span id="cb90-1162"><a href="#cb90-1162" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb90-1163"><a href="#cb90-1163" aria-hidden="true" tabindex="-1"></a>graticule <span class="op">=</span> d3<span class="op">.</span><span class="fu">geoGraticule</span>()<span class="op">.</span><span class="fu">stepMinor</span>([<span class="dv">36</span><span class="op">,</span><span class="dv">36</span>])<span class="op">.</span><span class="fu">stepMajor</span>([<span class="dv">36</span><span class="op">,</span><span class="dv">36</span>])()</span>
<span id="cb90-1164"><a href="#cb90-1164" aria-hidden="true" tabindex="-1"></a>graticule<span class="op">.</span><span class="at">coordinates</span> <span class="op">=</span> graticule<span class="op">.</span><span class="at">coordinates</span><span class="op">.</span><span class="fu">map</span>(</span>
<span id="cb90-1165"><a href="#cb90-1165" aria-hidden="true" tabindex="-1"></a>  i <span class="kw">=&gt;</span> i<span class="op">.</span><span class="fu">map</span>(j <span class="kw">=&gt;</span> j<span class="op">.</span><span class="fu">map</span>((k<span class="op">,</span> index<span class="op">,</span> arr) <span class="kw">=&gt;</span> i<span class="op">.</span><span class="at">length</span> <span class="op">===</span> <span class="dv">3</span> <span class="op">&amp;&amp;</span> index <span class="op">===</span> <span class="dv">0</span> <span class="op">?</span> k <span class="op">-</span> <span class="dv">18</span> <span class="op">:</span> k))</span>
<span id="cb90-1166"><a href="#cb90-1166" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb90-1167"><a href="#cb90-1167" aria-hidden="true" tabindex="-1"></a><span class="kw">function</span> <span class="fu">turn2degr</span>(turns <span class="op">=</span> <span class="op">-</span><span class="dv">500</span><span class="op">,</span> e <span class="op">=</span> <span class="dv">3</span>) {</span>
<span id="cb90-1168"><a href="#cb90-1168" aria-hidden="true" tabindex="-1"></a>  <span class="co">// turns: e=0, deciturns: e=1, etc.</span></span>
<span id="cb90-1169"><a href="#cb90-1169" aria-hidden="true" tabindex="-1"></a>  <span class="cf">return</span> turns <span class="op">%</span> <span class="dv">10</span><span class="op">**</span>e <span class="op">*</span> (<span class="dv">360</span> <span class="op">/</span> <span class="dv">10</span><span class="op">**</span>e)</span>
<span id="cb90-1170"><a href="#cb90-1170" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb90-1171"><a href="#cb90-1171" aria-hidden="true" tabindex="-1"></a><span class="kw">function</span> <span class="fu">turn2long</span>(turns <span class="op">=</span> <span class="op">-</span><span class="dv">500</span><span class="op">,</span> e <span class="op">=</span> <span class="dv">3</span>) {</span>
<span id="cb90-1172"><a href="#cb90-1172" aria-hidden="true" tabindex="-1"></a>  <span class="co">// turns: e=0, deciturns: e=1, etc.</span></span>
<span id="cb90-1173"><a href="#cb90-1173" aria-hidden="true" tabindex="-1"></a>  <span class="cf">return</span> turns <span class="op">%</span> <span class="dv">10</span><span class="op">**</span>e <span class="op">*</span> (<span class="dv">360</span> <span class="op">/</span> <span class="dv">10</span><span class="op">**</span>e) <span class="op">-</span> <span class="dv">18</span></span>
<span id="cb90-1174"><a href="#cb90-1174" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb90-1175"><a href="#cb90-1175" aria-hidden="true" tabindex="-1"></a><span class="kw">function</span> <span class="fu">long2turn</span>(degrees <span class="op">=</span> <span class="op">-</span><span class="dv">180</span><span class="op">,</span> e <span class="op">=</span> <span class="dv">3</span>) {</span>
<span id="cb90-1176"><a href="#cb90-1176" aria-hidden="true" tabindex="-1"></a>  <span class="co">// turns: e=0, deciturns: e=1, etc.</span></span>
<span id="cb90-1177"><a href="#cb90-1177" aria-hidden="true" tabindex="-1"></a>  <span class="cf">return</span> (((degrees <span class="op">%=</span> <span class="dv">360</span>) <span class="op">&lt;</span> <span class="dv">0</span> <span class="op">?</span> degrees <span class="op">+</span> <span class="dv">360</span> <span class="op">:</span> degrees) <span class="op">+</span> <span class="dv">18</span>) <span class="op">/</span> (<span class="dv">360</span> <span class="op">/</span> <span class="dv">10</span><span class="op">**</span>e) <span class="op">%</span> <span class="dv">10</span><span class="op">**</span>e<span class="op">;</span></span>
<span id="cb90-1178"><a href="#cb90-1178" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb90-1179"><a href="#cb90-1179" aria-hidden="true" tabindex="-1"></a><span class="co">// https://github.com/topojson/world-atlas</span></span>
<span id="cb90-1180"><a href="#cb90-1180" aria-hidden="true" tabindex="-1"></a>world <span class="op">=</span> d3<span class="op">.</span><span class="fu">json</span>(<span class="st">"https://cdn.jsdelivr.net/npm/world-atlas@2/countries-110m.json"</span>)</span>
<span id="cb90-1181"><a href="#cb90-1181" aria-hidden="true" tabindex="-1"></a><span class="co">// countries = topojson.feature(world, world.objects.countries)</span></span>
<span id="cb90-1182"><a href="#cb90-1182" aria-hidden="true" tabindex="-1"></a>topojson <span class="op">=</span> <span class="pp">require</span>(<span class="st">"topojson-client@3"</span>)</span>
<span id="cb90-1183"><a href="#cb90-1183" aria-hidden="true" tabindex="-1"></a><span class="kw">function</span> <span class="fu">long2zone</span>(degrees <span class="op">=</span> <span class="op">-</span><span class="dv">180</span>) {</span>
<span id="cb90-1184"><a href="#cb90-1184" aria-hidden="true" tabindex="-1"></a>  <span class="cf">return</span> <span class="bu">Math</span><span class="op">.</span><span class="fu">floor</span>(<span class="fu">long2turn</span>(degrees<span class="op">,</span> <span class="dv">1</span>))<span class="op">;</span></span>
<span id="cb90-1185"><a href="#cb90-1185" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb90-1186"><a href="#cb90-1186" aria-hidden="true" tabindex="-1"></a><span class="kw">function</span> <span class="fu">year2leap</span>(year <span class="op">=</span> <span class="dv">1970</span>) {</span>
<span id="cb90-1187"><a href="#cb90-1187" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> year <span class="op">%</span> <span class="dv">4</span> <span class="op">==</span> <span class="dv">0</span> <span class="op">&amp;&amp;</span> year <span class="op">%</span> <span class="dv">100</span> <span class="op">!=</span> <span class="dv">0</span> <span class="op">||</span> year <span class="op">%</span> <span class="dv">400</span> <span class="op">==</span> <span class="dv">0</span><span class="op">;</span></span>
<span id="cb90-1188"><a href="#cb90-1188" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb90-1189"><a href="#cb90-1189" aria-hidden="true" tabindex="-1"></a><span class="co">// https://observablehq.com/@dbridges/visualizing-seasonal-daylight</span></span>
<span id="cb90-1190"><a href="#cb90-1190" aria-hidden="true" tabindex="-1"></a>solarSystem <span class="op">=</span> (<span class="bu">root</span><span class="op">,</span> vizwidth<span class="op">,</span> location<span class="op">,</span> date<span class="op">,</span> hour<span class="op">,</span> darkmode) <span class="kw">=&gt;</span> {</span>
<span id="cb90-1191"><a href="#cb90-1191" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> earthRadius <span class="op">=</span> <span class="fl">0.065</span> <span class="op">*</span> vizwidth<span class="op">;</span></span>
<span id="cb90-1192"><a href="#cb90-1192" aria-hidden="true" tabindex="-1"></a>  <span class="co">// const sunRadius = 0.015 * vizwidth;</span></span>
<span id="cb90-1193"><a href="#cb90-1193" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> solarSystemRadius <span class="op">=</span> vizwidth <span class="op">/</span> <span class="dv">2</span> <span class="op">-</span> (vizwidth <span class="op">&lt;</span> <span class="dv">500</span> <span class="op">?</span> <span class="dv">4</span> <span class="op">:</span> <span class="dv">20</span>)<span class="op">;</span></span>
<span id="cb90-1194"><a href="#cb90-1194" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> stretch <span class="op">=</span> <span class="fl">0.06</span><span class="op">;</span></span>
<span id="cb90-1195"><a href="#cb90-1195" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> solarAngle <span class="op">=</span> <span class="fu">getSolarAngle</span>(date)<span class="op">;</span></span>
<span id="cb90-1196"><a href="#cb90-1196" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> solarAngleDeg <span class="op">=</span> (solarAngle <span class="op">*</span> <span class="dv">180</span>) <span class="op">/</span> <span class="bu">Math</span><span class="op">.</span><span class="cn">PI</span><span class="op">;</span></span>
<span id="cb90-1197"><a href="#cb90-1197" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> x <span class="op">=</span> solarSystemRadius <span class="op">*</span> <span class="bu">Math</span><span class="op">.</span><span class="fu">sin</span>(solarAngle)<span class="op">;</span></span>
<span id="cb90-1198"><a href="#cb90-1198" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> y <span class="op">=</span> stretch <span class="op">*</span> solarSystemRadius <span class="op">*</span> <span class="bu">Math</span><span class="op">.</span><span class="fu">cos</span>(solarAngle)<span class="op">;</span></span>
<span id="cb90-1199"><a href="#cb90-1199" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> spin <span class="op">=</span> <span class="dv">180</span> <span class="op">+</span> <span class="op">-</span>location[<span class="dv">0</span>] <span class="op">+</span> solarAngleDeg <span class="op">+</span> <span class="dv">360</span> <span class="op">*</span> ((hour <span class="op">+</span> <span class="dv">12</span>) <span class="op">/</span> <span class="dv">24</span>)<span class="op">;</span></span>
<span id="cb90-1200"><a href="#cb90-1200" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> earthGeo <span class="op">=</span> { <span class="dt">type</span><span class="op">:</span> <span class="st">"Sphere"</span> }<span class="op">;</span></span>
<span id="cb90-1201"><a href="#cb90-1201" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> projection <span class="op">=</span> d3</span>
<span id="cb90-1202"><a href="#cb90-1202" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">geoOrthographic</span>()</span>
<span id="cb90-1203"><a href="#cb90-1203" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">fitWidth</span>(earthRadius <span class="op">*</span> <span class="dv">2</span><span class="op">,</span> earthGeo)</span>
<span id="cb90-1204"><a href="#cb90-1204" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">rotate</span>([spin<span class="op">,</span> <span class="dv">0</span><span class="op">,</span> <span class="fl">23.5</span>])</span>
<span id="cb90-1205"><a href="#cb90-1205" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">translate</span>([<span class="dv">0</span><span class="op">,</span> <span class="dv">0</span>])<span class="op">;</span></span>
<span id="cb90-1206"><a href="#cb90-1206" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> staticProjection <span class="op">=</span> d3</span>
<span id="cb90-1207"><a href="#cb90-1207" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">geoOrthographic</span>()</span>
<span id="cb90-1208"><a href="#cb90-1208" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">fitWidth</span>(earthRadius <span class="op">*</span> <span class="dv">2</span><span class="op">,</span> earthGeo)</span>
<span id="cb90-1209"><a href="#cb90-1209" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">rotate</span>([solarAngleDeg <span class="op">-</span> <span class="dv">90</span><span class="op">,</span> <span class="dv">0</span>])</span>
<span id="cb90-1210"><a href="#cb90-1210" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">translate</span>([<span class="dv">0</span><span class="op">,</span> <span class="dv">0</span>])<span class="op">;</span></span>
<span id="cb90-1211"><a href="#cb90-1211" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> path <span class="op">=</span> d3<span class="op">.</span><span class="fu">geoPath</span>(projection)<span class="op">.</span><span class="fu">pointRadius</span>(<span class="fl">1.5</span>)<span class="op">;</span></span>
<span id="cb90-1212"><a href="#cb90-1212" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> staticPath <span class="op">=</span> d3<span class="op">.</span><span class="fu">geoPath</span>(staticProjection)<span class="op">;</span></span>
<span id="cb90-1213"><a href="#cb90-1213" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> oceanColor <span class="op">=</span> darkmode <span class="op">?</span> <span class="st">"#007FFF"</span> <span class="op">:</span> mapcolors<span class="op">.</span><span class="at">ocean</span><span class="op">;</span></span>
<span id="cb90-1214"><a href="#cb90-1214" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> landColor <span class="op">=</span> darkmode <span class="op">?</span> <span class="st">"#0808"</span> <span class="op">:</span> mapcolors<span class="op">.</span><span class="at">land</span><span class="op">;</span></span>
<span id="cb90-1215"><a href="#cb90-1215" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> borderColor <span class="op">=</span> darkmode <span class="op">?</span> <span class="st">"#eee"</span> <span class="op">:</span> <span class="st">"#333"</span><span class="op">;</span></span>
<span id="cb90-1216"><a href="#cb90-1216" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> solarSystem <span class="op">=</span> <span class="bu">root</span></span>
<span id="cb90-1217"><a href="#cb90-1217" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">append</span>(<span class="st">"g"</span>)</span>
<span id="cb90-1218"><a href="#cb90-1218" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">"transform"</span><span class="op">,</span> <span class="vs">`translate(</span><span class="sc">${</span>vizwidth <span class="op">/</span> <span class="dv">2</span><span class="sc">}</span><span class="vs">)`</span>)<span class="op">;</span></span>
<span id="cb90-1219"><a href="#cb90-1219" aria-hidden="true" tabindex="-1"></a>  <span class="co">// solarSystem.append("circle").attr("r", sunRadius).attr("fill", colors.sun);</span></span>
<span id="cb90-1220"><a href="#cb90-1220" aria-hidden="true" tabindex="-1"></a>  <span class="co">/* Draw orbit */</span></span>
<span id="cb90-1221"><a href="#cb90-1221" aria-hidden="true" tabindex="-1"></a>    solarSystem</span>
<span id="cb90-1222"><a href="#cb90-1222" aria-hidden="true" tabindex="-1"></a>      <span class="op">.</span><span class="fu">append</span>(<span class="st">"ellipse"</span>)</span>
<span id="cb90-1223"><a href="#cb90-1223" aria-hidden="true" tabindex="-1"></a>      <span class="op">.</span><span class="fu">attr</span>(<span class="st">"rx"</span><span class="op">,</span> solarSystemRadius)</span>
<span id="cb90-1224"><a href="#cb90-1224" aria-hidden="true" tabindex="-1"></a>      <span class="op">.</span><span class="fu">attr</span>(<span class="st">"ry"</span><span class="op">,</span> stretch <span class="op">*</span> solarSystemRadius)</span>
<span id="cb90-1225"><a href="#cb90-1225" aria-hidden="true" tabindex="-1"></a>      <span class="op">.</span><span class="fu">attr</span>(<span class="st">"fill"</span><span class="op">,</span> <span class="st">"none"</span>)</span>
<span id="cb90-1226"><a href="#cb90-1226" aria-hidden="true" tabindex="-1"></a>      <span class="op">.</span><span class="fu">attr</span>(<span class="st">"stroke-width"</span><span class="op">,</span> <span class="st">"1.25"</span>)</span>
<span id="cb90-1227"><a href="#cb90-1227" aria-hidden="true" tabindex="-1"></a>      <span class="op">.</span><span class="fu">attr</span>(<span class="st">"stroke"</span><span class="op">,</span> <span class="st">"black"</span>)<span class="op">;</span></span>
<span id="cb90-1228"><a href="#cb90-1228" aria-hidden="true" tabindex="-1"></a>    <span class="co">/* Draw month ticks */</span></span>
<span id="cb90-1229"><a href="#cb90-1229" aria-hidden="true" tabindex="-1"></a>    d3<span class="op">.</span><span class="fu">range</span>(<span class="dv">12</span>)<span class="op">.</span><span class="fu">map</span>((m) <span class="kw">=&gt;</span> {</span>
<span id="cb90-1230"><a href="#cb90-1230" aria-hidden="true" tabindex="-1"></a>      <span class="kw">const</span> d <span class="op">=</span> <span class="kw">new</span> <span class="bu">Date</span>(date<span class="op">.</span><span class="fu">getFullYear</span>()<span class="op">,</span> m<span class="op">,</span> <span class="dv">1</span>)<span class="op">;</span></span>
<span id="cb90-1231"><a href="#cb90-1231" aria-hidden="true" tabindex="-1"></a>      <span class="kw">const</span> angle <span class="op">=</span> <span class="fu">getSolarAngle</span>(d)<span class="op">;</span></span>
<span id="cb90-1232"><a href="#cb90-1232" aria-hidden="true" tabindex="-1"></a>      solarSystem</span>
<span id="cb90-1233"><a href="#cb90-1233" aria-hidden="true" tabindex="-1"></a>        <span class="op">.</span><span class="fu">append</span>(<span class="st">"line"</span>)</span>
<span id="cb90-1234"><a href="#cb90-1234" aria-hidden="true" tabindex="-1"></a>        <span class="op">.</span><span class="fu">attr</span>(<span class="st">"x1"</span><span class="op">,</span> (solarSystemRadius <span class="op">+</span> <span class="dv">9</span>) <span class="op">*</span> <span class="bu">Math</span><span class="op">.</span><span class="fu">sin</span>(angle))</span>
<span id="cb90-1235"><a href="#cb90-1235" aria-hidden="true" tabindex="-1"></a>        <span class="op">.</span><span class="fu">attr</span>(<span class="st">"y1"</span><span class="op">,</span> (solarSystemRadius <span class="op">+</span> <span class="dv">9</span>) <span class="op">*</span> stretch <span class="op">*</span> <span class="bu">Math</span><span class="op">.</span><span class="fu">cos</span>(angle))</span>
<span id="cb90-1236"><a href="#cb90-1236" aria-hidden="true" tabindex="-1"></a>        <span class="op">.</span><span class="fu">attr</span>(<span class="st">"x2"</span><span class="op">,</span> (solarSystemRadius <span class="op">-</span> <span class="dv">9</span>) <span class="op">*</span> <span class="bu">Math</span><span class="op">.</span><span class="fu">sin</span>(angle))</span>
<span id="cb90-1237"><a href="#cb90-1237" aria-hidden="true" tabindex="-1"></a>        <span class="op">.</span><span class="fu">attr</span>(<span class="st">"y2"</span><span class="op">,</span> (solarSystemRadius <span class="op">-</span> <span class="dv">9</span>) <span class="op">*</span> stretch <span class="op">*</span> <span class="bu">Math</span><span class="op">.</span><span class="fu">cos</span>(angle))</span>
<span id="cb90-1238"><a href="#cb90-1238" aria-hidden="true" tabindex="-1"></a>        <span class="op">.</span><span class="fu">attr</span>(<span class="st">"stroke-width"</span><span class="op">,</span> <span class="st">"3.75"</span>)</span>
<span id="cb90-1239"><a href="#cb90-1239" aria-hidden="true" tabindex="-1"></a>        <span class="op">.</span><span class="fu">attr</span>(<span class="st">"stroke"</span><span class="op">,</span> <span class="st">"black"</span>)<span class="op">;</span></span>
<span id="cb90-1240"><a href="#cb90-1240" aria-hidden="true" tabindex="-1"></a>      <span class="kw">const</span> startMonthAngle <span class="op">=</span> <span class="fu">getSolarAngle</span>(<span class="kw">new</span> <span class="bu">Date</span>(date<span class="op">.</span><span class="fu">getFullYear</span>()<span class="op">,</span> m<span class="op">,</span> <span class="dv">1</span>))<span class="op">;</span></span>
<span id="cb90-1241"><a href="#cb90-1241" aria-hidden="true" tabindex="-1"></a>      solarSystem</span>
<span id="cb90-1242"><a href="#cb90-1242" aria-hidden="true" tabindex="-1"></a>        <span class="op">.</span><span class="fu">append</span>(<span class="st">"text"</span>)</span>
<span id="cb90-1243"><a href="#cb90-1243" aria-hidden="true" tabindex="-1"></a>        <span class="op">.</span><span class="fu">text</span>(<span class="fu">date2doty</span>(d))</span>
<span id="cb90-1244"><a href="#cb90-1244" aria-hidden="true" tabindex="-1"></a>        <span class="op">.</span><span class="fu">attr</span>(<span class="st">"x"</span><span class="op">,</span> (solarSystemRadius <span class="op">+</span> <span class="dv">18</span> <span class="op">-</span> width <span class="op">/</span> <span class="dv">50</span>) <span class="op">*</span> <span class="bu">Math</span><span class="op">.</span><span class="fu">sin</span>(startMonthAngle) <span class="op">*</span> <span class="fl">1.1</span>)</span>
<span id="cb90-1245"><a href="#cb90-1245" aria-hidden="true" tabindex="-1"></a>        <span class="op">.</span><span class="fu">attr</span>(</span>
<span id="cb90-1246"><a href="#cb90-1246" aria-hidden="true" tabindex="-1"></a>          <span class="st">"y"</span><span class="op">,</span></span>
<span id="cb90-1247"><a href="#cb90-1247" aria-hidden="true" tabindex="-1"></a>          (solarSystemRadius <span class="op">+</span> <span class="dv">2</span> <span class="op">-</span> width <span class="op">/</span> <span class="fl">2.8</span>) <span class="op">*</span> <span class="fl">6.2</span> <span class="op">*</span> stretch <span class="op">*</span> <span class="bu">Math</span><span class="op">.</span><span class="fu">cos</span>(startMonthAngle) <span class="op">+</span> <span class="bu">Math</span><span class="op">.</span><span class="fu">sign</span>(<span class="bu">Math</span><span class="op">.</span><span class="fu">cos</span>(startMonthAngle)) <span class="op">*</span> <span class="dv">12</span></span>
<span id="cb90-1248"><a href="#cb90-1248" aria-hidden="true" tabindex="-1"></a>        )</span>
<span id="cb90-1249"><a href="#cb90-1249" aria-hidden="true" tabindex="-1"></a>        <span class="op">.</span><span class="fu">attr</span>(<span class="st">"text-anchor"</span><span class="op">,</span> <span class="st">"middle"</span>)</span>
<span id="cb90-1250"><a href="#cb90-1250" aria-hidden="true" tabindex="-1"></a>        <span class="op">.</span><span class="fu">attr</span>(<span class="st">"dominant-baseline"</span><span class="op">,</span> <span class="st">"middle"</span>)</span>
<span id="cb90-1251"><a href="#cb90-1251" aria-hidden="true" tabindex="-1"></a>        <span class="op">.</span><span class="fu">attr</span>(<span class="st">"font-size"</span><span class="op">,</span> fontSize <span class="op">*</span> (width <span class="op">&lt;</span> <span class="dv">300</span> <span class="op">?</span> <span class="op">.</span><span class="dv">9</span> <span class="op">:</span> width <span class="op">&lt;</span> <span class="dv">400</span> <span class="op">?</span> <span class="op">.</span><span class="dv">95</span> <span class="op">:</span> width <span class="op">&lt;</span> <span class="dv">500</span> <span class="op">?</span> <span class="dv">1</span> <span class="op">:</span> width <span class="op">&lt;</span> <span class="dv">600</span> <span class="op">?</span> <span class="fl">1.05</span> <span class="op">:</span> width <span class="op">&lt;</span> <span class="dv">700</span> <span class="op">?</span> <span class="fl">1.1</span> <span class="op">:</span> <span class="fl">1.2</span>) <span class="op">+</span> width <span class="op">/</span> <span class="dv">100</span>)</span>
<span id="cb90-1252"><a href="#cb90-1252" aria-hidden="true" tabindex="-1"></a>        <span class="op">.</span><span class="fu">attr</span>(<span class="st">"font-family"</span><span class="op">,</span> <span class="st">"sans-serif"</span>)</span>
<span id="cb90-1253"><a href="#cb90-1253" aria-hidden="true" tabindex="-1"></a>        <span class="op">.</span><span class="fu">attr</span>(<span class="st">"fill"</span><span class="op">,</span> <span class="st">"black"</span>)<span class="op">;</span></span>
<span id="cb90-1254"><a href="#cb90-1254" aria-hidden="true" tabindex="-1"></a>    })<span class="op">;</span></span>
<span id="cb90-1255"><a href="#cb90-1255" aria-hidden="true" tabindex="-1"></a>    <span class="kw">const</span> earth <span class="op">=</span> solarSystem</span>
<span id="cb90-1256"><a href="#cb90-1256" aria-hidden="true" tabindex="-1"></a>      <span class="op">.</span><span class="fu">append</span>(<span class="st">"g"</span>)</span>
<span id="cb90-1257"><a href="#cb90-1257" aria-hidden="true" tabindex="-1"></a>      <span class="op">.</span><span class="fu">attr</span>(<span class="st">"transform"</span><span class="op">,</span> <span class="vs">`translate(</span><span class="sc">${</span>x<span class="sc">}</span><span class="vs">, </span><span class="sc">${</span>y<span class="sc">}</span><span class="vs">)`</span>)<span class="op">;</span></span>
<span id="cb90-1258"><a href="#cb90-1258" aria-hidden="true" tabindex="-1"></a>    <span class="kw">function</span> <span class="fu">drawEarth</span>() {</span>
<span id="cb90-1259"><a href="#cb90-1259" aria-hidden="true" tabindex="-1"></a>      earth<span class="op">.</span><span class="fu">append</span>(<span class="st">"line"</span>)<span class="op">.</span><span class="fu">attr</span>(<span class="st">"y1"</span><span class="op">,</span> <span class="op">-</span><span class="fl">1.5</span> <span class="op">*</span> earthRadius)<span class="op">.</span><span class="fu">attr</span>(<span class="st">"y2"</span><span class="op">,</span> <span class="fl">1.5</span> <span class="op">*</span> earthRadius)<span class="op">.</span><span class="fu">attr</span>(<span class="st">"stroke"</span><span class="op">,</span> <span class="st">"blue"</span>)<span class="op">.</span><span class="fu">attr</span>(<span class="st">"transform"</span><span class="op">,</span> <span class="vs">`rotate(-23.5)`</span>)<span class="op">;</span></span>
<span id="cb90-1260"><a href="#cb90-1260" aria-hidden="true" tabindex="-1"></a>      earth<span class="op">.</span><span class="fu">append</span>(<span class="st">"path"</span>)<span class="op">.</span><span class="fu">attr</span>(<span class="st">"d"</span><span class="op">,</span> <span class="fu">path</span>(earthGeo))<span class="op">.</span><span class="fu">attr</span>(<span class="st">"fill"</span><span class="op">,</span> darkmode <span class="op">?</span> <span class="st">"#007FFF"</span> <span class="op">:</span> mapcolors<span class="op">.</span><span class="at">ocean</span>)<span class="op">.</span><span class="fu">attr</span>(<span class="st">"id"</span><span class="op">,</span> <span class="st">"globeOcean"</span>)<span class="op">;</span></span>
<span id="cb90-1261"><a href="#cb90-1261" aria-hidden="true" tabindex="-1"></a>      earth<span class="op">.</span><span class="fu">append</span>(<span class="st">"path"</span>)<span class="op">.</span><span class="fu">attr</span>(<span class="st">"d"</span><span class="op">,</span> <span class="fu">path</span>(land))<span class="op">.</span><span class="fu">attr</span>(<span class="st">"fill"</span><span class="op">,</span> darkmode <span class="op">?</span> <span class="st">"#0808"</span> <span class="op">:</span> mapcolors<span class="op">.</span><span class="at">land</span>)<span class="op">.</span><span class="fu">attr</span>(<span class="st">"id"</span><span class="op">,</span> <span class="st">"globeLand"</span>)<span class="op">;</span></span>
<span id="cb90-1262"><a href="#cb90-1262" aria-hidden="true" tabindex="-1"></a>      earth<span class="op">.</span><span class="fu">append</span>(<span class="st">"path"</span>)<span class="op">.</span><span class="fu">attr</span>(<span class="st">"d"</span><span class="op">,</span> <span class="fu">path</span>(countries))<span class="op">.</span><span class="fu">attr</span>(<span class="st">"stroke-width"</span><span class="op">,</span> <span class="st">".08"</span>)<span class="op">.</span><span class="fu">attr</span>(<span class="st">"fill"</span><span class="op">,</span> <span class="st">"none"</span>)<span class="op">.</span><span class="fu">attr</span>(<span class="st">"stroke"</span><span class="op">,</span> darkmode <span class="op">?</span> <span class="st">"#eee"</span> <span class="op">:</span> <span class="st">"#333"</span>)<span class="op">.</span><span class="fu">attr</span>(<span class="st">"id"</span><span class="op">,</span> <span class="st">"globeBorders"</span>)<span class="op">;</span></span>
<span id="cb90-1263"><a href="#cb90-1263" aria-hidden="true" tabindex="-1"></a>      path<span class="op">.</span><span class="fu">pointRadius</span>(<span class="fl">5.5</span>)<span class="op">;</span></span>
<span id="cb90-1264"><a href="#cb90-1264" aria-hidden="true" tabindex="-1"></a>      earth<span class="op">.</span><span class="fu">append</span>(<span class="st">"path"</span>)<span class="op">.</span><span class="fu">attr</span>(<span class="st">"d"</span><span class="op">,</span> <span class="fu">path</span>({ <span class="dt">type</span><span class="op">:</span> <span class="st">"Point"</span><span class="op">,</span> <span class="dt">coordinates</span><span class="op">:</span> location }))<span class="op">.</span><span class="fu">attr</span>(<span class="st">"fill"</span><span class="op">,</span> <span class="st">"none"</span>)<span class="op">.</span><span class="fu">attr</span>(<span class="st">"stroke-width"</span><span class="op">,</span> <span class="op">.</span><span class="dv">6</span>)<span class="op">.</span><span class="fu">attr</span>(<span class="st">"stroke"</span><span class="op">,</span> <span class="st">"black"</span>)<span class="op">;</span></span>
<span id="cb90-1265"><a href="#cb90-1265" aria-hidden="true" tabindex="-1"></a>      path<span class="op">.</span><span class="fu">pointRadius</span>(<span class="fl">4.5</span>)<span class="op">;</span></span>
<span id="cb90-1266"><a href="#cb90-1266" aria-hidden="true" tabindex="-1"></a>      earth<span class="op">.</span><span class="fu">append</span>(<span class="st">"path"</span>)<span class="op">.</span><span class="fu">attr</span>(<span class="st">"d"</span><span class="op">,</span> <span class="fu">path</span>({ <span class="dt">type</span><span class="op">:</span> <span class="st">"Point"</span><span class="op">,</span> <span class="dt">coordinates</span><span class="op">:</span> location }))<span class="op">.</span><span class="fu">attr</span>(<span class="st">"fill"</span><span class="op">,</span> <span class="st">"none"</span>)<span class="op">.</span><span class="fu">attr</span>(<span class="st">"stroke-width"</span><span class="op">,</span> <span class="fl">2.25</span>)<span class="op">.</span><span class="fu">attr</span>(<span class="st">"stroke"</span><span class="op">,</span> <span class="st">"red"</span>)<span class="op">;</span></span>
<span id="cb90-1267"><a href="#cb90-1267" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb90-1268"><a href="#cb90-1268" aria-hidden="true" tabindex="-1"></a>  <span class="fu">drawEarth</span>()<span class="op">;</span></span>
<span id="cb90-1269"><a href="#cb90-1269" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb90-1270"><a href="#cb90-1270" aria-hidden="true" tabindex="-1"></a><span class="kw">function</span> <span class="fu">greg2doty</span>(month <span class="op">=</span> <span class="dv">1</span><span class="op">,</span> day <span class="op">=</span> <span class="dv">1</span>) {</span>
<span id="cb90-1271"><a href="#cb90-1271" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> <span class="bu">Math</span><span class="op">.</span><span class="fu">floor</span>(</span>
<span id="cb90-1272"><a href="#cb90-1272" aria-hidden="true" tabindex="-1"></a>        (<span class="dv">153</span> <span class="op">*</span> (month <span class="op">&gt;</span> <span class="dv">2</span> <span class="op">?</span> month <span class="op">-</span> <span class="dv">3</span> <span class="op">:</span> month <span class="op">+</span> <span class="dv">9</span>) <span class="op">+</span> <span class="dv">2</span>) <span class="op">/</span> <span class="dv">5</span> <span class="op">+</span> day <span class="op">-</span> <span class="dv">1</span></span>
<span id="cb90-1273"><a href="#cb90-1273" aria-hidden="true" tabindex="-1"></a>)}</span>
<span id="cb90-1274"><a href="#cb90-1274" aria-hidden="true" tabindex="-1"></a><span class="kw">function</span> <span class="fu">date2doty</span>(date) {</span>
<span id="cb90-1275"><a href="#cb90-1275" aria-hidden="true" tabindex="-1"></a>  <span class="cf">return</span> <span class="fu">greg2doty</span>(date<span class="op">.</span><span class="fu">getMonth</span>() <span class="op">+</span> <span class="dv">1</span><span class="op">,</span> date<span class="op">.</span><span class="fu">getDate</span>())</span>
<span id="cb90-1276"><a href="#cb90-1276" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb90-1277"><a href="#cb90-1277" aria-hidden="true" tabindex="-1"></a><span class="kw">function</span> <span class="fu">date2doty1</span>(date) {</span>
<span id="cb90-1278"><a href="#cb90-1278" aria-hidden="true" tabindex="-1"></a>  <span class="cf">return</span> <span class="fu">greg2doty</span>(date<span class="op">.</span><span class="fu">getMonth</span>() <span class="op">+</span> <span class="dv">1</span><span class="op">,</span> date<span class="op">.</span><span class="fu">getDate</span>())</span>
<span id="cb90-1279"><a href="#cb90-1279" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb90-1280"><a href="#cb90-1280" aria-hidden="true" tabindex="-1"></a><span class="co">// https://observablehq.com/@dbridges/visualizing-seasonal-daylight</span></span>
<span id="cb90-1281"><a href="#cb90-1281" aria-hidden="true" tabindex="-1"></a><span class="co">// globe = (root, { vizwidth, location, date, hour }) =&gt; {</span></span>
<span id="cb90-1282"><a href="#cb90-1282" aria-hidden="true" tabindex="-1"></a><span class="co">//   const solarAngle = getSolarAngle(date);</span></span>
<span id="cb90-1283"><a href="#cb90-1283" aria-hidden="true" tabindex="-1"></a><span class="co">//   const solarAngleDeg = toDegrees(solarAngle);</span></span>
<span id="cb90-1284"><a href="#cb90-1284" aria-hidden="true" tabindex="-1"></a><span class="co">//   const hourSpin = 360 * ((hour + 12) / 24);</span></span>
<span id="cb90-1285"><a href="#cb90-1285" aria-hidden="true" tabindex="-1"></a><span class="co">//   const spin = (180 + -location[0] + solarAngleDeg + hourSpin);</span></span>
<span id="cb90-1286"><a href="#cb90-1286" aria-hidden="true" tabindex="-1"></a><span class="co">//   const tilt = -15;</span></span>
<span id="cb90-1287"><a href="#cb90-1287" aria-hidden="true" tabindex="-1"></a><span class="co">//   const projection = d3.geoOrthographic()</span></span>
<span id="cb90-1288"><a href="#cb90-1288" aria-hidden="true" tabindex="-1"></a><span class="co">//                        .fitWidth(vizwidth, graticule)</span></span>
<span id="cb90-1289"><a href="#cb90-1289" aria-hidden="true" tabindex="-1"></a><span class="co">//                        .rotate([spin, tilt, 23.5]);</span></span>
<span id="cb90-1290"><a href="#cb90-1290" aria-hidden="true" tabindex="-1"></a><span class="co">//   const path = d3.geoPath(projection);</span></span>
<span id="cb90-1291"><a href="#cb90-1291" aria-hidden="true" tabindex="-1"></a><span class="co">//   const unClippedProjection = d3.geoOrthographic()</span></span>
<span id="cb90-1292"><a href="#cb90-1292" aria-hidden="true" tabindex="-1"></a><span class="co">//                                 .clipAngle(null)</span></span>
<span id="cb90-1293"><a href="#cb90-1293" aria-hidden="true" tabindex="-1"></a><span class="co">//                                 .fitWidth(vizwidth, graticule)</span></span>
<span id="cb90-1294"><a href="#cb90-1294" aria-hidden="true" tabindex="-1"></a><span class="co">//                                 .rotate([spin, tilt, 23.5]);</span></span>
<span id="cb90-1295"><a href="#cb90-1295" aria-hidden="true" tabindex="-1"></a><span class="co">//   const unClippedPath = d3.geoPath(unClippedProjection);</span></span>
<span id="cb90-1296"><a href="#cb90-1296" aria-hidden="true" tabindex="-1"></a><span class="co">//   const staticProjection = d3.geoOrthographic()</span></span>
<span id="cb90-1297"><a href="#cb90-1297" aria-hidden="true" tabindex="-1"></a><span class="co">//                              .fitWidth(vizwidth, graticule)</span></span>
<span id="cb90-1298"><a href="#cb90-1298" aria-hidden="true" tabindex="-1"></a><span class="co">//                              .rotate([solarAngleDeg - 90, tilt]);</span></span>
<span id="cb90-1299"><a href="#cb90-1299" aria-hidden="true" tabindex="-1"></a><span class="co">//   const staticPath = d3.geoPath(staticProjection);</span></span>
<span id="cb90-1300"><a href="#cb90-1300" aria-hidden="true" tabindex="-1"></a><span class="co">//   const background = root.append("g");</span></span>
<span id="cb90-1301"><a href="#cb90-1301" aria-hidden="true" tabindex="-1"></a><span class="co">//   const earth = root.append("g").style("opacity", 0.75);</span></span>
<span id="cb90-1302"><a href="#cb90-1302" aria-hidden="true" tabindex="-1"></a><span class="co">//   const foreground = root.append("g");</span></span>
<span id="cb90-1303"><a href="#cb90-1303" aria-hidden="true" tabindex="-1"></a><span class="co">//   earth.append("path")</span></span>
<span id="cb90-1304"><a href="#cb90-1304" aria-hidden="true" tabindex="-1"></a><span class="co">//     .attr("d", path({type: "Sphere"}))</span></span>
<span id="cb90-1305"><a href="#cb90-1305" aria-hidden="true" tabindex="-1"></a><span class="co">//     .attr("fill", mapcolors.ocean)</span></span>
<span id="cb90-1306"><a href="#cb90-1306" aria-hidden="true" tabindex="-1"></a><span class="co">//     .attr("stroke", "#9ecbda");</span></span>
<span id="cb90-1307"><a href="#cb90-1307" aria-hidden="true" tabindex="-1"></a><span class="co">//   earth.append("path")</span></span>
<span id="cb90-1308"><a href="#cb90-1308" aria-hidden="true" tabindex="-1"></a><span class="co">//     .attr("d", path(land))</span></span>
<span id="cb90-1309"><a href="#cb90-1309" aria-hidden="true" tabindex="-1"></a><span class="co">//     .attr("fill", mapcolors.land);</span></span>
<span id="cb90-1310"><a href="#cb90-1310" aria-hidden="true" tabindex="-1"></a><span class="co">//   earth.append("path")</span></span>
<span id="cb90-1311"><a href="#cb90-1311" aria-hidden="true" tabindex="-1"></a><span class="co">//     .attr("d", path(countries))</span></span>
<span id="cb90-1312"><a href="#cb90-1312" aria-hidden="true" tabindex="-1"></a><span class="co">//     .attr("stroke-width", "1")</span></span>
<span id="cb90-1313"><a href="#cb90-1313" aria-hidden="true" tabindex="-1"></a><span class="co">//     .attr("fill", "none")</span></span>
<span id="cb90-1314"><a href="#cb90-1314" aria-hidden="true" tabindex="-1"></a><span class="co">//     .attr("stroke", "#000");</span></span>
<span id="cb90-1315"><a href="#cb90-1315" aria-hidden="true" tabindex="-1"></a><span class="co">//   background.append("path")</span></span>
<span id="cb90-1316"><a href="#cb90-1316" aria-hidden="true" tabindex="-1"></a><span class="co">//     .attr("d", unClippedPath({type: "Point", coordinates: location}))</span></span>
<span id="cb90-1317"><a href="#cb90-1317" aria-hidden="true" tabindex="-1"></a><span class="co">//     .attr("fill", "red");</span></span>
<span id="cb90-1318"><a href="#cb90-1318" aria-hidden="true" tabindex="-1"></a><span class="co">//   const latitudeCoords = (latitude, start, end) =&gt; {</span></span>
<span id="cb90-1319"><a href="#cb90-1319" aria-hidden="true" tabindex="-1"></a><span class="co">//     const longitudes = d3.range(start, end, 2).concat(end);</span></span>
<span id="cb90-1320"><a href="#cb90-1320" aria-hidden="true" tabindex="-1"></a><span class="co">//     return longitudes.map(d =&gt; [d, latitude]);</span></span>
<span id="cb90-1321"><a href="#cb90-1321" aria-hidden="true" tabindex="-1"></a><span class="co">//   }</span></span>
<span id="cb90-1322"><a href="#cb90-1322" aria-hidden="true" tabindex="-1"></a><span class="co">//   const correctSpin = d3.geoRotation([-hourSpin, 0]);</span></span>
<span id="cb90-1323"><a href="#cb90-1323" aria-hidden="true" tabindex="-1"></a><span class="co">//   const correctTilt = d3.geoRotation([6, 0, 0]);</span></span>
<span id="cb90-1324"><a href="#cb90-1324" aria-hidden="true" tabindex="-1"></a><span class="co">//   /* total angular extent of day/night */</span></span>
<span id="cb90-1325"><a href="#cb90-1325" aria-hidden="true" tabindex="-1"></a><span class="co">//   const dayExtent = 360 * dayLength(date, location[1]) / 24;</span></span>
<span id="cb90-1326"><a href="#cb90-1326" aria-hidden="true" tabindex="-1"></a><span class="co">//   const nightExtent = 360 - dayExtent;</span></span>
<span id="cb90-1327"><a href="#cb90-1327" aria-hidden="true" tabindex="-1"></a><span class="co">//   const dayLine = {</span></span>
<span id="cb90-1328"><a href="#cb90-1328" aria-hidden="true" tabindex="-1"></a><span class="co">//     type: "LineString",</span></span>
<span id="cb90-1329"><a href="#cb90-1329" aria-hidden="true" tabindex="-1"></a><span class="co">//     coordinates: latitudeCoords(location[1],</span></span>
<span id="cb90-1330"><a href="#cb90-1330" aria-hidden="true" tabindex="-1"></a><span class="co">//                                 location[0] - dayExtent / 2,</span></span>
<span id="cb90-1331"><a href="#cb90-1331" aria-hidden="true" tabindex="-1"></a><span class="co">//                                 location[0] + dayExtent / 2).map(d =&gt; correctSpin(d))</span></span>
<span id="cb90-1332"><a href="#cb90-1332" aria-hidden="true" tabindex="-1"></a><span class="co">//   };</span></span>
<span id="cb90-1333"><a href="#cb90-1333" aria-hidden="true" tabindex="-1"></a><span class="co">//   const nightLine = {</span></span>
<span id="cb90-1334"><a href="#cb90-1334" aria-hidden="true" tabindex="-1"></a><span class="co">//     type: "LineString",</span></span>
<span id="cb90-1335"><a href="#cb90-1335" aria-hidden="true" tabindex="-1"></a><span class="co">//     coordinates: latitudeCoords(location[1],</span></span>
<span id="cb90-1336"><a href="#cb90-1336" aria-hidden="true" tabindex="-1"></a><span class="co">//                                 location[0] - dayExtent / 2 - nightExtent,</span></span>
<span id="cb90-1337"><a href="#cb90-1337" aria-hidden="true" tabindex="-1"></a><span class="co">//                                 location[0] - dayExtent / 2).map(d =&gt; correctSpin(d))</span></span>
<span id="cb90-1338"><a href="#cb90-1338" aria-hidden="true" tabindex="-1"></a><span class="co">//   };</span></span>
<span id="cb90-1339"><a href="#cb90-1339" aria-hidden="true" tabindex="-1"></a><span class="co">//   background.append("path")</span></span>
<span id="cb90-1340"><a href="#cb90-1340" aria-hidden="true" tabindex="-1"></a><span class="co">//     .attr("d", unClippedPath(dayLine))</span></span>
<span id="cb90-1341"><a href="#cb90-1341" aria-hidden="true" tabindex="-1"></a><span class="co">//     .attr("fill", "none")</span></span>
<span id="cb90-1342"><a href="#cb90-1342" aria-hidden="true" tabindex="-1"></a><span class="co">//     .attr("stroke", mapcolors.day)</span></span>
<span id="cb90-1343"><a href="#cb90-1343" aria-hidden="true" tabindex="-1"></a><span class="co">//     .attr("stroke-width", 3);</span></span>
<span id="cb90-1344"><a href="#cb90-1344" aria-hidden="true" tabindex="-1"></a><span class="co">//   background.append("path")</span></span>
<span id="cb90-1345"><a href="#cb90-1345" aria-hidden="true" tabindex="-1"></a><span class="co">//     .attr("d", unClippedPath(nightLine))</span></span>
<span id="cb90-1346"><a href="#cb90-1346" aria-hidden="true" tabindex="-1"></a><span class="co">//     .attr("fill", "none")</span></span>
<span id="cb90-1347"><a href="#cb90-1347" aria-hidden="true" tabindex="-1"></a><span class="co">//     .attr("stroke", mapcolors.night)</span></span>
<span id="cb90-1348"><a href="#cb90-1348" aria-hidden="true" tabindex="-1"></a><span class="co">//     .attr("stroke-width", 3);</span></span>
<span id="cb90-1349"><a href="#cb90-1349" aria-hidden="true" tabindex="-1"></a><span class="co">//   foreground.append("path")</span></span>
<span id="cb90-1350"><a href="#cb90-1350" aria-hidden="true" tabindex="-1"></a><span class="co">//     .attr("d", path(dayLine))</span></span>
<span id="cb90-1351"><a href="#cb90-1351" aria-hidden="true" tabindex="-1"></a><span class="co">//     .attr("fill", "none")</span></span>
<span id="cb90-1352"><a href="#cb90-1352" aria-hidden="true" tabindex="-1"></a><span class="co">//     .attr("stroke", mapcolors.day)</span></span>
<span id="cb90-1353"><a href="#cb90-1353" aria-hidden="true" tabindex="-1"></a><span class="co">//     .attr("stroke-width", 3);</span></span>
<span id="cb90-1354"><a href="#cb90-1354" aria-hidden="true" tabindex="-1"></a><span class="co">//   foreground.append("path")</span></span>
<span id="cb90-1355"><a href="#cb90-1355" aria-hidden="true" tabindex="-1"></a><span class="co">//     .attr("d", path(nightLine))</span></span>
<span id="cb90-1356"><a href="#cb90-1356" aria-hidden="true" tabindex="-1"></a><span class="co">//     .attr("fill", "none")</span></span>
<span id="cb90-1357"><a href="#cb90-1357" aria-hidden="true" tabindex="-1"></a><span class="co">//     .attr("stroke", mapcolors.night)</span></span>
<span id="cb90-1358"><a href="#cb90-1358" aria-hidden="true" tabindex="-1"></a><span class="co">//     .attr("stroke-width", 3);</span></span>
<span id="cb90-1359"><a href="#cb90-1359" aria-hidden="true" tabindex="-1"></a><span class="co">//   foreground.append("path")</span></span>
<span id="cb90-1360"><a href="#cb90-1360" aria-hidden="true" tabindex="-1"></a><span class="co">//     .attr("d", path({type: "Point", coordinates: location}))</span></span>
<span id="cb90-1361"><a href="#cb90-1361" aria-hidden="true" tabindex="-1"></a><span class="co">//     .attr("stroke-width", .5)</span></span>
<span id="cb90-1362"><a href="#cb90-1362" aria-hidden="true" tabindex="-1"></a><span class="co">//     .attr("stroke", "black")</span></span>
<span id="cb90-1363"><a href="#cb90-1363" aria-hidden="true" tabindex="-1"></a><span class="co">//     .attr("fill", "red");</span></span>
<span id="cb90-1364"><a href="#cb90-1364" aria-hidden="true" tabindex="-1"></a><span class="co">//   const shadowPolygon = [[0, -90], [0, 0], [0, 90], [180, 0], [0, -90]].map(d =&gt; correctTilt(d));</span></span>
<span id="cb90-1365"><a href="#cb90-1365" aria-hidden="true" tabindex="-1"></a><span class="co">//   foreground.append("path")</span></span>
<span id="cb90-1366"><a href="#cb90-1366" aria-hidden="true" tabindex="-1"></a><span class="co">//     .attr("d", staticPath({type: "Polygon", coordinates: [shadowPolygon]}))</span></span>
<span id="cb90-1367"><a href="#cb90-1367" aria-hidden="true" tabindex="-1"></a><span class="co">//     .attr("fill", "rgba(0, 0, 0, 0.25)");</span></span>
<span id="cb90-1368"><a href="#cb90-1368" aria-hidden="true" tabindex="-1"></a><span class="co">// }</span></span>
<span id="cb90-1369"><a href="#cb90-1369" aria-hidden="true" tabindex="-1"></a>dayOfYear <span class="op">=</span> (date) <span class="kw">=&gt;</span> {</span>
<span id="cb90-1370"><a href="#cb90-1370" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> yearStart <span class="op">=</span> <span class="kw">new</span> <span class="bu">Date</span>(date<span class="op">.</span><span class="fu">getFullYear</span>()<span class="op">,</span> <span class="dv">0</span><span class="op">,</span> <span class="dv">1</span><span class="op">+</span><span class="dv">60</span>)<span class="op">;</span></span>
<span id="cb90-1371"><a href="#cb90-1371" aria-hidden="true" tabindex="-1"></a>  <span class="cf">return</span> <span class="bu">Math</span><span class="op">.</span><span class="fu">floor</span>((date<span class="op">.</span><span class="fu">getTime</span>() <span class="op">-</span> yearStart<span class="op">.</span><span class="fu">getTime</span>())<span class="op">/</span><span class="dv">86400000</span>) <span class="op">+</span> <span class="dv">1</span></span>
<span id="cb90-1372"><a href="#cb90-1372" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb90-1373"><a href="#cb90-1373" aria-hidden="true" tabindex="-1"></a><span class="co">// https://observablehq.com/@dbridges/visualizing-seasonal-daylight</span></span>
<span id="cb90-1374"><a href="#cb90-1374" aria-hidden="true" tabindex="-1"></a>daylightPlot <span class="op">=</span> (</span>
<span id="cb90-1375"><a href="#cb90-1375" aria-hidden="true" tabindex="-1"></a>  <span class="bu">root</span><span class="op">,</span></span>
<span id="cb90-1376"><a href="#cb90-1376" aria-hidden="true" tabindex="-1"></a>  { vizwidth<span class="op">,</span> height<span class="op">,</span> year<span class="op">,</span> latitude<span class="op">,</span> defaultDate<span class="op">,</span> defaultHour }</span>
<span id="cb90-1377"><a href="#cb90-1377" aria-hidden="true" tabindex="-1"></a>) <span class="kw">=&gt;</span> {</span>
<span id="cb90-1378"><a href="#cb90-1378" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> margin <span class="op">=</span> { <span class="dt">top</span><span class="op">:</span> <span class="dv">32</span><span class="op">,</span> <span class="dt">bottom</span><span class="op">:</span> <span class="dv">32</span><span class="op">,</span> <span class="dt">left</span><span class="op">:</span> <span class="dv">32</span><span class="op">,</span> <span class="dt">right</span><span class="op">:</span> <span class="dv">0</span> }<span class="op">;</span></span>
<span id="cb90-1379"><a href="#cb90-1379" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> chartWidth <span class="op">=</span> vizwidth <span class="op">-</span> margin<span class="op">.</span><span class="at">left</span> <span class="op">-</span> margin<span class="op">.</span><span class="at">right</span><span class="op">;</span></span>
<span id="cb90-1380"><a href="#cb90-1380" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> chartHeight <span class="op">=</span> height <span class="op">-</span> margin<span class="op">.</span><span class="at">top</span> <span class="op">-</span> margin<span class="op">.</span><span class="at">bottom</span><span class="op">;</span></span>
<span id="cb90-1381"><a href="#cb90-1381" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> yTickValues <span class="op">=</span></span>
<span id="cb90-1382"><a href="#cb90-1382" aria-hidden="true" tabindex="-1"></a>    width <span class="op">&gt;</span> <span class="dv">380</span> <span class="op">?</span> [<span class="dv">3</span><span class="op">,</span> <span class="dv">6</span><span class="op">,</span> <span class="dv">9</span><span class="op">,</span> <span class="dv">12</span><span class="op">,</span> <span class="dv">15</span><span class="op">,</span> <span class="dv">18</span><span class="op">,</span> <span class="dv">21</span>] <span class="op">:</span> width <span class="op">&gt;</span> <span class="dv">90</span> <span class="op">?</span> [<span class="dv">6</span><span class="op">,</span> <span class="dv">12</span><span class="op">,</span> <span class="dv">18</span>] <span class="op">:</span> [<span class="dv">12</span>]<span class="op">;</span></span>
<span id="cb90-1383"><a href="#cb90-1383" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> yScale <span class="op">=</span> d3</span>
<span id="cb90-1384"><a href="#cb90-1384" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">scaleLinear</span>()</span>
<span id="cb90-1385"><a href="#cb90-1385" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">domain</span>([<span class="dv">0</span><span class="op">,</span> <span class="dv">24</span>])</span>
<span id="cb90-1386"><a href="#cb90-1386" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">range</span>([margin<span class="op">.</span><span class="at">left</span><span class="op">,</span> margin<span class="op">.</span><span class="at">left</span> <span class="op">+</span> chartWidth])</span>
<span id="cb90-1387"><a href="#cb90-1387" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">clamp</span>(<span class="kw">true</span>)<span class="op">;</span></span>
<span id="cb90-1388"><a href="#cb90-1388" aria-hidden="true" tabindex="-1"></a>  <span class="co">// y-axis scale</span></span>
<span id="cb90-1389"><a href="#cb90-1389" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> xScale <span class="op">=</span> d3</span>
<span id="cb90-1390"><a href="#cb90-1390" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">scaleTime</span>()</span>
<span id="cb90-1391"><a href="#cb90-1391" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">domain</span>([<span class="kw">new</span> <span class="bu">Date</span>(year<span class="op">,</span> <span class="dv">0</span><span class="op">,</span> <span class="dv">61</span>)<span class="op">,</span> <span class="kw">new</span> <span class="bu">Date</span>(year<span class="op">,</span> <span class="dv">11</span><span class="op">,</span> <span class="dv">91</span>)])</span>
<span id="cb90-1392"><a href="#cb90-1392" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">range</span>([margin<span class="op">.</span><span class="at">top</span><span class="op">,</span> margin<span class="op">.</span><span class="at">top</span> <span class="op">+</span> chartHeight])</span>
<span id="cb90-1393"><a href="#cb90-1393" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">clamp</span>(<span class="kw">true</span>)<span class="op">;</span></span>
<span id="cb90-1394"><a href="#cb90-1394" aria-hidden="true" tabindex="-1"></a>  <span class="co">// y-axis labels</span></span>
<span id="cb90-1395"><a href="#cb90-1395" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> xAxis <span class="op">=</span> d3</span>
<span id="cb90-1396"><a href="#cb90-1396" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">axisBottom</span>(xScale)</span>
<span id="cb90-1397"><a href="#cb90-1397" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">tickValues</span>(d3<span class="op">.</span><span class="at">timeMonth</span><span class="op">.</span><span class="fu">range</span>(<span class="kw">new</span> <span class="bu">Date</span>(year<span class="op">,</span> <span class="dv">0</span><span class="op">,</span> <span class="dv">60</span>)<span class="op">,</span> <span class="kw">new</span> <span class="bu">Date</span>(year<span class="op">,</span> <span class="dv">12</span><span class="op">,</span> <span class="dv">57</span>)))</span>
<span id="cb90-1398"><a href="#cb90-1398" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">tickSize</span>(chartWidth)</span>
<span id="cb90-1399"><a href="#cb90-1399" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">tickFormat</span>(date2doty1)<span class="op">;</span></span>
<span id="cb90-1400"><a href="#cb90-1400" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> yAxis <span class="op">=</span> d3</span>
<span id="cb90-1401"><a href="#cb90-1401" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">axisLeft</span>(yScale)</span>
<span id="cb90-1402"><a href="#cb90-1402" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">tickValues</span>(yTickValues)</span>
<span id="cb90-1403"><a href="#cb90-1403" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">tickSize</span>(chartHeight)</span>
<span id="cb90-1404"><a href="#cb90-1404" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">tickFormat</span>((d) <span class="kw">=&gt;</span> { <span class="cf">return</span> <span class="vs">`</span><span class="sc">${</span>d <span class="op">/</span> <span class="op">.</span><span class="bn">024</span><span class="sc">}</span><span class="vs">`</span> })<span class="op">;</span></span>
<span id="cb90-1405"><a href="#cb90-1405" aria-hidden="true" tabindex="-1"></a>  <span class="kw">let</span> date <span class="op">=</span> defaultDate <span class="op">||</span> <span class="kw">new</span> <span class="bu">Date</span>()<span class="op">;</span></span>
<span id="cb90-1406"><a href="#cb90-1406" aria-hidden="true" tabindex="-1"></a>  <span class="kw">let</span> hour <span class="op">=</span> defaultHour <span class="op">!=</span> <span class="kw">null</span> <span class="op">?</span> defaultHour <span class="op">:</span> date<span class="op">.</span><span class="fu">getHours</span>()<span class="op">;</span></span>
<span id="cb90-1407"><a href="#cb90-1407" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> handleMouseMove <span class="op">=</span> (e) <span class="kw">=&gt;</span> {}<span class="op">;</span></span>
<span id="cb90-1408"><a href="#cb90-1408" aria-hidden="true" tabindex="-1"></a>  <span class="bu">root</span></span>
<span id="cb90-1409"><a href="#cb90-1409" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">append</span>(<span class="st">"rect"</span>)</span>
<span id="cb90-1410"><a href="#cb90-1410" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">"y"</span><span class="op">,</span> margin<span class="op">.</span><span class="at">left</span>)</span>
<span id="cb90-1411"><a href="#cb90-1411" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">"x"</span><span class="op">,</span> margin<span class="op">.</span><span class="at">top</span>)</span>
<span id="cb90-1412"><a href="#cb90-1412" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">"height"</span><span class="op">,</span> chartWidth)</span>
<span id="cb90-1413"><a href="#cb90-1413" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">"width"</span><span class="op">,</span> chartHeight)</span>
<span id="cb90-1414"><a href="#cb90-1414" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">"ry"</span><span class="op">,</span> <span class="fl">0.05</span> <span class="op">*</span> vizwidth)</span>
<span id="cb90-1415"><a href="#cb90-1415" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">"fill"</span><span class="op">,</span> mapcolors<span class="op">.</span><span class="at">night</span>)<span class="op">;</span></span>
<span id="cb90-1416"><a href="#cb90-1416" aria-hidden="true" tabindex="-1"></a>  <span class="bu">root</span></span>
<span id="cb90-1417"><a href="#cb90-1417" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">append</span>(<span class="st">"g"</span>)</span>
<span id="cb90-1418"><a href="#cb90-1418" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">"transform"</span><span class="op">,</span> <span class="vs">`translate(0, </span><span class="sc">${</span>margin<span class="op">.</span><span class="at">top</span><span class="sc">}</span><span class="vs">)`</span>)</span>
<span id="cb90-1419"><a href="#cb90-1419" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">call</span>(xAxis)</span>
<span id="cb90-1420"><a href="#cb90-1420" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">call</span>((g) <span class="kw">=&gt;</span> g<span class="op">.</span><span class="fu">select</span>(<span class="st">".domain"</span>)<span class="op">.</span><span class="fu">remove</span>())</span>
<span id="cb90-1421"><a href="#cb90-1421" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">call</span>((g) <span class="kw">=&gt;</span> g<span class="op">.</span><span class="fu">selectAll</span>(<span class="st">".tick"</span>)<span class="op">.</span><span class="fu">attr</span>(<span class="st">"color"</span><span class="op">,</span> mapcolors<span class="op">.</span><span class="at">grid</span>))</span>
<span id="cb90-1422"><a href="#cb90-1422" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">call</span>((g) <span class="kw">=&gt;</span> g<span class="op">.</span><span class="fu">selectAll</span>(<span class="st">".tick text"</span>)<span class="op">.</span><span class="fu">attr</span>(<span class="st">"font-size"</span><span class="op">,</span> (width <span class="op">&lt;</span> <span class="dv">300</span> <span class="op">?</span> <span class="op">.</span><span class="dv">7</span> <span class="op">:</span> width <span class="op">&lt;</span> <span class="dv">325</span> <span class="op">?</span> <span class="op">.</span><span class="dv">725</span> <span class="op">:</span> width <span class="op">&lt;</span> <span class="dv">350</span> <span class="op">?</span> <span class="op">.</span><span class="dv">75</span> <span class="op">:</span> width <span class="op">&lt;</span> <span class="dv">375</span> <span class="op">?</span> <span class="op">.</span><span class="dv">8</span> <span class="op">:</span> width <span class="op">&lt;</span> <span class="dv">400</span> <span class="op">?</span> <span class="op">.</span><span class="dv">9</span> <span class="op">:</span> width <span class="op">&lt;</span> <span class="dv">450</span> <span class="op">?</span> <span class="op">.</span><span class="dv">95</span> <span class="op">:</span> width <span class="op">&lt;</span> <span class="dv">500</span> <span class="op">?</span> <span class="dv">1</span> <span class="op">:</span> width <span class="op">&lt;</span> <span class="dv">600</span> <span class="op">?</span> <span class="fl">1.2</span> <span class="op">:</span> width <span class="op">&lt;</span> <span class="dv">700</span> <span class="op">?</span> <span class="fl">1.3</span> <span class="op">:</span> width <span class="op">&lt;</span> <span class="dv">800</span> <span class="op">?</span> <span class="fl">1.4</span> <span class="op">:</span> width <span class="op">&lt;</span> <span class="dv">900</span> <span class="op">?</span> <span class="fl">1.5</span> <span class="op">:</span> width <span class="op">&lt;</span> <span class="dv">1000</span> <span class="op">?</span> <span class="fl">1.7</span> <span class="op">:</span> width <span class="op">&lt;</span> <span class="dv">1100</span> <span class="op">?</span> <span class="fl">1.8</span> <span class="op">:</span> width <span class="op">&lt;</span> <span class="dv">1200</span> <span class="op">?</span> <span class="fl">1.9</span> <span class="op">:</span> <span class="dv">2</span>) <span class="op">*</span> fontSize))</span>
<span id="cb90-1423"><a href="#cb90-1423" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">call</span>((g) <span class="kw">=&gt;</span> g<span class="op">.</span><span class="fu">selectAll</span>(<span class="st">".tick text"</span>)<span class="op">.</span><span class="fu">attr</span>(<span class="st">"color"</span><span class="op">,</span> <span class="st">"black"</span>))</span>
<span id="cb90-1424"><a href="#cb90-1424" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">call</span>((g) <span class="kw">=&gt;</span> g<span class="op">.</span><span class="fu">selectAll</span>(<span class="st">".tick line"</span>)<span class="op">.</span><span class="fu">attr</span>(<span class="st">"stroke-dasharray"</span><span class="op">,</span> <span class="st">"5 3"</span>))<span class="op">;</span></span>
<span id="cb90-1425"><a href="#cb90-1425" aria-hidden="true" tabindex="-1"></a>  <span class="bu">root</span></span>
<span id="cb90-1426"><a href="#cb90-1426" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">append</span>(<span class="st">"g"</span>)</span>
<span id="cb90-1427"><a href="#cb90-1427" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">"transform"</span><span class="op">,</span> <span class="vs">`translate(</span><span class="sc">${</span>margin<span class="op">.</span><span class="at">left</span> <span class="op">+</span> chartHeight<span class="sc">}</span><span class="vs">, 0)`</span>)</span>
<span id="cb90-1428"><a href="#cb90-1428" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">call</span>(yAxis)</span>
<span id="cb90-1429"><a href="#cb90-1429" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">call</span>((g) <span class="kw">=&gt;</span> g<span class="op">.</span><span class="fu">select</span>(<span class="st">".domain"</span>)<span class="op">.</span><span class="fu">remove</span>())</span>
<span id="cb90-1430"><a href="#cb90-1430" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">call</span>((g) <span class="kw">=&gt;</span> g<span class="op">.</span><span class="fu">selectAll</span>(<span class="st">".tick"</span>)<span class="op">.</span><span class="fu">attr</span>(<span class="st">"color"</span><span class="op">,</span> mapcolors<span class="op">.</span><span class="at">grid</span>))</span>
<span id="cb90-1431"><a href="#cb90-1431" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">call</span>((g) <span class="kw">=&gt;</span> g<span class="op">.</span><span class="fu">selectAll</span>(<span class="st">".tick text"</span>)<span class="op">.</span><span class="fu">attr</span>(<span class="st">"font-size"</span><span class="op">,</span> (width <span class="op">&lt;</span> <span class="dv">400</span> <span class="op">?</span> <span class="op">.</span><span class="dv">9</span> <span class="op">:</span> width <span class="op">&lt;</span> <span class="dv">450</span> <span class="op">?</span> <span class="op">.</span><span class="dv">95</span> <span class="op">:</span> width <span class="op">&lt;</span> <span class="dv">500</span> <span class="op">?</span> <span class="dv">1</span> <span class="op">:</span> width <span class="op">&lt;</span> <span class="dv">600</span> <span class="op">?</span> <span class="fl">1.2</span> <span class="op">:</span> width <span class="op">&lt;</span> <span class="dv">700</span> <span class="op">?</span> <span class="fl">1.3</span> <span class="op">:</span> width <span class="op">&lt;</span> <span class="dv">800</span> <span class="op">?</span> <span class="fl">1.4</span> <span class="op">:</span> width <span class="op">&lt;</span> <span class="dv">900</span> <span class="op">?</span> <span class="fl">1.5</span> <span class="op">:</span> width <span class="op">&lt;</span> <span class="dv">1000</span> <span class="op">?</span> <span class="fl">1.7</span> <span class="op">:</span> width <span class="op">&lt;</span> <span class="dv">1100</span> <span class="op">?</span> <span class="fl">1.8</span> <span class="op">:</span> width <span class="op">&lt;</span> <span class="dv">1200</span> <span class="op">?</span> <span class="fl">1.9</span> <span class="op">:</span> <span class="dv">2</span>) <span class="op">*</span> fontSize))</span>
<span id="cb90-1432"><a href="#cb90-1432" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">call</span>((g) <span class="kw">=&gt;</span> g<span class="op">.</span><span class="fu">selectAll</span>(<span class="st">".tick text"</span>)<span class="op">.</span><span class="fu">attr</span>(<span class="st">"color"</span><span class="op">,</span> <span class="st">"black"</span>))</span>
<span id="cb90-1433"><a href="#cb90-1433" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">call</span>((g) <span class="kw">=&gt;</span> g<span class="op">.</span><span class="fu">selectAll</span>(<span class="st">".tick line"</span>)<span class="op">.</span><span class="fu">attr</span>(<span class="st">"stroke-dasharray"</span><span class="op">,</span> <span class="st">"5 3"</span>))<span class="op">;</span></span>
<span id="cb90-1434"><a href="#cb90-1434" aria-hidden="true" tabindex="-1"></a>  <span class="bu">root</span></span>
<span id="cb90-1435"><a href="#cb90-1435" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">append</span>(<span class="st">"text"</span>)</span>
<span id="cb90-1436"><a href="#cb90-1436" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">text</span>(<span class="st">"Time of day"</span>)</span>
<span id="cb90-1437"><a href="#cb90-1437" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">"x"</span><span class="op">,</span> <span class="op">-</span>chartHeight <span class="op">/</span> <span class="dv">5</span> <span class="op">+</span> (width <span class="op">&lt;</span> <span class="dv">275</span> <span class="op">?</span> <span class="op">-</span><span class="dv">2</span> <span class="op">:</span> width <span class="op">&lt;</span> <span class="dv">300</span> <span class="op">?</span> <span class="op">-</span><span class="dv">6</span> <span class="op">:</span> width <span class="op">&lt;</span> <span class="dv">325</span> <span class="op">?</span> <span class="op">-</span><span class="dv">8</span> <span class="op">:</span> width <span class="op">&lt;</span> <span class="dv">350</span> <span class="op">?</span> <span class="op">-</span><span class="dv">15</span> <span class="op">:</span> width <span class="op">&lt;</span> <span class="dv">375</span> <span class="op">?</span> <span class="op">-</span><span class="dv">20</span> <span class="op">:</span> width <span class="op">&lt;</span> <span class="dv">400</span> <span class="op">?</span> <span class="op">-</span><span class="dv">28</span> <span class="op">:</span> width <span class="op">&lt;</span> <span class="dv">425</span> <span class="op">?</span> <span class="op">-</span><span class="dv">30</span> <span class="op">:</span> width <span class="op">&lt;</span> <span class="dv">450</span> <span class="op">?</span> <span class="op">-</span><span class="dv">32</span> <span class="op">:</span> width <span class="op">&lt;</span> <span class="dv">475</span> <span class="op">?</span> <span class="op">-</span><span class="dv">36</span> <span class="op">:</span> width <span class="op">&lt;</span> <span class="dv">500</span> <span class="op">?</span> <span class="op">-</span><span class="dv">41</span> <span class="op">:</span> width <span class="op">&lt;</span> <span class="dv">525</span> <span class="op">?</span> <span class="op">-</span><span class="dv">42</span> <span class="op">:</span> width <span class="op">&lt;</span> <span class="dv">550</span> <span class="op">?</span> <span class="op">-</span><span class="dv">48</span> <span class="op">:</span> width <span class="op">&lt;</span> <span class="dv">575</span> <span class="op">?</span> <span class="op">-</span><span class="dv">49</span> <span class="op">:</span> width <span class="op">&lt;</span> <span class="dv">600</span> <span class="op">?</span> <span class="op">-</span><span class="dv">4</span> <span class="op">:</span> width <span class="op">&lt;</span> <span class="dv">650</span> <span class="op">?</span> <span class="op">-</span><span class="dv">7</span> <span class="op">:</span> width <span class="op">&lt;</span> <span class="dv">675</span> <span class="op">?</span> <span class="op">-</span><span class="dv">12</span> <span class="op">:</span> width <span class="op">&lt;</span> <span class="dv">700</span> <span class="op">?</span> <span class="op">-</span><span class="dv">16</span> <span class="op">:</span> width <span class="op">&lt;</span> <span class="dv">725</span> <span class="op">?</span> <span class="op">-</span><span class="dv">15</span> <span class="op">:</span> width <span class="op">&lt;</span> <span class="dv">750</span> <span class="op">?</span> <span class="op">-</span><span class="dv">20</span> <span class="op">:</span> width <span class="op">&lt;</span> <span class="dv">775</span> <span class="op">?</span> <span class="op">-</span><span class="dv">5</span> <span class="op">:</span> width <span class="op">&lt;</span> <span class="dv">875</span> <span class="op">?</span> <span class="op">-</span><span class="dv">3</span> <span class="op">:</span> width <span class="op">&lt;</span> <span class="dv">975</span> <span class="op">?</span> <span class="dv">13</span> <span class="op">:</span> width <span class="op">&lt;</span> <span class="dv">1025</span> <span class="op">?</span> <span class="dv">36</span> <span class="op">:</span> width <span class="op">&lt;</span> <span class="dv">1075</span> <span class="op">?</span> <span class="dv">28</span> <span class="op">:</span> width <span class="op">&lt;</span> <span class="dv">1125</span> <span class="op">?</span> <span class="dv">28</span> <span class="op">:</span> width <span class="op">&lt;</span> <span class="dv">1175</span> <span class="op">?</span> <span class="dv">28</span> <span class="op">:</span> width <span class="op">&lt;</span> <span class="dv">1275</span> <span class="op">?</span> <span class="dv">35</span> <span class="op">:</span> <span class="dv">32</span>))</span>
<span id="cb90-1438"><a href="#cb90-1438" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">"y"</span><span class="op">,</span> margin<span class="op">.</span><span class="at">left</span> <span class="op">-</span> (width <span class="op">&lt;</span> <span class="dv">275</span> <span class="op">?</span> <span class="dv">12</span> <span class="op">:</span> width <span class="op">&lt;</span> <span class="dv">300</span> <span class="op">?</span> <span class="dv">16</span> <span class="op">:</span> width <span class="op">&lt;</span> <span class="dv">325</span> <span class="op">?</span> <span class="dv">17</span> <span class="op">:</span> width <span class="op">&lt;</span> <span class="dv">350</span> <span class="op">?</span> <span class="dv">18</span> <span class="op">:</span> width <span class="op">&lt;</span> <span class="dv">375</span> <span class="op">?</span> <span class="dv">19</span> <span class="op">:</span> width <span class="op">&lt;</span> <span class="dv">400</span> <span class="op">?</span> <span class="dv">20</span> <span class="op">:</span> width <span class="op">&lt;</span> <span class="dv">425</span> <span class="op">?</span> <span class="dv">21</span> <span class="op">:</span> width <span class="op">&lt;</span> <span class="dv">450</span> <span class="op">?</span> <span class="dv">22</span> <span class="op">:</span> width <span class="op">&lt;</span> <span class="dv">475</span> <span class="op">?</span> <span class="dv">23</span> <span class="op">:</span> width <span class="op">&lt;</span> <span class="dv">500</span> <span class="op">?</span> <span class="dv">24</span> <span class="op">:</span> width <span class="op">&lt;</span> <span class="dv">525</span> <span class="op">?</span> <span class="dv">25</span> <span class="op">:</span> width <span class="op">&lt;</span> <span class="dv">550</span> <span class="op">?</span> <span class="dv">26</span> <span class="op">:</span> width <span class="op">&lt;</span> <span class="dv">575</span> <span class="op">?</span> <span class="dv">27</span> <span class="op">:</span> width <span class="op">&lt;</span> <span class="dv">600</span> <span class="op">?</span> <span class="dv">28</span> <span class="op">:</span> width <span class="op">&lt;</span> <span class="dv">650</span> <span class="op">?</span> <span class="dv">29</span> <span class="op">:</span> width <span class="op">&lt;</span> <span class="dv">675</span> <span class="op">?</span> <span class="dv">30</span> <span class="op">:</span> width <span class="op">&lt;</span> <span class="dv">700</span> <span class="op">?</span> <span class="dv">31</span> <span class="op">:</span> width <span class="op">&lt;</span> <span class="dv">725</span> <span class="op">?</span> <span class="dv">40</span> <span class="op">:</span> width <span class="op">&lt;</span> <span class="dv">750</span> <span class="op">?</span> <span class="dv">49</span> <span class="op">:</span> width <span class="op">&lt;</span> <span class="dv">775</span> <span class="op">?</span> <span class="dv">46</span> <span class="op">:</span> width <span class="op">&lt;</span> <span class="dv">875</span> <span class="op">?</span> <span class="dv">47</span> <span class="op">:</span> width <span class="op">&lt;</span> <span class="dv">925</span> <span class="op">?</span> <span class="dv">52</span> <span class="op">:</span> width <span class="op">&lt;</span> <span class="dv">975</span> <span class="op">?</span> <span class="dv">53</span> <span class="op">:</span> width <span class="op">&lt;</span> <span class="dv">1025</span> <span class="op">?</span> <span class="dv">54</span> <span class="op">:</span> width <span class="op">&lt;</span> <span class="dv">1075</span> <span class="op">?</span> <span class="dv">55</span> <span class="op">:</span> width <span class="op">&lt;</span> <span class="dv">1175</span> <span class="op">?</span> <span class="dv">64</span> <span class="op">:</span> width <span class="op">&lt;</span> <span class="dv">1275</span> <span class="op">?</span> <span class="dv">68</span> <span class="op">:</span> <span class="dv">64</span>))</span>
<span id="cb90-1439"><a href="#cb90-1439" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">"text-anchor"</span><span class="op">,</span> <span class="st">"middle"</span>)</span>
<span id="cb90-1440"><a href="#cb90-1440" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">"font-size"</span><span class="op">,</span> fontSize <span class="op">*</span> (width <span class="op">&lt;</span> <span class="dv">300</span> <span class="op">?</span> <span class="op">.</span><span class="dv">8</span> <span class="op">:</span> width <span class="op">&lt;</span> <span class="dv">400</span> <span class="op">?</span> <span class="op">.</span><span class="dv">9</span> <span class="op">:</span> width <span class="op">&lt;</span> <span class="dv">500</span> <span class="op">?</span> <span class="dv">1</span> <span class="op">:</span> width <span class="op">&lt;</span> <span class="dv">600</span> <span class="op">?</span> <span class="fl">1.1</span> <span class="op">:</span> width <span class="op">&lt;</span> <span class="dv">700</span> <span class="op">?</span> <span class="fl">1.2</span> <span class="op">:</span> <span class="fl">1.25</span>) <span class="op">+</span> width <span class="op">/</span> <span class="dv">100</span>)</span>
<span id="cb90-1441"><a href="#cb90-1441" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">"font-family"</span><span class="op">,</span> <span class="st">"sans-serif"</span>)</span>
<span id="cb90-1442"><a href="#cb90-1442" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">"transform"</span><span class="op">,</span> <span class="st">"rotate(-90)"</span>)</span>
<span id="cb90-1443"><a href="#cb90-1443" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">"fill"</span><span class="op">,</span> <span class="st">"black"</span>)<span class="op">;</span></span>
<span id="cb90-1444"><a href="#cb90-1444" aria-hidden="true" tabindex="-1"></a>  <span class="bu">root</span></span>
<span id="cb90-1445"><a href="#cb90-1445" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">append</span>(<span class="st">"text"</span>)</span>
<span id="cb90-1446"><a href="#cb90-1446" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">text</span>(<span class="st">"Day of year"</span>)</span>
<span id="cb90-1447"><a href="#cb90-1447" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">"x"</span><span class="op">,</span> margin<span class="op">.</span><span class="at">left</span> <span class="op">+</span> width <span class="op">/</span> <span class="dv">2</span> <span class="op">-</span> (width <span class="op">&lt;</span> <span class="dv">500</span> <span class="op">?</span> <span class="dv">30</span> <span class="op">:</span> width <span class="op">&lt;</span> <span class="dv">600</span> <span class="op">?</span> <span class="dv">28</span> <span class="op">:</span> width <span class="op">&lt;</span> <span class="dv">700</span> <span class="op">?</span> <span class="dv">24</span> <span class="op">:</span> <span class="dv">22</span>))</span>
<span id="cb90-1448"><a href="#cb90-1448" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">"y"</span><span class="op">,</span> margin<span class="op">.</span><span class="at">top</span> <span class="op">+</span> chartHeight <span class="op">/</span> <span class="dv">4</span> <span class="op">+</span> margin<span class="op">.</span><span class="at">bottom</span> <span class="op">+</span> (width <span class="op">&lt;</span> <span class="dv">275</span> <span class="op">?</span> <span class="dv">10</span> <span class="op">:</span> width <span class="op">&lt;</span> <span class="dv">300</span> <span class="op">?</span> <span class="dv">18</span> <span class="op">:</span> width <span class="op">&lt;</span> <span class="dv">325</span> <span class="op">?</span> <span class="dv">19</span> <span class="op">:</span> width <span class="op">&lt;</span> <span class="dv">350</span> <span class="op">?</span> <span class="dv">22</span> <span class="op">:</span> width <span class="op">&lt;</span> <span class="dv">375</span> <span class="op">?</span> <span class="dv">30</span> <span class="op">:</span> width <span class="op">&lt;</span> <span class="dv">400</span> <span class="op">?</span> <span class="dv">37</span> <span class="op">:</span> width <span class="op">&lt;</span> <span class="dv">450</span> <span class="op">?</span> <span class="dv">39</span> <span class="op">:</span> width <span class="op">&lt;</span> <span class="dv">475</span> <span class="op">?</span> <span class="dv">40</span> <span class="op">:</span> width <span class="op">&lt;</span> <span class="dv">500</span> <span class="op">?</span> <span class="dv">44</span> <span class="op">:</span> width <span class="op">&lt;</span> <span class="dv">550</span> <span class="op">?</span> <span class="dv">50</span> <span class="op">:</span> width <span class="op">&lt;</span> <span class="dv">600</span> <span class="op">?</span> <span class="dv">51</span> <span class="op">:</span> width <span class="op">&lt;</span> <span class="dv">650</span> <span class="op">?</span> <span class="dv">45</span> <span class="op">:</span> width <span class="op">&lt;</span> <span class="dv">700</span> <span class="op">?</span> <span class="dv">39</span> <span class="op">:</span> width <span class="op">&lt;</span> <span class="dv">750</span> <span class="op">?</span> <span class="dv">35</span> <span class="op">:</span> width <span class="op">&lt;</span> <span class="dv">850</span> <span class="op">?</span> <span class="dv">45</span> <span class="op">:</span> width <span class="op">&lt;</span> <span class="dv">950</span> <span class="op">?</span> <span class="dv">55</span> <span class="op">:</span> width <span class="op">&lt;</span> <span class="dv">1050</span> <span class="op">?</span> <span class="dv">65</span> <span class="op">:</span> width <span class="op">&lt;</span> <span class="dv">1150</span> <span class="op">?</span> <span class="dv">75</span> <span class="op">:</span> width <span class="op">&lt;</span> <span class="dv">1250</span> <span class="op">?</span> <span class="dv">85</span> <span class="op">:</span> width <span class="op">&lt;</span> <span class="dv">1350</span> <span class="op">?</span> <span class="dv">95</span> <span class="op">:</span> <span class="dv">109</span>))</span>
<span id="cb90-1449"><a href="#cb90-1449" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">"text-anchor"</span><span class="op">,</span> <span class="st">"middle"</span>)</span>
<span id="cb90-1450"><a href="#cb90-1450" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">"font-size"</span><span class="op">,</span> fontSize <span class="op">*</span> (width <span class="op">&lt;</span> <span class="dv">300</span> <span class="op">?</span> <span class="op">.</span><span class="dv">95</span> <span class="op">:</span> width <span class="op">&lt;</span> <span class="dv">400</span> <span class="op">?</span> <span class="dv">1</span> <span class="op">:</span> width <span class="op">&lt;</span> <span class="dv">500</span> <span class="op">?</span> <span class="fl">1.05</span> <span class="op">:</span> width <span class="op">&lt;</span> <span class="dv">600</span> <span class="op">?</span> <span class="fl">1.15</span> <span class="op">:</span> width <span class="op">&lt;</span> <span class="dv">700</span> <span class="op">?</span> <span class="fl">1.2</span> <span class="op">:</span> <span class="fl">1.25</span>) <span class="op">+</span> width <span class="op">/</span> <span class="dv">100</span>)</span>
<span id="cb90-1451"><a href="#cb90-1451" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">"font-family"</span><span class="op">,</span> <span class="st">"sans-serif"</span>)</span>
<span id="cb90-1452"><a href="#cb90-1452" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">"fill"</span><span class="op">,</span> <span class="st">"black"</span>)<span class="op">;</span></span>
<span id="cb90-1453"><a href="#cb90-1453" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> data <span class="op">=</span> <span class="fu">yearDates</span>(year)</span>
<span id="cb90-1454"><a href="#cb90-1454" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">map</span>((d) <span class="kw">=&gt;</span> [d<span class="op">,</span> <span class="fu">dayLength</span>(d<span class="op">,</span> latitude)])</span>
<span id="cb90-1455"><a href="#cb90-1455" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">filter</span>(([_<span class="op">,</span> d]) <span class="kw">=&gt;</span> d <span class="op">&gt;</span> <span class="dv">0</span>)<span class="op">;</span></span>
<span id="cb90-1456"><a href="#cb90-1456" aria-hidden="true" tabindex="-1"></a>  <span class="co">/* Render separate polygons for each continuous sequence of</span></span>
<span id="cb90-1457"><a href="#cb90-1457" aria-hidden="true" tabindex="-1"></a><span class="co">   * days with more than 0 hours of day light</span></span>
<span id="cb90-1458"><a href="#cb90-1458" aria-hidden="true" tabindex="-1"></a><span class="co">   */</span></span>
<span id="cb90-1459"><a href="#cb90-1459" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> polys <span class="op">=</span> []<span class="op">;</span></span>
<span id="cb90-1460"><a href="#cb90-1460" aria-hidden="true" tabindex="-1"></a>  <span class="kw">let</span> currentPoly <span class="op">=</span> []<span class="op">;</span></span>
<span id="cb90-1461"><a href="#cb90-1461" aria-hidden="true" tabindex="-1"></a>  <span class="cf">for</span> (<span class="kw">let</span> i <span class="op">=</span> <span class="dv">0</span><span class="op">;</span> i <span class="op">&lt;</span> data<span class="op">.</span><span class="at">length</span><span class="op">;</span> i<span class="op">++</span>) {</span>
<span id="cb90-1462"><a href="#cb90-1462" aria-hidden="true" tabindex="-1"></a>    <span class="kw">const</span> currentDate <span class="op">=</span> data[i][<span class="dv">0</span>]<span class="op">;</span></span>
<span id="cb90-1463"><a href="#cb90-1463" aria-hidden="true" tabindex="-1"></a>    <span class="kw">const</span> prevDate <span class="op">=</span> (data[i <span class="op">-</span> <span class="dv">1</span>] <span class="op">||</span> [])[<span class="dv">0</span>]<span class="op">;</span></span>
<span id="cb90-1464"><a href="#cb90-1464" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> (</span>
<span id="cb90-1465"><a href="#cb90-1465" aria-hidden="true" tabindex="-1"></a>      i <span class="op">===</span> <span class="dv">0</span> <span class="op">||</span></span>
<span id="cb90-1466"><a href="#cb90-1466" aria-hidden="true" tabindex="-1"></a>      currentDate<span class="op">.</span><span class="fu">getTime</span>() <span class="op">-</span> prevDate<span class="op">.</span><span class="fu">getTime</span>() <span class="op">&lt;</span> <span class="dv">3600</span> <span class="op">*</span> <span class="dv">24</span> <span class="op">*</span> <span class="dv">1000</span> <span class="op">*</span> <span class="fl">1.5</span></span>
<span id="cb90-1467"><a href="#cb90-1467" aria-hidden="true" tabindex="-1"></a>    ) {</span>
<span id="cb90-1468"><a href="#cb90-1468" aria-hidden="true" tabindex="-1"></a>      currentPoly<span class="op">.</span><span class="fu">push</span>(data[i])<span class="op">;</span></span>
<span id="cb90-1469"><a href="#cb90-1469" aria-hidden="true" tabindex="-1"></a>    } <span class="cf">else</span> {</span>
<span id="cb90-1470"><a href="#cb90-1470" aria-hidden="true" tabindex="-1"></a>      polys<span class="op">.</span><span class="fu">push</span>(currentPoly)<span class="op">;</span></span>
<span id="cb90-1471"><a href="#cb90-1471" aria-hidden="true" tabindex="-1"></a>      currentPoly <span class="op">=</span> [data[i]]<span class="op">;</span></span>
<span id="cb90-1472"><a href="#cb90-1472" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb90-1473"><a href="#cb90-1473" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb90-1474"><a href="#cb90-1474" aria-hidden="true" tabindex="-1"></a>  polys<span class="op">.</span><span class="fu">push</span>(currentPoly)<span class="op">;</span></span>
<span id="cb90-1475"><a href="#cb90-1475" aria-hidden="true" tabindex="-1"></a>  polys<span class="op">.</span><span class="fu">forEach</span>((p) <span class="kw">=&gt;</span> {</span>
<span id="cb90-1476"><a href="#cb90-1476" aria-hidden="true" tabindex="-1"></a>    <span class="kw">const</span> points <span class="op">=</span> [</span>
<span id="cb90-1477"><a href="#cb90-1477" aria-hidden="true" tabindex="-1"></a>      <span class="op">...</span>p<span class="op">.</span><span class="fu">map</span>(([d<span class="op">,</span> l]) <span class="kw">=&gt;</span> <span class="vs">`</span><span class="sc">${</span><span class="fu">xScale</span>(d)<span class="sc">}</span><span class="vs">,</span><span class="sc">${</span><span class="fu">yScale</span>(<span class="dv">12</span> <span class="op">-</span> l <span class="op">/</span> <span class="dv">2</span>)<span class="sc">}</span><span class="vs">`</span>)<span class="op">,</span></span>
<span id="cb90-1478"><a href="#cb90-1478" aria-hidden="true" tabindex="-1"></a>      <span class="op">...</span>p<span class="op">.</span><span class="fu">reverse</span>()<span class="op">.</span><span class="fu">map</span>(([d<span class="op">,</span> l]) <span class="kw">=&gt;</span> <span class="vs">`</span><span class="sc">${</span><span class="fu">xScale</span>(d)<span class="sc">}</span><span class="vs">,</span><span class="sc">${</span><span class="fu">yScale</span>(<span class="dv">12</span> <span class="op">+</span> l <span class="op">/</span> <span class="dv">2</span>)<span class="sc">}</span><span class="vs">`</span>)</span>
<span id="cb90-1479"><a href="#cb90-1479" aria-hidden="true" tabindex="-1"></a>    ]<span class="op">.</span><span class="fu">join</span>(<span class="st">" "</span>)<span class="op">;</span></span>
<span id="cb90-1480"><a href="#cb90-1480" aria-hidden="true" tabindex="-1"></a>    <span class="bu">root</span><span class="op">.</span><span class="fu">append</span>(<span class="st">"polygon"</span>)<span class="op">.</span><span class="fu">attr</span>(<span class="st">"points"</span><span class="op">,</span> points)<span class="op">.</span><span class="fu">attr</span>(<span class="st">"fill"</span><span class="op">,</span> mapcolors<span class="op">.</span><span class="at">day</span>)<span class="op">;</span></span>
<span id="cb90-1481"><a href="#cb90-1481" aria-hidden="true" tabindex="-1"></a>  })<span class="op">;</span></span>
<span id="cb90-1482"><a href="#cb90-1482" aria-hidden="true" tabindex="-1"></a>  <span class="co">/* Legend */</span></span>
<span id="cb90-1483"><a href="#cb90-1483" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> legend <span class="op">=</span> <span class="bu">root</span></span>
<span id="cb90-1484"><a href="#cb90-1484" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">append</span>(<span class="st">"g"</span>)</span>
<span id="cb90-1485"><a href="#cb90-1485" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">"transform"</span><span class="op">,</span> <span class="vs">`translate(</span><span class="sc">${</span>margin<span class="op">.</span><span class="at">left</span> <span class="op">+</span> chartWidth <span class="op">/</span> <span class="dv">2</span> <span class="op">-</span> <span class="dv">64</span><span class="sc">}</span><span class="vs">)`</span>)<span class="op">;</span></span>
<span id="cb90-1486"><a href="#cb90-1486" aria-hidden="true" tabindex="-1"></a>  legend</span>
<span id="cb90-1487"><a href="#cb90-1487" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">append</span>(<span class="st">"rect"</span>)</span>
<span id="cb90-1488"><a href="#cb90-1488" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">"x"</span><span class="op">,</span> chartWidth <span class="op">/</span> <span class="dv">20</span> <span class="op">+</span> (width <span class="op">&lt;</span> <span class="dv">275</span> <span class="op">?</span> <span class="dv">1</span> <span class="op">:</span> width <span class="op">&lt;</span> <span class="dv">300</span> <span class="op">?</span> <span class="dv">2</span> <span class="op">:</span> width <span class="op">&lt;</span> <span class="dv">325</span> <span class="op">?</span> <span class="dv">3</span> <span class="op">:</span> width <span class="op">&lt;</span> <span class="dv">350</span> <span class="op">?</span> <span class="dv">4</span> <span class="op">:</span> width <span class="op">&lt;</span> <span class="dv">375</span> <span class="op">?</span> <span class="dv">5</span> <span class="op">:</span> width <span class="op">&lt;</span> <span class="dv">400</span> <span class="op">?</span> <span class="dv">6</span> <span class="op">:</span> width <span class="op">&lt;</span> <span class="dv">450</span> <span class="op">?</span> <span class="dv">7</span> <span class="op">:</span> width <span class="op">&lt;</span> <span class="dv">475</span> <span class="op">?</span> <span class="dv">8</span> <span class="op">:</span> width <span class="op">&lt;</span> <span class="dv">500</span> <span class="op">?</span> <span class="dv">9</span> <span class="op">:</span> width <span class="op">&lt;</span> <span class="dv">550</span> <span class="op">?</span> <span class="dv">10</span> <span class="op">:</span> width <span class="op">&lt;</span> <span class="dv">600</span> <span class="op">?</span> <span class="dv">11</span> <span class="op">:</span> width <span class="op">&lt;</span> <span class="dv">650</span> <span class="op">?</span> <span class="dv">12</span> <span class="op">:</span> width <span class="op">&lt;</span> <span class="dv">700</span> <span class="op">?</span> <span class="dv">13</span> <span class="op">:</span> width <span class="op">&lt;</span> <span class="dv">750</span> <span class="op">?</span> <span class="dv">14</span> <span class="op">:</span> width <span class="op">&lt;</span> <span class="dv">850</span> <span class="op">?</span> <span class="dv">5</span> <span class="op">:</span> width <span class="op">&lt;</span> <span class="dv">950</span> <span class="op">?</span> <span class="op">-</span><span class="dv">6</span> <span class="op">:</span> width <span class="op">&lt;</span> <span class="dv">1050</span> <span class="op">?</span> <span class="op">-</span><span class="dv">8</span> <span class="op">:</span> width <span class="op">&lt;</span> <span class="dv">1150</span> <span class="op">?</span> <span class="op">-</span><span class="dv">8</span> <span class="op">:</span> width <span class="op">&lt;</span> <span class="dv">1250</span> <span class="op">?</span> <span class="op">-</span><span class="dv">8</span> <span class="op">:</span> width <span class="op">&lt;</span> <span class="dv">1350</span> <span class="op">?</span> <span class="op">-</span><span class="dv">8</span> <span class="op">:</span> width <span class="op">&lt;</span> <span class="dv">1400</span> <span class="op">?</span> <span class="op">-</span><span class="dv">8</span> <span class="op">:</span> <span class="op">-</span><span class="dv">100</span>))</span>
<span id="cb90-1489"><a href="#cb90-1489" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">"y"</span><span class="op">,</span> chartHeight <span class="op">/</span> <span class="dv">4</span> <span class="op">+</span> (width <span class="op">&lt;</span> <span class="dv">300</span> <span class="op">?</span> <span class="dv">81</span> <span class="op">:</span> width <span class="op">&lt;</span> <span class="dv">400</span> <span class="op">?</span> <span class="dv">82</span> <span class="op">:</span> width <span class="op">&lt;</span> <span class="dv">450</span> <span class="op">?</span> <span class="dv">83</span> <span class="op">:</span> width <span class="op">&lt;</span> <span class="dv">500</span> <span class="op">?</span> <span class="dv">52</span> <span class="op">:</span> width <span class="op">&lt;</span> <span class="dv">600</span> <span class="op">?</span> <span class="dv">54</span> <span class="op">:</span> width <span class="op">&lt;</span> <span class="dv">700</span> <span class="op">?</span> <span class="dv">85</span> <span class="op">:</span> width <span class="op">&lt;</span> <span class="dv">800</span> <span class="op">?</span> <span class="dv">94</span> <span class="op">:</span> width <span class="op">&lt;</span> <span class="dv">900</span> <span class="op">?</span> <span class="dv">99</span> <span class="op">:</span> width <span class="op">&lt;</span> <span class="dv">1000</span> <span class="op">?</span> <span class="dv">109</span> <span class="op">:</span> width <span class="op">&lt;</span> <span class="dv">1100</span> <span class="op">?</span> <span class="dv">139</span> <span class="op">:</span> width <span class="op">&lt;</span> <span class="dv">1200</span> <span class="op">?</span> <span class="dv">179</span> <span class="op">:</span> <span class="dv">154</span>))</span>
<span id="cb90-1490"><a href="#cb90-1490" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">"rx"</span><span class="op">,</span> <span class="dv">5</span>)</span>
<span id="cb90-1491"><a href="#cb90-1491" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">"width"</span><span class="op">,</span> fontSize <span class="op">*</span> (width <span class="op">&lt;</span> <span class="dv">300</span> <span class="op">?</span> <span class="op">.</span><span class="dv">95</span> <span class="op">:</span> width <span class="op">&lt;</span> <span class="dv">400</span> <span class="op">?</span> <span class="dv">1</span> <span class="op">:</span> width <span class="op">&lt;</span> <span class="dv">500</span> <span class="op">?</span> <span class="fl">1.05</span> <span class="op">:</span> width <span class="op">&lt;</span> <span class="dv">600</span> <span class="op">?</span> <span class="fl">1.15</span> <span class="op">:</span> width <span class="op">&lt;</span> <span class="dv">700</span> <span class="op">?</span> <span class="fl">1.2</span> <span class="op">:</span> <span class="fl">1.25</span>) <span class="op">+</span> width <span class="op">/</span> <span class="dv">100</span>)</span>
<span id="cb90-1492"><a href="#cb90-1492" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">"height"</span><span class="op">,</span> fontSize <span class="op">*</span> (width <span class="op">&lt;</span> <span class="dv">300</span> <span class="op">?</span> <span class="op">.</span><span class="dv">95</span> <span class="op">:</span> width <span class="op">&lt;</span> <span class="dv">400</span> <span class="op">?</span> <span class="dv">1</span> <span class="op">:</span> width <span class="op">&lt;</span> <span class="dv">500</span> <span class="op">?</span> <span class="fl">1.05</span> <span class="op">:</span> width <span class="op">&lt;</span> <span class="dv">600</span> <span class="op">?</span> <span class="fl">1.15</span> <span class="op">:</span> width <span class="op">&lt;</span> <span class="dv">700</span> <span class="op">?</span> <span class="fl">1.2</span> <span class="op">:</span> <span class="fl">1.25</span>) <span class="op">+</span> width <span class="op">/</span> <span class="dv">100</span>)</span>
<span id="cb90-1493"><a href="#cb90-1493" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">"fill"</span><span class="op">,</span> mapcolors<span class="op">.</span><span class="at">day</span>)<span class="op">;</span></span>
<span id="cb90-1494"><a href="#cb90-1494" aria-hidden="true" tabindex="-1"></a>  legend</span>
<span id="cb90-1495"><a href="#cb90-1495" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">append</span>(<span class="st">"text"</span>)</span>
<span id="cb90-1496"><a href="#cb90-1496" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">"x"</span><span class="op">,</span> chartWidth <span class="op">/</span> <span class="dv">20</span> <span class="op">+</span> (width <span class="op">&lt;</span> <span class="dv">275</span> <span class="op">?</span> <span class="dv">1</span> <span class="op">:</span> width <span class="op">&lt;</span> <span class="dv">300</span> <span class="op">?</span> <span class="dv">2</span> <span class="op">:</span> width <span class="op">&lt;</span> <span class="dv">325</span> <span class="op">?</span> <span class="dv">3</span> <span class="op">:</span> width <span class="op">&lt;</span> <span class="dv">350</span> <span class="op">?</span> <span class="dv">4</span> <span class="op">:</span> width <span class="op">&lt;</span> <span class="dv">375</span> <span class="op">?</span> <span class="dv">5</span> <span class="op">:</span> width <span class="op">&lt;</span> <span class="dv">400</span> <span class="op">?</span> <span class="dv">6</span> <span class="op">:</span> width <span class="op">&lt;</span> <span class="dv">450</span> <span class="op">?</span> <span class="dv">7</span> <span class="op">:</span> width <span class="op">&lt;</span> <span class="dv">475</span> <span class="op">?</span> <span class="dv">8</span> <span class="op">:</span> width <span class="op">&lt;</span> <span class="dv">500</span> <span class="op">?</span> <span class="dv">9</span> <span class="op">:</span> width <span class="op">&lt;</span> <span class="dv">550</span> <span class="op">?</span> <span class="dv">10</span> <span class="op">:</span> width <span class="op">&lt;</span> <span class="dv">600</span> <span class="op">?</span> <span class="dv">11</span> <span class="op">:</span> width <span class="op">&lt;</span> <span class="dv">650</span> <span class="op">?</span> <span class="dv">12</span> <span class="op">:</span> width <span class="op">&lt;</span> <span class="dv">700</span> <span class="op">?</span> <span class="dv">13</span> <span class="op">:</span> width <span class="op">&lt;</span> <span class="dv">750</span> <span class="op">?</span> <span class="dv">14</span> <span class="op">:</span> width <span class="op">&lt;</span> <span class="dv">850</span> <span class="op">?</span> <span class="dv">19</span> <span class="op">:</span> width <span class="op">&lt;</span> <span class="dv">950</span> <span class="op">?</span> <span class="dv">29</span> <span class="op">:</span> width <span class="op">&lt;</span> <span class="dv">1050</span> <span class="op">?</span> <span class="dv">29</span> <span class="op">:</span> width <span class="op">&lt;</span> <span class="dv">1150</span> <span class="op">?</span> <span class="dv">29</span> <span class="op">:</span> width <span class="op">&lt;</span> <span class="dv">1250</span> <span class="op">?</span> <span class="dv">29</span> <span class="op">:</span> width <span class="op">&lt;</span> <span class="dv">1350</span> <span class="op">?</span> <span class="dv">29</span> <span class="op">:</span> width <span class="op">&lt;</span> <span class="dv">1400</span> <span class="op">?</span> <span class="dv">33</span> <span class="op">:</span> <span class="op">-</span><span class="dv">62</span>))</span>
<span id="cb90-1497"><a href="#cb90-1497" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">"y"</span><span class="op">,</span> chartHeight <span class="op">/</span> <span class="dv">4</span> <span class="op">+</span> (width <span class="op">&lt;</span> <span class="dv">300</span> <span class="op">?</span> <span class="dv">72</span> <span class="op">:</span> width <span class="op">&lt;</span> <span class="dv">400</span> <span class="op">?</span> <span class="dv">73</span> <span class="op">:</span> width <span class="op">&lt;</span> <span class="dv">450</span> <span class="op">?</span> <span class="dv">74</span> <span class="op">:</span> width <span class="op">&lt;</span> <span class="dv">500</span> <span class="op">?</span> <span class="dv">68</span> <span class="op">:</span> width <span class="op">&lt;</span> <span class="dv">600</span> <span class="op">?</span> <span class="dv">70</span> <span class="op">:</span> width <span class="op">&lt;</span> <span class="dv">700</span> <span class="op">?</span> <span class="dv">74</span> <span class="op">:</span> width <span class="op">&lt;</span> <span class="dv">800</span> <span class="op">?</span> <span class="dv">72</span> <span class="op">:</span> width <span class="op">&lt;</span> <span class="dv">900</span> <span class="op">?</span> <span class="dv">122</span> <span class="op">:</span> width <span class="op">&lt;</span> <span class="dv">1000</span> <span class="op">?</span> <span class="dv">132</span> <span class="op">:</span> width <span class="op">&lt;</span> <span class="dv">1100</span> <span class="op">?</span> <span class="dv">142</span> <span class="op">:</span> width <span class="op">&lt;</span> <span class="dv">1200</span> <span class="op">?</span> <span class="dv">152</span> <span class="op">:</span> <span class="dv">182</span>))</span>
<span id="cb90-1498"><a href="#cb90-1498" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">"font-size"</span><span class="op">,</span> fontSize <span class="op">*</span> (width <span class="op">&lt;</span> <span class="dv">300</span> <span class="op">?</span> <span class="op">.</span><span class="dv">95</span> <span class="op">:</span> width <span class="op">&lt;</span> <span class="dv">400</span> <span class="op">?</span> <span class="dv">1</span> <span class="op">:</span> width <span class="op">&lt;</span> <span class="dv">500</span> <span class="op">?</span> <span class="fl">1.05</span> <span class="op">:</span> width <span class="op">&lt;</span> <span class="dv">600</span> <span class="op">?</span> <span class="fl">1.15</span> <span class="op">:</span> width <span class="op">&lt;</span> <span class="dv">700</span> <span class="op">?</span> <span class="fl">1.2</span> <span class="op">:</span> <span class="fl">1.25</span>) <span class="op">+</span> width <span class="op">/</span> <span class="dv">100</span>)</span>
<span id="cb90-1499"><a href="#cb90-1499" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">"font-family"</span><span class="op">,</span> <span class="st">"sans-serif"</span>)</span>
<span id="cb90-1500"><a href="#cb90-1500" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">text</span>(<span class="st">"Day"</span>)<span class="op">;</span></span>
<span id="cb90-1501"><a href="#cb90-1501" aria-hidden="true" tabindex="-1"></a>  legend</span>
<span id="cb90-1502"><a href="#cb90-1502" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">append</span>(<span class="st">"rect"</span>)</span>
<span id="cb90-1503"><a href="#cb90-1503" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">"x"</span><span class="op">,</span> chartWidth <span class="op">/</span> <span class="dv">20</span> <span class="op">+</span> (width <span class="op">&lt;</span> <span class="dv">275</span> <span class="op">?</span> <span class="op">-</span><span class="dv">59</span> <span class="op">:</span> width <span class="op">&lt;</span> <span class="dv">300</span> <span class="op">?</span> <span class="op">-</span><span class="dv">58</span> <span class="op">:</span> width <span class="op">&lt;</span> <span class="dv">325</span> <span class="op">?</span> <span class="op">-</span><span class="dv">57</span> <span class="op">:</span> width <span class="op">&lt;</span> <span class="dv">350</span> <span class="op">?</span> <span class="op">-</span><span class="dv">56</span> <span class="op">:</span> width <span class="op">&lt;</span> <span class="dv">375</span> <span class="op">?</span> <span class="op">-</span><span class="dv">55</span> <span class="op">:</span> width <span class="op">&lt;</span> <span class="dv">400</span> <span class="op">?</span> <span class="op">-</span><span class="dv">54</span> <span class="op">:</span> width <span class="op">&lt;</span> <span class="dv">450</span> <span class="op">?</span> <span class="op">-</span><span class="dv">53</span> <span class="op">:</span> width <span class="op">&lt;</span> <span class="dv">475</span> <span class="op">?</span> <span class="op">-</span><span class="dv">52</span> <span class="op">:</span> width <span class="op">&lt;</span> <span class="dv">500</span> <span class="op">?</span> <span class="op">-</span><span class="dv">51</span> <span class="op">:</span> width <span class="op">&lt;</span> <span class="dv">550</span> <span class="op">?</span> <span class="op">-</span><span class="dv">50</span> <span class="op">:</span> width <span class="op">&lt;</span> <span class="dv">600</span> <span class="op">?</span> <span class="op">-</span><span class="dv">51</span> <span class="op">:</span> width <span class="op">&lt;</span> <span class="dv">650</span> <span class="op">?</span> <span class="op">-</span><span class="dv">52</span> <span class="op">:</span> width <span class="op">&lt;</span> <span class="dv">700</span> <span class="op">?</span> <span class="op">-</span><span class="dv">53</span> <span class="op">:</span> width <span class="op">&lt;</span> <span class="dv">750</span> <span class="op">?</span> <span class="op">-</span><span class="dv">74</span> <span class="op">:</span> width <span class="op">&lt;</span> <span class="dv">850</span> <span class="op">?</span> <span class="op">-</span><span class="dv">132</span> <span class="op">:</span> width <span class="op">&lt;</span> <span class="dv">950</span> <span class="op">?</span> <span class="op">-</span><span class="dv">132</span> <span class="op">:</span> width <span class="op">&lt;</span> <span class="dv">1050</span> <span class="op">?</span> <span class="op">-</span><span class="dv">132</span> <span class="op">:</span> width <span class="op">&lt;</span> <span class="dv">1150</span> <span class="op">?</span> <span class="op">-</span><span class="dv">132</span> <span class="op">:</span> width <span class="op">&lt;</span> <span class="dv">1250</span> <span class="op">?</span> <span class="op">-</span><span class="dv">132</span> <span class="op">:</span> width <span class="op">&lt;</span> <span class="dv">1350</span> <span class="op">?</span> <span class="op">-</span><span class="dv">132</span> <span class="op">:</span> width <span class="op">&lt;</span> <span class="dv">1400</span> <span class="op">?</span> <span class="op">-</span><span class="dv">148</span> <span class="op">:</span> <span class="op">-</span><span class="dv">240</span>))</span>
<span id="cb90-1504"><a href="#cb90-1504" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">"y"</span><span class="op">,</span> chartHeight <span class="op">/</span> <span class="dv">4</span> <span class="op">+</span> (width <span class="op">&lt;</span> <span class="dv">300</span> <span class="op">?</span> <span class="dv">81</span> <span class="op">:</span> width <span class="op">&lt;</span> <span class="dv">400</span> <span class="op">?</span> <span class="dv">82</span> <span class="op">:</span> width <span class="op">&lt;</span> <span class="dv">450</span> <span class="op">?</span> <span class="dv">83</span> <span class="op">:</span> width <span class="op">&lt;</span> <span class="dv">500</span> <span class="op">?</span> <span class="dv">52</span> <span class="op">:</span> width <span class="op">&lt;</span> <span class="dv">600</span> <span class="op">?</span> <span class="dv">54</span> <span class="op">:</span> width <span class="op">&lt;</span> <span class="dv">700</span> <span class="op">?</span> <span class="dv">85</span> <span class="op">:</span> width <span class="op">&lt;</span> <span class="dv">800</span> <span class="op">?</span> <span class="dv">94</span> <span class="op">:</span> width <span class="op">&lt;</span> <span class="dv">900</span> <span class="op">?</span> <span class="dv">99</span> <span class="op">:</span> width <span class="op">&lt;</span> <span class="dv">1000</span> <span class="op">?</span> <span class="dv">109</span> <span class="op">:</span> width <span class="op">&lt;</span> <span class="dv">1100</span> <span class="op">?</span> <span class="dv">139</span> <span class="op">:</span> width <span class="op">&lt;</span> <span class="dv">1200</span> <span class="op">?</span> <span class="dv">179</span> <span class="op">:</span> <span class="dv">154</span>))</span>
<span id="cb90-1505"><a href="#cb90-1505" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">"rx"</span><span class="op">,</span> <span class="dv">5</span>)</span>
<span id="cb90-1506"><a href="#cb90-1506" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">"width"</span><span class="op">,</span> fontSize <span class="op">*</span> (width <span class="op">&lt;</span> <span class="dv">300</span> <span class="op">?</span> <span class="op">.</span><span class="dv">95</span> <span class="op">:</span> width <span class="op">&lt;</span> <span class="dv">400</span> <span class="op">?</span> <span class="dv">1</span> <span class="op">:</span> width <span class="op">&lt;</span> <span class="dv">500</span> <span class="op">?</span> <span class="fl">1.05</span> <span class="op">:</span> width <span class="op">&lt;</span> <span class="dv">600</span> <span class="op">?</span> <span class="fl">1.15</span> <span class="op">:</span> width <span class="op">&lt;</span> <span class="dv">700</span> <span class="op">?</span> <span class="fl">1.2</span> <span class="op">:</span> <span class="fl">1.25</span>) <span class="op">+</span> width <span class="op">/</span> <span class="dv">100</span>)</span>
<span id="cb90-1507"><a href="#cb90-1507" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">"height"</span><span class="op">,</span> fontSize <span class="op">*</span> (width <span class="op">&lt;</span> <span class="dv">300</span> <span class="op">?</span> <span class="op">.</span><span class="dv">95</span> <span class="op">:</span> width <span class="op">&lt;</span> <span class="dv">400</span> <span class="op">?</span> <span class="dv">1</span> <span class="op">:</span> width <span class="op">&lt;</span> <span class="dv">500</span> <span class="op">?</span> <span class="fl">1.05</span> <span class="op">:</span> width <span class="op">&lt;</span> <span class="dv">600</span> <span class="op">?</span> <span class="fl">1.15</span> <span class="op">:</span> width <span class="op">&lt;</span> <span class="dv">700</span> <span class="op">?</span> <span class="fl">1.2</span> <span class="op">:</span> <span class="fl">1.25</span>) <span class="op">+</span> width <span class="op">/</span> <span class="dv">100</span>)</span>
<span id="cb90-1508"><a href="#cb90-1508" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">"fill"</span><span class="op">,</span> mapcolors<span class="op">.</span><span class="at">night</span>)<span class="op">;</span></span>
<span id="cb90-1509"><a href="#cb90-1509" aria-hidden="true" tabindex="-1"></a>  legend</span>
<span id="cb90-1510"><a href="#cb90-1510" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">append</span>(<span class="st">"text"</span>)</span>
<span id="cb90-1511"><a href="#cb90-1511" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">"x"</span><span class="op">,</span> chartWidth <span class="op">/</span> <span class="dv">20</span> <span class="op">+</span> (width <span class="op">&lt;</span> <span class="dv">275</span> <span class="op">?</span> <span class="dv">9</span> <span class="op">:</span> width <span class="op">&lt;</span> <span class="dv">300</span> <span class="op">?</span> <span class="dv">8</span> <span class="op">:</span> width <span class="op">&lt;</span> <span class="dv">325</span> <span class="op">?</span> <span class="dv">7</span> <span class="op">:</span> width <span class="op">&lt;</span> <span class="dv">350</span> <span class="op">?</span> <span class="dv">6</span> <span class="op">:</span> width <span class="op">&lt;</span> <span class="dv">375</span> <span class="op">?</span> <span class="dv">5</span> <span class="op">:</span> width <span class="op">&lt;</span> <span class="dv">400</span> <span class="op">?</span> <span class="dv">4</span> <span class="op">:</span> width <span class="op">&lt;</span> <span class="dv">450</span> <span class="op">?</span> <span class="dv">3</span> <span class="op">:</span> width <span class="op">&lt;</span> <span class="dv">475</span> <span class="op">?</span> <span class="dv">2</span> <span class="op">:</span> width <span class="op">&lt;</span> <span class="dv">500</span> <span class="op">?</span> <span class="dv">1</span> <span class="op">:</span> width <span class="op">&lt;</span> <span class="dv">550</span> <span class="op">?</span> <span class="dv">0</span> <span class="op">:</span> width <span class="op">&lt;</span> <span class="dv">600</span> <span class="op">?</span> <span class="op">-</span><span class="dv">1</span> <span class="op">:</span> width <span class="op">&lt;</span> <span class="dv">650</span> <span class="op">?</span> <span class="op">-</span><span class="dv">2</span> <span class="op">:</span> width <span class="op">&lt;</span> <span class="dv">700</span> <span class="op">?</span> <span class="op">-</span><span class="dv">3</span> <span class="op">:</span> width <span class="op">&lt;</span> <span class="dv">750</span> <span class="op">?</span> <span class="op">-</span><span class="dv">19</span> <span class="op">:</span> width <span class="op">&lt;</span> <span class="dv">850</span> <span class="op">?</span> <span class="op">-</span><span class="dv">98</span> <span class="op">:</span> width <span class="op">&lt;</span> <span class="dv">950</span> <span class="op">?</span> <span class="op">-</span><span class="dv">98</span> <span class="op">:</span> width <span class="op">&lt;</span> <span class="dv">1050</span> <span class="op">?</span> <span class="op">-</span><span class="dv">98</span> <span class="op">:</span> width <span class="op">&lt;</span> <span class="dv">1150</span> <span class="op">?</span> <span class="op">-</span><span class="dv">98</span> <span class="op">:</span> width <span class="op">&lt;</span> <span class="dv">1250</span> <span class="op">?</span> <span class="op">-</span><span class="dv">98</span> <span class="op">:</span> width <span class="op">&lt;</span> <span class="dv">1350</span> <span class="op">?</span> <span class="op">-</span><span class="dv">98</span> <span class="op">:</span> width <span class="op">&lt;</span> <span class="dv">1400</span> <span class="op">?</span> <span class="op">-</span><span class="dv">108</span> <span class="op">:</span> <span class="op">-</span><span class="dv">201</span>))</span>
<span id="cb90-1512"><a href="#cb90-1512" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">"y"</span><span class="op">,</span> chartHeight <span class="op">/</span> <span class="dv">4</span> <span class="op">+</span> (width <span class="op">&lt;</span> <span class="dv">300</span> <span class="op">?</span> <span class="dv">72</span> <span class="op">:</span> width <span class="op">&lt;</span> <span class="dv">400</span> <span class="op">?</span> <span class="dv">73</span> <span class="op">:</span> width <span class="op">&lt;</span> <span class="dv">450</span> <span class="op">?</span> <span class="dv">74</span> <span class="op">:</span> width <span class="op">&lt;</span> <span class="dv">500</span> <span class="op">?</span> <span class="dv">68</span> <span class="op">:</span> width <span class="op">&lt;</span> <span class="dv">600</span> <span class="op">?</span> <span class="dv">70</span> <span class="op">:</span> width <span class="op">&lt;</span> <span class="dv">700</span> <span class="op">?</span> <span class="dv">74</span> <span class="op">:</span> width <span class="op">&lt;</span> <span class="dv">800</span> <span class="op">?</span> <span class="dv">72</span> <span class="op">:</span> width <span class="op">&lt;</span> <span class="dv">900</span> <span class="op">?</span> <span class="dv">122</span> <span class="op">:</span> width <span class="op">&lt;</span> <span class="dv">1000</span> <span class="op">?</span> <span class="dv">132</span> <span class="op">:</span> width <span class="op">&lt;</span> <span class="dv">1100</span> <span class="op">?</span> <span class="dv">142</span> <span class="op">:</span> width <span class="op">&lt;</span> <span class="dv">1200</span> <span class="op">?</span> <span class="dv">152</span> <span class="op">:</span> <span class="dv">182</span>))</span>
<span id="cb90-1513"><a href="#cb90-1513" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">"font-size"</span><span class="op">,</span> fontSize <span class="op">*</span> (width <span class="op">&lt;</span> <span class="dv">300</span> <span class="op">?</span> <span class="op">.</span><span class="dv">95</span> <span class="op">:</span> width <span class="op">&lt;</span> <span class="dv">400</span> <span class="op">?</span> <span class="dv">1</span> <span class="op">:</span> width <span class="op">&lt;</span> <span class="dv">500</span> <span class="op">?</span> <span class="fl">1.05</span> <span class="op">:</span> width <span class="op">&lt;</span> <span class="dv">600</span> <span class="op">?</span> <span class="fl">1.15</span> <span class="op">:</span> width <span class="op">&lt;</span> <span class="dv">700</span> <span class="op">?</span> <span class="fl">1.2</span> <span class="op">:</span> <span class="fl">1.25</span>) <span class="op">+</span> width <span class="op">/</span> <span class="dv">100</span>)</span>
<span id="cb90-1514"><a href="#cb90-1514" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">"font-family"</span><span class="op">,</span> <span class="st">"sans-serif"</span>)</span>
<span id="cb90-1515"><a href="#cb90-1515" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">text</span>(<span class="st">"Night"</span>)<span class="op">;</span></span>
<span id="cb90-1516"><a href="#cb90-1516" aria-hidden="true" tabindex="-1"></a>  <span class="co">/* Time and date controls */</span></span>
<span id="cb90-1517"><a href="#cb90-1517" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> dateLine <span class="op">=</span> <span class="bu">root</span><span class="op">.</span><span class="fu">append</span>(<span class="st">"g"</span>)<span class="op">;</span></span>
<span id="cb90-1518"><a href="#cb90-1518" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> updateControlPositions <span class="op">=</span> () <span class="kw">=&gt;</span> {</span>
<span id="cb90-1519"><a href="#cb90-1519" aria-hidden="true" tabindex="-1"></a>    dateLine</span>
<span id="cb90-1520"><a href="#cb90-1520" aria-hidden="true" tabindex="-1"></a>      <span class="op">.</span><span class="fu">select</span>(<span class="st">"line"</span>)</span>
<span id="cb90-1521"><a href="#cb90-1521" aria-hidden="true" tabindex="-1"></a>      <span class="op">.</span><span class="fu">attr</span>(<span class="st">"y1"</span><span class="op">,</span> <span class="fu">yScale</span>(<span class="dv">0</span>))</span>
<span id="cb90-1522"><a href="#cb90-1522" aria-hidden="true" tabindex="-1"></a>      <span class="op">.</span><span class="fu">attr</span>(<span class="st">"x1"</span><span class="op">,</span> <span class="fu">xScale</span>(date))</span>
<span id="cb90-1523"><a href="#cb90-1523" aria-hidden="true" tabindex="-1"></a>      <span class="op">.</span><span class="fu">attr</span>(<span class="st">"y2"</span><span class="op">,</span> <span class="fu">yScale</span>(<span class="dv">24</span>))</span>
<span id="cb90-1524"><a href="#cb90-1524" aria-hidden="true" tabindex="-1"></a>      <span class="op">.</span><span class="fu">attr</span>(<span class="st">"x2"</span><span class="op">,</span> <span class="fu">xScale</span>(date))<span class="op">;</span></span>
<span id="cb90-1525"><a href="#cb90-1525" aria-hidden="true" tabindex="-1"></a>    dateLine</span>
<span id="cb90-1526"><a href="#cb90-1526" aria-hidden="true" tabindex="-1"></a>      <span class="op">.</span><span class="fu">select</span>(<span class="st">"rect"</span>)</span>
<span id="cb90-1527"><a href="#cb90-1527" aria-hidden="true" tabindex="-1"></a>      <span class="op">.</span><span class="fu">attr</span>(<span class="st">"y"</span><span class="op">,</span> <span class="fu">yScale</span>(<span class="dv">0</span>))</span>
<span id="cb90-1528"><a href="#cb90-1528" aria-hidden="true" tabindex="-1"></a>      <span class="op">.</span><span class="fu">attr</span>(<span class="st">"x"</span><span class="op">,</span> <span class="fu">xScale</span>(date) <span class="op">-</span> <span class="dv">4</span>)<span class="op">;</span></span>
<span id="cb90-1529"><a href="#cb90-1529" aria-hidden="true" tabindex="-1"></a>    <span class="bu">root</span></span>
<span id="cb90-1530"><a href="#cb90-1530" aria-hidden="true" tabindex="-1"></a>      <span class="op">.</span><span class="fu">select</span>(<span class="st">"#time-control"</span>)</span>
<span id="cb90-1531"><a href="#cb90-1531" aria-hidden="true" tabindex="-1"></a>      <span class="op">.</span><span class="fu">attr</span>(<span class="st">"cy"</span><span class="op">,</span> <span class="fu">yScale</span>(hour))</span>
<span id="cb90-1532"><a href="#cb90-1532" aria-hidden="true" tabindex="-1"></a>      <span class="op">.</span><span class="fu">attr</span>(<span class="st">"cx"</span><span class="op">,</span> <span class="fu">xScale</span>(date))<span class="op">;</span></span>
<span id="cb90-1533"><a href="#cb90-1533" aria-hidden="true" tabindex="-1"></a>  }<span class="op">;</span></span>
<span id="cb90-1534"><a href="#cb90-1534" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> dispatchDateHourChange <span class="op">=</span> () <span class="kw">=&gt;</span> {</span>
<span id="cb90-1535"><a href="#cb90-1535" aria-hidden="true" tabindex="-1"></a>    <span class="kw">const</span> detail <span class="op">=</span> { date<span class="op">,</span> hour }<span class="op">;</span></span>
<span id="cb90-1536"><a href="#cb90-1536" aria-hidden="true" tabindex="-1"></a>    <span class="kw">const</span> changeEvent <span class="op">=</span> <span class="kw">new</span> <span class="bu">CustomEvent</span>(EventType<span class="op">.</span><span class="at">DateHourChange</span><span class="op">,</span> {</span>
<span id="cb90-1537"><a href="#cb90-1537" aria-hidden="true" tabindex="-1"></a>      detail<span class="op">,</span></span>
<span id="cb90-1538"><a href="#cb90-1538" aria-hidden="true" tabindex="-1"></a>      <span class="dt">bubbles</span><span class="op">:</span> <span class="kw">true</span></span>
<span id="cb90-1539"><a href="#cb90-1539" aria-hidden="true" tabindex="-1"></a>    })<span class="op">;</span></span>
<span id="cb90-1540"><a href="#cb90-1540" aria-hidden="true" tabindex="-1"></a>    <span class="bu">root</span><span class="op">.</span><span class="fu">node</span>()<span class="op">.</span><span class="fu">dispatchEvent</span>(changeEvent)<span class="op">;</span></span>
<span id="cb90-1541"><a href="#cb90-1541" aria-hidden="true" tabindex="-1"></a>  }<span class="op">;</span></span>
<span id="cb90-1542"><a href="#cb90-1542" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> handleDateLineDrag <span class="op">=</span> ({ x }) <span class="kw">=&gt;</span> {</span>
<span id="cb90-1543"><a href="#cb90-1543" aria-hidden="true" tabindex="-1"></a>    date <span class="op">=</span> xScale<span class="op">.</span><span class="fu">invert</span>(x)<span class="op">;</span></span>
<span id="cb90-1544"><a href="#cb90-1544" aria-hidden="true" tabindex="-1"></a>    <span class="fu">updateControlPositions</span>()<span class="op">;</span></span>
<span id="cb90-1545"><a href="#cb90-1545" aria-hidden="true" tabindex="-1"></a>    <span class="fu">dispatchDateHourChange</span>()<span class="op">;</span></span>
<span id="cb90-1546"><a href="#cb90-1546" aria-hidden="true" tabindex="-1"></a>  }<span class="op">;</span></span>
<span id="cb90-1547"><a href="#cb90-1547" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> handleTimeCircleDrag <span class="op">=</span> ({ y }) <span class="kw">=&gt;</span> {</span>
<span id="cb90-1548"><a href="#cb90-1548" aria-hidden="true" tabindex="-1"></a>    hour <span class="op">=</span> yScale<span class="op">.</span><span class="fu">invert</span>(y)<span class="op">;</span></span>
<span id="cb90-1549"><a href="#cb90-1549" aria-hidden="true" tabindex="-1"></a>    <span class="fu">updateControlPositions</span>()<span class="op">;</span></span>
<span id="cb90-1550"><a href="#cb90-1550" aria-hidden="true" tabindex="-1"></a>    <span class="fu">dispatchDateHourChange</span>()<span class="op">;</span></span>
<span id="cb90-1551"><a href="#cb90-1551" aria-hidden="true" tabindex="-1"></a>  }<span class="op">;</span></span>
<span id="cb90-1552"><a href="#cb90-1552" aria-hidden="true" tabindex="-1"></a>  dateLine<span class="op">.</span><span class="fu">append</span>(<span class="st">"line"</span>)<span class="op">.</span><span class="fu">attr</span>(<span class="st">"stroke-width"</span><span class="op">,</span> <span class="dv">4</span>)<span class="op">.</span><span class="fu">attr</span>(<span class="st">"stroke"</span><span class="op">,</span> <span class="st">"red"</span>)<span class="op">;</span></span>
<span id="cb90-1553"><a href="#cb90-1553" aria-hidden="true" tabindex="-1"></a>  dateLine</span>
<span id="cb90-1554"><a href="#cb90-1554" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">append</span>(<span class="st">"rect"</span>)</span>
<span id="cb90-1555"><a href="#cb90-1555" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">"height"</span><span class="op">,</span> chartWidth)</span>
<span id="cb90-1556"><a href="#cb90-1556" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">"width"</span><span class="op">,</span> <span class="dv">8</span>)</span>
<span id="cb90-1557"><a href="#cb90-1557" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">"fill"</span><span class="op">,</span> <span class="st">"rgba(0, 0, 0, 0)"</span>)</span>
<span id="cb90-1558"><a href="#cb90-1558" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">style</span>(<span class="st">"cursor"</span><span class="op">,</span> <span class="st">"row-resize"</span>)</span>
<span id="cb90-1559"><a href="#cb90-1559" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">call</span>(d3<span class="op">.</span><span class="fu">drag</span>()<span class="op">.</span><span class="fu">on</span>(<span class="st">"drag"</span><span class="op">,</span> handleDateLineDrag))<span class="op">;</span></span>
<span id="cb90-1560"><a href="#cb90-1560" aria-hidden="true" tabindex="-1"></a>  <span class="bu">root</span></span>
<span id="cb90-1561"><a href="#cb90-1561" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">append</span>(<span class="st">"circle"</span>)</span>
<span id="cb90-1562"><a href="#cb90-1562" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">"id"</span><span class="op">,</span> <span class="st">"time-control"</span>)</span>
<span id="cb90-1563"><a href="#cb90-1563" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">"r"</span><span class="op">,</span> <span class="dv">12</span>)</span>
<span id="cb90-1564"><a href="#cb90-1564" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">"fill"</span><span class="op">,</span> <span class="st">"red"</span>)</span>
<span id="cb90-1565"><a href="#cb90-1565" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">"stroke-width"</span><span class="op">,</span> <span class="op">.</span><span class="dv">6</span>)</span>
<span id="cb90-1566"><a href="#cb90-1566" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">"stroke"</span><span class="op">,</span> <span class="st">"black"</span>)</span>
<span id="cb90-1567"><a href="#cb90-1567" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">style</span>(<span class="st">"cursor"</span><span class="op">,</span> <span class="st">"pointer"</span>)</span>
<span id="cb90-1568"><a href="#cb90-1568" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">call</span>(d3<span class="op">.</span><span class="fu">drag</span>()<span class="op">.</span><span class="fu">on</span>(<span class="st">"drag"</span><span class="op">,</span> handleTimeCircleDrag))<span class="op">;</span></span>
<span id="cb90-1569"><a href="#cb90-1569" aria-hidden="true" tabindex="-1"></a>  <span class="fu">updateControlPositions</span>()<span class="op">;</span></span>
<span id="cb90-1570"><a href="#cb90-1570" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb90-1571"><a href="#cb90-1571" aria-hidden="true" tabindex="-1"></a>fontSize <span class="op">=</span> <span class="dv">14</span><span class="op">;</span></span>
<span id="cb90-1572"><a href="#cb90-1572" aria-hidden="true" tabindex="-1"></a>getSolarAngle <span class="op">=</span> (date) <span class="kw">=&gt;</span> (<span class="fu">dayOfYear</span>(date) <span class="op">+</span> <span class="dv">10</span>) <span class="op">/</span> <span class="dv">365</span> <span class="op">*</span> <span class="bu">Math</span><span class="op">.</span><span class="cn">PI</span> <span class="op">*</span> <span class="dv">2</span> <span class="op">-</span> <span class="bu">Math</span><span class="op">.</span><span class="cn">PI</span> <span class="op">/</span> <span class="dv">2</span><span class="op">;</span></span>
<span id="cb90-1573"><a href="#cb90-1573" aria-hidden="true" tabindex="-1"></a><span class="co">/*</span></span>
<span id="cb90-1574"><a href="#cb90-1574" aria-hidden="true" tabindex="-1"></a><span class="co"> * Formulas uses the CBM model as reviewed here:</span></span>
<span id="cb90-1575"><a href="#cb90-1575" aria-hidden="true" tabindex="-1"></a><span class="co"> * https://www.ikhebeenvraag.be/mediastorage/FSDocument/171/Forsythe+-+A+model+comparison+for+daylength+as+a+function+of+latitude+and+day+of+year+-+1995.pdf</span></span>
<span id="cb90-1576"><a href="#cb90-1576" aria-hidden="true" tabindex="-1"></a><span class="co"> */</span></span>
<span id="cb90-1577"><a href="#cb90-1577" aria-hidden="true" tabindex="-1"></a>dayLength <span class="op">=</span> (date<span class="op">,</span> latitude) <span class="kw">=&gt;</span> {</span>
<span id="cb90-1578"><a href="#cb90-1578" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> yearStart <span class="op">=</span> <span class="kw">new</span> <span class="bu">Date</span>(date<span class="op">.</span><span class="fu">getFullYear</span>()<span class="op">,</span> <span class="dv">0</span><span class="op">,</span> <span class="dv">1</span>)<span class="op">;</span></span>
<span id="cb90-1579"><a href="#cb90-1579" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> dayOfYear <span class="op">=</span> <span class="bu">Math</span><span class="op">.</span><span class="fu">floor</span>((date<span class="op">.</span><span class="fu">getTime</span>() <span class="op">-</span> yearStart<span class="op">.</span><span class="fu">getTime</span>())<span class="op">/</span><span class="dv">86400000</span>) <span class="op">+</span> <span class="dv">1</span><span class="op">;</span></span>
<span id="cb90-1580"><a href="#cb90-1580" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> revAngle <span class="op">=</span> <span class="fl">0.2163108</span> <span class="op">+</span> <span class="dv">2</span> <span class="op">*</span> <span class="bu">Math</span><span class="op">.</span><span class="fu">atan</span>(<span class="fl">0.9671396</span> <span class="op">*</span> <span class="bu">Math</span><span class="op">.</span><span class="fu">tan</span>(<span class="fl">0.00860</span> <span class="op">*</span> (dayOfYear <span class="op">-</span> <span class="dv">186</span>)))<span class="op">;</span></span>
<span id="cb90-1581"><a href="#cb90-1581" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> decAngle <span class="op">=</span> <span class="bu">Math</span><span class="op">.</span><span class="fu">asin</span>(<span class="fl">0.39795</span> <span class="op">*</span> <span class="bu">Math</span><span class="op">.</span><span class="fu">cos</span>(revAngle))<span class="op">;</span></span>
<span id="cb90-1582"><a href="#cb90-1582" aria-hidden="true" tabindex="-1"></a>  <span class="co">/* daylight coefficient selected for apparent sunrise/sunset */</span></span>
<span id="cb90-1583"><a href="#cb90-1583" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> p <span class="op">=</span> <span class="fl">0.8333</span></span>
<span id="cb90-1584"><a href="#cb90-1584" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> intResult <span class="op">=</span></span>
<span id="cb90-1585"><a href="#cb90-1585" aria-hidden="true" tabindex="-1"></a>    (<span class="bu">Math</span><span class="op">.</span><span class="fu">sin</span>((p <span class="op">*</span> <span class="bu">Math</span><span class="op">.</span><span class="cn">PI</span>) <span class="op">/</span> <span class="dv">180</span>) <span class="op">+</span></span>
<span id="cb90-1586"><a href="#cb90-1586" aria-hidden="true" tabindex="-1"></a>      <span class="bu">Math</span><span class="op">.</span><span class="fu">sin</span>((latitude <span class="op">*</span> <span class="bu">Math</span><span class="op">.</span><span class="cn">PI</span>) <span class="op">/</span> <span class="dv">180</span>) <span class="op">*</span> <span class="bu">Math</span><span class="op">.</span><span class="fu">sin</span>(decAngle)) <span class="op">/</span></span>
<span id="cb90-1587"><a href="#cb90-1587" aria-hidden="true" tabindex="-1"></a>    (<span class="bu">Math</span><span class="op">.</span><span class="fu">cos</span>((latitude <span class="op">*</span> <span class="bu">Math</span><span class="op">.</span><span class="cn">PI</span>) <span class="op">/</span> <span class="dv">180</span>) <span class="op">*</span> <span class="bu">Math</span><span class="op">.</span><span class="fu">cos</span>(decAngle))<span class="op">;</span></span>
<span id="cb90-1588"><a href="#cb90-1588" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (intResult <span class="op">&gt;=</span> <span class="dv">1</span>) <span class="cf">return</span> <span class="dv">24</span><span class="op">;</span></span>
<span id="cb90-1589"><a href="#cb90-1589" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (intResult <span class="op">&lt;=</span> <span class="op">-</span><span class="dv">1</span>) <span class="cf">return</span> <span class="dv">0</span><span class="op">;</span></span>
<span id="cb90-1590"><a href="#cb90-1590" aria-hidden="true" tabindex="-1"></a>  <span class="cf">return</span> <span class="dv">24</span> <span class="op">-</span> <span class="dv">24</span> <span class="op">*</span> <span class="bu">Math</span><span class="op">.</span><span class="fu">acos</span>(intResult) <span class="op">/</span> <span class="bu">Math</span><span class="op">.</span><span class="cn">PI</span><span class="op">;</span></span>
<span id="cb90-1591"><a href="#cb90-1591" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb90-1592"><a href="#cb90-1592" aria-hidden="true" tabindex="-1"></a>yearDates <span class="op">=</span> (year) <span class="kw">=&gt;</span> {</span>
<span id="cb90-1593"><a href="#cb90-1593" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> startDate <span class="op">=</span> <span class="kw">new</span> <span class="bu">Date</span>(year<span class="op">,</span> <span class="dv">0</span><span class="op">,</span> <span class="dv">1</span><span class="op">+</span><span class="dv">60</span>)<span class="op">;</span></span>
<span id="cb90-1594"><a href="#cb90-1594" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> endDate <span class="op">=</span> <span class="kw">new</span> <span class="bu">Date</span>(year <span class="op">+</span> <span class="dv">1</span><span class="op">,</span> <span class="dv">0</span><span class="op">,</span> <span class="dv">1</span><span class="op">+</span><span class="dv">60</span>)<span class="op">;</span></span>
<span id="cb90-1595"><a href="#cb90-1595" aria-hidden="true" tabindex="-1"></a>  <span class="cf">return</span> d3<span class="op">.</span><span class="at">timeDay</span><span class="op">.</span><span class="fu">range</span>(startDate<span class="op">,</span> endDate)<span class="op">;</span></span>
<span id="cb90-1596"><a href="#cb90-1596" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb90-1597"><a href="#cb90-1597" aria-hidden="true" tabindex="-1"></a>height <span class="op">=</span> {</span>
<span id="cb90-1598"><a href="#cb90-1598" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> [[x0<span class="op">,</span> y0]<span class="op">,</span> [x1<span class="op">,</span> y1]] <span class="op">=</span> d3<span class="op">.</span><span class="fu">geoPath</span>(projection<span class="op">.</span><span class="fu">fitWidth</span>(width<span class="op">,</span> sphere))<span class="op">.</span><span class="fu">bounds</span>(sphere)<span class="op">;</span></span>
<span id="cb90-1599"><a href="#cb90-1599" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> dy <span class="op">=</span> <span class="bu">Math</span><span class="op">.</span><span class="fu">ceil</span>(y1 <span class="op">-</span> y0)<span class="op">,</span> l <span class="op">=</span> <span class="bu">Math</span><span class="op">.</span><span class="fu">min</span>(<span class="bu">Math</span><span class="op">.</span><span class="fu">ceil</span>(x1 <span class="op">-</span> x0)<span class="op">,</span> dy)<span class="op">;</span></span>
<span id="cb90-1600"><a href="#cb90-1600" aria-hidden="true" tabindex="-1"></a>  projection<span class="op">.</span><span class="fu">scale</span>(projection<span class="op">.</span><span class="fu">scale</span>() <span class="op">*</span> (l <span class="op">-</span> <span class="dv">1</span>) <span class="op">/</span> l)<span class="op">.</span><span class="fu">precision</span>(<span class="fl">0.2</span>)<span class="op">;</span></span>
<span id="cb90-1601"><a href="#cb90-1601" aria-hidden="true" tabindex="-1"></a>  <span class="cf">return</span> dy<span class="op">;</span></span>
<span id="cb90-1602"><a href="#cb90-1602" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb90-1603"><a href="#cb90-1603" aria-hidden="true" tabindex="-1"></a>sphere <span class="op">=</span> ({<span class="dt">type</span><span class="op">:</span> <span class="st">"Sphere"</span>})</span>
<span id="cb90-1604"><a href="#cb90-1604" aria-hidden="true" tabindex="-1"></a>selectedProjection <span class="op">=</span> select <span class="op">?</span> select<span class="op">.</span><span class="fu">value</span>() <span class="op">:</span> d3<span class="op">.</span><span class="fu">geoEquirectangular</span>()</span>
<span id="cb90-1605"><a href="#cb90-1605" aria-hidden="true" tabindex="-1"></a>projection <span class="op">=</span> {</span>
<span id="cb90-1606"><a href="#cb90-1606" aria-hidden="true" tabindex="-1"></a>  <span class="kw">let</span> proj <span class="op">=</span> selectedProjection<span class="op">;</span></span>
<span id="cb90-1607"><a href="#cb90-1607" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (proj<span class="op">.</span><span class="at">rotate</span>) proj<span class="op">.</span><span class="fu">rotate</span>([<span class="op">-</span><span class="fu">turn2long</span>(yaw)<span class="op">,</span> <span class="op">-</span><span class="fu">turn2degr</span>(pitch)<span class="op">,</span> <span class="fu">turn2degr</span>(roll)])<span class="op">;</span></span>
<span id="cb90-1608"><a href="#cb90-1608" aria-hidden="true" tabindex="-1"></a>  <span class="cf">return</span> proj<span class="op">;</span></span>
<span id="cb90-1609"><a href="#cb90-1609" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb90-1610"><a href="#cb90-1610" aria-hidden="true" tabindex="-1"></a><span class="co">// https://observablehq.com/@fil/d3-projections</span></span>
<span id="cb90-1611"><a href="#cb90-1611" aria-hidden="true" tabindex="-1"></a>projections <span class="op">=</span> [</span>
<span id="cb90-1612"><a href="#cb90-1612" aria-hidden="true" tabindex="-1"></a>  { <span class="dt">name</span><span class="op">:</span> <span class="st">"Airocean"</span><span class="op">,</span> <span class="dt">value</span><span class="op">:</span> d3<span class="op">.</span><span class="at">geoAirocean</span> }<span class="op">,</span></span>
<span id="cb90-1613"><a href="#cb90-1613" aria-hidden="true" tabindex="-1"></a>  { <span class="dt">name</span><span class="op">:</span> <span class="st">"Airy’s minimum error"</span><span class="op">,</span> <span class="dt">value</span><span class="op">:</span> d3<span class="op">.</span><span class="at">geoAiry</span> }<span class="op">,</span></span>
<span id="cb90-1614"><a href="#cb90-1614" aria-hidden="true" tabindex="-1"></a>  { <span class="dt">name</span><span class="op">:</span> <span class="st">"Aitoff"</span><span class="op">,</span> <span class="dt">value</span><span class="op">:</span> d3<span class="op">.</span><span class="at">geoAitoff</span> }<span class="op">,</span></span>
<span id="cb90-1615"><a href="#cb90-1615" aria-hidden="true" tabindex="-1"></a>  { <span class="dt">name</span><span class="op">:</span> <span class="st">"American polyconic"</span><span class="op">,</span> <span class="dt">value</span><span class="op">:</span> d3<span class="op">.</span><span class="at">geoPolyconic</span> }<span class="op">,</span></span>
<span id="cb90-1616"><a href="#cb90-1616" aria-hidden="true" tabindex="-1"></a>  { <span class="dt">name</span><span class="op">:</span> <span class="st">"Armadillo"</span><span class="op">,</span> <span class="dt">value</span><span class="op">:</span> d3<span class="op">.</span><span class="at">geoArmadillo</span><span class="op">,</span> <span class="dt">options</span><span class="op">:</span> { <span class="dt">clip</span><span class="op">:</span> { <span class="dt">type</span><span class="op">:</span> <span class="st">"Sphere"</span> } } }<span class="op">,</span></span>
<span id="cb90-1617"><a href="#cb90-1617" aria-hidden="true" tabindex="-1"></a>  { <span class="dt">name</span><span class="op">:</span> <span class="st">"August"</span><span class="op">,</span> <span class="dt">value</span><span class="op">:</span> d3<span class="op">.</span><span class="at">geoAugust</span> }<span class="op">,</span></span>
<span id="cb90-1618"><a href="#cb90-1618" aria-hidden="true" tabindex="-1"></a>  { <span class="dt">name</span><span class="op">:</span> <span class="st">"azimuthal equal-area"</span><span class="op">,</span> <span class="dt">value</span><span class="op">:</span> d3<span class="op">.</span><span class="at">geoAzimuthalEqualArea</span> }<span class="op">,</span></span>
<span id="cb90-1619"><a href="#cb90-1619" aria-hidden="true" tabindex="-1"></a>  { <span class="dt">name</span><span class="op">:</span> <span class="st">"azimuthal equidistant"</span><span class="op">,</span> <span class="dt">value</span><span class="op">:</span> d3<span class="op">.</span><span class="at">geoAzimuthalEquidistant</span> }<span class="op">,</span></span>
<span id="cb90-1620"><a href="#cb90-1620" aria-hidden="true" tabindex="-1"></a>  { <span class="dt">name</span><span class="op">:</span> <span class="st">"Baker dinomic"</span><span class="op">,</span> <span class="dt">value</span><span class="op">:</span> d3<span class="op">.</span><span class="at">geoBaker</span> }<span class="op">,</span></span>
<span id="cb90-1621"><a href="#cb90-1621" aria-hidden="true" tabindex="-1"></a>  { <span class="dt">name</span><span class="op">:</span> <span class="st">"Berghaus’ star"</span><span class="op">,</span> <span class="dt">value</span><span class="op">:</span> d3<span class="op">.</span><span class="at">geoBerghaus</span><span class="op">,</span> <span class="dt">options</span><span class="op">:</span> { <span class="dt">clip</span><span class="op">:</span> { <span class="dt">type</span><span class="op">:</span> <span class="st">"Sphere"</span> } } }<span class="op">,</span></span>
<span id="cb90-1622"><a href="#cb90-1622" aria-hidden="true" tabindex="-1"></a>  { <span class="dt">name</span><span class="op">:</span> <span class="st">"Bertin’s 1953"</span><span class="op">,</span> <span class="dt">value</span><span class="op">:</span> d3<span class="op">.</span><span class="at">geoBertin1953</span> }<span class="op">,</span></span>
<span id="cb90-1623"><a href="#cb90-1623" aria-hidden="true" tabindex="-1"></a>  { <span class="dt">name</span><span class="op">:</span> <span class="st">"Boggs’ eumorphic"</span><span class="op">,</span> <span class="dt">value</span><span class="op">:</span> d3<span class="op">.</span><span class="at">geoBoggs</span> }<span class="op">,</span></span>
<span id="cb90-1624"><a href="#cb90-1624" aria-hidden="true" tabindex="-1"></a>  { <span class="dt">name</span><span class="op">:</span> <span class="st">"Boggs’ eumorphic (interrupted)"</span><span class="op">,</span> <span class="dt">value</span><span class="op">:</span> d3<span class="op">.</span><span class="at">geoInterruptedBoggs</span><span class="op">,</span> <span class="dt">options</span><span class="op">:</span> { <span class="dt">clip</span><span class="op">:</span> { <span class="dt">type</span><span class="op">:</span> <span class="st">"Sphere"</span> } } }<span class="op">,</span></span>
<span id="cb90-1625"><a href="#cb90-1625" aria-hidden="true" tabindex="-1"></a>  { <span class="dt">name</span><span class="op">:</span> <span class="st">"Bonne"</span><span class="op">,</span> <span class="dt">value</span><span class="op">:</span> d3<span class="op">.</span><span class="at">geoBonne</span> }<span class="op">,</span></span>
<span id="cb90-1626"><a href="#cb90-1626" aria-hidden="true" tabindex="-1"></a>  { <span class="dt">name</span><span class="op">:</span> <span class="st">"Bottomley"</span><span class="op">,</span> <span class="dt">value</span><span class="op">:</span> d3<span class="op">.</span><span class="at">geoBottomley</span> }<span class="op">,</span></span>
<span id="cb90-1627"><a href="#cb90-1627" aria-hidden="true" tabindex="-1"></a>  { <span class="dt">name</span><span class="op">:</span> <span class="st">"Bromley"</span><span class="op">,</span> <span class="dt">value</span><span class="op">:</span> d3<span class="op">.</span><span class="at">geoBromley</span> }<span class="op">,</span></span>
<span id="cb90-1628"><a href="#cb90-1628" aria-hidden="true" tabindex="-1"></a>  { <span class="dt">name</span><span class="op">:</span> <span class="st">"Butterfly (gnomonic)"</span><span class="op">,</span> <span class="dt">value</span><span class="op">:</span> d3<span class="op">.</span><span class="at">geoPolyhedralButterfly</span> }<span class="op">,</span></span>
<span id="cb90-1629"><a href="#cb90-1629" aria-hidden="true" tabindex="-1"></a>  { <span class="dt">name</span><span class="op">:</span> <span class="st">"Butterfly (Collignon)"</span><span class="op">,</span> <span class="dt">value</span><span class="op">:</span> d3<span class="op">.</span><span class="at">geoPolyhedralCollignon</span> }<span class="op">,</span></span>
<span id="cb90-1630"><a href="#cb90-1630" aria-hidden="true" tabindex="-1"></a>  { <span class="dt">name</span><span class="op">:</span> <span class="st">"Butterfly (Waterman)"</span><span class="op">,</span> <span class="dt">value</span><span class="op">:</span> d3<span class="op">.</span><span class="at">geoPolyhedralWaterman</span> }<span class="op">,</span></span>
<span id="cb90-1631"><a href="#cb90-1631" aria-hidden="true" tabindex="-1"></a>  { <span class="dt">name</span><span class="op">:</span> <span class="st">"Cahill-Keyes"</span><span class="op">,</span> <span class="dt">value</span><span class="op">:</span> d3<span class="op">.</span><span class="at">geoCahillKeyes</span> }<span class="op">,</span></span>
<span id="cb90-1632"><a href="#cb90-1632" aria-hidden="true" tabindex="-1"></a>  { <span class="dt">name</span><span class="op">:</span> <span class="st">"Collignon"</span><span class="op">,</span> <span class="dt">value</span><span class="op">:</span> d3<span class="op">.</span><span class="at">geoCollignon</span> }<span class="op">,</span></span>
<span id="cb90-1633"><a href="#cb90-1633" aria-hidden="true" tabindex="-1"></a>  { <span class="dt">name</span><span class="op">:</span> <span class="st">"conic equal-area"</span><span class="op">,</span> <span class="dt">value</span><span class="op">:</span> d3<span class="op">.</span><span class="at">geoConicEqualArea</span> }<span class="op">,</span></span>
<span id="cb90-1634"><a href="#cb90-1634" aria-hidden="true" tabindex="-1"></a>  { <span class="dt">name</span><span class="op">:</span> <span class="st">"conic equidistant"</span><span class="op">,</span> <span class="dt">value</span><span class="op">:</span> d3<span class="op">.</span><span class="at">geoConicEquidistant</span> }<span class="op">,</span></span>
<span id="cb90-1635"><a href="#cb90-1635" aria-hidden="true" tabindex="-1"></a>  { <span class="dt">name</span><span class="op">:</span> <span class="st">"Craig retroazimuthal"</span><span class="op">,</span> <span class="dt">value</span><span class="op">:</span> d3<span class="op">.</span><span class="at">geoCraig</span> }<span class="op">,</span></span>
<span id="cb90-1636"><a href="#cb90-1636" aria-hidden="true" tabindex="-1"></a>  { <span class="dt">name</span><span class="op">:</span> <span class="st">"Craster parabolic"</span><span class="op">,</span> <span class="dt">value</span><span class="op">:</span> d3<span class="op">.</span><span class="at">geoCraster</span> }<span class="op">,</span></span>
<span id="cb90-1637"><a href="#cb90-1637" aria-hidden="true" tabindex="-1"></a>  { <span class="dt">name</span><span class="op">:</span> <span class="st">"Cox"</span><span class="op">,</span> <span class="dt">value</span><span class="op">:</span> d3<span class="op">.</span><span class="at">geoCox</span> }<span class="op">,</span></span>
<span id="cb90-1638"><a href="#cb90-1638" aria-hidden="true" tabindex="-1"></a>  { <span class="dt">name</span><span class="op">:</span> <span class="st">"cubic"</span><span class="op">,</span> <span class="dt">value</span><span class="op">:</span> d3<span class="op">.</span><span class="at">geoCubic</span> }<span class="op">,</span></span>
<span id="cb90-1639"><a href="#cb90-1639" aria-hidden="true" tabindex="-1"></a>  { <span class="dt">name</span><span class="op">:</span> <span class="st">"cylindrical equal-area"</span><span class="op">,</span> <span class="dt">value</span><span class="op">:</span> d3<span class="op">.</span><span class="at">geoCylindricalEqualArea</span> }<span class="op">,</span></span>
<span id="cb90-1640"><a href="#cb90-1640" aria-hidden="true" tabindex="-1"></a>  { <span class="dt">name</span><span class="op">:</span> <span class="st">"cylindrical stereographic"</span><span class="op">,</span> <span class="dt">value</span><span class="op">:</span> d3<span class="op">.</span><span class="at">geoCylindricalStereographic</span> }<span class="op">,</span></span>
<span id="cb90-1641"><a href="#cb90-1641" aria-hidden="true" tabindex="-1"></a>  { <span class="dt">name</span><span class="op">:</span> <span class="st">"dodecahedral"</span><span class="op">,</span> <span class="dt">value</span><span class="op">:</span> d3<span class="op">.</span><span class="at">geoDodecahedral</span> }<span class="op">,</span></span>
<span id="cb90-1642"><a href="#cb90-1642" aria-hidden="true" tabindex="-1"></a>  { <span class="dt">name</span><span class="op">:</span> <span class="st">"Eckert I"</span><span class="op">,</span> <span class="dt">value</span><span class="op">:</span> d3<span class="op">.</span><span class="at">geoEckert1</span> }<span class="op">,</span></span>
<span id="cb90-1643"><a href="#cb90-1643" aria-hidden="true" tabindex="-1"></a>  { <span class="dt">name</span><span class="op">:</span> <span class="st">"Eckert II"</span><span class="op">,</span> <span class="dt">value</span><span class="op">:</span> d3<span class="op">.</span><span class="at">geoEckert2</span> }<span class="op">,</span></span>
<span id="cb90-1644"><a href="#cb90-1644" aria-hidden="true" tabindex="-1"></a>  { <span class="dt">name</span><span class="op">:</span> <span class="st">"Eckert III"</span><span class="op">,</span> <span class="dt">value</span><span class="op">:</span> d3<span class="op">.</span><span class="at">geoEckert3</span> }<span class="op">,</span></span>
<span id="cb90-1645"><a href="#cb90-1645" aria-hidden="true" tabindex="-1"></a>  { <span class="dt">name</span><span class="op">:</span> <span class="st">"Eckert IV"</span><span class="op">,</span> <span class="dt">value</span><span class="op">:</span> d3<span class="op">.</span><span class="at">geoEckert4</span> }<span class="op">,</span></span>
<span id="cb90-1646"><a href="#cb90-1646" aria-hidden="true" tabindex="-1"></a>  { <span class="dt">name</span><span class="op">:</span> <span class="st">"Eckert V"</span><span class="op">,</span> <span class="dt">value</span><span class="op">:</span> d3<span class="op">.</span><span class="at">geoEckert5</span> }<span class="op">,</span></span>
<span id="cb90-1647"><a href="#cb90-1647" aria-hidden="true" tabindex="-1"></a>  { <span class="dt">name</span><span class="op">:</span> <span class="st">"Eckert VI"</span><span class="op">,</span> <span class="dt">value</span><span class="op">:</span> d3<span class="op">.</span><span class="at">geoEckert6</span> }<span class="op">,</span></span>
<span id="cb90-1648"><a href="#cb90-1648" aria-hidden="true" tabindex="-1"></a>  { <span class="dt">name</span><span class="op">:</span> <span class="st">"Eisenlohr conformal"</span><span class="op">,</span> <span class="dt">value</span><span class="op">:</span> d3<span class="op">.</span><span class="at">geoEisenlohr</span> }<span class="op">,</span></span>
<span id="cb90-1649"><a href="#cb90-1649" aria-hidden="true" tabindex="-1"></a>  { <span class="dt">name</span><span class="op">:</span> <span class="st">"Equal Earth"</span><span class="op">,</span> <span class="dt">value</span><span class="op">:</span> d3<span class="op">.</span><span class="at">geoEqualEarth</span> }<span class="op">,</span></span>
<span id="cb90-1650"><a href="#cb90-1650" aria-hidden="true" tabindex="-1"></a>  { <span class="dt">name</span><span class="op">:</span> <span class="st">"Equirectangular (plate carrée)"</span><span class="op">,</span> <span class="dt">value</span><span class="op">:</span> d3<span class="op">.</span><span class="at">geoEquirectangular</span> }<span class="op">,</span></span>
<span id="cb90-1651"><a href="#cb90-1651" aria-hidden="true" tabindex="-1"></a>  { <span class="dt">name</span><span class="op">:</span> <span class="st">"Fahey pseudocylindrical"</span><span class="op">,</span> <span class="dt">value</span><span class="op">:</span> d3<span class="op">.</span><span class="at">geoFahey</span> }<span class="op">,</span></span>
<span id="cb90-1652"><a href="#cb90-1652" aria-hidden="true" tabindex="-1"></a>  { <span class="dt">name</span><span class="op">:</span> <span class="st">"flat-polar parabolic"</span><span class="op">,</span> <span class="dt">value</span><span class="op">:</span> d3<span class="op">.</span><span class="at">geoMtFlatPolarParabolic</span> }<span class="op">,</span></span>
<span id="cb90-1653"><a href="#cb90-1653" aria-hidden="true" tabindex="-1"></a>  { <span class="dt">name</span><span class="op">:</span> <span class="st">"flat-polar quartic"</span><span class="op">,</span> <span class="dt">value</span><span class="op">:</span> d3<span class="op">.</span><span class="at">geoMtFlatPolarQuartic</span> }<span class="op">,</span></span>
<span id="cb90-1654"><a href="#cb90-1654" aria-hidden="true" tabindex="-1"></a>  { <span class="dt">name</span><span class="op">:</span> <span class="st">"flat-polar sinusoidal"</span><span class="op">,</span> <span class="dt">value</span><span class="op">:</span> d3<span class="op">.</span><span class="at">geoMtFlatPolarSinusoidal</span> }<span class="op">,</span></span>
<span id="cb90-1655"><a href="#cb90-1655" aria-hidden="true" tabindex="-1"></a>  { <span class="dt">name</span><span class="op">:</span> <span class="st">"Foucaut’s stereographic equivalent"</span><span class="op">,</span> <span class="dt">value</span><span class="op">:</span> d3<span class="op">.</span><span class="at">geoFoucaut</span> }<span class="op">,</span></span>
<span id="cb90-1656"><a href="#cb90-1656" aria-hidden="true" tabindex="-1"></a>  { <span class="dt">name</span><span class="op">:</span> <span class="st">"Foucaut’s sinusoidal"</span><span class="op">,</span> <span class="dt">value</span><span class="op">:</span> d3<span class="op">.</span><span class="at">geoFoucautSinusoidal</span> }<span class="op">,</span></span>
<span id="cb90-1657"><a href="#cb90-1657" aria-hidden="true" tabindex="-1"></a>  { <span class="dt">name</span><span class="op">:</span> <span class="st">"general perspective"</span><span class="op">,</span> <span class="dt">value</span><span class="op">:</span> d3<span class="op">.</span><span class="at">geoSatellite</span> }<span class="op">,</span></span>
<span id="cb90-1658"><a href="#cb90-1658" aria-hidden="true" tabindex="-1"></a>  { <span class="dt">name</span><span class="op">:</span> <span class="st">"Gingery"</span><span class="op">,</span> <span class="dt">value</span><span class="op">:</span> d3<span class="op">.</span><span class="at">geoGingery</span><span class="op">,</span> <span class="dt">options</span><span class="op">:</span> { <span class="dt">clip</span><span class="op">:</span> { <span class="dt">type</span><span class="op">:</span> <span class="st">"Sphere"</span> } } }<span class="op">,</span></span>
<span id="cb90-1659"><a href="#cb90-1659" aria-hidden="true" tabindex="-1"></a>  { <span class="dt">name</span><span class="op">:</span> <span class="st">"Ginzburg V"</span><span class="op">,</span> <span class="dt">value</span><span class="op">:</span> d3<span class="op">.</span><span class="at">geoGinzburg5</span> }<span class="op">,</span></span>
<span id="cb90-1660"><a href="#cb90-1660" aria-hidden="true" tabindex="-1"></a>  { <span class="dt">name</span><span class="op">:</span> <span class="st">"Ginzburg VI"</span><span class="op">,</span> <span class="dt">value</span><span class="op">:</span> d3<span class="op">.</span><span class="at">geoGinzburg6</span> }<span class="op">,</span></span>
<span id="cb90-1661"><a href="#cb90-1661" aria-hidden="true" tabindex="-1"></a>  { <span class="dt">name</span><span class="op">:</span> <span class="st">"Ginzburg VIII"</span><span class="op">,</span> <span class="dt">value</span><span class="op">:</span> d3<span class="op">.</span><span class="at">geoGinzburg8</span> }<span class="op">,</span></span>
<span id="cb90-1662"><a href="#cb90-1662" aria-hidden="true" tabindex="-1"></a>  { <span class="dt">name</span><span class="op">:</span> <span class="st">"Ginzburg IX"</span><span class="op">,</span> <span class="dt">value</span><span class="op">:</span> d3<span class="op">.</span><span class="at">geoGinzburg9</span> }<span class="op">,</span></span>
<span id="cb90-1663"><a href="#cb90-1663" aria-hidden="true" tabindex="-1"></a>  { <span class="dt">name</span><span class="op">:</span> <span class="st">"Goode’s homolosine"</span><span class="op">,</span> <span class="dt">value</span><span class="op">:</span> d3<span class="op">.</span><span class="at">geoHomolosine</span>}<span class="op">,</span></span>
<span id="cb90-1664"><a href="#cb90-1664" aria-hidden="true" tabindex="-1"></a>  { <span class="dt">name</span><span class="op">:</span> <span class="st">"Goode’s homolosine (interrupted)"</span><span class="op">,</span> <span class="dt">value</span><span class="op">:</span> d3<span class="op">.</span><span class="at">geoInterruptedHomolosine</span><span class="op">,</span> <span class="dt">options</span><span class="op">:</span> { <span class="dt">clip</span><span class="op">:</span> { <span class="dt">type</span><span class="op">:</span> <span class="st">"Sphere"</span> } }  }<span class="op">,</span></span>
<span id="cb90-1665"><a href="#cb90-1665" aria-hidden="true" tabindex="-1"></a>  { <span class="dt">name</span><span class="op">:</span> <span class="st">"gnomonic"</span><span class="op">,</span> <span class="dt">value</span><span class="op">:</span> d3<span class="op">.</span><span class="at">geoGnomonic</span> }<span class="op">,</span></span>
<span id="cb90-1666"><a href="#cb90-1666" aria-hidden="true" tabindex="-1"></a>  { <span class="dt">name</span><span class="op">:</span> <span class="st">"Gringorten square"</span><span class="op">,</span> <span class="dt">value</span><span class="op">:</span> d3<span class="op">.</span><span class="at">geoGringorten</span> }<span class="op">,</span></span>
<span id="cb90-1667"><a href="#cb90-1667" aria-hidden="true" tabindex="-1"></a>  { <span class="dt">name</span><span class="op">:</span> <span class="st">"Gringorten quincuncial"</span><span class="op">,</span> <span class="dt">value</span><span class="op">:</span> d3<span class="op">.</span><span class="at">geoGringortenQuincuncial</span> }<span class="op">,</span></span>
<span id="cb90-1668"><a href="#cb90-1668" aria-hidden="true" tabindex="-1"></a>  { <span class="dt">name</span><span class="op">:</span> <span class="st">"Guyou square"</span><span class="op">,</span> <span class="dt">value</span><span class="op">:</span> d3<span class="op">.</span><span class="at">geoGuyou</span> }<span class="op">,</span></span>
<span id="cb90-1669"><a href="#cb90-1669" aria-hidden="true" tabindex="-1"></a>  { <span class="dt">name</span><span class="op">:</span> <span class="st">"Hammer"</span><span class="op">,</span> <span class="dt">value</span><span class="op">:</span> d3<span class="op">.</span><span class="at">geoHammer</span> }<span class="op">,</span></span>
<span id="cb90-1670"><a href="#cb90-1670" aria-hidden="true" tabindex="-1"></a>  { <span class="dt">name</span><span class="op">:</span> <span class="st">"Hammer retroazimuthal"</span><span class="op">,</span> <span class="dt">value</span><span class="op">:</span> d3<span class="op">.</span><span class="at">geoHammerRetroazimuthal</span><span class="op">,</span> <span class="dt">options</span><span class="op">:</span> { <span class="dt">clip</span><span class="op">:</span> { <span class="dt">type</span><span class="op">:</span> <span class="st">"Sphere"</span> } } }<span class="op">,</span></span>
<span id="cb90-1671"><a href="#cb90-1671" aria-hidden="true" tabindex="-1"></a>  { <span class="dt">name</span><span class="op">:</span> <span class="st">"HEALPix"</span><span class="op">,</span> <span class="dt">value</span><span class="op">:</span> d3<span class="op">.</span><span class="at">geoHealpix</span><span class="op">,</span> <span class="dt">options</span><span class="op">:</span> { <span class="dt">clip</span><span class="op">:</span> { <span class="dt">type</span><span class="op">:</span> <span class="st">"Sphere"</span> } } }<span class="op">,</span></span>
<span id="cb90-1672"><a href="#cb90-1672" aria-hidden="true" tabindex="-1"></a>  { <span class="dt">name</span><span class="op">:</span> <span class="st">"Hill eucyclic"</span><span class="op">,</span> <span class="dt">value</span><span class="op">:</span> d3<span class="op">.</span><span class="at">geoHill</span> }<span class="op">,</span></span>
<span id="cb90-1673"><a href="#cb90-1673" aria-hidden="true" tabindex="-1"></a>  { <span class="dt">name</span><span class="op">:</span> <span class="st">"Hufnagel pseudocylindrical"</span><span class="op">,</span> <span class="dt">value</span><span class="op">:</span> d3<span class="op">.</span><span class="at">geoHufnagel</span> }<span class="op">,</span></span>
<span id="cb90-1674"><a href="#cb90-1674" aria-hidden="true" tabindex="-1"></a>  { <span class="dt">name</span><span class="op">:</span> <span class="st">"icosahedral"</span><span class="op">,</span> <span class="dt">value</span><span class="op">:</span> d3<span class="op">.</span><span class="at">geoIcosahedral</span> }<span class="op">,</span></span>
<span id="cb90-1675"><a href="#cb90-1675" aria-hidden="true" tabindex="-1"></a>  { <span class="dt">name</span><span class="op">:</span> <span class="st">"Imago"</span><span class="op">,</span> <span class="dt">value</span><span class="op">:</span> d3<span class="op">.</span><span class="at">geoImago</span> }<span class="op">,</span></span>
<span id="cb90-1676"><a href="#cb90-1676" aria-hidden="true" tabindex="-1"></a>  { <span class="dt">name</span><span class="op">:</span> <span class="st">"Kavrayskiy VII"</span><span class="op">,</span> <span class="dt">value</span><span class="op">:</span> d3<span class="op">.</span><span class="at">geoKavrayskiy7</span> }<span class="op">,</span></span>
<span id="cb90-1677"><a href="#cb90-1677" aria-hidden="true" tabindex="-1"></a>  { <span class="dt">name</span><span class="op">:</span> <span class="st">"Lagrange conformal"</span><span class="op">,</span> <span class="dt">value</span><span class="op">:</span> d3<span class="op">.</span><span class="at">geoLagrange</span> }<span class="op">,</span></span>
<span id="cb90-1678"><a href="#cb90-1678" aria-hidden="true" tabindex="-1"></a>  { <span class="dt">name</span><span class="op">:</span> <span class="st">"Larrivée"</span><span class="op">,</span> <span class="dt">value</span><span class="op">:</span> d3<span class="op">.</span><span class="at">geoLarrivee</span> }<span class="op">,</span></span>
<span id="cb90-1679"><a href="#cb90-1679" aria-hidden="true" tabindex="-1"></a>  { <span class="dt">name</span><span class="op">:</span> <span class="st">"Laskowski tri-optimal"</span><span class="op">,</span> <span class="dt">value</span><span class="op">:</span> d3<span class="op">.</span><span class="at">geoLaskowski</span> }<span class="op">,</span></span>
<span id="cb90-1680"><a href="#cb90-1680" aria-hidden="true" tabindex="-1"></a>  { <span class="dt">name</span><span class="op">:</span> <span class="st">"Loximuthal"</span><span class="op">,</span> <span class="dt">value</span><span class="op">:</span> d3<span class="op">.</span><span class="at">geoLoximuthal</span> }<span class="op">,</span></span>
<span id="cb90-1681"><a href="#cb90-1681" aria-hidden="true" tabindex="-1"></a>  { <span class="dt">name</span><span class="op">:</span> <span class="st">"Mercator"</span><span class="op">,</span> <span class="dt">value</span><span class="op">:</span> d3<span class="op">.</span><span class="at">geoMercator</span> }<span class="op">,</span></span>
<span id="cb90-1682"><a href="#cb90-1682" aria-hidden="true" tabindex="-1"></a>  { <span class="dt">name</span><span class="op">:</span> <span class="st">"Miller cylindrical"</span><span class="op">,</span> <span class="dt">value</span><span class="op">:</span> d3<span class="op">.</span><span class="at">geoMiller</span> }<span class="op">,</span></span>
<span id="cb90-1683"><a href="#cb90-1683" aria-hidden="true" tabindex="-1"></a>  { <span class="dt">name</span><span class="op">:</span> <span class="st">"Mollweide"</span><span class="op">,</span> <span class="dt">value</span><span class="op">:</span> d3<span class="op">.</span><span class="at">geoMollweide</span> }<span class="op">,</span></span>
<span id="cb90-1684"><a href="#cb90-1684" aria-hidden="true" tabindex="-1"></a>  { <span class="dt">name</span><span class="op">:</span> <span class="st">"Mollweide (Goode’s interrupted)"</span><span class="op">,</span> <span class="dt">value</span><span class="op">:</span> d3<span class="op">.</span><span class="at">geoInterruptedMollweide</span><span class="op">,</span> <span class="dt">options</span><span class="op">:</span> { <span class="dt">clip</span><span class="op">:</span> { <span class="dt">type</span><span class="op">:</span> <span class="st">"Sphere"</span> } } }<span class="op">,</span></span>
<span id="cb90-1685"><a href="#cb90-1685" aria-hidden="true" tabindex="-1"></a>  { <span class="dt">name</span><span class="op">:</span> <span class="st">"Mollweide (interrupted hemispheres)"</span><span class="op">,</span> <span class="dt">value</span><span class="op">:</span> d3<span class="op">.</span><span class="at">geoInterruptedMollweideHemispheres</span><span class="op">,</span> <span class="dt">options</span><span class="op">:</span> { <span class="dt">clip</span><span class="op">:</span> { <span class="dt">type</span><span class="op">:</span> <span class="st">"Sphere"</span> } } }<span class="op">,</span></span>
<span id="cb90-1686"><a href="#cb90-1686" aria-hidden="true" tabindex="-1"></a>  { <span class="dt">name</span><span class="op">:</span> <span class="st">"Natural Earth"</span><span class="op">,</span> <span class="dt">value</span><span class="op">:</span> d3<span class="op">.</span><span class="at">geoNaturalEarth1</span> }<span class="op">,</span></span>
<span id="cb90-1687"><a href="#cb90-1687" aria-hidden="true" tabindex="-1"></a>  { <span class="dt">name</span><span class="op">:</span> <span class="st">"Natural Earth II"</span><span class="op">,</span> <span class="dt">value</span><span class="op">:</span> d3<span class="op">.</span><span class="at">geoNaturalEarth2</span> }<span class="op">,</span></span>
<span id="cb90-1688"><a href="#cb90-1688" aria-hidden="true" tabindex="-1"></a>  { <span class="dt">name</span><span class="op">:</span> <span class="st">"Nell–Hammer"</span><span class="op">,</span> <span class="dt">value</span><span class="op">:</span> d3<span class="op">.</span><span class="at">geoNellHammer</span> }<span class="op">,</span></span>
<span id="cb90-1689"><a href="#cb90-1689" aria-hidden="true" tabindex="-1"></a>  { <span class="dt">name</span><span class="op">:</span> <span class="st">"Nicolosi globular"</span><span class="op">,</span> <span class="dt">value</span><span class="op">:</span> d3<span class="op">.</span><span class="at">geoNicolosi</span> }<span class="op">,</span></span>
<span id="cb90-1690"><a href="#cb90-1690" aria-hidden="true" tabindex="-1"></a>  { <span class="dt">name</span><span class="op">:</span> <span class="st">"orthographic"</span><span class="op">,</span> <span class="dt">value</span><span class="op">:</span> d3<span class="op">.</span><span class="at">geoOrthographic</span> }<span class="op">,</span></span>
<span id="cb90-1691"><a href="#cb90-1691" aria-hidden="true" tabindex="-1"></a>  { <span class="dt">name</span><span class="op">:</span> <span class="st">"Patterson cylindrical"</span><span class="op">,</span> <span class="dt">value</span><span class="op">:</span> d3<span class="op">.</span><span class="at">geoPatterson</span> }<span class="op">,</span></span>
<span id="cb90-1692"><a href="#cb90-1692" aria-hidden="true" tabindex="-1"></a>  { <span class="dt">name</span><span class="op">:</span> <span class="st">"Peirce quincuncial"</span><span class="op">,</span> <span class="dt">value</span><span class="op">:</span> d3<span class="op">.</span><span class="at">geoPeirceQuincuncial</span> }<span class="op">,</span></span>
<span id="cb90-1693"><a href="#cb90-1693" aria-hidden="true" tabindex="-1"></a>  { <span class="dt">name</span><span class="op">:</span> <span class="st">"rectangular polyconic"</span><span class="op">,</span> <span class="dt">value</span><span class="op">:</span> d3<span class="op">.</span><span class="at">geoRectangularPolyconic</span> }<span class="op">,</span></span>
<span id="cb90-1694"><a href="#cb90-1694" aria-hidden="true" tabindex="-1"></a>  { <span class="dt">name</span><span class="op">:</span> <span class="st">"Robinson"</span><span class="op">,</span> <span class="dt">value</span><span class="op">:</span> d3<span class="op">.</span><span class="at">geoRobinson</span> }<span class="op">,</span></span>
<span id="cb90-1695"><a href="#cb90-1695" aria-hidden="true" tabindex="-1"></a>  { <span class="dt">name</span><span class="op">:</span> <span class="st">"sinusoidal"</span><span class="op">,</span> <span class="dt">value</span><span class="op">:</span> d3<span class="op">.</span><span class="at">geoSinusoidal</span> }<span class="op">,</span></span>
<span id="cb90-1696"><a href="#cb90-1696" aria-hidden="true" tabindex="-1"></a>  { <span class="dt">name</span><span class="op">:</span> <span class="st">"sinusoidal (interrupted)"</span><span class="op">,</span> <span class="dt">value</span><span class="op">:</span> d3<span class="op">.</span><span class="at">geoInterruptedSinusoidal</span><span class="op">,</span> <span class="dt">options</span><span class="op">:</span> { <span class="dt">clip</span><span class="op">:</span> { <span class="dt">type</span><span class="op">:</span> <span class="st">"Sphere"</span> } } }<span class="op">,</span></span>
<span id="cb90-1697"><a href="#cb90-1697" aria-hidden="true" tabindex="-1"></a>  { <span class="dt">name</span><span class="op">:</span> <span class="st">"sinu-Mollweide"</span><span class="op">,</span> <span class="dt">value</span><span class="op">:</span> d3<span class="op">.</span><span class="at">geoSinuMollweide</span> }<span class="op">,</span></span>
<span id="cb90-1698"><a href="#cb90-1698" aria-hidden="true" tabindex="-1"></a>  { <span class="dt">name</span><span class="op">:</span> <span class="st">"sinu-Mollweide (interrupted)"</span><span class="op">,</span> <span class="dt">value</span><span class="op">:</span> d3<span class="op">.</span><span class="at">geoInterruptedSinuMollweide</span><span class="op">,</span> <span class="dt">options</span><span class="op">:</span> { <span class="dt">clip</span><span class="op">:</span> { <span class="dt">type</span><span class="op">:</span> <span class="st">"Sphere"</span> } } }<span class="op">,</span></span>
<span id="cb90-1699"><a href="#cb90-1699" aria-hidden="true" tabindex="-1"></a>  { <span class="dt">name</span><span class="op">:</span> <span class="st">"stereographic"</span><span class="op">,</span> <span class="dt">value</span><span class="op">:</span> d3<span class="op">.</span><span class="at">geoStereographic</span> }<span class="op">,</span></span>
<span id="cb90-1700"><a href="#cb90-1700" aria-hidden="true" tabindex="-1"></a>  { <span class="dt">name</span><span class="op">:</span> <span class="st">"Lee’s tetrahedal"</span><span class="op">,</span> <span class="dt">value</span><span class="op">:</span> d3<span class="op">.</span><span class="at">geoTetrahedralLee</span> }<span class="op">,</span></span>
<span id="cb90-1701"><a href="#cb90-1701" aria-hidden="true" tabindex="-1"></a>  { <span class="dt">name</span><span class="op">:</span> <span class="st">"Times"</span><span class="op">,</span> <span class="dt">value</span><span class="op">:</span> d3<span class="op">.</span><span class="at">geoTimes</span> }<span class="op">,</span></span>
<span id="cb90-1702"><a href="#cb90-1702" aria-hidden="true" tabindex="-1"></a>  { <span class="dt">name</span><span class="op">:</span> <span class="st">"Tobler hyperelliptical"</span><span class="op">,</span> <span class="dt">value</span><span class="op">:</span> d3<span class="op">.</span><span class="at">geoHyperelliptical</span> }<span class="op">,</span></span>
<span id="cb90-1703"><a href="#cb90-1703" aria-hidden="true" tabindex="-1"></a>  { <span class="dt">name</span><span class="op">:</span> <span class="st">"transverse Mercator"</span><span class="op">,</span> <span class="dt">value</span><span class="op">:</span> d3<span class="op">.</span><span class="at">geoTransverseMercator</span> }<span class="op">,</span></span>
<span id="cb90-1704"><a href="#cb90-1704" aria-hidden="true" tabindex="-1"></a>  { <span class="dt">name</span><span class="op">:</span> <span class="st">"Van der Grinten"</span><span class="op">,</span> <span class="dt">value</span><span class="op">:</span> d3<span class="op">.</span><span class="at">geoVanDerGrinten</span> }<span class="op">,</span></span>
<span id="cb90-1705"><a href="#cb90-1705" aria-hidden="true" tabindex="-1"></a>  { <span class="dt">name</span><span class="op">:</span> <span class="st">"Van der Grinten II"</span><span class="op">,</span> <span class="dt">value</span><span class="op">:</span> d3<span class="op">.</span><span class="at">geoVanDerGrinten2</span> }<span class="op">,</span></span>
<span id="cb90-1706"><a href="#cb90-1706" aria-hidden="true" tabindex="-1"></a>  { <span class="dt">name</span><span class="op">:</span> <span class="st">"Van der Grinten III"</span><span class="op">,</span> <span class="dt">value</span><span class="op">:</span> d3<span class="op">.</span><span class="at">geoVanDerGrinten3</span> }<span class="op">,</span></span>
<span id="cb90-1707"><a href="#cb90-1707" aria-hidden="true" tabindex="-1"></a>  { <span class="dt">name</span><span class="op">:</span> <span class="st">"Van der Grinten IV"</span><span class="op">,</span> <span class="dt">value</span><span class="op">:</span> d3<span class="op">.</span><span class="at">geoVanDerGrinten4</span> }<span class="op">,</span></span>
<span id="cb90-1708"><a href="#cb90-1708" aria-hidden="true" tabindex="-1"></a>  { <span class="dt">name</span><span class="op">:</span> <span class="st">"Wagner IV"</span><span class="op">,</span> <span class="dt">value</span><span class="op">:</span> d3<span class="op">.</span><span class="at">geoWagner4</span> }<span class="op">,</span></span>
<span id="cb90-1709"><a href="#cb90-1709" aria-hidden="true" tabindex="-1"></a>  { <span class="dt">name</span><span class="op">:</span> <span class="st">"Wagner VI"</span><span class="op">,</span> <span class="dt">value</span><span class="op">:</span> d3<span class="op">.</span><span class="at">geoWagner6</span> }<span class="op">,</span></span>
<span id="cb90-1710"><a href="#cb90-1710" aria-hidden="true" tabindex="-1"></a>  { <span class="dt">name</span><span class="op">:</span> <span class="st">"Wagner VII"</span><span class="op">,</span> <span class="dt">value</span><span class="op">:</span> d3<span class="op">.</span><span class="at">geoWagner7</span> }<span class="op">,</span></span>
<span id="cb90-1711"><a href="#cb90-1711" aria-hidden="true" tabindex="-1"></a>  { <span class="dt">name</span><span class="op">:</span> <span class="st">"Werner"</span><span class="op">,</span> <span class="dt">value</span><span class="op">:</span> d3<span class="op">.</span><span class="at">geoBonne</span> <span class="op">?</span> () <span class="kw">=&gt;</span> d3<span class="op">.</span><span class="fu">geoBonne</span>()<span class="op">.</span><span class="fu">parallel</span>(<span class="dv">90</span>) <span class="op">:</span> <span class="kw">null</span> }<span class="op">,</span></span>
<span id="cb90-1712"><a href="#cb90-1712" aria-hidden="true" tabindex="-1"></a>  { <span class="dt">name</span><span class="op">:</span> <span class="st">"Wiechel"</span><span class="op">,</span> <span class="dt">value</span><span class="op">:</span> d3<span class="op">.</span><span class="at">geoWiechel</span> }<span class="op">,</span></span>
<span id="cb90-1713"><a href="#cb90-1713" aria-hidden="true" tabindex="-1"></a>  { <span class="dt">name</span><span class="op">:</span> <span class="st">"Winkel tripel"</span><span class="op">,</span> <span class="dt">value</span><span class="op">:</span> d3<span class="op">.</span><span class="at">geoWinkel3</span> }</span>
<span id="cb90-1714"><a href="#cb90-1714" aria-hidden="true" tabindex="-1"></a>]</span>
<span id="cb90-1715"><a href="#cb90-1715" aria-hidden="true" tabindex="-1"></a>EventType <span class="op">=</span> ({</span>
<span id="cb90-1716"><a href="#cb90-1716" aria-hidden="true" tabindex="-1"></a>  <span class="dt">LocationChange</span><span class="op">:</span> <span class="st">"LOCATION_CHANGE"</span><span class="op">,</span></span>
<span id="cb90-1717"><a href="#cb90-1717" aria-hidden="true" tabindex="-1"></a>  <span class="dt">DateHourChange</span><span class="op">:</span> <span class="st">"DATE_HOUR_CHANGE"</span></span>
<span id="cb90-1718"><a href="#cb90-1718" aria-hidden="true" tabindex="-1"></a>})</span>
<span id="cb90-1719"><a href="#cb90-1719" aria-hidden="true" tabindex="-1"></a>mapcolors <span class="op">=</span> ({</span>
<span id="cb90-1720"><a href="#cb90-1720" aria-hidden="true" tabindex="-1"></a>  <span class="dt">night</span><span class="op">:</span> <span class="st">"#719fb6"</span><span class="op">,</span></span>
<span id="cb90-1721"><a href="#cb90-1721" aria-hidden="true" tabindex="-1"></a>  <span class="dt">day</span><span class="op">:</span> <span class="st">"#ffe438"</span><span class="op">,</span></span>
<span id="cb90-1722"><a href="#cb90-1722" aria-hidden="true" tabindex="-1"></a>  <span class="dt">grid</span><span class="op">:</span> <span class="st">"#4b6a79"</span><span class="op">,</span></span>
<span id="cb90-1723"><a href="#cb90-1723" aria-hidden="true" tabindex="-1"></a>  <span class="dt">ocean</span><span class="op">:</span> <span class="st">"#adeeff"</span><span class="op">,</span></span>
<span id="cb90-1724"><a href="#cb90-1724" aria-hidden="true" tabindex="-1"></a>  <span class="dt">land</span><span class="op">:</span> <span class="st">"#90ff7888"</span><span class="op">,</span></span>
<span id="cb90-1725"><a href="#cb90-1725" aria-hidden="true" tabindex="-1"></a>  <span class="dt">sun</span><span class="op">:</span> <span class="st">"#ffb438"</span></span>
<span id="cb90-1726"><a href="#cb90-1726" aria-hidden="true" tabindex="-1"></a>})</span>
<span id="cb90-1727"><a href="#cb90-1727" aria-hidden="true" tabindex="-1"></a>toRadians <span class="op">=</span> (val) <span class="kw">=&gt;</span> val <span class="op">*</span> <span class="bu">Math</span><span class="op">.</span><span class="cn">PI</span> <span class="op">/</span> <span class="dv">180</span></span>
<span id="cb90-1728"><a href="#cb90-1728" aria-hidden="true" tabindex="-1"></a>toDegrees <span class="op">=</span> (val) <span class="kw">=&gt;</span> val <span class="op">*</span> <span class="dv">180</span> <span class="op">/</span> <span class="bu">Math</span><span class="op">.</span><span class="cn">PI</span><span class="op">;</span></span>
<span id="cb90-1729"><a href="#cb90-1729" aria-hidden="true" tabindex="-1"></a>land <span class="op">=</span> topojson<span class="op">.</span><span class="fu">feature</span>(world<span class="op">,</span> world<span class="op">.</span><span class="at">objects</span><span class="op">.</span><span class="at">land</span>)<span class="op">;</span></span>
<span id="cb90-1730"><a href="#cb90-1730" aria-hidden="true" tabindex="-1"></a>d3 <span class="op">=</span> <span class="pp">require</span>(<span class="st">"d3@7"</span><span class="op">,</span> <span class="st">"d3-geo-projection@3"</span>)</span>
<span id="cb90-1731"><a href="#cb90-1731" aria-hidden="true" tabindex="-1"></a><span class="kw">function</span> <span class="fu">input</span>(config) {</span>
<span id="cb90-1732"><a href="#cb90-1732" aria-hidden="true" tabindex="-1"></a>  <span class="kw">let</span> {</span>
<span id="cb90-1733"><a href="#cb90-1733" aria-hidden="true" tabindex="-1"></a>    form<span class="op">,</span></span>
<span id="cb90-1734"><a href="#cb90-1734" aria-hidden="true" tabindex="-1"></a>    type <span class="op">=</span> <span class="st">"text"</span><span class="op">,</span></span>
<span id="cb90-1735"><a href="#cb90-1735" aria-hidden="true" tabindex="-1"></a>    attributes <span class="op">=</span> {}<span class="op">,</span></span>
<span id="cb90-1736"><a href="#cb90-1736" aria-hidden="true" tabindex="-1"></a>    action<span class="op">,</span></span>
<span id="cb90-1737"><a href="#cb90-1737" aria-hidden="true" tabindex="-1"></a>    getValue<span class="op">,</span></span>
<span id="cb90-1738"><a href="#cb90-1738" aria-hidden="true" tabindex="-1"></a>    title<span class="op">,</span></span>
<span id="cb90-1739"><a href="#cb90-1739" aria-hidden="true" tabindex="-1"></a>    description<span class="op">,</span></span>
<span id="cb90-1740"><a href="#cb90-1740" aria-hidden="true" tabindex="-1"></a>    format<span class="op">,</span></span>
<span id="cb90-1741"><a href="#cb90-1741" aria-hidden="true" tabindex="-1"></a>    display<span class="op">,</span></span>
<span id="cb90-1742"><a href="#cb90-1742" aria-hidden="true" tabindex="-1"></a>    submit<span class="op">,</span></span>
<span id="cb90-1743"><a href="#cb90-1743" aria-hidden="true" tabindex="-1"></a>    options</span>
<span id="cb90-1744"><a href="#cb90-1744" aria-hidden="true" tabindex="-1"></a>  } <span class="op">=</span> config<span class="op">;</span></span>
<span id="cb90-1745"><a href="#cb90-1745" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> wrapper <span class="op">=</span> <span class="fu">html</span><span class="vs">`&lt;div&gt;&lt;/div&gt;`</span><span class="op">;</span></span>
<span id="cb90-1746"><a href="#cb90-1746" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (<span class="op">!</span>form)</span>
<span id="cb90-1747"><a href="#cb90-1747" aria-hidden="true" tabindex="-1"></a>    form <span class="op">=</span> <span class="fu">html</span><span class="vs">`&lt;form&gt;</span></span>
<span id="cb90-1748"><a href="#cb90-1748" aria-hidden="true" tabindex="-1"></a><span class="vs">  &lt;input name=input type=</span><span class="sc">${</span>type<span class="sc">}</span><span class="vs"> /&gt;</span></span>
<span id="cb90-1749"><a href="#cb90-1749" aria-hidden="true" tabindex="-1"></a><span class="vs">  &lt;/form&gt;`</span><span class="op">;</span></span>
<span id="cb90-1750"><a href="#cb90-1750" aria-hidden="true" tabindex="-1"></a>  <span class="bu">Object</span><span class="op">.</span><span class="fu">keys</span>(attributes)<span class="op">.</span><span class="fu">forEach</span>(key <span class="kw">=&gt;</span> {</span>
<span id="cb90-1751"><a href="#cb90-1751" aria-hidden="true" tabindex="-1"></a>    <span class="kw">const</span> val <span class="op">=</span> attributes[key]<span class="op">;</span></span>
<span id="cb90-1752"><a href="#cb90-1752" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> (val <span class="op">!=</span> <span class="kw">null</span>) form<span class="op">.</span><span class="at">input</span><span class="op">.</span><span class="fu">setAttribute</span>(key<span class="op">,</span> val)<span class="op">;</span></span>
<span id="cb90-1753"><a href="#cb90-1753" aria-hidden="true" tabindex="-1"></a>  })<span class="op">;</span></span>
<span id="cb90-1754"><a href="#cb90-1754" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (submit)</span>
<span id="cb90-1755"><a href="#cb90-1755" aria-hidden="true" tabindex="-1"></a>    form<span class="op">.</span><span class="fu">append</span>(</span>
<span id="cb90-1756"><a href="#cb90-1756" aria-hidden="true" tabindex="-1"></a>      <span class="fu">html</span><span class="vs">`&lt;input name=submit type=submit style="margin: 0 0.75em" value="</span><span class="sc">${</span></span>
<span id="cb90-1757"><a href="#cb90-1757" aria-hidden="true" tabindex="-1"></a>        <span class="kw">typeof</span> submit <span class="op">==</span> <span class="st">"string"</span> <span class="op">?</span> submit <span class="op">:</span> <span class="st">"Submit"</span></span>
<span id="cb90-1758"><a href="#cb90-1758" aria-hidden="true" tabindex="-1"></a>      <span class="sc">}</span><span class="vs">" /&gt;`</span></span>
<span id="cb90-1759"><a href="#cb90-1759" aria-hidden="true" tabindex="-1"></a>    )<span class="op">;</span></span>
<span id="cb90-1760"><a href="#cb90-1760" aria-hidden="true" tabindex="-1"></a>  form<span class="op">.</span><span class="fu">append</span>(</span>
<span id="cb90-1761"><a href="#cb90-1761" aria-hidden="true" tabindex="-1"></a>    <span class="fu">html</span><span class="vs">`&lt;output name=output style="font: 14px Menlo, Consolas, monospace; margin-left: 0.1em; text-align:center;"&gt;&lt;/output&gt;`</span></span>
<span id="cb90-1762"><a href="#cb90-1762" aria-hidden="true" tabindex="-1"></a>  )<span class="op">;</span></span>
<span id="cb90-1763"><a href="#cb90-1763" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (title)</span>
<span id="cb90-1764"><a href="#cb90-1764" aria-hidden="true" tabindex="-1"></a>    form<span class="op">.</span><span class="fu">prepend</span>(</span>
<span id="cb90-1765"><a href="#cb90-1765" aria-hidden="true" tabindex="-1"></a>      <span class="fu">html</span><span class="vs">`&lt;div style="font: 700 0.9rem sans-serif; margin-bottom: 3px;"&gt;</span><span class="sc">${</span>title<span class="sc">}</span><span class="vs">&lt;/div&gt;`</span></span>
<span id="cb90-1766"><a href="#cb90-1766" aria-hidden="true" tabindex="-1"></a>    )<span class="op">;</span></span>
<span id="cb90-1767"><a href="#cb90-1767" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (description)</span>
<span id="cb90-1768"><a href="#cb90-1768" aria-hidden="true" tabindex="-1"></a>    form<span class="op">.</span><span class="fu">append</span>(</span>
<span id="cb90-1769"><a href="#cb90-1769" aria-hidden="true" tabindex="-1"></a>      <span class="fu">html</span><span class="vs">`&lt;div style="font-size: 0.85rem; font-style: italic; margin-top: 3px;"&gt;</span><span class="sc">${</span>description<span class="sc">}</span><span class="vs">&lt;/div&gt;`</span></span>
<span id="cb90-1770"><a href="#cb90-1770" aria-hidden="true" tabindex="-1"></a>    )<span class="op">;</span></span>
<span id="cb90-1771"><a href="#cb90-1771" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (format)</span>
<span id="cb90-1772"><a href="#cb90-1772" aria-hidden="true" tabindex="-1"></a>    format <span class="op">=</span> <span class="kw">typeof</span> format <span class="op">===</span> <span class="st">"function"</span> <span class="op">?</span> format <span class="op">:</span> d3format<span class="op">.</span><span class="fu">format</span>(format)<span class="op">;</span></span>
<span id="cb90-1773"><a href="#cb90-1773" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (action) {</span>
<span id="cb90-1774"><a href="#cb90-1774" aria-hidden="true" tabindex="-1"></a>    <span class="fu">action</span>(form)<span class="op">;</span></span>
<span id="cb90-1775"><a href="#cb90-1775" aria-hidden="true" tabindex="-1"></a>  } <span class="cf">else</span> {</span>
<span id="cb90-1776"><a href="#cb90-1776" aria-hidden="true" tabindex="-1"></a>    <span class="kw">const</span> verb <span class="op">=</span> submit</span>
<span id="cb90-1777"><a href="#cb90-1777" aria-hidden="true" tabindex="-1"></a>      <span class="op">?</span> <span class="st">"onsubmit"</span></span>
<span id="cb90-1778"><a href="#cb90-1778" aria-hidden="true" tabindex="-1"></a>      <span class="op">:</span> type <span class="op">==</span> <span class="st">"button"</span></span>
<span id="cb90-1779"><a href="#cb90-1779" aria-hidden="true" tabindex="-1"></a>      <span class="op">?</span> <span class="st">"onclick"</span></span>
<span id="cb90-1780"><a href="#cb90-1780" aria-hidden="true" tabindex="-1"></a>      <span class="op">:</span> type <span class="op">==</span> <span class="st">"checkbox"</span> <span class="op">||</span> type <span class="op">==</span> <span class="st">"radio"</span></span>
<span id="cb90-1781"><a href="#cb90-1781" aria-hidden="true" tabindex="-1"></a>      <span class="op">?</span> <span class="st">"onchange"</span></span>
<span id="cb90-1782"><a href="#cb90-1782" aria-hidden="true" tabindex="-1"></a>      <span class="op">:</span> <span class="st">"oninput"</span><span class="op">;</span></span>
<span id="cb90-1783"><a href="#cb90-1783" aria-hidden="true" tabindex="-1"></a>    form[verb] <span class="op">=</span> e <span class="kw">=&gt;</span> {</span>
<span id="cb90-1784"><a href="#cb90-1784" aria-hidden="true" tabindex="-1"></a>      e <span class="op">&amp;&amp;</span> e<span class="op">.</span><span class="fu">preventDefault</span>()<span class="op">;</span></span>
<span id="cb90-1785"><a href="#cb90-1785" aria-hidden="true" tabindex="-1"></a>      <span class="kw">const</span> value <span class="op">=</span> getValue <span class="op">?</span> <span class="fu">getValue</span>(form<span class="op">.</span><span class="at">input</span>) <span class="op">:</span> form<span class="op">.</span><span class="at">input</span><span class="op">.</span><span class="at">value</span><span class="op">;</span></span>
<span id="cb90-1786"><a href="#cb90-1786" aria-hidden="true" tabindex="-1"></a>      <span class="cf">if</span> (form<span class="op">.</span><span class="at">output</span>) {</span>
<span id="cb90-1787"><a href="#cb90-1787" aria-hidden="true" tabindex="-1"></a>        <span class="kw">const</span> out <span class="op">=</span> display <span class="op">?</span> <span class="fu">display</span>(value) <span class="op">:</span> format <span class="op">?</span> <span class="fu">format</span>(value) <span class="op">:</span> value<span class="op">;</span></span>
<span id="cb90-1788"><a href="#cb90-1788" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> (out <span class="kw">instanceof</span> <span class="bu">window</span><span class="op">.</span><span class="at">Element</span>) {</span>
<span id="cb90-1789"><a href="#cb90-1789" aria-hidden="true" tabindex="-1"></a>          <span class="cf">while</span> (form<span class="op">.</span><span class="at">output</span><span class="op">.</span><span class="fu">hasChildNodes</span>()) {</span>
<span id="cb90-1790"><a href="#cb90-1790" aria-hidden="true" tabindex="-1"></a>            form<span class="op">.</span><span class="at">output</span><span class="op">.</span><span class="fu">removeChild</span>(form<span class="op">.</span><span class="at">output</span><span class="op">.</span><span class="at">lastChild</span>)<span class="op">;</span></span>
<span id="cb90-1791"><a href="#cb90-1791" aria-hidden="true" tabindex="-1"></a>          }</span>
<span id="cb90-1792"><a href="#cb90-1792" aria-hidden="true" tabindex="-1"></a>          form<span class="op">.</span><span class="at">output</span><span class="op">.</span><span class="fu">append</span>(out)<span class="op">;</span></span>
<span id="cb90-1793"><a href="#cb90-1793" aria-hidden="true" tabindex="-1"></a>        } <span class="cf">else</span> {</span>
<span id="cb90-1794"><a href="#cb90-1794" aria-hidden="true" tabindex="-1"></a>          form<span class="op">.</span><span class="at">output</span><span class="op">.</span><span class="at">value</span> <span class="op">=</span> out<span class="op">;</span></span>
<span id="cb90-1795"><a href="#cb90-1795" aria-hidden="true" tabindex="-1"></a>        }</span>
<span id="cb90-1796"><a href="#cb90-1796" aria-hidden="true" tabindex="-1"></a>      }</span>
<span id="cb90-1797"><a href="#cb90-1797" aria-hidden="true" tabindex="-1"></a>      form<span class="op">.</span><span class="at">value</span> <span class="op">=</span> value<span class="op">;</span></span>
<span id="cb90-1798"><a href="#cb90-1798" aria-hidden="true" tabindex="-1"></a>      <span class="cf">if</span> (verb <span class="op">!==</span> <span class="st">"oninput"</span>)</span>
<span id="cb90-1799"><a href="#cb90-1799" aria-hidden="true" tabindex="-1"></a>        form<span class="op">.</span><span class="fu">dispatchEvent</span>(<span class="kw">new</span> <span class="bu">CustomEvent</span>(<span class="st">"input"</span><span class="op">,</span> { <span class="dt">bubbles</span><span class="op">:</span> <span class="kw">true</span> }))<span class="op">;</span></span>
<span id="cb90-1800"><a href="#cb90-1800" aria-hidden="true" tabindex="-1"></a>    }<span class="op">;</span></span>
<span id="cb90-1801"><a href="#cb90-1801" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> (verb <span class="op">!==</span> <span class="st">"oninput"</span>)</span>
<span id="cb90-1802"><a href="#cb90-1802" aria-hidden="true" tabindex="-1"></a>      wrapper<span class="op">.</span><span class="at">oninput</span> <span class="op">=</span> e <span class="kw">=&gt;</span> e <span class="op">&amp;&amp;</span> e<span class="op">.</span><span class="fu">stopPropagation</span>() <span class="op">&amp;&amp;</span> e<span class="op">.</span><span class="fu">preventDefault</span>()<span class="op">;</span></span>
<span id="cb90-1803"><a href="#cb90-1803" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> (verb <span class="op">!==</span> <span class="st">"onsubmit"</span>) form<span class="op">.</span><span class="at">onsubmit</span> <span class="op">=</span> e <span class="kw">=&gt;</span> e <span class="op">&amp;&amp;</span> e<span class="op">.</span><span class="fu">preventDefault</span>()<span class="op">;</span></span>
<span id="cb90-1804"><a href="#cb90-1804" aria-hidden="true" tabindex="-1"></a>    form[verb]()<span class="op">;</span></span>
<span id="cb90-1805"><a href="#cb90-1805" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb90-1806"><a href="#cb90-1806" aria-hidden="true" tabindex="-1"></a>  <span class="cf">while</span> (form<span class="op">.</span><span class="at">childNodes</span><span class="op">.</span><span class="at">length</span>) {</span>
<span id="cb90-1807"><a href="#cb90-1807" aria-hidden="true" tabindex="-1"></a>    wrapper<span class="op">.</span><span class="fu">appendChild</span>(form<span class="op">.</span><span class="at">childNodes</span>[<span class="dv">0</span>])<span class="op">;</span></span>
<span id="cb90-1808"><a href="#cb90-1808" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb90-1809"><a href="#cb90-1809" aria-hidden="true" tabindex="-1"></a>  form<span class="op">.</span><span class="fu">append</span>(wrapper)<span class="op">;</span></span>
<span id="cb90-1810"><a href="#cb90-1810" aria-hidden="true" tabindex="-1"></a>  <span class="cf">return</span> form<span class="op">;</span></span>
<span id="cb90-1811"><a href="#cb90-1811" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb90-1812"><a href="#cb90-1812" aria-hidden="true" tabindex="-1"></a>d3format <span class="op">=</span> <span class="pp">require</span>(<span class="st">"d3-format@1"</span>)</span>
<span id="cb90-1813"><a href="#cb90-1813" aria-hidden="true" tabindex="-1"></a><span class="co">// https://observablehq.com/@enjalot/draggable-world-map-coordinates-input</span></span>
<span id="cb90-1814"><a href="#cb90-1814" aria-hidden="true" tabindex="-1"></a><span class="kw">function</span> <span class="fu">worldMapCoordinates</span>(config <span class="op">=</span> {}<span class="op">,</span> dimensions) {</span>
<span id="cb90-1815"><a href="#cb90-1815" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> {</span>
<span id="cb90-1816"><a href="#cb90-1816" aria-hidden="true" tabindex="-1"></a>    value <span class="op">=</span> []<span class="op">,</span> title<span class="op">,</span> description<span class="op">,</span> width <span class="op">=</span> dimensions[<span class="dv">0</span>]</span>
<span id="cb90-1817"><a href="#cb90-1817" aria-hidden="true" tabindex="-1"></a>  } <span class="op">=</span> <span class="bu">Array</span><span class="op">.</span><span class="fu">isArray</span>(config) <span class="op">?</span> {<span class="dt">value</span><span class="op">:</span> config[<span class="dv">0</span>]} <span class="op">:</span> config<span class="op">;</span></span>
<span id="cb90-1818"><a href="#cb90-1818" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> height <span class="op">=</span> dimensions[<span class="dv">1</span>]<span class="op">;</span></span>
<span id="cb90-1819"><a href="#cb90-1819" aria-hidden="true" tabindex="-1"></a>  <span class="kw">let</span> [lon<span class="op">,</span> lat] <span class="op">=</span> value<span class="op">;</span></span>
<span id="cb90-1820"><a href="#cb90-1820" aria-hidden="true" tabindex="-1"></a>  lon <span class="op">=</span> lon <span class="op">!=</span> <span class="kw">null</span> <span class="op">?</span> lon <span class="op">:</span> <span class="kw">null</span><span class="op">;</span></span>
<span id="cb90-1821"><a href="#cb90-1821" aria-hidden="true" tabindex="-1"></a>  lat <span class="op">=</span> lat <span class="op">!=</span> <span class="kw">null</span> <span class="op">?</span> lat <span class="op">:</span> <span class="kw">null</span><span class="op">;</span></span>
<span id="cb90-1822"><a href="#cb90-1822" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> formEl <span class="op">=</span> <span class="fu">html</span><span class="vs">`&lt;form id="formEl" style="width: </span><span class="sc">${</span>width<span class="sc">}</span><span class="vs">px;"&gt;&lt;/form&gt;`</span><span class="op">;</span></span>
<span id="cb90-1823"><a href="#cb90-1823" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> context <span class="op">=</span> DOM<span class="op">.</span><span class="fu">context2d</span>(width<span class="op">,</span> height)<span class="op">;</span></span>
<span id="cb90-1824"><a href="#cb90-1824" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> canvas <span class="op">=</span> context<span class="op">.</span><span class="at">canvas</span><span class="op">;</span></span>
<span id="cb90-1825"><a href="#cb90-1825" aria-hidden="true" tabindex="-1"></a>  canvas<span class="op">.</span><span class="at">style</span><span class="op">.</span><span class="at">margin</span> <span class="op">=</span> <span class="vs">`10px 0px 0px 0px`</span><span class="op">;</span></span>
<span id="cb90-1826"><a href="#cb90-1826" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> projection <span class="op">=</span> config[<span class="dv">1</span>]</span>
<span id="cb90-1827"><a href="#cb90-1827" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">precision</span>(<span class="fl">0.1</span>)</span>
<span id="cb90-1828"><a href="#cb90-1828" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">fitSize</span>([width<span class="op">,</span> height]<span class="op">,</span> { <span class="dt">type</span><span class="op">:</span> <span class="st">"Sphere"</span> })<span class="op">;</span></span>
<span id="cb90-1829"><a href="#cb90-1829" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> path <span class="op">=</span> d3<span class="op">.</span><span class="fu">geoPath</span>(projection<span class="op">,</span> context)<span class="op">.</span><span class="fu">pointRadius</span>(<span class="fl">2.5</span>)<span class="op">;</span></span>
<span id="cb90-1830"><a href="#cb90-1830" aria-hidden="true" tabindex="-1"></a>  formEl<span class="op">.</span><span class="fu">append</span>(canvas)<span class="op">;</span></span>
<span id="cb90-1831"><a href="#cb90-1831" aria-hidden="true" tabindex="-1"></a>  <span class="kw">function</span> <span class="fu">fillMesh</span>(f) {</span>
<span id="cb90-1832"><a href="#cb90-1832" aria-hidden="true" tabindex="-1"></a>    context<span class="op">.</span><span class="fu">beginPath</span>()<span class="op">;</span></span>
<span id="cb90-1833"><a href="#cb90-1833" aria-hidden="true" tabindex="-1"></a>    <span class="fu">path</span>(f)<span class="op">;</span></span>
<span id="cb90-1834"><a href="#cb90-1834" aria-hidden="true" tabindex="-1"></a>    context<span class="op">.</span><span class="at">fillStyle</span> <span class="op">=</span> <span class="fu">zonecolor</span>(f<span class="op">.</span><span class="at">properties</span><span class="op">.</span><span class="at">zone</span>)<span class="op">;</span></span>
<span id="cb90-1835"><a href="#cb90-1835" aria-hidden="true" tabindex="-1"></a>    context<span class="op">.</span><span class="fu">fill</span>()<span class="op">;</span></span>
<span id="cb90-1836"><a href="#cb90-1836" aria-hidden="true" tabindex="-1"></a>    context<span class="op">.</span><span class="at">innerHTML</span> <span class="op">=</span> <span class="vs">`&lt;title&gt;</span><span class="sc">${</span>f<span class="op">.</span><span class="at">properties</span><span class="op">.</span><span class="at">places</span><span class="sc">}</span><span class="vs"> </span><span class="sc">${</span>f<span class="op">.</span><span class="at">properties</span><span class="op">.</span><span class="at">time_zone</span><span class="sc">}</span><span class="vs">&lt;/title&gt;`</span><span class="op">;</span></span>
<span id="cb90-1837"><a href="#cb90-1837" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb90-1838"><a href="#cb90-1838" aria-hidden="true" tabindex="-1"></a>  <span class="kw">function</span> <span class="fu">draw</span>() {</span>
<span id="cb90-1839"><a href="#cb90-1839" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> (<span class="op">!</span>utctoggle) {</span>
<span id="cb90-1840"><a href="#cb90-1840" aria-hidden="true" tabindex="-1"></a>      context<span class="op">.</span><span class="fu">beginPath</span>()<span class="op">;</span> <span class="fu">path</span>({<span class="dt">type</span><span class="op">:</span> <span class="st">"Sphere"</span>})<span class="op">;</span></span>
<span id="cb90-1841"><a href="#cb90-1841" aria-hidden="true" tabindex="-1"></a>      context<span class="op">.</span><span class="at">fillStyle</span> <span class="op">=</span> <span class="bu">window</span><span class="op">.</span><span class="at">darkmode</span> <span class="op">?</span> <span class="st">"#007FFF"</span> <span class="op">:</span> mapcolors<span class="op">.</span><span class="at">ocean</span><span class="op">;</span></span>
<span id="cb90-1842"><a href="#cb90-1842" aria-hidden="true" tabindex="-1"></a>      context<span class="op">.</span><span class="fu">fill</span>()<span class="op">;</span></span>
<span id="cb90-1843"><a href="#cb90-1843" aria-hidden="true" tabindex="-1"></a>      <span class="cf">if</span> (gridtoggle) {</span>
<span id="cb90-1844"><a href="#cb90-1844" aria-hidden="true" tabindex="-1"></a>        deczones<span class="op">.</span><span class="fu">map</span>((f<span class="op">,</span> i) <span class="kw">=&gt;</span>  {</span>
<span id="cb90-1845"><a href="#cb90-1845" aria-hidden="true" tabindex="-1"></a>          context<span class="op">.</span><span class="fu">beginPath</span>()<span class="op">;</span></span>
<span id="cb90-1846"><a href="#cb90-1846" aria-hidden="true" tabindex="-1"></a>          <span class="fu">path</span>(f)<span class="op">;</span></span>
<span id="cb90-1847"><a href="#cb90-1847" aria-hidden="true" tabindex="-1"></a>          context<span class="op">.</span><span class="at">fillStyle</span> <span class="op">=</span> hsla10[i]<span class="op">;</span></span>
<span id="cb90-1848"><a href="#cb90-1848" aria-hidden="true" tabindex="-1"></a>          context<span class="op">.</span><span class="fu">fill</span>()<span class="op">;</span></span>
<span id="cb90-1849"><a href="#cb90-1849" aria-hidden="true" tabindex="-1"></a>        })</span>
<span id="cb90-1850"><a href="#cb90-1850" aria-hidden="true" tabindex="-1"></a>      }</span>
<span id="cb90-1851"><a href="#cb90-1851" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb90-1852"><a href="#cb90-1852" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> (utctoggle) {</span>
<span id="cb90-1853"><a href="#cb90-1853" aria-hidden="true" tabindex="-1"></a>      zones<span class="op">.</span><span class="fu">map</span>(f <span class="kw">=&gt;</span> <span class="fu">fillMesh</span>(f))</span>
<span id="cb90-1854"><a href="#cb90-1854" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb90-1855"><a href="#cb90-1855" aria-hidden="true" tabindex="-1"></a>    context<span class="op">.</span><span class="fu">beginPath</span>()<span class="op">;</span></span>
<span id="cb90-1856"><a href="#cb90-1856" aria-hidden="true" tabindex="-1"></a>    <span class="fu">path</span>(land)<span class="op">;</span></span>
<span id="cb90-1857"><a href="#cb90-1857" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> (<span class="op">!</span>utctoggle) {</span>
<span id="cb90-1858"><a href="#cb90-1858" aria-hidden="true" tabindex="-1"></a>      context<span class="op">.</span><span class="at">fillStyle</span> <span class="op">=</span> <span class="bu">window</span><span class="op">.</span><span class="at">darkmode</span> <span class="op">?</span> <span class="st">"#0808"</span> <span class="op">:</span> mapcolors<span class="op">.</span><span class="at">land</span><span class="op">;</span></span>
<span id="cb90-1859"><a href="#cb90-1859" aria-hidden="true" tabindex="-1"></a>      context<span class="op">.</span><span class="fu">fill</span>()<span class="op">;</span></span>
<span id="cb90-1860"><a href="#cb90-1860" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb90-1861"><a href="#cb90-1861" aria-hidden="true" tabindex="-1"></a>    context<span class="op">.</span><span class="at">strokeStyle</span> <span class="op">=</span> <span class="vs">`#000`</span><span class="op">;</span></span>
<span id="cb90-1862"><a href="#cb90-1862" aria-hidden="true" tabindex="-1"></a>    context<span class="op">.</span><span class="fu">stroke</span>()<span class="op">;</span></span>
<span id="cb90-1863"><a href="#cb90-1863" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> (bordertoggle) {</span>
<span id="cb90-1864"><a href="#cb90-1864" aria-hidden="true" tabindex="-1"></a>      context<span class="op">.</span><span class="fu">beginPath</span>()<span class="op">;</span></span>
<span id="cb90-1865"><a href="#cb90-1865" aria-hidden="true" tabindex="-1"></a>      <span class="fu">path</span>(borders)<span class="op">;</span></span>
<span id="cb90-1866"><a href="#cb90-1866" aria-hidden="true" tabindex="-1"></a>      context<span class="op">.</span><span class="at">lineWidth</span> <span class="op">=</span> <span class="fl">1.25</span><span class="op">;</span></span>
<span id="cb90-1867"><a href="#cb90-1867" aria-hidden="true" tabindex="-1"></a>      context<span class="op">.</span><span class="at">strokeStyle</span> <span class="op">=</span> <span class="bu">window</span><span class="op">.</span><span class="at">darkmode</span> <span class="op">?</span> <span class="st">"#aaa"</span> <span class="op">:</span> <span class="st">"#333"</span><span class="op">;</span></span>
<span id="cb90-1868"><a href="#cb90-1868" aria-hidden="true" tabindex="-1"></a>      context<span class="op">.</span><span class="fu">stroke</span>()<span class="op">;</span></span>
<span id="cb90-1869"><a href="#cb90-1869" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb90-1870"><a href="#cb90-1870" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> (utctoggle) {</span>
<span id="cb90-1871"><a href="#cb90-1871" aria-hidden="true" tabindex="-1"></a>      context<span class="op">.</span><span class="fu">beginPath</span>()<span class="op">;</span></span>
<span id="cb90-1872"><a href="#cb90-1872" aria-hidden="true" tabindex="-1"></a>      <span class="fu">path</span>(mesh)<span class="op">;</span></span>
<span id="cb90-1873"><a href="#cb90-1873" aria-hidden="true" tabindex="-1"></a>      context<span class="op">.</span><span class="at">lineWidth</span> <span class="op">=</span> <span class="fl">1.25</span><span class="op">;</span></span>
<span id="cb90-1874"><a href="#cb90-1874" aria-hidden="true" tabindex="-1"></a>      context<span class="op">.</span><span class="at">strokeStyle</span> <span class="op">=</span> <span class="vs">`#999`</span><span class="op">;</span></span>
<span id="cb90-1875"><a href="#cb90-1875" aria-hidden="true" tabindex="-1"></a>      context<span class="op">.</span><span class="fu">stroke</span>()<span class="op">;</span></span>
<span id="cb90-1876"><a href="#cb90-1876" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb90-1877"><a href="#cb90-1877" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> (gridtoggle) {</span>
<span id="cb90-1878"><a href="#cb90-1878" aria-hidden="true" tabindex="-1"></a>      context<span class="op">.</span><span class="fu">beginPath</span>()<span class="op">;</span></span>
<span id="cb90-1879"><a href="#cb90-1879" aria-hidden="true" tabindex="-1"></a>      <span class="fu">path</span>(graticule)<span class="op">;</span></span>
<span id="cb90-1880"><a href="#cb90-1880" aria-hidden="true" tabindex="-1"></a>      context<span class="op">.</span><span class="at">lineWidth</span> <span class="op">=</span> <span class="fl">1.25</span><span class="op">;</span></span>
<span id="cb90-1881"><a href="#cb90-1881" aria-hidden="true" tabindex="-1"></a>      context<span class="op">.</span><span class="at">strokeStyle</span> <span class="op">=</span> utctoggle <span class="op">||</span> <span class="op">!</span><span class="bu">window</span><span class="op">.</span><span class="at">darkmode</span> <span class="op">?</span> <span class="st">"#000"</span> <span class="op">:</span> <span class="st">"#fff"</span><span class="op">;</span></span>
<span id="cb90-1882"><a href="#cb90-1882" aria-hidden="true" tabindex="-1"></a>      context<span class="op">.</span><span class="fu">stroke</span>()<span class="op">;</span></span>
<span id="cb90-1883"><a href="#cb90-1883" aria-hidden="true" tabindex="-1"></a>      context<span class="op">.</span><span class="at">fillStyle</span> <span class="op">=</span> <span class="st">"#000"</span><span class="op">;</span></span>
<span id="cb90-1884"><a href="#cb90-1884" aria-hidden="true" tabindex="-1"></a>      context<span class="op">.</span><span class="at">font</span> <span class="op">=</span> width <span class="op">&lt;</span> <span class="dv">760</span> <span class="op">?</span> <span class="st">"14px serif"</span> <span class="op">:</span> width <span class="op">&lt;</span> <span class="dv">990</span> <span class="op">?</span> <span class="st">"17px serif"</span> <span class="op">:</span> <span class="st">"23px serif"</span><span class="op">;</span></span>
<span id="cb90-1885"><a href="#cb90-1885" aria-hidden="true" tabindex="-1"></a>      d3<span class="op">.</span><span class="fu">range</span>(<span class="op">-</span><span class="fl">1.5</span><span class="op">,</span> <span class="dv">342</span> <span class="op">+</span> <span class="dv">1</span><span class="op">,</span> <span class="dv">36</span>)<span class="op">.</span><span class="fu">map</span>(x <span class="kw">=&gt;</span>  context<span class="op">.</span><span class="fu">fillText</span>(<span class="fu">long2zone</span>(x)<span class="op">,</span> <span class="op">...</span><span class="fu">projection</span>([x<span class="op">,</span> <span class="fl">54.7</span>])))<span class="op">;</span></span>
<span id="cb90-1886"><a href="#cb90-1886" aria-hidden="true" tabindex="-1"></a>      d3<span class="op">.</span><span class="fu">range</span>(<span class="op">-</span><span class="fl">1.5</span><span class="op">,</span> <span class="dv">342</span> <span class="op">+</span> <span class="dv">1</span><span class="op">,</span> <span class="dv">36</span>)<span class="op">.</span><span class="fu">map</span>(x <span class="kw">=&gt;</span>  context<span class="op">.</span><span class="fu">fillText</span>(<span class="fu">long2zone</span>(x)<span class="op">,</span> <span class="op">...</span><span class="fu">projection</span>([x<span class="op">,</span> <span class="op">-</span><span class="fl">59.7</span>])))<span class="op">;</span></span>
<span id="cb90-1887"><a href="#cb90-1887" aria-hidden="true" tabindex="-1"></a>      <span class="co">// context.font = width &lt; 760 ? "12px serif" : "21px serif";</span></span>
<span id="cb90-1888"><a href="#cb90-1888" aria-hidden="true" tabindex="-1"></a>      <span class="co">// context.fillStyle = `#000`;</span></span>
<span id="cb90-1889"><a href="#cb90-1889" aria-hidden="true" tabindex="-1"></a>      <span class="co">// d3.range(-1.5, 342 + 1, 36).map(x =&gt;  context.fillText(long2zone(x), ...projection([x, 27.5])));</span></span>
<span id="cb90-1890"><a href="#cb90-1890" aria-hidden="true" tabindex="-1"></a>      <span class="co">// d3.range(-1.5, 342 + 1, 36).map(x =&gt;  context.fillText(long2zone(x), ...projection([x, -48])));</span></span>
<span id="cb90-1891"><a href="#cb90-1891" aria-hidden="true" tabindex="-1"></a>      <span class="co">// d3.range(-18, 336 + 1, 36).map(x =&gt; context.fillText(formatLongitude(x), ...projection([x, 90])));</span></span>
<span id="cb90-1892"><a href="#cb90-1892" aria-hidden="true" tabindex="-1"></a>      <span class="co">// d3.range(-18, 336 + 1, 36).map(x =&gt; context.fillText(formatLongitude(x), ...projection([x, -90])));</span></span>
<span id="cb90-1893"><a href="#cb90-1893" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb90-1894"><a href="#cb90-1894" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> (suntoggle) {</span>
<span id="cb90-1895"><a href="#cb90-1895" aria-hidden="true" tabindex="-1"></a>      context<span class="op">.</span><span class="fu">beginPath</span>()<span class="op">;</span></span>
<span id="cb90-1896"><a href="#cb90-1896" aria-hidden="true" tabindex="-1"></a>      <span class="fu">path</span>(night)<span class="op">;</span></span>
<span id="cb90-1897"><a href="#cb90-1897" aria-hidden="true" tabindex="-1"></a>      context<span class="op">.</span><span class="at">fillStyle</span> <span class="op">=</span> <span class="st">"rgba(0,0,255,0.3)"</span><span class="op">;</span></span>
<span id="cb90-1898"><a href="#cb90-1898" aria-hidden="true" tabindex="-1"></a>      context<span class="op">.</span><span class="fu">fill</span>()<span class="op">;</span></span>
<span id="cb90-1899"><a href="#cb90-1899" aria-hidden="true" tabindex="-1"></a>      context<span class="op">.</span><span class="fu">beginPath</span>()<span class="op">;</span></span>
<span id="cb90-1900"><a href="#cb90-1900" aria-hidden="true" tabindex="-1"></a>      path<span class="op">.</span><span class="fu">pointRadius</span>(width <span class="op">/</span> <span class="dv">84</span> <span class="op">+</span> <span class="dv">5</span>)<span class="op">;</span></span>
<span id="cb90-1901"><a href="#cb90-1901" aria-hidden="true" tabindex="-1"></a>      <span class="fu">path</span>({<span class="dt">type</span><span class="op">:</span> <span class="st">"Point"</span><span class="op">,</span> <span class="dt">coordinates</span><span class="op">:</span> sun})<span class="op">;</span></span>
<span id="cb90-1902"><a href="#cb90-1902" aria-hidden="true" tabindex="-1"></a>      context<span class="op">.</span><span class="at">strokeStyle</span> <span class="op">=</span> <span class="st">"#0009"</span><span class="op">;</span></span>
<span id="cb90-1903"><a href="#cb90-1903" aria-hidden="true" tabindex="-1"></a>      context<span class="op">.</span><span class="at">fillStyle</span> <span class="op">=</span> <span class="st">"#ff0b"</span><span class="op">;</span></span>
<span id="cb90-1904"><a href="#cb90-1904" aria-hidden="true" tabindex="-1"></a>      context<span class="op">.</span><span class="at">lineWidth</span> <span class="op">=</span> <span class="dv">1</span><span class="op">;</span></span>
<span id="cb90-1905"><a href="#cb90-1905" aria-hidden="true" tabindex="-1"></a>      context<span class="op">.</span><span class="fu">stroke</span>()<span class="op">;</span></span>
<span id="cb90-1906"><a href="#cb90-1906" aria-hidden="true" tabindex="-1"></a>      context<span class="op">.</span><span class="fu">fill</span>()<span class="op">;</span></span>
<span id="cb90-1907"><a href="#cb90-1907" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb90-1908"><a href="#cb90-1908" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> (lon <span class="op">!=</span> <span class="kw">null</span> <span class="op">&amp;&amp;</span> lat <span class="op">!=</span> <span class="kw">null</span>) {</span>
<span id="cb90-1909"><a href="#cb90-1909" aria-hidden="true" tabindex="-1"></a>      path<span class="op">.</span><span class="fu">pointRadius</span>(<span class="dv">17</span>)<span class="op">;</span> context<span class="op">.</span><span class="at">strokeStyle</span> <span class="op">=</span> <span class="st">"black"</span><span class="op">;</span></span>
<span id="cb90-1910"><a href="#cb90-1910" aria-hidden="true" tabindex="-1"></a>      context<span class="op">.</span><span class="fu">beginPath</span>()<span class="op">;</span> <span class="fu">path</span>({<span class="dt">type</span><span class="op">:</span> <span class="st">"Point"</span><span class="op">,</span> <span class="dt">coordinates</span><span class="op">:</span> [lon<span class="op">,</span> lat]})<span class="op">;</span> context<span class="op">.</span><span class="at">lineWidth</span> <span class="op">=</span> <span class="dv">1</span><span class="op">;</span> context<span class="op">.</span><span class="fu">stroke</span>()<span class="op">;</span></span>
<span id="cb90-1911"><a href="#cb90-1911" aria-hidden="true" tabindex="-1"></a>      context<span class="op">.</span><span class="at">lineWidth</span> <span class="op">=</span> <span class="dv">6</span><span class="op">;</span></span>
<span id="cb90-1912"><a href="#cb90-1912" aria-hidden="true" tabindex="-1"></a>      path<span class="op">.</span><span class="fu">pointRadius</span>(<span class="dv">14</span>)<span class="op">;</span> context<span class="op">.</span><span class="at">strokeStyle</span> <span class="op">=</span> <span class="st">"red"</span><span class="op">;</span></span>
<span id="cb90-1913"><a href="#cb90-1913" aria-hidden="true" tabindex="-1"></a>      context<span class="op">.</span><span class="fu">beginPath</span>()<span class="op">;</span> <span class="fu">path</span>({<span class="dt">type</span><span class="op">:</span> <span class="st">"Point"</span><span class="op">,</span> <span class="dt">coordinates</span><span class="op">:</span> [lon<span class="op">,</span> lat]})<span class="op">;</span> context<span class="op">.</span><span class="fu">stroke</span>()<span class="op">;</span></span>
<span id="cb90-1914"><a href="#cb90-1914" aria-hidden="true" tabindex="-1"></a>      context<span class="op">.</span><span class="at">lineWidth</span> <span class="op">=</span> <span class="dv">1</span><span class="op">;</span></span>
<span id="cb90-1915"><a href="#cb90-1915" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb90-1916"><a href="#cb90-1916" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb90-1917"><a href="#cb90-1917" aria-hidden="true" tabindex="-1"></a>  <span class="kw">let</span> drag <span class="op">=</span> d3<span class="op">.</span><span class="fu">drag</span>()</span>
<span id="cb90-1918"><a href="#cb90-1918" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">on</span>(<span class="st">"drag"</span><span class="op">,</span> (<span class="bu">event</span>) <span class="kw">=&gt;</span> {</span>
<span id="cb90-1919"><a href="#cb90-1919" aria-hidden="true" tabindex="-1"></a>      <span class="kw">let</span> coords <span class="op">=</span> projection<span class="op">.</span><span class="fu">invert</span>([<span class="bu">event</span><span class="op">.</span><span class="at">x</span><span class="op">,</span> <span class="bu">event</span><span class="op">.</span><span class="at">y</span>])<span class="op">;</span></span>
<span id="cb90-1920"><a href="#cb90-1920" aria-hidden="true" tabindex="-1"></a>      lon <span class="op">=</span> <span class="op">+</span>coords[<span class="dv">0</span>]<span class="op">.</span><span class="fu">toFixed</span>(<span class="dv">2</span>)<span class="op">;</span></span>
<span id="cb90-1921"><a href="#cb90-1921" aria-hidden="true" tabindex="-1"></a>      lat <span class="op">=</span> <span class="op">+</span>coords[<span class="dv">1</span>]<span class="op">.</span><span class="fu">toFixed</span>(<span class="dv">2</span>)<span class="op">;</span></span>
<span id="cb90-1922"><a href="#cb90-1922" aria-hidden="true" tabindex="-1"></a>      <span class="fu">draw</span>()<span class="op">;</span></span>
<span id="cb90-1923"><a href="#cb90-1923" aria-hidden="true" tabindex="-1"></a>      canvas<span class="op">.</span><span class="fu">dispatchEvent</span>(<span class="kw">new</span> <span class="bu">CustomEvent</span>(<span class="st">"input"</span><span class="op">,</span> { <span class="dt">bubbles</span><span class="op">:</span> <span class="kw">true</span> }))<span class="op">;</span></span>
<span id="cb90-1924"><a href="#cb90-1924" aria-hidden="true" tabindex="-1"></a>    })</span>
<span id="cb90-1925"><a href="#cb90-1925" aria-hidden="true" tabindex="-1"></a>  d3<span class="op">.</span><span class="fu">select</span>(canvas)<span class="op">.</span><span class="fu">call</span>(drag)</span>
<span id="cb90-1926"><a href="#cb90-1926" aria-hidden="true" tabindex="-1"></a>  canvas<span class="op">.</span><span class="at">onclick</span> <span class="op">=</span> <span class="kw">function</span>(ev) {</span>
<span id="cb90-1927"><a href="#cb90-1927" aria-hidden="true" tabindex="-1"></a>    <span class="kw">const</span> { offsetX<span class="op">,</span> offsetY } <span class="op">=</span> ev<span class="op">;</span></span>
<span id="cb90-1928"><a href="#cb90-1928" aria-hidden="true" tabindex="-1"></a>    <span class="kw">let</span> coords <span class="op">=</span> projection<span class="op">.</span><span class="fu">invert</span>([offsetX<span class="op">,</span> offsetY])<span class="op">;</span></span>
<span id="cb90-1929"><a href="#cb90-1929" aria-hidden="true" tabindex="-1"></a>    lon <span class="op">=</span> <span class="op">+</span>coords[<span class="dv">0</span>]<span class="op">.</span><span class="fu">toFixed</span>(<span class="dv">2</span>)<span class="op">;</span></span>
<span id="cb90-1930"><a href="#cb90-1930" aria-hidden="true" tabindex="-1"></a>    lat <span class="op">=</span> <span class="op">+</span>coords[<span class="dv">1</span>]<span class="op">.</span><span class="fu">toFixed</span>(<span class="dv">2</span>)<span class="op">;</span></span>
<span id="cb90-1931"><a href="#cb90-1931" aria-hidden="true" tabindex="-1"></a>    <span class="fu">draw</span>()<span class="op">;</span></span>
<span id="cb90-1932"><a href="#cb90-1932" aria-hidden="true" tabindex="-1"></a>    canvas<span class="op">.</span><span class="fu">dispatchEvent</span>(<span class="kw">new</span> <span class="bu">CustomEvent</span>(<span class="st">"input"</span><span class="op">,</span> { <span class="dt">bubbles</span><span class="op">:</span> <span class="kw">true</span> }))<span class="op">;</span></span>
<span id="cb90-1933"><a href="#cb90-1933" aria-hidden="true" tabindex="-1"></a>  }<span class="op">;</span></span>
<span id="cb90-1934"><a href="#cb90-1934" aria-hidden="true" tabindex="-1"></a>  <span class="fu">draw</span>()<span class="op">;</span></span>
<span id="cb90-1935"><a href="#cb90-1935" aria-hidden="true" tabindex="-1"></a>  <span class="kw">function</span> <span class="fu">resetlatlon</span>() {</span>
<span id="cb90-1936"><a href="#cb90-1936" aria-hidden="true" tabindex="-1"></a>    lon <span class="op">=</span> <span class="dv">160</span><span class="op">;</span></span>
<span id="cb90-1937"><a href="#cb90-1937" aria-hidden="true" tabindex="-1"></a>    lat <span class="op">=</span> <span class="dv">0</span><span class="op">;</span></span>
<span id="cb90-1938"><a href="#cb90-1938" aria-hidden="true" tabindex="-1"></a>    <span class="kw">set</span>(viewof bordertoggle<span class="op">,</span> <span class="kw">false</span>)<span class="op">;</span></span>
<span id="cb90-1939"><a href="#cb90-1939" aria-hidden="true" tabindex="-1"></a>    <span class="kw">set</span>(viewof gridtoggle<span class="op">,</span> <span class="kw">false</span>)<span class="op">;</span></span>
<span id="cb90-1940"><a href="#cb90-1940" aria-hidden="true" tabindex="-1"></a>    <span class="kw">set</span>(viewof suntoggle<span class="op">,</span> <span class="kw">false</span>)<span class="op">;</span></span>
<span id="cb90-1941"><a href="#cb90-1941" aria-hidden="true" tabindex="-1"></a>    <span class="kw">set</span>(viewof utctoggle<span class="op">,</span> <span class="kw">false</span>)<span class="op">;</span></span>
<span id="cb90-1942"><a href="#cb90-1942" aria-hidden="true" tabindex="-1"></a>    <span class="kw">set</span>(viewof yaw<span class="op">,</span> <span class="dv">500</span>)<span class="op">;</span></span>
<span id="cb90-1943"><a href="#cb90-1943" aria-hidden="true" tabindex="-1"></a>    <span class="kw">set</span>(viewof pitch<span class="op">,</span> <span class="dv">0</span>)<span class="op">;</span></span>
<span id="cb90-1944"><a href="#cb90-1944" aria-hidden="true" tabindex="-1"></a>    <span class="kw">set</span>(viewof roll<span class="op">,</span> <span class="dv">0</span>)<span class="op">;</span></span>
<span id="cb90-1945"><a href="#cb90-1945" aria-hidden="true" tabindex="-1"></a>    <span class="kw">set</span>(viewof select<span class="op">,</span> projections<span class="op">.</span><span class="fu">find</span>(t <span class="kw">=&gt;</span> t<span class="op">.</span><span class="at">name</span> <span class="op">===</span> <span class="st">"Equirectangular (plate carrée)"</span>))<span class="op">;</span></span>
<span id="cb90-1946"><a href="#cb90-1946" aria-hidden="true" tabindex="-1"></a>    <span class="fu">draw</span>(lon<span class="op">,</span> lat)<span class="op">;</span></span>
<span id="cb90-1947"><a href="#cb90-1947" aria-hidden="true" tabindex="-1"></a>    canvas<span class="op">.</span><span class="fu">dispatchEvent</span>(<span class="kw">new</span> <span class="bu">CustomEvent</span>(<span class="st">"input"</span><span class="op">,</span> { <span class="dt">bubbles</span><span class="op">:</span> <span class="kw">true</span> }))<span class="op">;</span></span>
<span id="cb90-1948"><a href="#cb90-1948" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb90-1949"><a href="#cb90-1949" aria-hidden="true" tabindex="-1"></a>  rstbtn<span class="op">.</span><span class="fu">on</span>(<span class="st">'click'</span><span class="op">,</span> resetlatlon)<span class="op">;</span></span>
<span id="cb90-1950"><a href="#cb90-1950" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> form <span class="op">=</span> <span class="fu">input</span>({</span>
<span id="cb90-1951"><a href="#cb90-1951" aria-hidden="true" tabindex="-1"></a>    <span class="dt">type</span><span class="op">:</span> <span class="st">"worldMapCoordinates"</span><span class="op">,</span></span>
<span id="cb90-1952"><a href="#cb90-1952" aria-hidden="true" tabindex="-1"></a>    title<span class="op">,</span></span>
<span id="cb90-1953"><a href="#cb90-1953" aria-hidden="true" tabindex="-1"></a>    description<span class="op">,</span></span>
<span id="cb90-1954"><a href="#cb90-1954" aria-hidden="true" tabindex="-1"></a>    <span class="dt">display</span><span class="op">:</span> v <span class="kw">=&gt;</span> (width <span class="op">&gt;</span> <span class="dv">300</span>) <span class="op">?</span> <span class="fu">html</span><span class="vs">`&lt;div style="width: </span><span class="sc">${</span>width<span class="sc">}</span><span class="vs">px; pointer-events: none; white-space: nowrap; color: window.darkmode ? #fff : #000; text-align: center; font: </span><span class="sc">${</span>width <span class="op">&gt;</span> <span class="dv">1000</span> <span class="op">?</span> width <span class="op">/</span> <span class="dv">50</span> <span class="op">:</span> width <span class="op">/</span> <span class="dv">40</span><span class="sc">}</span><span class="vs">px monospace; position: relative; top: </span><span class="sc">${</span><span class="op">-</span><span class="dv">28</span> <span class="op">-</span> width <span class="op">/</span> <span class="dv">25</span><span class="sc">}</span><span class="vs">px;  margin-bottom: -.4em;"&gt;</span></span>
<span id="cb90-1955"><a href="#cb90-1955" aria-hidden="true" tabindex="-1"></a><span class="vs">            &lt;span style="color: window.darkmode ? #fff : #000;"&gt;Zone:&lt;/span&gt; </span><span class="sc">${</span>lon <span class="op">!=</span> <span class="kw">null</span> <span class="op">?</span> <span class="fu">long2zone</span>(lon) <span class="op">:</span> <span class="st">""</span><span class="sc">}</span></span>
<span id="cb90-1956"><a href="#cb90-1956" aria-hidden="true" tabindex="-1"></a><span class="vs">            &amp;nbsp; &amp;nbsp;</span></span>
<span id="cb90-1957"><a href="#cb90-1957" aria-hidden="true" tabindex="-1"></a><span class="vs">            &lt;span style="color: window.darkmode ? #fff : #000;"&gt;Longitude:&lt;/span&gt; </span><span class="sc">${</span>lon <span class="op">!=</span> <span class="kw">null</span> <span class="op">?</span> (<span class="fu">long2turn</span>(lon))<span class="op">.</span><span class="fu">toFixed</span>(<span class="dv">0</span>) <span class="op">:</span> <span class="st">""</span><span class="sc">}</span></span>
<span id="cb90-1958"><a href="#cb90-1958" aria-hidden="true" tabindex="-1"></a><span class="vs">            &amp;nbsp; &amp;nbsp;</span></span>
<span id="cb90-1959"><a href="#cb90-1959" aria-hidden="true" tabindex="-1"></a><span class="vs">            &lt;span style="color: window.darkmode ? #fff : #000;"&gt;Latitude:&lt;/span&gt; </span><span class="sc">${</span>lat <span class="op">!=</span> <span class="kw">null</span> <span class="op">?</span> (<span class="fu">lati2turn</span>(lat))<span class="op">.</span><span class="fu">toFixed</span>(<span class="dv">0</span>) <span class="op">:</span> <span class="st">""</span><span class="sc">}</span></span>
<span id="cb90-1960"><a href="#cb90-1960" aria-hidden="true" tabindex="-1"></a><span class="vs">          &lt;/div&gt;`</span> <span class="op">:</span> <span class="st">''</span><span class="op">,</span></span>
<span id="cb90-1961"><a href="#cb90-1961" aria-hidden="true" tabindex="-1"></a>    <span class="dt">getValue</span><span class="op">:</span> () <span class="kw">=&gt;</span> [lon <span class="op">!=</span> <span class="kw">null</span> <span class="op">?</span> lon <span class="op">:</span> <span class="kw">null</span><span class="op">,</span> lat <span class="op">!=</span> <span class="kw">null</span> <span class="op">?</span> lat <span class="op">:</span> <span class="kw">null</span>]<span class="op">,</span></span>
<span id="cb90-1962"><a href="#cb90-1962" aria-hidden="true" tabindex="-1"></a>    <span class="dt">form</span><span class="op">:</span> formEl</span>
<span id="cb90-1963"><a href="#cb90-1963" aria-hidden="true" tabindex="-1"></a>  })<span class="op">;</span></span>
<span id="cb90-1964"><a href="#cb90-1964" aria-hidden="true" tabindex="-1"></a>  <span class="cf">return</span> form<span class="op">;</span></span>
<span id="cb90-1965"><a href="#cb90-1965" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb90-1966"><a href="#cb90-1966" aria-hidden="true" tabindex="-1"></a><span class="bu">window</span><span class="op">.</span><span class="at">darkmode</span> <span class="op">=</span> <span class="bu">document</span><span class="op">.</span><span class="fu">getElementsByTagName</span>(<span class="st">"body"</span>)[<span class="dv">0</span>]<span class="op">.</span><span class="at">className</span><span class="op">.</span><span class="fu">match</span>(<span class="ss">/quarto-dark/</span>) <span class="op">?</span> <span class="kw">true</span> <span class="op">:</span> <span class="kw">false</span><span class="op">;</span></span>
<span id="cb90-1967"><a href="#cb90-1967" aria-hidden="true" tabindex="-1"></a><span class="bu">document</span><span class="op">.</span><span class="fu">getElementsByClassName</span>(<span class="st">"quarto-color-scheme-toggle"</span>)[<span class="dv">0</span>]<span class="op">.</span><span class="at">onclick</span> <span class="op">=</span> <span class="kw">function</span> (e) {</span>
<span id="cb90-1968"><a href="#cb90-1968" aria-hidden="true" tabindex="-1"></a>  <span class="bu">window</span><span class="op">.</span><span class="fu">quartoToggleColorScheme</span>()<span class="op">;</span></span>
<span id="cb90-1969"><a href="#cb90-1969" aria-hidden="true" tabindex="-1"></a>  <span class="bu">window</span><span class="op">.</span><span class="at">darkmode</span> <span class="op">=</span> <span class="bu">document</span><span class="op">.</span><span class="fu">getElementsByTagName</span>(<span class="st">"body"</span>)[<span class="dv">0</span>]<span class="op">.</span><span class="at">className</span><span class="op">.</span><span class="fu">match</span>(<span class="ss">/quarto-dark/</span>) <span class="op">?</span> <span class="kw">true</span> <span class="op">:</span> <span class="kw">false</span><span class="op">;</span></span>
<span id="cb90-1970"><a href="#cb90-1970" aria-hidden="true" tabindex="-1"></a>  worldMapCoordinates<span class="op">.</span><span class="fu">draw</span>()<span class="op">;</span></span>
<span id="cb90-1971"><a href="#cb90-1971" aria-hidden="true" tabindex="-1"></a>  app<span class="op">.</span><span class="fu">drawEarth</span>()<span class="op">;</span></span>
<span id="cb90-1972"><a href="#cb90-1972" aria-hidden="true" tabindex="-1"></a>  <span class="cf">return</span> <span class="kw">false</span><span class="op">;</span></span>
<span id="cb90-1973"><a href="#cb90-1973" aria-hidden="true" tabindex="-1"></a>}<span class="op">;</span></span>
<span id="cb90-1974"><a href="#cb90-1974" aria-hidden="true" tabindex="-1"></a>sun <span class="op">=</span> {</span>
<span id="cb90-1975"><a href="#cb90-1975" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> now <span class="op">=</span> <span class="kw">new</span> <span class="bu">Date</span><span class="op">;</span></span>
<span id="cb90-1976"><a href="#cb90-1976" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> day <span class="op">=</span> <span class="kw">new</span> <span class="bu">Date</span>(<span class="op">+</span>now)<span class="op">.</span><span class="fu">setUTCHours</span>(<span class="dv">0</span><span class="op">,</span> <span class="dv">0</span><span class="op">,</span> <span class="dv">0</span><span class="op">,</span> <span class="dv">0</span>)<span class="op">;</span></span>
<span id="cb90-1977"><a href="#cb90-1977" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> t <span class="op">=</span> solar<span class="op">.</span><span class="fu">century</span>(now)<span class="op">;</span></span>
<span id="cb90-1978"><a href="#cb90-1978" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> longitude <span class="op">=</span> (day <span class="op">-</span> now) <span class="op">/</span> <span class="fl">864e5</span> <span class="op">*</span> <span class="dv">360</span> <span class="op">-</span> <span class="dv">180</span><span class="op">;</span></span>
<span id="cb90-1979"><a href="#cb90-1979" aria-hidden="true" tabindex="-1"></a>  <span class="cf">return</span> [longitude <span class="op">-</span> solar<span class="op">.</span><span class="fu">equationOfTime</span>(t) <span class="op">/</span> <span class="dv">4</span><span class="op">,</span> solar<span class="op">.</span><span class="fu">declination</span>(t)]<span class="op">;</span></span>
<span id="cb90-1980"><a href="#cb90-1980" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb90-1981"><a href="#cb90-1981" aria-hidden="true" tabindex="-1"></a>night <span class="op">=</span> d3<span class="op">.</span><span class="fu">geoCircle</span>()</span>
<span id="cb90-1982"><a href="#cb90-1982" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">radius</span>(<span class="dv">90</span>)</span>
<span id="cb90-1983"><a href="#cb90-1983" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">center</span>(<span class="fu">antipode</span>(sun))</span>
<span id="cb90-1984"><a href="#cb90-1984" aria-hidden="true" tabindex="-1"></a>  ()</span>
<span id="cb90-1985"><a href="#cb90-1985" aria-hidden="true" tabindex="-1"></a>antipode <span class="op">=</span> ([longitude<span class="op">,</span> latitude]) <span class="kw">=&gt;</span> [longitude <span class="op">+</span> <span class="dv">180</span><span class="op">,</span> <span class="op">-</span>latitude]</span>
<span id="cb90-1986"><a href="#cb90-1986" aria-hidden="true" tabindex="-1"></a>solar <span class="op">=</span> <span class="pp">require</span>(<span class="st">"solar-calculator@0.3/dist/solar-calculator.min.js"</span>)</span>
<span id="cb90-1987"><a href="#cb90-1987" aria-hidden="true" tabindex="-1"></a>viewof fancySecondsOFF <span class="op">=</span> Inputs<span class="op">.</span><span class="fu">toggle</span>({</span>
<span id="cb90-1988"><a href="#cb90-1988" aria-hidden="true" tabindex="-1"></a>  <span class="dt">label</span><span class="op">:</span> <span class="st">"Ticking clock"</span><span class="op">,</span></span>
<span id="cb90-1989"><a href="#cb90-1989" aria-hidden="true" tabindex="-1"></a>  <span class="dt">value</span><span class="op">:</span> <span class="kw">true</span><span class="op">,</span></span>
<span id="cb90-1990"><a href="#cb90-1990" aria-hidden="true" tabindex="-1"></a>})</span>
<span id="cb90-1991"><a href="#cb90-1991" aria-hidden="true" tabindex="-1"></a><span class="kw">function</span> <span class="fu">setStyle</span>(content<span class="op">,</span> style <span class="op">=</span> {}) {</span>
<span id="cb90-1992"><a href="#cb90-1992" aria-hidden="true" tabindex="-1"></a>  <span class="kw">function</span> <span class="fu">yiq</span>(color) {</span>
<span id="cb90-1993"><a href="#cb90-1993" aria-hidden="true" tabindex="-1"></a>    <span class="kw">const</span> {r<span class="op">,</span> g<span class="op">,</span> b} <span class="op">=</span> d3<span class="op">.</span><span class="fu">rgb</span>(color)<span class="op">;</span></span>
<span id="cb90-1994"><a href="#cb90-1994" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> (r <span class="op">*</span> <span class="dv">299</span> <span class="op">+</span> g <span class="op">*</span> <span class="dv">587</span> <span class="op">+</span> b <span class="op">*</span> <span class="dv">114</span>) <span class="op">/</span> <span class="dv">1000</span> <span class="op">/</span> <span class="dv">255</span><span class="op">;</span> <span class="co">// returns values between 0 and 1</span></span>
<span id="cb90-1995"><a href="#cb90-1995" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb90-1996"><a href="#cb90-1996" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> {</span>
<span id="cb90-1997"><a href="#cb90-1997" aria-hidden="true" tabindex="-1"></a>    background<span class="op">,</span></span>
<span id="cb90-1998"><a href="#cb90-1998" aria-hidden="true" tabindex="-1"></a>    color <span class="op">=</span> <span class="fu">yiq</span>(background) <span class="op">&gt;=</span> <span class="fl">0.6</span> <span class="op">?</span> <span class="st">"#111"</span> <span class="op">:</span> <span class="st">"white"</span><span class="op">,</span></span>
<span id="cb90-1999"><a href="#cb90-1999" aria-hidden="true" tabindex="-1"></a>    padding <span class="op">=</span> <span class="st">"0 1px"</span><span class="op">,</span></span>
<span id="cb90-2000"><a href="#cb90-2000" aria-hidden="true" tabindex="-1"></a>    borderRadius <span class="op">=</span> <span class="st">"4px"</span><span class="op">,</span></span>
<span id="cb90-2001"><a href="#cb90-2001" aria-hidden="true" tabindex="-1"></a>    fontWeight <span class="op">=</span> <span class="dv">900</span><span class="op">,</span></span>
<span id="cb90-2002"><a href="#cb90-2002" aria-hidden="true" tabindex="-1"></a>    fontSize <span class="op">=</span> <span class="st">"1em"</span><span class="op">,</span></span>
<span id="cb90-2003"><a href="#cb90-2003" aria-hidden="true" tabindex="-1"></a>    <span class="op">...</span>rest</span>
<span id="cb90-2004"><a href="#cb90-2004" aria-hidden="true" tabindex="-1"></a>  } <span class="op">=</span> <span class="kw">typeof</span> style <span class="op">===</span> <span class="st">"string"</span> <span class="op">?</span> {<span class="dt">background</span><span class="op">:</span> style} <span class="op">:</span> style<span class="op">;</span></span>
<span id="cb90-2005"><a href="#cb90-2005" aria-hidden="true" tabindex="-1"></a>  <span class="cf">return</span> htl<span class="op">.</span><span class="fu">html</span><span class="vs">`&lt;span style=</span><span class="sc">${</span>{</span>
<span id="cb90-2006"><a href="#cb90-2006" aria-hidden="true" tabindex="-1"></a>    background<span class="op">,</span></span>
<span id="cb90-2007"><a href="#cb90-2007" aria-hidden="true" tabindex="-1"></a>    color<span class="op">,</span></span>
<span id="cb90-2008"><a href="#cb90-2008" aria-hidden="true" tabindex="-1"></a>    padding<span class="op">,</span></span>
<span id="cb90-2009"><a href="#cb90-2009" aria-hidden="true" tabindex="-1"></a>    borderRadius<span class="op">,</span></span>
<span id="cb90-2010"><a href="#cb90-2010" aria-hidden="true" tabindex="-1"></a>    fontWeight<span class="op">,</span></span>
<span id="cb90-2011"><a href="#cb90-2011" aria-hidden="true" tabindex="-1"></a>    <span class="op">...</span>rest</span>
<span id="cb90-2012"><a href="#cb90-2012" aria-hidden="true" tabindex="-1"></a>  }<span class="sc">}</span><span class="vs">&gt;</span><span class="sc">${</span>content<span class="sc">}</span><span class="vs">&lt;/span&gt;`</span><span class="op">;</span></span>
<span id="cb90-2013"><a href="#cb90-2013" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb90-2014"><a href="#cb90-2014" aria-hidden="true" tabindex="-1"></a><span class="kw">function</span> <span class="fu">yiq</span>(color) {</span>
<span id="cb90-2015"><a href="#cb90-2015" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> {r<span class="op">,</span> g<span class="op">,</span> b} <span class="op">=</span> d3<span class="op">.</span><span class="fu">rgb</span>(color)<span class="op">;</span></span>
<span id="cb90-2016"><a href="#cb90-2016" aria-hidden="true" tabindex="-1"></a>  <span class="cf">return</span> (r <span class="op">*</span> <span class="dv">299</span> <span class="op">+</span> g <span class="op">*</span> <span class="dv">587</span> <span class="op">+</span> b <span class="op">*</span> <span class="dv">114</span>) <span class="op">/</span> <span class="dv">1000</span> <span class="op">/</span> <span class="dv">255</span><span class="op">;</span> <span class="co">// returns values between 0 and 1</span></span>
<span id="cb90-2017"><a href="#cb90-2017" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb90-2018"><a href="#cb90-2018" aria-hidden="true" tabindex="-1"></a><span class="kw">function</span> <span class="fu">textcolor</span>(content<span class="op">,</span> style <span class="op">=</span> {}) {</span>
<span id="cb90-2019"><a href="#cb90-2019" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> {</span>
<span id="cb90-2020"><a href="#cb90-2020" aria-hidden="true" tabindex="-1"></a>    background<span class="op">,</span></span>
<span id="cb90-2021"><a href="#cb90-2021" aria-hidden="true" tabindex="-1"></a>    color <span class="op">=</span> <span class="fu">yiq</span>(background) <span class="op">&gt;</span> <span class="fl">0.51</span> <span class="op">?</span> <span class="st">"#000"</span> <span class="op">:</span> <span class="st">"white"</span><span class="op">,</span></span>
<span id="cb90-2022"><a href="#cb90-2022" aria-hidden="true" tabindex="-1"></a>    padding <span class="op">=</span> <span class="st">"0 5px"</span><span class="op">,</span></span>
<span id="cb90-2023"><a href="#cb90-2023" aria-hidden="true" tabindex="-1"></a>    borderRadius <span class="op">=</span> <span class="st">"4px"</span><span class="op">,</span></span>
<span id="cb90-2024"><a href="#cb90-2024" aria-hidden="true" tabindex="-1"></a>    fontWeight <span class="op">=</span> <span class="dv">400</span><span class="op">,</span></span>
<span id="cb90-2025"><a href="#cb90-2025" aria-hidden="true" tabindex="-1"></a>    fontFamily <span class="op">=</span> <span class="st">"monospace"</span><span class="op">,</span></span>
<span id="cb90-2026"><a href="#cb90-2026" aria-hidden="true" tabindex="-1"></a>    <span class="op">...</span>rest</span>
<span id="cb90-2027"><a href="#cb90-2027" aria-hidden="true" tabindex="-1"></a>  } <span class="op">=</span> <span class="kw">typeof</span> style <span class="op">===</span> <span class="st">"string"</span> <span class="op">?</span> {<span class="dt">background</span><span class="op">:</span> style} <span class="op">:</span> style<span class="op">;</span></span>
<span id="cb90-2028"><a href="#cb90-2028" aria-hidden="true" tabindex="-1"></a>  <span class="cf">return</span> htl<span class="op">.</span><span class="fu">html</span><span class="vs">`&lt;span style=</span><span class="sc">${</span>{</span>
<span id="cb90-2029"><a href="#cb90-2029" aria-hidden="true" tabindex="-1"></a>    background<span class="op">,</span></span>
<span id="cb90-2030"><a href="#cb90-2030" aria-hidden="true" tabindex="-1"></a>    color<span class="op">,</span></span>
<span id="cb90-2031"><a href="#cb90-2031" aria-hidden="true" tabindex="-1"></a>    padding<span class="op">,</span></span>
<span id="cb90-2032"><a href="#cb90-2032" aria-hidden="true" tabindex="-1"></a>    borderRadius<span class="op">,</span></span>
<span id="cb90-2033"><a href="#cb90-2033" aria-hidden="true" tabindex="-1"></a>    fontWeight<span class="op">,</span></span>
<span id="cb90-2034"><a href="#cb90-2034" aria-hidden="true" tabindex="-1"></a>    fontFamily<span class="op">,</span></span>
<span id="cb90-2035"><a href="#cb90-2035" aria-hidden="true" tabindex="-1"></a>    <span class="op">...</span>rest</span>
<span id="cb90-2036"><a href="#cb90-2036" aria-hidden="true" tabindex="-1"></a>  }<span class="sc">}</span><span class="vs">&gt;</span><span class="sc">${</span>content<span class="sc">}</span><span class="vs">&lt;/span&gt;`</span><span class="op">;</span></span>
<span id="cb90-2037"><a href="#cb90-2037" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb90-2038"><a href="#cb90-2038" aria-hidden="true" tabindex="-1"></a><span class="kw">function</span> <span class="fu">isLeapYear</span>(y) {</span>
<span id="cb90-2039"><a href="#cb90-2039" aria-hidden="true" tabindex="-1"></a>  y <span class="op">+=</span> <span class="dv">1</span><span class="op">;</span></span>
<span id="cb90-2040"><a href="#cb90-2040" aria-hidden="true" tabindex="-1"></a>  <span class="cf">return</span> y <span class="op">%</span> <span class="dv">4</span> <span class="op">==</span> <span class="dv">0</span> <span class="op">&amp;&amp;</span> y <span class="op">%</span> <span class="dv">100</span> <span class="op">!=</span> <span class="dv">0</span> <span class="op">||</span> y <span class="op">%</span> <span class="dv">400</span> <span class="op">==</span> <span class="dv">0</span><span class="op">;</span></span>
<span id="cb90-2041"><a href="#cb90-2041" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb90-2042"><a href="#cb90-2042" aria-hidden="true" tabindex="-1"></a>elapsed <span class="op">=</span> {</span>
<span id="cb90-2043"><a href="#cb90-2043" aria-hidden="true" tabindex="-1"></a>  <span class="kw">let</span> i <span class="op">=</span> <span class="dv">0</span><span class="op">;</span></span>
<span id="cb90-2044"><a href="#cb90-2044" aria-hidden="true" tabindex="-1"></a>  <span class="cf">while</span> (<span class="kw">true</span>) {</span>
<span id="cb90-2045"><a href="#cb90-2045" aria-hidden="true" tabindex="-1"></a>    <span class="kw">yield</span> Promises<span class="op">.</span><span class="fu">tick</span>(<span class="dv">864</span><span class="op">,</span> <span class="op">++</span>i)<span class="op">;</span></span>
<span id="cb90-2046"><a href="#cb90-2046" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb90-2047"><a href="#cb90-2047" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb90-2048"><a href="#cb90-2048" aria-hidden="true" tabindex="-1"></a>piecewiseColor <span class="op">=</span> d3<span class="op">.</span><span class="fu">piecewise</span>(d3<span class="op">.</span><span class="at">interpolateRgb</span><span class="op">,</span> [</span>
<span id="cb90-2049"><a href="#cb90-2049" aria-hidden="true" tabindex="-1"></a>  <span class="st">"#f00"</span><span class="op">,</span>    <span class="co">//  0   0 red</span></span>
<span id="cb90-2050"><a href="#cb90-2050" aria-hidden="true" tabindex="-1"></a>  <span class="st">"#f50"</span><span class="op">,</span>    <span class="co">//  0.25  20 yr</span></span>
<span id="cb90-2051"><a href="#cb90-2051" aria-hidden="true" tabindex="-1"></a>  <span class="st">"#f60"</span><span class="op">,</span>    <span class="co">//  0.5   24 yr orangered</span></span>
<span id="cb90-2052"><a href="#cb90-2052" aria-hidden="true" tabindex="-1"></a>  <span class="st">"#f70"</span><span class="op">,</span>    <span class="co">//  0.75  28 yr</span></span>
<span id="cb90-2053"><a href="#cb90-2053" aria-hidden="true" tabindex="-1"></a>  <span class="st">"#f90"</span><span class="op">,</span>    <span class="co">//  1     36 yr orange</span></span>
<span id="cb90-2054"><a href="#cb90-2054" aria-hidden="true" tabindex="-1"></a>  <span class="st">"#fb0"</span><span class="op">,</span>    <span class="co">//  1.25  44 yr</span></span>
<span id="cb90-2055"><a href="#cb90-2055" aria-hidden="true" tabindex="-1"></a>  <span class="st">"#fc0"</span><span class="op">,</span>    <span class="co">//  1.5   48 yr yelloworange</span></span>
<span id="cb90-2056"><a href="#cb90-2056" aria-hidden="true" tabindex="-1"></a>  <span class="st">"#fd0"</span><span class="op">,</span>    <span class="co">//  1.75  52 yr</span></span>
<span id="cb90-2057"><a href="#cb90-2057" aria-hidden="true" tabindex="-1"></a>  <span class="st">"#ff0"</span><span class="op">,</span>    <span class="co">//  2     60 yellow</span></span>
<span id="cb90-2058"><a href="#cb90-2058" aria-hidden="true" tabindex="-1"></a>  <span class="st">"#ef0"</span><span class="op">,</span>    <span class="co">//  2.25  64 gy</span></span>
<span id="cb90-2059"><a href="#cb90-2059" aria-hidden="true" tabindex="-1"></a>  <span class="st">"#df0"</span><span class="op">,</span>    <span class="co">//  2.5   68 gy limeyellow</span></span>
<span id="cb90-2060"><a href="#cb90-2060" aria-hidden="true" tabindex="-1"></a>  <span class="st">"#cf0"</span><span class="op">,</span>    <span class="co">//  2.75  72 gy</span></span>
<span id="cb90-2061"><a href="#cb90-2061" aria-hidden="true" tabindex="-1"></a>  <span class="st">"#af0"</span><span class="op">,</span>    <span class="co">//  3     80 gy lime</span></span>
<span id="cb90-2062"><a href="#cb90-2062" aria-hidden="true" tabindex="-1"></a>  <span class="st">"#8f0"</span><span class="op">,</span>    <span class="co">//  3.25  88 gy</span></span>
<span id="cb90-2063"><a href="#cb90-2063" aria-hidden="true" tabindex="-1"></a>  <span class="st">"#7f0"</span><span class="op">,</span>    <span class="co">//  3.5   92 gy greenlime</span></span>
<span id="cb90-2064"><a href="#cb90-2064" aria-hidden="true" tabindex="-1"></a>  <span class="st">"#6f0"</span><span class="op">,</span>    <span class="co">//  3.75  96 gy</span></span>
<span id="cb90-2065"><a href="#cb90-2065" aria-hidden="true" tabindex="-1"></a>  <span class="st">"#0f0"</span><span class="op">,</span>    <span class="co">//  4    120 green</span></span>
<span id="cb90-2066"><a href="#cb90-2066" aria-hidden="true" tabindex="-1"></a>  <span class="st">"#0f7"</span><span class="op">,</span>    <span class="co">//  4.25 148 cg</span></span>
<span id="cb90-2067"><a href="#cb90-2067" aria-hidden="true" tabindex="-1"></a>  <span class="st">"#0f9"</span><span class="op">,</span>    <span class="co">//  4.5  156 cg cyangreen</span></span>
<span id="cb90-2068"><a href="#cb90-2068" aria-hidden="true" tabindex="-1"></a>  <span class="st">"#0fb"</span><span class="op">,</span>    <span class="co">//  4.75 164 cg</span></span>
<span id="cb90-2069"><a href="#cb90-2069" aria-hidden="true" tabindex="-1"></a>  <span class="st">"#0ff"</span><span class="op">,</span>    <span class="co">//  5    180 cyan</span></span>
<span id="cb90-2070"><a href="#cb90-2070" aria-hidden="true" tabindex="-1"></a>  <span class="st">"#0cf"</span><span class="op">,</span>    <span class="co">//  5.25 192 bc</span></span>
<span id="cb90-2071"><a href="#cb90-2071" aria-hidden="true" tabindex="-1"></a>  <span class="st">"#0bf"</span><span class="op">,</span>    <span class="co">//  5.5  196 bc azurecyan</span></span>
<span id="cb90-2072"><a href="#cb90-2072" aria-hidden="true" tabindex="-1"></a>  <span class="st">"#0af"</span><span class="op">,</span>    <span class="co">//  5.75 200 bc</span></span>
<span id="cb90-2073"><a href="#cb90-2073" aria-hidden="true" tabindex="-1"></a>  <span class="st">"#08f"</span><span class="op">,</span>    <span class="co">//  6    208 bc azure</span></span>
<span id="cb90-2074"><a href="#cb90-2074" aria-hidden="true" tabindex="-1"></a>  <span class="st">"#06f"</span><span class="op">,</span>    <span class="co">//  6.25 216 bc</span></span>
<span id="cb90-2075"><a href="#cb90-2075" aria-hidden="true" tabindex="-1"></a>  <span class="st">"#05f"</span><span class="op">,</span>    <span class="co">//  6.5  220 bc blueazure</span></span>
<span id="cb90-2076"><a href="#cb90-2076" aria-hidden="true" tabindex="-1"></a>  <span class="st">"#04f"</span><span class="op">,</span>    <span class="co">//  6.75 224 bc</span></span>
<span id="cb90-2077"><a href="#cb90-2077" aria-hidden="true" tabindex="-1"></a>  <span class="st">"#00f"</span><span class="op">,</span>    <span class="co">//  7    240 blue</span></span>
<span id="cb90-2078"><a href="#cb90-2078" aria-hidden="true" tabindex="-1"></a>  <span class="st">"#50f"</span><span class="op">,</span>    <span class="co">//  7.25 260 mb</span></span>
<span id="cb90-2079"><a href="#cb90-2079" aria-hidden="true" tabindex="-1"></a>  <span class="st">"#60f"</span><span class="op">,</span>    <span class="co">//  7.5  264 mb purpleblue</span></span>
<span id="cb90-2080"><a href="#cb90-2080" aria-hidden="true" tabindex="-1"></a>  <span class="st">"#70f"</span><span class="op">,</span>    <span class="co">//  7.75 268 mb</span></span>
<span id="cb90-2081"><a href="#cb90-2081" aria-hidden="true" tabindex="-1"></a>  <span class="st">"#90f"</span><span class="op">,</span>    <span class="co">//  8    276 mb purple</span></span>
<span id="cb90-2082"><a href="#cb90-2082" aria-hidden="true" tabindex="-1"></a>  <span class="st">"#b0f"</span><span class="op">,</span>    <span class="co">//  8.25 284 mb</span></span>
<span id="cb90-2083"><a href="#cb90-2083" aria-hidden="true" tabindex="-1"></a>  <span class="st">"#c0f"</span><span class="op">,</span>    <span class="co">//  8.5  288 mb violetpurple</span></span>
<span id="cb90-2084"><a href="#cb90-2084" aria-hidden="true" tabindex="-1"></a>  <span class="st">"#d0f"</span><span class="op">,</span>    <span class="co">//  8.75 292 mb</span></span>
<span id="cb90-2085"><a href="#cb90-2085" aria-hidden="true" tabindex="-1"></a>  <span class="st">"#f0f"</span><span class="op">,</span>    <span class="co">//  9    300 magenta</span></span>
<span id="cb90-2086"><a href="#cb90-2086" aria-hidden="true" tabindex="-1"></a>  <span class="st">"#f0a"</span><span class="op">,</span>    <span class="co">//  9.25 320 rm</span></span>
<span id="cb90-2087"><a href="#cb90-2087" aria-hidden="true" tabindex="-1"></a>  <span class="st">"#f08"</span><span class="op">,</span>    <span class="co">//  9.5  328 rm</span></span>
<span id="cb90-2088"><a href="#cb90-2088" aria-hidden="true" tabindex="-1"></a>  <span class="st">"#f06"</span><span class="op">,</span>    <span class="co">//  9.75 336 rm</span></span>
<span id="cb90-2089"><a href="#cb90-2089" aria-hidden="true" tabindex="-1"></a>  <span class="st">"#f00"</span><span class="op">,</span>    <span class="co">//  0        0 red</span></span>
<span id="cb90-2090"><a href="#cb90-2090" aria-hidden="true" tabindex="-1"></a>])</span>
<span id="cb90-2091"><a href="#cb90-2091" aria-hidden="true" tabindex="-1"></a>slStr <span class="op">=</span> <span class="vs">`, 100%, 50%)`</span></span>
<span id="cb90-2092"><a href="#cb90-2092" aria-hidden="true" tabindex="-1"></a>elaTime <span class="op">=</span> elapsed <span class="op">%</span> <span class="fl">1e5</span></span>
<span id="cb90-2093"><a href="#cb90-2093" aria-hidden="true" tabindex="-1"></a>elaTimeHsl <span class="op">=</span> <span class="fu">textcolor</span>(elaTime<span class="op">,</span> <span class="vs">`hsl(</span><span class="sc">${</span>d3<span class="op">.</span><span class="fu">hsl</span>(<span class="fu">piecewiseColor</span>(elaTime <span class="op">%</span> <span class="dv">1000</span> <span class="op">/</span> <span class="dv">1000</span>))<span class="op">.</span><span class="at">h</span><span class="sc">}</span><span class="vs">`</span> <span class="op">+</span> slStr)</span>
<span id="cb90-2094"><a href="#cb90-2094" aria-hidden="true" tabindex="-1"></a>decMoty <span class="op">=</span> <span class="bu">Math</span><span class="op">.</span><span class="fu">floor</span>((<span class="dv">5</span> <span class="op">*</span> decDate <span class="op">+</span> <span class="dv">2</span>) <span class="op">/</span> <span class="dv">153</span>)</span>
<span id="cb90-2095"><a href="#cb90-2095" aria-hidden="true" tabindex="-1"></a>isoYear <span class="op">=</span> decYear <span class="op">+</span> (decMoty <span class="op">&gt;</span> <span class="dv">9</span>)</span>
<span id="cb90-2096"><a href="#cb90-2096" aria-hidden="true" tabindex="-1"></a>month <span class="op">=</span> decMoty <span class="op">&lt;</span> <span class="dv">10</span> <span class="op">?</span> decMoty <span class="op">+</span> <span class="dv">3</span> <span class="op">:</span> decMoty <span class="op">-</span> <span class="dv">9</span></span>
<span id="cb90-2097"><a href="#cb90-2097" aria-hidden="true" tabindex="-1"></a>decHour <span class="op">=</span> decTime <span class="op">*</span> <span class="dv">24</span></span>
<span id="cb90-2098"><a href="#cb90-2098" aria-hidden="true" tabindex="-1"></a>decMinute <span class="op">=</span> (decHour <span class="op">%</span> <span class="dv">1</span>) <span class="op">*</span> <span class="dv">60</span></span>
<span id="cb90-2099"><a href="#cb90-2099" aria-hidden="true" tabindex="-1"></a>decSecond <span class="op">=</span> (decMinute <span class="op">%</span> <span class="dv">1</span>) <span class="op">*</span> <span class="dv">60</span></span>
<span id="cb90-2100"><a href="#cb90-2100" aria-hidden="true" tabindex="-1"></a>isoHour <span class="op">=</span> <span class="bu">Math</span><span class="op">.</span><span class="fu">floor</span>(decHour)</span>
<span id="cb90-2101"><a href="#cb90-2101" aria-hidden="true" tabindex="-1"></a>isoMinute <span class="op">=</span> <span class="bu">Math</span><span class="op">.</span><span class="fu">floor</span>(decMinute)</span>
<span id="cb90-2102"><a href="#cb90-2102" aria-hidden="true" tabindex="-1"></a>isoSecond <span class="op">=</span> <span class="bu">Math</span><span class="op">.</span><span class="fu">floor</span>(decSecond)</span>
<span id="cb90-2103"><a href="#cb90-2103" aria-hidden="true" tabindex="-1"></a>decDek <span class="op">=</span> <span class="bu">Math</span><span class="op">.</span><span class="fu">floor</span>(decDate <span class="op">/</span> <span class="dv">10</span>)</span>
<span id="cb90-2104"><a href="#cb90-2104" aria-hidden="true" tabindex="-1"></a>decDod <span class="op">=</span> decDate <span class="op">%</span> <span class="dv">10</span></span>
<span id="cb90-2105"><a href="#cb90-2105" aria-hidden="true" tabindex="-1"></a>decDotm <span class="op">=</span> <span class="bu">Math</span><span class="op">.</span><span class="fu">floor</span>(decDate <span class="op">-</span> (<span class="dv">153</span> <span class="op">*</span> decMoty <span class="op">+</span> <span class="dv">2</span>) <span class="op">/</span> <span class="dv">5</span> <span class="op">+</span> <span class="dv">1</span>)</span>
<span id="cb90-2106"><a href="#cb90-2106" aria-hidden="true" tabindex="-1"></a>selDote <span class="op">=</span> <span class="fu">unix2dote</span>(selectedDate<span class="op">.</span><span class="fu">getTime</span>() <span class="op">-</span> <span class="dv">86400000</span><span class="op">,</span> <span class="dv">0</span>)</span>
<span id="cb90-2107"><a href="#cb90-2107" aria-hidden="true" tabindex="-1"></a>selDate <span class="op">=</span> <span class="bu">Math</span><span class="op">.</span><span class="fu">floor</span>(<span class="fu">dote2date</span>(<span class="op">...</span>selDote)[<span class="dv">1</span>])</span>
<span id="cb90-2108"><a href="#cb90-2108" aria-hidden="true" tabindex="-1"></a>selTime <span class="op">=</span> selectedHour <span class="op">/</span> <span class="dv">24</span></span>
<span id="cb90-2109"><a href="#cb90-2109" aria-hidden="true" tabindex="-1"></a>selTimeOne <span class="op">=</span> selTime <span class="op">%</span> <span class="dv">1</span></span>
<span id="cb90-2110"><a href="#cb90-2110" aria-hidden="true" tabindex="-1"></a>selTimeTen <span class="op">=</span> selTime <span class="op">*</span> <span class="dv">10</span> <span class="op">%</span> <span class="dv">10</span></span>
<span id="cb90-2111"><a href="#cb90-2111" aria-hidden="true" tabindex="-1"></a>selYda <span class="op">=</span> selDate <span class="op">+</span> selTime</span>
<span id="cb90-2112"><a href="#cb90-2112" aria-hidden="true" tabindex="-1"></a>selLati <span class="op">=</span> <span class="fu">lati2turn</span>(location[<span class="dv">1</span>])</span>
<span id="cb90-2113"><a href="#cb90-2113" aria-hidden="true" tabindex="-1"></a>decDodHsl <span class="op">=</span> <span class="fu">textcolor</span>(decDod<span class="op">,</span> d3<span class="op">.</span><span class="fu">color</span>(<span class="fu">piecewiseColor</span>(decDod <span class="op">/</span> <span class="dv">10</span>))<span class="op">.</span><span class="fu">formatHex</span>())</span>
<span id="cb90-2114"><a href="#cb90-2114" aria-hidden="true" tabindex="-1"></a>decDateHsl <span class="op">=</span> <span class="fu">textcolor</span>(decDate<span class="op">.</span><span class="fu">toString</span>()<span class="op">.</span><span class="fu">padStart</span>(<span class="dv">3</span><span class="op">,</span> <span class="st">"0"</span>)<span class="op">,</span> d3<span class="op">.</span><span class="fu">color</span>(<span class="fu">piecewiseColor</span>(decDate <span class="op">/</span> (<span class="dv">365</span> <span class="op">+</span> <span class="fu">isLeapYear</span>(decYear))))<span class="op">.</span><span class="fu">formatHex</span>())</span>
<span id="cb90-2115"><a href="#cb90-2115" aria-hidden="true" tabindex="-1"></a>decTimeHsl <span class="op">=</span> <span class="fu">textcolor</span>(decTime<span class="op">,</span> d3<span class="op">.</span><span class="fu">color</span>(<span class="fu">piecewiseColor</span>(decTime <span class="op">/</span> <span class="dv">10</span>))<span class="op">.</span><span class="fu">formatHex</span>())</span>
<span id="cb90-2116"><a href="#cb90-2116" aria-hidden="true" tabindex="-1"></a>selDateHsl <span class="op">=</span> <span class="fu">textcolor</span>(selDate<span class="op">.</span><span class="fu">toString</span>()<span class="op">.</span><span class="fu">padStart</span>(<span class="dv">3</span><span class="op">,</span> <span class="st">"0"</span>)<span class="op">,</span> d3<span class="op">.</span><span class="fu">color</span>(<span class="fu">piecewiseColor</span>(selDate <span class="op">/</span> <span class="dv">365</span>))<span class="op">.</span><span class="fu">formatHex</span>())</span>
<span id="cb90-2117"><a href="#cb90-2117" aria-hidden="true" tabindex="-1"></a>selLatiHsl <span class="op">=</span> <span class="fu">textcolor</span>(selLati<span class="op">.</span><span class="fu">toFixed</span>(<span class="dv">0</span>)<span class="op">,</span> d3<span class="op">.</span><span class="fu">color</span>(<span class="fu">piecewiseColor</span>((selLati <span class="op">+</span> <span class="dv">250</span>) <span class="op">%</span> <span class="dv">250</span> <span class="op">/</span> <span class="dv">250</span>))<span class="op">.</span><span class="fu">formatHex</span>())</span>
<span id="cb90-2118"><a href="#cb90-2118" aria-hidden="true" tabindex="-1"></a>selTimeDay <span class="op">=</span> <span class="fu">textcolor</span>(selTimeOne<span class="op">.</span><span class="fu">toFixed</span>(<span class="dv">3</span>)<span class="op">.</span><span class="fu">slice</span>(<span class="dv">2</span>)<span class="op">,</span> d3<span class="op">.</span><span class="fu">color</span>(<span class="fu">piecewiseColor</span>(selTime))<span class="op">.</span><span class="fu">formatHex</span>())</span>
<span id="cb90-2119"><a href="#cb90-2119" aria-hidden="true" tabindex="-1"></a>selTimeHsl0 <span class="op">=</span> <span class="fu">textcolor</span>(selTimeTen<span class="op">.</span><span class="fu">toFixed</span>(<span class="dv">4</span>)<span class="op">,</span> d3<span class="op">.</span><span class="fu">color</span>(<span class="fu">piecewiseColor</span>(selTime))<span class="op">.</span><span class="fu">formatHex</span>())</span>
<span id="cb90-2120"><a href="#cb90-2120" aria-hidden="true" tabindex="-1"></a>selTimeHsl1 <span class="op">=</span> <span class="fu">textcolor</span>(selTimeTen<span class="op">.</span><span class="fu">toFixed</span>(<span class="dv">4</span>)<span class="op">,</span> d3<span class="op">.</span><span class="fu">color</span>(<span class="fu">piecewiseColor</span>(selTime))<span class="op">.</span><span class="fu">formatHex</span>())</span>
<span id="cb90-2121"><a href="#cb90-2121" aria-hidden="true" tabindex="-1"></a>selZoneHsl <span class="op">=</span> <span class="fu">textcolor</span>(selectedZone<span class="op">,</span> d3<span class="op">.</span><span class="fu">color</span>(<span class="fu">piecewiseColor</span>(selectedZone <span class="op">/</span> <span class="dv">10</span>))<span class="op">.</span><span class="fu">formatHex</span>())</span>
<span id="cb90-2122"><a href="#cb90-2122" aria-hidden="true" tabindex="-1"></a>selYdaDay <span class="op">=</span> <span class="fu">textcolor</span>(selYda<span class="op">.</span><span class="fu">toFixed</span>(<span class="dv">3</span>)<span class="op">.</span><span class="fu">padStart</span>(<span class="dv">6</span><span class="op">,</span> <span class="st">"0"</span>)<span class="op">,</span> d3<span class="op">.</span><span class="fu">color</span>(<span class="fu">piecewiseColor</span>(selYda <span class="op">/</span> <span class="dv">365</span>))<span class="op">.</span><span class="fu">formatHex</span>())</span>
<span id="cb90-2123"><a href="#cb90-2123" aria-hidden="true" tabindex="-1"></a>selYdaDec <span class="op">=</span> <span class="fu">textcolor</span>((selYda <span class="op">*</span> <span class="dv">10</span>)<span class="op">.</span><span class="fu">toFixed</span>(<span class="dv">4</span>)<span class="op">.</span><span class="fu">padStart</span>(<span class="dv">9</span><span class="op">,</span> <span class="st">"0"</span>)<span class="op">,</span> d3<span class="op">.</span><span class="fu">color</span>(<span class="fu">piecewiseColor</span>(selYda <span class="op">/</span> <span class="dv">365</span>))<span class="op">.</span><span class="fu">formatHex</span>())</span>
<span id="cb90-2124"><a href="#cb90-2124" aria-hidden="true" tabindex="-1"></a>decZoneHsl <span class="op">=</span> <span class="fu">textcolor</span>(selectedZone<span class="op">,</span> d3<span class="op">.</span><span class="fu">color</span>(<span class="fu">piecewiseColor</span>(selectedZone <span class="op">/</span> <span class="dv">10</span>))<span class="op">.</span><span class="fu">formatHex</span>())</span>
<span id="cb90-2125"><a href="#cb90-2125" aria-hidden="true" tabindex="-1"></a>viewof selectedDate <span class="op">=</span> Inputs<span class="op">.</span><span class="fu">input</span>(<span class="kw">new</span> <span class="bu">Date</span>(<span class="dv">2022</span><span class="op">,</span> <span class="kw">new</span> <span class="bu">Date</span>()<span class="op">.</span><span class="fu">getMonth</span>()<span class="op">,</span> <span class="kw">new</span> <span class="bu">Date</span>()<span class="op">.</span><span class="fu">getDate</span>()<span class="op">,</span> <span class="kw">new</span> <span class="bu">Date</span>()<span class="op">.</span><span class="fu">getHours</span>()))</span>
<span id="cb90-2126"><a href="#cb90-2126" aria-hidden="true" tabindex="-1"></a>viewof selectedHour <span class="op">=</span> Inputs<span class="op">.</span><span class="fu">input</span>(<span class="kw">new</span> <span class="bu">Date</span>(<span class="dv">2022</span><span class="op">,</span> <span class="kw">new</span> <span class="bu">Date</span>()<span class="op">.</span><span class="fu">getMonth</span>()<span class="op">,</span> <span class="kw">new</span> <span class="bu">Date</span>()<span class="op">.</span><span class="fu">getDate</span>()<span class="op">,</span> <span class="kw">new</span> <span class="bu">Date</span>()<span class="op">.</span><span class="fu">getHours</span>())<span class="op">.</span><span class="fu">getHours</span>())</span>
<span id="cb90-2127"><a href="#cb90-2127" aria-hidden="true" tabindex="-1"></a><span class="kw">function</span> <span class="fu">set</span>(input<span class="op">,</span> value) {</span>
<span id="cb90-2128"><a href="#cb90-2128" aria-hidden="true" tabindex="-1"></a>  input<span class="op">.</span><span class="at">value</span> <span class="op">=</span> value<span class="op">;</span></span>
<span id="cb90-2129"><a href="#cb90-2129" aria-hidden="true" tabindex="-1"></a>  input<span class="op">.</span><span class="fu">dispatchEvent</span>(<span class="kw">new</span> <span class="bu">Event</span>(<span class="st">"input"</span><span class="op">,</span> {<span class="dt">bubbles</span><span class="op">:</span> <span class="kw">true</span>}))<span class="op">;</span></span>
<span id="cb90-2130"><a href="#cb90-2130" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb90-2131"><a href="#cb90-2131" aria-hidden="true" tabindex="-1"></a>hD121 <span class="op">=</span> d3<span class="op">.</span><span class="fu">hsl</span>(<span class="fu">piecewiseColor</span>(<span class="dv">121</span> <span class="op">/</span> <span class="dv">365</span>))<span class="op">.</span><span class="at">h</span></span>
<span id="cb90-2132"><a href="#cb90-2132" aria-hidden="true" tabindex="-1"></a>hD268 <span class="op">=</span> d3<span class="op">.</span><span class="fu">hsl</span>(<span class="fu">piecewiseColor</span>(<span class="dv">268</span> <span class="op">/</span> <span class="dv">365</span>))<span class="op">.</span><span class="at">h</span></span>
<span id="cb90-2133"><a href="#cb90-2133" aria-hidden="true" tabindex="-1"></a>hD305 <span class="op">=</span> d3<span class="op">.</span><span class="fu">hsl</span>(<span class="fu">piecewiseColor</span>(<span class="dv">305</span> <span class="op">/</span> <span class="dv">365</span>))<span class="op">.</span><span class="at">h</span></span>
<span id="cb90-2134"><a href="#cb90-2134" aria-hidden="true" tabindex="-1"></a>hD306 <span class="op">=</span> d3<span class="op">.</span><span class="fu">hsl</span>(<span class="fu">piecewiseColor</span>(<span class="dv">306</span> <span class="op">/</span> <span class="dv">365</span>))<span class="op">.</span><span class="at">h</span></span>
<span id="cb90-2135"><a href="#cb90-2135" aria-hidden="true" tabindex="-1"></a>h1by320 <span class="op">=</span> d3<span class="op">.</span><span class="fu">hsl</span>(<span class="fu">piecewiseColor</span>(<span class="dv">1</span> <span class="op">/</span> <span class="dv">320</span>))<span class="op">.</span><span class="at">h</span></span>
<span id="cb90-2136"><a href="#cb90-2136" aria-hidden="true" tabindex="-1"></a>h1by8640 <span class="op">=</span> d3<span class="op">.</span><span class="fu">hsl</span>(<span class="fu">piecewiseColor</span>(<span class="dv">1</span> <span class="op">/</span> <span class="dv">8640</span>))<span class="op">.</span><span class="at">h</span></span>
<span id="cb90-2137"><a href="#cb90-2137" aria-hidden="true" tabindex="-1"></a>hues <span class="op">=</span> <span class="bu">Object</span><span class="op">.</span><span class="fu">fromEntries</span>([</span>
<span id="cb90-2138"><a href="#cb90-2138" aria-hidden="true" tabindex="-1"></a>  <span class="op">.</span><span class="dv">0083</span><span class="op">,</span></span>
<span id="cb90-2139"><a href="#cb90-2139" aria-hidden="true" tabindex="-1"></a>  <span class="op">.</span><span class="bn">0166</span><span class="op">,</span></span>
<span id="cb90-2140"><a href="#cb90-2140" aria-hidden="true" tabindex="-1"></a>  <span class="op">.</span><span class="dv">0229</span><span class="op">,</span></span>
<span id="cb90-2141"><a href="#cb90-2141" aria-hidden="true" tabindex="-1"></a>  <span class="op">.</span><span class="bn">025</span><span class="op">,</span></span>
<span id="cb90-2142"><a href="#cb90-2142" aria-hidden="true" tabindex="-1"></a>  <span class="op">.</span><span class="dv">287</span><span class="op">,</span></span>
<span id="cb90-2143"><a href="#cb90-2143" aria-hidden="true" tabindex="-1"></a>  <span class="op">.</span><span class="bn">0333</span><span class="op">,</span></span>
<span id="cb90-2144"><a href="#cb90-2144" aria-hidden="true" tabindex="-1"></a>  <span class="op">.</span><span class="bn">0416</span><span class="op">,</span></span>
<span id="cb90-2145"><a href="#cb90-2145" aria-hidden="true" tabindex="-1"></a>  <span class="op">.</span><span class="bn">05</span><span class="op">,</span></span>
<span id="cb90-2146"><a href="#cb90-2146" aria-hidden="true" tabindex="-1"></a>  <span class="op">.</span><span class="dv">125</span><span class="op">,</span></span>
<span id="cb90-2147"><a href="#cb90-2147" aria-hidden="true" tabindex="-1"></a>  <span class="op">.</span><span class="dv">333</span><span class="op">,</span></span>
<span id="cb90-2148"><a href="#cb90-2148" aria-hidden="true" tabindex="-1"></a>  <span class="op">.</span><span class="dv">375</span><span class="op">,</span></span>
<span id="cb90-2149"><a href="#cb90-2149" aria-hidden="true" tabindex="-1"></a>  <span class="op">.</span><span class="dv">429</span><span class="op">,</span></span>
<span id="cb90-2150"><a href="#cb90-2150" aria-hidden="true" tabindex="-1"></a>  <span class="op">.</span><span class="dv">533</span><span class="op">,</span></span>
<span id="cb90-2151"><a href="#cb90-2151" aria-hidden="true" tabindex="-1"></a>  <span class="op">.</span><span class="dv">969</span><span class="op">,</span></span>
<span id="cb90-2152"><a href="#cb90-2152" aria-hidden="true" tabindex="-1"></a>  <span class="op">.</span><span class="dv">999</span><span class="op">,</span></span>
<span id="cb90-2153"><a href="#cb90-2153" aria-hidden="true" tabindex="-1"></a>  ]<span class="op">.</span><span class="fu">map</span>(i <span class="kw">=&gt;</span> [i<span class="op">,</span> d3<span class="op">.</span><span class="fu">hsl</span>(<span class="fu">piecewiseColor</span>(i))<span class="op">.</span><span class="at">h</span>])</span>
<span id="cb90-2154"><a href="#cb90-2154" aria-hidden="true" tabindex="-1"></a>)<span class="op">;</span></span>
<span id="cb90-2155"><a href="#cb90-2155" aria-hidden="true" tabindex="-1"></a><span class="co">// https://observablehq.com/@mattdzugan/population-by-time-zone-creating-a-dataset</span></span>
<span id="cb90-2156"><a href="#cb90-2156" aria-hidden="true" tabindex="-1"></a>populationByTimeZone <span class="op">=</span> <span class="fu">FileAttachment</span>(<span class="st">"../../asset/populationByTimeZone.json"</span>)<span class="op">.</span><span class="fu">json</span>()<span class="op">;</span></span>
<span id="cb90-2157"><a href="#cb90-2157" aria-hidden="true" tabindex="-1"></a>sortedPop <span class="op">=</span> populationByTimeZone<span class="op">.</span><span class="fu">sort</span>(</span>
<span id="cb90-2158"><a href="#cb90-2158" aria-hidden="true" tabindex="-1"></a>  (a<span class="op">,</span> b) <span class="kw">=&gt;</span> sortParams[<span class="dv">1</span>] <span class="op">?</span> <span class="fu">sortFunc</span>(a<span class="op">.</span><span class="at">number</span><span class="op">,</span> b<span class="op">.</span><span class="at">number</span>) <span class="op">:</span> <span class="fu">sortFunc</span>(a<span class="op">.</span><span class="at">pop</span><span class="op">,</span> b<span class="op">.</span><span class="at">pop</span>)</span>
<span id="cb90-2159"><a href="#cb90-2159" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb90-2160"><a href="#cb90-2160" aria-hidden="true" tabindex="-1"></a>sortFunc <span class="op">=</span> sortParams[<span class="dv">0</span>] <span class="op">?</span> d3<span class="op">.</span><span class="at">ascending</span> <span class="op">:</span> d3<span class="op">.</span><span class="at">descending</span></span>
<span id="cb90-2161"><a href="#cb90-2161" aria-hidden="true" tabindex="-1"></a>popBySign <span class="op">=</span> d3<span class="op">.</span><span class="fu">rollup</span>(sortedPop<span class="op">,</span> v <span class="kw">=&gt;</span> d3<span class="op">.</span><span class="fu">sum</span>(v<span class="op">,</span> d <span class="kw">=&gt;</span> d<span class="op">.</span><span class="at">pop</span> <span class="op">/</span> <span class="fl">1e9</span>)<span class="op">,</span> d <span class="kw">=&gt;</span> d<span class="op">.</span><span class="at">Sign</span>)</span>
<span id="cb90-2162"><a href="#cb90-2162" aria-hidden="true" tabindex="-1"></a>totalPop <span class="op">=</span> d3<span class="op">.</span><span class="fu">sum</span>(sortedPop<span class="op">,</span> d <span class="kw">=&gt;</span> d<span class="op">.</span><span class="at">pop</span> <span class="op">/</span> <span class="fl">1e9</span>)</span>
<span id="cb90-2163"><a href="#cb90-2163" aria-hidden="true" tabindex="-1"></a>utcOffsetM <span class="op">=</span> <span class="op">-</span>(<span class="kw">new</span> <span class="bu">Date</span>)<span class="op">.</span><span class="fu">getTimezoneOffset</span>()</span>
<span id="cb90-2164"><a href="#cb90-2164" aria-hidden="true" tabindex="-1"></a>utcOffsetD <span class="op">=</span> utcOffsetM <span class="op">/</span> <span class="dv">144</span></span>
<span id="cb90-2165"><a href="#cb90-2165" aria-hidden="true" tabindex="-1"></a>utcOffsetP <span class="op">=</span> (utcOffsetD <span class="op">+</span> <span class="dv">10</span>) <span class="op">%</span> <span class="dv">10</span></span>
<span id="cb90-2166"><a href="#cb90-2166" aria-hidden="true" tabindex="-1"></a>decZone <span class="op">=</span> ydz[<span class="dv">2</span>]</span>
<span id="cb90-2167"><a href="#cb90-2167" aria-hidden="true" tabindex="-1"></a>decZonePos <span class="op">=</span> (decZone <span class="op">+</span> <span class="dv">10</span>) <span class="op">%</span> <span class="dv">10</span></span>
<span id="cb90-2168"><a href="#cb90-2168" aria-hidden="true" tabindex="-1"></a>utcOffDiff <span class="op">=</span> <span class="pp">parseFloat</span>((<span class="bu">Math</span><span class="op">.</span><span class="fu">round</span>(utcOffsetD) <span class="op">-</span> utcOffsetD)<span class="op">.</span><span class="fu">toFixed</span>(<span class="dv">2</span>))</span>
<span id="cb90-2169"><a href="#cb90-2169" aria-hidden="true" tabindex="-1"></a>utcOffHslM <span class="op">=</span> <span class="fu">textcolor</span>(utcOffsetM<span class="op">,</span> <span class="vs">`hsl(</span><span class="sc">${</span>d3<span class="op">.</span><span class="fu">hsl</span>(<span class="fu">piecewiseColor</span>(utcOffsetP <span class="op">/</span> <span class="dv">10</span>))<span class="op">.</span><span class="at">h</span><span class="sc">}</span><span class="vs">`</span> <span class="op">+</span> slStr)</span>
<span id="cb90-2170"><a href="#cb90-2170" aria-hidden="true" tabindex="-1"></a>utcOffHslD <span class="op">=</span> <span class="fu">textcolor</span>(<span class="pp">parseFloat</span>(utcOffsetD<span class="op">.</span><span class="fu">toFixed</span>(<span class="dv">2</span>))<span class="op">,</span> <span class="vs">`hsl(</span><span class="sc">${</span>d3<span class="op">.</span><span class="fu">hsl</span>(<span class="fu">piecewiseColor</span>(utcOffsetP <span class="op">/</span> <span class="dv">10</span>))<span class="op">.</span><span class="at">h</span><span class="sc">}</span><span class="vs">`</span> <span class="op">+</span> slStr)</span>
<span id="cb90-2171"><a href="#cb90-2171" aria-hidden="true" tabindex="-1"></a>decZonHslP <span class="op">=</span> <span class="fu">textcolor</span>(decZonePos<span class="op">,</span> <span class="vs">`hsl(</span><span class="sc">${</span>d3<span class="op">.</span><span class="fu">hsl</span>(<span class="fu">piecewiseColor</span>(decZonePos <span class="op">/</span> <span class="dv">10</span>))<span class="op">.</span><span class="at">h</span><span class="sc">}</span><span class="vs">`</span> <span class="op">+</span> slStr)</span>
<span id="cb90-2172"><a href="#cb90-2172" aria-hidden="true" tabindex="-1"></a>utcOffsetMdiffHsl <span class="op">=</span> <span class="fu">textcolor</span>(<span class="pp">parseFloat</span>((utcOffDiff <span class="op">*</span> <span class="dv">144</span>)<span class="op">.</span><span class="fu">toFixed</span>(<span class="dv">2</span>))<span class="op">,</span> <span class="vs">`hsl(</span><span class="sc">${</span>d3<span class="op">.</span><span class="fu">hsl</span>(<span class="fu">piecewiseColor</span>(utcOffDiff <span class="op">/</span> <span class="dv">10</span>))<span class="op">.</span><span class="at">h</span><span class="sc">}</span><span class="vs">`</span> <span class="op">+</span> slStr)</span>
<span id="cb90-2173"><a href="#cb90-2173" aria-hidden="true" tabindex="-1"></a>utcOffDiffHsl <span class="op">=</span> <span class="fu">textcolor</span>(utcOffDiff<span class="op">,</span> <span class="vs">`hsl(</span><span class="sc">${</span>d3<span class="op">.</span><span class="fu">hsl</span>(<span class="fu">piecewiseColor</span>(utcOffDiff <span class="op">/</span> <span class="dv">10</span>))<span class="op">.</span><span class="at">h</span><span class="sc">}</span><span class="vs">`</span> <span class="op">+</span> slStr)</span>
<span id="cb90-2174"><a href="#cb90-2174" aria-hidden="true" tabindex="-1"></a><span class="kw">function</span> <span class="fu">date2dote</span>(year <span class="op">=</span> <span class="dv">1969</span><span class="op">,</span> doty <span class="op">=</span> <span class="dv">306</span><span class="op">,</span> zone <span class="op">=</span> <span class="dv">0</span>) {</span>
<span id="cb90-2175"><a href="#cb90-2175" aria-hidden="true" tabindex="-1"></a>    <span class="kw">const</span> cote <span class="op">=</span> <span class="bu">Math</span><span class="op">.</span><span class="fu">floor</span>((year <span class="op">&gt;=</span> <span class="dv">0</span> <span class="op">?</span> year <span class="op">:</span> year <span class="op">-</span> <span class="dv">399</span>) <span class="op">/</span> <span class="dv">400</span>)<span class="op">,</span> yote <span class="op">=</span> year <span class="op">-</span> cote <span class="op">*</span> <span class="dv">400</span><span class="op">;</span></span>
<span id="cb90-2176"><a href="#cb90-2176" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> [cote <span class="op">*</span> <span class="dv">146097</span> <span class="op">+</span> yote <span class="op">*</span> <span class="dv">365</span> <span class="op">+</span> <span class="bu">Math</span><span class="op">.</span><span class="fu">floor</span>(yote <span class="op">/</span> <span class="dv">4</span>) <span class="op">-</span> <span class="bu">Math</span><span class="op">.</span><span class="fu">floor</span>(yote <span class="op">/</span> <span class="dv">100</span>) <span class="op">+</span> doty<span class="op">,</span> zone]</span>
<span id="cb90-2177"><a href="#cb90-2177" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb90-2178"><a href="#cb90-2178" aria-hidden="true" tabindex="-1"></a>leapSecondDotes <span class="op">=</span> [</span>
<span id="cb90-2179"><a href="#cb90-2179" aria-hidden="true" tabindex="-1"></a>  [<span class="dv">1972</span><span class="op">,</span> <span class="dv">121</span>]<span class="op">,</span></span>
<span id="cb90-2180"><a href="#cb90-2180" aria-hidden="true" tabindex="-1"></a>  [<span class="dv">1972</span><span class="op">,</span> <span class="dv">305</span>]<span class="op">,</span></span>
<span id="cb90-2181"><a href="#cb90-2181" aria-hidden="true" tabindex="-1"></a>  [<span class="dv">1973</span><span class="op">,</span> <span class="dv">305</span>]<span class="op">,</span></span>
<span id="cb90-2182"><a href="#cb90-2182" aria-hidden="true" tabindex="-1"></a>  [<span class="dv">1974</span><span class="op">,</span> <span class="dv">305</span>]<span class="op">,</span></span>
<span id="cb90-2183"><a href="#cb90-2183" aria-hidden="true" tabindex="-1"></a>  [<span class="dv">1975</span><span class="op">,</span> <span class="dv">305</span>]<span class="op">,</span></span>
<span id="cb90-2184"><a href="#cb90-2184" aria-hidden="true" tabindex="-1"></a>  [<span class="dv">1976</span><span class="op">,</span> <span class="dv">305</span>]<span class="op">,</span></span>
<span id="cb90-2185"><a href="#cb90-2185" aria-hidden="true" tabindex="-1"></a>  [<span class="dv">1977</span><span class="op">,</span> <span class="dv">305</span>]<span class="op">,</span></span>
<span id="cb90-2186"><a href="#cb90-2186" aria-hidden="true" tabindex="-1"></a>  [<span class="dv">1978</span><span class="op">,</span> <span class="dv">305</span>]<span class="op">,</span></span>
<span id="cb90-2187"><a href="#cb90-2187" aria-hidden="true" tabindex="-1"></a>  [<span class="dv">1979</span><span class="op">,</span> <span class="dv">305</span>]<span class="op">,</span></span>
<span id="cb90-2188"><a href="#cb90-2188" aria-hidden="true" tabindex="-1"></a>  [<span class="dv">1981</span><span class="op">,</span> <span class="dv">121</span>]<span class="op">,</span></span>
<span id="cb90-2189"><a href="#cb90-2189" aria-hidden="true" tabindex="-1"></a>  [<span class="dv">1982</span><span class="op">,</span> <span class="dv">121</span>]<span class="op">,</span></span>
<span id="cb90-2190"><a href="#cb90-2190" aria-hidden="true" tabindex="-1"></a>  [<span class="dv">1983</span><span class="op">,</span> <span class="dv">121</span>]<span class="op">,</span></span>
<span id="cb90-2191"><a href="#cb90-2191" aria-hidden="true" tabindex="-1"></a>  [<span class="dv">1985</span><span class="op">,</span> <span class="dv">121</span>]<span class="op">,</span></span>
<span id="cb90-2192"><a href="#cb90-2192" aria-hidden="true" tabindex="-1"></a>  [<span class="dv">1987</span><span class="op">,</span> <span class="dv">305</span>]<span class="op">,</span></span>
<span id="cb90-2193"><a href="#cb90-2193" aria-hidden="true" tabindex="-1"></a>  [<span class="dv">1989</span><span class="op">,</span> <span class="dv">305</span>]<span class="op">,</span></span>
<span id="cb90-2194"><a href="#cb90-2194" aria-hidden="true" tabindex="-1"></a>  [<span class="dv">1990</span><span class="op">,</span> <span class="dv">305</span>]<span class="op">,</span></span>
<span id="cb90-2195"><a href="#cb90-2195" aria-hidden="true" tabindex="-1"></a>  [<span class="dv">1992</span><span class="op">,</span> <span class="dv">121</span>]<span class="op">,</span></span>
<span id="cb90-2196"><a href="#cb90-2196" aria-hidden="true" tabindex="-1"></a>  [<span class="dv">1993</span><span class="op">,</span> <span class="dv">121</span>]<span class="op">,</span></span>
<span id="cb90-2197"><a href="#cb90-2197" aria-hidden="true" tabindex="-1"></a>  [<span class="dv">1994</span><span class="op">,</span> <span class="dv">121</span>]<span class="op">,</span></span>
<span id="cb90-2198"><a href="#cb90-2198" aria-hidden="true" tabindex="-1"></a>  [<span class="dv">1995</span><span class="op">,</span> <span class="dv">305</span>]<span class="op">,</span></span>
<span id="cb90-2199"><a href="#cb90-2199" aria-hidden="true" tabindex="-1"></a>  [<span class="dv">1997</span><span class="op">,</span> <span class="dv">121</span>]<span class="op">,</span></span>
<span id="cb90-2200"><a href="#cb90-2200" aria-hidden="true" tabindex="-1"></a>  [<span class="dv">1998</span><span class="op">,</span> <span class="dv">305</span>]<span class="op">,</span></span>
<span id="cb90-2201"><a href="#cb90-2201" aria-hidden="true" tabindex="-1"></a>  [<span class="dv">2005</span><span class="op">,</span> <span class="dv">305</span>]<span class="op">,</span></span>
<span id="cb90-2202"><a href="#cb90-2202" aria-hidden="true" tabindex="-1"></a>  [<span class="dv">2008</span><span class="op">,</span> <span class="dv">305</span>]<span class="op">,</span></span>
<span id="cb90-2203"><a href="#cb90-2203" aria-hidden="true" tabindex="-1"></a>  [<span class="dv">2012</span><span class="op">,</span> <span class="dv">121</span>]<span class="op">,</span></span>
<span id="cb90-2204"><a href="#cb90-2204" aria-hidden="true" tabindex="-1"></a>  [<span class="dv">2015</span><span class="op">,</span> <span class="dv">121</span>]<span class="op">,</span></span>
<span id="cb90-2205"><a href="#cb90-2205" aria-hidden="true" tabindex="-1"></a>  [<span class="dv">2016</span><span class="op">,</span> <span class="dv">305</span>]<span class="op">,</span></span>
<span id="cb90-2206"><a href="#cb90-2206" aria-hidden="true" tabindex="-1"></a>]<span class="op">.</span><span class="fu">map</span>(x <span class="kw">=&gt;</span> <span class="fu">date2dote</span>(<span class="op">...</span>x)[<span class="dv">0</span>])</span>
<span id="cb90-2207"><a href="#cb90-2207" aria-hidden="true" tabindex="-1"></a>leapSecondDote <span class="op">=</span> <span class="fu">date2dote</span>(leapSecondYear<span class="op">,</span> leapSecondDate)[<span class="dv">0</span>]</span>
<span id="cb90-2208"><a href="#cb90-2208" aria-hidden="true" tabindex="-1"></a>leapCount <span class="op">=</span> leapSecondDotes<span class="op">.</span><span class="fu">filter</span>(dote <span class="kw">=&gt;</span> leapSecondDote <span class="op">&gt;</span> dote)<span class="op">.</span><span class="at">length</span><span class="op">;</span></span>
<span id="cb90-2209"><a href="#cb90-2209" aria-hidden="true" tabindex="-1"></a>leapColor <span class="op">=</span> d3<span class="op">.</span><span class="fu">color</span>(<span class="fu">piecewiseColor</span>(leapCount <span class="op">/</span> <span class="dv">86400</span>))<span class="op">.</span><span class="fu">formatHex</span>()</span>
<span id="cb90-2210"><a href="#cb90-2210" aria-hidden="true" tabindex="-1"></a>leapCountHsl <span class="op">=</span> <span class="fu">textcolor</span>(leapCount<span class="op">,</span> leapColor)</span>
<span id="cb90-2211"><a href="#cb90-2211" aria-hidden="true" tabindex="-1"></a>frac <span class="op">=</span> <span class="pp">require</span>(<span class="st">"fraction.js"</span>)</span>
<span id="cb90-2212"><a href="#cb90-2212" aria-hidden="true" tabindex="-1"></a>leapFrac <span class="op">=</span> <span class="fu">frac</span>(leapCount)<span class="op">.</span><span class="fu">div</span>(<span class="dv">8640</span>)<span class="op">.</span><span class="fu">toFraction</span>()</span>
<span id="cb90-2213"><a href="#cb90-2213" aria-hidden="true" tabindex="-1"></a>leapTzoHsl0 <span class="op">=</span> <span class="fu">textcolor</span>(leapFrac<span class="op">,</span> leapColor)</span>
<span id="cb90-2214"><a href="#cb90-2214" aria-hidden="true" tabindex="-1"></a>leapTzoHsl1 <span class="op">=</span> <span class="fu">textcolor</span>(leapFrac<span class="op">,</span> leapColor)</span>
<span id="cb90-2215"><a href="#cb90-2215" aria-hidden="true" tabindex="-1"></a>leapTzoHsl2 <span class="op">=</span> <span class="fu">textcolor</span>(leapFrac<span class="op">,</span> leapColor)</span>
<span id="cb90-2216"><a href="#cb90-2216" aria-hidden="true" tabindex="-1"></a>hmsTzo <span class="op">=</span> <span class="fu">frac</span>(hmsinput[<span class="dv">0</span>])<span class="op">.</span><span class="fu">div</span>(<span class="dv">24</span>)<span class="op">.</span><span class="fu">add</span>(hmsinput[<span class="dv">1</span>]<span class="op">,</span> <span class="dv">1440</span>)<span class="op">.</span><span class="fu">add</span>(hmsinput[<span class="dv">2</span>]<span class="op">,</span> <span class="dv">86400</span>)<span class="op">.</span><span class="fu">mod</span>(<span class="dv">1</span>)</span>
<span id="cb90-2217"><a href="#cb90-2217" aria-hidden="true" tabindex="-1"></a>hmsTzox10 <span class="op">=</span> hmsTzo<span class="op">.</span><span class="fu">mul</span>(<span class="dv">10</span>)</span>
<span id="cb90-2218"><a href="#cb90-2218" aria-hidden="true" tabindex="-1"></a>pluralx10 <span class="op">=</span> hmsTzox10<span class="op">.</span><span class="fu">equals</span>(<span class="dv">1</span>) <span class="op">?</span> <span class="st">""</span> <span class="op">:</span> <span class="st">"s"</span></span>
<span id="cb90-2219"><a href="#cb90-2219" aria-hidden="true" tabindex="-1"></a>hmsRounded <span class="op">=</span> hmsTzox10<span class="op">.</span><span class="fu">round</span>(digits <span class="op">-</span> <span class="dv">1</span>)</span>
<span id="cb90-2220"><a href="#cb90-2220" aria-hidden="true" tabindex="-1"></a>hmsRef <span class="op">=</span> hmsRounded<span class="op">.</span><span class="fu">sub</span>(hmsTzox10)</span>
<span id="cb90-2221"><a href="#cb90-2221" aria-hidden="true" tabindex="-1"></a>hmsRefHsl <span class="op">=</span> <span class="fu">textcolor</span>(hmsRef<span class="op">.</span><span class="fu">abs</span>()<span class="op">.</span><span class="fu">toFraction</span>()<span class="op">,</span> d3<span class="op">.</span><span class="fu">color</span>(<span class="fu">piecewiseColor</span>(<span class="bu">Number</span>(hmsRef<span class="op">.</span><span class="fu">div</span>(<span class="dv">10</span>))))<span class="op">.</span><span class="fu">formatHex</span>())</span>
<span id="cb90-2222"><a href="#cb90-2222" aria-hidden="true" tabindex="-1"></a>hmsRefSign <span class="op">=</span> hmsRef<span class="op">.</span><span class="fu">lt</span>(<span class="dv">0</span>) <span class="op">?</span> <span class="st">"-"</span> <span class="op">:</span> <span class="st">"+"</span></span>
<span id="cb90-2223"><a href="#cb90-2223" aria-hidden="true" tabindex="-1"></a>hmsTzoHsl <span class="op">=</span> <span class="fu">textcolor</span>(hmsTzox10<span class="op">.</span><span class="fu">toFraction</span>()<span class="op">,</span> d3<span class="op">.</span><span class="fu">color</span>(<span class="fu">piecewiseColor</span>(<span class="bu">Number</span>(hmsTzo)))<span class="op">.</span><span class="fu">formatHex</span>())</span>
<span id="cb90-2224"><a href="#cb90-2224" aria-hidden="true" tabindex="-1"></a>hmsRodHsl <span class="op">=</span> <span class="fu">textcolor</span>(hmsRounded<span class="op">,</span> d3<span class="op">.</span><span class="fu">color</span>(<span class="fu">piecewiseColor</span>(<span class="bu">Number</span>(hmsRounded<span class="op">.</span><span class="fu">div</span>(<span class="dv">10</span>))))<span class="op">.</span><span class="fu">formatHex</span>())</span>
<span id="cb90-2225"><a href="#cb90-2225" aria-hidden="true" tabindex="-1"></a>hmsTod <span class="op">=</span> (zeroTime <span class="op">+</span> hmsTzo) <span class="op">%</span> <span class="dv">1</span></span>
<span id="cb90-2226"><a href="#cb90-2226" aria-hidden="true" tabindex="-1"></a>hmsTodHsl <span class="op">=</span> <span class="fu">textcolor</span>((hmsTod <span class="op">*</span> <span class="dv">10</span>)<span class="op">.</span><span class="fu">toFixed</span>(<span class="dv">4</span>)<span class="op">,</span> d3<span class="op">.</span><span class="fu">color</span>(<span class="fu">piecewiseColor</span>(hmsTod))<span class="op">.</span><span class="fu">formatHex</span>())</span>
<span id="cb90-2227"><a href="#cb90-2227" aria-hidden="true" tabindex="-1"></a>leapTod <span class="op">=</span> (zeroTime <span class="op">+</span> leapCount <span class="op">/</span> <span class="dv">86400</span>) <span class="op">%</span> <span class="dv">1</span></span>
<span id="cb90-2228"><a href="#cb90-2228" aria-hidden="true" tabindex="-1"></a>leapDecidayTod <span class="op">=</span> (leapTod <span class="op">*</span> <span class="dv">10</span>)<span class="op">.</span><span class="fu">toFixed</span>(<span class="dv">4</span>)</span>
<span id="cb90-2229"><a href="#cb90-2229" aria-hidden="true" tabindex="-1"></a>leapTodHsl0 <span class="op">=</span> <span class="fu">textcolor</span>(leapDecidayTod<span class="op">,</span> d3<span class="op">.</span><span class="fu">color</span>(<span class="fu">piecewiseColor</span>(leapTod))<span class="op">.</span><span class="fu">formatHex</span>())</span>
<span id="cb90-2230"><a href="#cb90-2230" aria-hidden="true" tabindex="-1"></a>leapTodHsl1 <span class="op">=</span> <span class="fu">textcolor</span>(leapDecidayTod<span class="op">,</span> d3<span class="op">.</span><span class="fu">color</span>(<span class="fu">piecewiseColor</span>(leapTod))<span class="op">.</span><span class="fu">formatHex</span>())</span>
<span id="cb90-2231"><a href="#cb90-2231" aria-hidden="true" tabindex="-1"></a>longInputHsl <span class="op">=</span> <span class="fu">textcolor</span>(lonInput<span class="op">,</span> d3<span class="op">.</span><span class="fu">color</span>(<span class="fu">piecewiseColor</span>(lonInput <span class="op">/</span> <span class="dv">10</span>))<span class="op">.</span><span class="fu">formatHex</span>())</span>
<span id="cb90-2232"><a href="#cb90-2232" aria-hidden="true" tabindex="-1"></a>eot <span class="op">=</span> <span class="fu">getEot</span>(leapSecondDate)</span>
<span id="cb90-2233"><a href="#cb90-2233" aria-hidden="true" tabindex="-1"></a>astTzo <span class="op">=</span> eot <span class="op">+</span> lonInput</span>
<span id="cb90-2234"><a href="#cb90-2234" aria-hidden="true" tabindex="-1"></a>astTzoHsl <span class="op">=</span> <span class="fu">textcolor</span>(astTzo<span class="op">.</span><span class="fu">toFixed</span>(<span class="dv">4</span>)<span class="op">,</span> d3<span class="op">.</span><span class="fu">color</span>(<span class="fu">piecewiseColor</span>(astTzo <span class="op">/</span> <span class="dv">10</span>))<span class="op">.</span><span class="fu">formatHex</span>())</span>
<span id="cb90-2235"><a href="#cb90-2235" aria-hidden="true" tabindex="-1"></a>eotHsl <span class="op">=</span> <span class="fu">textcolor</span>(eot<span class="op">.</span><span class="fu">toFixed</span>(<span class="dv">4</span>)<span class="op">,</span> d3<span class="op">.</span><span class="fu">color</span>(<span class="fu">piecewiseColor</span>(eot <span class="op">/</span> <span class="dv">10</span>))<span class="op">.</span><span class="fu">formatHex</span>())</span>
<span id="cb90-2236"><a href="#cb90-2236" aria-hidden="true" tabindex="-1"></a>eotSum <span class="op">=</span> (zeroTime <span class="op">+</span> astTzo <span class="op">+</span> <span class="dv">10</span>) <span class="op">%</span> <span class="dv">10</span></span>
<span id="cb90-2237"><a href="#cb90-2237" aria-hidden="true" tabindex="-1"></a>eotSumHsl <span class="op">=</span> <span class="fu">textcolor</span>(eotSum<span class="op">.</span><span class="fu">toFixed</span>(<span class="dv">4</span>)<span class="op">,</span> d3<span class="op">.</span><span class="fu">color</span>(<span class="fu">piecewiseColor</span>(eotSum <span class="op">/</span> <span class="dv">10</span>))<span class="op">.</span><span class="fu">formatHex</span>())</span>
<span id="cb90-2238"><a href="#cb90-2238" aria-hidden="true" tabindex="-1"></a><span class="co">// https://observablehq.com/@mcmcclur/adaptive-plotter</span></span>
<span id="cb90-2239"><a href="#cb90-2239" aria-hidden="true" tabindex="-1"></a><span class="kw">function</span> <span class="fu">build_samples</span>(f<span class="op">,</span> a<span class="op">,</span> b<span class="op">,</span> opts <span class="op">=</span> {}) {</span>
<span id="cb90-2240"><a href="#cb90-2240" aria-hidden="true" tabindex="-1"></a>  <span class="kw">let</span> { N <span class="op">=</span> <span class="dv">9</span><span class="op">,</span> max_depth <span class="op">=</span> <span class="dv">6</span> } <span class="op">=</span> opts<span class="op">;</span></span>
<span id="cb90-2241"><a href="#cb90-2241" aria-hidden="true" tabindex="-1"></a>  <span class="kw">let</span> dx <span class="op">=</span> (b <span class="op">-</span> a) <span class="op">/</span> N<span class="op">;</span></span>
<span id="cb90-2242"><a href="#cb90-2242" aria-hidden="true" tabindex="-1"></a>  <span class="kw">let</span> root_intervals <span class="op">=</span> <span class="bu">Array</span><span class="op">.</span><span class="fu">from</span>({ <span class="dt">length</span><span class="op">:</span> N })<span class="op">.</span><span class="fu">map</span>(</span>
<span id="cb90-2243"><a href="#cb90-2243" aria-hidden="true" tabindex="-1"></a>    (_<span class="op">,</span> i) <span class="kw">=&gt;</span> <span class="kw">new</span> <span class="fu">Interval</span>(a <span class="op">+</span> i <span class="op">*</span> dx<span class="op">,</span> a <span class="op">+</span> (i <span class="op">+</span> <span class="dv">1</span>) <span class="op">*</span> dx<span class="op">,</span> <span class="dv">0</span>)</span>
<span id="cb90-2244"><a href="#cb90-2244" aria-hidden="true" tabindex="-1"></a>  )<span class="op">;</span></span>
<span id="cb90-2245"><a href="#cb90-2245" aria-hidden="true" tabindex="-1"></a>  root_intervals<span class="op">.</span><span class="fu">forEach</span>((I) <span class="kw">=&gt;</span> {</span>
<span id="cb90-2246"><a href="#cb90-2246" aria-hidden="true" tabindex="-1"></a>    I<span class="op">.</span><span class="at">fa</span> <span class="op">=</span> <span class="fu">f</span>(I<span class="op">.</span><span class="at">a</span>)<span class="op">;</span></span>
<span id="cb90-2247"><a href="#cb90-2247" aria-hidden="true" tabindex="-1"></a>    I<span class="op">.</span><span class="at">fb</span> <span class="op">=</span> <span class="fu">f</span>(I<span class="op">.</span><span class="at">b</span>)<span class="op">;</span></span>
<span id="cb90-2248"><a href="#cb90-2248" aria-hidden="true" tabindex="-1"></a>  })<span class="op">;</span></span>
<span id="cb90-2249"><a href="#cb90-2249" aria-hidden="true" tabindex="-1"></a>  root_intervals<span class="op">.</span><span class="fu">reverse</span>()<span class="op">;</span></span>
<span id="cb90-2250"><a href="#cb90-2250" aria-hidden="true" tabindex="-1"></a>  <span class="kw">let</span> stack <span class="op">=</span> root_intervals<span class="op">;</span></span>
<span id="cb90-2251"><a href="#cb90-2251" aria-hidden="true" tabindex="-1"></a>  <span class="kw">let</span> cnt <span class="op">=</span> <span class="dv">0</span><span class="op">;</span></span>
<span id="cb90-2252"><a href="#cb90-2252" aria-hidden="true" tabindex="-1"></a>  <span class="kw">let</span> pts <span class="op">=</span> []<span class="op">;</span></span>
<span id="cb90-2253"><a href="#cb90-2253" aria-hidden="true" tabindex="-1"></a>  <span class="kw">let</span> nodeRight<span class="op">,</span> nodeLeft<span class="op">;</span></span>
<span id="cb90-2254"><a href="#cb90-2254" aria-hidden="true" tabindex="-1"></a>  <span class="cf">while</span> (stack<span class="op">.</span><span class="at">length</span> <span class="op">&gt;</span> <span class="dv">0</span> <span class="op">&amp;&amp;</span> cnt<span class="op">++</span> <span class="op">&lt;</span> <span class="dv">100000</span>) {</span>
<span id="cb90-2255"><a href="#cb90-2255" aria-hidden="true" tabindex="-1"></a>    <span class="kw">let</span> node <span class="op">=</span> stack<span class="op">.</span><span class="fu">pop</span>()<span class="op">;</span></span>
<span id="cb90-2256"><a href="#cb90-2256" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> (<span class="fu">test</span>(f<span class="op">,</span> node<span class="op">,</span> opts)) {</span>
<span id="cb90-2257"><a href="#cb90-2257" aria-hidden="true" tabindex="-1"></a>      <span class="kw">let</span> midpoint <span class="op">=</span> node<span class="op">.</span><span class="at">midpoint</span><span class="op">;</span></span>
<span id="cb90-2258"><a href="#cb90-2258" aria-hidden="true" tabindex="-1"></a>      <span class="kw">let</span> new_depth <span class="op">=</span> node<span class="op">.</span><span class="at">depth</span> <span class="op">+</span> <span class="dv">1</span><span class="op">;</span></span>
<span id="cb90-2259"><a href="#cb90-2259" aria-hidden="true" tabindex="-1"></a>      <span class="cf">if</span> (new_depth <span class="op">&lt;=</span> max_depth) {</span>
<span id="cb90-2260"><a href="#cb90-2260" aria-hidden="true" tabindex="-1"></a>        <span class="kw">let</span> a_left <span class="op">=</span> node<span class="op">.</span><span class="at">a</span><span class="op">;</span></span>
<span id="cb90-2261"><a href="#cb90-2261" aria-hidden="true" tabindex="-1"></a>        <span class="kw">let</span> b_left <span class="op">=</span> midpoint<span class="op">;</span></span>
<span id="cb90-2262"><a href="#cb90-2262" aria-hidden="true" tabindex="-1"></a>        nodeLeft <span class="op">=</span> <span class="kw">new</span> <span class="fu">Interval</span>(a_left<span class="op">,</span> b_left<span class="op">,</span> new_depth)<span class="op">;</span></span>
<span id="cb90-2263"><a href="#cb90-2263" aria-hidden="true" tabindex="-1"></a>        nodeLeft<span class="op">.</span><span class="at">fa</span> <span class="op">=</span> <span class="fu">f</span>(a_left)<span class="op">;</span></span>
<span id="cb90-2264"><a href="#cb90-2264" aria-hidden="true" tabindex="-1"></a>        nodeLeft<span class="op">.</span><span class="at">fb</span> <span class="op">=</span> <span class="fu">f</span>(b_left)<span class="op">;</span></span>
<span id="cb90-2265"><a href="#cb90-2265" aria-hidden="true" tabindex="-1"></a>        node<span class="op">.</span><span class="at">left</span> <span class="op">=</span> nodeLeft<span class="op">;</span></span>
<span id="cb90-2266"><a href="#cb90-2266" aria-hidden="true" tabindex="-1"></a>        <span class="kw">let</span> a_right <span class="op">=</span> midpoint<span class="op">;</span></span>
<span id="cb90-2267"><a href="#cb90-2267" aria-hidden="true" tabindex="-1"></a>        <span class="kw">let</span> b_right <span class="op">=</span> node<span class="op">.</span><span class="at">b</span><span class="op">;</span></span>
<span id="cb90-2268"><a href="#cb90-2268" aria-hidden="true" tabindex="-1"></a>        nodeRight <span class="op">=</span> <span class="kw">new</span> <span class="fu">Interval</span>(a_right<span class="op">,</span> b_right<span class="op">,</span> new_depth)<span class="op">;</span></span>
<span id="cb90-2269"><a href="#cb90-2269" aria-hidden="true" tabindex="-1"></a>        nodeRight<span class="op">.</span><span class="at">fa</span> <span class="op">=</span> <span class="fu">f</span>(a_left)<span class="op">;</span></span>
<span id="cb90-2270"><a href="#cb90-2270" aria-hidden="true" tabindex="-1"></a>        nodeRight<span class="op">.</span><span class="at">fb</span> <span class="op">=</span> <span class="fu">f</span>(b_left)<span class="op">;</span></span>
<span id="cb90-2271"><a href="#cb90-2271" aria-hidden="true" tabindex="-1"></a>        node<span class="op">.</span><span class="at">right</span> <span class="op">=</span> nodeRight<span class="op">;</span></span>
<span id="cb90-2272"><a href="#cb90-2272" aria-hidden="true" tabindex="-1"></a>        stack<span class="op">.</span><span class="fu">push</span>(nodeRight)<span class="op">;</span></span>
<span id="cb90-2273"><a href="#cb90-2273" aria-hidden="true" tabindex="-1"></a>        stack<span class="op">.</span><span class="fu">push</span>(nodeLeft)<span class="op">;</span></span>
<span id="cb90-2274"><a href="#cb90-2274" aria-hidden="true" tabindex="-1"></a>      } <span class="cf">else</span> {</span>
<span id="cb90-2275"><a href="#cb90-2275" aria-hidden="true" tabindex="-1"></a>        pts<span class="op">.</span><span class="fu">push</span>(node<span class="op">.</span><span class="at">a</span>)<span class="op">;</span></span>
<span id="cb90-2276"><a href="#cb90-2276" aria-hidden="true" tabindex="-1"></a>      }</span>
<span id="cb90-2277"><a href="#cb90-2277" aria-hidden="true" tabindex="-1"></a>    } <span class="cf">else</span> {</span>
<span id="cb90-2278"><a href="#cb90-2278" aria-hidden="true" tabindex="-1"></a>      pts<span class="op">.</span><span class="fu">push</span>(node<span class="op">.</span><span class="at">a</span>)<span class="op">;</span></span>
<span id="cb90-2279"><a href="#cb90-2279" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb90-2280"><a href="#cb90-2280" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb90-2281"><a href="#cb90-2281" aria-hidden="true" tabindex="-1"></a>  pts<span class="op">.</span><span class="fu">push</span>(b)<span class="op">;</span></span>
<span id="cb90-2282"><a href="#cb90-2282" aria-hidden="true" tabindex="-1"></a>  <span class="co">//  pts = pts.map(x =&gt; ({ x: x, y: f(x) }));</span></span>
<span id="cb90-2283"><a href="#cb90-2283" aria-hidden="true" tabindex="-1"></a>  pts <span class="op">=</span> pts<span class="op">.</span><span class="fu">map</span>((x) <span class="kw">=&gt;</span> [x<span class="op">,</span> <span class="fu">f</span>(x)])<span class="op">;</span></span>
<span id="cb90-2284"><a href="#cb90-2284" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (opts<span class="op">.</span><span class="at">show_roots</span>) {</span>
<span id="cb90-2285"><a href="#cb90-2285" aria-hidden="true" tabindex="-1"></a>    <span class="kw">let</span> function_roots <span class="op">=</span> []<span class="op">;</span></span>
<span id="cb90-2286"><a href="#cb90-2286" aria-hidden="true" tabindex="-1"></a>    pts<span class="op">.</span><span class="fu">forEach</span>(<span class="kw">function</span> (o<span class="op">,</span> i) {</span>
<span id="cb90-2287"><a href="#cb90-2287" aria-hidden="true" tabindex="-1"></a>      <span class="cf">if</span> (i <span class="op">&lt;</span> pts<span class="op">.</span><span class="at">length</span> <span class="op">-</span> <span class="dv">1</span> <span class="op">&amp;&amp;</span> <span class="bu">Math</span><span class="op">.</span><span class="fu">sign</span>(o<span class="op">.</span><span class="at">y</span>) <span class="op">!=</span> <span class="bu">Math</span><span class="op">.</span><span class="fu">sign</span>(pts[i <span class="op">+</span> <span class="dv">1</span>]<span class="op">.</span><span class="at">y</span>)) {</span>
<span id="cb90-2288"><a href="#cb90-2288" aria-hidden="true" tabindex="-1"></a>        function_roots<span class="op">.</span><span class="fu">push</span>((o<span class="op">.</span><span class="at">x</span> <span class="op">+</span> pts[i <span class="op">+</span> <span class="dv">1</span>]<span class="op">.</span><span class="at">x</span>) <span class="op">/</span> <span class="dv">2</span>)<span class="op">;</span></span>
<span id="cb90-2289"><a href="#cb90-2289" aria-hidden="true" tabindex="-1"></a>      }</span>
<span id="cb90-2290"><a href="#cb90-2290" aria-hidden="true" tabindex="-1"></a>    })<span class="op">;</span></span>
<span id="cb90-2291"><a href="#cb90-2291" aria-hidden="true" tabindex="-1"></a>    pts<span class="op">.</span><span class="at">function_roots</span> <span class="op">=</span> function_roots<span class="op">;</span></span>
<span id="cb90-2292"><a href="#cb90-2292" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb90-2293"><a href="#cb90-2293" aria-hidden="true" tabindex="-1"></a>  <span class="cf">return</span> pts<span class="op">;</span></span>
<span id="cb90-2294"><a href="#cb90-2294" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb90-2295"><a href="#cb90-2295" aria-hidden="true" tabindex="-1"></a><span class="kw">function</span> <span class="fu">test</span>(f<span class="op">,</span> I<span class="op">,</span> opts <span class="op">=</span> {}) {</span>
<span id="cb90-2296"><a href="#cb90-2296" aria-hidden="true" tabindex="-1"></a>  <span class="kw">let</span> { angle_tolerance <span class="op">=</span> <span class="fl">0.01</span><span class="op">,</span> check_roots <span class="op">=</span> <span class="kw">false</span> } <span class="op">=</span> opts<span class="op">;</span></span>
<span id="cb90-2297"><a href="#cb90-2297" aria-hidden="true" tabindex="-1"></a>  <span class="kw">let</span> a <span class="op">=</span> I<span class="op">.</span><span class="at">a</span><span class="op">;</span></span>
<span id="cb90-2298"><a href="#cb90-2298" aria-hidden="true" tabindex="-1"></a>  <span class="kw">let</span> b <span class="op">=</span> I<span class="op">.</span><span class="at">b</span><span class="op">;</span></span>
<span id="cb90-2299"><a href="#cb90-2299" aria-hidden="true" tabindex="-1"></a>  <span class="kw">let</span> dx2 <span class="op">=</span> (b <span class="op">-</span> a) <span class="op">/</span> <span class="dv">2</span><span class="op">;</span></span>
<span id="cb90-2300"><a href="#cb90-2300" aria-hidden="true" tabindex="-1"></a>  <span class="kw">let</span> m <span class="op">=</span> (a <span class="op">+</span> b) <span class="op">/</span> <span class="dv">2</span><span class="op">;</span></span>
<span id="cb90-2301"><a href="#cb90-2301" aria-hidden="true" tabindex="-1"></a>  <span class="kw">let</span> fm <span class="op">=</span> <span class="fu">f</span>(m)<span class="op">;</span></span>
<span id="cb90-2302"><a href="#cb90-2302" aria-hidden="true" tabindex="-1"></a>  I<span class="op">.</span><span class="at">midpoint</span> <span class="op">=</span> m<span class="op">;</span></span>
<span id="cb90-2303"><a href="#cb90-2303" aria-hidden="true" tabindex="-1"></a>  I<span class="op">.</span><span class="at">f_mid</span> <span class="op">=</span> fm<span class="op">;</span></span>
<span id="cb90-2304"><a href="#cb90-2304" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (check_roots <span class="op">&amp;&amp;</span> <span class="bu">Math</span><span class="op">.</span><span class="fu">sign</span>(I<span class="op">.</span><span class="at">fa</span>) <span class="op">!=</span> <span class="bu">Math</span><span class="op">.</span><span class="fu">sign</span>(I<span class="op">.</span><span class="at">fb</span>)) {</span>
<span id="cb90-2305"><a href="#cb90-2305" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> <span class="kw">true</span><span class="op">;</span></span>
<span id="cb90-2306"><a href="#cb90-2306" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb90-2307"><a href="#cb90-2307" aria-hidden="true" tabindex="-1"></a>  <span class="kw">let</span> alpha <span class="op">=</span> <span class="bu">Math</span><span class="op">.</span><span class="fu">atan</span>((I<span class="op">.</span><span class="at">f_mid</span> <span class="op">-</span> I<span class="op">.</span><span class="at">fa</span>) <span class="op">/</span> dx2)<span class="op">;</span></span>
<span id="cb90-2308"><a href="#cb90-2308" aria-hidden="true" tabindex="-1"></a>  <span class="kw">let</span> beta <span class="op">=</span> <span class="bu">Math</span><span class="op">.</span><span class="fu">atan</span>((I<span class="op">.</span><span class="at">fb</span> <span class="op">-</span> I<span class="op">.</span><span class="at">f_mid</span>) <span class="op">/</span> dx2)<span class="op">;</span></span>
<span id="cb90-2309"><a href="#cb90-2309" aria-hidden="true" tabindex="-1"></a>  <span class="cf">return</span> <span class="bu">Math</span><span class="op">.</span><span class="fu">abs</span>(alpha <span class="op">-</span> beta) <span class="op">&gt;</span> angle_tolerance<span class="op">;</span></span>
<span id="cb90-2310"><a href="#cb90-2310" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb90-2311"><a href="#cb90-2311" aria-hidden="true" tabindex="-1"></a><span class="kw">class</span> Interval {</span>
<span id="cb90-2312"><a href="#cb90-2312" aria-hidden="true" tabindex="-1"></a>  <span class="fu">constructor</span>(a<span class="op">,</span> b<span class="op">,</span> depth) {</span>
<span id="cb90-2313"><a href="#cb90-2313" aria-hidden="true" tabindex="-1"></a>    <span class="kw">this</span><span class="op">.</span><span class="at">a</span> <span class="op">=</span> a<span class="op">;</span></span>
<span id="cb90-2314"><a href="#cb90-2314" aria-hidden="true" tabindex="-1"></a>    <span class="kw">this</span><span class="op">.</span><span class="at">b</span> <span class="op">=</span> b<span class="op">;</span></span>
<span id="cb90-2315"><a href="#cb90-2315" aria-hidden="true" tabindex="-1"></a>    <span class="kw">this</span><span class="op">.</span><span class="at">depth</span> <span class="op">=</span> depth<span class="op">;</span></span>
<span id="cb90-2316"><a href="#cb90-2316" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb90-2317"><a href="#cb90-2317" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb90-2318"><a href="#cb90-2318" aria-hidden="true" tabindex="-1"></a>colors <span class="op">=</span> ({</span>
<span id="cb90-2319"><a href="#cb90-2319" aria-hidden="true" tabindex="-1"></a>  <span class="dt">night</span><span class="op">:</span> <span class="st">"#719fb6"</span><span class="op">,</span></span>
<span id="cb90-2320"><a href="#cb90-2320" aria-hidden="true" tabindex="-1"></a>  <span class="dt">day</span><span class="op">:</span> <span class="st">"#ffe438"</span><span class="op">,</span></span>
<span id="cb90-2321"><a href="#cb90-2321" aria-hidden="true" tabindex="-1"></a>  <span class="dt">grid</span><span class="op">:</span> <span class="st">"#4b6a79"</span><span class="op">,</span></span>
<span id="cb90-2322"><a href="#cb90-2322" aria-hidden="true" tabindex="-1"></a>  <span class="dt">ocean</span><span class="op">:</span> <span class="st">"lightblue"</span><span class="op">,</span></span>
<span id="cb90-2323"><a href="#cb90-2323" aria-hidden="true" tabindex="-1"></a>  <span class="dt">land</span><span class="op">:</span> <span class="st">"#f5f1dc"</span><span class="op">,</span></span>
<span id="cb90-2324"><a href="#cb90-2324" aria-hidden="true" tabindex="-1"></a>  <span class="dt">sun</span><span class="op">:</span> <span class="st">"#ffe438"</span></span>
<span id="cb90-2325"><a href="#cb90-2325" aria-hidden="true" tabindex="-1"></a>})</span>
<span id="cb90-2326"><a href="#cb90-2326" aria-hidden="true" tabindex="-1"></a><span class="co">// https://observablehq.com/@parlant/editable-table</span></span>
<span id="cb90-2327"><a href="#cb90-2327" aria-hidden="true" tabindex="-1"></a><span class="kw">function</span> <span class="fu">createTable</span>(data<span class="op">,</span> options) {</span>
<span id="cb90-2328"><a href="#cb90-2328" aria-hidden="true" tabindex="-1"></a>  <span class="kw">let</span> table <span class="op">=</span> <span class="fu">html</span><span class="vs">`&lt;table class="editable-table"&gt;&lt;/table&gt;`</span><span class="op">;</span></span>
<span id="cb90-2329"><a href="#cb90-2329" aria-hidden="true" tabindex="-1"></a>  table<span class="op">.</span><span class="at">innerHTML</span> <span class="op">=</span> xss<span class="op">.</span><span class="fu">filterXSS</span>(tableify<span class="op">.</span><span class="fu">default</span>(data))<span class="op">;</span></span>
<span id="cb90-2330"><a href="#cb90-2330" aria-hidden="true" tabindex="-1"></a>  <span class="fu">makeTableEditable</span>(table<span class="op">,</span> options)<span class="op">;</span></span>
<span id="cb90-2331"><a href="#cb90-2331" aria-hidden="true" tabindex="-1"></a>  <span class="cf">return</span> table<span class="op">;</span></span>
<span id="cb90-2332"><a href="#cb90-2332" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb90-2333"><a href="#cb90-2333" aria-hidden="true" tabindex="-1"></a>table<span class="op">.</span><span class="fu">setAttribute</span>(<span class="st">"class"</span><span class="op">,</span> <span class="st">"table"</span>)</span>
<span id="cb90-2334"><a href="#cb90-2334" aria-hidden="true" tabindex="-1"></a>tableify <span class="op">=</span> <span class="im">import</span>(<span class="st">"https://cdn.skypack.dev/tableify@1.1.1?min"</span>)</span>
<span id="cb90-2335"><a href="#cb90-2335" aria-hidden="true" tabindex="-1"></a>xss <span class="op">=</span> <span class="im">import</span>(<span class="st">"https://cdn.skypack.dev/xss@1.0.14?min"</span>)</span>
<span id="cb90-2336"><a href="#cb90-2336" aria-hidden="true" tabindex="-1"></a><span class="kw">function</span> <span class="fu">createCellDiv</span>(value<span class="op">,</span> max) {</span>
<span id="cb90-2337"><a href="#cb90-2337" aria-hidden="true" tabindex="-1"></a>  <span class="cf">return</span> <span class="vs">`&lt;div style="</span></span>
<span id="cb90-2338"><a href="#cb90-2338" aria-hidden="true" tabindex="-1"></a><span class="vs">    width: </span><span class="sc">${</span><span class="bu">Math</span><span class="op">.</span><span class="fu">abs</span>(value) <span class="op">/</span> max<span class="sc">}</span><span class="vs">%;</span></span>
<span id="cb90-2339"><a href="#cb90-2339" aria-hidden="true" tabindex="-1"></a><span class="vs">    float: left;</span></span>
<span id="cb90-2340"><a href="#cb90-2340" aria-hidden="true" tabindex="-1"></a><span class="vs">    padding: 0px 0px 0px 2px;</span></span>
<span id="cb90-2341"><a href="#cb90-2341" aria-hidden="true" tabindex="-1"></a><span class="vs">    text-indent: 2px;</span></span>
<span id="cb90-2342"><a href="#cb90-2342" aria-hidden="true" tabindex="-1"></a><span class="vs">    box-sizing: border-box;</span></span>
<span id="cb90-2343"><a href="#cb90-2343" aria-hidden="true" tabindex="-1"></a><span class="vs">    overflow: visible;</span></span>
<span id="cb90-2344"><a href="#cb90-2344" aria-hidden="true" tabindex="-1"></a><span class="vs">    white-space: nowrap;</span></span>
<span id="cb90-2345"><a href="#cb90-2345" aria-hidden="true" tabindex="-1"></a><span class="vs">    display: flex;</span></span>
<span id="cb90-2346"><a href="#cb90-2346" aria-hidden="true" tabindex="-1"></a><span class="vs">    justify-content: start;"&gt;</span><span class="sc">${</span><span class="bu">Math</span><span class="op">.</span><span class="fu">round</span>(value)<span class="sc">}</span><span class="vs">&lt;/div&gt;`</span></span>
<span id="cb90-2347"><a href="#cb90-2347" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb90-2348"><a href="#cb90-2348" aria-hidden="true" tabindex="-1"></a>liveTable <span class="op">=</span> <span class="fu">observeTable</span>(table)</span>
<span id="cb90-2349"><a href="#cb90-2349" aria-hidden="true" tabindex="-1"></a><span class="kw">function</span> <span class="fu">makeTableEditable</span>(table<span class="op">,</span> options) {</span>
<span id="cb90-2350"><a href="#cb90-2350" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> defaults <span class="op">=</span> {<span class="dt">headerEditable</span><span class="op">:</span> <span class="kw">false</span><span class="op">,</span> <span class="dt">appendRows</span><span class="op">:</span> <span class="kw">true</span>}<span class="op">;</span></span>
<span id="cb90-2351"><a href="#cb90-2351" aria-hidden="true" tabindex="-1"></a>  options <span class="op">=</span> options <span class="op">===</span> <span class="kw">undefined</span> <span class="op">?</span> {} <span class="op">:</span> options<span class="op">;</span></span>
<span id="cb90-2352"><a href="#cb90-2352" aria-hidden="true" tabindex="-1"></a>  <span class="cf">for</span> (<span class="kw">let</span> key <span class="kw">in</span> defaults) {</span>
<span id="cb90-2353"><a href="#cb90-2353" aria-hidden="true" tabindex="-1"></a>    options[key] <span class="op">=</span> options[key] <span class="op">===</span> <span class="kw">undefined</span> <span class="op">?</span> defaults[key] <span class="op">:</span> options[key]<span class="op">;</span></span>
<span id="cb90-2354"><a href="#cb90-2354" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb90-2355"><a href="#cb90-2355" aria-hidden="true" tabindex="-1"></a>  <span class="cf">return</span> Generators<span class="op">.</span><span class="fu">observe</span>((_notify) <span class="kw">=&gt;</span> {</span>
<span id="cb90-2356"><a href="#cb90-2356" aria-hidden="true" tabindex="-1"></a>    <span class="kw">const</span> navigate <span class="op">=</span> (<span class="bu">event</span>) <span class="kw">=&gt;</span> {</span>
<span id="cb90-2357"><a href="#cb90-2357" aria-hidden="true" tabindex="-1"></a>      <span class="kw">const</span> cell <span class="op">=</span> <span class="bu">event</span><span class="op">.</span><span class="at">target</span><span class="op">;</span></span>
<span id="cb90-2358"><a href="#cb90-2358" aria-hidden="true" tabindex="-1"></a>      <span class="kw">const</span> row <span class="op">=</span> cell<span class="op">.</span><span class="fu">closest</span>(<span class="st">'tr'</span>)<span class="op">;</span></span>
<span id="cb90-2359"><a href="#cb90-2359" aria-hidden="true" tabindex="-1"></a>      <span class="kw">const</span> table <span class="op">=</span> row<span class="op">.</span><span class="fu">closest</span>(<span class="st">'table'</span>)<span class="op">;</span></span>
<span id="cb90-2360"><a href="#cb90-2360" aria-hidden="true" tabindex="-1"></a>      <span class="kw">const</span> isBody <span class="op">=</span> row<span class="op">.</span><span class="at">parentNode</span><span class="op">.</span><span class="at">tagName</span> <span class="op">===</span> <span class="st">'TBODY'</span><span class="op">;</span></span>
<span id="cb90-2361"><a href="#cb90-2361" aria-hidden="true" tabindex="-1"></a>      <span class="kw">const</span> isHeader <span class="op">=</span> row<span class="op">.</span><span class="at">parentNode</span><span class="op">.</span><span class="at">tagName</span> <span class="op">===</span> <span class="st">'THEAD'</span><span class="op">;</span></span>
<span id="cb90-2362"><a href="#cb90-2362" aria-hidden="true" tabindex="-1"></a>      <span class="kw">const</span> colIndex <span class="op">=</span> cell<span class="op">.</span><span class="at">cellIndex</span><span class="op">;</span></span>
<span id="cb90-2363"><a href="#cb90-2363" aria-hidden="true" tabindex="-1"></a>      <span class="kw">const</span> colCount <span class="op">=</span> row<span class="op">.</span><span class="at">cells</span><span class="op">.</span><span class="at">length</span><span class="op">;</span></span>
<span id="cb90-2364"><a href="#cb90-2364" aria-hidden="true" tabindex="-1"></a>      <span class="kw">const</span> rowIndex <span class="op">=</span> row<span class="op">.</span><span class="at">rowIndex</span><span class="op">;</span></span>
<span id="cb90-2365"><a href="#cb90-2365" aria-hidden="true" tabindex="-1"></a>      <span class="kw">const</span> rowCount <span class="op">=</span> table<span class="op">.</span><span class="at">rows</span><span class="op">.</span><span class="at">length</span><span class="op">;</span></span>
<span id="cb90-2366"><a href="#cb90-2366" aria-hidden="true" tabindex="-1"></a>      <span class="kw">const</span> headStop <span class="op">=</span> options<span class="op">.</span><span class="at">headerEditable</span> <span class="op">?</span> <span class="dv">0</span> <span class="op">:</span> <span class="dv">1</span><span class="op">;</span></span>
<span id="cb90-2367"><a href="#cb90-2367" aria-hidden="true" tabindex="-1"></a>      <span class="kw">let</span> direction <span class="op">=</span> <span class="kw">null</span><span class="op">;</span></span>
<span id="cb90-2368"><a href="#cb90-2368" aria-hidden="true" tabindex="-1"></a>      <span class="kw">let</span> x <span class="op">=</span> colIndex<span class="op">;</span></span>
<span id="cb90-2369"><a href="#cb90-2369" aria-hidden="true" tabindex="-1"></a>      <span class="kw">let</span> y <span class="op">=</span> rowIndex<span class="op">;</span></span>
<span id="cb90-2370"><a href="#cb90-2370" aria-hidden="true" tabindex="-1"></a>      <span class="cf">if</span> (<span class="op">!</span>[</span>
<span id="cb90-2371"><a href="#cb90-2371" aria-hidden="true" tabindex="-1"></a>      <span class="co">// https://www.freecodecamp.org/news/javascript-keycode-list-keypress-event-key-codes#heading-a-full-list-of-key-event-values</span></span>
<span id="cb90-2372"><a href="#cb90-2372" aria-hidden="true" tabindex="-1"></a>        <span class="dv">8</span><span class="op">,</span> <span class="dv">9</span><span class="op">,</span> <span class="dv">13</span><span class="op">,</span> <span class="dv">16</span><span class="op">,</span> <span class="dv">17</span><span class="op">,</span> <span class="dv">18</span><span class="op">,</span> <span class="dv">27</span><span class="op">,</span> <span class="dv">33</span><span class="op">,</span> <span class="dv">34</span><span class="op">,</span> <span class="dv">35</span><span class="op">,</span> <span class="dv">36</span><span class="op">,</span> <span class="dv">37</span><span class="op">,</span> <span class="dv">38</span><span class="op">,</span> <span class="dv">39</span><span class="op">,</span> <span class="dv">40</span><span class="op">,</span> <span class="dv">46</span><span class="op">,</span> <span class="dv">48</span><span class="op">,</span> <span class="dv">49</span><span class="op">,</span> <span class="dv">50</span><span class="op">,</span> <span class="dv">51</span><span class="op">,</span> <span class="dv">52</span><span class="op">,</span> <span class="dv">53</span><span class="op">,</span> <span class="dv">54</span><span class="op">,</span> <span class="dv">55</span><span class="op">,</span> <span class="dv">56</span><span class="op">,</span> <span class="dv">57</span><span class="op">,</span> <span class="dv">109</span><span class="op">,</span> <span class="dv">189</span></span>
<span id="cb90-2373"><a href="#cb90-2373" aria-hidden="true" tabindex="-1"></a>      ]<span class="op">.</span><span class="fu">includes</span>(<span class="bu">event</span><span class="op">.</span><span class="at">which</span>)) {</span>
<span id="cb90-2374"><a href="#cb90-2374" aria-hidden="true" tabindex="-1"></a>        <span class="bu">event</span><span class="op">.</span><span class="fu">preventDefault</span>()<span class="op">;</span></span>
<span id="cb90-2375"><a href="#cb90-2375" aria-hidden="true" tabindex="-1"></a>      }</span>
<span id="cb90-2376"><a href="#cb90-2376" aria-hidden="true" tabindex="-1"></a>      <span class="cf">else</span> {</span>
<span id="cb90-2377"><a href="#cb90-2377" aria-hidden="true" tabindex="-1"></a>      <span class="cf">switch</span>(<span class="bu">event</span><span class="op">.</span><span class="at">code</span>) {</span>
<span id="cb90-2378"><a href="#cb90-2378" aria-hidden="true" tabindex="-1"></a>        <span class="co">// Tab cycles through the table, adding new rows as needed.</span></span>
<span id="cb90-2379"><a href="#cb90-2379" aria-hidden="true" tabindex="-1"></a>        <span class="cf">case</span> <span class="st">'Tab'</span><span class="op">:</span></span>
<span id="cb90-2380"><a href="#cb90-2380" aria-hidden="true" tabindex="-1"></a>          <span class="bu">event</span><span class="op">.</span><span class="fu">preventDefault</span>()<span class="op">;</span></span>
<span id="cb90-2381"><a href="#cb90-2381" aria-hidden="true" tabindex="-1"></a>          <span class="cf">if</span> (<span class="bu">event</span><span class="op">.</span><span class="at">altKey</span> <span class="op">||</span> <span class="bu">event</span><span class="op">.</span><span class="at">shiftKey</span>) {</span>
<span id="cb90-2382"><a href="#cb90-2382" aria-hidden="true" tabindex="-1"></a>            direction <span class="op">=</span> <span class="op">-</span><span class="dv">1</span><span class="op">;</span></span>
<span id="cb90-2383"><a href="#cb90-2383" aria-hidden="true" tabindex="-1"></a>            <span class="cf">if</span> (x <span class="op">-</span> <span class="dv">1</span> <span class="op">&lt;</span> <span class="dv">0</span>) {</span>
<span id="cb90-2384"><a href="#cb90-2384" aria-hidden="true" tabindex="-1"></a>              <span class="cf">if</span> (y <span class="op">-</span> <span class="dv">1</span> <span class="op">&lt;</span> headStop) <span class="cf">break</span><span class="op">;</span></span>
<span id="cb90-2385"><a href="#cb90-2385" aria-hidden="true" tabindex="-1"></a>              x <span class="op">=</span> colCount <span class="op">-</span> <span class="dv">1</span><span class="op">;</span></span>
<span id="cb90-2386"><a href="#cb90-2386" aria-hidden="true" tabindex="-1"></a>              y <span class="op">=</span> y <span class="op">-</span> <span class="dv">1</span><span class="op">;</span></span>
<span id="cb90-2387"><a href="#cb90-2387" aria-hidden="true" tabindex="-1"></a>            } <span class="cf">else</span> {</span>
<span id="cb90-2388"><a href="#cb90-2388" aria-hidden="true" tabindex="-1"></a>              x <span class="op">=</span> x <span class="op">-</span> <span class="dv">1</span><span class="op">;</span></span>
<span id="cb90-2389"><a href="#cb90-2389" aria-hidden="true" tabindex="-1"></a>            }</span>
<span id="cb90-2390"><a href="#cb90-2390" aria-hidden="true" tabindex="-1"></a>          } <span class="cf">else</span> {</span>
<span id="cb90-2391"><a href="#cb90-2391" aria-hidden="true" tabindex="-1"></a>            direction <span class="op">=</span> <span class="dv">1</span><span class="op">;</span></span>
<span id="cb90-2392"><a href="#cb90-2392" aria-hidden="true" tabindex="-1"></a>            <span class="cf">if</span> (x <span class="op">+</span> <span class="dv">1</span> <span class="op">===</span> colCount) {</span>
<span id="cb90-2393"><a href="#cb90-2393" aria-hidden="true" tabindex="-1"></a>              x <span class="op">=</span> <span class="dv">0</span><span class="op">;</span></span>
<span id="cb90-2394"><a href="#cb90-2394" aria-hidden="true" tabindex="-1"></a>              y <span class="op">=</span> y <span class="op">+</span> <span class="dv">1</span><span class="op">;</span></span>
<span id="cb90-2395"><a href="#cb90-2395" aria-hidden="true" tabindex="-1"></a>            } <span class="cf">else</span> {</span>
<span id="cb90-2396"><a href="#cb90-2396" aria-hidden="true" tabindex="-1"></a>              x <span class="op">=</span> x <span class="op">+</span> <span class="dv">1</span><span class="op">;</span></span>
<span id="cb90-2397"><a href="#cb90-2397" aria-hidden="true" tabindex="-1"></a>            }</span>
<span id="cb90-2398"><a href="#cb90-2398" aria-hidden="true" tabindex="-1"></a>          }</span>
<span id="cb90-2399"><a href="#cb90-2399" aria-hidden="true" tabindex="-1"></a>          <span class="cf">break</span><span class="op">;</span></span>
<span id="cb90-2400"><a href="#cb90-2400" aria-hidden="true" tabindex="-1"></a>        <span class="co">// Plain Enter navigates downwards.</span></span>
<span id="cb90-2401"><a href="#cb90-2401" aria-hidden="true" tabindex="-1"></a>        <span class="co">// Shift + Enter or Alt + Enter goes up to the cell above.</span></span>
<span id="cb90-2402"><a href="#cb90-2402" aria-hidden="true" tabindex="-1"></a>        <span class="cf">case</span> <span class="st">'Enter'</span><span class="op">:</span></span>
<span id="cb90-2403"><a href="#cb90-2403" aria-hidden="true" tabindex="-1"></a>          <span class="bu">event</span><span class="op">.</span><span class="fu">preventDefault</span>()<span class="op">;</span></span>
<span id="cb90-2404"><a href="#cb90-2404" aria-hidden="true" tabindex="-1"></a>          <span class="cf">if</span> (<span class="bu">event</span><span class="op">.</span><span class="at">altKey</span> <span class="op">||</span> <span class="bu">event</span><span class="op">.</span><span class="at">shiftKey</span>) {</span>
<span id="cb90-2405"><a href="#cb90-2405" aria-hidden="true" tabindex="-1"></a>            direction <span class="op">=</span> <span class="op">-</span><span class="dv">1</span><span class="op">;</span></span>
<span id="cb90-2406"><a href="#cb90-2406" aria-hidden="true" tabindex="-1"></a>            x <span class="op">=</span> x<span class="op">;</span></span>
<span id="cb90-2407"><a href="#cb90-2407" aria-hidden="true" tabindex="-1"></a>            y <span class="op">=</span> y <span class="op">-</span> <span class="dv">1</span><span class="op">;</span></span>
<span id="cb90-2408"><a href="#cb90-2408" aria-hidden="true" tabindex="-1"></a>          }</span>
<span id="cb90-2409"><a href="#cb90-2409" aria-hidden="true" tabindex="-1"></a>          <span class="cf">else</span> {</span>
<span id="cb90-2410"><a href="#cb90-2410" aria-hidden="true" tabindex="-1"></a>            direction <span class="op">=</span> <span class="dv">1</span><span class="op">;</span></span>
<span id="cb90-2411"><a href="#cb90-2411" aria-hidden="true" tabindex="-1"></a>            x <span class="op">=</span> x<span class="op">;</span></span>
<span id="cb90-2412"><a href="#cb90-2412" aria-hidden="true" tabindex="-1"></a>            y <span class="op">=</span> y <span class="op">+</span> <span class="dv">1</span><span class="op">;</span></span>
<span id="cb90-2413"><a href="#cb90-2413" aria-hidden="true" tabindex="-1"></a>          }</span>
<span id="cb90-2414"><a href="#cb90-2414" aria-hidden="true" tabindex="-1"></a>          <span class="cf">break</span><span class="op">;</span></span>
<span id="cb90-2415"><a href="#cb90-2415" aria-hidden="true" tabindex="-1"></a>        <span class="co">// The arrow keys allow you to navigate through cells.</span></span>
<span id="cb90-2416"><a href="#cb90-2416" aria-hidden="true" tabindex="-1"></a>        <span class="co">// No new rows are added.</span></span>
<span id="cb90-2417"><a href="#cb90-2417" aria-hidden="true" tabindex="-1"></a>        <span class="cf">case</span> <span class="st">'ArrowUp'</span><span class="op">:</span></span>
<span id="cb90-2418"><a href="#cb90-2418" aria-hidden="true" tabindex="-1"></a>        <span class="cf">case</span> <span class="st">'ArrowDown'</span><span class="op">:</span></span>
<span id="cb90-2419"><a href="#cb90-2419" aria-hidden="true" tabindex="-1"></a>        <span class="cf">case</span> <span class="st">'ArrowLeft'</span><span class="op">:</span></span>
<span id="cb90-2420"><a href="#cb90-2420" aria-hidden="true" tabindex="-1"></a>        <span class="cf">case</span> <span class="st">'ArrowRight'</span><span class="op">:</span></span>
<span id="cb90-2421"><a href="#cb90-2421" aria-hidden="true" tabindex="-1"></a>        <span class="cf">case</span> <span class="st">'Enter'</span><span class="op">:</span></span>
<span id="cb90-2422"><a href="#cb90-2422" aria-hidden="true" tabindex="-1"></a>          <span class="cf">if</span> (<span class="op">!</span><span class="bu">event</span><span class="op">.</span><span class="at">altKey</span>) <span class="cf">break</span><span class="op">;</span></span>
<span id="cb90-2423"><a href="#cb90-2423" aria-hidden="true" tabindex="-1"></a>          <span class="bu">event</span><span class="op">.</span><span class="fu">preventDefault</span>()<span class="op">;</span></span>
<span id="cb90-2424"><a href="#cb90-2424" aria-hidden="true" tabindex="-1"></a>          <span class="cf">switch</span>(<span class="bu">event</span><span class="op">.</span><span class="at">code</span>) {</span>
<span id="cb90-2425"><a href="#cb90-2425" aria-hidden="true" tabindex="-1"></a>            <span class="cf">case</span> <span class="st">'ArrowUp'</span><span class="op">:</span></span>
<span id="cb90-2426"><a href="#cb90-2426" aria-hidden="true" tabindex="-1"></a>              direction <span class="op">=</span> <span class="op">-</span><span class="dv">1</span><span class="op">;</span></span>
<span id="cb90-2427"><a href="#cb90-2427" aria-hidden="true" tabindex="-1"></a>              y <span class="op">=</span> <span class="bu">Math</span><span class="op">.</span><span class="fu">max</span>(y <span class="op">-</span> <span class="dv">1</span><span class="op">,</span> headStop)<span class="op">;</span></span>
<span id="cb90-2428"><a href="#cb90-2428" aria-hidden="true" tabindex="-1"></a>              <span class="cf">break</span><span class="op">;</span></span>
<span id="cb90-2429"><a href="#cb90-2429" aria-hidden="true" tabindex="-1"></a>            <span class="cf">case</span> <span class="st">'ArrowDown'</span><span class="op">:</span></span>
<span id="cb90-2430"><a href="#cb90-2430" aria-hidden="true" tabindex="-1"></a>              direction <span class="op">=</span> <span class="dv">1</span><span class="op">;</span></span>
<span id="cb90-2431"><a href="#cb90-2431" aria-hidden="true" tabindex="-1"></a>              y <span class="op">=</span> <span class="bu">Math</span><span class="op">.</span><span class="fu">min</span>(y <span class="op">+</span> <span class="dv">1</span><span class="op">,</span> rowCount <span class="op">-</span> <span class="dv">1</span>)<span class="op">;</span></span>
<span id="cb90-2432"><a href="#cb90-2432" aria-hidden="true" tabindex="-1"></a>              <span class="cf">break</span><span class="op">;</span></span>
<span id="cb90-2433"><a href="#cb90-2433" aria-hidden="true" tabindex="-1"></a>            <span class="cf">case</span> <span class="st">'ArrowLeft'</span><span class="op">:</span></span>
<span id="cb90-2434"><a href="#cb90-2434" aria-hidden="true" tabindex="-1"></a>              direction <span class="op">=</span> <span class="op">-</span><span class="dv">1</span><span class="op">;</span></span>
<span id="cb90-2435"><a href="#cb90-2435" aria-hidden="true" tabindex="-1"></a>              x <span class="op">=</span> <span class="bu">Math</span><span class="op">.</span><span class="fu">max</span>(x <span class="op">-</span> <span class="dv">1</span><span class="op">,</span> <span class="dv">0</span>)<span class="op">;</span></span>
<span id="cb90-2436"><a href="#cb90-2436" aria-hidden="true" tabindex="-1"></a>              <span class="cf">break</span><span class="op">;</span></span>
<span id="cb90-2437"><a href="#cb90-2437" aria-hidden="true" tabindex="-1"></a>            <span class="cf">case</span> <span class="st">'ArrowRight'</span><span class="op">:</span></span>
<span id="cb90-2438"><a href="#cb90-2438" aria-hidden="true" tabindex="-1"></a>              direction <span class="op">=</span> <span class="dv">1</span><span class="op">;</span></span>
<span id="cb90-2439"><a href="#cb90-2439" aria-hidden="true" tabindex="-1"></a>              x <span class="op">=</span> <span class="bu">Math</span><span class="op">.</span><span class="fu">min</span>(x <span class="op">+</span> <span class="dv">1</span><span class="op">,</span> colCount <span class="op">-</span> <span class="dv">1</span>)<span class="op">;</span></span>
<span id="cb90-2440"><a href="#cb90-2440" aria-hidden="true" tabindex="-1"></a>              <span class="cf">break</span><span class="op">;</span></span>
<span id="cb90-2441"><a href="#cb90-2441" aria-hidden="true" tabindex="-1"></a>          }</span>
<span id="cb90-2442"><a href="#cb90-2442" aria-hidden="true" tabindex="-1"></a>          <span class="cf">break</span><span class="op">;</span></span>
<span id="cb90-2443"><a href="#cb90-2443" aria-hidden="true" tabindex="-1"></a>      }</span>
<span id="cb90-2444"><a href="#cb90-2444" aria-hidden="true" tabindex="-1"></a>      <span class="cf">if</span> (direction <span class="op">!==</span> <span class="kw">null</span>) {</span>
<span id="cb90-2445"><a href="#cb90-2445" aria-hidden="true" tabindex="-1"></a>        <span class="kw">let</span> nextRow<span class="op">;</span></span>
<span id="cb90-2446"><a href="#cb90-2446" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> (y <span class="op">===</span> rowCount) {</span>
<span id="cb90-2447"><a href="#cb90-2447" aria-hidden="true" tabindex="-1"></a>          nextRow <span class="op">=</span> options<span class="op">.</span><span class="at">appendRows</span> <span class="op">?</span> <span class="fu">addRowRelativeTo</span>(row<span class="op">,</span> direction) <span class="op">:</span> row<span class="op">;</span></span>
<span id="cb90-2448"><a href="#cb90-2448" aria-hidden="true" tabindex="-1"></a>        } <span class="cf">else</span> {</span>
<span id="cb90-2449"><a href="#cb90-2449" aria-hidden="true" tabindex="-1"></a>          nextRow <span class="op">=</span> table<span class="op">.</span><span class="at">rows</span>[y]<span class="op">;</span></span>
<span id="cb90-2450"><a href="#cb90-2450" aria-hidden="true" tabindex="-1"></a>        }</span>
<span id="cb90-2451"><a href="#cb90-2451" aria-hidden="true" tabindex="-1"></a>        <span class="kw">let</span> nextCell <span class="op">=</span> nextRow<span class="op">.</span><span class="at">cells</span>[x]<span class="op">;</span></span>
<span id="cb90-2452"><a href="#cb90-2452" aria-hidden="true" tabindex="-1"></a>        <span class="fu">focusCell</span>(nextCell)<span class="op">;</span></span>
<span id="cb90-2453"><a href="#cb90-2453" aria-hidden="true" tabindex="-1"></a>      }</span>
<span id="cb90-2454"><a href="#cb90-2454" aria-hidden="true" tabindex="-1"></a>    }<span class="op">;</span></span>
<span id="cb90-2455"><a href="#cb90-2455" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb90-2456"><a href="#cb90-2456" aria-hidden="true" tabindex="-1"></a>    table<span class="op">.</span><span class="fu">addEventListener</span>(<span class="st">"keydown"</span><span class="op">,</span> navigate<span class="op">,</span> <span class="kw">false</span>)<span class="op">;</span></span>
<span id="cb90-2457"><a href="#cb90-2457" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> (table<span class="op">.</span><span class="at">rows</span><span class="op">.</span><span class="at">length</span> <span class="op">&gt;</span> <span class="dv">0</span>) {</span>
<span id="cb90-2458"><a href="#cb90-2458" aria-hidden="true" tabindex="-1"></a>      <span class="cf">for</span> (<span class="kw">let</span> row <span class="kw">of</span> table<span class="op">.</span><span class="at">rows</span>) {</span>
<span id="cb90-2459"><a href="#cb90-2459" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> (<span class="op">!</span>options<span class="op">.</span><span class="at">headerEditable</span> <span class="op">&amp;&amp;</span> row<span class="op">.</span><span class="at">rowIndex</span> <span class="op">===</span> <span class="dv">0</span>) <span class="cf">continue</span><span class="op">;</span></span>
<span id="cb90-2460"><a href="#cb90-2460" aria-hidden="true" tabindex="-1"></a>        <span class="cf">for</span> (<span class="kw">let</span> cell <span class="kw">of</span> row<span class="op">.</span><span class="at">cells</span>) {</span>
<span id="cb90-2461"><a href="#cb90-2461" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> (cell<span class="op">.</span><span class="at">cellIndex</span> <span class="op">===</span> <span class="dv">0</span>) <span class="cf">continue</span><span class="op">;</span></span>
<span id="cb90-2462"><a href="#cb90-2462" aria-hidden="true" tabindex="-1"></a>          <span class="kw">let</span> cellValue <span class="op">=</span> cell<span class="op">.</span><span class="at">innerText</span></span>
<span id="cb90-2463"><a href="#cb90-2463" aria-hidden="true" tabindex="-1"></a>          cell<span class="op">.</span><span class="at">innerHTML</span> <span class="op">=</span> <span class="vs">`&lt;div style="</span></span>
<span id="cb90-2464"><a href="#cb90-2464" aria-hidden="true" tabindex="-1"></a><span class="vs">            width: </span><span class="sc">${</span><span class="bu">Math</span><span class="op">.</span><span class="fu">abs</span>(cellValue) <span class="op">/</span> (cell<span class="op">.</span><span class="at">cellIndex</span> <span class="op">===</span> <span class="dv">2</span> <span class="op">?</span> <span class="fl">2.5</span> <span class="op">:</span> <span class="dv">10</span>)<span class="sc">}</span><span class="vs">%;</span></span>
<span id="cb90-2465"><a href="#cb90-2465" aria-hidden="true" tabindex="-1"></a><span class="vs">            float: left;</span></span>
<span id="cb90-2466"><a href="#cb90-2466" aria-hidden="true" tabindex="-1"></a><span class="vs">            padding: 0px 0px 0px 2px;</span></span>
<span id="cb90-2467"><a href="#cb90-2467" aria-hidden="true" tabindex="-1"></a><span class="vs">            text-indent: 2px;</span></span>
<span id="cb90-2468"><a href="#cb90-2468" aria-hidden="true" tabindex="-1"></a><span class="vs">            box-sizing: border-box;</span></span>
<span id="cb90-2469"><a href="#cb90-2469" aria-hidden="true" tabindex="-1"></a><span class="vs">            overflow: visible;</span></span>
<span id="cb90-2470"><a href="#cb90-2470" aria-hidden="true" tabindex="-1"></a><span class="vs">            white-space: nowrap;</span></span>
<span id="cb90-2471"><a href="#cb90-2471" aria-hidden="true" tabindex="-1"></a><span class="vs">            display: flex;</span></span>
<span id="cb90-2472"><a href="#cb90-2472" aria-hidden="true" tabindex="-1"></a><span class="vs">            justify-content: start;"&gt;</span><span class="sc">${</span>cellValue<span class="sc">}</span><span class="vs">&lt;/div&gt;`</span></span>
<span id="cb90-2473"><a href="#cb90-2473" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> (cell<span class="op">.</span><span class="at">cellIndex</span> <span class="op">===</span> <span class="dv">3</span>) <span class="cf">continue</span><span class="op">;</span></span>
<span id="cb90-2474"><a href="#cb90-2474" aria-hidden="true" tabindex="-1"></a>          cell<span class="op">.</span><span class="at">contentEditable</span> <span class="op">=</span> <span class="kw">true</span><span class="op">;</span></span>
<span id="cb90-2475"><a href="#cb90-2475" aria-hidden="true" tabindex="-1"></a>        }</span>
<span id="cb90-2476"><a href="#cb90-2476" aria-hidden="true" tabindex="-1"></a>      }</span>
<span id="cb90-2477"><a href="#cb90-2477" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb90-2478"><a href="#cb90-2478" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> () <span class="kw">=&gt;</span> table<span class="op">.</span><span class="fu">removeEventListener</span>(<span class="st">"keydown"</span><span class="op">,</span> navigate)<span class="op">;</span></span>
<span id="cb90-2479"><a href="#cb90-2479" aria-hidden="true" tabindex="-1"></a>  })<span class="op">;</span></span>
<span id="cb90-2480"><a href="#cb90-2480" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb90-2481"><a href="#cb90-2481" aria-hidden="true" tabindex="-1"></a><span class="kw">function</span> <span class="fu">observeTable</span>(table) {</span>
<span id="cb90-2482"><a href="#cb90-2482" aria-hidden="true" tabindex="-1"></a>  <span class="cf">return</span> Generators<span class="op">.</span><span class="fu">observe</span>((notify) <span class="kw">=&gt;</span> {</span>
<span id="cb90-2483"><a href="#cb90-2483" aria-hidden="true" tabindex="-1"></a>    <span class="kw">const</span> keyinput <span class="op">=</span> (<span class="bu">event</span>) <span class="kw">=&gt;</span> <span class="fu">notify</span>(<span class="fu">parseTableData</span>(table))<span class="op">;</span></span>
<span id="cb90-2484"><a href="#cb90-2484" aria-hidden="true" tabindex="-1"></a>    table<span class="op">.</span><span class="fu">addEventListener</span>(<span class="st">"input"</span><span class="op">,</span> keyinput<span class="op">,</span> <span class="kw">false</span>)<span class="op">;</span></span>
<span id="cb90-2485"><a href="#cb90-2485" aria-hidden="true" tabindex="-1"></a>    <span class="fu">notify</span>(<span class="fu">parseTableData</span>(table))<span class="op">;</span></span>
<span id="cb90-2486"><a href="#cb90-2486" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> () <span class="kw">=&gt;</span> <span class="bu">window</span><span class="op">.</span><span class="fu">removeEventListener</span>(<span class="st">"input"</span><span class="op">,</span> keyinput)<span class="op">;</span></span>
<span id="cb90-2487"><a href="#cb90-2487" aria-hidden="true" tabindex="-1"></a>  })<span class="op">;</span></span>
<span id="cb90-2488"><a href="#cb90-2488" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb90-2489"><a href="#cb90-2489" aria-hidden="true" tabindex="-1"></a><span class="kw">function</span> <span class="fu">parseTableData</span>(table) {</span>
<span id="cb90-2490"><a href="#cb90-2490" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> header <span class="op">=</span> []<span class="op">;</span></span>
<span id="cb90-2491"><a href="#cb90-2491" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> data <span class="op">=</span> []<span class="op">;</span></span>
<span id="cb90-2492"><a href="#cb90-2492" aria-hidden="true" tabindex="-1"></a>  <span class="cf">for</span> (<span class="kw">let</span> row <span class="kw">of</span> table<span class="op">.</span><span class="at">rows</span>) {</span>
<span id="cb90-2493"><a href="#cb90-2493" aria-hidden="true" tabindex="-1"></a>    <span class="kw">const</span> rowIndex <span class="op">=</span> row<span class="op">.</span><span class="at">rowIndex</span><span class="op">;</span></span>
<span id="cb90-2494"><a href="#cb90-2494" aria-hidden="true" tabindex="-1"></a>    <span class="kw">const</span> isHeader <span class="op">=</span> row<span class="op">.</span><span class="at">parentNode</span><span class="op">.</span><span class="at">tagName</span> <span class="op">===</span> <span class="st">'THEAD'</span> <span class="op">&amp;&amp;</span> rowIndex <span class="op">===</span> <span class="dv">0</span><span class="op">;</span></span>
<span id="cb90-2495"><a href="#cb90-2495" aria-hidden="true" tabindex="-1"></a>    <span class="kw">let</span> obj <span class="op">=</span> {}<span class="op">;</span></span>
<span id="cb90-2496"><a href="#cb90-2496" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> (<span class="kw">let</span> cell <span class="kw">of</span> row<span class="op">.</span><span class="at">cells</span>) {</span>
<span id="cb90-2497"><a href="#cb90-2497" aria-hidden="true" tabindex="-1"></a>      <span class="kw">const</span> head <span class="op">=</span> header[cell<span class="op">.</span><span class="at">cellIndex</span>]<span class="op">;</span></span>
<span id="cb90-2498"><a href="#cb90-2498" aria-hidden="true" tabindex="-1"></a>      <span class="cf">if</span> (isHeader) {</span>
<span id="cb90-2499"><a href="#cb90-2499" aria-hidden="true" tabindex="-1"></a>        header<span class="op">.</span><span class="fu">push</span>(cell<span class="op">.</span><span class="at">innerText</span>)<span class="op">;</span></span>
<span id="cb90-2500"><a href="#cb90-2500" aria-hidden="true" tabindex="-1"></a>      } <span class="cf">else</span> {</span>
<span id="cb90-2501"><a href="#cb90-2501" aria-hidden="true" tabindex="-1"></a>        obj[head] <span class="op">=</span> cell<span class="op">.</span><span class="at">innerText</span><span class="op">;</span></span>
<span id="cb90-2502"><a href="#cb90-2502" aria-hidden="true" tabindex="-1"></a>      }</span>
<span id="cb90-2503"><a href="#cb90-2503" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb90-2504"><a href="#cb90-2504" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> (<span class="op">!</span>isHeader) data<span class="op">.</span><span class="fu">push</span>(obj)<span class="op">;</span></span>
<span id="cb90-2505"><a href="#cb90-2505" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb90-2506"><a href="#cb90-2506" aria-hidden="true" tabindex="-1"></a>  <span class="cf">return</span> <span class="bu">JSON</span><span class="op">.</span><span class="fu">parse</span>(<span class="bu">JSON</span><span class="op">.</span><span class="fu">stringify</span>(data))<span class="op">;</span></span>
<span id="cb90-2507"><a href="#cb90-2507" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb90-2508"><a href="#cb90-2508" aria-hidden="true" tabindex="-1"></a><span class="kw">function</span> <span class="fu">focusCell</span>(td) {</span>
<span id="cb90-2509"><a href="#cb90-2509" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> s <span class="op">=</span> <span class="bu">window</span><span class="op">.</span><span class="fu">getSelection</span>()<span class="op">;</span></span>
<span id="cb90-2510"><a href="#cb90-2510" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> r <span class="op">=</span> <span class="bu">document</span><span class="op">.</span><span class="fu">createRange</span>()<span class="op">;</span></span>
<span id="cb90-2511"><a href="#cb90-2511" aria-hidden="true" tabindex="-1"></a>  <span class="kw">let</span> textNode <span class="op">=</span> td<span class="op">.</span><span class="at">childNodes</span>[<span class="dv">0</span>]<span class="op">;</span></span>
<span id="cb90-2512"><a href="#cb90-2512" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> i <span class="op">=</span> td<span class="op">.</span><span class="at">innerText</span><span class="op">.</span><span class="at">length</span><span class="op">;</span></span>
<span id="cb90-2513"><a href="#cb90-2513" aria-hidden="true" tabindex="-1"></a>  td<span class="op">.</span><span class="fu">focus</span>()<span class="op">;</span></span>
<span id="cb90-2514"><a href="#cb90-2514" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (textNode) {</span>
<span id="cb90-2515"><a href="#cb90-2515" aria-hidden="true" tabindex="-1"></a>    r<span class="op">.</span><span class="fu">setStart</span>(textNode<span class="op">,</span> i)<span class="op">;</span></span>
<span id="cb90-2516"><a href="#cb90-2516" aria-hidden="true" tabindex="-1"></a>    r<span class="op">.</span><span class="fu">setEnd</span>(textNode<span class="op">,</span> i)<span class="op">;</span></span>
<span id="cb90-2517"><a href="#cb90-2517" aria-hidden="true" tabindex="-1"></a>  } <span class="cf">else</span> {</span>
<span id="cb90-2518"><a href="#cb90-2518" aria-hidden="true" tabindex="-1"></a>    r<span class="op">.</span><span class="fu">selectNode</span>(td)<span class="op">;</span></span>
<span id="cb90-2519"><a href="#cb90-2519" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb90-2520"><a href="#cb90-2520" aria-hidden="true" tabindex="-1"></a>  s<span class="op">.</span><span class="fu">removeAllRanges</span>()<span class="op">;</span></span>
<span id="cb90-2521"><a href="#cb90-2521" aria-hidden="true" tabindex="-1"></a>  s<span class="op">.</span><span class="fu">addRange</span>(r)<span class="op">;</span></span>
<span id="cb90-2522"><a href="#cb90-2522" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb90-2523"><a href="#cb90-2523" aria-hidden="true" tabindex="-1"></a><span class="kw">function</span> <span class="fu">addRowRelativeTo</span>(tr<span class="op">,</span> direction) {</span>
<span id="cb90-2524"><a href="#cb90-2524" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> newTr <span class="op">=</span> <span class="bu">document</span><span class="op">.</span><span class="fu">createElement</span>(<span class="st">'tr'</span>)<span class="op">;</span></span>
<span id="cb90-2525"><a href="#cb90-2525" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> insertPosition <span class="op">=</span> direction <span class="op">==</span> <span class="dv">1</span> <span class="op">?</span> <span class="st">'afterend'</span> <span class="op">:</span> <span class="st">'beforebegin'</span><span class="op">;</span></span>
<span id="cb90-2526"><a href="#cb90-2526" aria-hidden="true" tabindex="-1"></a>  tr<span class="op">.</span><span class="fu">insertAdjacentElement</span>(insertPosition<span class="op">,</span> newTr)<span class="op">;</span></span>
<span id="cb90-2527"><a href="#cb90-2527" aria-hidden="true" tabindex="-1"></a>  <span class="cf">for</span> (<span class="kw">let</span> _td <span class="kw">of</span> <span class="bu">Array</span><span class="op">.</span><span class="fu">from</span>(tr<span class="op">.</span><span class="at">children</span>)) {</span>
<span id="cb90-2528"><a href="#cb90-2528" aria-hidden="true" tabindex="-1"></a>    <span class="kw">const</span> newTd <span class="op">=</span> <span class="bu">document</span><span class="op">.</span><span class="fu">createElement</span>(<span class="st">'td'</span>)<span class="op">;</span></span>
<span id="cb90-2529"><a href="#cb90-2529" aria-hidden="true" tabindex="-1"></a>    newTd<span class="op">.</span><span class="fu">appendChild</span>(<span class="bu">document</span><span class="op">.</span><span class="fu">createTextNode</span>(<span class="st">''</span>))<span class="op">;</span></span>
<span id="cb90-2530"><a href="#cb90-2530" aria-hidden="true" tabindex="-1"></a>    newTd<span class="op">.</span><span class="at">contentEditable</span> <span class="op">=</span> <span class="kw">true</span><span class="op">;</span></span>
<span id="cb90-2531"><a href="#cb90-2531" aria-hidden="true" tabindex="-1"></a>    newTr<span class="op">.</span><span class="fu">appendChild</span>(newTd)<span class="op">;</span></span>
<span id="cb90-2532"><a href="#cb90-2532" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb90-2533"><a href="#cb90-2533" aria-hidden="true" tabindex="-1"></a>  <span class="cf">return</span> newTr<span class="op">;</span></span>
<span id="cb90-2534"><a href="#cb90-2534" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb90-2535"><a href="#cb90-2535" aria-hidden="true" tabindex="-1"></a><span class="co">// https://observablehq.com/@observablehq/text-color-annotations-in-markdown</span></span>
<span id="cb90-2536"><a href="#cb90-2536" aria-hidden="true" tabindex="-1"></a>rstbtn <span class="op">=</span> d3<span class="op">.</span><span class="fu">create</span>(<span class="st">'button'</span>)<span class="op">.</span><span class="fu">html</span>(<span class="st">'Reset'</span>)<span class="op">.</span><span class="fu">attr</span>(<span class="st">"id"</span><span class="op">,</span> <span class="st">"rstbtn"</span>)<span class="op">.</span><span class="fu">attr</span>(<span class="st">"class"</span><span class="op">,</span> <span class="st">"btn btn-quarto"</span>)<span class="op">;</span></span>
<span id="cb90-2537"><a href="#cb90-2537" aria-hidden="true" tabindex="-1"></a><span class="co">// https://observablehq.com/@recifs/add-a-class-to-an-observable-input--support</span></span>
<span id="cb90-2538"><a href="#cb90-2538" aria-hidden="true" tabindex="-1"></a><span class="kw">function</span> <span class="fu">labelToggle</span>(inputType<span class="op">,</span> inputLabel<span class="op">,</span> inputValue<span class="op">,</span> inputId) {</span>
<span id="cb90-2539"><a href="#cb90-2539" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> input <span class="op">=</span> <span class="fu">inputType</span>({<span class="dt">label</span><span class="op">:</span> inputLabel<span class="op">,</span> <span class="dt">value</span><span class="op">:</span> inputValue})<span class="op">;</span></span>
<span id="cb90-2540"><a href="#cb90-2540" aria-hidden="true" tabindex="-1"></a>  input<span class="op">.</span><span class="fu">setAttribute</span>(<span class="st">"id"</span><span class="op">,</span> inputId)<span class="op">;</span></span>
<span id="cb90-2541"><a href="#cb90-2541" aria-hidden="true" tabindex="-1"></a>  <span class="cf">return</span> input<span class="op">;</span></span>
<span id="cb90-2542"><a href="#cb90-2542" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb90-2543"><a href="#cb90-2543" aria-hidden="true" tabindex="-1"></a>timezones <span class="op">=</span> <span class="fu">FileAttachment</span>(<span class="st">"../../asset/timezones.json"</span>)<span class="op">.</span><span class="fu">json</span>()</span>
<span id="cb90-2544"><a href="#cb90-2544" aria-hidden="true" tabindex="-1"></a>zones <span class="op">=</span> topojson<span class="op">.</span><span class="fu">feature</span>(timezones<span class="op">,</span> timezones<span class="op">.</span><span class="at">objects</span><span class="op">.</span><span class="at">timezones</span>)<span class="op">.</span><span class="at">features</span></span>
<span id="cb90-2545"><a href="#cb90-2545" aria-hidden="true" tabindex="-1"></a>mesh <span class="op">=</span> topojson<span class="op">.</span><span class="fu">mesh</span>(timezones<span class="op">,</span> timezones<span class="op">.</span><span class="at">objects</span><span class="op">.</span><span class="at">timezones</span>)</span>
<span id="cb90-2546"><a href="#cb90-2546" aria-hidden="true" tabindex="-1"></a>zonecolor <span class="op">=</span> d3<span class="op">.</span><span class="fu">scaleSequential</span>(d3<span class="op">.</span><span class="at">interpolateRdBu</span>)<span class="op">.</span><span class="fu">domain</span>([<span class="op">-</span><span class="dv">12</span><span class="op">,</span> <span class="dv">14</span>])</span>
<span id="cb90-2547"><a href="#cb90-2547" aria-hidden="true" tabindex="-1"></a>coor <span class="op">=</span> [[[<span class="op">-</span><span class="dv">18</span><span class="op">,</span> <span class="op">-</span><span class="fl">89.98</span>]<span class="op">,</span> [<span class="op">-</span><span class="dv">18</span><span class="op">,</span> <span class="fl">89.98</span>]<span class="op">,</span> [<span class="dv">18</span><span class="op">,</span> <span class="fl">89.98</span>]<span class="op">,</span> [<span class="dv">18</span><span class="op">,</span> <span class="op">-</span><span class="fl">89.98</span>]<span class="op">,</span> [<span class="op">-</span><span class="dv">18</span><span class="op">,</span> <span class="op">-</span><span class="fl">89.98</span>]<span class="op">,</span> ]]</span>
<span id="cb90-2548"><a href="#cb90-2548" aria-hidden="true" tabindex="-1"></a>deczones <span class="op">=</span> [<span class="op">...</span><span class="bu">Array</span>(<span class="dv">10</span>)<span class="op">.</span><span class="fu">keys</span>()]<span class="op">.</span><span class="fu">map</span>(</span>
<span id="cb90-2549"><a href="#cb90-2549" aria-hidden="true" tabindex="-1"></a>  i <span class="kw">=&gt;</span> ({</span>
<span id="cb90-2550"><a href="#cb90-2550" aria-hidden="true" tabindex="-1"></a>    <span class="st">"type"</span><span class="op">:</span> <span class="st">"Feature"</span><span class="op">,</span></span>
<span id="cb90-2551"><a href="#cb90-2551" aria-hidden="true" tabindex="-1"></a>    <span class="st">"geometry"</span><span class="op">:</span> {</span>
<span id="cb90-2552"><a href="#cb90-2552" aria-hidden="true" tabindex="-1"></a>      <span class="st">"type"</span><span class="op">:</span> <span class="st">"Polygon"</span><span class="op">,</span></span>
<span id="cb90-2553"><a href="#cb90-2553" aria-hidden="true" tabindex="-1"></a>      <span class="st">"coordinates"</span><span class="op">:</span> [coor[<span class="dv">0</span>]<span class="op">.</span><span class="fu">map</span>(t <span class="kw">=&gt;</span> [t[<span class="dv">0</span>]<span class="op">+</span><span class="dv">36</span><span class="op">*</span>i<span class="op">,</span> t[<span class="dv">1</span>]])]</span>
<span id="cb90-2554"><a href="#cb90-2554" aria-hidden="true" tabindex="-1"></a>      }<span class="op">,</span></span>
<span id="cb90-2555"><a href="#cb90-2555" aria-hidden="true" tabindex="-1"></a>    <span class="st">"properties"</span><span class="op">:</span> []</span>
<span id="cb90-2556"><a href="#cb90-2556" aria-hidden="true" tabindex="-1"></a>  })</span>
<span id="cb90-2557"><a href="#cb90-2557" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb90-2558"><a href="#cb90-2558" aria-hidden="true" tabindex="-1"></a>hsla10 <span class="op">=</span> [</span>
<span id="cb90-2559"><a href="#cb90-2559" aria-hidden="true" tabindex="-1"></a>  <span class="vs">`hsla(0,   100%, 50%, 100%)`</span><span class="op">,</span> <span class="co">// red</span></span>
<span id="cb90-2560"><a href="#cb90-2560" aria-hidden="true" tabindex="-1"></a>  <span class="vs">`hsla(36,  100%, 50%, 100%)`</span><span class="op">,</span> <span class="co">// orange</span></span>
<span id="cb90-2561"><a href="#cb90-2561" aria-hidden="true" tabindex="-1"></a>  <span class="vs">`hsla(60,  100%, 50%, 100%)`</span><span class="op">,</span> <span class="co">// yellow</span></span>
<span id="cb90-2562"><a href="#cb90-2562" aria-hidden="true" tabindex="-1"></a>  <span class="vs">`hsla(80,  100%, 50%, 100%)`</span><span class="op">,</span> <span class="co">// lime</span></span>
<span id="cb90-2563"><a href="#cb90-2563" aria-hidden="true" tabindex="-1"></a>  <span class="vs">`hsla(120, 100%, 50%, 100%)`</span><span class="op">,</span> <span class="co">// green</span></span>
<span id="cb90-2564"><a href="#cb90-2564" aria-hidden="true" tabindex="-1"></a>  <span class="vs">`hsla(180, 100%, 50%, 100%)`</span><span class="op">,</span> <span class="co">// cyan</span></span>
<span id="cb90-2565"><a href="#cb90-2565" aria-hidden="true" tabindex="-1"></a>  <span class="vs">`hsla(208, 100%, 50%, 100%)`</span><span class="op">,</span> <span class="co">// azure</span></span>
<span id="cb90-2566"><a href="#cb90-2566" aria-hidden="true" tabindex="-1"></a>  <span class="vs">`hsla(240, 100%, 50%, 100%)`</span><span class="op">,</span> <span class="co">// blue</span></span>
<span id="cb90-2567"><a href="#cb90-2567" aria-hidden="true" tabindex="-1"></a>  <span class="vs">`hsla(276, 100%, 50%, 100%)`</span><span class="op">,</span> <span class="co">// violet</span></span>
<span id="cb90-2568"><a href="#cb90-2568" aria-hidden="true" tabindex="-1"></a>  <span class="vs">`hsla(300, 100%, 50%, 100%)`</span><span class="op">,</span> <span class="co">// magenta</span></span>
<span id="cb90-2569"><a href="#cb90-2569" aria-hidden="true" tabindex="-1"></a>  <span class="vs">`hsla(0,   100%, 50%, 100%)`</span><span class="op">,</span> <span class="co">// red</span></span>
<span id="cb90-2570"><a href="#cb90-2570" aria-hidden="true" tabindex="-1"></a>]</span>
<span id="cb90-2571"><a href="#cb90-2571" aria-hidden="true" tabindex="-1"></a>borders <span class="op">=</span> topojson<span class="op">.</span><span class="fu">mesh</span>(countries<span class="op">,</span> countries<span class="op">.</span><span class="at">objects</span><span class="op">.</span><span class="at">countries</span><span class="op">,</span> (a<span class="op">,</span> b) <span class="kw">=&gt;</span> a <span class="op">!==</span> b)</span>
<span id="cb90-2572"><a href="#cb90-2572" aria-hidden="true" tabindex="-1"></a>countries <span class="op">=</span> <span class="fu">fetch</span>(<span class="st">"https://cdn.jsdelivr.net/npm/world-atlas@2/countries-50m.json"</span>)<span class="op">.</span><span class="fu">then</span>(response <span class="kw">=&gt;</span> response<span class="op">.</span><span class="fu">json</span>())</span>
<span id="cb90-2573"><a href="#cb90-2573" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb90-2574"><a href="#cb90-2574" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb90-2577"><a href="#cb90-2577" aria-hidden="true" tabindex="-1"></a><span class="in">```{ojs}</span></span>
<span id="cb90-2578"><a href="#cb90-2578" aria-hidden="true" tabindex="-1"></a><span class="co">//| echo: false</span></span>
<span id="cb90-2579"><a href="#cb90-2579" aria-hidden="true" tabindex="-1"></a><span class="co">//| output: false</span></span>
<span id="cb90-2580"><a href="#cb90-2580" aria-hidden="true" tabindex="-1"></a><span class="co">//| class: clock</span></span>
<span id="cb90-2581"><a href="#cb90-2581" aria-hidden="true" tabindex="-1"></a><span class="co">//| label: posclock</span></span>
<span id="cb90-2582"><a href="#cb90-2582" aria-hidden="true" tabindex="-1"></a><span class="co">// https://observablehq.com/@d3/simple-clock</span></span>
<span id="cb90-2583"><a href="#cb90-2583" aria-hidden="true" tabindex="-1"></a><span class="co">// https://observablehq.com/@drio/lets-build-an-analog-clock</span></span>
<span id="cb90-2584"><a href="#cb90-2584" aria-hidden="true" tabindex="-1"></a>clock <span class="op">=</span> {</span>
<span id="cb90-2585"><a href="#cb90-2585" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> clockRadius <span class="op">=</span> <span class="dv">200</span><span class="op">,</span></span>
<span id="cb90-2586"><a href="#cb90-2586" aria-hidden="true" tabindex="-1"></a>    margin <span class="op">=</span> <span class="dv">50</span><span class="op">,</span></span>
<span id="cb90-2587"><a href="#cb90-2587" aria-hidden="true" tabindex="-1"></a>    w <span class="op">=</span> (clockRadius <span class="op">+</span> margin) <span class="op">*</span> <span class="dv">2</span><span class="op">,</span></span>
<span id="cb90-2588"><a href="#cb90-2588" aria-hidden="true" tabindex="-1"></a>    h <span class="op">=</span> (clockRadius <span class="op">+</span> margin) <span class="op">*</span> <span class="dv">2</span><span class="op">,</span></span>
<span id="cb90-2589"><a href="#cb90-2589" aria-hidden="true" tabindex="-1"></a>    hourHandLength <span class="op">=</span> (<span class="dv">2</span> <span class="op">*</span> clockRadius) <span class="op">/</span> <span class="dv">3</span><span class="op">,</span></span>
<span id="cb90-2590"><a href="#cb90-2590" aria-hidden="true" tabindex="-1"></a>    minuteHandLength <span class="op">=</span> clockRadius<span class="op">,</span></span>
<span id="cb90-2591"><a href="#cb90-2591" aria-hidden="true" tabindex="-1"></a>    secondHandLength <span class="op">=</span> clockRadius <span class="op">-</span> <span class="dv">12</span><span class="op">,</span></span>
<span id="cb90-2592"><a href="#cb90-2592" aria-hidden="true" tabindex="-1"></a>    secondHandBalance <span class="op">=</span> <span class="dv">30</span><span class="op">,</span></span>
<span id="cb90-2593"><a href="#cb90-2593" aria-hidden="true" tabindex="-1"></a>    secondTickStart <span class="op">=</span> clockRadius<span class="op">,</span></span>
<span id="cb90-2594"><a href="#cb90-2594" aria-hidden="true" tabindex="-1"></a>    secondTickLength <span class="op">=</span> <span class="op">-</span><span class="dv">10</span><span class="op">,</span></span>
<span id="cb90-2595"><a href="#cb90-2595" aria-hidden="true" tabindex="-1"></a>    hourTickStart <span class="op">=</span> clockRadius<span class="op">,</span></span>
<span id="cb90-2596"><a href="#cb90-2596" aria-hidden="true" tabindex="-1"></a>    hourTickLength <span class="op">=</span> <span class="op">-</span><span class="dv">18</span><span class="op">,</span></span>
<span id="cb90-2597"><a href="#cb90-2597" aria-hidden="true" tabindex="-1"></a>    secondLabelRadius <span class="op">=</span> clockRadius <span class="op">+</span> <span class="dv">16</span><span class="op">,</span></span>
<span id="cb90-2598"><a href="#cb90-2598" aria-hidden="true" tabindex="-1"></a>    secondLabelYOffset <span class="op">=</span> <span class="dv">5</span><span class="op">,</span></span>
<span id="cb90-2599"><a href="#cb90-2599" aria-hidden="true" tabindex="-1"></a>    hourLabelRadius <span class="op">=</span> clockRadius <span class="op">-</span> <span class="dv">40</span><span class="op">,</span></span>
<span id="cb90-2600"><a href="#cb90-2600" aria-hidden="true" tabindex="-1"></a>    hourLabelYOffset <span class="op">=</span> <span class="dv">7</span><span class="op">,</span></span>
<span id="cb90-2601"><a href="#cb90-2601" aria-hidden="true" tabindex="-1"></a>    radians <span class="op">=</span> <span class="bu">Math</span><span class="op">.</span><span class="cn">PI</span> <span class="op">/</span> <span class="dv">180</span><span class="op">;</span></span>
<span id="cb90-2602"><a href="#cb90-2602" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> ten <span class="op">=</span> d3</span>
<span id="cb90-2603"><a href="#cb90-2603" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">scaleLinear</span>()</span>
<span id="cb90-2604"><a href="#cb90-2604" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">range</span>([<span class="dv">0</span><span class="op">,</span> <span class="dv">360</span>])</span>
<span id="cb90-2605"><a href="#cb90-2605" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">domain</span>([<span class="dv">0</span><span class="op">,</span> <span class="dv">10</span>])<span class="op">;</span></span>
<span id="cb90-2606"><a href="#cb90-2606" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> sto <span class="op">=</span> d3</span>
<span id="cb90-2607"><a href="#cb90-2607" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">scaleLinear</span>()</span>
<span id="cb90-2608"><a href="#cb90-2608" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">range</span>([<span class="dv">0</span><span class="op">,</span> <span class="dv">360</span>])</span>
<span id="cb90-2609"><a href="#cb90-2609" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">domain</span>([<span class="dv">0</span><span class="op">,</span> <span class="dv">100</span>])<span class="op">;</span></span>
<span id="cb90-2610"><a href="#cb90-2610" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> handData <span class="op">=</span> [</span>
<span id="cb90-2611"><a href="#cb90-2611" aria-hidden="true" tabindex="-1"></a>    {</span>
<span id="cb90-2612"><a href="#cb90-2612" aria-hidden="true" tabindex="-1"></a>      <span class="dt">type</span><span class="op">:</span> <span class="st">"hour"</span><span class="op">,</span></span>
<span id="cb90-2613"><a href="#cb90-2613" aria-hidden="true" tabindex="-1"></a>      <span class="dt">value</span><span class="op">:</span> <span class="dv">0</span><span class="op">,</span></span>
<span id="cb90-2614"><a href="#cb90-2614" aria-hidden="true" tabindex="-1"></a>      <span class="dt">length</span><span class="op">:</span> <span class="op">-</span>hourHandLength<span class="op">,</span></span>
<span id="cb90-2615"><a href="#cb90-2615" aria-hidden="true" tabindex="-1"></a>      <span class="dt">scale</span><span class="op">:</span> ten</span>
<span id="cb90-2616"><a href="#cb90-2616" aria-hidden="true" tabindex="-1"></a>    }<span class="op">,</span></span>
<span id="cb90-2617"><a href="#cb90-2617" aria-hidden="true" tabindex="-1"></a>    {</span>
<span id="cb90-2618"><a href="#cb90-2618" aria-hidden="true" tabindex="-1"></a>      <span class="dt">type</span><span class="op">:</span> <span class="st">"minute"</span><span class="op">,</span></span>
<span id="cb90-2619"><a href="#cb90-2619" aria-hidden="true" tabindex="-1"></a>      <span class="dt">value</span><span class="op">:</span> <span class="dv">0</span><span class="op">,</span></span>
<span id="cb90-2620"><a href="#cb90-2620" aria-hidden="true" tabindex="-1"></a>      <span class="dt">length</span><span class="op">:</span> <span class="op">-</span>minuteHandLength<span class="op">,</span></span>
<span id="cb90-2621"><a href="#cb90-2621" aria-hidden="true" tabindex="-1"></a>      <span class="dt">scale</span><span class="op">:</span> sto</span>
<span id="cb90-2622"><a href="#cb90-2622" aria-hidden="true" tabindex="-1"></a>    }<span class="op">,</span></span>
<span id="cb90-2623"><a href="#cb90-2623" aria-hidden="true" tabindex="-1"></a>    {</span>
<span id="cb90-2624"><a href="#cb90-2624" aria-hidden="true" tabindex="-1"></a>      <span class="dt">type</span><span class="op">:</span> <span class="st">"second"</span><span class="op">,</span></span>
<span id="cb90-2625"><a href="#cb90-2625" aria-hidden="true" tabindex="-1"></a>      <span class="dt">value</span><span class="op">:</span> <span class="dv">0</span><span class="op">,</span></span>
<span id="cb90-2626"><a href="#cb90-2626" aria-hidden="true" tabindex="-1"></a>      <span class="dt">length</span><span class="op">:</span> <span class="op">-</span>secondHandLength<span class="op">,</span></span>
<span id="cb90-2627"><a href="#cb90-2627" aria-hidden="true" tabindex="-1"></a>      <span class="dt">scale</span><span class="op">:</span> sto<span class="op">,</span></span>
<span id="cb90-2628"><a href="#cb90-2628" aria-hidden="true" tabindex="-1"></a>      <span class="dt">balance</span><span class="op">:</span> secondHandBalance</span>
<span id="cb90-2629"><a href="#cb90-2629" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb90-2630"><a href="#cb90-2630" aria-hidden="true" tabindex="-1"></a>  ]<span class="op">;</span></span>
<span id="cb90-2631"><a href="#cb90-2631" aria-hidden="true" tabindex="-1"></a>  <span class="kw">function</span> <span class="fu">drawClock</span>() {</span>
<span id="cb90-2632"><a href="#cb90-2632" aria-hidden="true" tabindex="-1"></a>    <span class="co">// create all the clock elements</span></span>
<span id="cb90-2633"><a href="#cb90-2633" aria-hidden="true" tabindex="-1"></a>    <span class="fu">updateData</span>()<span class="op">;</span> <span class="co">//draw them in the correct starting position</span></span>
<span id="cb90-2634"><a href="#cb90-2634" aria-hidden="true" tabindex="-1"></a>    <span class="kw">const</span> face <span class="op">=</span> svg</span>
<span id="cb90-2635"><a href="#cb90-2635" aria-hidden="true" tabindex="-1"></a>      <span class="op">.</span><span class="fu">append</span>(<span class="st">"g"</span>)</span>
<span id="cb90-2636"><a href="#cb90-2636" aria-hidden="true" tabindex="-1"></a>      <span class="op">.</span><span class="fu">attr</span>(<span class="st">"id"</span><span class="op">,</span> <span class="st">"clock-face"</span>)</span>
<span id="cb90-2637"><a href="#cb90-2637" aria-hidden="true" tabindex="-1"></a>      <span class="op">.</span><span class="fu">attr</span>(<span class="st">"transform"</span><span class="op">,</span> <span class="vs">`translate(</span><span class="sc">${</span>[w <span class="op">/</span> <span class="dv">2</span><span class="op">,</span> h <span class="op">/</span> <span class="dv">2</span>]<span class="sc">}</span><span class="vs">)`</span>)<span class="op">;</span></span>
<span id="cb90-2638"><a href="#cb90-2638" aria-hidden="true" tabindex="-1"></a>    <span class="co">// add marks for seconds</span></span>
<span id="cb90-2639"><a href="#cb90-2639" aria-hidden="true" tabindex="-1"></a>    face</span>
<span id="cb90-2640"><a href="#cb90-2640" aria-hidden="true" tabindex="-1"></a>      <span class="op">.</span><span class="fu">selectAll</span>(<span class="st">".second-tick"</span>)</span>
<span id="cb90-2641"><a href="#cb90-2641" aria-hidden="true" tabindex="-1"></a>      <span class="op">.</span><span class="fu">data</span>(d3<span class="op">.</span><span class="fu">range</span>(<span class="dv">0</span><span class="op">,</span> <span class="dv">100</span>))</span>
<span id="cb90-2642"><a href="#cb90-2642" aria-hidden="true" tabindex="-1"></a>      <span class="op">.</span><span class="fu">enter</span>()</span>
<span id="cb90-2643"><a href="#cb90-2643" aria-hidden="true" tabindex="-1"></a>      <span class="op">.</span><span class="fu">append</span>(<span class="st">"line"</span>)</span>
<span id="cb90-2644"><a href="#cb90-2644" aria-hidden="true" tabindex="-1"></a>      <span class="op">.</span><span class="fu">attr</span>(<span class="st">"class"</span><span class="op">,</span> <span class="st">"second-tick"</span>)</span>
<span id="cb90-2645"><a href="#cb90-2645" aria-hidden="true" tabindex="-1"></a>      <span class="op">.</span><span class="fu">attr</span>(<span class="st">"x1"</span><span class="op">,</span> <span class="dv">0</span>)</span>
<span id="cb90-2646"><a href="#cb90-2646" aria-hidden="true" tabindex="-1"></a>      <span class="op">.</span><span class="fu">attr</span>(<span class="st">"x2"</span><span class="op">,</span> <span class="dv">0</span>)</span>
<span id="cb90-2647"><a href="#cb90-2647" aria-hidden="true" tabindex="-1"></a>      <span class="op">.</span><span class="fu">attr</span>(<span class="st">"y1"</span><span class="op">,</span> secondTickStart)</span>
<span id="cb90-2648"><a href="#cb90-2648" aria-hidden="true" tabindex="-1"></a>      <span class="op">.</span><span class="fu">attr</span>(<span class="st">"y2"</span><span class="op">,</span> secondTickStart <span class="op">+</span> secondTickLength)</span>
<span id="cb90-2649"><a href="#cb90-2649" aria-hidden="true" tabindex="-1"></a>      <span class="op">.</span><span class="fu">attr</span>(<span class="st">"transform"</span><span class="op">,</span> d <span class="kw">=&gt;</span> <span class="vs">`rotate(</span><span class="sc">${</span><span class="fu">sto</span>(d)<span class="sc">}</span><span class="vs">)`</span>)<span class="op">;</span></span>
<span id="cb90-2650"><a href="#cb90-2650" aria-hidden="true" tabindex="-1"></a>    <span class="co">// and labels...</span></span>
<span id="cb90-2651"><a href="#cb90-2651" aria-hidden="true" tabindex="-1"></a>    face</span>
<span id="cb90-2652"><a href="#cb90-2652" aria-hidden="true" tabindex="-1"></a>      <span class="op">.</span><span class="fu">selectAll</span>(<span class="st">".second-label"</span>)</span>
<span id="cb90-2653"><a href="#cb90-2653" aria-hidden="true" tabindex="-1"></a>      <span class="op">.</span><span class="fu">data</span>(d3<span class="op">.</span><span class="fu">range</span>(<span class="dv">0</span><span class="op">,</span> <span class="dv">100</span><span class="op">,</span> <span class="dv">5</span>))</span>
<span id="cb90-2654"><a href="#cb90-2654" aria-hidden="true" tabindex="-1"></a>      <span class="op">.</span><span class="fu">enter</span>()</span>
<span id="cb90-2655"><a href="#cb90-2655" aria-hidden="true" tabindex="-1"></a>      <span class="op">.</span><span class="fu">append</span>(<span class="st">"text"</span>)</span>
<span id="cb90-2656"><a href="#cb90-2656" aria-hidden="true" tabindex="-1"></a>      <span class="op">.</span><span class="fu">attr</span>(<span class="st">"class"</span><span class="op">,</span> <span class="st">"second-label"</span>)</span>
<span id="cb90-2657"><a href="#cb90-2657" aria-hidden="true" tabindex="-1"></a>      <span class="op">.</span><span class="fu">attr</span>(<span class="st">"text-anchor"</span><span class="op">,</span> <span class="st">"middle"</span>)</span>
<span id="cb90-2658"><a href="#cb90-2658" aria-hidden="true" tabindex="-1"></a>      <span class="op">.</span><span class="fu">attr</span>(<span class="st">"x"</span><span class="op">,</span> d <span class="kw">=&gt;</span> secondLabelRadius <span class="op">*</span> <span class="bu">Math</span><span class="op">.</span><span class="fu">sin</span>(<span class="fu">sto</span>(d) <span class="op">*</span> radians))</span>
<span id="cb90-2659"><a href="#cb90-2659" aria-hidden="true" tabindex="-1"></a>      <span class="op">.</span><span class="fu">attr</span>(</span>
<span id="cb90-2660"><a href="#cb90-2660" aria-hidden="true" tabindex="-1"></a>        <span class="st">"y"</span><span class="op">,</span></span>
<span id="cb90-2661"><a href="#cb90-2661" aria-hidden="true" tabindex="-1"></a>        d <span class="kw">=&gt;</span></span>
<span id="cb90-2662"><a href="#cb90-2662" aria-hidden="true" tabindex="-1"></a>          <span class="op">-</span>secondLabelRadius <span class="op">*</span> <span class="bu">Math</span><span class="op">.</span><span class="fu">cos</span>(<span class="fu">sto</span>(d) <span class="op">*</span> radians) <span class="op">+</span> secondLabelYOffset</span>
<span id="cb90-2663"><a href="#cb90-2663" aria-hidden="true" tabindex="-1"></a>      )</span>
<span id="cb90-2664"><a href="#cb90-2664" aria-hidden="true" tabindex="-1"></a>      <span class="op">.</span><span class="fu">text</span>(d <span class="kw">=&gt;</span> d)<span class="op">;</span></span>
<span id="cb90-2665"><a href="#cb90-2665" aria-hidden="true" tabindex="-1"></a>    <span class="co">// ... and hours</span></span>
<span id="cb90-2666"><a href="#cb90-2666" aria-hidden="true" tabindex="-1"></a>    face</span>
<span id="cb90-2667"><a href="#cb90-2667" aria-hidden="true" tabindex="-1"></a>      <span class="op">.</span><span class="fu">selectAll</span>(<span class="st">".hour-tick"</span>)</span>
<span id="cb90-2668"><a href="#cb90-2668" aria-hidden="true" tabindex="-1"></a>      <span class="op">.</span><span class="fu">data</span>(d3<span class="op">.</span><span class="fu">range</span>(<span class="dv">0</span><span class="op">,</span> <span class="dv">10</span><span class="op">,</span> <span class="dv">1</span>))</span>
<span id="cb90-2669"><a href="#cb90-2669" aria-hidden="true" tabindex="-1"></a>      <span class="op">.</span><span class="fu">enter</span>()</span>
<span id="cb90-2670"><a href="#cb90-2670" aria-hidden="true" tabindex="-1"></a>      <span class="op">.</span><span class="fu">append</span>(<span class="st">"line"</span>)</span>
<span id="cb90-2671"><a href="#cb90-2671" aria-hidden="true" tabindex="-1"></a>      <span class="op">.</span><span class="fu">attr</span>(<span class="st">"class"</span><span class="op">,</span> <span class="st">"hour-tick"</span>)</span>
<span id="cb90-2672"><a href="#cb90-2672" aria-hidden="true" tabindex="-1"></a>      <span class="op">.</span><span class="fu">attr</span>(<span class="st">"x1"</span><span class="op">,</span> <span class="dv">0</span>)</span>
<span id="cb90-2673"><a href="#cb90-2673" aria-hidden="true" tabindex="-1"></a>      <span class="op">.</span><span class="fu">attr</span>(<span class="st">"x2"</span><span class="op">,</span> <span class="dv">0</span>)</span>
<span id="cb90-2674"><a href="#cb90-2674" aria-hidden="true" tabindex="-1"></a>      <span class="op">.</span><span class="fu">attr</span>(<span class="st">"y1"</span><span class="op">,</span> hourTickStart)</span>
<span id="cb90-2675"><a href="#cb90-2675" aria-hidden="true" tabindex="-1"></a>      <span class="op">.</span><span class="fu">attr</span>(<span class="st">"y2"</span><span class="op">,</span> hourTickStart <span class="op">+</span> hourTickLength)</span>
<span id="cb90-2676"><a href="#cb90-2676" aria-hidden="true" tabindex="-1"></a>      <span class="op">.</span><span class="fu">attr</span>(<span class="st">"transform"</span><span class="op">,</span> d <span class="kw">=&gt;</span> <span class="vs">`rotate(</span><span class="sc">${</span><span class="fu">ten</span>(d)<span class="sc">}</span><span class="vs">)`</span>)<span class="op">;</span></span>
<span id="cb90-2677"><a href="#cb90-2677" aria-hidden="true" tabindex="-1"></a>    face</span>
<span id="cb90-2678"><a href="#cb90-2678" aria-hidden="true" tabindex="-1"></a>      <span class="op">.</span><span class="fu">selectAll</span>(<span class="st">".hour-label"</span>)</span>
<span id="cb90-2679"><a href="#cb90-2679" aria-hidden="true" tabindex="-1"></a>      <span class="op">.</span><span class="fu">data</span>(d3<span class="op">.</span><span class="fu">range</span>(<span class="dv">0</span><span class="op">,</span> <span class="dv">10</span><span class="op">,</span> <span class="dv">1</span>))</span>
<span id="cb90-2680"><a href="#cb90-2680" aria-hidden="true" tabindex="-1"></a>      <span class="op">.</span><span class="fu">enter</span>()</span>
<span id="cb90-2681"><a href="#cb90-2681" aria-hidden="true" tabindex="-1"></a>      <span class="op">.</span><span class="fu">append</span>(<span class="st">"text"</span>)</span>
<span id="cb90-2682"><a href="#cb90-2682" aria-hidden="true" tabindex="-1"></a>      <span class="op">.</span><span class="fu">attr</span>(<span class="st">"class"</span><span class="op">,</span> <span class="st">"hour-label"</span>)</span>
<span id="cb90-2683"><a href="#cb90-2683" aria-hidden="true" tabindex="-1"></a>      <span class="op">.</span><span class="fu">attr</span>(<span class="st">"text-anchor"</span><span class="op">,</span> <span class="st">"middle"</span>)</span>
<span id="cb90-2684"><a href="#cb90-2684" aria-hidden="true" tabindex="-1"></a>      <span class="op">.</span><span class="fu">attr</span>(<span class="st">"x"</span><span class="op">,</span> d <span class="kw">=&gt;</span> hourLabelRadius <span class="op">*</span> <span class="bu">Math</span><span class="op">.</span><span class="fu">sin</span>(<span class="fu">ten</span>(d) <span class="op">*</span> radians))</span>
<span id="cb90-2685"><a href="#cb90-2685" aria-hidden="true" tabindex="-1"></a>      <span class="op">.</span><span class="fu">attr</span>(</span>
<span id="cb90-2686"><a href="#cb90-2686" aria-hidden="true" tabindex="-1"></a>        <span class="st">"y"</span><span class="op">,</span></span>
<span id="cb90-2687"><a href="#cb90-2687" aria-hidden="true" tabindex="-1"></a>        d <span class="kw">=&gt;</span> <span class="op">-</span>hourLabelRadius <span class="op">*</span> <span class="bu">Math</span><span class="op">.</span><span class="fu">cos</span>(<span class="fu">ten</span>(d) <span class="op">*</span> radians) <span class="op">+</span> hourLabelYOffset</span>
<span id="cb90-2688"><a href="#cb90-2688" aria-hidden="true" tabindex="-1"></a>      )</span>
<span id="cb90-2689"><a href="#cb90-2689" aria-hidden="true" tabindex="-1"></a>      <span class="op">.</span><span class="fu">text</span>(d <span class="kw">=&gt;</span> d)<span class="op">;</span></span>
<span id="cb90-2690"><a href="#cb90-2690" aria-hidden="true" tabindex="-1"></a>    <span class="kw">const</span> hands <span class="op">=</span> face<span class="op">.</span><span class="fu">append</span>(<span class="st">"g"</span>)<span class="op">.</span><span class="fu">attr</span>(<span class="st">"id"</span><span class="op">,</span> <span class="st">"clock-hands"</span>)<span class="op">;</span></span>
<span id="cb90-2691"><a href="#cb90-2691" aria-hidden="true" tabindex="-1"></a>    hands</span>
<span id="cb90-2692"><a href="#cb90-2692" aria-hidden="true" tabindex="-1"></a>      <span class="op">.</span><span class="fu">selectAll</span>(<span class="st">"line"</span>)</span>
<span id="cb90-2693"><a href="#cb90-2693" aria-hidden="true" tabindex="-1"></a>      <span class="op">.</span><span class="fu">data</span>(handData)</span>
<span id="cb90-2694"><a href="#cb90-2694" aria-hidden="true" tabindex="-1"></a>      <span class="op">.</span><span class="fu">enter</span>()</span>
<span id="cb90-2695"><a href="#cb90-2695" aria-hidden="true" tabindex="-1"></a>      <span class="op">.</span><span class="fu">append</span>(<span class="st">"line"</span>)</span>
<span id="cb90-2696"><a href="#cb90-2696" aria-hidden="true" tabindex="-1"></a>      <span class="op">.</span><span class="fu">attr</span>(<span class="st">"class"</span><span class="op">,</span> d <span class="kw">=&gt;</span> d<span class="op">.</span><span class="at">type</span> <span class="op">+</span> <span class="st">"-hand"</span>)</span>
<span id="cb90-2697"><a href="#cb90-2697" aria-hidden="true" tabindex="-1"></a>      <span class="op">.</span><span class="fu">attr</span>(<span class="st">"x1"</span><span class="op">,</span> <span class="dv">0</span>)</span>
<span id="cb90-2698"><a href="#cb90-2698" aria-hidden="true" tabindex="-1"></a>      <span class="op">.</span><span class="fu">attr</span>(<span class="st">"y1"</span><span class="op">,</span> d <span class="kw">=&gt;</span> d<span class="op">.</span><span class="at">balance</span> <span class="op">||</span> <span class="dv">0</span>)</span>
<span id="cb90-2699"><a href="#cb90-2699" aria-hidden="true" tabindex="-1"></a>      <span class="op">.</span><span class="fu">attr</span>(<span class="st">"x2"</span><span class="op">,</span> <span class="dv">0</span>)</span>
<span id="cb90-2700"><a href="#cb90-2700" aria-hidden="true" tabindex="-1"></a>      <span class="op">.</span><span class="fu">attr</span>(<span class="st">"y2"</span><span class="op">,</span> d <span class="kw">=&gt;</span> d<span class="op">.</span><span class="at">length</span>)</span>
<span id="cb90-2701"><a href="#cb90-2701" aria-hidden="true" tabindex="-1"></a>      <span class="op">.</span><span class="fu">attr</span>(<span class="st">"transform"</span><span class="op">,</span> d <span class="kw">=&gt;</span> <span class="vs">`rotate(</span><span class="sc">${</span>d<span class="op">.</span><span class="fu">scale</span>(d<span class="op">.</span><span class="at">value</span>)<span class="sc">}</span><span class="vs">)`</span>)<span class="op">;</span></span>
<span id="cb90-2702"><a href="#cb90-2702" aria-hidden="true" tabindex="-1"></a>    face</span>
<span id="cb90-2703"><a href="#cb90-2703" aria-hidden="true" tabindex="-1"></a>      <span class="op">.</span><span class="fu">append</span>(<span class="st">"g"</span>)</span>
<span id="cb90-2704"><a href="#cb90-2704" aria-hidden="true" tabindex="-1"></a>      <span class="op">.</span><span class="fu">attr</span>(<span class="st">"id"</span><span class="op">,</span> <span class="st">"face-overlay"</span>)</span>
<span id="cb90-2705"><a href="#cb90-2705" aria-hidden="true" tabindex="-1"></a>      <span class="op">.</span><span class="fu">append</span>(<span class="st">"circle"</span>)</span>
<span id="cb90-2706"><a href="#cb90-2706" aria-hidden="true" tabindex="-1"></a>      <span class="op">.</span><span class="fu">attr</span>(<span class="st">"class"</span><span class="op">,</span> <span class="st">"hands-cover"</span>)</span>
<span id="cb90-2707"><a href="#cb90-2707" aria-hidden="true" tabindex="-1"></a>      <span class="op">.</span><span class="fu">attr</span>(<span class="st">"x"</span><span class="op">,</span> <span class="dv">0</span>)</span>
<span id="cb90-2708"><a href="#cb90-2708" aria-hidden="true" tabindex="-1"></a>      <span class="op">.</span><span class="fu">attr</span>(<span class="st">"y"</span><span class="op">,</span> <span class="dv">0</span>)</span>
<span id="cb90-2709"><a href="#cb90-2709" aria-hidden="true" tabindex="-1"></a>      <span class="op">.</span><span class="fu">attr</span>(<span class="st">"r"</span><span class="op">,</span> clockRadius <span class="op">/</span> <span class="dv">20</span>)<span class="op">;</span></span>
<span id="cb90-2710"><a href="#cb90-2710" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb90-2711"><a href="#cb90-2711" aria-hidden="true" tabindex="-1"></a>  <span class="kw">function</span> <span class="fu">moveHands</span>() {</span>
<span id="cb90-2712"><a href="#cb90-2712" aria-hidden="true" tabindex="-1"></a>    <span class="kw">const</span> sel <span class="op">=</span> d3</span>
<span id="cb90-2713"><a href="#cb90-2713" aria-hidden="true" tabindex="-1"></a>      <span class="op">.</span><span class="fu">select</span>(<span class="st">"#clock-hands-final"</span>)</span>
<span id="cb90-2714"><a href="#cb90-2714" aria-hidden="true" tabindex="-1"></a>      <span class="op">.</span><span class="fu">selectAll</span>(<span class="st">"line"</span>)</span>
<span id="cb90-2715"><a href="#cb90-2715" aria-hidden="true" tabindex="-1"></a>      <span class="op">.</span><span class="fu">data</span>(handData)</span>
<span id="cb90-2716"><a href="#cb90-2716" aria-hidden="true" tabindex="-1"></a>      <span class="op">.</span><span class="fu">transition</span>()<span class="op">;</span></span>
<span id="cb90-2717"><a href="#cb90-2717" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> (fancySecondsOFF) sel<span class="op">.</span><span class="fu">ease</span>(d3<span class="op">.</span><span class="at">easeElastic</span><span class="op">.</span><span class="fu">period</span>(<span class="fl">0.5</span>))<span class="op">;</span></span>
<span id="cb90-2718"><a href="#cb90-2718" aria-hidden="true" tabindex="-1"></a>    sel<span class="op">.</span><span class="fu">attr</span>(<span class="st">"transform"</span><span class="op">,</span> d <span class="kw">=&gt;</span> <span class="vs">`rotate(</span><span class="sc">${</span>d<span class="op">.</span><span class="fu">scale</span>(d<span class="op">.</span><span class="at">value</span>)<span class="sc">}</span><span class="vs">)`</span>)<span class="op">;</span></span>
<span id="cb90-2719"><a href="#cb90-2719" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb90-2720"><a href="#cb90-2720" aria-hidden="true" tabindex="-1"></a>  <span class="kw">function</span> <span class="fu">updateData</span>() {</span>
<span id="cb90-2721"><a href="#cb90-2721" aria-hidden="true" tabindex="-1"></a>    handData[<span class="dv">0</span>]<span class="op">.</span><span class="at">value</span> <span class="op">=</span> <span class="op">!</span>fancySecondsOFF <span class="op">?</span> <span class="bu">Math</span><span class="op">.</span><span class="fu">floor</span>(selectedExact <span class="op">*</span> <span class="dv">10</span>) <span class="op">:</span> decTime[<span class="dv">0</span>]<span class="op">;</span></span>
<span id="cb90-2722"><a href="#cb90-2722" aria-hidden="true" tabindex="-1"></a>    handData[<span class="dv">1</span>]<span class="op">.</span><span class="at">value</span> <span class="op">=</span> <span class="op">!</span>fancySecondsOFF <span class="op">?</span> <span class="bu">Math</span><span class="op">.</span><span class="fu">floor</span>(selectedExact <span class="op">*</span> <span class="dv">10</span> <span class="op">%</span> <span class="dv">1</span> <span class="op">*</span> <span class="dv">100</span>) <span class="op">:</span> decTime<span class="op">.</span><span class="fu">slice</span>(<span class="dv">2</span><span class="op">,</span> <span class="dv">4</span>)<span class="op">;</span></span>
<span id="cb90-2723"><a href="#cb90-2723" aria-hidden="true" tabindex="-1"></a>    handData[<span class="dv">2</span>]<span class="op">.</span><span class="at">value</span> <span class="op">=</span> <span class="op">!</span>fancySecondsOFF <span class="op">?</span> selectedExact <span class="op">*</span> <span class="dv">10</span> <span class="op">%</span> <span class="dv">1</span> <span class="op">*</span> <span class="dv">100</span> <span class="op">%</span> <span class="dv">1</span> <span class="op">*</span> <span class="dv">100</span> <span class="op">:</span> decTime<span class="op">.</span><span class="fu">slice</span>(<span class="dv">4</span><span class="op">,</span> <span class="dv">6</span>)<span class="op">;</span></span>
<span id="cb90-2724"><a href="#cb90-2724" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb90-2725"><a href="#cb90-2725" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> svg <span class="op">=</span> d3</span>
<span id="cb90-2726"><a href="#cb90-2726" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">create</span>(<span class="st">"svg"</span>)</span>
<span id="cb90-2727"><a href="#cb90-2727" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">"viewBox"</span><span class="op">,</span> [<span class="dv">0</span><span class="op">,</span> <span class="dv">0</span><span class="op">,</span> w<span class="op">,</span> h])</span>
<span id="cb90-2728"><a href="#cb90-2728" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">style</span>(<span class="st">"max-width"</span><span class="op">,</span> <span class="vs">`</span><span class="sc">${</span>width <span class="op">/</span> <span class="fl">2.1</span><span class="sc">}</span><span class="vs">px`</span>)</span>
<span id="cb90-2729"><a href="#cb90-2729" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">"class"</span><span class="op">,</span> <span class="st">"analogclock"</span>)</span>
<span id="cb90-2730"><a href="#cb90-2730" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">"id"</span><span class="op">,</span> <span class="st">"topclock"</span>)<span class="op">;</span></span>
<span id="cb90-2731"><a href="#cb90-2731" aria-hidden="true" tabindex="-1"></a>  svg</span>
<span id="cb90-2732"><a href="#cb90-2732" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">append</span>(<span class="st">"text"</span>)</span>
<span id="cb90-2733"><a href="#cb90-2733" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">text</span>(<span class="vs">`+</span><span class="sc">${</span>decTime<span class="sc">}</span><span class="vs">-</span><span class="sc">${</span>selectedZone<span class="sc">}</span><span class="vs">`</span>)</span>
<span id="cb90-2734"><a href="#cb90-2734" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">"x"</span><span class="op">,</span> clockRadius <span class="op">+</span> margin)</span>
<span id="cb90-2735"><a href="#cb90-2735" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">"y"</span><span class="op">,</span> clockRadius <span class="op">*</span> <span class="dv">2</span> <span class="op">+</span> margin <span class="op">*</span> <span class="fl">2.1</span>)</span>
<span id="cb90-2736"><a href="#cb90-2736" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">"text-anchor"</span><span class="op">,</span> <span class="st">"middle"</span>)</span>
<span id="cb90-2737"><a href="#cb90-2737" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">"font-size"</span><span class="op">,</span> <span class="dv">32</span>)</span>
<span id="cb90-2738"><a href="#cb90-2738" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">"font-family"</span><span class="op">,</span> <span class="st">"monospace"</span>)<span class="op">;</span></span>
<span id="cb90-2739"><a href="#cb90-2739" aria-hidden="true" tabindex="-1"></a>  <span class="fu">drawClock</span>()<span class="op">;</span></span>
<span id="cb90-2740"><a href="#cb90-2740" aria-hidden="true" tabindex="-1"></a>  <span class="co">// Animation</span></span>
<span id="cb90-2741"><a href="#cb90-2741" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> interval <span class="op">=</span> <span class="pp">setInterval</span>(</span>
<span id="cb90-2742"><a href="#cb90-2742" aria-hidden="true" tabindex="-1"></a>    () <span class="kw">=&gt;</span> {</span>
<span id="cb90-2743"><a href="#cb90-2743" aria-hidden="true" tabindex="-1"></a>      <span class="fu">updateData</span>()<span class="op">;</span></span>
<span id="cb90-2744"><a href="#cb90-2744" aria-hidden="true" tabindex="-1"></a>      <span class="fu">moveHands</span>()<span class="op">;</span></span>
<span id="cb90-2745"><a href="#cb90-2745" aria-hidden="true" tabindex="-1"></a>    }<span class="op">,</span></span>
<span id="cb90-2746"><a href="#cb90-2746" aria-hidden="true" tabindex="-1"></a>    <span class="op">!</span>fancySecondsOFF <span class="op">?</span> <span class="dv">10</span> <span class="op">:</span> <span class="dv">864</span></span>
<span id="cb90-2747"><a href="#cb90-2747" aria-hidden="true" tabindex="-1"></a>  )<span class="op">;</span></span>
<span id="cb90-2748"><a href="#cb90-2748" aria-hidden="true" tabindex="-1"></a>  invalidation<span class="op">.</span><span class="fu">then</span>(() <span class="kw">=&gt;</span> <span class="pp">clearInterval</span>(interval))<span class="op">;</span></span>
<span id="cb90-2749"><a href="#cb90-2749" aria-hidden="true" tabindex="-1"></a>  <span class="cf">return</span> svg<span class="op">.</span><span class="fu">node</span>()<span class="op">;</span></span>
<span id="cb90-2750"><a href="#cb90-2750" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb90-2751"><a href="#cb90-2751" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb90-2752"><a href="#cb90-2752" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb90-2755"><a href="#cb90-2755" aria-hidden="true" tabindex="-1"></a><span class="in">```{ojs}</span></span>
<span id="cb90-2756"><a href="#cb90-2756" aria-hidden="true" tabindex="-1"></a><span class="co">//| echo: false</span></span>
<span id="cb90-2757"><a href="#cb90-2757" aria-hidden="true" tabindex="-1"></a><span class="co">//| output: false</span></span>
<span id="cb90-2758"><a href="#cb90-2758" aria-hidden="true" tabindex="-1"></a><span class="co">//| class: clock</span></span>
<span id="cb90-2759"><a href="#cb90-2759" aria-hidden="true" tabindex="-1"></a><span class="co">//| label: negclock</span></span>
<span id="cb90-2760"><a href="#cb90-2760" aria-hidden="true" tabindex="-1"></a><span class="co">// https://observablehq.com/@d3/simple-clock</span></span>
<span id="cb90-2761"><a href="#cb90-2761" aria-hidden="true" tabindex="-1"></a><span class="co">// https://observablehq.com/@drio/lets-build-an-analog-clock</span></span>
<span id="cb90-2762"><a href="#cb90-2762" aria-hidden="true" tabindex="-1"></a>clock1 <span class="op">=</span> {</span>
<span id="cb90-2763"><a href="#cb90-2763" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> clockRadius <span class="op">=</span> <span class="dv">200</span><span class="op">,</span></span>
<span id="cb90-2764"><a href="#cb90-2764" aria-hidden="true" tabindex="-1"></a>    margin <span class="op">=</span> <span class="dv">50</span><span class="op">,</span></span>
<span id="cb90-2765"><a href="#cb90-2765" aria-hidden="true" tabindex="-1"></a>    w <span class="op">=</span> (clockRadius <span class="op">+</span> margin) <span class="op">*</span> <span class="dv">2</span><span class="op">,</span></span>
<span id="cb90-2766"><a href="#cb90-2766" aria-hidden="true" tabindex="-1"></a>    h <span class="op">=</span> (clockRadius <span class="op">+</span> margin) <span class="op">*</span> <span class="dv">2</span><span class="op">,</span></span>
<span id="cb90-2767"><a href="#cb90-2767" aria-hidden="true" tabindex="-1"></a>    hourHandLength <span class="op">=</span> (<span class="dv">2</span> <span class="op">*</span> clockRadius) <span class="op">/</span> <span class="dv">3</span><span class="op">,</span></span>
<span id="cb90-2768"><a href="#cb90-2768" aria-hidden="true" tabindex="-1"></a>    minuteHandLength <span class="op">=</span> clockRadius<span class="op">,</span></span>
<span id="cb90-2769"><a href="#cb90-2769" aria-hidden="true" tabindex="-1"></a>    secondHandLength <span class="op">=</span> clockRadius <span class="op">-</span> <span class="dv">12</span><span class="op">,</span></span>
<span id="cb90-2770"><a href="#cb90-2770" aria-hidden="true" tabindex="-1"></a>    secondHandBalance <span class="op">=</span> <span class="dv">30</span><span class="op">,</span></span>
<span id="cb90-2771"><a href="#cb90-2771" aria-hidden="true" tabindex="-1"></a>    secondTickStart <span class="op">=</span> clockRadius<span class="op">,</span></span>
<span id="cb90-2772"><a href="#cb90-2772" aria-hidden="true" tabindex="-1"></a>    secondTickLength <span class="op">=</span> <span class="op">-</span><span class="dv">10</span><span class="op">,</span></span>
<span id="cb90-2773"><a href="#cb90-2773" aria-hidden="true" tabindex="-1"></a>    hourTickStart <span class="op">=</span> clockRadius<span class="op">,</span></span>
<span id="cb90-2774"><a href="#cb90-2774" aria-hidden="true" tabindex="-1"></a>    hourTickLength <span class="op">=</span> <span class="op">-</span><span class="dv">18</span><span class="op">,</span></span>
<span id="cb90-2775"><a href="#cb90-2775" aria-hidden="true" tabindex="-1"></a>    secondLabelRadius <span class="op">=</span> clockRadius <span class="op">+</span> <span class="dv">16</span><span class="op">,</span></span>
<span id="cb90-2776"><a href="#cb90-2776" aria-hidden="true" tabindex="-1"></a>    secondLabelYOffset <span class="op">=</span> <span class="dv">5</span><span class="op">,</span></span>
<span id="cb90-2777"><a href="#cb90-2777" aria-hidden="true" tabindex="-1"></a>    hourLabelRadius <span class="op">=</span> clockRadius <span class="op">-</span> <span class="dv">40</span><span class="op">,</span></span>
<span id="cb90-2778"><a href="#cb90-2778" aria-hidden="true" tabindex="-1"></a>    hourLabelYOffset <span class="op">=</span> <span class="dv">7</span><span class="op">,</span></span>
<span id="cb90-2779"><a href="#cb90-2779" aria-hidden="true" tabindex="-1"></a>    radians <span class="op">=</span> <span class="bu">Math</span><span class="op">.</span><span class="cn">PI</span> <span class="op">/</span> <span class="dv">180</span><span class="op">;</span></span>
<span id="cb90-2780"><a href="#cb90-2780" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> ten <span class="op">=</span> d3</span>
<span id="cb90-2781"><a href="#cb90-2781" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">scaleLinear</span>()</span>
<span id="cb90-2782"><a href="#cb90-2782" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">range</span>([<span class="dv">0</span><span class="op">,</span> <span class="dv">360</span>])</span>
<span id="cb90-2783"><a href="#cb90-2783" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">domain</span>([<span class="dv">0</span><span class="op">,</span> <span class="dv">10</span>])<span class="op">;</span></span>
<span id="cb90-2784"><a href="#cb90-2784" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> sto <span class="op">=</span> d3</span>
<span id="cb90-2785"><a href="#cb90-2785" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">scaleLinear</span>()</span>
<span id="cb90-2786"><a href="#cb90-2786" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">range</span>([<span class="dv">0</span><span class="op">,</span> <span class="dv">360</span>])</span>
<span id="cb90-2787"><a href="#cb90-2787" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">domain</span>([<span class="dv">0</span><span class="op">,</span> <span class="dv">100</span>])<span class="op">;</span></span>
<span id="cb90-2788"><a href="#cb90-2788" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> handData <span class="op">=</span> [</span>
<span id="cb90-2789"><a href="#cb90-2789" aria-hidden="true" tabindex="-1"></a>    {</span>
<span id="cb90-2790"><a href="#cb90-2790" aria-hidden="true" tabindex="-1"></a>      <span class="dt">type</span><span class="op">:</span> <span class="st">"hour"</span><span class="op">,</span></span>
<span id="cb90-2791"><a href="#cb90-2791" aria-hidden="true" tabindex="-1"></a>      <span class="dt">value</span><span class="op">:</span> <span class="dv">0</span><span class="op">,</span></span>
<span id="cb90-2792"><a href="#cb90-2792" aria-hidden="true" tabindex="-1"></a>      <span class="dt">length</span><span class="op">:</span> <span class="op">-</span>hourHandLength<span class="op">,</span></span>
<span id="cb90-2793"><a href="#cb90-2793" aria-hidden="true" tabindex="-1"></a>      <span class="dt">scale</span><span class="op">:</span> ten</span>
<span id="cb90-2794"><a href="#cb90-2794" aria-hidden="true" tabindex="-1"></a>    }<span class="op">,</span></span>
<span id="cb90-2795"><a href="#cb90-2795" aria-hidden="true" tabindex="-1"></a>    {</span>
<span id="cb90-2796"><a href="#cb90-2796" aria-hidden="true" tabindex="-1"></a>      <span class="dt">type</span><span class="op">:</span> <span class="st">"minute"</span><span class="op">,</span></span>
<span id="cb90-2797"><a href="#cb90-2797" aria-hidden="true" tabindex="-1"></a>      <span class="dt">value</span><span class="op">:</span> <span class="dv">0</span><span class="op">,</span></span>
<span id="cb90-2798"><a href="#cb90-2798" aria-hidden="true" tabindex="-1"></a>      <span class="dt">length</span><span class="op">:</span> <span class="op">-</span>minuteHandLength<span class="op">,</span></span>
<span id="cb90-2799"><a href="#cb90-2799" aria-hidden="true" tabindex="-1"></a>      <span class="dt">scale</span><span class="op">:</span> sto</span>
<span id="cb90-2800"><a href="#cb90-2800" aria-hidden="true" tabindex="-1"></a>    }<span class="op">,</span></span>
<span id="cb90-2801"><a href="#cb90-2801" aria-hidden="true" tabindex="-1"></a>    {</span>
<span id="cb90-2802"><a href="#cb90-2802" aria-hidden="true" tabindex="-1"></a>      <span class="dt">type</span><span class="op">:</span> <span class="st">"second"</span><span class="op">,</span></span>
<span id="cb90-2803"><a href="#cb90-2803" aria-hidden="true" tabindex="-1"></a>      <span class="dt">value</span><span class="op">:</span> <span class="dv">0</span><span class="op">,</span></span>
<span id="cb90-2804"><a href="#cb90-2804" aria-hidden="true" tabindex="-1"></a>      <span class="dt">length</span><span class="op">:</span> <span class="op">-</span>secondHandLength<span class="op">,</span></span>
<span id="cb90-2805"><a href="#cb90-2805" aria-hidden="true" tabindex="-1"></a>      <span class="dt">scale</span><span class="op">:</span> sto<span class="op">,</span></span>
<span id="cb90-2806"><a href="#cb90-2806" aria-hidden="true" tabindex="-1"></a>      <span class="dt">balance</span><span class="op">:</span> secondHandBalance</span>
<span id="cb90-2807"><a href="#cb90-2807" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb90-2808"><a href="#cb90-2808" aria-hidden="true" tabindex="-1"></a>  ]<span class="op">;</span></span>
<span id="cb90-2809"><a href="#cb90-2809" aria-hidden="true" tabindex="-1"></a>  <span class="kw">function</span> <span class="fu">drawClock</span>() {</span>
<span id="cb90-2810"><a href="#cb90-2810" aria-hidden="true" tabindex="-1"></a>    <span class="co">// create all the clock elements</span></span>
<span id="cb90-2811"><a href="#cb90-2811" aria-hidden="true" tabindex="-1"></a>    <span class="fu">updateData</span>()<span class="op">;</span> <span class="co">//draw them in the correct starting position</span></span>
<span id="cb90-2812"><a href="#cb90-2812" aria-hidden="true" tabindex="-1"></a>    <span class="kw">const</span> face <span class="op">=</span> svg</span>
<span id="cb90-2813"><a href="#cb90-2813" aria-hidden="true" tabindex="-1"></a>      <span class="op">.</span><span class="fu">append</span>(<span class="st">"g"</span>)</span>
<span id="cb90-2814"><a href="#cb90-2814" aria-hidden="true" tabindex="-1"></a>      <span class="op">.</span><span class="fu">attr</span>(<span class="st">"id"</span><span class="op">,</span> <span class="st">"clock-face"</span>)</span>
<span id="cb90-2815"><a href="#cb90-2815" aria-hidden="true" tabindex="-1"></a>      <span class="op">.</span><span class="fu">attr</span>(<span class="st">"transform"</span><span class="op">,</span> <span class="vs">`translate(</span><span class="sc">${</span>[w <span class="op">/</span> <span class="dv">2</span><span class="op">,</span> h <span class="op">/</span> <span class="dv">2</span>]<span class="sc">}</span><span class="vs">)`</span>)<span class="op">;</span></span>
<span id="cb90-2816"><a href="#cb90-2816" aria-hidden="true" tabindex="-1"></a>    <span class="co">// add marks for seconds</span></span>
<span id="cb90-2817"><a href="#cb90-2817" aria-hidden="true" tabindex="-1"></a>    face</span>
<span id="cb90-2818"><a href="#cb90-2818" aria-hidden="true" tabindex="-1"></a>      <span class="op">.</span><span class="fu">selectAll</span>(<span class="st">".second-tick"</span>)</span>
<span id="cb90-2819"><a href="#cb90-2819" aria-hidden="true" tabindex="-1"></a>      <span class="op">.</span><span class="fu">data</span>(d3<span class="op">.</span><span class="fu">range</span>(<span class="dv">0</span><span class="op">,</span> <span class="dv">100</span>))</span>
<span id="cb90-2820"><a href="#cb90-2820" aria-hidden="true" tabindex="-1"></a>      <span class="op">.</span><span class="fu">enter</span>()</span>
<span id="cb90-2821"><a href="#cb90-2821" aria-hidden="true" tabindex="-1"></a>      <span class="op">.</span><span class="fu">append</span>(<span class="st">"line"</span>)</span>
<span id="cb90-2822"><a href="#cb90-2822" aria-hidden="true" tabindex="-1"></a>      <span class="op">.</span><span class="fu">attr</span>(<span class="st">"class"</span><span class="op">,</span> <span class="st">"second-tick"</span>)</span>
<span id="cb90-2823"><a href="#cb90-2823" aria-hidden="true" tabindex="-1"></a>      <span class="op">.</span><span class="fu">attr</span>(<span class="st">"x1"</span><span class="op">,</span> <span class="dv">0</span>)</span>
<span id="cb90-2824"><a href="#cb90-2824" aria-hidden="true" tabindex="-1"></a>      <span class="op">.</span><span class="fu">attr</span>(<span class="st">"x2"</span><span class="op">,</span> <span class="dv">0</span>)</span>
<span id="cb90-2825"><a href="#cb90-2825" aria-hidden="true" tabindex="-1"></a>      <span class="op">.</span><span class="fu">attr</span>(<span class="st">"y1"</span><span class="op">,</span> secondTickStart)</span>
<span id="cb90-2826"><a href="#cb90-2826" aria-hidden="true" tabindex="-1"></a>      <span class="op">.</span><span class="fu">attr</span>(<span class="st">"y2"</span><span class="op">,</span> secondTickStart <span class="op">+</span> secondTickLength)</span>
<span id="cb90-2827"><a href="#cb90-2827" aria-hidden="true" tabindex="-1"></a>      <span class="op">.</span><span class="fu">attr</span>(<span class="st">"transform"</span><span class="op">,</span> d <span class="kw">=&gt;</span> <span class="vs">`rotate(</span><span class="sc">${</span><span class="fu">sto</span>(d)<span class="sc">}</span><span class="vs">)`</span>)<span class="op">;</span></span>
<span id="cb90-2828"><a href="#cb90-2828" aria-hidden="true" tabindex="-1"></a>    <span class="co">// and labels...</span></span>
<span id="cb90-2829"><a href="#cb90-2829" aria-hidden="true" tabindex="-1"></a>    face</span>
<span id="cb90-2830"><a href="#cb90-2830" aria-hidden="true" tabindex="-1"></a>      <span class="op">.</span><span class="fu">selectAll</span>(<span class="st">".second-label"</span>)</span>
<span id="cb90-2831"><a href="#cb90-2831" aria-hidden="true" tabindex="-1"></a>      <span class="op">.</span><span class="fu">data</span>(d3<span class="op">.</span><span class="fu">range</span>(<span class="dv">0</span><span class="op">,</span> <span class="dv">100</span><span class="op">,</span> <span class="dv">5</span>))</span>
<span id="cb90-2832"><a href="#cb90-2832" aria-hidden="true" tabindex="-1"></a>      <span class="op">.</span><span class="fu">enter</span>()</span>
<span id="cb90-2833"><a href="#cb90-2833" aria-hidden="true" tabindex="-1"></a>      <span class="op">.</span><span class="fu">append</span>(<span class="st">"text"</span>)</span>
<span id="cb90-2834"><a href="#cb90-2834" aria-hidden="true" tabindex="-1"></a>      <span class="op">.</span><span class="fu">attr</span>(<span class="st">"class"</span><span class="op">,</span> <span class="st">"second-label"</span>)</span>
<span id="cb90-2835"><a href="#cb90-2835" aria-hidden="true" tabindex="-1"></a>      <span class="op">.</span><span class="fu">attr</span>(<span class="st">"text-anchor"</span><span class="op">,</span> <span class="st">"middle"</span>)</span>
<span id="cb90-2836"><a href="#cb90-2836" aria-hidden="true" tabindex="-1"></a>      <span class="op">.</span><span class="fu">attr</span>(<span class="st">"x"</span><span class="op">,</span> d <span class="kw">=&gt;</span> secondLabelRadius <span class="op">*</span> <span class="bu">Math</span><span class="op">.</span><span class="fu">sin</span>(<span class="fu">sto</span>(d) <span class="op">*</span> radians))</span>
<span id="cb90-2837"><a href="#cb90-2837" aria-hidden="true" tabindex="-1"></a>      <span class="op">.</span><span class="fu">attr</span>(</span>
<span id="cb90-2838"><a href="#cb90-2838" aria-hidden="true" tabindex="-1"></a>        <span class="st">"y"</span><span class="op">,</span></span>
<span id="cb90-2839"><a href="#cb90-2839" aria-hidden="true" tabindex="-1"></a>        d <span class="kw">=&gt;</span></span>
<span id="cb90-2840"><a href="#cb90-2840" aria-hidden="true" tabindex="-1"></a>          <span class="op">-</span>secondLabelRadius <span class="op">*</span> <span class="bu">Math</span><span class="op">.</span><span class="fu">cos</span>(<span class="fu">sto</span>(d) <span class="op">*</span> radians) <span class="op">+</span> secondLabelYOffset</span>
<span id="cb90-2841"><a href="#cb90-2841" aria-hidden="true" tabindex="-1"></a>      )</span>
<span id="cb90-2842"><a href="#cb90-2842" aria-hidden="true" tabindex="-1"></a>      <span class="op">.</span><span class="fu">text</span>(d <span class="kw">=&gt;</span> d)<span class="op">;</span></span>
<span id="cb90-2843"><a href="#cb90-2843" aria-hidden="true" tabindex="-1"></a>    <span class="co">// ... and hours</span></span>
<span id="cb90-2844"><a href="#cb90-2844" aria-hidden="true" tabindex="-1"></a>    face</span>
<span id="cb90-2845"><a href="#cb90-2845" aria-hidden="true" tabindex="-1"></a>      <span class="op">.</span><span class="fu">selectAll</span>(<span class="st">".hour-tick"</span>)</span>
<span id="cb90-2846"><a href="#cb90-2846" aria-hidden="true" tabindex="-1"></a>      <span class="op">.</span><span class="fu">data</span>(d3<span class="op">.</span><span class="fu">range</span>(<span class="dv">0</span><span class="op">,</span> <span class="dv">10</span><span class="op">,</span> <span class="dv">1</span>))</span>
<span id="cb90-2847"><a href="#cb90-2847" aria-hidden="true" tabindex="-1"></a>      <span class="op">.</span><span class="fu">enter</span>()</span>
<span id="cb90-2848"><a href="#cb90-2848" aria-hidden="true" tabindex="-1"></a>      <span class="op">.</span><span class="fu">append</span>(<span class="st">"line"</span>)</span>
<span id="cb90-2849"><a href="#cb90-2849" aria-hidden="true" tabindex="-1"></a>      <span class="op">.</span><span class="fu">attr</span>(<span class="st">"class"</span><span class="op">,</span> <span class="st">"hour-tick"</span>)</span>
<span id="cb90-2850"><a href="#cb90-2850" aria-hidden="true" tabindex="-1"></a>      <span class="op">.</span><span class="fu">attr</span>(<span class="st">"x1"</span><span class="op">,</span> <span class="dv">0</span>)</span>
<span id="cb90-2851"><a href="#cb90-2851" aria-hidden="true" tabindex="-1"></a>      <span class="op">.</span><span class="fu">attr</span>(<span class="st">"x2"</span><span class="op">,</span> <span class="dv">0</span>)</span>
<span id="cb90-2852"><a href="#cb90-2852" aria-hidden="true" tabindex="-1"></a>      <span class="op">.</span><span class="fu">attr</span>(<span class="st">"y1"</span><span class="op">,</span> hourTickStart)</span>
<span id="cb90-2853"><a href="#cb90-2853" aria-hidden="true" tabindex="-1"></a>      <span class="op">.</span><span class="fu">attr</span>(<span class="st">"y2"</span><span class="op">,</span> hourTickStart <span class="op">+</span> hourTickLength)</span>
<span id="cb90-2854"><a href="#cb90-2854" aria-hidden="true" tabindex="-1"></a>      <span class="op">.</span><span class="fu">attr</span>(<span class="st">"transform"</span><span class="op">,</span> d <span class="kw">=&gt;</span> <span class="vs">`rotate(</span><span class="sc">${</span><span class="fu">ten</span>(d)<span class="sc">}</span><span class="vs">)`</span>)<span class="op">;</span></span>
<span id="cb90-2855"><a href="#cb90-2855" aria-hidden="true" tabindex="-1"></a>    face</span>
<span id="cb90-2856"><a href="#cb90-2856" aria-hidden="true" tabindex="-1"></a>      <span class="op">.</span><span class="fu">selectAll</span>(<span class="st">".hour-label"</span>)</span>
<span id="cb90-2857"><a href="#cb90-2857" aria-hidden="true" tabindex="-1"></a>      <span class="op">.</span><span class="fu">data</span>(d3<span class="op">.</span><span class="fu">range</span>(<span class="dv">0</span><span class="op">,</span> <span class="dv">10</span><span class="op">,</span> <span class="dv">1</span>))</span>
<span id="cb90-2858"><a href="#cb90-2858" aria-hidden="true" tabindex="-1"></a>      <span class="op">.</span><span class="fu">enter</span>()</span>
<span id="cb90-2859"><a href="#cb90-2859" aria-hidden="true" tabindex="-1"></a>      <span class="op">.</span><span class="fu">append</span>(<span class="st">"text"</span>)</span>
<span id="cb90-2860"><a href="#cb90-2860" aria-hidden="true" tabindex="-1"></a>      <span class="op">.</span><span class="fu">attr</span>(<span class="st">"class"</span><span class="op">,</span> <span class="st">"hour-label"</span>)</span>
<span id="cb90-2861"><a href="#cb90-2861" aria-hidden="true" tabindex="-1"></a>      <span class="op">.</span><span class="fu">attr</span>(<span class="st">"text-anchor"</span><span class="op">,</span> <span class="st">"middle"</span>)</span>
<span id="cb90-2862"><a href="#cb90-2862" aria-hidden="true" tabindex="-1"></a>      <span class="op">.</span><span class="fu">attr</span>(<span class="st">"x"</span><span class="op">,</span> d <span class="kw">=&gt;</span> hourLabelRadius <span class="op">*</span> <span class="bu">Math</span><span class="op">.</span><span class="fu">sin</span>(<span class="fu">ten</span>(d) <span class="op">*</span> radians))</span>
<span id="cb90-2863"><a href="#cb90-2863" aria-hidden="true" tabindex="-1"></a>      <span class="op">.</span><span class="fu">attr</span>(</span>
<span id="cb90-2864"><a href="#cb90-2864" aria-hidden="true" tabindex="-1"></a>        <span class="st">"y"</span><span class="op">,</span></span>
<span id="cb90-2865"><a href="#cb90-2865" aria-hidden="true" tabindex="-1"></a>        d <span class="kw">=&gt;</span> <span class="op">-</span>hourLabelRadius <span class="op">*</span> <span class="bu">Math</span><span class="op">.</span><span class="fu">cos</span>(<span class="fu">ten</span>(d) <span class="op">*</span> radians) <span class="op">+</span> hourLabelYOffset</span>
<span id="cb90-2866"><a href="#cb90-2866" aria-hidden="true" tabindex="-1"></a>      )</span>
<span id="cb90-2867"><a href="#cb90-2867" aria-hidden="true" tabindex="-1"></a>      <span class="op">.</span><span class="fu">text</span>(d <span class="kw">=&gt;</span> d)<span class="op">;</span></span>
<span id="cb90-2868"><a href="#cb90-2868" aria-hidden="true" tabindex="-1"></a>    <span class="kw">const</span> hands <span class="op">=</span> face<span class="op">.</span><span class="fu">append</span>(<span class="st">"g"</span>)<span class="op">.</span><span class="fu">attr</span>(<span class="st">"id"</span><span class="op">,</span> <span class="st">"clock-hands"</span>)<span class="op">;</span></span>
<span id="cb90-2869"><a href="#cb90-2869" aria-hidden="true" tabindex="-1"></a>    hands</span>
<span id="cb90-2870"><a href="#cb90-2870" aria-hidden="true" tabindex="-1"></a>      <span class="op">.</span><span class="fu">selectAll</span>(<span class="st">"line"</span>)</span>
<span id="cb90-2871"><a href="#cb90-2871" aria-hidden="true" tabindex="-1"></a>      <span class="op">.</span><span class="fu">data</span>(handData)</span>
<span id="cb90-2872"><a href="#cb90-2872" aria-hidden="true" tabindex="-1"></a>      <span class="op">.</span><span class="fu">enter</span>()</span>
<span id="cb90-2873"><a href="#cb90-2873" aria-hidden="true" tabindex="-1"></a>      <span class="op">.</span><span class="fu">append</span>(<span class="st">"line"</span>)</span>
<span id="cb90-2874"><a href="#cb90-2874" aria-hidden="true" tabindex="-1"></a>      <span class="op">.</span><span class="fu">attr</span>(<span class="st">"class"</span><span class="op">,</span> d <span class="kw">=&gt;</span> d<span class="op">.</span><span class="at">type</span> <span class="op">+</span> <span class="st">"-hand"</span>)</span>
<span id="cb90-2875"><a href="#cb90-2875" aria-hidden="true" tabindex="-1"></a>      <span class="op">.</span><span class="fu">attr</span>(<span class="st">"x1"</span><span class="op">,</span> <span class="dv">0</span>)</span>
<span id="cb90-2876"><a href="#cb90-2876" aria-hidden="true" tabindex="-1"></a>      <span class="op">.</span><span class="fu">attr</span>(<span class="st">"y1"</span><span class="op">,</span> d <span class="kw">=&gt;</span> d<span class="op">.</span><span class="at">balance</span> <span class="op">||</span> <span class="dv">0</span>)</span>
<span id="cb90-2877"><a href="#cb90-2877" aria-hidden="true" tabindex="-1"></a>      <span class="op">.</span><span class="fu">attr</span>(<span class="st">"x2"</span><span class="op">,</span> <span class="dv">0</span>)</span>
<span id="cb90-2878"><a href="#cb90-2878" aria-hidden="true" tabindex="-1"></a>      <span class="op">.</span><span class="fu">attr</span>(<span class="st">"y2"</span><span class="op">,</span> d <span class="kw">=&gt;</span> d<span class="op">.</span><span class="at">length</span>)</span>
<span id="cb90-2879"><a href="#cb90-2879" aria-hidden="true" tabindex="-1"></a>      <span class="op">.</span><span class="fu">attr</span>(<span class="st">"transform"</span><span class="op">,</span> d <span class="kw">=&gt;</span> <span class="vs">`rotate(</span><span class="sc">${</span>d<span class="op">.</span><span class="fu">scale</span>(d<span class="op">.</span><span class="at">value</span>)<span class="sc">}</span><span class="vs">)`</span>)<span class="op">;</span></span>
<span id="cb90-2880"><a href="#cb90-2880" aria-hidden="true" tabindex="-1"></a>    face</span>
<span id="cb90-2881"><a href="#cb90-2881" aria-hidden="true" tabindex="-1"></a>      <span class="op">.</span><span class="fu">append</span>(<span class="st">"g"</span>)</span>
<span id="cb90-2882"><a href="#cb90-2882" aria-hidden="true" tabindex="-1"></a>      <span class="op">.</span><span class="fu">attr</span>(<span class="st">"id"</span><span class="op">,</span> <span class="st">"face-overlay"</span>)</span>
<span id="cb90-2883"><a href="#cb90-2883" aria-hidden="true" tabindex="-1"></a>      <span class="op">.</span><span class="fu">append</span>(<span class="st">"circle"</span>)</span>
<span id="cb90-2884"><a href="#cb90-2884" aria-hidden="true" tabindex="-1"></a>      <span class="op">.</span><span class="fu">attr</span>(<span class="st">"class"</span><span class="op">,</span> <span class="st">"hands-cover"</span>)</span>
<span id="cb90-2885"><a href="#cb90-2885" aria-hidden="true" tabindex="-1"></a>      <span class="op">.</span><span class="fu">attr</span>(<span class="st">"x"</span><span class="op">,</span> <span class="dv">0</span>)</span>
<span id="cb90-2886"><a href="#cb90-2886" aria-hidden="true" tabindex="-1"></a>      <span class="op">.</span><span class="fu">attr</span>(<span class="st">"y"</span><span class="op">,</span> <span class="dv">0</span>)</span>
<span id="cb90-2887"><a href="#cb90-2887" aria-hidden="true" tabindex="-1"></a>      <span class="op">.</span><span class="fu">attr</span>(<span class="st">"r"</span><span class="op">,</span> clockRadius <span class="op">/</span> <span class="dv">20</span>)<span class="op">;</span></span>
<span id="cb90-2888"><a href="#cb90-2888" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb90-2889"><a href="#cb90-2889" aria-hidden="true" tabindex="-1"></a>  <span class="kw">function</span> <span class="fu">moveHands</span>() {</span>
<span id="cb90-2890"><a href="#cb90-2890" aria-hidden="true" tabindex="-1"></a>    <span class="kw">const</span> sel <span class="op">=</span> d3</span>
<span id="cb90-2891"><a href="#cb90-2891" aria-hidden="true" tabindex="-1"></a>      <span class="op">.</span><span class="fu">select</span>(<span class="st">"#clock-hands-final"</span>)</span>
<span id="cb90-2892"><a href="#cb90-2892" aria-hidden="true" tabindex="-1"></a>      <span class="op">.</span><span class="fu">selectAll</span>(<span class="st">"line"</span>)</span>
<span id="cb90-2893"><a href="#cb90-2893" aria-hidden="true" tabindex="-1"></a>      <span class="op">.</span><span class="fu">data</span>(handData)</span>
<span id="cb90-2894"><a href="#cb90-2894" aria-hidden="true" tabindex="-1"></a>      <span class="op">.</span><span class="fu">transition</span>()<span class="op">;</span></span>
<span id="cb90-2895"><a href="#cb90-2895" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> (fancySecondsOFF) sel<span class="op">.</span><span class="fu">ease</span>(d3<span class="op">.</span><span class="at">easeElastic</span><span class="op">.</span><span class="fu">period</span>(<span class="fl">0.5</span>))<span class="op">;</span></span>
<span id="cb90-2896"><a href="#cb90-2896" aria-hidden="true" tabindex="-1"></a>    sel<span class="op">.</span><span class="fu">attr</span>(<span class="st">"transform"</span><span class="op">,</span> d <span class="kw">=&gt;</span> <span class="vs">`rotate(</span><span class="sc">${</span>d<span class="op">.</span><span class="fu">scale</span>(d<span class="op">.</span><span class="at">value</span>)<span class="sc">}</span><span class="vs">)`</span>)<span class="op">;</span></span>
<span id="cb90-2897"><a href="#cb90-2897" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb90-2898"><a href="#cb90-2898" aria-hidden="true" tabindex="-1"></a>  <span class="kw">function</span> <span class="fu">updateData</span>() {</span>
<span id="cb90-2899"><a href="#cb90-2899" aria-hidden="true" tabindex="-1"></a>    handData[<span class="dv">0</span>]<span class="op">.</span><span class="at">value</span> <span class="op">=</span> <span class="op">!</span>fancySecondsOFF <span class="op">?</span> <span class="bu">Math</span><span class="op">.</span><span class="fu">floor</span>(selectedExactN <span class="op">*</span> <span class="dv">10</span>) <span class="op">:</span> decTimeN[<span class="dv">0</span>]<span class="op">;</span></span>
<span id="cb90-2900"><a href="#cb90-2900" aria-hidden="true" tabindex="-1"></a>    handData[<span class="dv">1</span>]<span class="op">.</span><span class="at">value</span> <span class="op">=</span> <span class="op">!</span>fancySecondsOFF <span class="op">?</span> <span class="bu">Math</span><span class="op">.</span><span class="fu">floor</span>(selectedExactN <span class="op">*</span> <span class="dv">10</span> <span class="op">%</span> <span class="dv">1</span> <span class="op">*</span> <span class="dv">100</span>) <span class="op">:</span> decTimeN<span class="op">.</span><span class="fu">slice</span>(<span class="dv">2</span><span class="op">,</span> <span class="dv">4</span>)<span class="op">;</span></span>
<span id="cb90-2901"><a href="#cb90-2901" aria-hidden="true" tabindex="-1"></a>    handData[<span class="dv">2</span>]<span class="op">.</span><span class="at">value</span> <span class="op">=</span> <span class="op">!</span>fancySecondsOFF <span class="op">?</span> selectedExactN <span class="op">*</span> <span class="dv">10</span> <span class="op">%</span> <span class="dv">1</span> <span class="op">*</span> <span class="dv">100</span> <span class="op">%</span> <span class="dv">1</span> <span class="op">*</span> <span class="dv">100</span> <span class="op">:</span> decTimeN<span class="op">.</span><span class="fu">slice</span>(<span class="dv">4</span><span class="op">,</span> <span class="dv">6</span>)<span class="op">;</span></span>
<span id="cb90-2902"><a href="#cb90-2902" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb90-2903"><a href="#cb90-2903" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> svg <span class="op">=</span> d3</span>
<span id="cb90-2904"><a href="#cb90-2904" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">create</span>(<span class="st">"svg"</span>)</span>
<span id="cb90-2905"><a href="#cb90-2905" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">"viewBox"</span><span class="op">,</span> [<span class="dv">0</span><span class="op">,</span> <span class="dv">0</span><span class="op">,</span> w<span class="op">,</span> h])</span>
<span id="cb90-2906"><a href="#cb90-2906" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">style</span>(<span class="st">"max-width"</span><span class="op">,</span> <span class="vs">`</span><span class="sc">${</span>width <span class="op">/</span> <span class="fl">2.1</span><span class="sc">}</span><span class="vs">px`</span>)</span>
<span id="cb90-2907"><a href="#cb90-2907" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">"class"</span><span class="op">,</span> <span class="st">"analogclock"</span>)</span>
<span id="cb90-2908"><a href="#cb90-2908" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">"id"</span><span class="op">,</span> <span class="st">"midclock"</span>)<span class="op">;</span></span>
<span id="cb90-2909"><a href="#cb90-2909" aria-hidden="true" tabindex="-1"></a>  svg</span>
<span id="cb90-2910"><a href="#cb90-2910" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">append</span>(<span class="st">"text"</span>)</span>
<span id="cb90-2911"><a href="#cb90-2911" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">text</span>(<span class="vs">`-</span><span class="sc">${</span>decTimeN<span class="sc">}</span><span class="vs">-</span><span class="sc">${</span>selectedZone<span class="sc">}</span><span class="vs">`</span>)</span>
<span id="cb90-2912"><a href="#cb90-2912" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">"x"</span><span class="op">,</span> clockRadius <span class="op">+</span> margin)</span>
<span id="cb90-2913"><a href="#cb90-2913" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">"y"</span><span class="op">,</span> clockRadius <span class="op">*</span> <span class="dv">2</span> <span class="op">+</span> margin <span class="op">*</span> <span class="fl">2.1</span>)</span>
<span id="cb90-2914"><a href="#cb90-2914" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">"text-anchor"</span><span class="op">,</span> <span class="st">"middle"</span>)</span>
<span id="cb90-2915"><a href="#cb90-2915" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">"font-size"</span><span class="op">,</span> <span class="dv">32</span>)</span>
<span id="cb90-2916"><a href="#cb90-2916" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">"font-family"</span><span class="op">,</span> <span class="st">"monospace"</span>)<span class="op">;</span></span>
<span id="cb90-2917"><a href="#cb90-2917" aria-hidden="true" tabindex="-1"></a>  <span class="fu">drawClock</span>()<span class="op">;</span></span>
<span id="cb90-2918"><a href="#cb90-2918" aria-hidden="true" tabindex="-1"></a>  <span class="co">// Animation</span></span>
<span id="cb90-2919"><a href="#cb90-2919" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> interval <span class="op">=</span> <span class="pp">setInterval</span>(</span>
<span id="cb90-2920"><a href="#cb90-2920" aria-hidden="true" tabindex="-1"></a>    () <span class="kw">=&gt;</span> {</span>
<span id="cb90-2921"><a href="#cb90-2921" aria-hidden="true" tabindex="-1"></a>      <span class="fu">updateData</span>()<span class="op">;</span></span>
<span id="cb90-2922"><a href="#cb90-2922" aria-hidden="true" tabindex="-1"></a>      <span class="fu">moveHands</span>()<span class="op">;</span></span>
<span id="cb90-2923"><a href="#cb90-2923" aria-hidden="true" tabindex="-1"></a>    }<span class="op">,</span></span>
<span id="cb90-2924"><a href="#cb90-2924" aria-hidden="true" tabindex="-1"></a>    <span class="op">!</span>fancySecondsOFF <span class="op">?</span> <span class="dv">10</span> <span class="op">:</span> <span class="dv">864</span></span>
<span id="cb90-2925"><a href="#cb90-2925" aria-hidden="true" tabindex="-1"></a>  )<span class="op">;</span></span>
<span id="cb90-2926"><a href="#cb90-2926" aria-hidden="true" tabindex="-1"></a>  invalidation<span class="op">.</span><span class="fu">then</span>(() <span class="kw">=&gt;</span> <span class="pp">clearInterval</span>(interval))<span class="op">;</span></span>
<span id="cb90-2927"><a href="#cb90-2927" aria-hidden="true" tabindex="-1"></a>  <span class="cf">return</span> svg<span class="op">.</span><span class="fu">node</span>()<span class="op">;</span></span>
<span id="cb90-2928"><a href="#cb90-2928" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb90-2929"><a href="#cb90-2929" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb90-2930"><a href="#cb90-2930" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb90-2933"><a href="#cb90-2933" aria-hidden="true" tabindex="-1"></a><span class="in">```{ojs}</span></span>
<span id="cb90-2934"><a href="#cb90-2934" aria-hidden="true" tabindex="-1"></a><span class="co">//| echo: false</span></span>
<span id="cb90-2935"><a href="#cb90-2935" aria-hidden="true" tabindex="-1"></a><span class="co">//| output: false</span></span>
<span id="cb90-2936"><a href="#cb90-2936" aria-hidden="true" tabindex="-1"></a><span class="co">//| class: clock</span></span>
<span id="cb90-2937"><a href="#cb90-2937" aria-hidden="true" tabindex="-1"></a><span class="co">//| label: sunclock</span></span>
<span id="cb90-2938"><a href="#cb90-2938" aria-hidden="true" tabindex="-1"></a><span class="co">// https://observablehq.com/@ldgrp/apple-watch-solar-dial-simulation</span></span>
<span id="cb90-2939"><a href="#cb90-2939" aria-hidden="true" tabindex="-1"></a>sunclock <span class="op">=</span> {</span>
<span id="cb90-2940"><a href="#cb90-2940" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> radius <span class="op">=</span> <span class="dv">200</span><span class="op">;</span></span>
<span id="cb90-2941"><a href="#cb90-2941" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> width <span class="op">=</span> radius <span class="op">*</span> <span class="dv">2</span><span class="op">;</span></span>
<span id="cb90-2942"><a href="#cb90-2942" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> height <span class="op">=</span> radius <span class="op">*</span> <span class="dv">2</span><span class="op">;</span></span>
<span id="cb90-2943"><a href="#cb90-2943" aria-hidden="true" tabindex="-1"></a>  <span class="co">//let _minutes = 0;</span></span>
<span id="cb90-2944"><a href="#cb90-2944" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> svg <span class="op">=</span> d3</span>
<span id="cb90-2945"><a href="#cb90-2945" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">create</span>(<span class="st">"svg"</span>)</span>
<span id="cb90-2946"><a href="#cb90-2946" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">"id"</span><span class="op">,</span> <span class="st">"btmclock"</span>)</span>
<span id="cb90-2947"><a href="#cb90-2947" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">"viewBox"</span><span class="op">,</span> [<span class="dv">0</span><span class="op">,</span> <span class="dv">0</span><span class="op">,</span> width<span class="op">,</span> height])</span>
<span id="cb90-2948"><a href="#cb90-2948" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">style</span>(<span class="st">"margin-top"</span><span class="op">,</span> <span class="st">"1px"</span>)</span>
<span id="cb90-2949"><a href="#cb90-2949" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">style</span>(<span class="st">"max-width"</span><span class="op">,</span> <span class="st">"200px"</span>)<span class="op">;</span></span>
<span id="cb90-2950"><a href="#cb90-2950" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> face <span class="op">=</span> svg</span>
<span id="cb90-2951"><a href="#cb90-2951" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">append</span>(<span class="st">"g"</span>)</span>
<span id="cb90-2952"><a href="#cb90-2952" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">"transform"</span><span class="op">,</span> <span class="vs">`translate(</span><span class="sc">${</span>width <span class="op">/</span> <span class="dv">2</span><span class="sc">}</span><span class="vs">, </span><span class="sc">${</span>height <span class="op">/</span> <span class="dv">2</span><span class="sc">}</span><span class="vs">)`</span>)<span class="op">;</span></span>
<span id="cb90-2953"><a href="#cb90-2953" aria-hidden="true" tabindex="-1"></a>  <span class="cf">for</span> (<span class="kw">const</span> angle <span class="kw">of</span> angles) {</span>
<span id="cb90-2954"><a href="#cb90-2954" aria-hidden="true" tabindex="-1"></a>    <span class="kw">const</span> arc <span class="op">=</span> d3</span>
<span id="cb90-2955"><a href="#cb90-2955" aria-hidden="true" tabindex="-1"></a>      <span class="op">.</span><span class="fu">arc</span>()</span>
<span id="cb90-2956"><a href="#cb90-2956" aria-hidden="true" tabindex="-1"></a>      <span class="op">.</span><span class="fu">innerRadius</span>(<span class="dv">0</span>)</span>
<span id="cb90-2957"><a href="#cb90-2957" aria-hidden="true" tabindex="-1"></a>      <span class="op">.</span><span class="fu">outerRadius</span>(radius)</span>
<span id="cb90-2958"><a href="#cb90-2958" aria-hidden="true" tabindex="-1"></a>      <span class="op">.</span><span class="fu">startAngle</span>(angle<span class="op">.</span><span class="at">start</span>)</span>
<span id="cb90-2959"><a href="#cb90-2959" aria-hidden="true" tabindex="-1"></a>      <span class="op">.</span><span class="fu">endAngle</span>(angle<span class="op">.</span><span class="at">end</span>)<span class="op">;</span></span>
<span id="cb90-2960"><a href="#cb90-2960" aria-hidden="true" tabindex="-1"></a>    face<span class="op">.</span><span class="fu">append</span>(<span class="st">"path"</span>)<span class="op">.</span><span class="fu">attr</span>(<span class="st">"d"</span><span class="op">,</span> arc)<span class="op">.</span><span class="fu">attr</span>(<span class="st">"fill"</span><span class="op">,</span> angle<span class="op">.</span><span class="at">color</span>)<span class="op">;</span></span>
<span id="cb90-2961"><a href="#cb90-2961" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb90-2962"><a href="#cb90-2962" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> sun <span class="op">=</span> face</span>
<span id="cb90-2963"><a href="#cb90-2963" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">append</span>(<span class="st">"circle"</span>)</span>
<span id="cb90-2964"><a href="#cb90-2964" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">"r"</span><span class="op">,</span> <span class="dv">15</span>)</span>
<span id="cb90-2965"><a href="#cb90-2965" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">"cx"</span><span class="op">,</span> <span class="dv">125</span> <span class="op">*</span> <span class="op">-</span><span class="fu">sin</span>(astDegMapPlot))</span>
<span id="cb90-2966"><a href="#cb90-2966" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">"cy"</span><span class="op">,</span> <span class="dv">125</span> <span class="op">*</span> <span class="fu">cos</span>(astDegMapPlot))</span>
<span id="cb90-2967"><a href="#cb90-2967" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">style</span>(<span class="st">"fill"</span><span class="op">,</span> <span class="st">"white"</span>)<span class="op">;</span></span>
<span id="cb90-2968"><a href="#cb90-2968" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> ringContainer <span class="op">=</span> svg</span>
<span id="cb90-2969"><a href="#cb90-2969" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">append</span>(<span class="st">"g"</span>)</span>
<span id="cb90-2970"><a href="#cb90-2970" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">"transform"</span><span class="op">,</span> <span class="vs">`translate(</span><span class="sc">${</span>width <span class="op">/</span> <span class="dv">2</span><span class="sc">}</span><span class="vs">, </span><span class="sc">${</span>height <span class="op">/</span> <span class="dv">2</span><span class="sc">}</span><span class="vs">)`</span>)<span class="op">;</span></span>
<span id="cb90-2971"><a href="#cb90-2971" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> ring <span class="op">=</span> ringContainer</span>
<span id="cb90-2972"><a href="#cb90-2972" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">append</span>(<span class="st">"circle"</span>)</span>
<span id="cb90-2973"><a href="#cb90-2973" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">"r"</span><span class="op">,</span> <span class="dv">125</span>)</span>
<span id="cb90-2974"><a href="#cb90-2974" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">style</span>(<span class="st">"opacity"</span><span class="op">,</span> <span class="fl">0.2</span>)</span>
<span id="cb90-2975"><a href="#cb90-2975" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">style</span>(<span class="st">"fill"</span><span class="op">,</span> <span class="st">"transparent"</span>)</span>
<span id="cb90-2976"><a href="#cb90-2976" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">style</span>(<span class="st">"stroke"</span><span class="op">,</span> <span class="st">"white"</span>)</span>
<span id="cb90-2977"><a href="#cb90-2977" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">style</span>(<span class="st">"stroke-width"</span><span class="op">,</span> <span class="dv">3</span>)<span class="op">;</span></span>
<span id="cb90-2978"><a href="#cb90-2978" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> events <span class="op">=</span> [</span>
<span id="cb90-2979"><a href="#cb90-2979" aria-hidden="true" tabindex="-1"></a>    data<span class="op">.</span><span class="at">astronomicalSunrise</span><span class="op">,</span></span>
<span id="cb90-2980"><a href="#cb90-2980" aria-hidden="true" tabindex="-1"></a>    data<span class="op">.</span><span class="at">astronomicalSunset</span><span class="op">,</span></span>
<span id="cb90-2981"><a href="#cb90-2981" aria-hidden="true" tabindex="-1"></a>    data<span class="op">.</span><span class="at">nauticalSunrise</span><span class="op">,</span></span>
<span id="cb90-2982"><a href="#cb90-2982" aria-hidden="true" tabindex="-1"></a>    data<span class="op">.</span><span class="at">nauticalSunset</span><span class="op">,</span></span>
<span id="cb90-2983"><a href="#cb90-2983" aria-hidden="true" tabindex="-1"></a>    data<span class="op">.</span><span class="at">civilSunrise</span><span class="op">,</span></span>
<span id="cb90-2984"><a href="#cb90-2984" aria-hidden="true" tabindex="-1"></a>    data<span class="op">.</span><span class="at">civilSunset</span><span class="op">,</span></span>
<span id="cb90-2985"><a href="#cb90-2985" aria-hidden="true" tabindex="-1"></a>    data<span class="op">.</span><span class="at">sunrise</span><span class="op">,</span></span>
<span id="cb90-2986"><a href="#cb90-2986" aria-hidden="true" tabindex="-1"></a>    data<span class="op">.</span><span class="at">sunset</span><span class="op">,</span></span>
<span id="cb90-2987"><a href="#cb90-2987" aria-hidden="true" tabindex="-1"></a>    data<span class="op">.</span><span class="at">solarNoon</span></span>
<span id="cb90-2988"><a href="#cb90-2988" aria-hidden="true" tabindex="-1"></a>  ]<span class="op">;</span></span>
<span id="cb90-2989"><a href="#cb90-2989" aria-hidden="true" tabindex="-1"></a>  <span class="cf">for</span> (<span class="kw">const</span> e <span class="kw">of</span> events) {</span>
<span id="cb90-2990"><a href="#cb90-2990" aria-hidden="true" tabindex="-1"></a>    ringContainer</span>
<span id="cb90-2991"><a href="#cb90-2991" aria-hidden="true" tabindex="-1"></a>      <span class="op">.</span><span class="fu">append</span>(<span class="st">"circle"</span>)</span>
<span id="cb90-2992"><a href="#cb90-2992" aria-hidden="true" tabindex="-1"></a>      <span class="op">.</span><span class="fu">attr</span>(<span class="st">"r"</span><span class="op">,</span> <span class="dv">5</span>)</span>
<span id="cb90-2993"><a href="#cb90-2993" aria-hidden="true" tabindex="-1"></a>      <span class="op">.</span><span class="fu">attr</span>(<span class="st">"cx"</span><span class="op">,</span> <span class="dv">125</span> <span class="op">*</span> <span class="bu">Math</span><span class="op">.</span><span class="fu">sin</span>(e))</span>
<span id="cb90-2994"><a href="#cb90-2994" aria-hidden="true" tabindex="-1"></a>      <span class="op">.</span><span class="fu">attr</span>(<span class="st">"cy"</span><span class="op">,</span> <span class="dv">125</span> <span class="op">*</span> <span class="op">-</span><span class="bu">Math</span><span class="op">.</span><span class="fu">cos</span>(e))</span>
<span id="cb90-2995"><a href="#cb90-2995" aria-hidden="true" tabindex="-1"></a>      <span class="op">.</span><span class="fu">style</span>(<span class="st">"opacity"</span><span class="op">,</span> <span class="fl">0.4</span>)</span>
<span id="cb90-2996"><a href="#cb90-2996" aria-hidden="true" tabindex="-1"></a>      <span class="op">.</span><span class="fu">style</span>(<span class="st">"fill"</span><span class="op">,</span> <span class="st">"white"</span>)<span class="op">;</span></span>
<span id="cb90-2997"><a href="#cb90-2997" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb90-2998"><a href="#cb90-2998" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> digitalClock <span class="op">=</span> svg</span>
<span id="cb90-2999"><a href="#cb90-2999" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">append</span>(<span class="st">"g"</span>)</span>
<span id="cb90-3000"><a href="#cb90-3000" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">attr</span>(</span>
<span id="cb90-3001"><a href="#cb90-3001" aria-hidden="true" tabindex="-1"></a>      <span class="st">"transform"</span><span class="op">,</span></span>
<span id="cb90-3002"><a href="#cb90-3002" aria-hidden="true" tabindex="-1"></a>      <span class="vs">`translate(</span><span class="sc">${</span>width <span class="op">/</span> <span class="dv">2</span> <span class="op">+</span> <span class="dv">45</span> <span class="op">*</span> <span class="fu">sin</span>(astDegMapPlot)<span class="sc">}</span><span class="vs">, </span><span class="sc">${</span></span>
<span id="cb90-3003"><a href="#cb90-3003" aria-hidden="true" tabindex="-1"></a>        height <span class="op">/</span> <span class="dv">2</span> <span class="op">+</span> <span class="dv">45</span> <span class="op">*</span> <span class="op">-</span><span class="fu">cos</span>(astDegMapPlot)</span>
<span id="cb90-3004"><a href="#cb90-3004" aria-hidden="true" tabindex="-1"></a>      <span class="sc">}</span><span class="vs">)`</span></span>
<span id="cb90-3005"><a href="#cb90-3005" aria-hidden="true" tabindex="-1"></a>    )<span class="op">;</span></span>
<span id="cb90-3006"><a href="#cb90-3006" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> digitalClockBase <span class="op">=</span> digitalClock</span>
<span id="cb90-3007"><a href="#cb90-3007" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">append</span>(<span class="st">"circle"</span>)</span>
<span id="cb90-3008"><a href="#cb90-3008" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">"r"</span><span class="op">,</span> <span class="dv">100</span>)</span>
<span id="cb90-3009"><a href="#cb90-3009" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">style</span>(<span class="st">"opacity"</span><span class="op">,</span> <span class="fl">0.21</span>)</span>
<span id="cb90-3010"><a href="#cb90-3010" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">style</span>(<span class="st">"fill"</span><span class="op">,</span> <span class="st">"white"</span>)<span class="op">;</span></span>
<span id="cb90-3011"><a href="#cb90-3011" aria-hidden="true" tabindex="-1"></a><span class="co">//  const digitalClockTicks = digitalClock</span></span>
<span id="cb90-3012"><a href="#cb90-3012" aria-hidden="true" tabindex="-1"></a><span class="co">//    .selectAll(".digital-clock-tick")</span></span>
<span id="cb90-3013"><a href="#cb90-3013" aria-hidden="true" tabindex="-1"></a><span class="co">//    .data(d3.range(0, 60))</span></span>
<span id="cb90-3014"><a href="#cb90-3014" aria-hidden="true" tabindex="-1"></a><span class="co">//    .enter()</span></span>
<span id="cb90-3015"><a href="#cb90-3015" aria-hidden="true" tabindex="-1"></a><span class="co">//    .append("line")</span></span>
<span id="cb90-3016"><a href="#cb90-3016" aria-hidden="true" tabindex="-1"></a><span class="co">//    .attr("class", "digital-clock-tick")</span></span>
<span id="cb90-3017"><a href="#cb90-3017" aria-hidden="true" tabindex="-1"></a><span class="co">//    .attr("x1", 0)</span></span>
<span id="cb90-3018"><a href="#cb90-3018" aria-hidden="true" tabindex="-1"></a><span class="co">//    .attr("x2", 0)</span></span>
<span id="cb90-3019"><a href="#cb90-3019" aria-hidden="true" tabindex="-1"></a><span class="co">//    .attr("y1", 100 - 5)</span></span>
<span id="cb90-3020"><a href="#cb90-3020" aria-hidden="true" tabindex="-1"></a><span class="co">//    .attr("y2", 100 - 10)</span></span>
<span id="cb90-3021"><a href="#cb90-3021" aria-hidden="true" tabindex="-1"></a><span class="co">//    .attr("stroke", (d) =&gt; (d &gt; seconds ? "black" : "white"))</span></span>
<span id="cb90-3022"><a href="#cb90-3022" aria-hidden="true" tabindex="-1"></a><span class="co">//    .attr("stroke-width", "3")</span></span>
<span id="cb90-3023"><a href="#cb90-3023" aria-hidden="true" tabindex="-1"></a><span class="co">//    .attr("stroke-linecap", "round")</span></span>
<span id="cb90-3024"><a href="#cb90-3024" aria-hidden="true" tabindex="-1"></a><span class="co">//    .style("mix-blend-mode", "luminance")</span></span>
<span id="cb90-3025"><a href="#cb90-3025" aria-hidden="true" tabindex="-1"></a><span class="co">//    .style("opacity", 0.6)</span></span>
<span id="cb90-3026"><a href="#cb90-3026" aria-hidden="true" tabindex="-1"></a><span class="co">//    .attr("transform", (d) =&gt; `rotate(${180 + d * 6})`);</span></span>
<span id="cb90-3027"><a href="#cb90-3027" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> clockText <span class="op">=</span> digitalClock</span>
<span id="cb90-3028"><a href="#cb90-3028" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">append</span>(<span class="st">"text"</span>)</span>
<span id="cb90-3029"><a href="#cb90-3029" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">"y"</span><span class="op">,</span> <span class="dv">25</span>)</span>
<span id="cb90-3030"><a href="#cb90-3030" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">"fill"</span><span class="op">,</span> <span class="st">"white"</span>)</span>
<span id="cb90-3031"><a href="#cb90-3031" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">"text-anchor"</span><span class="op">,</span> <span class="st">"middle"</span>)</span>
<span id="cb90-3032"><a href="#cb90-3032" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">"font-family"</span><span class="op">,</span> <span class="st">"Helvetica, Arial, sans-serif"</span>)</span>
<span id="cb90-3033"><a href="#cb90-3033" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">style</span>(<span class="st">"opacity"</span><span class="op">,</span> <span class="dv">1</span>)</span>
<span id="cb90-3034"><a href="#cb90-3034" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">"font-weight"</span><span class="op">,</span> <span class="dv">600</span>)</span>
<span id="cb90-3035"><a href="#cb90-3035" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">"font-size"</span><span class="op">,</span> <span class="st">"75px"</span>)</span>
<span id="cb90-3036"><a href="#cb90-3036" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">text</span>(astDecMapPlot<span class="op">.</span><span class="fu">toFixed</span>(<span class="dv">2</span>))<span class="op">;</span></span>
<span id="cb90-3037"><a href="#cb90-3037" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> ticks <span class="op">=</span> face</span>
<span id="cb90-3038"><a href="#cb90-3038" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">selectAll</span>(<span class="st">".tick"</span>)</span>
<span id="cb90-3039"><a href="#cb90-3039" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">data</span>(d3<span class="op">.</span><span class="fu">range</span>(<span class="dv">0</span><span class="op">,</span> <span class="dv">20</span>))</span>
<span id="cb90-3040"><a href="#cb90-3040" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">enter</span>()</span>
<span id="cb90-3041"><a href="#cb90-3041" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">append</span>(<span class="st">"line"</span>)</span>
<span id="cb90-3042"><a href="#cb90-3042" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">"class"</span><span class="op">,</span> <span class="st">"tick"</span>)</span>
<span id="cb90-3043"><a href="#cb90-3043" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">"x1"</span><span class="op">,</span> <span class="dv">0</span>)</span>
<span id="cb90-3044"><a href="#cb90-3044" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">"x2"</span><span class="op">,</span> <span class="dv">0</span>)</span>
<span id="cb90-3045"><a href="#cb90-3045" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">"y1"</span><span class="op">,</span> radius <span class="op">-</span> <span class="dv">5</span>)</span>
<span id="cb90-3046"><a href="#cb90-3046" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">"y2"</span><span class="op">,</span> radius <span class="op">-</span> <span class="dv">20</span>)</span>
<span id="cb90-3047"><a href="#cb90-3047" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">"stroke"</span><span class="op">,</span> <span class="st">"white"</span>)</span>
<span id="cb90-3048"><a href="#cb90-3048" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">"stroke-width"</span><span class="op">,</span> <span class="st">"3"</span>)</span>
<span id="cb90-3049"><a href="#cb90-3049" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">"stroke-linecap"</span><span class="op">,</span> <span class="st">"round"</span>)</span>
<span id="cb90-3050"><a href="#cb90-3050" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">style</span>(<span class="st">"mix-blend-mode"</span><span class="op">,</span> <span class="st">"screen"</span>)</span>
<span id="cb90-3051"><a href="#cb90-3051" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">style</span>(<span class="st">"opacity"</span><span class="op">,</span> <span class="dv">1</span>)</span>
<span id="cb90-3052"><a href="#cb90-3052" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">"transform"</span><span class="op">,</span> (d) <span class="kw">=&gt;</span> <span class="vs">`rotate(</span><span class="sc">${</span>d <span class="op">*</span> <span class="dv">18</span><span class="sc">}</span><span class="vs">)`</span>)<span class="op">;</span></span>
<span id="cb90-3053"><a href="#cb90-3053" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> minuteTicks <span class="op">=</span> face</span>
<span id="cb90-3054"><a href="#cb90-3054" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">selectAll</span>(<span class="st">".tick"</span>)</span>
<span id="cb90-3055"><a href="#cb90-3055" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">data</span>(d3<span class="op">.</span><span class="fu">range</span>(<span class="dv">0</span><span class="op">,</span> <span class="dv">200</span>))</span>
<span id="cb90-3056"><a href="#cb90-3056" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">enter</span>()</span>
<span id="cb90-3057"><a href="#cb90-3057" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">append</span>(<span class="st">"line"</span>)</span>
<span id="cb90-3058"><a href="#cb90-3058" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">"class"</span><span class="op">,</span> <span class="st">"tick"</span>)</span>
<span id="cb90-3059"><a href="#cb90-3059" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">"x1"</span><span class="op">,</span> <span class="dv">0</span>)</span>
<span id="cb90-3060"><a href="#cb90-3060" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">"x2"</span><span class="op">,</span> <span class="dv">0</span>)</span>
<span id="cb90-3061"><a href="#cb90-3061" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">"y1"</span><span class="op">,</span> radius <span class="op">-</span> <span class="dv">5</span>)</span>
<span id="cb90-3062"><a href="#cb90-3062" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">"y2"</span><span class="op">,</span> radius <span class="op">-</span> <span class="dv">15</span>)</span>
<span id="cb90-3063"><a href="#cb90-3063" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">"stroke"</span><span class="op">,</span> <span class="st">"white"</span>)</span>
<span id="cb90-3064"><a href="#cb90-3064" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">"stroke-width"</span><span class="op">,</span> <span class="st">"2"</span>)</span>
<span id="cb90-3065"><a href="#cb90-3065" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">"stroke-linecap"</span><span class="op">,</span> <span class="st">"round"</span>)</span>
<span id="cb90-3066"><a href="#cb90-3066" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">style</span>(<span class="st">"mix-blend-mode"</span><span class="op">,</span> <span class="st">"screen"</span>)</span>
<span id="cb90-3067"><a href="#cb90-3067" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">style</span>(<span class="st">"opacity"</span><span class="op">,</span> <span class="fl">0.6</span>)</span>
<span id="cb90-3068"><a href="#cb90-3068" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">"transform"</span><span class="op">,</span> (d) <span class="kw">=&gt;</span> <span class="vs">`rotate(</span><span class="sc">${</span>d <span class="op">*</span> <span class="dv">2</span><span class="sc">}</span><span class="vs">)`</span>)<span class="op">;</span></span>
<span id="cb90-3069"><a href="#cb90-3069" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> hourLabels <span class="op">=</span> face</span>
<span id="cb90-3070"><a href="#cb90-3070" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">selectAll</span>(<span class="st">".hour-label"</span>)</span>
<span id="cb90-3071"><a href="#cb90-3071" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">data</span>(d3<span class="op">.</span><span class="fu">range</span>(<span class="dv">0</span><span class="op">,</span> <span class="dv">10</span>))</span>
<span id="cb90-3072"><a href="#cb90-3072" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">enter</span>()</span>
<span id="cb90-3073"><a href="#cb90-3073" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">append</span>(<span class="st">"text"</span>)</span>
<span id="cb90-3074"><a href="#cb90-3074" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">"class"</span><span class="op">,</span> <span class="st">"hour-label"</span>)</span>
<span id="cb90-3075"><a href="#cb90-3075" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">"x"</span><span class="op">,</span> (d) <span class="kw">=&gt;</span> <span class="dv">160</span> <span class="op">*</span> <span class="op">-</span><span class="bu">Math</span><span class="op">.</span><span class="fu">sin</span>(<span class="fu">toRadians</span>((d <span class="op">/</span> <span class="dv">10</span>) <span class="op">*</span> <span class="dv">360</span>)))</span>
<span id="cb90-3076"><a href="#cb90-3076" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">"y"</span><span class="op">,</span> (d) <span class="kw">=&gt;</span> <span class="dv">160</span> <span class="op">*</span> <span class="bu">Math</span><span class="op">.</span><span class="fu">cos</span>(<span class="fu">toRadians</span>((d <span class="op">/</span> <span class="dv">10</span>) <span class="op">*</span> <span class="dv">360</span>)) <span class="op">+</span> <span class="dv">12</span>)</span>
<span id="cb90-3077"><a href="#cb90-3077" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">"fill"</span><span class="op">,</span> <span class="st">"white"</span>)</span>
<span id="cb90-3078"><a href="#cb90-3078" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">"text-anchor"</span><span class="op">,</span> <span class="st">"middle"</span>)</span>
<span id="cb90-3079"><a href="#cb90-3079" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">"font-family"</span><span class="op">,</span> <span class="st">"Helvetica, Arial, sans-serif"</span>)</span>
<span id="cb90-3080"><a href="#cb90-3080" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">"font-weight"</span><span class="op">,</span> <span class="dv">600</span>)</span>
<span id="cb90-3081"><a href="#cb90-3081" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">"font-size"</span><span class="op">,</span> <span class="st">"38px"</span>)</span>
<span id="cb90-3082"><a href="#cb90-3082" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">style</span>(<span class="st">"opacity"</span><span class="op">,</span> <span class="fl">0.7</span>)</span>
<span id="cb90-3083"><a href="#cb90-3083" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">text</span>((d) <span class="kw">=&gt;</span> (<span class="bu">String</span>(d)))<span class="op">;</span></span>
<span id="cb90-3084"><a href="#cb90-3084" aria-hidden="true" tabindex="-1"></a>  <span class="cf">return</span> svg<span class="op">.</span><span class="fu">node</span>()<span class="op">;</span></span>
<span id="cb90-3085"><a href="#cb90-3085" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb90-3086"><a href="#cb90-3086" aria-hidden="true" tabindex="-1"></a>minutesAndSeconds <span class="op">=</span> {</span>
<span id="cb90-3087"><a href="#cb90-3087" aria-hidden="true" tabindex="-1"></a>  <span class="cf">while</span> (<span class="kw">true</span>) {</span>
<span id="cb90-3088"><a href="#cb90-3088" aria-hidden="true" tabindex="-1"></a>    <span class="cf">await</span> Promises<span class="op">.</span><span class="fu">delay</span>(<span class="dv">1000</span>)<span class="op">;</span></span>
<span id="cb90-3089"><a href="#cb90-3089" aria-hidden="true" tabindex="-1"></a>    <span class="kw">const</span> date <span class="op">=</span> <span class="kw">new</span> <span class="bu">Date</span>()<span class="op">;</span></span>
<span id="cb90-3090"><a href="#cb90-3090" aria-hidden="true" tabindex="-1"></a>    <span class="kw">yield</span> {</span>
<span id="cb90-3091"><a href="#cb90-3091" aria-hidden="true" tabindex="-1"></a>      <span class="dt">minutes</span><span class="op">:</span> date<span class="op">.</span><span class="fu">getHours</span>() <span class="op">*</span> <span class="dv">60</span> <span class="op">+</span> date<span class="op">.</span><span class="fu">getMinutes</span>()<span class="op">,</span></span>
<span id="cb90-3092"><a href="#cb90-3092" aria-hidden="true" tabindex="-1"></a>      <span class="dt">seconds</span><span class="op">:</span> date<span class="op">.</span><span class="fu">getSeconds</span>()</span>
<span id="cb90-3093"><a href="#cb90-3093" aria-hidden="true" tabindex="-1"></a>    }<span class="op">;</span></span>
<span id="cb90-3094"><a href="#cb90-3094" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb90-3095"><a href="#cb90-3095" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb90-3096"><a href="#cb90-3096" aria-hidden="true" tabindex="-1"></a><span class="kw">function</span> <span class="fu">minutesTo12HourTime</span>(minutes) {</span>
<span id="cb90-3097"><a href="#cb90-3097" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> decidays <span class="op">=</span> minutes <span class="op">/</span> <span class="dv">144</span> <span class="op">%</span> <span class="dv">10</span></span>
<span id="cb90-3098"><a href="#cb90-3098" aria-hidden="true" tabindex="-1"></a>  <span class="cf">return</span> decidays<span class="op">.</span><span class="fu">toFixed</span>(<span class="dv">2</span>)<span class="op">;</span></span>
<span id="cb90-3099"><a href="#cb90-3099" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb90-3100"><a href="#cb90-3100" aria-hidden="true" tabindex="-1"></a>viewof date <span class="op">=</span> Inputs<span class="op">.</span><span class="fu">date</span>({ <span class="dt">label</span><span class="op">:</span> <span class="st">"Date"</span><span class="op">,</span> <span class="dt">value</span><span class="op">:</span> <span class="bu">Date</span><span class="op">.</span><span class="fu">now</span>() })</span>
<span id="cb90-3101"><a href="#cb90-3101" aria-hidden="true" tabindex="-1"></a>JD <span class="op">=</span> <span class="fu">getJulianDate</span>(date)</span>
<span id="cb90-3102"><a href="#cb90-3102" aria-hidden="true" tabindex="-1"></a>T <span class="op">=</span> (JD <span class="op">-</span> <span class="fl">2451545.0</span>) <span class="op">/</span> <span class="dv">36525</span></span>
<span id="cb90-3103"><a href="#cb90-3103" aria-hidden="true" tabindex="-1"></a>sun_geometric_mean_longitude <span class="op">=</span> <span class="fl">280.46646</span> <span class="op">+</span> <span class="fl">36000.76983</span> <span class="op">*</span> T <span class="op">+</span> <span class="fl">0.0003032</span> <span class="op">*</span> T <span class="op">**</span> <span class="dv">2</span></span>
<span id="cb90-3104"><a href="#cb90-3104" aria-hidden="true" tabindex="-1"></a>sun_mean_anomaly <span class="op">=</span> <span class="fl">357.52911</span> <span class="op">+</span> <span class="fl">35999.05029</span> <span class="op">*</span> T <span class="op">-</span> <span class="fl">0.0001537</span> <span class="op">*</span> T <span class="op">**</span> <span class="dv">2</span></span>
<span id="cb90-3105"><a href="#cb90-3105" aria-hidden="true" tabindex="-1"></a>earth_eccentricity_orbit <span class="op">=</span> <span class="fl">0.016708634</span> <span class="op">-</span> <span class="fl">0.000042037</span> <span class="op">*</span> T <span class="op">-</span> <span class="fl">0.0000001267</span> <span class="op">*</span> T <span class="op">**</span> <span class="dv">2</span></span>
<span id="cb90-3106"><a href="#cb90-3106" aria-hidden="true" tabindex="-1"></a>sun_equation_of_the_center <span class="op">=</span> (<span class="fl">1.914602</span> <span class="op">-</span> <span class="fl">0.004817</span> <span class="op">*</span> T <span class="op">-</span> <span class="fl">0.000014</span> <span class="op">*</span> T <span class="op">**</span> <span class="dv">2</span>) <span class="op">*</span> <span class="fu">sin</span>(sun_mean_anomaly) <span class="op">+</span> (<span class="fl">0.019993</span> <span class="op">-</span> <span class="fl">0.000101</span> <span class="op">*</span> T) <span class="op">*</span> <span class="fu">sin</span>(<span class="dv">2</span> <span class="op">*</span> sun_mean_anomaly) <span class="op">+</span> <span class="fl">0.000289</span> <span class="op">*</span> <span class="fu">sin</span>(<span class="dv">3</span> <span class="op">*</span> sun_mean_anomaly)</span>
<span id="cb90-3107"><a href="#cb90-3107" aria-hidden="true" tabindex="-1"></a>sun_true_longitude <span class="op">=</span> sun_geometric_mean_longitude <span class="op">+</span> sun_equation_of_the_center</span>
<span id="cb90-3108"><a href="#cb90-3108" aria-hidden="true" tabindex="-1"></a>sun_true_anomaly <span class="op">=</span> sun_mean_anomaly <span class="op">+</span> sun_equation_of_the_center</span>
<span id="cb90-3109"><a href="#cb90-3109" aria-hidden="true" tabindex="-1"></a>omega <span class="op">=</span> <span class="fl">125.04</span> <span class="op">-</span> <span class="fl">1934.136</span> <span class="op">*</span> T</span>
<span id="cb90-3110"><a href="#cb90-3110" aria-hidden="true" tabindex="-1"></a>sun_aparrent_longitude <span class="op">=</span> sun_true_longitude <span class="op">-</span> <span class="fl">0.00569</span> <span class="op">-</span> <span class="fl">0.00478</span> <span class="op">*</span> <span class="fu">sin</span>(omega)</span>
<span id="cb90-3111"><a href="#cb90-3111" aria-hidden="true" tabindex="-1"></a>sun_ecliptic_obliquity <span class="op">=</span> <span class="dv">23</span> <span class="op">+</span> (<span class="dv">26</span> <span class="op">+</span> (<span class="fl">21.448</span> <span class="op">-</span> <span class="fl">46.815</span> <span class="op">*</span> T <span class="op">-</span> <span class="fl">0.00059</span> <span class="op">*</span> T <span class="op">**</span> <span class="dv">2</span> <span class="op">+</span> <span class="fl">0.001813</span> <span class="op">*</span> T <span class="op">**</span> <span class="dv">3</span>) <span class="op">/</span> <span class="dv">60</span>) <span class="op">/</span> <span class="dv">60</span></span>
<span id="cb90-3112"><a href="#cb90-3112" aria-hidden="true" tabindex="-1"></a>sun_ecliptic_obliquity_corrected <span class="op">=</span> sun_ecliptic_obliquity <span class="op">+</span> <span class="fl">0.00256</span> <span class="op">*</span> <span class="fu">cos</span>(omega)</span>
<span id="cb90-3113"><a href="#cb90-3113" aria-hidden="true" tabindex="-1"></a>sun_right_ascension <span class="op">=</span> <span class="bu">Math</span><span class="op">.</span><span class="fu">atan2</span>(</span>
<span id="cb90-3114"><a href="#cb90-3114" aria-hidden="true" tabindex="-1"></a>  <span class="fu">cos</span>(sun_ecliptic_obliquity_corrected) <span class="op">*</span> <span class="fu">sin</span>(sun_aparrent_longitude)<span class="op">,</span></span>
<span id="cb90-3115"><a href="#cb90-3115" aria-hidden="true" tabindex="-1"></a>  <span class="fu">cos</span>(sun_aparrent_longitude)</span>
<span id="cb90-3116"><a href="#cb90-3116" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb90-3117"><a href="#cb90-3117" aria-hidden="true" tabindex="-1"></a>sun_declination <span class="op">=</span> <span class="bu">Math</span><span class="op">.</span><span class="fu">asin</span>(</span>
<span id="cb90-3118"><a href="#cb90-3118" aria-hidden="true" tabindex="-1"></a>  <span class="fu">sin</span>(sun_ecliptic_obliquity_corrected) <span class="op">*</span> <span class="fu">sin</span>(sun_aparrent_longitude)</span>
<span id="cb90-3119"><a href="#cb90-3119" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb90-3120"><a href="#cb90-3120" aria-hidden="true" tabindex="-1"></a>y <span class="op">=</span> <span class="bu">Math</span><span class="op">.</span><span class="fu">tan</span>(<span class="fu">toRadians</span>(sun_ecliptic_obliquity_corrected) <span class="op">/</span> <span class="dv">2</span>) <span class="op">**</span> <span class="dv">2</span></span>
<span id="cb90-3121"><a href="#cb90-3121" aria-hidden="true" tabindex="-1"></a>equation_of_time <span class="op">=</span> <span class="fu">toDegrees</span>(</span>
<span id="cb90-3122"><a href="#cb90-3122" aria-hidden="true" tabindex="-1"></a>  y <span class="op">*</span> <span class="fu">sin</span>(<span class="dv">2</span> <span class="op">*</span> (sun_geometric_mean_longitude)) <span class="op">-</span></span>
<span id="cb90-3123"><a href="#cb90-3123" aria-hidden="true" tabindex="-1"></a>    <span class="dv">2</span> <span class="op">*</span> earth_eccentricity_orbit <span class="op">*</span> <span class="fu">sin</span>((sun_mean_anomaly)) <span class="op">+</span></span>
<span id="cb90-3124"><a href="#cb90-3124" aria-hidden="true" tabindex="-1"></a>    <span class="dv">4</span> <span class="op">*</span> earth_eccentricity_orbit <span class="op">*</span> y <span class="op">*</span> <span class="fu">sin</span>((sun_mean_anomaly)) <span class="op">*</span> <span class="fu">cos</span>(<span class="dv">2</span> <span class="op">*</span> (sun_geometric_mean_longitude)) <span class="op">-</span></span>
<span id="cb90-3125"><a href="#cb90-3125" aria-hidden="true" tabindex="-1"></a>    (<span class="dv">1</span> <span class="op">/</span> <span class="dv">2</span>) <span class="op">*</span> y <span class="op">**</span> <span class="dv">2</span> <span class="op">*</span> <span class="fu">sin</span>(<span class="dv">4</span> <span class="op">*</span> (sun_geometric_mean_longitude)) <span class="op">-</span></span>
<span id="cb90-3126"><a href="#cb90-3126" aria-hidden="true" tabindex="-1"></a>    (<span class="dv">5</span> <span class="op">/</span> <span class="dv">4</span>) <span class="op">*</span> earth_eccentricity_orbit <span class="op">**</span> <span class="dv">2</span> <span class="op">*</span> <span class="fu">sin</span>(<span class="dv">2</span> <span class="op">*</span> (sun_mean_anomaly))</span>
<span id="cb90-3127"><a href="#cb90-3127" aria-hidden="true" tabindex="-1"></a>) <span class="op">*</span> <span class="dv">4</span></span>
<span id="cb90-3128"><a href="#cb90-3128" aria-hidden="true" tabindex="-1"></a>hour_angle <span class="op">=</span> shaDegrMapPlot</span>
<span id="cb90-3129"><a href="#cb90-3129" aria-hidden="true" tabindex="-1"></a>sun_transit <span class="op">=</span> solarNoonMinu</span>
<span id="cb90-3130"><a href="#cb90-3130" aria-hidden="true" tabindex="-1"></a>sun_rise <span class="op">=</span> sun_transit <span class="op">-</span> hour_angle <span class="op">*</span> <span class="dv">4</span></span>
<span id="cb90-3131"><a href="#cb90-3131" aria-hidden="true" tabindex="-1"></a>sun_set <span class="op">=</span> sun_transit <span class="op">+</span> hour_angle <span class="op">*</span> <span class="dv">4</span></span>
<span id="cb90-3132"><a href="#cb90-3132" aria-hidden="true" tabindex="-1"></a>sun_duration <span class="op">=</span> sun_set <span class="op">-</span> sun_rise</span>
<span id="cb90-3133"><a href="#cb90-3133" aria-hidden="true" tabindex="-1"></a>sun_civil_rise <span class="op">=</span> sun_transit <span class="op">-</span> (hour_angle <span class="op">+</span> <span class="dv">6</span>) <span class="op">*</span> <span class="dv">4</span></span>
<span id="cb90-3134"><a href="#cb90-3134" aria-hidden="true" tabindex="-1"></a>sun_nautical_rise <span class="op">=</span> sun_transit <span class="op">-</span> (hour_angle <span class="op">+</span> <span class="dv">12</span>) <span class="op">*</span> <span class="dv">4</span></span>
<span id="cb90-3135"><a href="#cb90-3135" aria-hidden="true" tabindex="-1"></a>sun_astronomical_rise <span class="op">=</span> sun_transit <span class="op">-</span> (hour_angle <span class="op">+</span> <span class="dv">18</span>) <span class="op">*</span> <span class="dv">4</span></span>
<span id="cb90-3136"><a href="#cb90-3136" aria-hidden="true" tabindex="-1"></a>sun_civil_set <span class="op">=</span> sun_transit <span class="op">+</span> (hour_angle <span class="op">+</span> <span class="dv">6</span>) <span class="op">*</span> <span class="dv">4</span></span>
<span id="cb90-3137"><a href="#cb90-3137" aria-hidden="true" tabindex="-1"></a>sun_nautical_set <span class="op">=</span> sun_transit <span class="op">+</span> (hour_angle <span class="op">+</span> <span class="dv">12</span>) <span class="op">*</span> <span class="dv">4</span></span>
<span id="cb90-3138"><a href="#cb90-3138" aria-hidden="true" tabindex="-1"></a>sun_astronomical_set <span class="op">=</span> sun_transit <span class="op">+</span> (hour_angle <span class="op">+</span> <span class="dv">18</span>) <span class="op">*</span> <span class="dv">4</span></span>
<span id="cb90-3139"><a href="#cb90-3139" aria-hidden="true" tabindex="-1"></a>data <span class="op">=</span> ({</span>
<span id="cb90-3140"><a href="#cb90-3140" aria-hidden="true" tabindex="-1"></a>  <span class="dt">astronomicalSunrise</span><span class="op">:</span></span>
<span id="cb90-3141"><a href="#cb90-3141" aria-hidden="true" tabindex="-1"></a>    <span class="fu">toRadians</span>((sun_astronomical_rise <span class="op">/</span> <span class="dv">1440</span>) <span class="op">*</span> <span class="dv">360</span>) <span class="op">+</span> <span class="bu">Math</span><span class="op">.</span><span class="cn">PI</span><span class="op">,</span></span>
<span id="cb90-3142"><a href="#cb90-3142" aria-hidden="true" tabindex="-1"></a>  <span class="dt">nauticalSunrise</span><span class="op">:</span> <span class="fu">toRadians</span>((sun_nautical_rise <span class="op">/</span> <span class="dv">1440</span>) <span class="op">*</span> <span class="dv">360</span>) <span class="op">+</span> <span class="bu">Math</span><span class="op">.</span><span class="cn">PI</span><span class="op">,</span></span>
<span id="cb90-3143"><a href="#cb90-3143" aria-hidden="true" tabindex="-1"></a>  <span class="dt">civilSunrise</span><span class="op">:</span> <span class="fu">toRadians</span>((sun_civil_rise <span class="op">/</span> <span class="dv">1440</span>) <span class="op">*</span> <span class="dv">360</span>) <span class="op">+</span> <span class="bu">Math</span><span class="op">.</span><span class="cn">PI</span><span class="op">,</span></span>
<span id="cb90-3144"><a href="#cb90-3144" aria-hidden="true" tabindex="-1"></a>  <span class="dt">sunrise</span><span class="op">:</span> <span class="fu">toRadians</span>((sun_rise <span class="op">/</span> <span class="dv">1440</span>) <span class="op">*</span> <span class="dv">360</span>) <span class="op">+</span> <span class="bu">Math</span><span class="op">.</span><span class="cn">PI</span><span class="op">,</span></span>
<span id="cb90-3145"><a href="#cb90-3145" aria-hidden="true" tabindex="-1"></a>  <span class="dt">sunset</span><span class="op">:</span> <span class="fu">toRadians</span>((sun_set <span class="op">/</span> <span class="dv">1440</span>) <span class="op">*</span> <span class="dv">360</span>) <span class="op">+</span> <span class="bu">Math</span><span class="op">.</span><span class="cn">PI</span><span class="op">,</span></span>
<span id="cb90-3146"><a href="#cb90-3146" aria-hidden="true" tabindex="-1"></a>  <span class="dt">civilSunset</span><span class="op">:</span> <span class="fu">toRadians</span>((sun_civil_set <span class="op">/</span> <span class="dv">1440</span>) <span class="op">*</span> <span class="dv">360</span>) <span class="op">+</span> <span class="bu">Math</span><span class="op">.</span><span class="cn">PI</span><span class="op">,</span></span>
<span id="cb90-3147"><a href="#cb90-3147" aria-hidden="true" tabindex="-1"></a>  <span class="dt">nauticalSunset</span><span class="op">:</span> <span class="fu">toRadians</span>((sun_nautical_set <span class="op">/</span> <span class="dv">1440</span>) <span class="op">*</span> <span class="dv">360</span>) <span class="op">+</span> <span class="bu">Math</span><span class="op">.</span><span class="cn">PI</span><span class="op">,</span></span>
<span id="cb90-3148"><a href="#cb90-3148" aria-hidden="true" tabindex="-1"></a>  <span class="dt">astronomicalSunset</span><span class="op">:</span> <span class="fu">toRadians</span>((sun_astronomical_set <span class="op">/</span> <span class="dv">1440</span>) <span class="op">*</span> <span class="dv">360</span>) <span class="op">+</span> <span class="bu">Math</span><span class="op">.</span><span class="cn">PI</span><span class="op">,</span></span>
<span id="cb90-3149"><a href="#cb90-3149" aria-hidden="true" tabindex="-1"></a>  <span class="dt">solarNoon</span><span class="op">:</span> <span class="fu">toRadians</span>((sun_transit <span class="op">/</span> <span class="dv">1440</span>) <span class="op">*</span> <span class="dv">360</span>) <span class="op">+</span> <span class="bu">Math</span><span class="op">.</span><span class="cn">PI</span><span class="op">,</span></span>
<span id="cb90-3150"><a href="#cb90-3150" aria-hidden="true" tabindex="-1"></a>  <span class="dt">dayLength</span><span class="op">:</span> sun_duration</span>
<span id="cb90-3151"><a href="#cb90-3151" aria-hidden="true" tabindex="-1"></a>})</span>
<span id="cb90-3152"><a href="#cb90-3152" aria-hidden="true" tabindex="-1"></a>angles <span class="op">=</span> [</span>
<span id="cb90-3153"><a href="#cb90-3153" aria-hidden="true" tabindex="-1"></a>  {</span>
<span id="cb90-3154"><a href="#cb90-3154" aria-hidden="true" tabindex="-1"></a>    <span class="dt">start</span><span class="op">:</span> data<span class="op">.</span><span class="at">astronomicalSunrise</span><span class="op">,</span></span>
<span id="cb90-3155"><a href="#cb90-3155" aria-hidden="true" tabindex="-1"></a>    <span class="dt">end</span><span class="op">:</span> data<span class="op">.</span><span class="at">nauticalSunrise</span><span class="op">,</span></span>
<span id="cb90-3156"><a href="#cb90-3156" aria-hidden="true" tabindex="-1"></a>    <span class="dt">color</span><span class="op">:</span> <span class="st">"rgb(17,49,86)"</span></span>
<span id="cb90-3157"><a href="#cb90-3157" aria-hidden="true" tabindex="-1"></a>  }<span class="op">,</span></span>
<span id="cb90-3158"><a href="#cb90-3158" aria-hidden="true" tabindex="-1"></a>  {</span>
<span id="cb90-3159"><a href="#cb90-3159" aria-hidden="true" tabindex="-1"></a>    <span class="dt">start</span><span class="op">:</span> data<span class="op">.</span><span class="at">nauticalSunrise</span><span class="op">,</span></span>
<span id="cb90-3160"><a href="#cb90-3160" aria-hidden="true" tabindex="-1"></a>    <span class="dt">end</span><span class="op">:</span> data<span class="op">.</span><span class="at">civilSunrise</span><span class="op">,</span></span>
<span id="cb90-3161"><a href="#cb90-3161" aria-hidden="true" tabindex="-1"></a>    <span class="dt">color</span><span class="op">:</span> <span class="st">"rgb(23,61,112)"</span></span>
<span id="cb90-3162"><a href="#cb90-3162" aria-hidden="true" tabindex="-1"></a>  }<span class="op">,</span></span>
<span id="cb90-3163"><a href="#cb90-3163" aria-hidden="true" tabindex="-1"></a>  { <span class="dt">start</span><span class="op">:</span> data<span class="op">.</span><span class="at">civilSunrise</span><span class="op">,</span> <span class="dt">end</span><span class="op">:</span> data<span class="op">.</span><span class="at">sunrise</span><span class="op">,</span> <span class="dt">color</span><span class="op">:</span> <span class="st">"rgb(35,85,155)"</span> }<span class="op">,</span></span>
<span id="cb90-3164"><a href="#cb90-3164" aria-hidden="true" tabindex="-1"></a>  { <span class="dt">start</span><span class="op">:</span> data<span class="op">.</span><span class="at">sunrise</span><span class="op">,</span> <span class="dt">end</span><span class="op">:</span> data<span class="op">.</span><span class="at">sunset</span><span class="op">,</span> <span class="dt">color</span><span class="op">:</span> <span class="st">"rgb(70,155,245)"</span> }<span class="op">,</span></span>
<span id="cb90-3165"><a href="#cb90-3165" aria-hidden="true" tabindex="-1"></a>  { <span class="dt">start</span><span class="op">:</span> data<span class="op">.</span><span class="at">sunset</span><span class="op">,</span> <span class="dt">end</span><span class="op">:</span> data<span class="op">.</span><span class="at">civilSunset</span><span class="op">,</span> <span class="dt">color</span><span class="op">:</span> <span class="st">"rgb(35,85,155)"</span> }<span class="op">,</span></span>
<span id="cb90-3166"><a href="#cb90-3166" aria-hidden="true" tabindex="-1"></a>  {</span>
<span id="cb90-3167"><a href="#cb90-3167" aria-hidden="true" tabindex="-1"></a>    <span class="dt">start</span><span class="op">:</span> data<span class="op">.</span><span class="at">civilSunset</span><span class="op">,</span></span>
<span id="cb90-3168"><a href="#cb90-3168" aria-hidden="true" tabindex="-1"></a>    <span class="dt">end</span><span class="op">:</span> data<span class="op">.</span><span class="at">nauticalSunset</span><span class="op">,</span></span>
<span id="cb90-3169"><a href="#cb90-3169" aria-hidden="true" tabindex="-1"></a>    <span class="dt">color</span><span class="op">:</span> <span class="st">"rgb(23,61,112)"</span></span>
<span id="cb90-3170"><a href="#cb90-3170" aria-hidden="true" tabindex="-1"></a>  }<span class="op">,</span></span>
<span id="cb90-3171"><a href="#cb90-3171" aria-hidden="true" tabindex="-1"></a>  {</span>
<span id="cb90-3172"><a href="#cb90-3172" aria-hidden="true" tabindex="-1"></a>    <span class="dt">start</span><span class="op">:</span> data<span class="op">.</span><span class="at">nauticalSunset</span><span class="op">,</span></span>
<span id="cb90-3173"><a href="#cb90-3173" aria-hidden="true" tabindex="-1"></a>    <span class="dt">end</span><span class="op">:</span> data<span class="op">.</span><span class="at">astronomicalSunset</span><span class="op">,</span></span>
<span id="cb90-3174"><a href="#cb90-3174" aria-hidden="true" tabindex="-1"></a>    <span class="dt">color</span><span class="op">:</span> <span class="st">"rgb(17,49,86)"</span></span>
<span id="cb90-3175"><a href="#cb90-3175" aria-hidden="true" tabindex="-1"></a>  }<span class="op">,</span></span>
<span id="cb90-3176"><a href="#cb90-3176" aria-hidden="true" tabindex="-1"></a>  {</span>
<span id="cb90-3177"><a href="#cb90-3177" aria-hidden="true" tabindex="-1"></a>    <span class="dt">start</span><span class="op">:</span> data<span class="op">.</span><span class="at">astronomicalSunset</span><span class="op">,</span></span>
<span id="cb90-3178"><a href="#cb90-3178" aria-hidden="true" tabindex="-1"></a>    <span class="dt">end</span><span class="op">:</span> data<span class="op">.</span><span class="at">astronomicalSunrise</span> <span class="op">+</span> <span class="bu">Math</span><span class="op">.</span><span class="cn">PI</span> <span class="op">*</span> <span class="dv">2</span><span class="op">,</span></span>
<span id="cb90-3179"><a href="#cb90-3179" aria-hidden="true" tabindex="-1"></a>    <span class="dt">color</span><span class="op">:</span> <span class="st">"rgb(10,34,58)"</span></span>
<span id="cb90-3180"><a href="#cb90-3180" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb90-3181"><a href="#cb90-3181" aria-hidden="true" tabindex="-1"></a>]</span>
<span id="cb90-3182"><a href="#cb90-3182" aria-hidden="true" tabindex="-1"></a>getJulianDate <span class="op">=</span> (timestamp) <span class="kw">=&gt;</span> {</span>
<span id="cb90-3183"><a href="#cb90-3183" aria-hidden="true" tabindex="-1"></a>  <span class="cf">return</span> <span class="kw">new</span> <span class="bu">Date</span>(timestamp) <span class="op">/</span> <span class="dv">86400000</span> <span class="op">+</span> <span class="fl">2440587.5</span><span class="op">;</span></span>
<span id="cb90-3184"><a href="#cb90-3184" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb90-3185"><a href="#cb90-3185" aria-hidden="true" tabindex="-1"></a>sin <span class="op">=</span> (x) <span class="kw">=&gt;</span> <span class="bu">Math</span><span class="op">.</span><span class="fu">sin</span>(<span class="fu">toRadians</span>(x))</span>
<span id="cb90-3186"><a href="#cb90-3186" aria-hidden="true" tabindex="-1"></a>cos <span class="op">=</span> (x) <span class="kw">=&gt;</span> <span class="bu">Math</span><span class="op">.</span><span class="fu">cos</span>(<span class="fu">toRadians</span>(x))</span>
<span id="cb90-3187"><a href="#cb90-3187" aria-hidden="true" tabindex="-1"></a>solarNoonTurn <span class="op">=</span> (<span class="fl">9.55</span> <span class="op">+</span> selectedZone <span class="op">/</span> <span class="dv">10</span> <span class="op">-</span> lonTurnMapPlot <span class="op">-</span> eotTurnMapPlot) <span class="op">%</span> <span class="dv">1</span></span>
<span id="cb90-3188"><a href="#cb90-3188" aria-hidden="true" tabindex="-1"></a>solarNoonMinu <span class="op">=</span> solarNoonTurn <span class="op">*</span> <span class="dv">1440</span></span>
<span id="cb90-3189"><a href="#cb90-3189" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb90-3190"><a href="#cb90-3190" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb90-3193"><a href="#cb90-3193" aria-hidden="true" tabindex="-1"></a><span class="in">```{ojs}</span></span>
<span id="cb90-3194"><a href="#cb90-3194" aria-hidden="true" tabindex="-1"></a><span class="co">//| echo: false</span></span>
<span id="cb90-3195"><a href="#cb90-3195" aria-hidden="true" tabindex="-1"></a><span class="co">//| output: false</span></span>
<span id="cb90-3196"><a href="#cb90-3196" aria-hidden="true" tabindex="-1"></a><span class="fu">html</span><span class="vs">`</span></span>
<span id="cb90-3197"><a href="#cb90-3197" aria-hidden="true" tabindex="-1"></a><span class="vs">&lt;style&gt;</span></span>
<span id="cb90-3198"><a href="#cb90-3198" aria-hidden="true" tabindex="-1"></a><span class="vs">.colorNight {</span></span>
<span id="cb90-3199"><a href="#cb90-3199" aria-hidden="true" tabindex="-1"></a><span class="vs">  background: #416f86;</span></span>
<span id="cb90-3200"><a href="#cb90-3200" aria-hidden="true" tabindex="-1"></a><span class="vs">  color: white;</span></span>
<span id="cb90-3201"><a href="#cb90-3201" aria-hidden="true" tabindex="-1"></a><span class="vs">  padding: 0px 2px 0px 4px;</span></span>
<span id="cb90-3202"><a href="#cb90-3202" aria-hidden="true" tabindex="-1"></a><span class="vs">  border-radius: 4px;</span></span>
<span id="cb90-3203"><a href="#cb90-3203" aria-hidden="true" tabindex="-1"></a><span class="vs">  font-weight: 400;</span></span>
<span id="cb90-3204"><a href="#cb90-3204" aria-hidden="true" tabindex="-1"></a><span class="vs">  font-family: monospace;</span></span>
<span id="cb90-3205"><a href="#cb90-3205" aria-hidden="true" tabindex="-1"></a><span class="vs">}</span></span>
<span id="cb90-3206"><a href="#cb90-3206" aria-hidden="true" tabindex="-1"></a><span class="vs">.colorDay {</span></span>
<span id="cb90-3207"><a href="#cb90-3207" aria-hidden="true" tabindex="-1"></a><span class="vs">  background: #ffe438;</span></span>
<span id="cb90-3208"><a href="#cb90-3208" aria-hidden="true" tabindex="-1"></a><span class="vs">  color: black;</span></span>
<span id="cb90-3209"><a href="#cb90-3209" aria-hidden="true" tabindex="-1"></a><span class="vs">  padding: 0px 3px 0px 4px;</span></span>
<span id="cb90-3210"><a href="#cb90-3210" aria-hidden="true" tabindex="-1"></a><span class="vs">  border-radius: 4px;</span></span>
<span id="cb90-3211"><a href="#cb90-3211" aria-hidden="true" tabindex="-1"></a><span class="vs">  font-weight: 400;</span></span>
<span id="cb90-3212"><a href="#cb90-3212" aria-hidden="true" tabindex="-1"></a><span class="vs">  font-family: monospace;</span></span>
<span id="cb90-3213"><a href="#cb90-3213" aria-hidden="true" tabindex="-1"></a><span class="vs">}</span></span>
<span id="cb90-3214"><a href="#cb90-3214" aria-hidden="true" tabindex="-1"></a><span class="vs">.colorBkg {</span></span>
<span id="cb90-3215"><a href="#cb90-3215" aria-hidden="true" tabindex="-1"></a><span class="vs">  background: </span><span class="sc">${</span><span class="bu">window</span><span class="op">.</span><span class="at">darkmode</span> <span class="op">?</span> <span class="st">"black"</span> <span class="op">:</span> <span class="st">"white"</span><span class="sc">}</span><span class="vs">;</span></span>
<span id="cb90-3216"><a href="#cb90-3216" aria-hidden="true" tabindex="-1"></a><span class="vs">  color: </span><span class="sc">${</span><span class="bu">window</span><span class="op">.</span><span class="at">darkmode</span> <span class="op">?</span> <span class="st">"white"</span> <span class="op">:</span> <span class="st">"black"</span><span class="sc">}</span><span class="vs">;</span></span>
<span id="cb90-3217"><a href="#cb90-3217" aria-hidden="true" tabindex="-1"></a><span class="vs">  padding: 0px 5px;</span></span>
<span id="cb90-3218"><a href="#cb90-3218" aria-hidden="true" tabindex="-1"></a><span class="vs">  border-radius: 4px;</span></span>
<span id="cb90-3219"><a href="#cb90-3219" aria-hidden="true" tabindex="-1"></a><span class="vs">  font-weight: 400;</span></span>
<span id="cb90-3220"><a href="#cb90-3220" aria-hidden="true" tabindex="-1"></a><span class="vs">  font-family: monospace;</span></span>
<span id="cb90-3221"><a href="#cb90-3221" aria-hidden="true" tabindex="-1"></a><span class="vs">}</span></span>
<span id="cb90-3222"><a href="#cb90-3222" aria-hidden="true" tabindex="-1"></a><span class="vs">.color0 {</span></span>
<span id="cb90-3223"><a href="#cb90-3223" aria-hidden="true" tabindex="-1"></a><span class="vs">  background: hsl(0 100% 50%);</span></span>
<span id="cb90-3224"><a href="#cb90-3224" aria-hidden="true" tabindex="-1"></a><span class="vs">  color: </span><span class="sc">${</span><span class="fu">yiq</span>(<span class="vs">`hsl(0, 100%, 50%)`</span>) <span class="op">&gt;</span> <span class="fl">0.51</span> <span class="op">?</span> <span class="st">"black"</span> <span class="op">:</span> <span class="st">"white"</span><span class="sc">}</span><span class="vs">;</span></span>
<span id="cb90-3225"><a href="#cb90-3225" aria-hidden="true" tabindex="-1"></a><span class="vs">  padding: 0px 5px;</span></span>
<span id="cb90-3226"><a href="#cb90-3226" aria-hidden="true" tabindex="-1"></a><span class="vs">  border-radius: 4px;</span></span>
<span id="cb90-3227"><a href="#cb90-3227" aria-hidden="true" tabindex="-1"></a><span class="vs">  font-weight: 400;</span></span>
<span id="cb90-3228"><a href="#cb90-3228" aria-hidden="true" tabindex="-1"></a><span class="vs">  font-family: monospace;</span></span>
<span id="cb90-3229"><a href="#cb90-3229" aria-hidden="true" tabindex="-1"></a><span class="vs">}</span></span>
<span id="cb90-3230"><a href="#cb90-3230" aria-hidden="true" tabindex="-1"></a><span class="vs">.color1by8640 {</span></span>
<span id="cb90-3231"><a href="#cb90-3231" aria-hidden="true" tabindex="-1"></a><span class="vs">  background: hsl(</span><span class="sc">${</span>h1by8640<span class="sc">}</span><span class="vs"> 100% 50%);</span></span>
<span id="cb90-3232"><a href="#cb90-3232" aria-hidden="true" tabindex="-1"></a><span class="vs">  color: </span><span class="sc">${</span><span class="fu">yiq</span>(<span class="vs">`hsl(</span><span class="sc">${</span>h1by8640<span class="sc">}</span><span class="vs">, 100%, 50%)`</span>) <span class="op">&gt;</span> <span class="fl">0.51</span> <span class="op">?</span> <span class="st">"black"</span> <span class="op">:</span> <span class="st">"white"</span><span class="sc">}</span><span class="vs">;</span></span>
<span id="cb90-3233"><a href="#cb90-3233" aria-hidden="true" tabindex="-1"></a><span class="vs">  padding: 0px 5px;</span></span>
<span id="cb90-3234"><a href="#cb90-3234" aria-hidden="true" tabindex="-1"></a><span class="vs">  border-radius: 4px;</span></span>
<span id="cb90-3235"><a href="#cb90-3235" aria-hidden="true" tabindex="-1"></a><span class="vs">  font-weight: 400;</span></span>
<span id="cb90-3236"><a href="#cb90-3236" aria-hidden="true" tabindex="-1"></a><span class="vs">  font-family: monospace;</span></span>
<span id="cb90-3237"><a href="#cb90-3237" aria-hidden="true" tabindex="-1"></a><span class="vs">}</span></span>
<span id="cb90-3238"><a href="#cb90-3238" aria-hidden="true" tabindex="-1"></a><span class="vs">.color1 {</span></span>
<span id="cb90-3239"><a href="#cb90-3239" aria-hidden="true" tabindex="-1"></a><span class="vs">  background: hsl(300 100% 50%);</span></span>
<span id="cb90-3240"><a href="#cb90-3240" aria-hidden="true" tabindex="-1"></a><span class="vs">  color: </span><span class="sc">${</span><span class="fu">yiq</span>(<span class="vs">`hsl(300, 100%, 50%)`</span>) <span class="op">&gt;</span> <span class="fl">0.51</span> <span class="op">?</span> <span class="st">"black"</span> <span class="op">:</span> <span class="st">"white"</span><span class="sc">}</span><span class="vs">;</span></span>
<span id="cb90-3241"><a href="#cb90-3241" aria-hidden="true" tabindex="-1"></a><span class="vs">  padding: 0px 5px;</span></span>
<span id="cb90-3242"><a href="#cb90-3242" aria-hidden="true" tabindex="-1"></a><span class="vs">  border-radius: 4px;</span></span>
<span id="cb90-3243"><a href="#cb90-3243" aria-hidden="true" tabindex="-1"></a><span class="vs">  font-weight: 400;</span></span>
<span id="cb90-3244"><a href="#cb90-3244" aria-hidden="true" tabindex="-1"></a><span class="vs">  font-family: monospace;</span></span>
<span id="cb90-3245"><a href="#cb90-3245" aria-hidden="true" tabindex="-1"></a><span class="vs">}</span></span>
<span id="cb90-3246"><a href="#cb90-3246" aria-hidden="true" tabindex="-1"></a><span class="vs">.color2 {</span></span>
<span id="cb90-3247"><a href="#cb90-3247" aria-hidden="true" tabindex="-1"></a><span class="vs">  background: hsl(280 100% 50%);</span></span>
<span id="cb90-3248"><a href="#cb90-3248" aria-hidden="true" tabindex="-1"></a><span class="vs">  color: </span><span class="sc">${</span><span class="fu">yiq</span>(<span class="vs">`hsl(280, 100%, 50%)`</span>) <span class="op">&gt;</span> <span class="fl">0.51</span> <span class="op">?</span> <span class="st">"black"</span> <span class="op">:</span> <span class="st">"white"</span><span class="sc">}</span><span class="vs">;</span></span>
<span id="cb90-3249"><a href="#cb90-3249" aria-hidden="true" tabindex="-1"></a><span class="vs">  padding: 0px 5px;</span></span>
<span id="cb90-3250"><a href="#cb90-3250" aria-hidden="true" tabindex="-1"></a><span class="vs">  border-radius: 4px;</span></span>
<span id="cb90-3251"><a href="#cb90-3251" aria-hidden="true" tabindex="-1"></a><span class="vs">  font-weight: 400;</span></span>
<span id="cb90-3252"><a href="#cb90-3252" aria-hidden="true" tabindex="-1"></a><span class="vs">  font-family: monospace;</span></span>
<span id="cb90-3253"><a href="#cb90-3253" aria-hidden="true" tabindex="-1"></a><span class="vs">}</span></span>
<span id="cb90-3254"><a href="#cb90-3254" aria-hidden="true" tabindex="-1"></a><span class="vs">.color3 {</span></span>
<span id="cb90-3255"><a href="#cb90-3255" aria-hidden="true" tabindex="-1"></a><span class="vs">  background: hsl(240 100% 50%);</span></span>
<span id="cb90-3256"><a href="#cb90-3256" aria-hidden="true" tabindex="-1"></a><span class="vs">  color: </span><span class="sc">${</span><span class="fu">yiq</span>(<span class="vs">`hsl(240, 100%, 50%)`</span>) <span class="op">&gt;</span> <span class="fl">0.51</span> <span class="op">?</span> <span class="st">"black"</span> <span class="op">:</span> <span class="st">"white"</span><span class="sc">}</span><span class="vs">;</span></span>
<span id="cb90-3257"><a href="#cb90-3257" aria-hidden="true" tabindex="-1"></a><span class="vs">  padding: 0px 5px;</span></span>
<span id="cb90-3258"><a href="#cb90-3258" aria-hidden="true" tabindex="-1"></a><span class="vs">  border-radius: 4px;</span></span>
<span id="cb90-3259"><a href="#cb90-3259" aria-hidden="true" tabindex="-1"></a><span class="vs">  font-weight: 400;</span></span>
<span id="cb90-3260"><a href="#cb90-3260" aria-hidden="true" tabindex="-1"></a><span class="vs">  font-family: monospace;</span></span>
<span id="cb90-3261"><a href="#cb90-3261" aria-hidden="true" tabindex="-1"></a><span class="vs">}</span></span>
<span id="cb90-3262"><a href="#cb90-3262" aria-hidden="true" tabindex="-1"></a><span class="vs">.color4 {</span></span>
<span id="cb90-3263"><a href="#cb90-3263" aria-hidden="true" tabindex="-1"></a><span class="vs">  background: hsl(200 100% 50%);</span></span>
<span id="cb90-3264"><a href="#cb90-3264" aria-hidden="true" tabindex="-1"></a><span class="vs">  color: </span><span class="sc">${</span><span class="fu">yiq</span>(<span class="vs">`hsl(200, 100%, 50%)`</span>) <span class="op">&gt;</span> <span class="fl">0.51</span> <span class="op">?</span> <span class="st">"black"</span> <span class="op">:</span> <span class="st">"white"</span><span class="sc">}</span><span class="vs">;</span></span>
<span id="cb90-3265"><a href="#cb90-3265" aria-hidden="true" tabindex="-1"></a><span class="vs">  padding: 0px 5px;</span></span>
<span id="cb90-3266"><a href="#cb90-3266" aria-hidden="true" tabindex="-1"></a><span class="vs">  border-radius: 4px;</span></span>
<span id="cb90-3267"><a href="#cb90-3267" aria-hidden="true" tabindex="-1"></a><span class="vs">  font-weight: 400;</span></span>
<span id="cb90-3268"><a href="#cb90-3268" aria-hidden="true" tabindex="-1"></a><span class="vs">  font-family: monospace;</span></span>
<span id="cb90-3269"><a href="#cb90-3269" aria-hidden="true" tabindex="-1"></a><span class="vs">}</span></span>
<span id="cb90-3270"><a href="#cb90-3270" aria-hidden="true" tabindex="-1"></a><span class="vs">.color5 {</span></span>
<span id="cb90-3271"><a href="#cb90-3271" aria-hidden="true" tabindex="-1"></a><span class="vs">  background: hsl(180 100% 50%);</span></span>
<span id="cb90-3272"><a href="#cb90-3272" aria-hidden="true" tabindex="-1"></a><span class="vs">  color: </span><span class="sc">${</span><span class="fu">yiq</span>(<span class="vs">`hsl(180, 100%, 50%)`</span>) <span class="op">&gt;</span> <span class="fl">0.51</span> <span class="op">?</span> <span class="st">"black"</span> <span class="op">:</span> <span class="st">"white"</span><span class="sc">}</span><span class="vs">;</span></span>
<span id="cb90-3273"><a href="#cb90-3273" aria-hidden="true" tabindex="-1"></a><span class="vs">  padding: 0px 5px;</span></span>
<span id="cb90-3274"><a href="#cb90-3274" aria-hidden="true" tabindex="-1"></a><span class="vs">  border-radius: 4px;</span></span>
<span id="cb90-3275"><a href="#cb90-3275" aria-hidden="true" tabindex="-1"></a><span class="vs">  font-weight: 400;</span></span>
<span id="cb90-3276"><a href="#cb90-3276" aria-hidden="true" tabindex="-1"></a><span class="vs">  font-family: monospace;</span></span>
<span id="cb90-3277"><a href="#cb90-3277" aria-hidden="true" tabindex="-1"></a><span class="vs">}</span></span>
<span id="cb90-3278"><a href="#cb90-3278" aria-hidden="true" tabindex="-1"></a><span class="vs">.color583 {</span></span>
<span id="cb90-3279"><a href="#cb90-3279" aria-hidden="true" tabindex="-1"></a><span class="vs">  background: hsl(129.88235294117646 100% 50%);</span></span>
<span id="cb90-3280"><a href="#cb90-3280" aria-hidden="true" tabindex="-1"></a><span class="vs">  color: </span><span class="sc">${</span><span class="fu">yiq</span>(<span class="vs">`hsl(129.88235294117646, 100%, 50%)`</span>) <span class="op">&gt;</span> <span class="fl">0.51</span> <span class="op">?</span> <span class="st">"black"</span> <span class="op">:</span> <span class="st">"white"</span><span class="sc">}</span><span class="vs">;</span></span>
<span id="cb90-3281"><a href="#cb90-3281" aria-hidden="true" tabindex="-1"></a><span class="vs">  padding: 0px 5px;</span></span>
<span id="cb90-3282"><a href="#cb90-3282" aria-hidden="true" tabindex="-1"></a><span class="vs">  border-radius: 4px;</span></span>
<span id="cb90-3283"><a href="#cb90-3283" aria-hidden="true" tabindex="-1"></a><span class="vs">  font-weight: 400;</span></span>
<span id="cb90-3284"><a href="#cb90-3284" aria-hidden="true" tabindex="-1"></a><span class="vs">  font-family: monospace;</span></span>
<span id="cb90-3285"><a href="#cb90-3285" aria-hidden="true" tabindex="-1"></a><span class="vs">}</span></span>
<span id="cb90-3286"><a href="#cb90-3286" aria-hidden="true" tabindex="-1"></a><span class="vs">.color6 {</span></span>
<span id="cb90-3287"><a href="#cb90-3287" aria-hidden="true" tabindex="-1"></a><span class="vs">  background: hsl(120 100% 50%);</span></span>
<span id="cb90-3288"><a href="#cb90-3288" aria-hidden="true" tabindex="-1"></a><span class="vs">  color: </span><span class="sc">${</span><span class="fu">yiq</span>(<span class="vs">`hsl(120, 100%, 50%)`</span>) <span class="op">&gt;</span> <span class="fl">0.51</span> <span class="op">?</span> <span class="st">"black"</span> <span class="op">:</span> <span class="st">"white"</span><span class="sc">}</span><span class="vs">;</span></span>
<span id="cb90-3289"><a href="#cb90-3289" aria-hidden="true" tabindex="-1"></a><span class="vs">  padding: 0px 5px;</span></span>
<span id="cb90-3290"><a href="#cb90-3290" aria-hidden="true" tabindex="-1"></a><span class="vs">  border-radius: 4px;</span></span>
<span id="cb90-3291"><a href="#cb90-3291" aria-hidden="true" tabindex="-1"></a><span class="vs">  font-weight: 400;</span></span>
<span id="cb90-3292"><a href="#cb90-3292" aria-hidden="true" tabindex="-1"></a><span class="vs">  font-family: monospace;</span></span>
<span id="cb90-3293"><a href="#cb90-3293" aria-hidden="true" tabindex="-1"></a><span class="vs">}</span></span>
<span id="cb90-3294"><a href="#cb90-3294" aria-hidden="true" tabindex="-1"></a><span class="vs">.color7 {</span></span>
<span id="cb90-3295"><a href="#cb90-3295" aria-hidden="true" tabindex="-1"></a><span class="vs">  background: hsl(80 100% 50%);</span></span>
<span id="cb90-3296"><a href="#cb90-3296" aria-hidden="true" tabindex="-1"></a><span class="vs">  color: </span><span class="sc">${</span><span class="fu">yiq</span>(<span class="vs">`hsl(80, 100%, 50%)`</span>) <span class="op">&gt;</span> <span class="fl">0.51</span> <span class="op">?</span> <span class="st">"black"</span> <span class="op">:</span> <span class="st">"white"</span><span class="sc">}</span><span class="vs">;</span></span>
<span id="cb90-3297"><a href="#cb90-3297" aria-hidden="true" tabindex="-1"></a><span class="vs">  padding: 0px 5px;</span></span>
<span id="cb90-3298"><a href="#cb90-3298" aria-hidden="true" tabindex="-1"></a><span class="vs">  border-radius: 4px;</span></span>
<span id="cb90-3299"><a href="#cb90-3299" aria-hidden="true" tabindex="-1"></a><span class="vs">  font-weight: 400;</span></span>
<span id="cb90-3300"><a href="#cb90-3300" aria-hidden="true" tabindex="-1"></a><span class="vs">  font-family: monospace;</span></span>
<span id="cb90-3301"><a href="#cb90-3301" aria-hidden="true" tabindex="-1"></a><span class="vs">}</span></span>
<span id="cb90-3302"><a href="#cb90-3302" aria-hidden="true" tabindex="-1"></a><span class="vs">.color8 {</span></span>
<span id="cb90-3303"><a href="#cb90-3303" aria-hidden="true" tabindex="-1"></a><span class="vs">  background: hsl(60 100% 50%);</span></span>
<span id="cb90-3304"><a href="#cb90-3304" aria-hidden="true" tabindex="-1"></a><span class="vs">  color: </span><span class="sc">${</span><span class="fu">yiq</span>(<span class="vs">`hsl(60, 100%, 50%)`</span>) <span class="op">&gt;</span> <span class="fl">0.51</span> <span class="op">?</span> <span class="st">"black"</span> <span class="op">:</span> <span class="st">"white"</span><span class="sc">}</span><span class="vs">;</span></span>
<span id="cb90-3305"><a href="#cb90-3305" aria-hidden="true" tabindex="-1"></a><span class="vs">  padding: 0px 5px;</span></span>
<span id="cb90-3306"><a href="#cb90-3306" aria-hidden="true" tabindex="-1"></a><span class="vs">  border-radius: 4px;</span></span>
<span id="cb90-3307"><a href="#cb90-3307" aria-hidden="true" tabindex="-1"></a><span class="vs">  font-weight: 400;</span></span>
<span id="cb90-3308"><a href="#cb90-3308" aria-hidden="true" tabindex="-1"></a><span class="vs">  font-family: monospace;</span></span>
<span id="cb90-3309"><a href="#cb90-3309" aria-hidden="true" tabindex="-1"></a><span class="vs">}</span></span>
<span id="cb90-3310"><a href="#cb90-3310" aria-hidden="true" tabindex="-1"></a><span class="vs">.color9 {</span></span>
<span id="cb90-3311"><a href="#cb90-3311" aria-hidden="true" tabindex="-1"></a><span class="vs">  background: hsl(40 100% 50%);</span></span>
<span id="cb90-3312"><a href="#cb90-3312" aria-hidden="true" tabindex="-1"></a><span class="vs">  color: </span><span class="sc">${</span><span class="fu">yiq</span>(<span class="vs">`hsl(40, 100%, 50%)`</span>) <span class="op">&gt;</span> <span class="fl">0.51</span> <span class="op">?</span> <span class="st">"black"</span> <span class="op">:</span> <span class="st">"white"</span><span class="sc">}</span><span class="vs">;</span></span>
<span id="cb90-3313"><a href="#cb90-3313" aria-hidden="true" tabindex="-1"></a><span class="vs">  padding: 0px 5px;</span></span>
<span id="cb90-3314"><a href="#cb90-3314" aria-hidden="true" tabindex="-1"></a><span class="vs">  border-radius: 4px;</span></span>
<span id="cb90-3315"><a href="#cb90-3315" aria-hidden="true" tabindex="-1"></a><span class="vs">  font-weight: 400;</span></span>
<span id="cb90-3316"><a href="#cb90-3316" aria-hidden="true" tabindex="-1"></a><span class="vs">  font-family: monospace;</span></span>
<span id="cb90-3317"><a href="#cb90-3317" aria-hidden="true" tabindex="-1"></a><span class="vs">}</span></span>
<span id="cb90-3318"><a href="#cb90-3318" aria-hidden="true" tabindex="-1"></a><span class="vs">.color375 {</span></span>
<span id="cb90-3319"><a href="#cb90-3319" aria-hidden="true" tabindex="-1"></a><span class="vs">  background: hsl(</span><span class="sc">${</span>hues[<span class="fl">0.375</span>]<span class="sc">}</span><span class="vs"> 100% 50%);</span></span>
<span id="cb90-3320"><a href="#cb90-3320" aria-hidden="true" tabindex="-1"></a><span class="vs">  color: </span><span class="sc">${</span><span class="fu">yiq</span>(<span class="vs">`hsl(</span><span class="sc">${</span>hues[<span class="fl">0.375</span>]<span class="sc">}</span><span class="vs">, 100%, 50%)`</span>) <span class="op">&gt;</span> <span class="fl">0.51</span> <span class="op">?</span> <span class="st">"black"</span> <span class="op">:</span> <span class="st">"white"</span><span class="sc">}</span><span class="vs">;</span></span>
<span id="cb90-3321"><a href="#cb90-3321" aria-hidden="true" tabindex="-1"></a><span class="vs">  padding: 0px 5px;</span></span>
<span id="cb90-3322"><a href="#cb90-3322" aria-hidden="true" tabindex="-1"></a><span class="vs">  border-radius: 4px;</span></span>
<span id="cb90-3323"><a href="#cb90-3323" aria-hidden="true" tabindex="-1"></a><span class="vs">  font-weight: 400;</span></span>
<span id="cb90-3324"><a href="#cb90-3324" aria-hidden="true" tabindex="-1"></a><span class="vs">  font-family: monospace;</span></span>
<span id="cb90-3325"><a href="#cb90-3325" aria-hidden="true" tabindex="-1"></a><span class="vs">}</span></span>
<span id="cb90-3326"><a href="#cb90-3326" aria-hidden="true" tabindex="-1"></a><span class="vs">.color0083 {</span></span>
<span id="cb90-3327"><a href="#cb90-3327" aria-hidden="true" tabindex="-1"></a><span class="vs">  background: hsl(</span><span class="sc">${</span>hues[<span class="fl">0.0083</span>]<span class="sc">}</span><span class="vs"> 100% 50%);</span></span>
<span id="cb90-3328"><a href="#cb90-3328" aria-hidden="true" tabindex="-1"></a><span class="vs">  color: </span><span class="sc">${</span><span class="fu">yiq</span>(<span class="vs">`hsl(</span><span class="sc">${</span>hues[<span class="fl">0.0083</span>]<span class="sc">}</span><span class="vs">, 100%, 50%)`</span>) <span class="op">&gt;</span> <span class="fl">0.51</span> <span class="op">?</span> <span class="st">"black"</span> <span class="op">:</span> <span class="st">"white"</span><span class="sc">}</span><span class="vs">;</span></span>
<span id="cb90-3329"><a href="#cb90-3329" aria-hidden="true" tabindex="-1"></a><span class="vs">  padding: 0px 5px;</span></span>
<span id="cb90-3330"><a href="#cb90-3330" aria-hidden="true" tabindex="-1"></a><span class="vs">  border-radius: 4px;</span></span>
<span id="cb90-3331"><a href="#cb90-3331" aria-hidden="true" tabindex="-1"></a><span class="vs">  font-weight: 400;</span></span>
<span id="cb90-3332"><a href="#cb90-3332" aria-hidden="true" tabindex="-1"></a><span class="vs">  font-family: monospace;</span></span>
<span id="cb90-3333"><a href="#cb90-3333" aria-hidden="true" tabindex="-1"></a><span class="vs">}</span></span>
<span id="cb90-3334"><a href="#cb90-3334" aria-hidden="true" tabindex="-1"></a><span class="vs">.color0166 {</span></span>
<span id="cb90-3335"><a href="#cb90-3335" aria-hidden="true" tabindex="-1"></a><span class="vs">  background: hsl(</span><span class="sc">${</span>hues[<span class="fl">0.0166</span>]<span class="sc">}</span><span class="vs"> 100% 50%);</span></span>
<span id="cb90-3336"><a href="#cb90-3336" aria-hidden="true" tabindex="-1"></a><span class="vs">  color: </span><span class="sc">${</span><span class="fu">yiq</span>(<span class="vs">`hsl(</span><span class="sc">${</span>hues[<span class="fl">0.0166</span>]<span class="sc">}</span><span class="vs">, 100%, 50%)`</span>) <span class="op">&gt;</span> <span class="fl">0.51</span> <span class="op">?</span> <span class="st">"black"</span> <span class="op">:</span> <span class="st">"white"</span><span class="sc">}</span><span class="vs">;</span></span>
<span id="cb90-3337"><a href="#cb90-3337" aria-hidden="true" tabindex="-1"></a><span class="vs">  padding: 0px 5px;</span></span>
<span id="cb90-3338"><a href="#cb90-3338" aria-hidden="true" tabindex="-1"></a><span class="vs">  border-radius: 4px;</span></span>
<span id="cb90-3339"><a href="#cb90-3339" aria-hidden="true" tabindex="-1"></a><span class="vs">  font-weight: 400;</span></span>
<span id="cb90-3340"><a href="#cb90-3340" aria-hidden="true" tabindex="-1"></a><span class="vs">  font-family: monospace;</span></span>
<span id="cb90-3341"><a href="#cb90-3341" aria-hidden="true" tabindex="-1"></a><span class="vs">}</span></span>
<span id="cb90-3342"><a href="#cb90-3342" aria-hidden="true" tabindex="-1"></a><span class="vs">.color55by24 {</span></span>
<span id="cb90-3343"><a href="#cb90-3343" aria-hidden="true" tabindex="-1"></a><span class="vs">  background: hsl(</span><span class="sc">${</span>hues[<span class="op">.</span><span class="dv">0229</span>]<span class="sc">}</span><span class="vs"> 100% 50%);</span></span>
<span id="cb90-3344"><a href="#cb90-3344" aria-hidden="true" tabindex="-1"></a><span class="vs">  color: </span><span class="sc">${</span><span class="fu">yiq</span>(<span class="vs">`hsl(</span><span class="sc">${</span>hues[<span class="op">.</span><span class="dv">0229</span>]<span class="sc">}</span><span class="vs">, 100%, 50%)`</span>) <span class="op">&gt;</span> <span class="fl">0.51</span> <span class="op">?</span> <span class="st">"black"</span> <span class="op">:</span> <span class="st">"white"</span><span class="sc">}</span><span class="vs">;</span></span>
<span id="cb90-3345"><a href="#cb90-3345" aria-hidden="true" tabindex="-1"></a><span class="vs">  padding: 0px 5px;</span></span>
<span id="cb90-3346"><a href="#cb90-3346" aria-hidden="true" tabindex="-1"></a><span class="vs">  border-radius: 4px;</span></span>
<span id="cb90-3347"><a href="#cb90-3347" aria-hidden="true" tabindex="-1"></a><span class="vs">  font-weight: 400;</span></span>
<span id="cb90-3348"><a href="#cb90-3348" aria-hidden="true" tabindex="-1"></a><span class="vs">  font-family: monospace;</span></span>
<span id="cb90-3349"><a href="#cb90-3349" aria-hidden="true" tabindex="-1"></a><span class="vs">}</span></span>
<span id="cb90-3350"><a href="#cb90-3350" aria-hidden="true" tabindex="-1"></a><span class="vs">.color125 {</span></span>
<span id="cb90-3351"><a href="#cb90-3351" aria-hidden="true" tabindex="-1"></a><span class="vs">  background: hsl(</span><span class="sc">${</span>hues[<span class="op">.</span><span class="dv">125</span>]<span class="sc">}</span><span class="vs"> 100% 50%);</span></span>
<span id="cb90-3352"><a href="#cb90-3352" aria-hidden="true" tabindex="-1"></a><span class="vs">  color: </span><span class="sc">${</span><span class="fu">yiq</span>(<span class="vs">`hsl(</span><span class="sc">${</span>hues[<span class="op">.</span><span class="dv">125</span>]<span class="sc">}</span><span class="vs">, 100%, 50%)`</span>) <span class="op">&gt;</span> <span class="fl">0.51</span> <span class="op">?</span> <span class="st">"black"</span> <span class="op">:</span> <span class="st">"white"</span><span class="sc">}</span><span class="vs">;</span></span>
<span id="cb90-3353"><a href="#cb90-3353" aria-hidden="true" tabindex="-1"></a><span class="vs">  padding: 0px 5px;</span></span>
<span id="cb90-3354"><a href="#cb90-3354" aria-hidden="true" tabindex="-1"></a><span class="vs">  border-radius: 4px;</span></span>
<span id="cb90-3355"><a href="#cb90-3355" aria-hidden="true" tabindex="-1"></a><span class="vs">  font-weight: 400;</span></span>
<span id="cb90-3356"><a href="#cb90-3356" aria-hidden="true" tabindex="-1"></a><span class="vs">  font-family: monospace;</span></span>
<span id="cb90-3357"><a href="#cb90-3357" aria-hidden="true" tabindex="-1"></a><span class="vs">}</span></span>
<span id="cb90-3358"><a href="#cb90-3358" aria-hidden="true" tabindex="-1"></a><span class="vs">.color025 {</span></span>
<span id="cb90-3359"><a href="#cb90-3359" aria-hidden="true" tabindex="-1"></a><span class="vs">  background: hsl(</span><span class="sc">${</span>hues[<span class="fl">0.025</span>]<span class="sc">}</span><span class="vs"> 100% 50%);</span></span>
<span id="cb90-3360"><a href="#cb90-3360" aria-hidden="true" tabindex="-1"></a><span class="vs">  color: </span><span class="sc">${</span><span class="fu">yiq</span>(<span class="vs">`hsl(</span><span class="sc">${</span>hues[<span class="fl">0.025</span>]<span class="sc">}</span><span class="vs">, 100%, 50%)`</span>) <span class="op">&gt;</span> <span class="fl">0.51</span> <span class="op">?</span> <span class="st">"black"</span> <span class="op">:</span> <span class="st">"white"</span><span class="sc">}</span><span class="vs">;</span></span>
<span id="cb90-3361"><a href="#cb90-3361" aria-hidden="true" tabindex="-1"></a><span class="vs">  padding: 0px 5px;</span></span>
<span id="cb90-3362"><a href="#cb90-3362" aria-hidden="true" tabindex="-1"></a><span class="vs">  border-radius: 4px;</span></span>
<span id="cb90-3363"><a href="#cb90-3363" aria-hidden="true" tabindex="-1"></a><span class="vs">  font-weight: 400;</span></span>
<span id="cb90-3364"><a href="#cb90-3364" aria-hidden="true" tabindex="-1"></a><span class="vs">  font-family: monospace;</span></span>
<span id="cb90-3365"><a href="#cb90-3365" aria-hidden="true" tabindex="-1"></a><span class="vs">}</span></span>
<span id="cb90-3366"><a href="#cb90-3366" aria-hidden="true" tabindex="-1"></a><span class="vs">.color287 {</span></span>
<span id="cb90-3367"><a href="#cb90-3367" aria-hidden="true" tabindex="-1"></a><span class="vs">  background: hsl(</span><span class="sc">${</span>hues[<span class="fl">0.287</span>]<span class="sc">}</span><span class="vs"> 100% 50%);</span></span>
<span id="cb90-3368"><a href="#cb90-3368" aria-hidden="true" tabindex="-1"></a><span class="vs">  color: </span><span class="sc">${</span><span class="fu">yiq</span>(<span class="vs">`hsl(</span><span class="sc">${</span>hues[<span class="fl">0.287</span>]<span class="sc">}</span><span class="vs">, 100%, 50%)`</span>) <span class="op">&gt;</span> <span class="fl">0.51</span> <span class="op">?</span> <span class="st">"black"</span> <span class="op">:</span> <span class="st">"white"</span><span class="sc">}</span><span class="vs">;</span></span>
<span id="cb90-3369"><a href="#cb90-3369" aria-hidden="true" tabindex="-1"></a><span class="vs">  padding: 0px 5px;</span></span>
<span id="cb90-3370"><a href="#cb90-3370" aria-hidden="true" tabindex="-1"></a><span class="vs">  border-radius: 4px;</span></span>
<span id="cb90-3371"><a href="#cb90-3371" aria-hidden="true" tabindex="-1"></a><span class="vs">  font-weight: 400;</span></span>
<span id="cb90-3372"><a href="#cb90-3372" aria-hidden="true" tabindex="-1"></a><span class="vs">  font-family: monospace;</span></span>
<span id="cb90-3373"><a href="#cb90-3373" aria-hidden="true" tabindex="-1"></a><span class="vs">}</span></span>
<span id="cb90-3374"><a href="#cb90-3374" aria-hidden="true" tabindex="-1"></a><span class="vs">.color333 {</span></span>
<span id="cb90-3375"><a href="#cb90-3375" aria-hidden="true" tabindex="-1"></a><span class="vs">  background: hsl(</span><span class="sc">${</span>hues[<span class="fl">0.333</span>]<span class="sc">}</span><span class="vs"> 100% 50%);</span></span>
<span id="cb90-3376"><a href="#cb90-3376" aria-hidden="true" tabindex="-1"></a><span class="vs">  color: </span><span class="sc">${</span><span class="fu">yiq</span>(<span class="vs">`hsl(</span><span class="sc">${</span>hues[<span class="fl">0.333</span>]<span class="sc">}</span><span class="vs">, 100%, 50%)`</span>) <span class="op">&gt;</span> <span class="fl">0.51</span> <span class="op">?</span> <span class="st">"black"</span> <span class="op">:</span> <span class="st">"white"</span><span class="sc">}</span><span class="vs">;</span></span>
<span id="cb90-3377"><a href="#cb90-3377" aria-hidden="true" tabindex="-1"></a><span class="vs">  padding: 0px 5px;</span></span>
<span id="cb90-3378"><a href="#cb90-3378" aria-hidden="true" tabindex="-1"></a><span class="vs">  border-radius: 4px;</span></span>
<span id="cb90-3379"><a href="#cb90-3379" aria-hidden="true" tabindex="-1"></a><span class="vs">  font-weight: 400;</span></span>
<span id="cb90-3380"><a href="#cb90-3380" aria-hidden="true" tabindex="-1"></a><span class="vs">  font-family: monospace;</span></span>
<span id="cb90-3381"><a href="#cb90-3381" aria-hidden="true" tabindex="-1"></a><span class="vs">}</span></span>
<span id="cb90-3382"><a href="#cb90-3382" aria-hidden="true" tabindex="-1"></a><span class="vs">.color0333 {</span></span>
<span id="cb90-3383"><a href="#cb90-3383" aria-hidden="true" tabindex="-1"></a><span class="vs">  background: hsl(</span><span class="sc">${</span>hues[<span class="fl">0.0333</span>]<span class="sc">}</span><span class="vs"> 100% 50%);</span></span>
<span id="cb90-3384"><a href="#cb90-3384" aria-hidden="true" tabindex="-1"></a><span class="vs">  color: </span><span class="sc">${</span><span class="fu">yiq</span>(<span class="vs">`hsl(</span><span class="sc">${</span>hues[<span class="fl">0.0333</span>]<span class="sc">}</span><span class="vs">, 100%, 50%)`</span>) <span class="op">&gt;</span> <span class="fl">0.51</span> <span class="op">?</span> <span class="st">"black"</span> <span class="op">:</span> <span class="st">"white"</span><span class="sc">}</span><span class="vs">;</span></span>
<span id="cb90-3385"><a href="#cb90-3385" aria-hidden="true" tabindex="-1"></a><span class="vs">  padding: 0px 5px;</span></span>
<span id="cb90-3386"><a href="#cb90-3386" aria-hidden="true" tabindex="-1"></a><span class="vs">  border-radius: 4px;</span></span>
<span id="cb90-3387"><a href="#cb90-3387" aria-hidden="true" tabindex="-1"></a><span class="vs">  font-weight: 400;</span></span>
<span id="cb90-3388"><a href="#cb90-3388" aria-hidden="true" tabindex="-1"></a><span class="vs">  font-family: monospace;</span></span>
<span id="cb90-3389"><a href="#cb90-3389" aria-hidden="true" tabindex="-1"></a><span class="vs">}</span></span>
<span id="cb90-3390"><a href="#cb90-3390" aria-hidden="true" tabindex="-1"></a><span class="vs">.color0416 {</span></span>
<span id="cb90-3391"><a href="#cb90-3391" aria-hidden="true" tabindex="-1"></a><span class="vs">  background: hsl(</span><span class="sc">${</span>hues[<span class="fl">0.0416</span>]<span class="sc">}</span><span class="vs"> 100% 50%);</span></span>
<span id="cb90-3392"><a href="#cb90-3392" aria-hidden="true" tabindex="-1"></a><span class="vs">  color: </span><span class="sc">${</span><span class="fu">yiq</span>(<span class="vs">`hsl(</span><span class="sc">${</span>hues[<span class="fl">0.0416</span>]<span class="sc">}</span><span class="vs">, 100%, 50%)`</span>) <span class="op">&gt;</span> <span class="fl">0.51</span> <span class="op">?</span> <span class="st">"black"</span> <span class="op">:</span> <span class="st">"white"</span><span class="sc">}</span><span class="vs">;</span></span>
<span id="cb90-3393"><a href="#cb90-3393" aria-hidden="true" tabindex="-1"></a><span class="vs">  padding: 0px 5px;</span></span>
<span id="cb90-3394"><a href="#cb90-3394" aria-hidden="true" tabindex="-1"></a><span class="vs">  border-radius: 4px;</span></span>
<span id="cb90-3395"><a href="#cb90-3395" aria-hidden="true" tabindex="-1"></a><span class="vs">  font-weight: 400;</span></span>
<span id="cb90-3396"><a href="#cb90-3396" aria-hidden="true" tabindex="-1"></a><span class="vs">  font-family: monospace;</span></span>
<span id="cb90-3397"><a href="#cb90-3397" aria-hidden="true" tabindex="-1"></a><span class="vs">}</span></span>
<span id="cb90-3398"><a href="#cb90-3398" aria-hidden="true" tabindex="-1"></a><span class="vs">.color429 {</span></span>
<span id="cb90-3399"><a href="#cb90-3399" aria-hidden="true" tabindex="-1"></a><span class="vs">  background: hsl(</span><span class="sc">${</span>hues[<span class="fl">0.429</span>]<span class="sc">}</span><span class="vs"> 100% 50%);</span></span>
<span id="cb90-3400"><a href="#cb90-3400" aria-hidden="true" tabindex="-1"></a><span class="vs">  color: </span><span class="sc">${</span><span class="fu">yiq</span>(<span class="vs">`hsl(</span><span class="sc">${</span>hues[<span class="fl">0.429</span>]<span class="sc">}</span><span class="vs">, 100%, 50%)`</span>) <span class="op">&gt;</span> <span class="fl">0.51</span> <span class="op">?</span> <span class="st">"black"</span> <span class="op">:</span> <span class="st">"white"</span><span class="sc">}</span><span class="vs">;</span></span>
<span id="cb90-3401"><a href="#cb90-3401" aria-hidden="true" tabindex="-1"></a><span class="vs">  padding: 0px 5px;</span></span>
<span id="cb90-3402"><a href="#cb90-3402" aria-hidden="true" tabindex="-1"></a><span class="vs">  border-radius: 4px;</span></span>
<span id="cb90-3403"><a href="#cb90-3403" aria-hidden="true" tabindex="-1"></a><span class="vs">  font-weight: 400;</span></span>
<span id="cb90-3404"><a href="#cb90-3404" aria-hidden="true" tabindex="-1"></a><span class="vs">  font-family: monospace;</span></span>
<span id="cb90-3405"><a href="#cb90-3405" aria-hidden="true" tabindex="-1"></a><span class="vs">}</span></span>
<span id="cb90-3406"><a href="#cb90-3406" aria-hidden="true" tabindex="-1"></a><span class="vs">.color05 {</span></span>
<span id="cb90-3407"><a href="#cb90-3407" aria-hidden="true" tabindex="-1"></a><span class="vs">  background: hsl(</span><span class="sc">${</span>hues[<span class="fl">0.05</span>]<span class="sc">}</span><span class="vs"> 100% 50%);</span></span>
<span id="cb90-3408"><a href="#cb90-3408" aria-hidden="true" tabindex="-1"></a><span class="vs">  color: </span><span class="sc">${</span><span class="fu">yiq</span>(<span class="vs">`hsl(</span><span class="sc">${</span>hues[<span class="fl">0.05</span>]<span class="sc">}</span><span class="vs">, 100%, 50%)`</span>) <span class="op">&gt;</span> <span class="fl">0.51</span> <span class="op">?</span> <span class="st">"black"</span> <span class="op">:</span> <span class="st">"white"</span><span class="sc">}</span><span class="vs">;</span></span>
<span id="cb90-3409"><a href="#cb90-3409" aria-hidden="true" tabindex="-1"></a><span class="vs">  padding: 0px 5px;</span></span>
<span id="cb90-3410"><a href="#cb90-3410" aria-hidden="true" tabindex="-1"></a><span class="vs">  border-radius: 4px;</span></span>
<span id="cb90-3411"><a href="#cb90-3411" aria-hidden="true" tabindex="-1"></a><span class="vs">  font-weight: 400;</span></span>
<span id="cb90-3412"><a href="#cb90-3412" aria-hidden="true" tabindex="-1"></a><span class="vs">  font-family: monospace;</span></span>
<span id="cb90-3413"><a href="#cb90-3413" aria-hidden="true" tabindex="-1"></a><span class="vs">}</span></span>
<span id="cb90-3414"><a href="#cb90-3414" aria-hidden="true" tabindex="-1"></a><span class="vs">.color533 {</span></span>
<span id="cb90-3415"><a href="#cb90-3415" aria-hidden="true" tabindex="-1"></a><span class="vs">  background: hsl(</span><span class="sc">${</span>hues[<span class="fl">0.533</span>]<span class="sc">}</span><span class="vs"> 100% 50%);</span></span>
<span id="cb90-3416"><a href="#cb90-3416" aria-hidden="true" tabindex="-1"></a><span class="vs">  color: </span><span class="sc">${</span><span class="fu">yiq</span>(<span class="vs">`hsl(</span><span class="sc">${</span>hues[<span class="fl">0.533</span>]<span class="sc">}</span><span class="vs">, 100%, 50%)`</span>) <span class="op">&gt;</span> <span class="fl">0.51</span> <span class="op">?</span> <span class="st">"black"</span> <span class="op">:</span> <span class="st">"white"</span><span class="sc">}</span><span class="vs">;</span></span>
<span id="cb90-3417"><a href="#cb90-3417" aria-hidden="true" tabindex="-1"></a><span class="vs">  padding: 0px 5px;</span></span>
<span id="cb90-3418"><a href="#cb90-3418" aria-hidden="true" tabindex="-1"></a><span class="vs">  border-radius: 4px;</span></span>
<span id="cb90-3419"><a href="#cb90-3419" aria-hidden="true" tabindex="-1"></a><span class="vs">  font-weight: 400;</span></span>
<span id="cb90-3420"><a href="#cb90-3420" aria-hidden="true" tabindex="-1"></a><span class="vs">  font-family: monospace;</span></span>
<span id="cb90-3421"><a href="#cb90-3421" aria-hidden="true" tabindex="-1"></a><span class="vs">}</span></span>
<span id="cb90-3422"><a href="#cb90-3422" aria-hidden="true" tabindex="-1"></a><span class="vs">.color969 {</span></span>
<span id="cb90-3423"><a href="#cb90-3423" aria-hidden="true" tabindex="-1"></a><span class="vs">  background: hsl(</span><span class="sc">${</span>hues[<span class="fl">0.969</span>]<span class="sc">}</span><span class="vs"> 100% 50%);</span></span>
<span id="cb90-3424"><a href="#cb90-3424" aria-hidden="true" tabindex="-1"></a><span class="vs">  color: </span><span class="sc">${</span><span class="fu">yiq</span>(<span class="vs">`hsl(</span><span class="sc">${</span>hues[<span class="fl">0.969</span>]<span class="sc">}</span><span class="vs">, 100%, 50%)`</span>) <span class="op">&gt;</span> <span class="fl">0.51</span> <span class="op">?</span> <span class="st">"black"</span> <span class="op">:</span> <span class="st">"white"</span><span class="sc">}</span><span class="vs">;</span></span>
<span id="cb90-3425"><a href="#cb90-3425" aria-hidden="true" tabindex="-1"></a><span class="vs">  padding: 0px 5px;</span></span>
<span id="cb90-3426"><a href="#cb90-3426" aria-hidden="true" tabindex="-1"></a><span class="vs">  border-radius: 4px;</span></span>
<span id="cb90-3427"><a href="#cb90-3427" aria-hidden="true" tabindex="-1"></a><span class="vs">  font-weight: 400;</span></span>
<span id="cb90-3428"><a href="#cb90-3428" aria-hidden="true" tabindex="-1"></a><span class="vs">  font-family: monospace;</span></span>
<span id="cb90-3429"><a href="#cb90-3429" aria-hidden="true" tabindex="-1"></a><span class="vs">}</span></span>
<span id="cb90-3430"><a href="#cb90-3430" aria-hidden="true" tabindex="-1"></a><span class="vs">.color999 {</span></span>
<span id="cb90-3431"><a href="#cb90-3431" aria-hidden="true" tabindex="-1"></a><span class="vs">  background: hsl(</span><span class="sc">${</span>hues[<span class="fl">0.999</span>]<span class="sc">}</span><span class="vs"> 100% 50%);</span></span>
<span id="cb90-3432"><a href="#cb90-3432" aria-hidden="true" tabindex="-1"></a><span class="vs">  color: </span><span class="sc">${</span><span class="fu">yiq</span>(<span class="vs">`hsl(</span><span class="sc">${</span>hues[<span class="fl">0.999</span>]<span class="sc">}</span><span class="vs">, 100%, 50%)`</span>) <span class="op">&gt;</span> <span class="fl">0.51</span> <span class="op">?</span> <span class="st">"black"</span> <span class="op">:</span> <span class="st">"white"</span><span class="sc">}</span><span class="vs">;</span></span>
<span id="cb90-3433"><a href="#cb90-3433" aria-hidden="true" tabindex="-1"></a><span class="vs">  padding: 0px 5px;</span></span>
<span id="cb90-3434"><a href="#cb90-3434" aria-hidden="true" tabindex="-1"></a><span class="vs">  border-radius: 4px;</span></span>
<span id="cb90-3435"><a href="#cb90-3435" aria-hidden="true" tabindex="-1"></a><span class="vs">  font-weight: 400;</span></span>
<span id="cb90-3436"><a href="#cb90-3436" aria-hidden="true" tabindex="-1"></a><span class="vs">  font-family: monospace;</span></span>
<span id="cb90-3437"><a href="#cb90-3437" aria-hidden="true" tabindex="-1"></a><span class="vs">}</span></span>
<span id="cb90-3438"><a href="#cb90-3438" aria-hidden="true" tabindex="-1"></a><span class="vs">.color1by320 {</span></span>
<span id="cb90-3439"><a href="#cb90-3439" aria-hidden="true" tabindex="-1"></a><span class="vs">  background: hsl(</span><span class="sc">${</span>h1by320<span class="sc">}</span><span class="vs"> 100% 50%);</span></span>
<span id="cb90-3440"><a href="#cb90-3440" aria-hidden="true" tabindex="-1"></a><span class="vs">  color: </span><span class="sc">${</span><span class="fu">yiq</span>(<span class="vs">`hsl(</span><span class="sc">${</span>h1by320<span class="sc">}</span><span class="vs">, 100%, 50%)`</span>) <span class="op">&gt;</span> <span class="fl">0.51</span> <span class="op">?</span> <span class="st">"black"</span> <span class="op">:</span> <span class="st">"white"</span><span class="sc">}</span><span class="vs">;</span></span>
<span id="cb90-3441"><a href="#cb90-3441" aria-hidden="true" tabindex="-1"></a><span class="vs">  padding: 0px 5px;</span></span>
<span id="cb90-3442"><a href="#cb90-3442" aria-hidden="true" tabindex="-1"></a><span class="vs">  border-radius: 4px;</span></span>
<span id="cb90-3443"><a href="#cb90-3443" aria-hidden="true" tabindex="-1"></a><span class="vs">  font-weight: 400;</span></span>
<span id="cb90-3444"><a href="#cb90-3444" aria-hidden="true" tabindex="-1"></a><span class="vs">  font-family: monospace;</span></span>
<span id="cb90-3445"><a href="#cb90-3445" aria-hidden="true" tabindex="-1"></a><span class="vs">}</span></span>
<span id="cb90-3446"><a href="#cb90-3446" aria-hidden="true" tabindex="-1"></a><span class="vs">.colorD121 {</span></span>
<span id="cb90-3447"><a href="#cb90-3447" aria-hidden="true" tabindex="-1"></a><span class="vs">  background: hsl(</span><span class="sc">${</span>hD121<span class="sc">}</span><span class="vs"> 100% 50%);</span></span>
<span id="cb90-3448"><a href="#cb90-3448" aria-hidden="true" tabindex="-1"></a><span class="vs">  color: </span><span class="sc">${</span><span class="fu">yiq</span>(<span class="vs">`hsl(</span><span class="sc">${</span>hD121<span class="sc">}</span><span class="vs">, 100%, 50%)`</span>) <span class="op">&gt;</span> <span class="fl">0.51</span> <span class="op">?</span> <span class="st">"black"</span> <span class="op">:</span> <span class="st">"white"</span><span class="sc">}</span><span class="vs">;</span></span>
<span id="cb90-3449"><a href="#cb90-3449" aria-hidden="true" tabindex="-1"></a><span class="vs">  padding: 0px 5px;</span></span>
<span id="cb90-3450"><a href="#cb90-3450" aria-hidden="true" tabindex="-1"></a><span class="vs">  border-radius: 4px;</span></span>
<span id="cb90-3451"><a href="#cb90-3451" aria-hidden="true" tabindex="-1"></a><span class="vs">  font-weight: 400;</span></span>
<span id="cb90-3452"><a href="#cb90-3452" aria-hidden="true" tabindex="-1"></a><span class="vs">  font-family: monospace;</span></span>
<span id="cb90-3453"><a href="#cb90-3453" aria-hidden="true" tabindex="-1"></a><span class="vs">}</span></span>
<span id="cb90-3454"><a href="#cb90-3454" aria-hidden="true" tabindex="-1"></a><span class="vs">.colorD268 {</span></span>
<span id="cb90-3455"><a href="#cb90-3455" aria-hidden="true" tabindex="-1"></a><span class="vs">  background: hsl(</span><span class="sc">${</span>hD268<span class="sc">}</span><span class="vs"> 100% 50%);</span></span>
<span id="cb90-3456"><a href="#cb90-3456" aria-hidden="true" tabindex="-1"></a><span class="vs">  color: </span><span class="sc">${</span><span class="fu">yiq</span>(<span class="vs">`hsl(</span><span class="sc">${</span>hD268<span class="sc">}</span><span class="vs">, 100%, 50%)`</span>) <span class="op">&gt;</span> <span class="fl">0.51</span> <span class="op">?</span> <span class="st">"black"</span> <span class="op">:</span> <span class="st">"white"</span><span class="sc">}</span><span class="vs">;</span></span>
<span id="cb90-3457"><a href="#cb90-3457" aria-hidden="true" tabindex="-1"></a><span class="vs">  padding: 0px 5px;</span></span>
<span id="cb90-3458"><a href="#cb90-3458" aria-hidden="true" tabindex="-1"></a><span class="vs">  border-radius: 4px;</span></span>
<span id="cb90-3459"><a href="#cb90-3459" aria-hidden="true" tabindex="-1"></a><span class="vs">  font-weight: 400;</span></span>
<span id="cb90-3460"><a href="#cb90-3460" aria-hidden="true" tabindex="-1"></a><span class="vs">  font-family: monospace;</span></span>
<span id="cb90-3461"><a href="#cb90-3461" aria-hidden="true" tabindex="-1"></a><span class="vs">}</span></span>
<span id="cb90-3462"><a href="#cb90-3462" aria-hidden="true" tabindex="-1"></a><span class="vs">.colorD305 {</span></span>
<span id="cb90-3463"><a href="#cb90-3463" aria-hidden="true" tabindex="-1"></a><span class="vs">  background: hsl(</span><span class="sc">${</span>hD305<span class="sc">}</span><span class="vs"> 100% 50%);</span></span>
<span id="cb90-3464"><a href="#cb90-3464" aria-hidden="true" tabindex="-1"></a><span class="vs">  color: </span><span class="sc">${</span><span class="fu">yiq</span>(<span class="vs">`hsl(</span><span class="sc">${</span>hD305<span class="sc">}</span><span class="vs">, 100%, 50%)`</span>) <span class="op">&gt;</span> <span class="fl">0.51</span> <span class="op">?</span> <span class="st">"black"</span> <span class="op">:</span> <span class="st">"white"</span><span class="sc">}</span><span class="vs">;</span></span>
<span id="cb90-3465"><a href="#cb90-3465" aria-hidden="true" tabindex="-1"></a><span class="vs">  padding: 0px 5px;</span></span>
<span id="cb90-3466"><a href="#cb90-3466" aria-hidden="true" tabindex="-1"></a><span class="vs">  border-radius: 4px;</span></span>
<span id="cb90-3467"><a href="#cb90-3467" aria-hidden="true" tabindex="-1"></a><span class="vs">  font-weight: 400;</span></span>
<span id="cb90-3468"><a href="#cb90-3468" aria-hidden="true" tabindex="-1"></a><span class="vs">  font-family: monospace;</span></span>
<span id="cb90-3469"><a href="#cb90-3469" aria-hidden="true" tabindex="-1"></a><span class="vs">}</span></span>
<span id="cb90-3470"><a href="#cb90-3470" aria-hidden="true" tabindex="-1"></a><span class="vs">.colorD306 {</span></span>
<span id="cb90-3471"><a href="#cb90-3471" aria-hidden="true" tabindex="-1"></a><span class="vs">  background: hsl(</span><span class="sc">${</span>hD306<span class="sc">}</span><span class="vs"> 100% 50%);</span></span>
<span id="cb90-3472"><a href="#cb90-3472" aria-hidden="true" tabindex="-1"></a><span class="vs">  color: </span><span class="sc">${</span><span class="fu">yiq</span>(<span class="vs">`hsl(</span><span class="sc">${</span>hD306<span class="sc">}</span><span class="vs">, 100%, 50%)`</span>) <span class="op">&gt;</span> <span class="fl">0.51</span> <span class="op">?</span> <span class="st">"black"</span> <span class="op">:</span> <span class="st">"white"</span><span class="sc">}</span><span class="vs">;</span></span>
<span id="cb90-3473"><a href="#cb90-3473" aria-hidden="true" tabindex="-1"></a><span class="vs">  padding: 0px 5px;</span></span>
<span id="cb90-3474"><a href="#cb90-3474" aria-hidden="true" tabindex="-1"></a><span class="vs">  border-radius: 4px;</span></span>
<span id="cb90-3475"><a href="#cb90-3475" aria-hidden="true" tabindex="-1"></a><span class="vs">  font-weight: 400;</span></span>
<span id="cb90-3476"><a href="#cb90-3476" aria-hidden="true" tabindex="-1"></a><span class="vs">  font-family: monospace;</span></span>
<span id="cb90-3477"><a href="#cb90-3477" aria-hidden="true" tabindex="-1"></a><span class="vs">}</span></span>
<span id="cb90-3478"><a href="#cb90-3478" aria-hidden="true" tabindex="-1"></a><span class="vs">&lt;/style&gt;</span></span>
<span id="cb90-3479"><a href="#cb90-3479" aria-hidden="true" tabindex="-1"></a><span class="vs">`</span></span>
<span id="cb90-3480"><a href="#cb90-3480" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb90-3481"><a href="#cb90-3481" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb90-3482"><a href="#cb90-3482" aria-hidden="true" tabindex="-1"></a><span class="in">```{=html}</span></span>
<span id="cb90-3483"><a href="#cb90-3483" aria-hidden="true" tabindex="-1"></a><span class="in">&lt;style&gt;</span></span>
<span id="cb90-3484"><a href="#cb90-3484" aria-hidden="true" tabindex="-1"></a><span class="in">html, body {</span></span>
<span id="cb90-3485"><a href="#cb90-3485" aria-hidden="true" tabindex="-1"></a><span class="in">    max-width: 100%;</span></span>
<span id="cb90-3486"><a href="#cb90-3486" aria-hidden="true" tabindex="-1"></a><span class="in">}</span></span>
<span id="cb90-3487"><a href="#cb90-3487" aria-hidden="true" tabindex="-1"></a><span class="in">div.cell:has(svg.barclock) {</span></span>
<span id="cb90-3488"><a href="#cb90-3488" aria-hidden="true" tabindex="-1"></a><span class="in">  margin-top: -28px;</span></span>
<span id="cb90-3489"><a href="#cb90-3489" aria-hidden="true" tabindex="-1"></a><span class="in">}</span></span>
<span id="cb90-3490"><a href="#cb90-3490" aria-hidden="true" tabindex="-1"></a><span class="in">div.cell:has(form#formEl) {</span></span>
<span id="cb90-3491"><a href="#cb90-3491" aria-hidden="true" tabindex="-1"></a><span class="in">  max-width: 100%;</span></span>
<span id="cb90-3492"><a href="#cb90-3492" aria-hidden="true" tabindex="-1"></a><span class="in">  margin-top: -8px;</span></span>
<span id="cb90-3493"><a href="#cb90-3493" aria-hidden="true" tabindex="-1"></a><span class="in">}</span></span>
<span id="cb90-3494"><a href="#cb90-3494" aria-hidden="true" tabindex="-1"></a><span class="in">form#formEl * {</span></span>
<span id="cb90-3495"><a href="#cb90-3495" aria-hidden="true" tabindex="-1"></a><span class="in">  max-width: 100%;</span></span>
<span id="cb90-3496"><a href="#cb90-3496" aria-hidden="true" tabindex="-1"></a><span class="in">}</span></span>
<span id="cb90-3497"><a href="#cb90-3497" aria-hidden="true" tabindex="-1"></a><span class="in">svg.barclock {</span></span>
<span id="cb90-3498"><a href="#cb90-3498" aria-hidden="true" tabindex="-1"></a><span class="in">  width: 100%;</span></span>
<span id="cb90-3499"><a href="#cb90-3499" aria-hidden="true" tabindex="-1"></a><span class="in">  overflow: visible;</span></span>
<span id="cb90-3500"><a href="#cb90-3500" aria-hidden="true" tabindex="-1"></a><span class="in">}</span></span>
<span id="cb90-3501"><a href="#cb90-3501" aria-hidden="true" tabindex="-1"></a><span class="in">.tickLabel, .tickLabel1, .tickLabel2, .timeLabel {</span></span>
<span id="cb90-3502"><a href="#cb90-3502" aria-hidden="true" tabindex="-1"></a><span class="in">  font-family: monospace;</span></span>
<span id="cb90-3503"><a href="#cb90-3503" aria-hidden="true" tabindex="-1"></a><span class="in">  text-anchor: middle;</span></span>
<span id="cb90-3504"><a href="#cb90-3504" aria-hidden="true" tabindex="-1"></a><span class="in">}</span></span>
<span id="cb90-3505"><a href="#cb90-3505" aria-hidden="true" tabindex="-1"></a><span class="in">.timeLabel {</span></span>
<span id="cb90-3506"><a href="#cb90-3506" aria-hidden="true" tabindex="-1"></a><span class="in">  text-anchor: start;</span></span>
<span id="cb90-3507"><a href="#cb90-3507" aria-hidden="true" tabindex="-1"></a><span class="in">}</span></span>
<span id="cb90-3508"><a href="#cb90-3508" aria-hidden="true" tabindex="-1"></a><span class="in">.timeBar, .timeBarFull, .timeBarFullN {</span></span>
<span id="cb90-3509"><a href="#cb90-3509" aria-hidden="true" tabindex="-1"></a><span class="in">  x: 1px;</span></span>
<span id="cb90-3510"><a href="#cb90-3510" aria-hidden="true" tabindex="-1"></a><span class="in">  height: 25px;</span></span>
<span id="cb90-3511"><a href="#cb90-3511" aria-hidden="true" tabindex="-1"></a><span class="in">  rx: 5px;</span></span>
<span id="cb90-3512"><a href="#cb90-3512" aria-hidden="true" tabindex="-1"></a><span class="in">  stroke: #aaa;</span></span>
<span id="cb90-3513"><a href="#cb90-3513" aria-hidden="true" tabindex="-1"></a><span class="in">}</span></span>
<span id="cb90-3514"><a href="#cb90-3514" aria-hidden="true" tabindex="-1"></a><span class="in">.tickDek, .tickDotd, .tickDotd1, .tickC, .tickC1, .tickM, .tickM1, .tickB, .tickB1 {</span></span>
<span id="cb90-3515"><a href="#cb90-3515" aria-hidden="true" tabindex="-1"></a><span class="in">  stroke: none;</span></span>
<span id="cb90-3516"><a href="#cb90-3516" aria-hidden="true" tabindex="-1"></a><span class="in">  fill: #666;</span></span>
<span id="cb90-3517"><a href="#cb90-3517" aria-hidden="true" tabindex="-1"></a><span class="in">  width: 1px;</span></span>
<span id="cb90-3518"><a href="#cb90-3518" aria-hidden="true" tabindex="-1"></a><span class="in">}</span></span>
<span id="cb90-3519"><a href="#cb90-3519" aria-hidden="true" tabindex="-1"></a><span class="in">.analogclock {</span></span>
<span id="cb90-3520"><a href="#cb90-3520" aria-hidden="true" tabindex="-1"></a><span class="in">  stroke: #000;</span></span>
<span id="cb90-3521"><a href="#cb90-3521" aria-hidden="true" tabindex="-1"></a><span class="in">  font-family: "HelveticaNeue-Light", "Helvetica Neue Light", "Helvetica Neue", Helvetica, Arial, "Lucida Grande", sans-serif;</span></span>
<span id="cb90-3522"><a href="#cb90-3522" aria-hidden="true" tabindex="-1"></a><span class="in">  overflow: visible;</span></span>
<span id="cb90-3523"><a href="#cb90-3523" aria-hidden="true" tabindex="-1"></a><span class="in">}</span></span>
<span id="cb90-3524"><a href="#cb90-3524" aria-hidden="true" tabindex="-1"></a><span class="in">.analogclock #rim {</span></span>
<span id="cb90-3525"><a href="#cb90-3525" aria-hidden="true" tabindex="-1"></a><span class="in">  fill: none;</span></span>
<span id="cb90-3526"><a href="#cb90-3526" aria-hidden="true" tabindex="-1"></a><span class="in">  stroke: #999;</span></span>
<span id="cb90-3527"><a href="#cb90-3527" aria-hidden="true" tabindex="-1"></a><span class="in">  stroke-width: 3px;</span></span>
<span id="cb90-3528"><a href="#cb90-3528" aria-hidden="true" tabindex="-1"></a><span class="in">}</span></span>
<span id="cb90-3529"><a href="#cb90-3529" aria-hidden="true" tabindex="-1"></a><span class="in">.analogclock .second-hand {</span></span>
<span id="cb90-3530"><a href="#cb90-3530" aria-hidden="true" tabindex="-1"></a><span class="in">  stroke-width: 3;</span></span>
<span id="cb90-3531"><a href="#cb90-3531" aria-hidden="true" tabindex="-1"></a><span class="in">}</span></span>
<span id="cb90-3532"><a href="#cb90-3532" aria-hidden="true" tabindex="-1"></a><span class="in">.analogclock .minute-hand {</span></span>
<span id="cb90-3533"><a href="#cb90-3533" aria-hidden="true" tabindex="-1"></a><span class="in">  stroke-width: 8;</span></span>
<span id="cb90-3534"><a href="#cb90-3534" aria-hidden="true" tabindex="-1"></a><span class="in">  stroke-linecap: round;</span></span>
<span id="cb90-3535"><a href="#cb90-3535" aria-hidden="true" tabindex="-1"></a><span class="in">}</span></span>
<span id="cb90-3536"><a href="#cb90-3536" aria-hidden="true" tabindex="-1"></a><span class="in">.analogclock .hour-hand {</span></span>
<span id="cb90-3537"><a href="#cb90-3537" aria-hidden="true" tabindex="-1"></a><span class="in">  stroke-width: 12;</span></span>
<span id="cb90-3538"><a href="#cb90-3538" aria-hidden="true" tabindex="-1"></a><span class="in">  stroke-linecap: round;</span></span>
<span id="cb90-3539"><a href="#cb90-3539" aria-hidden="true" tabindex="-1"></a><span class="in">}</span></span>
<span id="cb90-3540"><a href="#cb90-3540" aria-hidden="true" tabindex="-1"></a><span class="in">.analogclock .hands-cover {</span></span>
<span id="cb90-3541"><a href="#cb90-3541" aria-hidden="true" tabindex="-1"></a><span class="in">  stroke-width: 3;</span></span>
<span id="cb90-3542"><a href="#cb90-3542" aria-hidden="true" tabindex="-1"></a><span class="in">  fill: #fff;</span></span>
<span id="cb90-3543"><a href="#cb90-3543" aria-hidden="true" tabindex="-1"></a><span class="in">}</span></span>
<span id="cb90-3544"><a href="#cb90-3544" aria-hidden="true" tabindex="-1"></a><span class="in">.analogclock .second-tick {</span></span>
<span id="cb90-3545"><a href="#cb90-3545" aria-hidden="true" tabindex="-1"></a><span class="in">  stroke-width: 3;</span></span>
<span id="cb90-3546"><a href="#cb90-3546" aria-hidden="true" tabindex="-1"></a><span class="in">  fill: #000;</span></span>
<span id="cb90-3547"><a href="#cb90-3547" aria-hidden="true" tabindex="-1"></a><span class="in">}</span></span>
<span id="cb90-3548"><a href="#cb90-3548" aria-hidden="true" tabindex="-1"></a><span class="in">.analogclock .hour-tick {</span></span>
<span id="cb90-3549"><a href="#cb90-3549" aria-hidden="true" tabindex="-1"></a><span class="in">  stroke-width: 8; // same as the minute hand</span></span>
<span id="cb90-3550"><a href="#cb90-3550" aria-hidden="true" tabindex="-1"></a><span class="in">}</span></span>
<span id="cb90-3551"><a href="#cb90-3551" aria-hidden="true" tabindex="-1"></a><span class="in">.analogclock .second-label {</span></span>
<span id="cb90-3552"><a href="#cb90-3552" aria-hidden="true" tabindex="-1"></a><span class="in">  font-size: 22px;</span></span>
<span id="cb90-3553"><a href="#cb90-3553" aria-hidden="true" tabindex="-1"></a><span class="in">}</span></span>
<span id="cb90-3554"><a href="#cb90-3554" aria-hidden="true" tabindex="-1"></a><span class="in">.analogclock .hour-label {</span></span>
<span id="cb90-3555"><a href="#cb90-3555" aria-hidden="true" tabindex="-1"></a><span class="in">  font-size: 32px</span></span>
<span id="cb90-3556"><a href="#cb90-3556" aria-hidden="true" tabindex="-1"></a><span class="in">}</span></span>
<span id="cb90-3557"><a href="#cb90-3557" aria-hidden="true" tabindex="-1"></a><span class="in">.clocks * {</span></span>
<span id="cb90-3558"><a href="#cb90-3558" aria-hidden="true" tabindex="-1"></a><span class="in">  overflow: visible;</span></span>
<span id="cb90-3559"><a href="#cb90-3559" aria-hidden="true" tabindex="-1"></a><span class="in">  margin: -10px 0px 10px 0px;</span></span>
<span id="cb90-3560"><a href="#cb90-3560" aria-hidden="true" tabindex="-1"></a><span class="in">  padding: 0px;</span></span>
<span id="cb90-3561"><a href="#cb90-3561" aria-hidden="true" tabindex="-1"></a><span class="in">  text-align: center;</span></span>
<span id="cb90-3562"><a href="#cb90-3562" aria-hidden="true" tabindex="-1"></a><span class="in">}</span></span>
<span id="cb90-3563"><a href="#cb90-3563" aria-hidden="true" tabindex="-1"></a><span class="in">#title-block-header &gt; div:nth-child(2) {</span></span>
<span id="cb90-3564"><a href="#cb90-3564" aria-hidden="true" tabindex="-1"></a><span class="in">  display: none;</span></span>
<span id="cb90-3565"><a href="#cb90-3565" aria-hidden="true" tabindex="-1"></a><span class="in">}</span></span>
<span id="cb90-3566"><a href="#cb90-3566" aria-hidden="true" tabindex="-1"></a><span class="in">h4.hiddenheading, h5.hiddenheading {</span></span>
<span id="cb90-3567"><a href="#cb90-3567" aria-hidden="true" tabindex="-1"></a><span class="in">  display: none;</span></span>
<span id="cb90-3568"><a href="#cb90-3568" aria-hidden="true" tabindex="-1"></a><span class="in">}</span></span>
<span id="cb90-3569"><a href="#cb90-3569" aria-hidden="true" tabindex="-1"></a><span class="in">div.cell-output:has(#daylightapp) {</span></span>
<span id="cb90-3570"><a href="#cb90-3570" aria-hidden="true" tabindex="-1"></a><span class="in">  overflow: visible;</span></span>
<span id="cb90-3571"><a href="#cb90-3571" aria-hidden="true" tabindex="-1"></a><span class="in">}</span></span>
<span id="cb90-3572"><a href="#cb90-3572" aria-hidden="true" tabindex="-1"></a><span class="in">#daylightapp {</span></span>
<span id="cb90-3573"><a href="#cb90-3573" aria-hidden="true" tabindex="-1"></a><span class="in">  overflow: visible;</span></span>
<span id="cb90-3574"><a href="#cb90-3574" aria-hidden="true" tabindex="-1"></a><span class="in">  max-width: 100%;</span></span>
<span id="cb90-3575"><a href="#cb90-3575" aria-hidden="true" tabindex="-1"></a><span class="in">}</span></span>
<span id="cb90-3576"><a href="#cb90-3576" aria-hidden="true" tabindex="-1"></a><span class="in">#daylightapp * {</span></span>
<span id="cb90-3577"><a href="#cb90-3577" aria-hidden="true" tabindex="-1"></a><span class="in">  overflow: visible;</span></span>
<span id="cb90-3578"><a href="#cb90-3578" aria-hidden="true" tabindex="-1"></a><span class="in">}</span></span>
<span id="cb90-3579"><a href="#cb90-3579" aria-hidden="true" tabindex="-1"></a><span class="in">#solar-system * {</span></span>
<span id="cb90-3580"><a href="#cb90-3580" aria-hidden="true" tabindex="-1"></a><span class="in">  overflow: visible;</span></span>
<span id="cb90-3581"><a href="#cb90-3581" aria-hidden="true" tabindex="-1"></a><span class="in">}</span></span>
<span id="cb90-3582"><a href="#cb90-3582" aria-hidden="true" tabindex="-1"></a><span class="in">#timezonepopstackedbar {</span></span>
<span id="cb90-3583"><a href="#cb90-3583" aria-hidden="true" tabindex="-1"></a><span class="in">  overflow: visible;</span></span>
<span id="cb90-3584"><a href="#cb90-3584" aria-hidden="true" tabindex="-1"></a><span class="in">}</span></span>
<span id="cb90-3585"><a href="#cb90-3585" aria-hidden="true" tabindex="-1"></a><span class="in">#timezonepoptoggles div {</span></span>
<span id="cb90-3586"><a href="#cb90-3586" aria-hidden="true" tabindex="-1"></a><span class="in">  display: flex;</span></span>
<span id="cb90-3587"><a href="#cb90-3587" aria-hidden="true" tabindex="-1"></a><span class="in">}</span></span>
<span id="cb90-3588"><a href="#cb90-3588" aria-hidden="true" tabindex="-1"></a><span class="in">#timezonepoptoggles div form {</span></span>
<span id="cb90-3589"><a href="#cb90-3589" aria-hidden="true" tabindex="-1"></a><span class="in">  max-width: 180px;</span></span>
<span id="cb90-3590"><a href="#cb90-3590" aria-hidden="true" tabindex="-1"></a><span class="in">}</span></span>
<span id="cb90-3591"><a href="#cb90-3591" aria-hidden="true" tabindex="-1"></a><span class="in">#timezonepoptoggles div form label {</span></span>
<span id="cb90-3592"><a href="#cb90-3592" aria-hidden="true" tabindex="-1"></a><span class="in">  max-width: 120px;</span></span>
<span id="cb90-3593"><a href="#cb90-3593" aria-hidden="true" tabindex="-1"></a><span class="in">}</span></span>
<span id="cb90-3594"><a href="#cb90-3594" aria-hidden="true" tabindex="-1"></a><span class="in">#timezonepoptoggles div form:nth-child(1) {</span></span>
<span id="cb90-3595"><a href="#cb90-3595" aria-hidden="true" tabindex="-1"></a><span class="in">  margin-right: 8px;</span></span>
<span id="cb90-3596"><a href="#cb90-3596" aria-hidden="true" tabindex="-1"></a><span class="in">}</span></span>
<span id="cb90-3597"><a href="#cb90-3597" aria-hidden="true" tabindex="-1"></a><span class="in">#timezonepoptoggles div form:nth-child(2) label {</span></span>
<span id="cb90-3598"><a href="#cb90-3598" aria-hidden="true" tabindex="-1"></a><span class="in">  max-width: 110px;</span></span>
<span id="cb90-3599"><a href="#cb90-3599" aria-hidden="true" tabindex="-1"></a><span class="in">}</span></span>
<span id="cb90-3600"><a href="#cb90-3600" aria-hidden="true" tabindex="-1"></a><span class="in">#timezonepoptoggles input[type=checkbox] {</span></span>
<span id="cb90-3601"><a href="#cb90-3601" aria-hidden="true" tabindex="-1"></a><span class="in">  margin-top: 8px;</span></span>
<span id="cb90-3602"><a href="#cb90-3602" aria-hidden="true" tabindex="-1"></a><span class="in">}</span></span>
<span id="cb90-3603"><a href="#cb90-3603" aria-hidden="true" tabindex="-1"></a><span class="in">div:has(form#formEl) {</span></span>
<span id="cb90-3604"><a href="#cb90-3604" aria-hidden="true" tabindex="-1"></a><span class="in">  overflow: visible;</span></span>
<span id="cb90-3605"><a href="#cb90-3605" aria-hidden="true" tabindex="-1"></a><span class="in">  position: relative;</span></span>
<span id="cb90-3606"><a href="#cb90-3606" aria-hidden="true" tabindex="-1"></a><span class="in">  z-index: 1;</span></span>
<span id="cb90-3607"><a href="#cb90-3607" aria-hidden="true" tabindex="-1"></a><span class="in">}</span></span>
<span id="cb90-3608"><a href="#cb90-3608" aria-hidden="true" tabindex="-1"></a><span class="in">form#formEl div {</span></span>
<span id="cb90-3609"><a href="#cb90-3609" aria-hidden="true" tabindex="-1"></a><span class="in">  max-width: 100%;</span></span>
<span id="cb90-3610"><a href="#cb90-3610" aria-hidden="true" tabindex="-1"></a><span class="in">  position: relative;</span></span>
<span id="cb90-3611"><a href="#cb90-3611" aria-hidden="true" tabindex="-1"></a><span class="in">  z-index: 1;</span></span>
<span id="cb90-3612"><a href="#cb90-3612" aria-hidden="true" tabindex="-1"></a><span class="in">}</span></span>
<span id="cb90-3613"><a href="#cb90-3613" aria-hidden="true" tabindex="-1"></a><span class="in">div.cell-output:has(#formEl) {</span></span>
<span id="cb90-3614"><a href="#cb90-3614" aria-hidden="true" tabindex="-1"></a><span class="in">  margin-top: 0px;</span></span>
<span id="cb90-3615"><a href="#cb90-3615" aria-hidden="true" tabindex="-1"></a><span class="in">  overflow: visible;</span></span>
<span id="cb90-3616"><a href="#cb90-3616" aria-hidden="true" tabindex="-1"></a><span class="in">}</span></span>
<span id="cb90-3617"><a href="#cb90-3617" aria-hidden="true" tabindex="-1"></a><span class="in">#daylightapp, #btmclock, #btmbar  {</span></span>
<span id="cb90-3618"><a href="#cb90-3618" aria-hidden="true" tabindex="-1"></a><span class="in">  overflow: visible;</span></span>
<span id="cb90-3619"><a href="#cb90-3619" aria-hidden="true" tabindex="-1"></a><span class="in">  position: relative;</span></span>
<span id="cb90-3620"><a href="#cb90-3620" aria-hidden="true" tabindex="-1"></a><span class="in">  z-index: 99;</span></span>
<span id="cb90-3621"><a href="#cb90-3621" aria-hidden="true" tabindex="-1"></a><span class="in">}</span></span>
<span id="cb90-3622"><a href="#cb90-3622" aria-hidden="true" tabindex="-1"></a><span class="in">@media (max-width: 767.98px) {</span></span>
<span id="cb90-3623"><a href="#cb90-3623" aria-hidden="true" tabindex="-1"></a><span class="in">  #onlymargin, #maptable {</span></span>
<span id="cb90-3624"><a href="#cb90-3624" aria-hidden="true" tabindex="-1"></a><span class="in">    display: none;</span></span>
<span id="cb90-3625"><a href="#cb90-3625" aria-hidden="true" tabindex="-1"></a><span class="in">  }</span></span>
<span id="cb90-3626"><a href="#cb90-3626" aria-hidden="true" tabindex="-1"></a><span class="in">}</span></span>
<span id="cb90-3627"><a href="#cb90-3627" aria-hidden="true" tabindex="-1"></a><span class="in">div#distmap {</span></span>
<span id="cb90-3628"><a href="#cb90-3628" aria-hidden="true" tabindex="-1"></a><span class="in">  display: flex;</span></span>
<span id="cb90-3629"><a href="#cb90-3629" aria-hidden="true" tabindex="-1"></a><span class="in">  justify-content: center;</span></span>
<span id="cb90-3630"><a href="#cb90-3630" aria-hidden="true" tabindex="-1"></a><span class="in">  overflow-x: visible;</span></span>
<span id="cb90-3631"><a href="#cb90-3631" aria-hidden="true" tabindex="-1"></a><span class="in">}</span></span>
<span id="cb90-3632"><a href="#cb90-3632" aria-hidden="true" tabindex="-1"></a><span class="in">.marginInputs {</span></span>
<span id="cb90-3633"><a href="#cb90-3633" aria-hidden="true" tabindex="-1"></a><span class="in">  position: relative;</span></span>
<span id="cb90-3634"><a href="#cb90-3634" aria-hidden="true" tabindex="-1"></a><span class="in">  top: -220px;</span></span>
<span id="cb90-3635"><a href="#cb90-3635" aria-hidden="true" tabindex="-1"></a><span class="in">  z-index: 99;</span></span>
<span id="cb90-3636"><a href="#cb90-3636" aria-hidden="true" tabindex="-1"></a><span class="in">  line-height: 1;</span></span>
<span id="cb90-3637"><a href="#cb90-3637" aria-hidden="true" tabindex="-1"></a><span class="in">}</span></span>
<span id="cb90-3638"><a href="#cb90-3638" aria-hidden="true" tabindex="-1"></a><span class="in">#maptable {</span></span>
<span id="cb90-3639"><a href="#cb90-3639" aria-hidden="true" tabindex="-1"></a><span class="in">  overflow: visible;</span></span>
<span id="cb90-3640"><a href="#cb90-3640" aria-hidden="true" tabindex="-1"></a><span class="in">  display: flex;</span></span>
<span id="cb90-3641"><a href="#cb90-3641" aria-hidden="true" tabindex="-1"></a><span class="in">  justify-content: center;</span></span>
<span id="cb90-3642"><a href="#cb90-3642" aria-hidden="true" tabindex="-1"></a><span class="in">  line-height: 1.5;</span></span>
<span id="cb90-3643"><a href="#cb90-3643" aria-hidden="true" tabindex="-1"></a><span class="in">}</span></span>
<span id="cb90-3644"><a href="#cb90-3644" aria-hidden="true" tabindex="-1"></a><span class="in">#projselect &gt; div {</span></span>
<span id="cb90-3645"><a href="#cb90-3645" aria-hidden="true" tabindex="-1"></a><span class="in">  margin-top: -4px;</span></span>
<span id="cb90-3646"><a href="#cb90-3646" aria-hidden="true" tabindex="-1"></a><span class="in">}</span></span>
<span id="cb90-3647"><a href="#cb90-3647" aria-hidden="true" tabindex="-1"></a><span class="in">#maptable &gt; div {</span></span>
<span id="cb90-3648"><a href="#cb90-3648" aria-hidden="true" tabindex="-1"></a><span class="in">  margin-top: -16px;</span></span>
<span id="cb90-3649"><a href="#cb90-3649" aria-hidden="true" tabindex="-1"></a><span class="in">}</span></span>
<span id="cb90-3650"><a href="#cb90-3650" aria-hidden="true" tabindex="-1"></a><span class="in">#projselect {</span></span>
<span id="cb90-3651"><a href="#cb90-3651" aria-hidden="true" tabindex="-1"></a><span class="in">  overflow: visible;</span></span>
<span id="cb90-3652"><a href="#cb90-3652" aria-hidden="true" tabindex="-1"></a><span class="in">}</span></span>
<span id="cb90-3653"><a href="#cb90-3653" aria-hidden="true" tabindex="-1"></a><span class="in">div#projselect &gt; div, div#sizeinput &gt; div, div#speedinput &gt; div,  div#yawinput &gt; div, div#pitchinput &gt; div, div#rollinput &gt; div {</span></span>
<span id="cb90-3654"><a href="#cb90-3654" aria-hidden="true" tabindex="-1"></a><span class="in">  overflow-x: clip;</span></span>
<span id="cb90-3655"><a href="#cb90-3655" aria-hidden="true" tabindex="-1"></a><span class="in">}</span></span>
<span id="cb90-3656"><a href="#cb90-3656" aria-hidden="true" tabindex="-1"></a><span class="in">div#sizeinput label, div#speedinput label, div#yawinput label, div#pitchinput label, div#rollinput label {</span></span>
<span id="cb90-3657"><a href="#cb90-3657" aria-hidden="true" tabindex="-1"></a><span class="in">  width: 30px;</span></span>
<span id="cb90-3658"><a href="#cb90-3658" aria-hidden="true" tabindex="-1"></a><span class="in">}</span></span>
<span id="cb90-3659"><a href="#cb90-3659" aria-hidden="true" tabindex="-1"></a><span class="in">button#rstbtn:hover {</span></span>
<span id="cb90-3660"><a href="#cb90-3660" aria-hidden="true" tabindex="-1"></a><span class="in">  box-shadow: 0 4px 12px rgba(0, 0, 0, .08);</span></span>
<span id="cb90-3661"><a href="#cb90-3661" aria-hidden="true" tabindex="-1"></a><span class="in">  text-decoration: none;</span></span>
<span id="cb90-3662"><a href="#cb90-3662" aria-hidden="true" tabindex="-1"></a><span class="in">  transform: translateY(-1px);</span></span>
<span id="cb90-3663"><a href="#cb90-3663" aria-hidden="true" tabindex="-1"></a><span class="in">}</span></span>
<span id="cb90-3664"><a href="#cb90-3664" aria-hidden="true" tabindex="-1"></a><span class="in">#sizeinput #yawinput #pitchinput #rollinput {</span></span>
<span id="cb90-3665"><a href="#cb90-3665" aria-hidden="true" tabindex="-1"></a><span class="in">  display: flex;</span></span>
<span id="cb90-3666"><a href="#cb90-3666" aria-hidden="true" tabindex="-1"></a><span class="in">  align-items: center;</span></span>
<span id="cb90-3667"><a href="#cb90-3667" aria-hidden="true" tabindex="-1"></a><span class="in">  justify-content: center;</span></span>
<span id="cb90-3668"><a href="#cb90-3668" aria-hidden="true" tabindex="-1"></a><span class="in">}</span></span>
<span id="cb90-3669"><a href="#cb90-3669" aria-hidden="true" tabindex="-1"></a><span class="in">input[type="number"], #sizeinput input[type="number"], #yawinput input[type="number"], #pitchinput input[type="number"], #rollinput input[type="number"] {</span></span>
<span id="cb90-3670"><a href="#cb90-3670" aria-hidden="true" tabindex="-1"></a><span class="in">  width: 63px;</span></span>
<span id="cb90-3671"><a href="#cb90-3671" aria-hidden="true" tabindex="-1"></a><span class="in">}</span></span>
<span id="cb90-3672"><a href="#cb90-3672" aria-hidden="true" tabindex="-1"></a><span class="in">input[type="range"], #sizeinput input[type="range"], #yawinput input[type="range"], #pitchinput input[type="range"], #rollinput input[type="range"]  {</span></span>
<span id="cb90-3673"><a href="#cb90-3673" aria-hidden="true" tabindex="-1"></a><span class="in">  width: 72%;</span></span>
<span id="cb90-3674"><a href="#cb90-3674" aria-hidden="true" tabindex="-1"></a><span class="in">}</span></span>
<span id="cb90-3675"><a href="#cb90-3675" aria-hidden="true" tabindex="-1"></a><span class="in">div#toggles {</span></span>
<span id="cb90-3676"><a href="#cb90-3676" aria-hidden="true" tabindex="-1"></a><span class="in">  display: flex;</span></span>
<span id="cb90-3677"><a href="#cb90-3677" aria-hidden="true" tabindex="-1"></a><span class="in">  align-items: center;</span></span>
<span id="cb90-3678"><a href="#cb90-3678" aria-hidden="true" tabindex="-1"></a><span class="in">  justify-content: center;</span></span>
<span id="cb90-3679"><a href="#cb90-3679" aria-hidden="true" tabindex="-1"></a><span class="in">  flex-wrap: nowrap;</span></span>
<span id="cb90-3680"><a href="#cb90-3680" aria-hidden="true" tabindex="-1"></a><span class="in">  margin-top: -20px;</span></span>
<span id="cb90-3681"><a href="#cb90-3681" aria-hidden="true" tabindex="-1"></a><span class="in">  margin-bottom: 9px;</span></span>
<span id="cb90-3682"><a href="#cb90-3682" aria-hidden="true" tabindex="-1"></a><span class="in">}</span></span>
<span id="cb90-3683"><a href="#cb90-3683" aria-hidden="true" tabindex="-1"></a><span class="in">div#toggles * {</span></span>
<span id="cb90-3684"><a href="#cb90-3684" aria-hidden="true" tabindex="-1"></a><span class="in">  overflow: visible;</span></span>
<span id="cb90-3685"><a href="#cb90-3685" aria-hidden="true" tabindex="-1"></a><span class="in">}</span></span>
<span id="cb90-3686"><a href="#cb90-3686" aria-hidden="true" tabindex="-1"></a><span class="in">div#toggles form.oi-3a86ea-toggle#bordertoggle {</span></span>
<span id="cb90-3687"><a href="#cb90-3687" aria-hidden="true" tabindex="-1"></a><span class="in">  width: 100px;</span></span>
<span id="cb90-3688"><a href="#cb90-3688" aria-hidden="true" tabindex="-1"></a><span class="in">}</span></span>
<span id="cb90-3689"><a href="#cb90-3689" aria-hidden="true" tabindex="-1"></a><span class="in">div#toggles form.oi-3a86ea-toggle#bordertoggle &gt; label {</span></span>
<span id="cb90-3690"><a href="#cb90-3690" aria-hidden="true" tabindex="-1"></a><span class="in">  width: 50px;</span></span>
<span id="cb90-3691"><a href="#cb90-3691" aria-hidden="true" tabindex="-1"></a><span class="in">}</span></span>
<span id="cb90-3692"><a href="#cb90-3692" aria-hidden="true" tabindex="-1"></a><span class="in">div#toggles form.oi-3a86ea-toggle#gridtoggle {</span></span>
<span id="cb90-3693"><a href="#cb90-3693" aria-hidden="true" tabindex="-1"></a><span class="in">  width: 80px;</span></span>
<span id="cb90-3694"><a href="#cb90-3694" aria-hidden="true" tabindex="-1"></a><span class="in">}</span></span>
<span id="cb90-3695"><a href="#cb90-3695" aria-hidden="true" tabindex="-1"></a><span class="in">div#toggles form.oi-3a86ea-toggle#gridtoggle &gt; label {</span></span>
<span id="cb90-3696"><a href="#cb90-3696" aria-hidden="true" tabindex="-1"></a><span class="in">  width: 31px;</span></span>
<span id="cb90-3697"><a href="#cb90-3697" aria-hidden="true" tabindex="-1"></a><span class="in">}</span></span>
<span id="cb90-3698"><a href="#cb90-3698" aria-hidden="true" tabindex="-1"></a><span class="in">div#toggles form.oi-3a86ea-toggle#suntoggle {</span></span>
<span id="cb90-3699"><a href="#cb90-3699" aria-hidden="true" tabindex="-1"></a><span class="in">  width: 75px;</span></span>
<span id="cb90-3700"><a href="#cb90-3700" aria-hidden="true" tabindex="-1"></a><span class="in">}</span></span>
<span id="cb90-3701"><a href="#cb90-3701" aria-hidden="true" tabindex="-1"></a><span class="in">div#toggles form.oi-3a86ea-toggle#suntoggle &gt; label {</span></span>
<span id="cb90-3702"><a href="#cb90-3702" aria-hidden="true" tabindex="-1"></a><span class="in">  width: 28px;</span></span>
<span id="cb90-3703"><a href="#cb90-3703" aria-hidden="true" tabindex="-1"></a><span class="in">}</span></span>
<span id="cb90-3704"><a href="#cb90-3704" aria-hidden="true" tabindex="-1"></a><span class="in">div#toggles form.oi-3a86ea-toggle#utctoggle {</span></span>
<span id="cb90-3705"><a href="#cb90-3705" aria-hidden="true" tabindex="-1"></a><span class="in">  width: 80px;</span></span>
<span id="cb90-3706"><a href="#cb90-3706" aria-hidden="true" tabindex="-1"></a><span class="in">}</span></span>
<span id="cb90-3707"><a href="#cb90-3707" aria-hidden="true" tabindex="-1"></a><span class="in">div#toggles form.oi-3a86ea-toggle#utctoggle &gt; label {</span></span>
<span id="cb90-3708"><a href="#cb90-3708" aria-hidden="true" tabindex="-1"></a><span class="in">  width: 32px;</span></span>
<span id="cb90-3709"><a href="#cb90-3709" aria-hidden="true" tabindex="-1"></a><span class="in">}</span></span>
<span id="cb90-3710"><a href="#cb90-3710" aria-hidden="true" tabindex="-1"></a><span class="in">div#toggles form.oi-3a86ea-toggle &gt; label {</span></span>
<span id="cb90-3711"><a href="#cb90-3711" aria-hidden="true" tabindex="-1"></a><span class="in">  margin-top: -4px;</span></span>
<span id="cb90-3712"><a href="#cb90-3712" aria-hidden="true" tabindex="-1"></a><span class="in">}</span></span>
<span id="cb90-3713"><a href="#cb90-3713" aria-hidden="true" tabindex="-1"></a><span class="in">div#toggles input.oi-3a86ea-input[type="checkbox"] {</span></span>
<span id="cb90-3714"><a href="#cb90-3714" aria-hidden="true" tabindex="-1"></a><span class="in">  margin-top: 1px;</span></span>
<span id="cb90-3715"><a href="#cb90-3715" aria-hidden="true" tabindex="-1"></a><span class="in">}</span></span>
<span id="cb90-3716"><a href="#cb90-3716" aria-hidden="true" tabindex="-1"></a><span class="in">div#toggles button#rstbtn {</span></span>
<span id="cb90-3717"><a href="#cb90-3717" aria-hidden="true" tabindex="-1"></a><span class="in">  overflow: visible;</span></span>
<span id="cb90-3718"><a href="#cb90-3718" aria-hidden="true" tabindex="-1"></a><span class="in">  margin-top: -6px;</span></span>
<span id="cb90-3719"><a href="#cb90-3719" aria-hidden="true" tabindex="-1"></a><span class="in">}</span></span>
<span id="cb90-3720"><a href="#cb90-3720" aria-hidden="true" tabindex="-1"></a><span class="in">div#maptable form {</span></span>
<span id="cb90-3721"><a href="#cb90-3721" aria-hidden="true" tabindex="-1"></a><span class="in">  padding: 0px;</span></span>
<span id="cb90-3722"><a href="#cb90-3722" aria-hidden="true" tabindex="-1"></a><span class="in">}</span></span>
<span id="cb90-3723"><a href="#cb90-3723" aria-hidden="true" tabindex="-1"></a><span class="in">#maptable table * {</span></span>
<span id="cb90-3724"><a href="#cb90-3724" aria-hidden="true" tabindex="-1"></a><span class="in">  font-size: 15px;</span></span>
<span id="cb90-3725"><a href="#cb90-3725" aria-hidden="true" tabindex="-1"></a><span class="in">  padding: 0px 4px 0px 4px;</span></span>
<span id="cb90-3726"><a href="#cb90-3726" aria-hidden="true" tabindex="-1"></a><span class="in">}</span></span>
<span id="cb90-3727"><a href="#cb90-3727" aria-hidden="true" tabindex="-1"></a><span class="in">&lt;/style&gt;</span></span>
<span id="cb90-3728"><a href="#cb90-3728" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
</code></pre></div><button title="Copy to Clipboard" class="code-copy-button" data-in-quarto-modal=""><i class="bi"></i></button></div>
</div></div></div></div></div>
</div> <!-- /content -->
<footer class="footer"><div class="nav-footer">
    <div class="nav-footer-left">
<p>© Copyright 2025, Martin Laptev</p>
</div>   
    <div class="nav-footer-center">
      &nbsp;
    <div class="toc-actions d-sm-block d-md-none"><ul><li><a href="https://github.com/maptv/maptv.github.io/blob/main/dec/time/index.qmd" class="toc-action"><i class="bi bi-github"></i>View source</a></li></ul></div></div>
    <div class="nav-footer-right">
      <ul class="footer-items list-unstyled">
<li class="nav-item compact">
    <a class="nav-link" href="https://github.com/maptv" target="_blank">
      <i class="bi bi-github" role="img">
</i> 
    </a>
  </li>  
    <li class="nav-item compact">
    <a class="nav-link" href="https://linkedin.com/in/maptv" target="_blank">
      <i class="bi bi-linkedin" role="img">
</i> 
    </a>
  </li>  
    <li class="nav-item compact">
    <a class="nav-link active" href="mailto:maptv@ireni.co" aria-current="page">
      <i class="bi bi-envelope-at" role="img">
</i> 
    </a>
  </li>  
</ul>
</div>
  </div>
</footer>


</body></html>