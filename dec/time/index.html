<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.7.30">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">

<meta name="author" content="Martin Laptev">
<meta name="description" content="Introducing Declock, a timekeeping system that displays time in decimal days using math notation without the need for hours, minutes, or seconds.">

<title>Martin Laptev</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
html { -webkit-text-size-adjust: 100%; }
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="../../site_libs/quarto-nav/quarto-nav.js"></script>
<script src="../../site_libs/quarto-nav/headroom.min.js"></script>
<script src="../../site_libs/clipboard/clipboard.min.js"></script>
<script src="../../site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="../../site_libs/quarto-search/fuse.min.js"></script>
<script src="../../site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="../../">
<link href="../../dec/snap/index.html" rel="next">
<link href="../../dec/date/index.html" rel="prev">
<link href="../../asset/deidec.png" rel="icon" type="image/png">
<script src="../../site_libs/quarto-html/quarto.js" type="module"></script>
<script src="../../site_libs/quarto-html/tabsets/tabsets.js" type="module"></script>
<script src="../../site_libs/quarto-html/popper.min.js"></script>
<script src="../../site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="../../site_libs/quarto-html/anchor.min.js"></script>
<link href="../../site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="../../site_libs/quarto-html/quarto-syntax-highlighting-eefb2426cccc7ddae97e93a5cfd5e2e9.css" rel="stylesheet" class="quarto-color-scheme" id="quarto-text-highlighting-styles">
<link href="../../site_libs/quarto-html/quarto-syntax-highlighting-dark-e2e82d8fa97d459b8f874deaa193152f.css" rel="stylesheet" class="quarto-color-scheme quarto-color-alternate" id="quarto-text-highlighting-styles">
<link href="../../site_libs/quarto-html/quarto-syntax-highlighting-eefb2426cccc7ddae97e93a5cfd5e2e9.css" rel="stylesheet" class="quarto-color-scheme-extra" id="quarto-text-highlighting-styles">
<script src="../../site_libs/bootstrap/bootstrap.min.js"></script>
<link href="../../site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="../../site_libs/bootstrap/bootstrap-1de4d3a938b50188721ca9f948a79fc1.min.css" rel="stylesheet" append-hash="true" class="quarto-color-scheme" id="quarto-bootstrap" data-mode="light">
<link href="../../site_libs/bootstrap/bootstrap-dark-ef26816128e3fba997e1283f48e135ff.min.css" rel="stylesheet" append-hash="true" class="quarto-color-scheme quarto-color-alternate" id="quarto-bootstrap" data-mode="dark">
<link href="../../site_libs/bootstrap/bootstrap-1de4d3a938b50188721ca9f948a79fc1.min.css" rel="stylesheet" append-hash="true" class="quarto-color-scheme-extra" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "sidebar",
  "copy-button": true,
  "collapse-after": 3,
  "panel-placement": "start",
  "type": "overlay",
  "limit": 50,
  "keyboard-shortcut": [],
  "show-item-context": true,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-text-placeholder": "",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>
<script type="module" src="../../site_libs/quarto-ojs/quarto-ojs-runtime.js"></script>
<link href="../../site_libs/quarto-ojs/quarto-ojs.css" rel="stylesheet">
<meta name="mermaid-theme" content="default">
<script src="../../site_libs/quarto-diagram/mermaid.min.js"></script>
<script src="../../site_libs/quarto-diagram/mermaid-init.js"></script>
<link href="../../site_libs/quarto-diagram/mermaid.css" rel="stylesheet">
<meta name="quarto:status" content="draft">

  <script src="https://cdnjs.cloudflare.com/polyfill/v3/polyfill.min.js?features=es6"></script>
  <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml-full.js" type="text/javascript"></script>

<script type="text/javascript">
const typesetMath = (el) => {
  if (window.MathJax) {
    // MathJax Typeset
    window.MathJax.typeset([el]);
  } else if (window.katex) {
    // KaTeX Render
    var mathElements = el.getElementsByClassName("math");
    var macros = [];
    for (var i = 0; i < mathElements.length; i++) {
      var texText = mathElements[i].firstChild;
      if (mathElements[i].tagName == "SPAN") {
        window.katex.render(texText.data, mathElements[i], {
          displayMode: mathElements[i].classList.contains('display'),
          throwOnError: false,
          macros: macros,
          fleqn: false
        });
      }
    }
  }
}
window.Quarto = {
  typesetMath
};
</script>

<link rel="stylesheet" href="../../asset/style.css">
<meta name="twitter:title" content="Martin Laptev">
<meta name="twitter:description" content="Introducing Declock, a timekeeping system that displays time in decimal days using math notation without the need for hours, minutes, or seconds.">
<meta name="twitter:image" content="https://maptv.github.io/asset/daywide.svg">
<meta name="twitter:card" content="summary_large_image">
</head>

<body class="nav-sidebar floating nav-fixed quarto-light"><script id="quarto-html-before-body" type="application/javascript">
    const toggleBodyColorMode = (bsSheetEl) => {
      const mode = bsSheetEl.getAttribute("data-mode");
      const bodyEl = window.document.querySelector("body");
      if (mode === "dark") {
        bodyEl.classList.add("quarto-dark");
        bodyEl.classList.remove("quarto-light");
      } else {
        bodyEl.classList.add("quarto-light");
        bodyEl.classList.remove("quarto-dark");
      }
    }
    const toggleBodyColorPrimary = () => {
      const bsSheetEl = window.document.querySelector("link#quarto-bootstrap:not([rel=disabled-stylesheet])");
      if (bsSheetEl) {
        toggleBodyColorMode(bsSheetEl);
      }
    }
    const setColorSchemeToggle = (alternate) => {
      const toggles = window.document.querySelectorAll('.quarto-color-scheme-toggle');
      for (let i=0; i < toggles.length; i++) {
        const toggle = toggles[i];
        if (toggle) {
          if (alternate) {
            toggle.classList.add("alternate");
          } else {
            toggle.classList.remove("alternate");
          }
        }
      }
    };
    const toggleColorMode = (alternate) => {
      // Switch the stylesheets
      const primaryStylesheets = window.document.querySelectorAll('link.quarto-color-scheme:not(.quarto-color-alternate)');
      const alternateStylesheets = window.document.querySelectorAll('link.quarto-color-scheme.quarto-color-alternate');
      manageTransitions('#quarto-margin-sidebar .nav-link', false);
      if (alternate) {
        // note: dark is layered on light, we don't disable primary!
        enableStylesheet(alternateStylesheets);
        for (const sheetNode of alternateStylesheets) {
          if (sheetNode.id === "quarto-bootstrap") {
            toggleBodyColorMode(sheetNode);
          }
        }
      } else {
        disableStylesheet(alternateStylesheets);
        enableStylesheet(primaryStylesheets)
        toggleBodyColorPrimary();
      }
      manageTransitions('#quarto-margin-sidebar .nav-link', true);
      // Switch the toggles
      setColorSchemeToggle(alternate)
      // Hack to workaround the fact that safari doesn't
      // properly recolor the scrollbar when toggling (#1455)
      if (navigator.userAgent.indexOf('Safari') > 0 && navigator.userAgent.indexOf('Chrome') == -1) {
        manageTransitions("body", false);
        window.scrollTo(0, 1);
        setTimeout(() => {
          window.scrollTo(0, 0);
          manageTransitions("body", true);
        }, 40);
      }
    }
    const disableStylesheet = (stylesheets) => {
      for (let i=0; i < stylesheets.length; i++) {
        const stylesheet = stylesheets[i];
        stylesheet.rel = 'disabled-stylesheet';
      }
    }
    const enableStylesheet = (stylesheets) => {
      for (let i=0; i < stylesheets.length; i++) {
        const stylesheet = stylesheets[i];
        if(stylesheet.rel !== 'stylesheet') { // for Chrome, which will still FOUC without this check
          stylesheet.rel = 'stylesheet';
        }
      }
    }
    const manageTransitions = (selector, allowTransitions) => {
      const els = window.document.querySelectorAll(selector);
      for (let i=0; i < els.length; i++) {
        const el = els[i];
        if (allowTransitions) {
          el.classList.remove('notransition');
        } else {
          el.classList.add('notransition');
        }
      }
    }
    const isFileUrl = () => {
      return window.location.protocol === 'file:';
    }
    const hasAlternateSentinel = () => {
      let styleSentinel = getColorSchemeSentinel();
      if (styleSentinel !== null) {
        return styleSentinel === "alternate";
      } else {
        return false;
      }
    }
    const setStyleSentinel = (alternate) => {
      const value = alternate ? "alternate" : "default";
      if (!isFileUrl()) {
        window.localStorage.setItem("quarto-color-scheme", value);
      } else {
        localAlternateSentinel = value;
      }
    }
    const getColorSchemeSentinel = () => {
      if (!isFileUrl()) {
        const storageValue = window.localStorage.getItem("quarto-color-scheme");
        return storageValue != null ? storageValue : localAlternateSentinel;
      } else {
        return localAlternateSentinel;
      }
    }
    const toggleGiscusIfUsed = (isAlternate, darkModeDefault) => {
      const baseTheme = document.querySelector('#giscus-base-theme')?.value ?? 'light';
      const alternateTheme = document.querySelector('#giscus-alt-theme')?.value ?? 'dark';
      let newTheme = '';
      if(authorPrefersDark) {
        newTheme = isAlternate ? baseTheme : alternateTheme;
      } else {
        newTheme = isAlternate ? alternateTheme : baseTheme;
      }
      const changeGiscusTheme = () => {
        // From: https://github.com/giscus/giscus/issues/336
        const sendMessage = (message) => {
          const iframe = document.querySelector('iframe.giscus-frame');
          if (!iframe) return;
          iframe.contentWindow.postMessage({ giscus: message }, 'https://giscus.app');
        }
        sendMessage({
          setConfig: {
            theme: newTheme
          }
        });
      }
      const isGiscussLoaded = window.document.querySelector('iframe.giscus-frame') !== null;
      if (isGiscussLoaded) {
        changeGiscusTheme();
      }
    };
    const authorPrefersDark = false;
    const queryPrefersDark = window.matchMedia('(prefers-color-scheme: dark)');
    const darkModeDefault = queryPrefersDark.matches;
      document.querySelector('link#quarto-text-highlighting-styles.quarto-color-scheme-extra').rel = 'disabled-stylesheet';
      document.querySelector('link#quarto-bootstrap.quarto-color-scheme-extra').rel = 'disabled-stylesheet';
    let localAlternateSentinel = darkModeDefault ? 'alternate' : 'default';
    // Dark / light mode switch
    window.quartoToggleColorScheme = () => {
      // Read the current dark / light value
      let toAlternate = !hasAlternateSentinel();
      toggleColorMode(toAlternate);
      setStyleSentinel(toAlternate);
      toggleGiscusIfUsed(toAlternate, darkModeDefault);
      window.dispatchEvent(new Event('resize'));
    };
    queryPrefersDark.addEventListener("change", e => {
      if(window.localStorage.getItem("quarto-color-scheme") !== null)
        return;
      const alternate = e.matches
      toggleColorMode(alternate);
      localAlternateSentinel = e.matches ? 'alternate' : 'default'; // this is used alongside local storage!
      toggleGiscusIfUsed(alternate, darkModeDefault);
    });
    // Switch to dark mode if need be
    if (hasAlternateSentinel()) {
      toggleColorMode(true);
    } else {
      toggleColorMode(false);
    }
  </script>

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top"><div id="quarto-draft-alert" class="alert alert-warning"><i class="bi bi-pencil-square"></i>Draft</div>
    <nav class="navbar navbar-expand-lg " data-bs-theme="dark">
      <div class="navbar-container container-fluid">
      <div class="navbar-brand-container mx-auto">
    <a href="../../index.html" class="navbar-brand navbar-brand-logo">
    <img src="../../asset/deidec.svg" alt="" class="navbar-logo">
    </a>
    <a class="navbar-brand" href="../../index.html">
    <span class="navbar-title">Martin Laptev</span>
    </a>
  </div>
        <div class="quarto-navbar-tools tools-end">
  <a href="" class="quarto-color-scheme-toggle quarto-navigation-tool  px-1" onclick="window.quartoToggleColorScheme(); return false;" title="Toggle dark mode"><i class="bi"></i></a>
  <a href="" class="quarto-reader-toggle quarto-navigation-tool px-1" onclick="window.quartoToggleReader(); return false;" title="Toggle reader mode">
  <div class="quarto-reader-toggle-btn">
  <i class="bi"></i>
  </div>
</a>
</div>
      </div> <!-- /container-fluid -->
    </nav>
  <nav class="quarto-secondary-nav">
    <div class="container-fluid d-flex">
      <button type="button" class="quarto-btn-toggle btn" data-bs-toggle="collapse" role="button" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
        <i class="bi bi-layout-text-sidebar-reverse"></i>
      </button>
        <h1 class="quarto-secondary-nav-title no-breadcrumbs">Dec Time</h1>
        <a class="flex-grow-1" role="navigation" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">      
        </a>
      <button type="button" class="btn quarto-search-button" aria-label="Search" onclick="window.quartoOpenSearch();">
        <i class="bi bi-search"></i>
      </button>
    </div>
  </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-full page-navbar">
<!-- sidebar -->
  <nav id="quarto-sidebar" class="sidebar collapse collapse-horizontal quarto-sidebar-collapse-item sidebar-navigation floating overflow-auto">
        <div class="sidebar-tools-main tools-wide">
    <a href="https://www.github.com/maptv" title="" class="quarto-navigation-tool px-1" aria-label="" target="_blank"><i class="bi bi-github"></i></a>
    <a href="https://www.linkedin.com/in/maptv" title="" class="quarto-navigation-tool px-1" aria-label="" target="_blank"><i class="bi bi-linkedin"></i></a>
    <a href="mailto:maptv@ireni.co" title="" class="quarto-navigation-tool px-1" aria-label=""><i class="bi bi-envelope-at"></i></a>
    <div id="quarto-search" class="quarto-navigation-tool px-1" title="Search"></div>
</div>
    <div class="sidebar-menu-container"> 
    <ul class="list-unstyled mt-1">
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../index.html" class="sidebar-item-text sidebar-link"><i class="bi bi-house-door" role="img">
</i> 
 <span class="menu-text">Home</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../about/index.html" class="sidebar-item-text sidebar-link"><i class="bi bi-info-circle" role="img">
</i> 
 <span class="menu-text">About</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../cv/index.html" class="sidebar-item-text sidebar-link"><i class="bi bi-file-earmark-person" role="img">
</i> 
 <span class="menu-text">CV/Résumé</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../list/index.html" class="sidebar-item-text sidebar-link"><i class="bi bi-grid-3x3-gap" role="img">
</i> 
 <span class="menu-text">Article List</span></a>
  </div>
</li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a href="../../dec/index.html" class="sidebar-item-text sidebar-link"><i class="bi bi-arrow-repeat" role="img">
</i> 
 <span class="menu-text">Dec</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-1" role="navigation" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-1" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../dec/date/index.html" class="sidebar-item-text sidebar-link"><i class="bi bi-calendar-date" role="img">
</i> 
 <span class="menu-text">Date</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../dec/time/index.html" class="sidebar-item-text sidebar-link active"><i class="bi bi-clock" role="img">
</i> 
 <span class="menu-text">Time</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../dec/snap/index.html" class="sidebar-item-text sidebar-link"><i class="bi bi-postage" role="img">
</i> 
 <span class="menu-text">Snap</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../dec/span/index.html" class="sidebar-item-text sidebar-link"><i class="bi bi-calendar-range" role="img">
</i> 
 <span class="menu-text">Span</span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-2" role="navigation" aria-expanded="false"><i class="bi bi-hourglass-split" role="img">
</i> 
 <span class="menu-text">History</span></a>
          <a class="sidebar-item-toggle text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-2" role="navigation" aria-expanded="false" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-2" class="collapse list-unstyled sidebar-section depth1 ">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../history/ww2/index.html" class="sidebar-item-text sidebar-link"><i class="bi bi-2-square" role="img">
</i> 
 <span class="menu-text">World War 2</span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-3" role="navigation" aria-expanded="false"><i class="bi bi-robot" role="img">
</i> 
 <span class="menu-text">Machine Learning</span></a>
          <a class="sidebar-item-toggle text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-3" role="navigation" aria-expanded="false" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-3" class="collapse list-unstyled sidebar-section depth1 ">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../ml/prob/index.html" class="sidebar-item-text sidebar-link"><i class="bi bi-dice-5" role="img">
</i> 
 <span class="menu-text">Probablity</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../ml/llm/index.html" class="sidebar-item-text sidebar-link"><i class="bi bi-translate" role="img">
</i> 
 <span class="menu-text">Language Models</span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-4" role="navigation" aria-expanded="false"><i class="bi bi-laptop" role="img">
</i> 
 <span class="menu-text">Software</span></a>
          <a class="sidebar-item-toggle text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-4" role="navigation" aria-expanded="false" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-4" class="collapse list-unstyled sidebar-section depth1 ">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../git/index.html" class="sidebar-item-text sidebar-link"><i class="bi bi-git" role="img">
</i> 
 <span class="menu-text">Git</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../jupyter/index.html" class="sidebar-item-text sidebar-link"><i class="bi bi-journal-richtext" role="img">
</i> 
 <span class="menu-text">Jupyter</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../observable/index.html" class="sidebar-item-text sidebar-link"><i class="bi bi-0-circle" role="img">
</i> 
 <span class="menu-text">Observable</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../positron/index.html" class="sidebar-item-text sidebar-link"><i class="bi bi-p-square" role="img">
</i> 
 <span class="menu-text">Positron</span></a>
  </div>
</li>
          <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a href="../../quarto/index.html" class="sidebar-item-text sidebar-link"><i class="bi bi-markdown" role="img">
</i> 
 <span class="menu-text">Quarto</span></a>
          <a class="sidebar-item-toggle text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-5" role="navigation" aria-expanded="false" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-5" class="collapse list-unstyled sidebar-section depth2 ">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../quarto/filter/index.html" class="sidebar-item-text sidebar-link"><i class="bi bi-funnel" role="img">
</i> 
 <span class="menu-text">Filter</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../quarto/include/index.html" class="sidebar-item-text sidebar-link"><i class="bi bi-file-earmark-plus" role="img">
</i> 
 <span class="menu-text">Include</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../quarto/script/index.html" class="sidebar-item-text sidebar-link"><i class="bi bi-file-code" role="img">
</i> 
 <span class="menu-text">Script</span></a>
  </div>
</li>
      </ul>
  </li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../reveal/index.html" class="sidebar-item-text sidebar-link"><i class="bi bi-file-slides" role="img">
</i> 
 <span class="menu-text">Reveal</span></a>
  </div>
</li>
      </ul>
  </li>
    </ul>
    </div>
</nav>
<div id="quarto-sidebar-glass" class="quarto-sidebar-collapse-item" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item"></div>
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">On this page</h2>
   
  <ul>
  <li><a href="#tod" id="toc-tod" class="nav-link active" data-scroll-target="#tod">Day of year (doy)</a></li>
  <li><a href="#tod" id="toc-tod" class="nav-link" data-scroll-target="#tod">Time of day (tod)</a></li>
  <li><a href="#zone" id="toc-zone" class="nav-link" data-scroll-target="#zone">Zone</a></li>
  <li><a href="#unit" id="toc-unit" class="nav-link" data-scroll-target="#unit">Unit</a></li>
  <li><a href="#next" id="toc-next" class="nav-link" data-scroll-target="#next">Next</a></li>
  <li><a href="#cite" id="toc-cite" class="nav-link" data-scroll-target="#cite">Cite</a></li>
  </ul>
<div class="toc-actions"><ul><li><a href="https://github.com/maptv/maptv.github.io/blob/main/dec/time/index.qmd" class="toc-action"><i class="bi bi-github"></i>View source</a></li></ul></div><div class="quarto-alternate-formats"><h2>Other Formats</h2><ul><li><a href="index.md"><i class="bi bi-file-code"></i>CommonMark</a></li></ul></div></nav>
    </div>
<!-- main -->
<main class="content column-body" id="quarto-document-content">


<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<div class="quarto-title-block"><div><h1 class="title d-none d-lg-block">Dec Time</h1><button type="button" class="btn code-tools-button" id="quarto-code-tools-source"><i class="bi"></i> Code</button></div></div>
</div>

<div>
  <div class="description">
    <p>Introducing Declock, a timekeeping system that displays time in decimal days using math notation without the need for hours, minutes, or seconds.</p>
  </div>
</div>


<div class="quarto-title-meta column-body">

    <div>
    <div class="quarto-title-meta-heading">Author</div>
    <div class="quarto-title-meta-contents">
             <p><a href="https://maptv.github.io">Martin Laptev</a> </p>
          </div>
  </div>
    
    <div>
    <div class="quarto-title-meta-heading">Published</div>
    <div class="quarto-title-meta-contents">
      <p class="date">2025+072</p>
    </div>
  </div>
  
    
  </div>
  


</header>


<div class="cell" data-layout-align="default">
<div class="cell-output-display">
<div id="timenav">
<div>
<pre class="mermaid mermaid-js" data-label="timenav">%%{init: {'theme': 'default', 'themeVariables': { 'fontSize': '32px'}}}%%
flowchart LR
   A[Dec]--&gt;B[date]--&gt;C[time]--&gt;D[snap]--&gt;E[span]
   click A "/dec"
   click B "/dec/date"
   click C "/dec/time"
   click D "/dec/snap"
   click E "/dec/span"
</pre>
</div>
</div>
</div>
</div>
<section id="tod" class="level4 hiddenheading">
<h4 class="hiddenheading anchored" data-anchor-id="tod">Day of year (doy)</h4>
<p>My website provides many examples of the <a href="https://quarto.org">Quarto</a> publishing and the <a href="../../dec">Dec</a> measurement systems in action. I leverage Quarto support for the <a href="https://observablehq.com/">Observable</a> data analysis and visualization system to create animated and interactive graphics like the clocks🕓and bar📊charts below, which display the Dec time in the Dec time zone, <span class="lime"><span><span id="ojs-element-id-1"></span></span></span>, selected by the red⭕️circle on the <a href="https://en.wikipedia.org/wiki/Terminator_%28solar%29#:~:text=a%20moving%20line%20that%20divides%20the%20daylit%20side%20and%20the%20dark%20night%20side%20of%20a%20planetary%20body">solar☀️terminator</a> map🗺️beneath the bars📊.</p>
<p>like the one on the left side of the <a href="https://en.wikipedia.org/wiki/Navigation_bar#:~:text=a%20section%20of%20a%20graphical%20user%20interface%20intended%20to%20aid%20visitors%20in%20accessing%20information">navigation bar</a> (navbar) above.</p>
<p>Dec times consist of a time-of-day (<span class="under tool" data-bs-toggle="tooltip" data-bs-title="time-of-day">tod</span>) and a time zone. The <span class="under tool" data-bs-toggle="tooltip" data-bs-title="time-of-day">tod</span> can be obtained from either a day-of-year (<span class="under tool" data-bs-toggle="tooltip" data-bs-title="day-of-year">doy</span>) or a day-of-era (<span class="under tool" data-bs-toggle="tooltip" data-bs-title="day-of-era">doe</span>). To get the <span class="under tool" data-bs-toggle="tooltip" data-bs-title="time-of-day">tod</span> in <a href="https://en.wikipedia.org/wiki/Decimal_time#Fractional_days:~:text=a%20decimal%20fraction%20of%20a%20day">fractional days</a>, we divide by one and keep remainder: <span class="cyan">d</span> <a href="https://en.wikipedia.org/wiki/Modulo#:~:text=returns%20the%20remainder">mod</a> 1 = <span class="cyan">t</span>. In the times below clocks and on the bar charts, the tod and time zone are both in <a href="https://en.wikipedia.org/wiki/Decimal_time#:~:text=dividing%20the%20day%20into%2010%20decidays" class="under tool" data-bs-toggle="tooltip" data-bs-title="tenths of a day">decidays</a>: <span class="cyan">d</span> × 10 <a href="https://en.wikipedia.org/wiki/Modulo#:~:text=returns%20the%20remainder">mod</a> 10 = <span class="cyan">t</span>.</p>
</section>
<section id="tod" class="level4 hiddenheading">
<h4 class="hiddenheading anchored" data-anchor-id="tod">Time of day (tod)</h4>
<p>Dec times are measured in <a href="https://en.wikipedia.org/wiki/Decimal_time#Fractional_days:~:text=a%20decimal%20fraction%20of%20a%20day">fractional days</a>. The shortest, longest, and thinnest clock🕓hands and the top, middle, and bottom bars📊indicate the <a href="https://en.wikipedia.org/wiki/Decimal_time#:~:text=dividing%20the%20day%20into%2010%20decidays" class="under tool" data-bs-toggle="tooltip" data-bs-title="tenths of a day">decidays</a>, <span class="under tool" data-bs-toggle="tooltip" data-bs-title="thousandths of a day">millidays</span>, and <span class="under tool" data-bs-toggle="tooltip" data-bs-title="hundred thousandths of a day">centimillidays</span>, respectively, of the time since the start, <span class="cyan"><span>+<span id="ojs-element-id-2"></span></span></span>, or until the end, <span class="pink"><span>-<span id="ojs-element-id-3"></span></span></span>, of the day in the</p>
<div class="clocks">
<p><span><span id="ojs-element-id-4"></span></span></p>
</div>
<div class="cell">
<div class="sourceCode cell-code hidden" id="cb1" data-startfrom="68" data-source-offset="-51"><pre class="sourceCode js code-with-copy"><code class="sourceCode javascript" style="counter-reset: source-line 67;"><span id="cb1-68"><a href="#cb1-68" aria-hidden="true" tabindex="-1"></a>barChart <span class="op">=</span> {</span>
<span id="cb1-69"><a href="#cb1-69" aria-hidden="true" tabindex="-1"></a><span class="kw">const</span> W <span class="op">=</span> width<span class="op">;</span></span>
<span id="cb1-70"><a href="#cb1-70" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> H <span class="op">=</span> <span class="dv">88</span><span class="op">;</span></span>
<span id="cb1-71"><a href="#cb1-71" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> barX <span class="op">=</span> <span class="dv">1</span><span class="op">;</span></span>
<span id="cb1-72"><a href="#cb1-72" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> firstBarY <span class="op">=</span> <span class="dv">1</span><span class="op">;</span></span>
<span id="cb1-73"><a href="#cb1-73" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> svg <span class="op">=</span> d3</span>
<span id="cb1-74"><a href="#cb1-74" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">create</span>(<span class="st">"svg"</span>)</span>
<span id="cb1-75"><a href="#cb1-75" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">"width"</span><span class="op">,</span> W)</span>
<span id="cb1-76"><a href="#cb1-76" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">"viewBox"</span><span class="op">,</span> [<span class="dv">0</span><span class="op">,</span> <span class="dv">0</span><span class="op">,</span> W <span class="op">*</span> (W <span class="op">&lt;</span> <span class="dv">370</span> <span class="op">?</span> <span class="op">.</span><span class="dv">73</span> <span class="op">:</span> W <span class="op">&lt;</span> <span class="dv">420</span> <span class="op">?</span> <span class="op">.</span><span class="dv">76</span> <span class="op">:</span> W <span class="op">&lt;</span> <span class="dv">470</span> <span class="op">?</span> <span class="op">.</span><span class="dv">79</span> <span class="op">:</span> W <span class="op">&lt;</span> <span class="dv">520</span> <span class="op">?</span> <span class="op">.</span><span class="dv">81</span> <span class="op">:</span> W <span class="op">&lt;</span> <span class="dv">570</span> <span class="op">?</span> <span class="op">.</span><span class="dv">83</span> <span class="op">:</span> W <span class="op">&lt;</span> <span class="dv">620</span> <span class="op">?</span> <span class="op">.</span><span class="dv">84</span> <span class="op">:</span> W <span class="op">&lt;</span> <span class="dv">670</span> <span class="op">?</span> <span class="op">.</span><span class="dv">85</span> <span class="op">:</span> W <span class="op">&lt;</span> <span class="dv">720</span> <span class="op">?</span> <span class="op">.</span><span class="dv">86</span> <span class="op">:</span> <span class="op">.</span><span class="dv">87</span>)<span class="op">,</span> H])<span class="op">;</span></span>
<span id="cb1-77"><a href="#cb1-77" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> xRange <span class="op">=</span> [<span class="dv">0</span><span class="op">,</span> W <span class="op">-</span> <span class="dv">100</span>]<span class="op">;</span></span>
<span id="cb1-78"><a href="#cb1-78" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> scaleDD <span class="op">=</span> d3<span class="op">.</span><span class="fu">scaleLinear</span>()</span>
<span id="cb1-79"><a href="#cb1-79" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">domain</span>([<span class="dv">0</span><span class="op">,</span> <span class="dv">10</span>])</span>
<span id="cb1-80"><a href="#cb1-80" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">range</span>(xRange)<span class="op">;</span></span>
<span id="cb1-81"><a href="#cb1-81" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> scaleMandB <span class="op">=</span> d3<span class="op">.</span><span class="fu">scaleLinear</span>()</span>
<span id="cb1-82"><a href="#cb1-82" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">domain</span>([<span class="dv">0</span><span class="op">,</span> <span class="dv">100</span>])</span>
<span id="cb1-83"><a href="#cb1-83" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">range</span>(xRange)<span class="op">;</span></span>
<span id="cb1-84"><a href="#cb1-84" aria-hidden="true" tabindex="-1"></a>  <span class="co">// Background bars to show where 100% lies</span></span>
<span id="cb1-85"><a href="#cb1-85" aria-hidden="true" tabindex="-1"></a>  svg<span class="op">.</span><span class="fu">selectAll</span>(<span class="st">'.background'</span>)</span>
<span id="cb1-86"><a href="#cb1-86" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">data</span>([</span>
<span id="cb1-87"><a href="#cb1-87" aria-hidden="true" tabindex="-1"></a>      <span class="st">'dd'</span><span class="op">,</span> <span class="st">"mils"</span><span class="op">,</span> <span class="st">'beats'</span>])</span>
<span id="cb1-88"><a href="#cb1-88" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">enter</span>()</span>
<span id="cb1-89"><a href="#cb1-89" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">append</span>(<span class="st">'rect'</span>)</span>
<span id="cb1-90"><a href="#cb1-90" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">'class'</span><span class="op">,</span> <span class="st">'background timeBar'</span>)</span>
<span id="cb1-91"><a href="#cb1-91" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">'width'</span><span class="op">,</span> W<span class="op">-</span><span class="dv">100</span>)</span>
<span id="cb1-92"><a href="#cb1-92" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">'y'</span><span class="op">,</span> (d<span class="op">,</span>i)<span class="kw">=&gt;</span>i<span class="op">*</span><span class="dv">30</span><span class="op">+</span>firstBarY)</span>
<span id="cb1-93"><a href="#cb1-93" aria-hidden="true" tabindex="-1"></a>  <span class="co">// Beats</span></span>
<span id="cb1-94"><a href="#cb1-94" aria-hidden="true" tabindex="-1"></a>  svg</span>
<span id="cb1-95"><a href="#cb1-95" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">append</span>(<span class="st">'rect'</span>)</span>
<span id="cb1-96"><a href="#cb1-96" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">'class'</span><span class="op">,</span> <span class="st">'timeBar'</span>)</span>
<span id="cb1-97"><a href="#cb1-97" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">'y'</span><span class="op">,</span> firstBarY<span class="op">+</span><span class="dv">60</span>)</span>
<span id="cb1-98"><a href="#cb1-98" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">'width'</span><span class="op">,</span> d <span class="kw">=&gt;</span> <span class="fu">scaleMandB</span>(<span class="bu">Number</span>(barBeats)))</span>
<span id="cb1-99"><a href="#cb1-99" aria-hidden="true" tabindex="-1"></a>  svg</span>
<span id="cb1-100"><a href="#cb1-100" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">append</span>(<span class="st">'rect'</span>)</span>
<span id="cb1-101"><a href="#cb1-101" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">'class'</span><span class="op">,</span> <span class="st">'timeBarFull'</span>)</span>
<span id="cb1-102"><a href="#cb1-102" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">'y'</span><span class="op">,</span> firstBarY<span class="op">+</span><span class="dv">60</span>)</span>
<span id="cb1-103"><a href="#cb1-103" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">'width'</span><span class="op">,</span> d <span class="kw">=&gt;</span> <span class="fu">scaleMandB</span>(barBeats))</span>
<span id="cb1-104"><a href="#cb1-104" aria-hidden="true" tabindex="-1"></a>  <span class="co">// Cents/Mils</span></span>
<span id="cb1-105"><a href="#cb1-105" aria-hidden="true" tabindex="-1"></a>  svg</span>
<span id="cb1-106"><a href="#cb1-106" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">append</span>(<span class="st">'rect'</span>)</span>
<span id="cb1-107"><a href="#cb1-107" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">'class'</span><span class="op">,</span> <span class="st">'timeBar'</span>)</span>
<span id="cb1-108"><a href="#cb1-108" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">'y'</span><span class="op">,</span> firstBarY)</span>
<span id="cb1-109"><a href="#cb1-109" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">'width'</span><span class="op">,</span> d <span class="kw">=&gt;</span> <span class="fu">scaleDD</span>(<span class="bu">Number</span>(barDD)<span class="op">+</span><span class="bu">Number</span>(barMils)<span class="op">/</span><span class="dv">100</span><span class="op">+</span><span class="bu">Number</span>(barBeats)<span class="op">/</span><span class="dv">10000</span>))</span>
<span id="cb1-110"><a href="#cb1-110" aria-hidden="true" tabindex="-1"></a>  svg</span>
<span id="cb1-111"><a href="#cb1-111" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">append</span>(<span class="st">'rect'</span>)</span>
<span id="cb1-112"><a href="#cb1-112" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">'class'</span><span class="op">,</span> <span class="st">'timeBarFull'</span>)</span>
<span id="cb1-113"><a href="#cb1-113" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">'y'</span><span class="op">,</span> firstBarY)</span>
<span id="cb1-114"><a href="#cb1-114" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">'width'</span><span class="op">,</span> d <span class="kw">=&gt;</span> <span class="fu">scaleDD</span>(barDD))</span>
<span id="cb1-115"><a href="#cb1-115" aria-hidden="true" tabindex="-1"></a>  svg</span>
<span id="cb1-116"><a href="#cb1-116" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">append</span>(<span class="st">'rect'</span>)</span>
<span id="cb1-117"><a href="#cb1-117" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">'class'</span><span class="op">,</span> <span class="st">'timeBar'</span>)</span>
<span id="cb1-118"><a href="#cb1-118" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">'y'</span><span class="op">,</span> firstBarY<span class="op">+</span><span class="dv">30</span>)</span>
<span id="cb1-119"><a href="#cb1-119" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">'width'</span><span class="op">,</span> d <span class="kw">=&gt;</span> <span class="fu">scaleMandB</span>(<span class="bu">Number</span>(barMils)<span class="op">+</span><span class="bu">Number</span>(barBeats)<span class="op">/</span><span class="dv">100</span>))</span>
<span id="cb1-120"><a href="#cb1-120" aria-hidden="true" tabindex="-1"></a>  svg</span>
<span id="cb1-121"><a href="#cb1-121" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">append</span>(<span class="st">'rect'</span>)</span>
<span id="cb1-122"><a href="#cb1-122" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">'class'</span><span class="op">,</span> <span class="st">'timeBarFull'</span>)</span>
<span id="cb1-123"><a href="#cb1-123" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">'y'</span><span class="op">,</span> firstBarY<span class="op">+</span><span class="dv">30</span>)</span>
<span id="cb1-124"><a href="#cb1-124" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">'width'</span><span class="op">,</span> d <span class="kw">=&gt;</span> <span class="fu">scaleMandB</span>(barMils))</span>
<span id="cb1-125"><a href="#cb1-125" aria-hidden="true" tabindex="-1"></a>  <span class="co">// Cent ticks</span></span>
<span id="cb1-126"><a href="#cb1-126" aria-hidden="true" tabindex="-1"></a>  svg<span class="op">.</span><span class="fu">selectAll</span>(<span class="st">'.tickC'</span>)</span>
<span id="cb1-127"><a href="#cb1-127" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">data</span>(d3<span class="op">.</span><span class="fu">range</span>(width <span class="op">&gt;</span> <span class="dv">500</span> <span class="op">?</span> <span class="dv">10</span> <span class="op">:</span> <span class="dv">10</span><span class="op">,</span> <span class="dv">100</span>))</span>
<span id="cb1-128"><a href="#cb1-128" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">enter</span>()</span>
<span id="cb1-129"><a href="#cb1-129" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">append</span>(<span class="st">'rect'</span>)</span>
<span id="cb1-130"><a href="#cb1-130" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">'class'</span><span class="op">,</span> <span class="st">'tickC'</span>)</span>
<span id="cb1-131"><a href="#cb1-131" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">'x'</span><span class="op">,</span> d<span class="kw">=&gt;</span><span class="fu">scaleDD</span>(d<span class="op">/</span><span class="dv">10</span>)<span class="op">+</span>barX)</span>
<span id="cb1-132"><a href="#cb1-132" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">'y'</span><span class="op">,</span> firstBarY<span class="op">+</span><span class="dv">30</span>)</span>
<span id="cb1-133"><a href="#cb1-133" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">'height'</span><span class="op">,</span> d<span class="kw">=&gt;</span>d<span class="op">%</span><span class="dv">2</span><span class="op">===</span><span class="dv">0</span><span class="op">?</span> <span class="dv">8</span><span class="op">:</span><span class="dv">5</span>)</span>
<span id="cb1-134"><a href="#cb1-134" aria-hidden="true" tabindex="-1"></a>  svg<span class="op">.</span><span class="fu">selectAll</span>(<span class="st">'.tickB1'</span>)</span>
<span id="cb1-135"><a href="#cb1-135" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">data</span>(d3<span class="op">.</span><span class="fu">range</span>(width <span class="op">&gt;</span> <span class="dv">500</span> <span class="op">?</span> <span class="dv">10</span> <span class="op">:</span> <span class="dv">10</span><span class="op">,</span> <span class="dv">100</span>))</span>
<span id="cb1-136"><a href="#cb1-136" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">enter</span>()</span>
<span id="cb1-137"><a href="#cb1-137" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">append</span>(<span class="st">'rect'</span>)</span>
<span id="cb1-138"><a href="#cb1-138" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">'class'</span><span class="op">,</span> <span class="st">'tickB1'</span>)</span>
<span id="cb1-139"><a href="#cb1-139" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">'x'</span><span class="op">,</span> d<span class="kw">=&gt;</span><span class="fu">scaleDD</span>(d<span class="op">/</span><span class="dv">10</span>)<span class="op">+</span>barX)</span>
<span id="cb1-140"><a href="#cb1-140" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">'y'</span><span class="op">,</span> d<span class="kw">=&gt;</span>d<span class="op">%</span><span class="dv">2</span><span class="op">===</span><span class="dv">0</span><span class="op">?</span> firstBarY<span class="op">+</span><span class="dv">77</span><span class="op">:</span>firstBarY<span class="op">+</span><span class="dv">80</span>)</span>
<span id="cb1-141"><a href="#cb1-141" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">'height'</span><span class="op">,</span> d<span class="kw">=&gt;</span>d<span class="op">%</span><span class="dv">2</span><span class="op">===</span><span class="dv">0</span><span class="op">?</span> <span class="dv">8</span><span class="op">:</span><span class="dv">5</span>)</span>
<span id="cb1-142"><a href="#cb1-142" aria-hidden="true" tabindex="-1"></a>  svg<span class="op">.</span><span class="fu">selectAll</span>(<span class="st">'.tickC1'</span>)</span>
<span id="cb1-143"><a href="#cb1-143" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">data</span>(d3<span class="op">.</span><span class="fu">range</span>(width <span class="op">&gt;</span> <span class="dv">500</span> <span class="op">?</span> <span class="dv">10</span> <span class="op">:</span> <span class="dv">10</span><span class="op">,</span> <span class="dv">100</span>))</span>
<span id="cb1-144"><a href="#cb1-144" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">enter</span>()</span>
<span id="cb1-145"><a href="#cb1-145" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">append</span>(<span class="st">'rect'</span>)</span>
<span id="cb1-146"><a href="#cb1-146" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">'class'</span><span class="op">,</span> <span class="st">'tickC1'</span>)</span>
<span id="cb1-147"><a href="#cb1-147" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">'x'</span><span class="op">,</span> d<span class="kw">=&gt;</span><span class="fu">scaleDD</span>(d<span class="op">/</span><span class="dv">10</span>)<span class="op">+</span>barX)</span>
<span id="cb1-148"><a href="#cb1-148" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">'y'</span><span class="op">,</span> d<span class="kw">=&gt;</span>d<span class="op">%</span><span class="dv">2</span><span class="op">===</span><span class="dv">0</span><span class="op">?</span> firstBarY<span class="op">+</span><span class="dv">47</span><span class="op">:</span>firstBarY<span class="op">+</span><span class="dv">50</span>)</span>
<span id="cb1-149"><a href="#cb1-149" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">'height'</span><span class="op">,</span> d<span class="kw">=&gt;</span>d<span class="op">%</span><span class="dv">2</span><span class="op">===</span><span class="dv">0</span><span class="op">?</span> <span class="dv">8</span><span class="op">:</span><span class="dv">5</span>)</span>
<span id="cb1-150"><a href="#cb1-150" aria-hidden="true" tabindex="-1"></a>  <span class="co">// Mil ticks</span></span>
<span id="cb1-151"><a href="#cb1-151" aria-hidden="true" tabindex="-1"></a>  svg<span class="op">.</span><span class="fu">selectAll</span>(<span class="st">'.tickM'</span>)</span>
<span id="cb1-152"><a href="#cb1-152" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">data</span>(d3<span class="op">.</span><span class="fu">range</span>(width <span class="op">&gt;</span> <span class="dv">500</span> <span class="op">?</span> <span class="dv">1</span> <span class="op">:</span> <span class="dv">1</span><span class="op">,</span> <span class="dv">10</span>))</span>
<span id="cb1-153"><a href="#cb1-153" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">enter</span>()</span>
<span id="cb1-154"><a href="#cb1-154" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">append</span>(<span class="st">'rect'</span>)</span>
<span id="cb1-155"><a href="#cb1-155" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">'class'</span><span class="op">,</span> <span class="st">'tickM'</span>)</span>
<span id="cb1-156"><a href="#cb1-156" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">'x'</span><span class="op">,</span> d<span class="kw">=&gt;</span><span class="fu">scaleDD</span>(d)<span class="op">+</span>barX)</span>
<span id="cb1-157"><a href="#cb1-157" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">'y'</span><span class="op">,</span> firstBarY<span class="op">+</span><span class="dv">20</span>)</span>
<span id="cb1-158"><a href="#cb1-158" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">'height'</span><span class="op">,</span> <span class="dv">6</span>)</span>
<span id="cb1-159"><a href="#cb1-159" aria-hidden="true" tabindex="-1"></a>  svg<span class="op">.</span><span class="fu">selectAll</span>(<span class="st">'.tickLabel1'</span>)</span>
<span id="cb1-160"><a href="#cb1-160" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">data</span>(d3<span class="op">.</span><span class="fu">range</span>(width <span class="op">&gt;</span> <span class="dv">500</span> <span class="op">?</span> <span class="dv">1</span> <span class="op">:</span> <span class="dv">1</span><span class="op">,</span> <span class="dv">10</span>))</span>
<span id="cb1-161"><a href="#cb1-161" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">enter</span>()</span>
<span id="cb1-162"><a href="#cb1-162" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">append</span>(<span class="st">'text'</span>)</span>
<span id="cb1-163"><a href="#cb1-163" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">'class'</span><span class="op">,</span> <span class="st">'tickLabel1'</span>)</span>
<span id="cb1-164"><a href="#cb1-164" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">'x'</span><span class="op">,</span> d<span class="kw">=&gt;</span><span class="fu">scaleDD</span>(d)<span class="op">+</span>barX<span class="op">+.</span><span class="dv">5</span>)</span>
<span id="cb1-165"><a href="#cb1-165" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">'y'</span><span class="op">,</span> firstBarY<span class="op">+</span><span class="dv">18</span>)</span>
<span id="cb1-166"><a href="#cb1-166" aria-hidden="true" tabindex="-1"></a>    <span class="co">//.style("font-size", `{W &lt; 550 ? 12 : W &lt; 650 ? 14 : W &lt; 750 ? 16 : W &lt; 850 ? 18 : 20}px`)</span></span>
<span id="cb1-167"><a href="#cb1-167" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">text</span>(d<span class="kw">=&gt;</span>d)</span>
<span id="cb1-168"><a href="#cb1-168" aria-hidden="true" tabindex="-1"></a>  <span class="co">// Cent ticks</span></span>
<span id="cb1-169"><a href="#cb1-169" aria-hidden="true" tabindex="-1"></a>  svg<span class="op">.</span><span class="fu">selectAll</span>(<span class="st">'.tickC2'</span>)</span>
<span id="cb1-170"><a href="#cb1-170" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">data</span>(d3<span class="op">.</span><span class="fu">range</span>(width <span class="op">&gt;</span> <span class="dv">500</span> <span class="op">?</span> <span class="dv">10</span> <span class="op">:</span> <span class="dv">10</span><span class="op">,</span> <span class="dv">100</span>))</span>
<span id="cb1-171"><a href="#cb1-171" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">enter</span>()</span>
<span id="cb1-172"><a href="#cb1-172" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">append</span>(<span class="st">'rect'</span>)</span>
<span id="cb1-173"><a href="#cb1-173" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">'class'</span><span class="op">,</span> <span class="st">'tickC2'</span>)</span>
<span id="cb1-174"><a href="#cb1-174" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">'x'</span><span class="op">,</span> d<span class="kw">=&gt;</span><span class="fu">scaleDD</span>(d<span class="op">/</span><span class="dv">10</span>)<span class="op">+</span>barX)</span>
<span id="cb1-175"><a href="#cb1-175" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">'y'</span><span class="op">,</span> firstBarY<span class="op">+</span><span class="dv">10</span>)</span>
<span id="cb1-176"><a href="#cb1-176" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">'height'</span><span class="op">,</span> d<span class="kw">=&gt;</span>d<span class="op">%</span><span class="dv">2</span><span class="op">===</span><span class="dv">0</span><span class="op">?</span> <span class="dv">9</span><span class="op">:</span><span class="dv">6</span>)</span>
<span id="cb1-177"><a href="#cb1-177" aria-hidden="true" tabindex="-1"></a>  <span class="co">// Beat ticks</span></span>
<span id="cb1-178"><a href="#cb1-178" aria-hidden="true" tabindex="-1"></a>  svg<span class="op">.</span><span class="fu">selectAll</span>(<span class="st">'.tickB'</span>)</span>
<span id="cb1-179"><a href="#cb1-179" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">data</span>(d3<span class="op">.</span><span class="fu">range</span>(width <span class="op">&gt;</span> <span class="dv">500</span> <span class="op">?</span> <span class="dv">10</span> <span class="op">:</span> <span class="dv">10</span><span class="op">,</span> <span class="dv">100</span>))</span>
<span id="cb1-180"><a href="#cb1-180" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">enter</span>()</span>
<span id="cb1-181"><a href="#cb1-181" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">append</span>(<span class="st">'rect'</span>)</span>
<span id="cb1-182"><a href="#cb1-182" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">'class'</span><span class="op">,</span> <span class="st">'tickB'</span>)</span>
<span id="cb1-183"><a href="#cb1-183" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">'x'</span><span class="op">,</span> d<span class="kw">=&gt;</span><span class="fu">scaleDD</span>(d<span class="op">/</span><span class="dv">10</span>)<span class="op">+</span>barX)</span>
<span id="cb1-184"><a href="#cb1-184" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">'y'</span><span class="op">,</span> firstBarY<span class="op">+</span><span class="dv">60</span>)</span>
<span id="cb1-185"><a href="#cb1-185" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">'height'</span><span class="op">,</span> d<span class="kw">=&gt;</span>d<span class="op">%</span><span class="dv">2</span><span class="op">===</span><span class="dv">0</span><span class="op">?</span> <span class="dv">9</span><span class="op">:</span><span class="dv">6</span>)</span>
<span id="cb1-186"><a href="#cb1-186" aria-hidden="true" tabindex="-1"></a>  <span class="co">// Labels</span></span>
<span id="cb1-187"><a href="#cb1-187" aria-hidden="true" tabindex="-1"></a>  svg<span class="op">.</span><span class="fu">selectAll</span>(<span class="st">'.timeLabel'</span>)</span>
<span id="cb1-188"><a href="#cb1-188" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">data</span>([<span class="vs">`+</span><span class="sc">${</span>barDD<span class="sc">}</span><span class="vs">`</span><span class="op">,</span> <span class="vs">`</span><span class="sc">${</span>barMils<span class="sc">}</span><span class="vs">`</span><span class="op">,</span> <span class="vs">`</span><span class="sc">${</span>barBeats<span class="sc">}</span><span class="vs">`</span>])</span>
<span id="cb1-189"><a href="#cb1-189" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">enter</span>()</span>
<span id="cb1-190"><a href="#cb1-190" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">append</span>(<span class="st">'text'</span>)</span>
<span id="cb1-191"><a href="#cb1-191" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">'class'</span><span class="op">,</span> <span class="st">'timeLabel'</span>)</span>
<span id="cb1-192"><a href="#cb1-192" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">'x'</span><span class="op">,</span> barX<span class="op">+</span><span class="dv">2</span>)</span>
<span id="cb1-193"><a href="#cb1-193" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">'y'</span><span class="op">,</span> (d<span class="op">,</span>i)<span class="kw">=&gt;</span>i<span class="op">*</span><span class="dv">30</span><span class="op">+</span>firstBarY<span class="op">+</span><span class="dv">20</span>)</span>
<span id="cb1-194"><a href="#cb1-194" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">style</span>(<span class="st">"font-size"</span><span class="op">,</span> <span class="vs">`</span><span class="sc">${</span>W <span class="op">&lt;</span> <span class="dv">300</span> <span class="op">?</span> <span class="dv">14</span> <span class="op">:</span> W <span class="op">&lt;</span> <span class="dv">400</span> <span class="op">?</span> <span class="dv">16</span> <span class="op">:</span> W <span class="op">&lt;</span> <span class="dv">500</span> <span class="op">?</span> <span class="dv">18</span> <span class="op">:</span> W <span class="op">&lt;</span> <span class="dv">600</span> <span class="op">?</span> <span class="dv">20</span> <span class="op">:</span> <span class="dv">22</span><span class="sc">}</span><span class="vs">px`</span>)</span>
<span id="cb1-195"><a href="#cb1-195" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">text</span>(d<span class="kw">=&gt;</span>d)<span class="op">;</span></span>
<span id="cb1-196"><a href="#cb1-196" aria-hidden="true" tabindex="-1"></a>  svg<span class="op">.</span><span class="fu">attr</span>(<span class="st">"id"</span><span class="op">,</span> <span class="st">"barClock"</span>)<span class="op">;</span></span>
<span id="cb1-197"><a href="#cb1-197" aria-hidden="true" tabindex="-1"></a>  <span class="cf">return</span> svg<span class="op">.</span><span class="fu">node</span>()<span class="op">;</span></span>
<span id="cb1-198"><a href="#cb1-198" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb1-199"><a href="#cb1-199" aria-hidden="true" tabindex="-1"></a>barChart1 <span class="op">=</span> {</span>
<span id="cb1-200"><a href="#cb1-200" aria-hidden="true" tabindex="-1"></a><span class="kw">const</span> W <span class="op">=</span> width<span class="op">;</span></span>
<span id="cb1-201"><a href="#cb1-201" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> H <span class="op">=</span> <span class="dv">88</span><span class="op">;</span></span>
<span id="cb1-202"><a href="#cb1-202" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> barX <span class="op">=</span> <span class="dv">1</span><span class="op">;</span></span>
<span id="cb1-203"><a href="#cb1-203" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> firstBarY <span class="op">=</span> <span class="dv">1</span><span class="op">;</span></span>
<span id="cb1-204"><a href="#cb1-204" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> svg <span class="op">=</span> d3</span>
<span id="cb1-205"><a href="#cb1-205" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">create</span>(<span class="st">"svg"</span>)</span>
<span id="cb1-206"><a href="#cb1-206" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">"width"</span><span class="op">,</span> W)</span>
<span id="cb1-207"><a href="#cb1-207" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">"viewBox"</span><span class="op">,</span> [<span class="dv">0</span><span class="op">,</span> <span class="dv">0</span><span class="op">,</span> W <span class="op">*</span> (W <span class="op">&lt;</span> <span class="dv">370</span> <span class="op">?</span> <span class="op">.</span><span class="dv">73</span> <span class="op">:</span> W <span class="op">&lt;</span> <span class="dv">420</span> <span class="op">?</span> <span class="op">.</span><span class="dv">76</span> <span class="op">:</span> W <span class="op">&lt;</span> <span class="dv">470</span> <span class="op">?</span> <span class="op">.</span><span class="dv">79</span> <span class="op">:</span> W <span class="op">&lt;</span> <span class="dv">520</span> <span class="op">?</span> <span class="op">.</span><span class="dv">81</span> <span class="op">:</span> W <span class="op">&lt;</span> <span class="dv">570</span> <span class="op">?</span> <span class="op">.</span><span class="dv">83</span> <span class="op">:</span> W <span class="op">&lt;</span> <span class="dv">620</span> <span class="op">?</span> <span class="op">.</span><span class="dv">84</span> <span class="op">:</span> W <span class="op">&lt;</span> <span class="dv">670</span> <span class="op">?</span> <span class="op">.</span><span class="dv">85</span> <span class="op">:</span> W <span class="op">&lt;</span> <span class="dv">720</span> <span class="op">?</span> <span class="op">.</span><span class="dv">86</span> <span class="op">:</span> <span class="op">.</span><span class="dv">87</span>)<span class="op">,</span> H])<span class="op">;</span></span>
<span id="cb1-208"><a href="#cb1-208" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> xRange <span class="op">=</span> [<span class="dv">0</span><span class="op">,</span> W <span class="op">-</span> <span class="dv">100</span>]<span class="op">;</span></span>
<span id="cb1-209"><a href="#cb1-209" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> scaleDD <span class="op">=</span> d3<span class="op">.</span><span class="fu">scaleLinear</span>()</span>
<span id="cb1-210"><a href="#cb1-210" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">domain</span>([<span class="dv">0</span><span class="op">,</span> <span class="dv">10</span>])</span>
<span id="cb1-211"><a href="#cb1-211" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">range</span>(xRange)<span class="op">;</span></span>
<span id="cb1-212"><a href="#cb1-212" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> scaleMandB <span class="op">=</span> d3<span class="op">.</span><span class="fu">scaleLinear</span>()</span>
<span id="cb1-213"><a href="#cb1-213" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">domain</span>([<span class="dv">0</span><span class="op">,</span> <span class="dv">100</span>])</span>
<span id="cb1-214"><a href="#cb1-214" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">range</span>(xRange)<span class="op">;</span></span>
<span id="cb1-215"><a href="#cb1-215" aria-hidden="true" tabindex="-1"></a>  <span class="co">// const scaleDek = d3.scaleLinear()</span></span>
<span id="cb1-216"><a href="#cb1-216" aria-hidden="true" tabindex="-1"></a>  <span class="co">//  .domain([0, 37])</span></span>
<span id="cb1-217"><a href="#cb1-217" aria-hidden="true" tabindex="-1"></a>  <span class="co">//  .range(xRange);</span></span>
<span id="cb1-218"><a href="#cb1-218" aria-hidden="true" tabindex="-1"></a>  <span class="co">// Background bars to show where 100% lies</span></span>
<span id="cb1-219"><a href="#cb1-219" aria-hidden="true" tabindex="-1"></a>  svg<span class="op">.</span><span class="fu">selectAll</span>(<span class="st">'.background'</span>)</span>
<span id="cb1-220"><a href="#cb1-220" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">data</span>([</span>
<span id="cb1-221"><a href="#cb1-221" aria-hidden="true" tabindex="-1"></a>      <span class="co">// 'dek', 'dotd',</span></span>
<span id="cb1-222"><a href="#cb1-222" aria-hidden="true" tabindex="-1"></a>      <span class="st">'dd'</span><span class="op">,</span> <span class="st">"mils"</span><span class="op">,</span> <span class="st">'beats'</span>])</span>
<span id="cb1-223"><a href="#cb1-223" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">enter</span>()</span>
<span id="cb1-224"><a href="#cb1-224" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">append</span>(<span class="st">'rect'</span>)</span>
<span id="cb1-225"><a href="#cb1-225" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">'class'</span><span class="op">,</span> <span class="st">'background timeBar'</span>)</span>
<span id="cb1-226"><a href="#cb1-226" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">'width'</span><span class="op">,</span> W<span class="op">-</span><span class="dv">100</span>)</span>
<span id="cb1-227"><a href="#cb1-227" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">'y'</span><span class="op">,</span> (d<span class="op">,</span>i)<span class="kw">=&gt;</span>i<span class="op">*</span><span class="dv">30</span><span class="op">+</span>firstBarY)</span>
<span id="cb1-228"><a href="#cb1-228" aria-hidden="true" tabindex="-1"></a>  <span class="co">// Beats</span></span>
<span id="cb1-229"><a href="#cb1-229" aria-hidden="true" tabindex="-1"></a>  svg</span>
<span id="cb1-230"><a href="#cb1-230" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">append</span>(<span class="st">'rect'</span>)</span>
<span id="cb1-231"><a href="#cb1-231" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">'class'</span><span class="op">,</span> <span class="st">'timeBar'</span>)</span>
<span id="cb1-232"><a href="#cb1-232" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">'y'</span><span class="op">,</span> firstBarY<span class="op">+</span><span class="dv">60</span>)</span>
<span id="cb1-233"><a href="#cb1-233" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">'width'</span><span class="op">,</span> d <span class="kw">=&gt;</span> <span class="fu">scaleMandB</span>(<span class="bu">Number</span>(barBeatsN)))</span>
<span id="cb1-234"><a href="#cb1-234" aria-hidden="true" tabindex="-1"></a>  svg</span>
<span id="cb1-235"><a href="#cb1-235" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">append</span>(<span class="st">'rect'</span>)</span>
<span id="cb1-236"><a href="#cb1-236" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">'class'</span><span class="op">,</span> <span class="st">'timeBarFullN'</span>)</span>
<span id="cb1-237"><a href="#cb1-237" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">'y'</span><span class="op">,</span> firstBarY<span class="op">+</span><span class="dv">60</span>)</span>
<span id="cb1-238"><a href="#cb1-238" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">'width'</span><span class="op">,</span> d <span class="kw">=&gt;</span> <span class="fu">scaleMandB</span>(barBeatsN))</span>
<span id="cb1-239"><a href="#cb1-239" aria-hidden="true" tabindex="-1"></a>  <span class="co">// Cents/Mils</span></span>
<span id="cb1-240"><a href="#cb1-240" aria-hidden="true" tabindex="-1"></a>  svg</span>
<span id="cb1-241"><a href="#cb1-241" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">append</span>(<span class="st">'rect'</span>)</span>
<span id="cb1-242"><a href="#cb1-242" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">'class'</span><span class="op">,</span> <span class="st">'timeBar'</span>)</span>
<span id="cb1-243"><a href="#cb1-243" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">'y'</span><span class="op">,</span> firstBarY)</span>
<span id="cb1-244"><a href="#cb1-244" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">'width'</span><span class="op">,</span> d <span class="kw">=&gt;</span> <span class="fu">scaleDD</span>(<span class="bu">Number</span>(barDDN)<span class="op">+</span><span class="bu">Number</span>(barMilsN)<span class="op">/</span><span class="dv">100</span><span class="op">+</span><span class="bu">Number</span>(barBeatsN)<span class="op">/</span><span class="dv">10000</span>))</span>
<span id="cb1-245"><a href="#cb1-245" aria-hidden="true" tabindex="-1"></a>  svg</span>
<span id="cb1-246"><a href="#cb1-246" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">append</span>(<span class="st">'rect'</span>)</span>
<span id="cb1-247"><a href="#cb1-247" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">'class'</span><span class="op">,</span> <span class="st">'timeBarFullN'</span>)</span>
<span id="cb1-248"><a href="#cb1-248" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">'y'</span><span class="op">,</span> firstBarY)</span>
<span id="cb1-249"><a href="#cb1-249" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">'width'</span><span class="op">,</span> d <span class="kw">=&gt;</span> <span class="fu">scaleDD</span>(barDDN))</span>
<span id="cb1-250"><a href="#cb1-250" aria-hidden="true" tabindex="-1"></a>  svg</span>
<span id="cb1-251"><a href="#cb1-251" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">append</span>(<span class="st">'rect'</span>)</span>
<span id="cb1-252"><a href="#cb1-252" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">'class'</span><span class="op">,</span> <span class="st">'timeBar'</span>)</span>
<span id="cb1-253"><a href="#cb1-253" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">'y'</span><span class="op">,</span> firstBarY<span class="op">+</span><span class="dv">30</span>)</span>
<span id="cb1-254"><a href="#cb1-254" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">'width'</span><span class="op">,</span> d <span class="kw">=&gt;</span> <span class="fu">scaleMandB</span>(<span class="bu">Number</span>(barMilsN)<span class="op">+</span><span class="bu">Number</span>(barBeatsN)<span class="op">/</span><span class="dv">100</span>))</span>
<span id="cb1-255"><a href="#cb1-255" aria-hidden="true" tabindex="-1"></a>  svg</span>
<span id="cb1-256"><a href="#cb1-256" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">append</span>(<span class="st">'rect'</span>)</span>
<span id="cb1-257"><a href="#cb1-257" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">'class'</span><span class="op">,</span> <span class="st">'timeBarFullN'</span>)</span>
<span id="cb1-258"><a href="#cb1-258" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">'y'</span><span class="op">,</span> firstBarY<span class="op">+</span><span class="dv">30</span>)</span>
<span id="cb1-259"><a href="#cb1-259" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">'width'</span><span class="op">,</span> d <span class="kw">=&gt;</span> <span class="fu">scaleMandB</span>(barMilsN))</span>
<span id="cb1-260"><a href="#cb1-260" aria-hidden="true" tabindex="-1"></a>  <span class="co">// Cent ticks</span></span>
<span id="cb1-261"><a href="#cb1-261" aria-hidden="true" tabindex="-1"></a>  svg<span class="op">.</span><span class="fu">selectAll</span>(<span class="st">'.tickC'</span>)</span>
<span id="cb1-262"><a href="#cb1-262" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">data</span>(d3<span class="op">.</span><span class="fu">range</span>(width <span class="op">&gt;</span> <span class="dv">500</span> <span class="op">?</span> <span class="dv">10</span> <span class="op">:</span> <span class="dv">10</span><span class="op">,</span> <span class="dv">100</span>))</span>
<span id="cb1-263"><a href="#cb1-263" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">enter</span>()</span>
<span id="cb1-264"><a href="#cb1-264" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">append</span>(<span class="st">'rect'</span>)</span>
<span id="cb1-265"><a href="#cb1-265" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">'class'</span><span class="op">,</span> <span class="st">'tickC'</span>)</span>
<span id="cb1-266"><a href="#cb1-266" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">'x'</span><span class="op">,</span> d<span class="kw">=&gt;</span><span class="fu">scaleDD</span>(d<span class="op">/</span><span class="dv">10</span>)<span class="op">+</span>barX)</span>
<span id="cb1-267"><a href="#cb1-267" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">'y'</span><span class="op">,</span> firstBarY<span class="op">+</span><span class="dv">30</span>)</span>
<span id="cb1-268"><a href="#cb1-268" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">'height'</span><span class="op">,</span> d<span class="kw">=&gt;</span>d<span class="op">%</span><span class="dv">2</span><span class="op">===</span><span class="dv">0</span><span class="op">?</span> <span class="dv">8</span><span class="op">:</span><span class="dv">5</span>)</span>
<span id="cb1-269"><a href="#cb1-269" aria-hidden="true" tabindex="-1"></a>  svg<span class="op">.</span><span class="fu">selectAll</span>(<span class="st">'.tickB1'</span>)</span>
<span id="cb1-270"><a href="#cb1-270" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">data</span>(d3<span class="op">.</span><span class="fu">range</span>(width <span class="op">&gt;</span> <span class="dv">500</span> <span class="op">?</span> <span class="dv">10</span> <span class="op">:</span> <span class="dv">10</span><span class="op">,</span> <span class="dv">100</span>))</span>
<span id="cb1-271"><a href="#cb1-271" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">enter</span>()</span>
<span id="cb1-272"><a href="#cb1-272" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">append</span>(<span class="st">'rect'</span>)</span>
<span id="cb1-273"><a href="#cb1-273" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">'class'</span><span class="op">,</span> <span class="st">'tickB1'</span>)</span>
<span id="cb1-274"><a href="#cb1-274" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">'x'</span><span class="op">,</span> d<span class="kw">=&gt;</span><span class="fu">scaleDD</span>(d<span class="op">/</span><span class="dv">10</span>)<span class="op">+</span>barX)</span>
<span id="cb1-275"><a href="#cb1-275" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">'y'</span><span class="op">,</span> d<span class="kw">=&gt;</span>d<span class="op">%</span><span class="dv">2</span><span class="op">===</span><span class="dv">0</span><span class="op">?</span> firstBarY<span class="op">+</span><span class="dv">77</span><span class="op">:</span>firstBarY<span class="op">+</span><span class="dv">80</span>)</span>
<span id="cb1-276"><a href="#cb1-276" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">'height'</span><span class="op">,</span> d<span class="kw">=&gt;</span>d<span class="op">%</span><span class="dv">2</span><span class="op">===</span><span class="dv">0</span><span class="op">?</span> <span class="dv">8</span><span class="op">:</span><span class="dv">5</span>)</span>
<span id="cb1-277"><a href="#cb1-277" aria-hidden="true" tabindex="-1"></a>  svg<span class="op">.</span><span class="fu">selectAll</span>(<span class="st">'.tickC1'</span>)</span>
<span id="cb1-278"><a href="#cb1-278" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">data</span>(d3<span class="op">.</span><span class="fu">range</span>(width <span class="op">&gt;</span> <span class="dv">500</span> <span class="op">?</span> <span class="dv">10</span> <span class="op">:</span> <span class="dv">10</span><span class="op">,</span> <span class="dv">100</span>))</span>
<span id="cb1-279"><a href="#cb1-279" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">enter</span>()</span>
<span id="cb1-280"><a href="#cb1-280" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">append</span>(<span class="st">'rect'</span>)</span>
<span id="cb1-281"><a href="#cb1-281" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">'class'</span><span class="op">,</span> <span class="st">'tickC1'</span>)</span>
<span id="cb1-282"><a href="#cb1-282" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">'x'</span><span class="op">,</span> d<span class="kw">=&gt;</span><span class="fu">scaleDD</span>(d<span class="op">/</span><span class="dv">10</span>)<span class="op">+</span>barX)</span>
<span id="cb1-283"><a href="#cb1-283" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">'y'</span><span class="op">,</span> d<span class="kw">=&gt;</span>d<span class="op">%</span><span class="dv">2</span><span class="op">===</span><span class="dv">0</span><span class="op">?</span> firstBarY<span class="op">+</span><span class="dv">47</span><span class="op">:</span>firstBarY<span class="op">+</span><span class="dv">50</span>)</span>
<span id="cb1-284"><a href="#cb1-284" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">'height'</span><span class="op">,</span> d<span class="kw">=&gt;</span>d<span class="op">%</span><span class="dv">2</span><span class="op">===</span><span class="dv">0</span><span class="op">?</span> <span class="dv">8</span><span class="op">:</span><span class="dv">5</span>)</span>
<span id="cb1-285"><a href="#cb1-285" aria-hidden="true" tabindex="-1"></a>  <span class="co">// Mil ticks</span></span>
<span id="cb1-286"><a href="#cb1-286" aria-hidden="true" tabindex="-1"></a>  svg<span class="op">.</span><span class="fu">selectAll</span>(<span class="st">'.tickM'</span>)</span>
<span id="cb1-287"><a href="#cb1-287" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">data</span>(d3<span class="op">.</span><span class="fu">range</span>(width <span class="op">&gt;</span> <span class="dv">500</span> <span class="op">?</span> <span class="dv">1</span> <span class="op">:</span> <span class="dv">1</span><span class="op">,</span> <span class="dv">10</span>))</span>
<span id="cb1-288"><a href="#cb1-288" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">enter</span>()</span>
<span id="cb1-289"><a href="#cb1-289" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">append</span>(<span class="st">'rect'</span>)</span>
<span id="cb1-290"><a href="#cb1-290" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">'class'</span><span class="op">,</span> <span class="st">'tickM'</span>)</span>
<span id="cb1-291"><a href="#cb1-291" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">'x'</span><span class="op">,</span> d<span class="kw">=&gt;</span><span class="fu">scaleDD</span>(d)<span class="op">+</span>barX)</span>
<span id="cb1-292"><a href="#cb1-292" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">'y'</span><span class="op">,</span> firstBarY<span class="op">+</span><span class="dv">20</span>)</span>
<span id="cb1-293"><a href="#cb1-293" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">'height'</span><span class="op">,</span> <span class="dv">6</span>)</span>
<span id="cb1-294"><a href="#cb1-294" aria-hidden="true" tabindex="-1"></a>  svg<span class="op">.</span><span class="fu">selectAll</span>(<span class="st">'.tickLabel1'</span>)</span>
<span id="cb1-295"><a href="#cb1-295" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">data</span>(d3<span class="op">.</span><span class="fu">range</span>(width <span class="op">&gt;</span> <span class="dv">500</span> <span class="op">?</span> <span class="dv">1</span> <span class="op">:</span> <span class="dv">1</span><span class="op">,</span> <span class="dv">10</span>))</span>
<span id="cb1-296"><a href="#cb1-296" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">enter</span>()</span>
<span id="cb1-297"><a href="#cb1-297" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">append</span>(<span class="st">'text'</span>)</span>
<span id="cb1-298"><a href="#cb1-298" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">'class'</span><span class="op">,</span> <span class="st">'tickLabel1'</span>)</span>
<span id="cb1-299"><a href="#cb1-299" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">'x'</span><span class="op">,</span> d<span class="kw">=&gt;</span><span class="fu">scaleDD</span>(d)<span class="op">+</span>barX<span class="op">+.</span><span class="dv">5</span>)</span>
<span id="cb1-300"><a href="#cb1-300" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">'y'</span><span class="op">,</span> firstBarY<span class="op">+</span><span class="dv">18</span>)</span>
<span id="cb1-301"><a href="#cb1-301" aria-hidden="true" tabindex="-1"></a>    <span class="co">//.style("font-size", `{W &lt; 350 ? 12 : W &lt; 450 ? 14 : W &lt; 550 ? 16 : W &lt; 650 ? 18 : 20}px`)</span></span>
<span id="cb1-302"><a href="#cb1-302" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">text</span>(d<span class="kw">=&gt;</span>d)</span>
<span id="cb1-303"><a href="#cb1-303" aria-hidden="true" tabindex="-1"></a>  <span class="co">// Cent ticks</span></span>
<span id="cb1-304"><a href="#cb1-304" aria-hidden="true" tabindex="-1"></a>  svg<span class="op">.</span><span class="fu">selectAll</span>(<span class="st">'.tickC2'</span>)</span>
<span id="cb1-305"><a href="#cb1-305" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">data</span>(d3<span class="op">.</span><span class="fu">range</span>(width <span class="op">&gt;</span> <span class="dv">500</span> <span class="op">?</span> <span class="dv">10</span> <span class="op">:</span> <span class="dv">10</span><span class="op">,</span> <span class="dv">100</span>))</span>
<span id="cb1-306"><a href="#cb1-306" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">enter</span>()</span>
<span id="cb1-307"><a href="#cb1-307" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">append</span>(<span class="st">'rect'</span>)</span>
<span id="cb1-308"><a href="#cb1-308" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">'class'</span><span class="op">,</span> <span class="st">'tickC2'</span>)</span>
<span id="cb1-309"><a href="#cb1-309" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">'x'</span><span class="op">,</span> d<span class="kw">=&gt;</span><span class="fu">scaleDD</span>(d<span class="op">/</span><span class="dv">10</span>)<span class="op">+</span>barX)</span>
<span id="cb1-310"><a href="#cb1-310" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">'y'</span><span class="op">,</span> firstBarY<span class="op">+</span><span class="dv">10</span>)</span>
<span id="cb1-311"><a href="#cb1-311" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">'height'</span><span class="op">,</span> d<span class="kw">=&gt;</span>d<span class="op">%</span><span class="dv">2</span><span class="op">===</span><span class="dv">0</span><span class="op">?</span> <span class="dv">9</span><span class="op">:</span><span class="dv">6</span>)</span>
<span id="cb1-312"><a href="#cb1-312" aria-hidden="true" tabindex="-1"></a>  <span class="co">// Beat ticks</span></span>
<span id="cb1-313"><a href="#cb1-313" aria-hidden="true" tabindex="-1"></a>  svg<span class="op">.</span><span class="fu">selectAll</span>(<span class="st">'.tickB'</span>)</span>
<span id="cb1-314"><a href="#cb1-314" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">data</span>(d3<span class="op">.</span><span class="fu">range</span>(width <span class="op">&gt;</span> <span class="dv">500</span> <span class="op">?</span> <span class="dv">10</span> <span class="op">:</span> <span class="dv">10</span><span class="op">,</span> <span class="dv">100</span>))</span>
<span id="cb1-315"><a href="#cb1-315" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">enter</span>()</span>
<span id="cb1-316"><a href="#cb1-316" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">append</span>(<span class="st">'rect'</span>)</span>
<span id="cb1-317"><a href="#cb1-317" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">'class'</span><span class="op">,</span> <span class="st">'tickB'</span>)</span>
<span id="cb1-318"><a href="#cb1-318" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">'x'</span><span class="op">,</span> d<span class="kw">=&gt;</span><span class="fu">scaleDD</span>(d<span class="op">/</span><span class="dv">10</span>)<span class="op">+</span>barX)</span>
<span id="cb1-319"><a href="#cb1-319" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">'y'</span><span class="op">,</span> firstBarY<span class="op">+</span><span class="dv">60</span>)</span>
<span id="cb1-320"><a href="#cb1-320" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">'height'</span><span class="op">,</span> d<span class="kw">=&gt;</span>d<span class="op">%</span><span class="dv">2</span><span class="op">===</span><span class="dv">0</span><span class="op">?</span> <span class="dv">9</span><span class="op">:</span><span class="dv">6</span>)</span>
<span id="cb1-321"><a href="#cb1-321" aria-hidden="true" tabindex="-1"></a>  <span class="co">// Labels</span></span>
<span id="cb1-322"><a href="#cb1-322" aria-hidden="true" tabindex="-1"></a>  svg<span class="op">.</span><span class="fu">selectAll</span>(<span class="st">'.timeLabel'</span>)</span>
<span id="cb1-323"><a href="#cb1-323" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">data</span>([<span class="vs">`-</span><span class="sc">${</span>barDDN<span class="sc">}</span><span class="vs">`</span><span class="op">,</span> <span class="vs">`</span><span class="sc">${</span>barMilsN<span class="sc">}</span><span class="vs">`</span><span class="op">,</span> <span class="vs">`</span><span class="sc">${</span>barBeatsN<span class="sc">}</span><span class="vs">`</span>])</span>
<span id="cb1-324"><a href="#cb1-324" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">enter</span>()</span>
<span id="cb1-325"><a href="#cb1-325" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">append</span>(<span class="st">'text'</span>)</span>
<span id="cb1-326"><a href="#cb1-326" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">'class'</span><span class="op">,</span> <span class="st">'timeLabel'</span>)</span>
<span id="cb1-327"><a href="#cb1-327" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">'x'</span><span class="op">,</span> barX<span class="op">+</span><span class="dv">2</span>)</span>
<span id="cb1-328"><a href="#cb1-328" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">'y'</span><span class="op">,</span> (d<span class="op">,</span>i)<span class="kw">=&gt;</span>i<span class="op">*</span><span class="dv">30</span><span class="op">+</span>firstBarY<span class="op">+</span><span class="dv">20</span>)</span>
<span id="cb1-329"><a href="#cb1-329" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">style</span>(<span class="st">"font-size"</span><span class="op">,</span> <span class="vs">`</span><span class="sc">${</span>W <span class="op">&lt;</span> <span class="dv">300</span> <span class="op">?</span> <span class="dv">14</span> <span class="op">:</span> W <span class="op">&lt;</span> <span class="dv">400</span> <span class="op">?</span> <span class="dv">16</span> <span class="op">:</span> W <span class="op">&lt;</span> <span class="dv">500</span> <span class="op">?</span> <span class="dv">18</span> <span class="op">:</span> W <span class="op">&lt;</span> <span class="dv">600</span> <span class="op">?</span> <span class="dv">20</span> <span class="op">:</span> <span class="dv">22</span><span class="sc">}</span><span class="vs">px`</span>)</span>
<span id="cb1-330"><a href="#cb1-330" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">text</span>(d<span class="kw">=&gt;</span>d)<span class="op">;</span></span>
<span id="cb1-331"><a href="#cb1-331" aria-hidden="true" tabindex="-1"></a>  svg<span class="op">.</span><span class="fu">attr</span>(<span class="st">"id"</span><span class="op">,</span> <span class="st">"barClock"</span>)<span class="op">;</span></span>
<span id="cb1-332"><a href="#cb1-332" aria-hidden="true" tabindex="-1"></a>  <span class="cf">return</span> svg<span class="op">.</span><span class="fu">node</span>()<span class="op">;</span></span>
<span id="cb1-333"><a href="#cb1-333" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb1-334"><a href="#cb1-334" aria-hidden="true" tabindex="-1"></a>viewof location <span class="op">=</span> <span class="fu">worldMapCoordinates</span>([<span class="dv">162</span><span class="op">,</span> <span class="dv">0</span>]<span class="op">,</span> [width <span class="op">*</span> <span class="op">.</span><span class="dv">998</span><span class="op">,</span> <span class="bu">Math</span><span class="op">.</span><span class="fu">round</span>((<span class="dv">21</span> <span class="op">/</span> <span class="dv">40</span>) <span class="op">*</span> width)])</span>
<span id="cb1-335"><a href="#cb1-335" aria-hidden="true" tabindex="-1"></a><span class="co">// https://observablehq.com/@dbridges/visualizing-seasonal-daylight</span></span>
<span id="cb1-336"><a href="#cb1-336" aria-hidden="true" tabindex="-1"></a>app <span class="op">=</span> {</span>
<span id="cb1-337"><a href="#cb1-337" aria-hidden="true" tabindex="-1"></a><span class="kw">const</span> svg <span class="op">=</span> d3<span class="op">.</span><span class="fu">select</span>(DOM<span class="op">.</span><span class="fu">svg</span>(width<span class="op">,</span> height <span class="op">-</span> (width <span class="op">&lt;</span> <span class="dv">400</span> <span class="op">?</span> <span class="dv">10</span> <span class="op">:</span> width <span class="op">&lt;</span> <span class="dv">600</span> <span class="op">?</span> <span class="dv">15</span> <span class="op">:</span> width <span class="op">&lt;</span> <span class="dv">700</span> <span class="op">?</span> <span class="dv">30</span> <span class="op">:</span> <span class="dv">40</span>)))<span class="op">;</span></span>
<span id="cb1-338"><a href="#cb1-338" aria-hidden="true" tabindex="-1"></a>  svg<span class="op">.</span><span class="fu">style</span>(<span class="st">"user-select"</span><span class="op">,</span> <span class="st">"none"</span>)</span>
<span id="cb1-339"><a href="#cb1-339" aria-hidden="true" tabindex="-1"></a>     <span class="op">.</span><span class="fu">style</span>(<span class="st">"-webkit-user-select"</span><span class="op">,</span> <span class="st">"none"</span>)<span class="op">;</span></span>
<span id="cb1-340"><a href="#cb1-340" aria-hidden="true" tabindex="-1"></a>  svg<span class="op">.</span><span class="fu">attr</span>(<span class="st">"id"</span><span class="op">,</span> <span class="st">"daylightapp"</span>)</span>
<span id="cb1-341"><a href="#cb1-341" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> margin <span class="op">=</span> {<span class="dt">top</span><span class="op">:</span> <span class="dv">0</span><span class="op">,</span> <span class="dt">left</span><span class="op">:</span> <span class="dv">10</span><span class="op">,</span> <span class="dt">right</span><span class="op">:</span> <span class="dv">10</span><span class="op">,</span> <span class="dt">bottom</span><span class="op">:</span> <span class="dv">0</span><span class="op">,</span> <span class="dt">inner</span><span class="op">:</span> <span class="dv">3</span>}<span class="op">;</span></span>
<span id="cb1-342"><a href="#cb1-342" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> contentWidth <span class="op">=</span> width <span class="op">-</span> margin<span class="op">.</span><span class="at">left</span> <span class="op">-</span> margin<span class="op">.</span><span class="at">right</span> <span class="op">-</span> margin<span class="op">.</span><span class="at">inner</span><span class="op">;</span></span>
<span id="cb1-343"><a href="#cb1-343" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> columnWidth <span class="op">=</span> contentWidth <span class="op">/</span> <span class="dv">2</span><span class="op">;</span></span>
<span id="cb1-344"><a href="#cb1-344" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> date2022 <span class="op">=</span> <span class="kw">new</span> <span class="bu">Date</span>(<span class="dv">2022</span><span class="op">,</span> <span class="kw">new</span> <span class="bu">Date</span>()<span class="op">.</span><span class="fu">getMonth</span>()<span class="op">,</span> <span class="kw">new</span> <span class="bu">Date</span>()<span class="op">.</span><span class="fu">getDate</span>()<span class="op">,</span> <span class="kw">new</span> <span class="bu">Date</span>()<span class="op">.</span><span class="fu">getHours</span>())</span>
<span id="cb1-345"><a href="#cb1-345" aria-hidden="true" tabindex="-1"></a>  <span class="kw">let</span> selection <span class="op">=</span> {</span>
<span id="cb1-346"><a href="#cb1-346" aria-hidden="true" tabindex="-1"></a>    <span class="dt">date</span><span class="op">:</span> date2022<span class="op">,</span></span>
<span id="cb1-347"><a href="#cb1-347" aria-hidden="true" tabindex="-1"></a>    <span class="dt">hour</span><span class="op">:</span> date2022<span class="op">.</span><span class="fu">getHours</span>()</span>
<span id="cb1-348"><a href="#cb1-348" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb1-349"><a href="#cb1-349" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> renderPlot <span class="op">=</span> () <span class="kw">=&gt;</span> {</span>
<span id="cb1-350"><a href="#cb1-350" aria-hidden="true" tabindex="-1"></a>    svg<span class="op">.</span><span class="fu">selectAll</span>(<span class="st">"#daylightplot *"</span>)<span class="op">.</span><span class="fu">remove</span>()<span class="op">;</span></span>
<span id="cb1-351"><a href="#cb1-351" aria-hidden="true" tabindex="-1"></a>    svg<span class="op">.</span><span class="fu">select</span>(<span class="st">"#daylightplot"</span>)<span class="op">.</span><span class="fu">call</span>(daylightPlot<span class="op">,</span> {</span>
<span id="cb1-352"><a href="#cb1-352" aria-hidden="true" tabindex="-1"></a>      <span class="dt">width</span><span class="op">:</span> columnWidth <span class="op">/</span> <span class="fl">1.26</span><span class="op">,</span></span>
<span id="cb1-353"><a href="#cb1-353" aria-hidden="true" tabindex="-1"></a>      <span class="dt">height</span><span class="op">:</span> height <span class="op">/</span> <span class="fl">1.51</span> <span class="op">-</span> margin<span class="op">.</span><span class="at">top</span> <span class="op">-</span> margin<span class="op">.</span><span class="at">bottom</span><span class="op">,</span></span>
<span id="cb1-354"><a href="#cb1-354" aria-hidden="true" tabindex="-1"></a>      <span class="dt">year</span><span class="op">:</span> date2022<span class="op">.</span><span class="fu">getFullYear</span>()<span class="op">,</span></span>
<span id="cb1-355"><a href="#cb1-355" aria-hidden="true" tabindex="-1"></a>      <span class="dt">latitude</span><span class="op">:</span> location[<span class="dv">1</span>]<span class="op">,</span></span>
<span id="cb1-356"><a href="#cb1-356" aria-hidden="true" tabindex="-1"></a>      <span class="dt">defaultDate</span><span class="op">:</span> selection<span class="op">.</span><span class="at">date</span><span class="op">,</span></span>
<span id="cb1-357"><a href="#cb1-357" aria-hidden="true" tabindex="-1"></a>      <span class="dt">defaultHour</span><span class="op">:</span> selection<span class="op">.</span><span class="at">hour</span></span>
<span id="cb1-358"><a href="#cb1-358" aria-hidden="true" tabindex="-1"></a>    })</span>
<span id="cb1-359"><a href="#cb1-359" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb1-360"><a href="#cb1-360" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> renderGlobe <span class="op">=</span> () <span class="kw">=&gt;</span> {</span>
<span id="cb1-361"><a href="#cb1-361" aria-hidden="true" tabindex="-1"></a>    svg<span class="op">.</span><span class="fu">selectAll</span>(<span class="st">"#globe *"</span>)<span class="op">.</span><span class="fu">remove</span>()<span class="op">;</span></span>
<span id="cb1-362"><a href="#cb1-362" aria-hidden="true" tabindex="-1"></a>    svg<span class="op">.</span><span class="fu">selectAll</span>(<span class="st">"#globe"</span>)<span class="op">.</span><span class="fu">call</span>(globe<span class="op">,</span> { <span class="dt">width</span><span class="op">:</span> columnWidth <span class="op">*</span> <span class="fl">1.2</span><span class="op">,</span> location<span class="op">,</span> <span class="op">...</span>selection })<span class="op">;</span></span>
<span id="cb1-363"><a href="#cb1-363" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb1-364"><a href="#cb1-364" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> renderSolarSystem <span class="op">=</span> () <span class="kw">=&gt;</span> {</span>
<span id="cb1-365"><a href="#cb1-365" aria-hidden="true" tabindex="-1"></a>    svg<span class="op">.</span><span class="fu">selectAll</span>(<span class="st">"#solar-system *"</span>)<span class="op">.</span><span class="fu">remove</span>()<span class="op">;</span></span>
<span id="cb1-366"><a href="#cb1-366" aria-hidden="true" tabindex="-1"></a>    svg<span class="op">.</span><span class="fu">selectAll</span>(<span class="st">"#solar-system"</span>)<span class="op">.</span><span class="fu">call</span>(solarSystem<span class="op">,</span></span>
<span id="cb1-367"><a href="#cb1-367" aria-hidden="true" tabindex="-1"></a>                                        columnWidth <span class="op">/</span> <span class="fl">1.1</span><span class="op">,</span></span>
<span id="cb1-368"><a href="#cb1-368" aria-hidden="true" tabindex="-1"></a>                                        location<span class="op">,</span></span>
<span id="cb1-369"><a href="#cb1-369" aria-hidden="true" tabindex="-1"></a>                                        selection<span class="op">.</span><span class="at">date</span><span class="op">,</span></span>
<span id="cb1-370"><a href="#cb1-370" aria-hidden="true" tabindex="-1"></a>                                        selection<span class="op">.</span><span class="at">hour</span>)<span class="op">;</span></span>
<span id="cb1-371"><a href="#cb1-371" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb1-372"><a href="#cb1-372" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> setSelection <span class="op">=</span> (newSelection<span class="op">,</span> forceRender <span class="op">=</span> <span class="kw">false</span>) <span class="kw">=&gt;</span> {</span>
<span id="cb1-373"><a href="#cb1-373" aria-hidden="true" tabindex="-1"></a>    <span class="kw">const</span> prev <span class="op">=</span> {<span class="op">...</span>selection}<span class="op">;</span></span>
<span id="cb1-374"><a href="#cb1-374" aria-hidden="true" tabindex="-1"></a>    selection <span class="op">=</span> newSelection<span class="op">;</span></span>
<span id="cb1-375"><a href="#cb1-375" aria-hidden="true" tabindex="-1"></a>    svg<span class="op">.</span><span class="fu">node</span>()<span class="op">.</span><span class="at">value</span> <span class="op">=</span> selection<span class="op">;</span></span>
<span id="cb1-376"><a href="#cb1-376" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> (forceRender) {</span>
<span id="cb1-377"><a href="#cb1-377" aria-hidden="true" tabindex="-1"></a>      <span class="fu">renderPlot</span>()<span class="op">;</span></span>
<span id="cb1-378"><a href="#cb1-378" aria-hidden="true" tabindex="-1"></a>      <span class="fu">renderSolarSystem</span>()<span class="op">;</span></span>
<span id="cb1-379"><a href="#cb1-379" aria-hidden="true" tabindex="-1"></a>      <span class="fu">renderGlobe</span>()<span class="op">;</span></span>
<span id="cb1-380"><a href="#cb1-380" aria-hidden="true" tabindex="-1"></a>    } <span class="cf">else</span> <span class="cf">if</span> (prev<span class="op">.</span><span class="at">hour</span> <span class="op">!==</span> selection<span class="op">.</span><span class="at">hour</span> <span class="op">||</span> prev<span class="op">.</span><span class="at">date</span> <span class="op">!==</span> selection<span class="op">.</span><span class="at">date</span>) {</span>
<span id="cb1-381"><a href="#cb1-381" aria-hidden="true" tabindex="-1"></a>      <span class="fu">renderSolarSystem</span>()<span class="op">;</span></span>
<span id="cb1-382"><a href="#cb1-382" aria-hidden="true" tabindex="-1"></a>      <span class="fu">renderGlobe</span>()<span class="op">;</span></span>
<span id="cb1-383"><a href="#cb1-383" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb1-384"><a href="#cb1-384" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb1-385"><a href="#cb1-385" aria-hidden="true" tabindex="-1"></a>  svg<span class="op">.</span><span class="fu">append</span>(<span class="st">"g"</span>)</span>
<span id="cb1-386"><a href="#cb1-386" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">"id"</span><span class="op">,</span> <span class="st">"solar-system"</span>)</span>
<span id="cb1-387"><a href="#cb1-387" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">"transform"</span><span class="op">,</span> <span class="vs">`translate(</span><span class="sc">${</span>margin<span class="op">.</span><span class="at">left</span> <span class="op">+</span> <span class="dv">2</span><span class="sc">}</span><span class="vs">, </span><span class="sc">${</span>margin<span class="op">.</span><span class="at">top</span> <span class="op">+</span> height <span class="op">/</span> <span class="fl">7.5</span><span class="sc">}</span><span class="vs">)`</span>)<span class="op">;</span></span>
<span id="cb1-388"><a href="#cb1-388" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> plot <span class="op">=</span> svg<span class="op">.</span><span class="fu">append</span>(<span class="st">"g"</span>)</span>
<span id="cb1-389"><a href="#cb1-389" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">"id"</span><span class="op">,</span> <span class="st">"daylightplot"</span>)</span>
<span id="cb1-390"><a href="#cb1-390" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">"transform"</span><span class="op">,</span> <span class="vs">`translate(</span><span class="sc">${</span>margin<span class="op">.</span><span class="at">left</span><span class="sc">}</span><span class="vs">, </span><span class="sc">${</span>margin<span class="op">.</span><span class="at">top</span> <span class="op">+</span> height <span class="op">/</span> <span class="dv">4</span><span class="sc">}</span><span class="vs">)`</span>)<span class="op">;</span></span>
<span id="cb1-391"><a href="#cb1-391" aria-hidden="true" tabindex="-1"></a>  svg<span class="op">.</span><span class="fu">append</span>(<span class="st">"g"</span>)</span>
<span id="cb1-392"><a href="#cb1-392" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">"id"</span><span class="op">,</span> <span class="st">"globe"</span>)</span>
<span id="cb1-393"><a href="#cb1-393" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">"transform"</span><span class="op">,</span> <span class="vs">`translate(</span><span class="sc">${</span>margin<span class="op">.</span><span class="at">left</span> <span class="op">+</span> margin<span class="op">.</span><span class="at">inner</span> <span class="op">+</span> columnWidth <span class="op">/</span> <span class="fl">1.25</span><span class="sc">}</span><span class="vs">, </span><span class="sc">${</span>margin<span class="op">.</span><span class="at">top</span> <span class="op">+</span> <span class="bu">Number</span>(columnWidth <span class="op">&lt;</span> <span class="dv">300</span>) <span class="op">*</span> <span class="dv">12</span><span class="sc">}</span><span class="vs">)`</span>)<span class="op">;</span></span>
<span id="cb1-394"><a href="#cb1-394" aria-hidden="true" tabindex="-1"></a>  <span class="fu">setSelection</span>(selection<span class="op">,</span> <span class="kw">true</span>)<span class="op">;</span></span>
<span id="cb1-395"><a href="#cb1-395" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> handleDateHourChange <span class="op">=</span> ({ target<span class="op">,</span> <span class="dt">detail</span><span class="op">:</span> { date<span class="op">,</span> hour }}) <span class="kw">=&gt;</span> {</span>
<span id="cb1-396"><a href="#cb1-396" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> (date <span class="op">!=</span> <span class="kw">null</span> <span class="op">&amp;&amp;</span> hour <span class="op">!=</span> <span class="kw">null</span>) <span class="fu">setSelection</span>({<span class="op">...</span>selection<span class="op">,</span> date<span class="op">,</span> hour})<span class="op">;</span></span>
<span id="cb1-397"><a href="#cb1-397" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb1-398"><a href="#cb1-398" aria-hidden="true" tabindex="-1"></a>  svg<span class="op">.</span><span class="fu">node</span>()<span class="op">.</span><span class="fu">addEventListener</span>(EventType<span class="op">.</span><span class="at">DateHourChange</span><span class="op">,</span> handleDateHourChange<span class="op">,</span> <span class="kw">false</span>)<span class="op">;</span></span>
<span id="cb1-399"><a href="#cb1-399" aria-hidden="true" tabindex="-1"></a>  <span class="cf">return</span> svg<span class="op">.</span><span class="fu">node</span>()<span class="op">;</span></span>
<span id="cb1-400"><a href="#cb1-400" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb1-401"><a href="#cb1-401" aria-hidden="true" tabindex="-1"></a><span class="co">// https://observablehq.com/@d3/simple-clock</span></span>
<span id="cb1-402"><a href="#cb1-402" aria-hidden="true" tabindex="-1"></a><span class="co">// https://observablehq.com/@drio/lets-build-an-analog-clock</span></span>
<span id="cb1-403"><a href="#cb1-403" aria-hidden="true" tabindex="-1"></a>clock <span class="op">=</span> {</span>
<span id="cb1-404"><a href="#cb1-404" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> clockRadius <span class="op">=</span> <span class="dv">200</span><span class="op">,</span></span>
<span id="cb1-405"><a href="#cb1-405" aria-hidden="true" tabindex="-1"></a>    margin <span class="op">=</span> <span class="dv">50</span><span class="op">,</span></span>
<span id="cb1-406"><a href="#cb1-406" aria-hidden="true" tabindex="-1"></a>    w <span class="op">=</span> (clockRadius <span class="op">+</span> margin) <span class="op">*</span> <span class="dv">2</span><span class="op">,</span></span>
<span id="cb1-407"><a href="#cb1-407" aria-hidden="true" tabindex="-1"></a>    h <span class="op">=</span> (clockRadius <span class="op">+</span> margin) <span class="op">*</span> <span class="dv">2</span><span class="op">,</span></span>
<span id="cb1-408"><a href="#cb1-408" aria-hidden="true" tabindex="-1"></a>    hourHandLength <span class="op">=</span> (<span class="dv">2</span> <span class="op">*</span> clockRadius) <span class="op">/</span> <span class="dv">3</span><span class="op">,</span></span>
<span id="cb1-409"><a href="#cb1-409" aria-hidden="true" tabindex="-1"></a>    minuteHandLength <span class="op">=</span> clockRadius<span class="op">,</span></span>
<span id="cb1-410"><a href="#cb1-410" aria-hidden="true" tabindex="-1"></a>    secondHandLength <span class="op">=</span> clockRadius <span class="op">-</span> <span class="dv">12</span><span class="op">,</span></span>
<span id="cb1-411"><a href="#cb1-411" aria-hidden="true" tabindex="-1"></a>    secondHandBalance <span class="op">=</span> <span class="dv">30</span><span class="op">,</span></span>
<span id="cb1-412"><a href="#cb1-412" aria-hidden="true" tabindex="-1"></a>    secondTickStart <span class="op">=</span> clockRadius<span class="op">,</span></span>
<span id="cb1-413"><a href="#cb1-413" aria-hidden="true" tabindex="-1"></a>    secondTickLength <span class="op">=</span> <span class="op">-</span><span class="dv">10</span><span class="op">,</span></span>
<span id="cb1-414"><a href="#cb1-414" aria-hidden="true" tabindex="-1"></a>    hourTickStart <span class="op">=</span> clockRadius<span class="op">,</span></span>
<span id="cb1-415"><a href="#cb1-415" aria-hidden="true" tabindex="-1"></a>    hourTickLength <span class="op">=</span> <span class="op">-</span><span class="dv">18</span><span class="op">,</span></span>
<span id="cb1-416"><a href="#cb1-416" aria-hidden="true" tabindex="-1"></a>    secondLabelRadius <span class="op">=</span> clockRadius <span class="op">+</span> <span class="dv">16</span><span class="op">,</span></span>
<span id="cb1-417"><a href="#cb1-417" aria-hidden="true" tabindex="-1"></a>    secondLabelYOffset <span class="op">=</span> <span class="dv">5</span><span class="op">,</span></span>
<span id="cb1-418"><a href="#cb1-418" aria-hidden="true" tabindex="-1"></a>    hourLabelRadius <span class="op">=</span> clockRadius <span class="op">-</span> <span class="dv">40</span><span class="op">,</span></span>
<span id="cb1-419"><a href="#cb1-419" aria-hidden="true" tabindex="-1"></a>    hourLabelYOffset <span class="op">=</span> <span class="dv">7</span><span class="op">,</span></span>
<span id="cb1-420"><a href="#cb1-420" aria-hidden="true" tabindex="-1"></a>    radians <span class="op">=</span> <span class="bu">Math</span><span class="op">.</span><span class="cn">PI</span> <span class="op">/</span> <span class="dv">180</span><span class="op">;</span></span>
<span id="cb1-421"><a href="#cb1-421" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> ten <span class="op">=</span> d3</span>
<span id="cb1-422"><a href="#cb1-422" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">scaleLinear</span>()</span>
<span id="cb1-423"><a href="#cb1-423" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">range</span>([<span class="dv">0</span><span class="op">,</span> <span class="dv">360</span>])</span>
<span id="cb1-424"><a href="#cb1-424" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">domain</span>([<span class="dv">0</span><span class="op">,</span> <span class="dv">10</span>])<span class="op">;</span></span>
<span id="cb1-425"><a href="#cb1-425" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> sto <span class="op">=</span> d3</span>
<span id="cb1-426"><a href="#cb1-426" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">scaleLinear</span>()</span>
<span id="cb1-427"><a href="#cb1-427" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">range</span>([<span class="dv">0</span><span class="op">,</span> <span class="dv">360</span>])</span>
<span id="cb1-428"><a href="#cb1-428" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">domain</span>([<span class="dv">0</span><span class="op">,</span> <span class="dv">100</span>])<span class="op">;</span></span>
<span id="cb1-429"><a href="#cb1-429" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> handData <span class="op">=</span> [</span>
<span id="cb1-430"><a href="#cb1-430" aria-hidden="true" tabindex="-1"></a>    {</span>
<span id="cb1-431"><a href="#cb1-431" aria-hidden="true" tabindex="-1"></a>      <span class="dt">type</span><span class="op">:</span> <span class="st">"hour"</span><span class="op">,</span></span>
<span id="cb1-432"><a href="#cb1-432" aria-hidden="true" tabindex="-1"></a>      <span class="dt">value</span><span class="op">:</span> <span class="dv">0</span><span class="op">,</span></span>
<span id="cb1-433"><a href="#cb1-433" aria-hidden="true" tabindex="-1"></a>      <span class="dt">length</span><span class="op">:</span> <span class="op">-</span>hourHandLength<span class="op">,</span></span>
<span id="cb1-434"><a href="#cb1-434" aria-hidden="true" tabindex="-1"></a>      <span class="dt">scale</span><span class="op">:</span> ten</span>
<span id="cb1-435"><a href="#cb1-435" aria-hidden="true" tabindex="-1"></a>    }<span class="op">,</span></span>
<span id="cb1-436"><a href="#cb1-436" aria-hidden="true" tabindex="-1"></a>    {</span>
<span id="cb1-437"><a href="#cb1-437" aria-hidden="true" tabindex="-1"></a>      <span class="dt">type</span><span class="op">:</span> <span class="st">"minute"</span><span class="op">,</span></span>
<span id="cb1-438"><a href="#cb1-438" aria-hidden="true" tabindex="-1"></a>      <span class="dt">value</span><span class="op">:</span> <span class="dv">0</span><span class="op">,</span></span>
<span id="cb1-439"><a href="#cb1-439" aria-hidden="true" tabindex="-1"></a>      <span class="dt">length</span><span class="op">:</span> <span class="op">-</span>minuteHandLength<span class="op">,</span></span>
<span id="cb1-440"><a href="#cb1-440" aria-hidden="true" tabindex="-1"></a>      <span class="dt">scale</span><span class="op">:</span> sto</span>
<span id="cb1-441"><a href="#cb1-441" aria-hidden="true" tabindex="-1"></a>    }<span class="op">,</span></span>
<span id="cb1-442"><a href="#cb1-442" aria-hidden="true" tabindex="-1"></a>    {</span>
<span id="cb1-443"><a href="#cb1-443" aria-hidden="true" tabindex="-1"></a>      <span class="dt">type</span><span class="op">:</span> <span class="st">"second"</span><span class="op">,</span></span>
<span id="cb1-444"><a href="#cb1-444" aria-hidden="true" tabindex="-1"></a>      <span class="dt">value</span><span class="op">:</span> <span class="dv">0</span><span class="op">,</span></span>
<span id="cb1-445"><a href="#cb1-445" aria-hidden="true" tabindex="-1"></a>      <span class="dt">length</span><span class="op">:</span> <span class="op">-</span>secondHandLength<span class="op">,</span></span>
<span id="cb1-446"><a href="#cb1-446" aria-hidden="true" tabindex="-1"></a>      <span class="dt">scale</span><span class="op">:</span> sto<span class="op">,</span></span>
<span id="cb1-447"><a href="#cb1-447" aria-hidden="true" tabindex="-1"></a>      <span class="dt">balance</span><span class="op">:</span> secondHandBalance</span>
<span id="cb1-448"><a href="#cb1-448" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb1-449"><a href="#cb1-449" aria-hidden="true" tabindex="-1"></a>  ]<span class="op">;</span></span>
<span id="cb1-450"><a href="#cb1-450" aria-hidden="true" tabindex="-1"></a>  <span class="kw">function</span> <span class="fu">drawClock</span>() {</span>
<span id="cb1-451"><a href="#cb1-451" aria-hidden="true" tabindex="-1"></a>    <span class="co">// create all the clock elements</span></span>
<span id="cb1-452"><a href="#cb1-452" aria-hidden="true" tabindex="-1"></a>    <span class="fu">updateData</span>()<span class="op">;</span> <span class="co">//draw them in the correct starting position</span></span>
<span id="cb1-453"><a href="#cb1-453" aria-hidden="true" tabindex="-1"></a>    <span class="kw">const</span> face <span class="op">=</span> svg</span>
<span id="cb1-454"><a href="#cb1-454" aria-hidden="true" tabindex="-1"></a>      <span class="op">.</span><span class="fu">append</span>(<span class="st">"g"</span>)</span>
<span id="cb1-455"><a href="#cb1-455" aria-hidden="true" tabindex="-1"></a>      <span class="op">.</span><span class="fu">attr</span>(<span class="st">"id"</span><span class="op">,</span> <span class="st">"clock-face"</span>)</span>
<span id="cb1-456"><a href="#cb1-456" aria-hidden="true" tabindex="-1"></a>      <span class="op">.</span><span class="fu">attr</span>(<span class="st">"transform"</span><span class="op">,</span> <span class="vs">`translate(</span><span class="sc">${</span>[w <span class="op">/</span> <span class="dv">2</span><span class="op">,</span> h <span class="op">/</span> <span class="dv">2</span>]<span class="sc">}</span><span class="vs">)`</span>)<span class="op">;</span></span>
<span id="cb1-457"><a href="#cb1-457" aria-hidden="true" tabindex="-1"></a>    <span class="co">// add marks for seconds</span></span>
<span id="cb1-458"><a href="#cb1-458" aria-hidden="true" tabindex="-1"></a>    face</span>
<span id="cb1-459"><a href="#cb1-459" aria-hidden="true" tabindex="-1"></a>      <span class="op">.</span><span class="fu">selectAll</span>(<span class="st">".second-tick"</span>)</span>
<span id="cb1-460"><a href="#cb1-460" aria-hidden="true" tabindex="-1"></a>      <span class="op">.</span><span class="fu">data</span>(d3<span class="op">.</span><span class="fu">range</span>(<span class="dv">0</span><span class="op">,</span> <span class="dv">100</span>))</span>
<span id="cb1-461"><a href="#cb1-461" aria-hidden="true" tabindex="-1"></a>      <span class="op">.</span><span class="fu">enter</span>()</span>
<span id="cb1-462"><a href="#cb1-462" aria-hidden="true" tabindex="-1"></a>      <span class="op">.</span><span class="fu">append</span>(<span class="st">"line"</span>)</span>
<span id="cb1-463"><a href="#cb1-463" aria-hidden="true" tabindex="-1"></a>      <span class="op">.</span><span class="fu">attr</span>(<span class="st">"class"</span><span class="op">,</span> <span class="st">"second-tick"</span>)</span>
<span id="cb1-464"><a href="#cb1-464" aria-hidden="true" tabindex="-1"></a>      <span class="op">.</span><span class="fu">attr</span>(<span class="st">"x1"</span><span class="op">,</span> <span class="dv">0</span>)</span>
<span id="cb1-465"><a href="#cb1-465" aria-hidden="true" tabindex="-1"></a>      <span class="op">.</span><span class="fu">attr</span>(<span class="st">"x2"</span><span class="op">,</span> <span class="dv">0</span>)</span>
<span id="cb1-466"><a href="#cb1-466" aria-hidden="true" tabindex="-1"></a>      <span class="op">.</span><span class="fu">attr</span>(<span class="st">"y1"</span><span class="op">,</span> secondTickStart)</span>
<span id="cb1-467"><a href="#cb1-467" aria-hidden="true" tabindex="-1"></a>      <span class="op">.</span><span class="fu">attr</span>(<span class="st">"y2"</span><span class="op">,</span> secondTickStart <span class="op">+</span> secondTickLength)</span>
<span id="cb1-468"><a href="#cb1-468" aria-hidden="true" tabindex="-1"></a>      <span class="op">.</span><span class="fu">attr</span>(<span class="st">"transform"</span><span class="op">,</span> d <span class="kw">=&gt;</span> <span class="vs">`rotate(</span><span class="sc">${</span><span class="fu">sto</span>(d)<span class="sc">}</span><span class="vs">)`</span>)<span class="op">;</span></span>
<span id="cb1-469"><a href="#cb1-469" aria-hidden="true" tabindex="-1"></a>    <span class="co">// and labels...</span></span>
<span id="cb1-470"><a href="#cb1-470" aria-hidden="true" tabindex="-1"></a>    face</span>
<span id="cb1-471"><a href="#cb1-471" aria-hidden="true" tabindex="-1"></a>      <span class="op">.</span><span class="fu">selectAll</span>(<span class="st">".second-label"</span>)</span>
<span id="cb1-472"><a href="#cb1-472" aria-hidden="true" tabindex="-1"></a>      <span class="op">.</span><span class="fu">data</span>(d3<span class="op">.</span><span class="fu">range</span>(<span class="dv">0</span><span class="op">,</span> <span class="dv">100</span><span class="op">,</span> <span class="dv">5</span>))</span>
<span id="cb1-473"><a href="#cb1-473" aria-hidden="true" tabindex="-1"></a>      <span class="op">.</span><span class="fu">enter</span>()</span>
<span id="cb1-474"><a href="#cb1-474" aria-hidden="true" tabindex="-1"></a>      <span class="op">.</span><span class="fu">append</span>(<span class="st">"text"</span>)</span>
<span id="cb1-475"><a href="#cb1-475" aria-hidden="true" tabindex="-1"></a>      <span class="op">.</span><span class="fu">attr</span>(<span class="st">"class"</span><span class="op">,</span> <span class="st">"second-label"</span>)</span>
<span id="cb1-476"><a href="#cb1-476" aria-hidden="true" tabindex="-1"></a>      <span class="op">.</span><span class="fu">attr</span>(<span class="st">"text-anchor"</span><span class="op">,</span> <span class="st">"middle"</span>)</span>
<span id="cb1-477"><a href="#cb1-477" aria-hidden="true" tabindex="-1"></a>      <span class="op">.</span><span class="fu">attr</span>(<span class="st">"x"</span><span class="op">,</span> d <span class="kw">=&gt;</span> secondLabelRadius <span class="op">*</span> <span class="bu">Math</span><span class="op">.</span><span class="fu">sin</span>(<span class="fu">sto</span>(d) <span class="op">*</span> radians))</span>
<span id="cb1-478"><a href="#cb1-478" aria-hidden="true" tabindex="-1"></a>      <span class="op">.</span><span class="fu">attr</span>(</span>
<span id="cb1-479"><a href="#cb1-479" aria-hidden="true" tabindex="-1"></a>        <span class="st">"y"</span><span class="op">,</span></span>
<span id="cb1-480"><a href="#cb1-480" aria-hidden="true" tabindex="-1"></a>        d <span class="kw">=&gt;</span></span>
<span id="cb1-481"><a href="#cb1-481" aria-hidden="true" tabindex="-1"></a>          <span class="op">-</span>secondLabelRadius <span class="op">*</span> <span class="bu">Math</span><span class="op">.</span><span class="fu">cos</span>(<span class="fu">sto</span>(d) <span class="op">*</span> radians) <span class="op">+</span> secondLabelYOffset</span>
<span id="cb1-482"><a href="#cb1-482" aria-hidden="true" tabindex="-1"></a>      )</span>
<span id="cb1-483"><a href="#cb1-483" aria-hidden="true" tabindex="-1"></a>      <span class="op">.</span><span class="fu">text</span>(d <span class="kw">=&gt;</span> d)<span class="op">;</span></span>
<span id="cb1-484"><a href="#cb1-484" aria-hidden="true" tabindex="-1"></a>    <span class="co">// ... and hours</span></span>
<span id="cb1-485"><a href="#cb1-485" aria-hidden="true" tabindex="-1"></a>    face</span>
<span id="cb1-486"><a href="#cb1-486" aria-hidden="true" tabindex="-1"></a>      <span class="op">.</span><span class="fu">selectAll</span>(<span class="st">".hour-tick"</span>)</span>
<span id="cb1-487"><a href="#cb1-487" aria-hidden="true" tabindex="-1"></a>      <span class="op">.</span><span class="fu">data</span>(d3<span class="op">.</span><span class="fu">range</span>(<span class="dv">0</span><span class="op">,</span> <span class="dv">10</span><span class="op">,</span> <span class="dv">1</span>))</span>
<span id="cb1-488"><a href="#cb1-488" aria-hidden="true" tabindex="-1"></a>      <span class="op">.</span><span class="fu">enter</span>()</span>
<span id="cb1-489"><a href="#cb1-489" aria-hidden="true" tabindex="-1"></a>      <span class="op">.</span><span class="fu">append</span>(<span class="st">"line"</span>)</span>
<span id="cb1-490"><a href="#cb1-490" aria-hidden="true" tabindex="-1"></a>      <span class="op">.</span><span class="fu">attr</span>(<span class="st">"class"</span><span class="op">,</span> <span class="st">"hour-tick"</span>)</span>
<span id="cb1-491"><a href="#cb1-491" aria-hidden="true" tabindex="-1"></a>      <span class="op">.</span><span class="fu">attr</span>(<span class="st">"x1"</span><span class="op">,</span> <span class="dv">0</span>)</span>
<span id="cb1-492"><a href="#cb1-492" aria-hidden="true" tabindex="-1"></a>      <span class="op">.</span><span class="fu">attr</span>(<span class="st">"x2"</span><span class="op">,</span> <span class="dv">0</span>)</span>
<span id="cb1-493"><a href="#cb1-493" aria-hidden="true" tabindex="-1"></a>      <span class="op">.</span><span class="fu">attr</span>(<span class="st">"y1"</span><span class="op">,</span> hourTickStart)</span>
<span id="cb1-494"><a href="#cb1-494" aria-hidden="true" tabindex="-1"></a>      <span class="op">.</span><span class="fu">attr</span>(<span class="st">"y2"</span><span class="op">,</span> hourTickStart <span class="op">+</span> hourTickLength)</span>
<span id="cb1-495"><a href="#cb1-495" aria-hidden="true" tabindex="-1"></a>      <span class="op">.</span><span class="fu">attr</span>(<span class="st">"transform"</span><span class="op">,</span> d <span class="kw">=&gt;</span> <span class="vs">`rotate(</span><span class="sc">${</span><span class="fu">ten</span>(d)<span class="sc">}</span><span class="vs">)`</span>)<span class="op">;</span></span>
<span id="cb1-496"><a href="#cb1-496" aria-hidden="true" tabindex="-1"></a>    face</span>
<span id="cb1-497"><a href="#cb1-497" aria-hidden="true" tabindex="-1"></a>      <span class="op">.</span><span class="fu">selectAll</span>(<span class="st">".hour-label"</span>)</span>
<span id="cb1-498"><a href="#cb1-498" aria-hidden="true" tabindex="-1"></a>      <span class="op">.</span><span class="fu">data</span>(d3<span class="op">.</span><span class="fu">range</span>(<span class="dv">0</span><span class="op">,</span> <span class="dv">10</span><span class="op">,</span> <span class="dv">1</span>))</span>
<span id="cb1-499"><a href="#cb1-499" aria-hidden="true" tabindex="-1"></a>      <span class="op">.</span><span class="fu">enter</span>()</span>
<span id="cb1-500"><a href="#cb1-500" aria-hidden="true" tabindex="-1"></a>      <span class="op">.</span><span class="fu">append</span>(<span class="st">"text"</span>)</span>
<span id="cb1-501"><a href="#cb1-501" aria-hidden="true" tabindex="-1"></a>      <span class="op">.</span><span class="fu">attr</span>(<span class="st">"class"</span><span class="op">,</span> <span class="st">"hour-label"</span>)</span>
<span id="cb1-502"><a href="#cb1-502" aria-hidden="true" tabindex="-1"></a>      <span class="op">.</span><span class="fu">attr</span>(<span class="st">"text-anchor"</span><span class="op">,</span> <span class="st">"middle"</span>)</span>
<span id="cb1-503"><a href="#cb1-503" aria-hidden="true" tabindex="-1"></a>      <span class="op">.</span><span class="fu">attr</span>(<span class="st">"x"</span><span class="op">,</span> d <span class="kw">=&gt;</span> hourLabelRadius <span class="op">*</span> <span class="bu">Math</span><span class="op">.</span><span class="fu">sin</span>(<span class="fu">ten</span>(d) <span class="op">*</span> radians))</span>
<span id="cb1-504"><a href="#cb1-504" aria-hidden="true" tabindex="-1"></a>      <span class="op">.</span><span class="fu">attr</span>(</span>
<span id="cb1-505"><a href="#cb1-505" aria-hidden="true" tabindex="-1"></a>        <span class="st">"y"</span><span class="op">,</span></span>
<span id="cb1-506"><a href="#cb1-506" aria-hidden="true" tabindex="-1"></a>        d <span class="kw">=&gt;</span> <span class="op">-</span>hourLabelRadius <span class="op">*</span> <span class="bu">Math</span><span class="op">.</span><span class="fu">cos</span>(<span class="fu">ten</span>(d) <span class="op">*</span> radians) <span class="op">+</span> hourLabelYOffset</span>
<span id="cb1-507"><a href="#cb1-507" aria-hidden="true" tabindex="-1"></a>      )</span>
<span id="cb1-508"><a href="#cb1-508" aria-hidden="true" tabindex="-1"></a>      <span class="op">.</span><span class="fu">text</span>(d <span class="kw">=&gt;</span> d)<span class="op">;</span></span>
<span id="cb1-509"><a href="#cb1-509" aria-hidden="true" tabindex="-1"></a>    <span class="kw">const</span> hands <span class="op">=</span> face<span class="op">.</span><span class="fu">append</span>(<span class="st">"g"</span>)<span class="op">.</span><span class="fu">attr</span>(<span class="st">"id"</span><span class="op">,</span> <span class="st">"clock-hands"</span>)<span class="op">;</span></span>
<span id="cb1-510"><a href="#cb1-510" aria-hidden="true" tabindex="-1"></a>    hands</span>
<span id="cb1-511"><a href="#cb1-511" aria-hidden="true" tabindex="-1"></a>      <span class="op">.</span><span class="fu">selectAll</span>(<span class="st">"line"</span>)</span>
<span id="cb1-512"><a href="#cb1-512" aria-hidden="true" tabindex="-1"></a>      <span class="op">.</span><span class="fu">data</span>(handData)</span>
<span id="cb1-513"><a href="#cb1-513" aria-hidden="true" tabindex="-1"></a>      <span class="op">.</span><span class="fu">enter</span>()</span>
<span id="cb1-514"><a href="#cb1-514" aria-hidden="true" tabindex="-1"></a>      <span class="op">.</span><span class="fu">append</span>(<span class="st">"line"</span>)</span>
<span id="cb1-515"><a href="#cb1-515" aria-hidden="true" tabindex="-1"></a>      <span class="op">.</span><span class="fu">attr</span>(<span class="st">"class"</span><span class="op">,</span> d <span class="kw">=&gt;</span> d<span class="op">.</span><span class="at">type</span> <span class="op">+</span> <span class="st">"-hand"</span>)</span>
<span id="cb1-516"><a href="#cb1-516" aria-hidden="true" tabindex="-1"></a>      <span class="op">.</span><span class="fu">attr</span>(<span class="st">"x1"</span><span class="op">,</span> <span class="dv">0</span>)</span>
<span id="cb1-517"><a href="#cb1-517" aria-hidden="true" tabindex="-1"></a>      <span class="op">.</span><span class="fu">attr</span>(<span class="st">"y1"</span><span class="op">,</span> d <span class="kw">=&gt;</span> d<span class="op">.</span><span class="at">balance</span> <span class="op">||</span> <span class="dv">0</span>)</span>
<span id="cb1-518"><a href="#cb1-518" aria-hidden="true" tabindex="-1"></a>      <span class="op">.</span><span class="fu">attr</span>(<span class="st">"x2"</span><span class="op">,</span> <span class="dv">0</span>)</span>
<span id="cb1-519"><a href="#cb1-519" aria-hidden="true" tabindex="-1"></a>      <span class="op">.</span><span class="fu">attr</span>(<span class="st">"y2"</span><span class="op">,</span> d <span class="kw">=&gt;</span> d<span class="op">.</span><span class="at">length</span>)</span>
<span id="cb1-520"><a href="#cb1-520" aria-hidden="true" tabindex="-1"></a>      <span class="op">.</span><span class="fu">attr</span>(<span class="st">"transform"</span><span class="op">,</span> d <span class="kw">=&gt;</span> <span class="vs">`rotate(</span><span class="sc">${</span>d<span class="op">.</span><span class="fu">scale</span>(d<span class="op">.</span><span class="at">value</span>)<span class="sc">}</span><span class="vs">)`</span>)<span class="op">;</span></span>
<span id="cb1-521"><a href="#cb1-521" aria-hidden="true" tabindex="-1"></a>    face</span>
<span id="cb1-522"><a href="#cb1-522" aria-hidden="true" tabindex="-1"></a>      <span class="op">.</span><span class="fu">append</span>(<span class="st">"g"</span>)</span>
<span id="cb1-523"><a href="#cb1-523" aria-hidden="true" tabindex="-1"></a>      <span class="op">.</span><span class="fu">attr</span>(<span class="st">"id"</span><span class="op">,</span> <span class="st">"face-overlay"</span>)</span>
<span id="cb1-524"><a href="#cb1-524" aria-hidden="true" tabindex="-1"></a>      <span class="op">.</span><span class="fu">append</span>(<span class="st">"circle"</span>)</span>
<span id="cb1-525"><a href="#cb1-525" aria-hidden="true" tabindex="-1"></a>      <span class="op">.</span><span class="fu">attr</span>(<span class="st">"class"</span><span class="op">,</span> <span class="st">"hands-cover"</span>)</span>
<span id="cb1-526"><a href="#cb1-526" aria-hidden="true" tabindex="-1"></a>      <span class="op">.</span><span class="fu">attr</span>(<span class="st">"x"</span><span class="op">,</span> <span class="dv">0</span>)</span>
<span id="cb1-527"><a href="#cb1-527" aria-hidden="true" tabindex="-1"></a>      <span class="op">.</span><span class="fu">attr</span>(<span class="st">"y"</span><span class="op">,</span> <span class="dv">0</span>)</span>
<span id="cb1-528"><a href="#cb1-528" aria-hidden="true" tabindex="-1"></a>      <span class="op">.</span><span class="fu">attr</span>(<span class="st">"r"</span><span class="op">,</span> clockRadius <span class="op">/</span> <span class="dv">20</span>)<span class="op">;</span></span>
<span id="cb1-529"><a href="#cb1-529" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb1-530"><a href="#cb1-530" aria-hidden="true" tabindex="-1"></a>  <span class="kw">function</span> <span class="fu">moveHands</span>() {</span>
<span id="cb1-531"><a href="#cb1-531" aria-hidden="true" tabindex="-1"></a>    <span class="kw">const</span> sel <span class="op">=</span> d3</span>
<span id="cb1-532"><a href="#cb1-532" aria-hidden="true" tabindex="-1"></a>      <span class="op">.</span><span class="fu">select</span>(<span class="st">"#clock-hands-final"</span>)</span>
<span id="cb1-533"><a href="#cb1-533" aria-hidden="true" tabindex="-1"></a>      <span class="op">.</span><span class="fu">selectAll</span>(<span class="st">"line"</span>)</span>
<span id="cb1-534"><a href="#cb1-534" aria-hidden="true" tabindex="-1"></a>      <span class="op">.</span><span class="fu">data</span>(handData)</span>
<span id="cb1-535"><a href="#cb1-535" aria-hidden="true" tabindex="-1"></a>      <span class="op">.</span><span class="fu">transition</span>()<span class="op">;</span></span>
<span id="cb1-536"><a href="#cb1-536" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> (fancySecondsOFF) sel<span class="op">.</span><span class="fu">ease</span>(d3<span class="op">.</span><span class="at">easeElastic</span><span class="op">.</span><span class="fu">period</span>(<span class="fl">0.5</span>))<span class="op">;</span></span>
<span id="cb1-537"><a href="#cb1-537" aria-hidden="true" tabindex="-1"></a>    sel<span class="op">.</span><span class="fu">attr</span>(<span class="st">"transform"</span><span class="op">,</span> d <span class="kw">=&gt;</span> <span class="vs">`rotate(</span><span class="sc">${</span>d<span class="op">.</span><span class="fu">scale</span>(d<span class="op">.</span><span class="at">value</span>)<span class="sc">}</span><span class="vs">)`</span>)<span class="op">;</span></span>
<span id="cb1-538"><a href="#cb1-538" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb1-539"><a href="#cb1-539" aria-hidden="true" tabindex="-1"></a>  <span class="kw">function</span> <span class="fu">updateData</span>() {</span>
<span id="cb1-540"><a href="#cb1-540" aria-hidden="true" tabindex="-1"></a>    handData[<span class="dv">0</span>]<span class="op">.</span><span class="at">value</span> <span class="op">=</span> <span class="op">!</span>fancySecondsOFF <span class="op">?</span> <span class="bu">Math</span><span class="op">.</span><span class="fu">floor</span>(selectedExact <span class="op">*</span> <span class="dv">10</span>) <span class="op">:</span> decTime[<span class="dv">0</span>]<span class="op">;</span></span>
<span id="cb1-541"><a href="#cb1-541" aria-hidden="true" tabindex="-1"></a>    handData[<span class="dv">1</span>]<span class="op">.</span><span class="at">value</span> <span class="op">=</span> <span class="op">!</span>fancySecondsOFF <span class="op">?</span> <span class="bu">Math</span><span class="op">.</span><span class="fu">floor</span>(selectedExact <span class="op">*</span> <span class="dv">10</span> <span class="op">%</span> <span class="dv">1</span> <span class="op">*</span> <span class="dv">100</span>) <span class="op">:</span> decTime<span class="op">.</span><span class="fu">slice</span>(<span class="dv">2</span><span class="op">,</span> <span class="dv">4</span>)<span class="op">;</span></span>
<span id="cb1-542"><a href="#cb1-542" aria-hidden="true" tabindex="-1"></a>    handData[<span class="dv">2</span>]<span class="op">.</span><span class="at">value</span> <span class="op">=</span> <span class="op">!</span>fancySecondsOFF <span class="op">?</span> selectedExact <span class="op">*</span> <span class="dv">10</span> <span class="op">%</span> <span class="dv">1</span> <span class="op">*</span> <span class="dv">100</span> <span class="op">%</span> <span class="dv">1</span> <span class="op">*</span> <span class="dv">100</span> <span class="op">:</span> decTime<span class="op">.</span><span class="fu">slice</span>(<span class="dv">4</span><span class="op">,</span> <span class="dv">6</span>)<span class="op">;</span></span>
<span id="cb1-543"><a href="#cb1-543" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb1-544"><a href="#cb1-544" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> svg <span class="op">=</span> d3</span>
<span id="cb1-545"><a href="#cb1-545" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">create</span>(<span class="st">"svg"</span>)</span>
<span id="cb1-546"><a href="#cb1-546" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">"viewBox"</span><span class="op">,</span> [<span class="dv">0</span><span class="op">,</span> <span class="dv">0</span><span class="op">,</span> w<span class="op">,</span> h])</span>
<span id="cb1-547"><a href="#cb1-547" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">style</span>(<span class="st">"max-width"</span><span class="op">,</span> <span class="vs">`</span><span class="sc">${</span>width <span class="op">/</span> <span class="fl">2.1</span><span class="sc">}</span><span class="vs">px`</span>)</span>
<span id="cb1-548"><a href="#cb1-548" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">"class"</span><span class="op">,</span> <span class="st">"clock-top"</span>)</span>
<span id="cb1-549"><a href="#cb1-549" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">"id"</span><span class="op">,</span> <span class="st">"clock"</span>)<span class="op">;</span></span>
<span id="cb1-550"><a href="#cb1-550" aria-hidden="true" tabindex="-1"></a>  svg</span>
<span id="cb1-551"><a href="#cb1-551" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">append</span>(<span class="st">"text"</span>)</span>
<span id="cb1-552"><a href="#cb1-552" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">text</span>(<span class="vs">`+</span><span class="sc">${</span>decTime<span class="sc">}</span><span class="vs">-</span><span class="sc">${</span>selectedZone<span class="sc">}</span><span class="vs">`</span>)</span>
<span id="cb1-553"><a href="#cb1-553" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">"x"</span><span class="op">,</span> clockRadius <span class="op">+</span> margin)</span>
<span id="cb1-554"><a href="#cb1-554" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">"y"</span><span class="op">,</span> clockRadius <span class="op">*</span> <span class="dv">2</span> <span class="op">+</span> margin <span class="op">*</span> <span class="fl">1.975</span>)</span>
<span id="cb1-555"><a href="#cb1-555" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">"text-anchor"</span><span class="op">,</span> <span class="st">"middle"</span>)</span>
<span id="cb1-556"><a href="#cb1-556" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">"font-size"</span><span class="op">,</span> <span class="dv">32</span>)</span>
<span id="cb1-557"><a href="#cb1-557" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">"font-family"</span><span class="op">,</span> <span class="st">"monospace"</span>)<span class="op">;</span></span>
<span id="cb1-558"><a href="#cb1-558" aria-hidden="true" tabindex="-1"></a>  <span class="fu">drawClock</span>()<span class="op">;</span></span>
<span id="cb1-559"><a href="#cb1-559" aria-hidden="true" tabindex="-1"></a>  <span class="co">// Animation</span></span>
<span id="cb1-560"><a href="#cb1-560" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> interval <span class="op">=</span> <span class="pp">setInterval</span>(</span>
<span id="cb1-561"><a href="#cb1-561" aria-hidden="true" tabindex="-1"></a>    () <span class="kw">=&gt;</span> {</span>
<span id="cb1-562"><a href="#cb1-562" aria-hidden="true" tabindex="-1"></a>      <span class="fu">updateData</span>()<span class="op">;</span></span>
<span id="cb1-563"><a href="#cb1-563" aria-hidden="true" tabindex="-1"></a>      <span class="fu">moveHands</span>()<span class="op">;</span></span>
<span id="cb1-564"><a href="#cb1-564" aria-hidden="true" tabindex="-1"></a>    }<span class="op">,</span></span>
<span id="cb1-565"><a href="#cb1-565" aria-hidden="true" tabindex="-1"></a>    <span class="op">!</span>fancySecondsOFF <span class="op">?</span> <span class="dv">10</span> <span class="op">:</span> <span class="dv">864</span></span>
<span id="cb1-566"><a href="#cb1-566" aria-hidden="true" tabindex="-1"></a>  )<span class="op">;</span></span>
<span id="cb1-567"><a href="#cb1-567" aria-hidden="true" tabindex="-1"></a>  invalidation<span class="op">.</span><span class="fu">then</span>(() <span class="kw">=&gt;</span> <span class="pp">clearInterval</span>(interval))<span class="op">;</span></span>
<span id="cb1-568"><a href="#cb1-568" aria-hidden="true" tabindex="-1"></a>  <span class="cf">return</span> svg<span class="op">.</span><span class="fu">node</span>()<span class="op">;</span></span>
<span id="cb1-569"><a href="#cb1-569" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb1-570"><a href="#cb1-570" aria-hidden="true" tabindex="-1"></a>clock1 <span class="op">=</span> {</span>
<span id="cb1-571"><a href="#cb1-571" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> clockRadius <span class="op">=</span> <span class="dv">200</span><span class="op">,</span></span>
<span id="cb1-572"><a href="#cb1-572" aria-hidden="true" tabindex="-1"></a>    margin <span class="op">=</span> <span class="dv">50</span><span class="op">,</span></span>
<span id="cb1-573"><a href="#cb1-573" aria-hidden="true" tabindex="-1"></a>    w <span class="op">=</span> (clockRadius <span class="op">+</span> margin) <span class="op">*</span> <span class="dv">2</span><span class="op">,</span></span>
<span id="cb1-574"><a href="#cb1-574" aria-hidden="true" tabindex="-1"></a>    h <span class="op">=</span> (clockRadius <span class="op">+</span> margin) <span class="op">*</span> <span class="dv">2</span><span class="op">,</span></span>
<span id="cb1-575"><a href="#cb1-575" aria-hidden="true" tabindex="-1"></a>    hourHandLength <span class="op">=</span> (<span class="dv">2</span> <span class="op">*</span> clockRadius) <span class="op">/</span> <span class="dv">3</span><span class="op">,</span></span>
<span id="cb1-576"><a href="#cb1-576" aria-hidden="true" tabindex="-1"></a>    minuteHandLength <span class="op">=</span> clockRadius<span class="op">,</span></span>
<span id="cb1-577"><a href="#cb1-577" aria-hidden="true" tabindex="-1"></a>    secondHandLength <span class="op">=</span> clockRadius <span class="op">-</span> <span class="dv">12</span><span class="op">,</span></span>
<span id="cb1-578"><a href="#cb1-578" aria-hidden="true" tabindex="-1"></a>    secondHandBalance <span class="op">=</span> <span class="dv">30</span><span class="op">,</span></span>
<span id="cb1-579"><a href="#cb1-579" aria-hidden="true" tabindex="-1"></a>    secondTickStart <span class="op">=</span> clockRadius<span class="op">,</span></span>
<span id="cb1-580"><a href="#cb1-580" aria-hidden="true" tabindex="-1"></a>    secondTickLength <span class="op">=</span> <span class="op">-</span><span class="dv">10</span><span class="op">,</span></span>
<span id="cb1-581"><a href="#cb1-581" aria-hidden="true" tabindex="-1"></a>    hourTickStart <span class="op">=</span> clockRadius<span class="op">,</span></span>
<span id="cb1-582"><a href="#cb1-582" aria-hidden="true" tabindex="-1"></a>    hourTickLength <span class="op">=</span> <span class="op">-</span><span class="dv">18</span><span class="op">,</span></span>
<span id="cb1-583"><a href="#cb1-583" aria-hidden="true" tabindex="-1"></a>    secondLabelRadius <span class="op">=</span> clockRadius <span class="op">+</span> <span class="dv">16</span><span class="op">,</span></span>
<span id="cb1-584"><a href="#cb1-584" aria-hidden="true" tabindex="-1"></a>    secondLabelYOffset <span class="op">=</span> <span class="dv">5</span><span class="op">,</span></span>
<span id="cb1-585"><a href="#cb1-585" aria-hidden="true" tabindex="-1"></a>    hourLabelRadius <span class="op">=</span> clockRadius <span class="op">-</span> <span class="dv">40</span><span class="op">,</span></span>
<span id="cb1-586"><a href="#cb1-586" aria-hidden="true" tabindex="-1"></a>    hourLabelYOffset <span class="op">=</span> <span class="dv">7</span><span class="op">,</span></span>
<span id="cb1-587"><a href="#cb1-587" aria-hidden="true" tabindex="-1"></a>    radians <span class="op">=</span> <span class="bu">Math</span><span class="op">.</span><span class="cn">PI</span> <span class="op">/</span> <span class="dv">180</span><span class="op">;</span></span>
<span id="cb1-588"><a href="#cb1-588" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> ten <span class="op">=</span> d3</span>
<span id="cb1-589"><a href="#cb1-589" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">scaleLinear</span>()</span>
<span id="cb1-590"><a href="#cb1-590" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">range</span>([<span class="dv">0</span><span class="op">,</span> <span class="dv">360</span>])</span>
<span id="cb1-591"><a href="#cb1-591" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">domain</span>([<span class="dv">0</span><span class="op">,</span> <span class="dv">10</span>])<span class="op">;</span></span>
<span id="cb1-592"><a href="#cb1-592" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> sto <span class="op">=</span> d3</span>
<span id="cb1-593"><a href="#cb1-593" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">scaleLinear</span>()</span>
<span id="cb1-594"><a href="#cb1-594" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">range</span>([<span class="dv">0</span><span class="op">,</span> <span class="dv">360</span>])</span>
<span id="cb1-595"><a href="#cb1-595" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">domain</span>([<span class="dv">0</span><span class="op">,</span> <span class="dv">100</span>])<span class="op">;</span></span>
<span id="cb1-596"><a href="#cb1-596" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> handData <span class="op">=</span> [</span>
<span id="cb1-597"><a href="#cb1-597" aria-hidden="true" tabindex="-1"></a>    {</span>
<span id="cb1-598"><a href="#cb1-598" aria-hidden="true" tabindex="-1"></a>      <span class="dt">type</span><span class="op">:</span> <span class="st">"hour"</span><span class="op">,</span></span>
<span id="cb1-599"><a href="#cb1-599" aria-hidden="true" tabindex="-1"></a>      <span class="dt">value</span><span class="op">:</span> <span class="dv">0</span><span class="op">,</span></span>
<span id="cb1-600"><a href="#cb1-600" aria-hidden="true" tabindex="-1"></a>      <span class="dt">length</span><span class="op">:</span> <span class="op">-</span>hourHandLength<span class="op">,</span></span>
<span id="cb1-601"><a href="#cb1-601" aria-hidden="true" tabindex="-1"></a>      <span class="dt">scale</span><span class="op">:</span> ten</span>
<span id="cb1-602"><a href="#cb1-602" aria-hidden="true" tabindex="-1"></a>    }<span class="op">,</span></span>
<span id="cb1-603"><a href="#cb1-603" aria-hidden="true" tabindex="-1"></a>    {</span>
<span id="cb1-604"><a href="#cb1-604" aria-hidden="true" tabindex="-1"></a>      <span class="dt">type</span><span class="op">:</span> <span class="st">"minute"</span><span class="op">,</span></span>
<span id="cb1-605"><a href="#cb1-605" aria-hidden="true" tabindex="-1"></a>      <span class="dt">value</span><span class="op">:</span> <span class="dv">0</span><span class="op">,</span></span>
<span id="cb1-606"><a href="#cb1-606" aria-hidden="true" tabindex="-1"></a>      <span class="dt">length</span><span class="op">:</span> <span class="op">-</span>minuteHandLength<span class="op">,</span></span>
<span id="cb1-607"><a href="#cb1-607" aria-hidden="true" tabindex="-1"></a>      <span class="dt">scale</span><span class="op">:</span> sto</span>
<span id="cb1-608"><a href="#cb1-608" aria-hidden="true" tabindex="-1"></a>    }<span class="op">,</span></span>
<span id="cb1-609"><a href="#cb1-609" aria-hidden="true" tabindex="-1"></a>    {</span>
<span id="cb1-610"><a href="#cb1-610" aria-hidden="true" tabindex="-1"></a>      <span class="dt">type</span><span class="op">:</span> <span class="st">"second"</span><span class="op">,</span></span>
<span id="cb1-611"><a href="#cb1-611" aria-hidden="true" tabindex="-1"></a>      <span class="dt">value</span><span class="op">:</span> <span class="dv">0</span><span class="op">,</span></span>
<span id="cb1-612"><a href="#cb1-612" aria-hidden="true" tabindex="-1"></a>      <span class="dt">length</span><span class="op">:</span> <span class="op">-</span>secondHandLength<span class="op">,</span></span>
<span id="cb1-613"><a href="#cb1-613" aria-hidden="true" tabindex="-1"></a>      <span class="dt">scale</span><span class="op">:</span> sto<span class="op">,</span></span>
<span id="cb1-614"><a href="#cb1-614" aria-hidden="true" tabindex="-1"></a>      <span class="dt">balance</span><span class="op">:</span> secondHandBalance</span>
<span id="cb1-615"><a href="#cb1-615" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb1-616"><a href="#cb1-616" aria-hidden="true" tabindex="-1"></a>  ]<span class="op">;</span></span>
<span id="cb1-617"><a href="#cb1-617" aria-hidden="true" tabindex="-1"></a>  <span class="kw">function</span> <span class="fu">drawClock</span>() {</span>
<span id="cb1-618"><a href="#cb1-618" aria-hidden="true" tabindex="-1"></a>    <span class="co">// create all the clock elements</span></span>
<span id="cb1-619"><a href="#cb1-619" aria-hidden="true" tabindex="-1"></a>    <span class="fu">updateData</span>()<span class="op">;</span> <span class="co">//draw them in the correct starting position</span></span>
<span id="cb1-620"><a href="#cb1-620" aria-hidden="true" tabindex="-1"></a>    <span class="kw">const</span> face <span class="op">=</span> svg</span>
<span id="cb1-621"><a href="#cb1-621" aria-hidden="true" tabindex="-1"></a>      <span class="op">.</span><span class="fu">append</span>(<span class="st">"g"</span>)</span>
<span id="cb1-622"><a href="#cb1-622" aria-hidden="true" tabindex="-1"></a>      <span class="op">.</span><span class="fu">attr</span>(<span class="st">"id"</span><span class="op">,</span> <span class="st">"clock-face"</span>)</span>
<span id="cb1-623"><a href="#cb1-623" aria-hidden="true" tabindex="-1"></a>      <span class="op">.</span><span class="fu">attr</span>(<span class="st">"transform"</span><span class="op">,</span> <span class="vs">`translate(</span><span class="sc">${</span>[w <span class="op">/</span> <span class="dv">2</span><span class="op">,</span> h <span class="op">/</span> <span class="dv">2</span>]<span class="sc">}</span><span class="vs">)`</span>)<span class="op">;</span></span>
<span id="cb1-624"><a href="#cb1-624" aria-hidden="true" tabindex="-1"></a>    <span class="co">// add marks for seconds</span></span>
<span id="cb1-625"><a href="#cb1-625" aria-hidden="true" tabindex="-1"></a>    face</span>
<span id="cb1-626"><a href="#cb1-626" aria-hidden="true" tabindex="-1"></a>      <span class="op">.</span><span class="fu">selectAll</span>(<span class="st">".second-tick"</span>)</span>
<span id="cb1-627"><a href="#cb1-627" aria-hidden="true" tabindex="-1"></a>      <span class="op">.</span><span class="fu">data</span>(d3<span class="op">.</span><span class="fu">range</span>(<span class="dv">0</span><span class="op">,</span> <span class="dv">100</span>))</span>
<span id="cb1-628"><a href="#cb1-628" aria-hidden="true" tabindex="-1"></a>      <span class="op">.</span><span class="fu">enter</span>()</span>
<span id="cb1-629"><a href="#cb1-629" aria-hidden="true" tabindex="-1"></a>      <span class="op">.</span><span class="fu">append</span>(<span class="st">"line"</span>)</span>
<span id="cb1-630"><a href="#cb1-630" aria-hidden="true" tabindex="-1"></a>      <span class="op">.</span><span class="fu">attr</span>(<span class="st">"class"</span><span class="op">,</span> <span class="st">"second-tick"</span>)</span>
<span id="cb1-631"><a href="#cb1-631" aria-hidden="true" tabindex="-1"></a>      <span class="op">.</span><span class="fu">attr</span>(<span class="st">"x1"</span><span class="op">,</span> <span class="dv">0</span>)</span>
<span id="cb1-632"><a href="#cb1-632" aria-hidden="true" tabindex="-1"></a>      <span class="op">.</span><span class="fu">attr</span>(<span class="st">"x2"</span><span class="op">,</span> <span class="dv">0</span>)</span>
<span id="cb1-633"><a href="#cb1-633" aria-hidden="true" tabindex="-1"></a>      <span class="op">.</span><span class="fu">attr</span>(<span class="st">"y1"</span><span class="op">,</span> secondTickStart)</span>
<span id="cb1-634"><a href="#cb1-634" aria-hidden="true" tabindex="-1"></a>      <span class="op">.</span><span class="fu">attr</span>(<span class="st">"y2"</span><span class="op">,</span> secondTickStart <span class="op">+</span> secondTickLength)</span>
<span id="cb1-635"><a href="#cb1-635" aria-hidden="true" tabindex="-1"></a>      <span class="op">.</span><span class="fu">attr</span>(<span class="st">"transform"</span><span class="op">,</span> d <span class="kw">=&gt;</span> <span class="vs">`rotate(</span><span class="sc">${</span><span class="fu">sto</span>(d)<span class="sc">}</span><span class="vs">)`</span>)<span class="op">;</span></span>
<span id="cb1-636"><a href="#cb1-636" aria-hidden="true" tabindex="-1"></a>    <span class="co">// and labels...</span></span>
<span id="cb1-637"><a href="#cb1-637" aria-hidden="true" tabindex="-1"></a>    face</span>
<span id="cb1-638"><a href="#cb1-638" aria-hidden="true" tabindex="-1"></a>      <span class="op">.</span><span class="fu">selectAll</span>(<span class="st">".second-label"</span>)</span>
<span id="cb1-639"><a href="#cb1-639" aria-hidden="true" tabindex="-1"></a>      <span class="op">.</span><span class="fu">data</span>(d3<span class="op">.</span><span class="fu">range</span>(<span class="dv">0</span><span class="op">,</span> <span class="dv">100</span><span class="op">,</span> <span class="dv">5</span>))</span>
<span id="cb1-640"><a href="#cb1-640" aria-hidden="true" tabindex="-1"></a>      <span class="op">.</span><span class="fu">enter</span>()</span>
<span id="cb1-641"><a href="#cb1-641" aria-hidden="true" tabindex="-1"></a>      <span class="op">.</span><span class="fu">append</span>(<span class="st">"text"</span>)</span>
<span id="cb1-642"><a href="#cb1-642" aria-hidden="true" tabindex="-1"></a>      <span class="op">.</span><span class="fu">attr</span>(<span class="st">"class"</span><span class="op">,</span> <span class="st">"second-label"</span>)</span>
<span id="cb1-643"><a href="#cb1-643" aria-hidden="true" tabindex="-1"></a>      <span class="op">.</span><span class="fu">attr</span>(<span class="st">"text-anchor"</span><span class="op">,</span> <span class="st">"middle"</span>)</span>
<span id="cb1-644"><a href="#cb1-644" aria-hidden="true" tabindex="-1"></a>      <span class="op">.</span><span class="fu">attr</span>(<span class="st">"x"</span><span class="op">,</span> d <span class="kw">=&gt;</span> secondLabelRadius <span class="op">*</span> <span class="bu">Math</span><span class="op">.</span><span class="fu">sin</span>(<span class="fu">sto</span>(d) <span class="op">*</span> radians))</span>
<span id="cb1-645"><a href="#cb1-645" aria-hidden="true" tabindex="-1"></a>      <span class="op">.</span><span class="fu">attr</span>(</span>
<span id="cb1-646"><a href="#cb1-646" aria-hidden="true" tabindex="-1"></a>        <span class="st">"y"</span><span class="op">,</span></span>
<span id="cb1-647"><a href="#cb1-647" aria-hidden="true" tabindex="-1"></a>        d <span class="kw">=&gt;</span></span>
<span id="cb1-648"><a href="#cb1-648" aria-hidden="true" tabindex="-1"></a>          <span class="op">-</span>secondLabelRadius <span class="op">*</span> <span class="bu">Math</span><span class="op">.</span><span class="fu">cos</span>(<span class="fu">sto</span>(d) <span class="op">*</span> radians) <span class="op">+</span> secondLabelYOffset</span>
<span id="cb1-649"><a href="#cb1-649" aria-hidden="true" tabindex="-1"></a>      )</span>
<span id="cb1-650"><a href="#cb1-650" aria-hidden="true" tabindex="-1"></a>      <span class="op">.</span><span class="fu">text</span>(d <span class="kw">=&gt;</span> d)<span class="op">;</span></span>
<span id="cb1-651"><a href="#cb1-651" aria-hidden="true" tabindex="-1"></a>    <span class="co">// ... and hours</span></span>
<span id="cb1-652"><a href="#cb1-652" aria-hidden="true" tabindex="-1"></a>    face</span>
<span id="cb1-653"><a href="#cb1-653" aria-hidden="true" tabindex="-1"></a>      <span class="op">.</span><span class="fu">selectAll</span>(<span class="st">".hour-tick"</span>)</span>
<span id="cb1-654"><a href="#cb1-654" aria-hidden="true" tabindex="-1"></a>      <span class="op">.</span><span class="fu">data</span>(d3<span class="op">.</span><span class="fu">range</span>(<span class="dv">0</span><span class="op">,</span> <span class="dv">10</span><span class="op">,</span> <span class="dv">1</span>))</span>
<span id="cb1-655"><a href="#cb1-655" aria-hidden="true" tabindex="-1"></a>      <span class="op">.</span><span class="fu">enter</span>()</span>
<span id="cb1-656"><a href="#cb1-656" aria-hidden="true" tabindex="-1"></a>      <span class="op">.</span><span class="fu">append</span>(<span class="st">"line"</span>)</span>
<span id="cb1-657"><a href="#cb1-657" aria-hidden="true" tabindex="-1"></a>      <span class="op">.</span><span class="fu">attr</span>(<span class="st">"class"</span><span class="op">,</span> <span class="st">"hour-tick"</span>)</span>
<span id="cb1-658"><a href="#cb1-658" aria-hidden="true" tabindex="-1"></a>      <span class="op">.</span><span class="fu">attr</span>(<span class="st">"x1"</span><span class="op">,</span> <span class="dv">0</span>)</span>
<span id="cb1-659"><a href="#cb1-659" aria-hidden="true" tabindex="-1"></a>      <span class="op">.</span><span class="fu">attr</span>(<span class="st">"x2"</span><span class="op">,</span> <span class="dv">0</span>)</span>
<span id="cb1-660"><a href="#cb1-660" aria-hidden="true" tabindex="-1"></a>      <span class="op">.</span><span class="fu">attr</span>(<span class="st">"y1"</span><span class="op">,</span> hourTickStart)</span>
<span id="cb1-661"><a href="#cb1-661" aria-hidden="true" tabindex="-1"></a>      <span class="op">.</span><span class="fu">attr</span>(<span class="st">"y2"</span><span class="op">,</span> hourTickStart <span class="op">+</span> hourTickLength)</span>
<span id="cb1-662"><a href="#cb1-662" aria-hidden="true" tabindex="-1"></a>      <span class="op">.</span><span class="fu">attr</span>(<span class="st">"transform"</span><span class="op">,</span> d <span class="kw">=&gt;</span> <span class="vs">`rotate(</span><span class="sc">${</span><span class="fu">ten</span>(d)<span class="sc">}</span><span class="vs">)`</span>)<span class="op">;</span></span>
<span id="cb1-663"><a href="#cb1-663" aria-hidden="true" tabindex="-1"></a>    face</span>
<span id="cb1-664"><a href="#cb1-664" aria-hidden="true" tabindex="-1"></a>      <span class="op">.</span><span class="fu">selectAll</span>(<span class="st">".hour-label"</span>)</span>
<span id="cb1-665"><a href="#cb1-665" aria-hidden="true" tabindex="-1"></a>      <span class="op">.</span><span class="fu">data</span>(d3<span class="op">.</span><span class="fu">range</span>(<span class="dv">0</span><span class="op">,</span> <span class="dv">10</span><span class="op">,</span> <span class="dv">1</span>))</span>
<span id="cb1-666"><a href="#cb1-666" aria-hidden="true" tabindex="-1"></a>      <span class="op">.</span><span class="fu">enter</span>()</span>
<span id="cb1-667"><a href="#cb1-667" aria-hidden="true" tabindex="-1"></a>      <span class="op">.</span><span class="fu">append</span>(<span class="st">"text"</span>)</span>
<span id="cb1-668"><a href="#cb1-668" aria-hidden="true" tabindex="-1"></a>      <span class="op">.</span><span class="fu">attr</span>(<span class="st">"class"</span><span class="op">,</span> <span class="st">"hour-label"</span>)</span>
<span id="cb1-669"><a href="#cb1-669" aria-hidden="true" tabindex="-1"></a>      <span class="op">.</span><span class="fu">attr</span>(<span class="st">"text-anchor"</span><span class="op">,</span> <span class="st">"middle"</span>)</span>
<span id="cb1-670"><a href="#cb1-670" aria-hidden="true" tabindex="-1"></a>      <span class="op">.</span><span class="fu">attr</span>(<span class="st">"x"</span><span class="op">,</span> d <span class="kw">=&gt;</span> hourLabelRadius <span class="op">*</span> <span class="bu">Math</span><span class="op">.</span><span class="fu">sin</span>(<span class="fu">ten</span>(d) <span class="op">*</span> radians))</span>
<span id="cb1-671"><a href="#cb1-671" aria-hidden="true" tabindex="-1"></a>      <span class="op">.</span><span class="fu">attr</span>(</span>
<span id="cb1-672"><a href="#cb1-672" aria-hidden="true" tabindex="-1"></a>        <span class="st">"y"</span><span class="op">,</span></span>
<span id="cb1-673"><a href="#cb1-673" aria-hidden="true" tabindex="-1"></a>        d <span class="kw">=&gt;</span> <span class="op">-</span>hourLabelRadius <span class="op">*</span> <span class="bu">Math</span><span class="op">.</span><span class="fu">cos</span>(<span class="fu">ten</span>(d) <span class="op">*</span> radians) <span class="op">+</span> hourLabelYOffset</span>
<span id="cb1-674"><a href="#cb1-674" aria-hidden="true" tabindex="-1"></a>      )</span>
<span id="cb1-675"><a href="#cb1-675" aria-hidden="true" tabindex="-1"></a>      <span class="op">.</span><span class="fu">text</span>(d <span class="kw">=&gt;</span> d)<span class="op">;</span></span>
<span id="cb1-676"><a href="#cb1-676" aria-hidden="true" tabindex="-1"></a>    <span class="kw">const</span> hands <span class="op">=</span> face<span class="op">.</span><span class="fu">append</span>(<span class="st">"g"</span>)<span class="op">.</span><span class="fu">attr</span>(<span class="st">"id"</span><span class="op">,</span> <span class="st">"clock-hands"</span>)<span class="op">;</span></span>
<span id="cb1-677"><a href="#cb1-677" aria-hidden="true" tabindex="-1"></a>    hands</span>
<span id="cb1-678"><a href="#cb1-678" aria-hidden="true" tabindex="-1"></a>      <span class="op">.</span><span class="fu">selectAll</span>(<span class="st">"line"</span>)</span>
<span id="cb1-679"><a href="#cb1-679" aria-hidden="true" tabindex="-1"></a>      <span class="op">.</span><span class="fu">data</span>(handData)</span>
<span id="cb1-680"><a href="#cb1-680" aria-hidden="true" tabindex="-1"></a>      <span class="op">.</span><span class="fu">enter</span>()</span>
<span id="cb1-681"><a href="#cb1-681" aria-hidden="true" tabindex="-1"></a>      <span class="op">.</span><span class="fu">append</span>(<span class="st">"line"</span>)</span>
<span id="cb1-682"><a href="#cb1-682" aria-hidden="true" tabindex="-1"></a>      <span class="op">.</span><span class="fu">attr</span>(<span class="st">"class"</span><span class="op">,</span> d <span class="kw">=&gt;</span> d<span class="op">.</span><span class="at">type</span> <span class="op">+</span> <span class="st">"-hand"</span>)</span>
<span id="cb1-683"><a href="#cb1-683" aria-hidden="true" tabindex="-1"></a>      <span class="op">.</span><span class="fu">attr</span>(<span class="st">"x1"</span><span class="op">,</span> <span class="dv">0</span>)</span>
<span id="cb1-684"><a href="#cb1-684" aria-hidden="true" tabindex="-1"></a>      <span class="op">.</span><span class="fu">attr</span>(<span class="st">"y1"</span><span class="op">,</span> d <span class="kw">=&gt;</span> d<span class="op">.</span><span class="at">balance</span> <span class="op">||</span> <span class="dv">0</span>)</span>
<span id="cb1-685"><a href="#cb1-685" aria-hidden="true" tabindex="-1"></a>      <span class="op">.</span><span class="fu">attr</span>(<span class="st">"x2"</span><span class="op">,</span> <span class="dv">0</span>)</span>
<span id="cb1-686"><a href="#cb1-686" aria-hidden="true" tabindex="-1"></a>      <span class="op">.</span><span class="fu">attr</span>(<span class="st">"y2"</span><span class="op">,</span> d <span class="kw">=&gt;</span> d<span class="op">.</span><span class="at">length</span>)</span>
<span id="cb1-687"><a href="#cb1-687" aria-hidden="true" tabindex="-1"></a>      <span class="op">.</span><span class="fu">attr</span>(<span class="st">"transform"</span><span class="op">,</span> d <span class="kw">=&gt;</span> <span class="vs">`rotate(</span><span class="sc">${</span>d<span class="op">.</span><span class="fu">scale</span>(d<span class="op">.</span><span class="at">value</span>)<span class="sc">}</span><span class="vs">)`</span>)<span class="op">;</span></span>
<span id="cb1-688"><a href="#cb1-688" aria-hidden="true" tabindex="-1"></a>    face</span>
<span id="cb1-689"><a href="#cb1-689" aria-hidden="true" tabindex="-1"></a>      <span class="op">.</span><span class="fu">append</span>(<span class="st">"g"</span>)</span>
<span id="cb1-690"><a href="#cb1-690" aria-hidden="true" tabindex="-1"></a>      <span class="op">.</span><span class="fu">attr</span>(<span class="st">"id"</span><span class="op">,</span> <span class="st">"face-overlay"</span>)</span>
<span id="cb1-691"><a href="#cb1-691" aria-hidden="true" tabindex="-1"></a>      <span class="op">.</span><span class="fu">append</span>(<span class="st">"circle"</span>)</span>
<span id="cb1-692"><a href="#cb1-692" aria-hidden="true" tabindex="-1"></a>      <span class="op">.</span><span class="fu">attr</span>(<span class="st">"class"</span><span class="op">,</span> <span class="st">"hands-cover"</span>)</span>
<span id="cb1-693"><a href="#cb1-693" aria-hidden="true" tabindex="-1"></a>      <span class="op">.</span><span class="fu">attr</span>(<span class="st">"x"</span><span class="op">,</span> <span class="dv">0</span>)</span>
<span id="cb1-694"><a href="#cb1-694" aria-hidden="true" tabindex="-1"></a>      <span class="op">.</span><span class="fu">attr</span>(<span class="st">"y"</span><span class="op">,</span> <span class="dv">0</span>)</span>
<span id="cb1-695"><a href="#cb1-695" aria-hidden="true" tabindex="-1"></a>      <span class="op">.</span><span class="fu">attr</span>(<span class="st">"r"</span><span class="op">,</span> clockRadius <span class="op">/</span> <span class="dv">20</span>)<span class="op">;</span></span>
<span id="cb1-696"><a href="#cb1-696" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb1-697"><a href="#cb1-697" aria-hidden="true" tabindex="-1"></a>  <span class="kw">function</span> <span class="fu">moveHands</span>() {</span>
<span id="cb1-698"><a href="#cb1-698" aria-hidden="true" tabindex="-1"></a>    <span class="kw">const</span> sel <span class="op">=</span> d3</span>
<span id="cb1-699"><a href="#cb1-699" aria-hidden="true" tabindex="-1"></a>      <span class="op">.</span><span class="fu">select</span>(<span class="st">"#clock-hands-final"</span>)</span>
<span id="cb1-700"><a href="#cb1-700" aria-hidden="true" tabindex="-1"></a>      <span class="op">.</span><span class="fu">selectAll</span>(<span class="st">"line"</span>)</span>
<span id="cb1-701"><a href="#cb1-701" aria-hidden="true" tabindex="-1"></a>      <span class="op">.</span><span class="fu">data</span>(handData)</span>
<span id="cb1-702"><a href="#cb1-702" aria-hidden="true" tabindex="-1"></a>      <span class="op">.</span><span class="fu">transition</span>()<span class="op">;</span></span>
<span id="cb1-703"><a href="#cb1-703" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> (fancySecondsOFF) sel<span class="op">.</span><span class="fu">ease</span>(d3<span class="op">.</span><span class="at">easeElastic</span><span class="op">.</span><span class="fu">period</span>(<span class="fl">0.5</span>))<span class="op">;</span></span>
<span id="cb1-704"><a href="#cb1-704" aria-hidden="true" tabindex="-1"></a>    sel<span class="op">.</span><span class="fu">attr</span>(<span class="st">"transform"</span><span class="op">,</span> d <span class="kw">=&gt;</span> <span class="vs">`rotate(</span><span class="sc">${</span>d<span class="op">.</span><span class="fu">scale</span>(d<span class="op">.</span><span class="at">value</span>)<span class="sc">}</span><span class="vs">)`</span>)<span class="op">;</span></span>
<span id="cb1-705"><a href="#cb1-705" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb1-706"><a href="#cb1-706" aria-hidden="true" tabindex="-1"></a>  <span class="kw">function</span> <span class="fu">updateData</span>() {</span>
<span id="cb1-707"><a href="#cb1-707" aria-hidden="true" tabindex="-1"></a>    handData[<span class="dv">0</span>]<span class="op">.</span><span class="at">value</span> <span class="op">=</span> <span class="op">!</span>fancySecondsOFF <span class="op">?</span> <span class="bu">Math</span><span class="op">.</span><span class="fu">floor</span>(selectedExactN <span class="op">*</span> <span class="dv">10</span>) <span class="op">:</span> decTimeN[<span class="dv">0</span>]<span class="op">;</span></span>
<span id="cb1-708"><a href="#cb1-708" aria-hidden="true" tabindex="-1"></a>    handData[<span class="dv">1</span>]<span class="op">.</span><span class="at">value</span> <span class="op">=</span> <span class="op">!</span>fancySecondsOFF <span class="op">?</span> <span class="bu">Math</span><span class="op">.</span><span class="fu">floor</span>(selectedExactN <span class="op">*</span> <span class="dv">10</span> <span class="op">%</span> <span class="dv">1</span> <span class="op">*</span> <span class="dv">100</span>) <span class="op">:</span> decTimeN<span class="op">.</span><span class="fu">slice</span>(<span class="dv">2</span><span class="op">,</span> <span class="dv">4</span>)<span class="op">;</span></span>
<span id="cb1-709"><a href="#cb1-709" aria-hidden="true" tabindex="-1"></a>    handData[<span class="dv">2</span>]<span class="op">.</span><span class="at">value</span> <span class="op">=</span> <span class="op">!</span>fancySecondsOFF <span class="op">?</span> selectedExactN <span class="op">*</span> <span class="dv">10</span> <span class="op">%</span> <span class="dv">1</span> <span class="op">*</span> <span class="dv">100</span> <span class="op">%</span> <span class="dv">1</span> <span class="op">*</span> <span class="dv">100</span> <span class="op">:</span> decTimeN<span class="op">.</span><span class="fu">slice</span>(<span class="dv">4</span><span class="op">,</span> <span class="dv">6</span>)<span class="op">;</span></span>
<span id="cb1-710"><a href="#cb1-710" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb1-711"><a href="#cb1-711" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> svg <span class="op">=</span> d3</span>
<span id="cb1-712"><a href="#cb1-712" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">create</span>(<span class="st">"svg"</span>)</span>
<span id="cb1-713"><a href="#cb1-713" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">"viewBox"</span><span class="op">,</span> [<span class="dv">0</span><span class="op">,</span> <span class="dv">0</span><span class="op">,</span> w<span class="op">,</span> h])</span>
<span id="cb1-714"><a href="#cb1-714" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">style</span>(<span class="st">"max-width"</span><span class="op">,</span> <span class="vs">`</span><span class="sc">${</span>width <span class="op">/</span> <span class="fl">2.1</span><span class="sc">}</span><span class="vs">px`</span>)</span>
<span id="cb1-715"><a href="#cb1-715" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">"class"</span><span class="op">,</span> <span class="st">"clock-btm"</span>)</span>
<span id="cb1-716"><a href="#cb1-716" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">"id"</span><span class="op">,</span> <span class="st">"clock"</span>)<span class="op">;</span></span>
<span id="cb1-717"><a href="#cb1-717" aria-hidden="true" tabindex="-1"></a>  svg</span>
<span id="cb1-718"><a href="#cb1-718" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">append</span>(<span class="st">"text"</span>)</span>
<span id="cb1-719"><a href="#cb1-719" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">text</span>(<span class="vs">`-</span><span class="sc">${</span>decTimeN<span class="sc">}</span><span class="vs">-</span><span class="sc">${</span>selectedZone<span class="sc">}</span><span class="vs">`</span>)</span>
<span id="cb1-720"><a href="#cb1-720" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">"x"</span><span class="op">,</span> clockRadius <span class="op">+</span> margin)</span>
<span id="cb1-721"><a href="#cb1-721" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">"y"</span><span class="op">,</span> clockRadius <span class="op">*</span> <span class="dv">2</span> <span class="op">+</span> margin <span class="op">*</span> <span class="fl">1.975</span>)</span>
<span id="cb1-722"><a href="#cb1-722" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">"text-anchor"</span><span class="op">,</span> <span class="st">"middle"</span>)</span>
<span id="cb1-723"><a href="#cb1-723" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">"font-size"</span><span class="op">,</span> <span class="dv">32</span>)</span>
<span id="cb1-724"><a href="#cb1-724" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">"font-family"</span><span class="op">,</span> <span class="st">"monospace"</span>)<span class="op">;</span></span>
<span id="cb1-725"><a href="#cb1-725" aria-hidden="true" tabindex="-1"></a>  <span class="fu">drawClock</span>()<span class="op">;</span></span>
<span id="cb1-726"><a href="#cb1-726" aria-hidden="true" tabindex="-1"></a>  <span class="co">// Animation</span></span>
<span id="cb1-727"><a href="#cb1-727" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> interval <span class="op">=</span> <span class="pp">setInterval</span>(</span>
<span id="cb1-728"><a href="#cb1-728" aria-hidden="true" tabindex="-1"></a>    () <span class="kw">=&gt;</span> {</span>
<span id="cb1-729"><a href="#cb1-729" aria-hidden="true" tabindex="-1"></a>      <span class="fu">updateData</span>()<span class="op">;</span></span>
<span id="cb1-730"><a href="#cb1-730" aria-hidden="true" tabindex="-1"></a>      <span class="fu">moveHands</span>()<span class="op">;</span></span>
<span id="cb1-731"><a href="#cb1-731" aria-hidden="true" tabindex="-1"></a>    }<span class="op">,</span></span>
<span id="cb1-732"><a href="#cb1-732" aria-hidden="true" tabindex="-1"></a>    <span class="op">!</span>fancySecondsOFF <span class="op">?</span> <span class="dv">10</span> <span class="op">:</span> <span class="dv">864</span></span>
<span id="cb1-733"><a href="#cb1-733" aria-hidden="true" tabindex="-1"></a>  )<span class="op">;</span></span>
<span id="cb1-734"><a href="#cb1-734" aria-hidden="true" tabindex="-1"></a>  invalidation<span class="op">.</span><span class="fu">then</span>(() <span class="kw">=&gt;</span> <span class="pp">clearInterval</span>(interval))<span class="op">;</span></span>
<span id="cb1-735"><a href="#cb1-735" aria-hidden="true" tabindex="-1"></a>  <span class="cf">return</span> svg<span class="op">.</span><span class="fu">node</span>()<span class="op">;</span></span>
<span id="cb1-736"><a href="#cb1-736" aria-hidden="true" tabindex="-1"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<div>
<div id="ojs-cell-1-1" data-nodetype="declaration">

</div>
</div>
</div>
<div class="cell-output cell-output-display">
<div>
<div id="ojs-cell-1-2" data-nodetype="declaration">

</div>
</div>
</div>
<div class="cell-output cell-output-display">
<div>
<div id="ojs-cell-1-3" data-nodetype="declaration">

</div>
</div>
</div>
<div class="cell-output cell-output-display">
<div>
<div id="ojs-cell-1-4" data-nodetype="declaration">

</div>
</div>
</div>
<div class="cell-output cell-output-display">
<div>
<div id="ojs-cell-1-5" data-nodetype="declaration">

</div>
</div>
</div>
<div class="cell-output cell-output-display">
<div>
<div id="ojs-cell-1-6" data-nodetype="declaration">

</div>
</div>
</div>
</div>
<p>The plot to the lower left of the map🗺️visualizes the night (blue) and day (yellow) time of day (x-axis) throughout every day of the year (y-axis) at the <a href="https://en.wikipedia.org/wiki/Latitude#:~:text=a%20geographic%20coordinate%20that%20specifies%20the%20north%2Dsouth%20position%20of%20a%20point%20on%20the%20surface%20of%20the%20Earth">latitude</a> of the red⭕️circle on the map🗺️. The vertical↕position of the red<font color="red">—</font>line (time of day) and the↔︎️horizontal position of the red🔴dot (day of the year) on the plot control the🌐globes above and to the right of the plot.</p>
</section>
<section id="zone" class="level4">
<h4 class="anchored" data-anchor-id="zone">Zone</h4>
<p>Drag the red⭕️circle across the <a href="https://en.wikipedia.org/wiki/Meridian_%28geography%29#:~:text=words%2C%20it%20is-,a%20line%20of%20longitude,-.%20The%20position%20of">meridians</a> (vertical↕gray lines) on the map🗺️to see how changing time zones affects the time. Only the first digit of the Dec times shown above, the <span class="under tool" data-bs-toggle="tooltip" data-bs-title="a tenth of a day">deciday</span>, varies across time zones, because the 10 Dec time zones, numbered 0 through 9 on the map🗺️, are each 1 <span class="under tool" data-bs-toggle="tooltip" data-bs-title="a tenth of a turn">deci<a href="https://en.wikipedia.org/wiki/Turn_%28angle%29#:~:text=a%20unit%20of%20plane%20angle%20measurement%20equal%20to%202%CF%80%C2%A0radians%2C%20360%C2%A0degrees">turn</a></span> (<a href="https://en.wikipedia.org/wiki/Turn_%28angle%29#:~:text=the%20Greek%20letter,to%20one%20turn">dt</a>) wide. Simply put, a <span class="under tool" data-bs-toggle="tooltip" data-bs-title="a tenth of a turn">deciturn</span> of longitude translates into a <span class="under tool" data-bs-toggle="tooltip" data-bs-title="a tenth of a day">deciday</span> of time.</p>
<p>The leftmost vertical↕line on the map🗺️is <a href="https://en.wikipedia.org/wiki/18th_meridian_west#:~:text=a%20line%20of%20longitude%20that%20extends%20from%20the%20North%20Pole%20across%20the%20Arctic%20Ocean%2C%20Greenland%2C%20Iceland%2C%20the%20Atlantic%20Ocean%2C%20the%20Canary%20Islands%2C%20the%20Southern%20Ocean%2C%20and%20Antarctica%20to%20the%20South%20Pole">Meridian 0</a>, the Dec <a href="https://en.wikipedia.org/wiki/International_Date_Line#:~:text=the%20line%20between%20the%20South%20and%20North%20Poles%20that%20is%20the%20boundary%20between%20one%20calendar%20day%20and%20the%20next">International Date Line</a> and <a href="https://en.wikipedia.org/wiki/Prime_meridian#:~:text=an%20arbitrarily%2Dchosen%20meridian%20%28a%20line%20of%20longitude%29%20in%20a%20geographic%20coordinate%20system%20at%20which%20longitude%20is%20defined%20to%20be%200%C2%B0">prime meridian</a>, which cuts across the Atlantic Ocean through Iceland🇮🇸just West of Africa🌍and is the boundary between Zone 9 and Zone 0, the rightmost and leftmost Dec time zones on the map🗺️, respectively. Arranging Dec time zones from 0 to 9 yields a <a href="https://en.wikipedia.org/wiki/World_map#:~:text=south%2Dup%20map-,Pacific%2Dcentric%20map,-(more%20commonly%20used)">Pacific-centric</a> map🗺️.</p>
<p>While only positive Dec time zones are shown on the map🗺️, every Dec time zone can also be expressed as a negative number. Each pair of time zone numbers produces the same Dec time, but result in <a href="../../dec/date">Dec dates</a>🗓️that are 1 day apart. Negative time zone numbers can be useful for getting <a href="../../dec/date">Dec dates</a>🗓️to match <a href="https://en.wikipedia.org/wiki/Gregorian_calendar#:~:text=the%20calendar%20used%20in%20most%20parts%20of%20the%20world">Gregorian calendar</a> dates🗓️with negative <a href="https://en.wikipedia.org/wiki/UTC_offset#:~:text=the%20difference%20in%20hours%20and%20minutes%20between%20Coordinated%20Universal%20Time%20(UTC)%20and%20the%20standard%20time%20at%20a%20particular%20place">UTC offsets</a>.</p>
<p>There are <a href="https://en.wikipedia.org/wiki/List_of_UTC_offsets">37 UTC offsets</a>, but only 10 Dec time zones. Conversion between Dec time zones and UTC offsets is inexact, because UTC offsets depend on geographic and political boundaries, whereas Dec time zones are determined solely by longitude. If you know your longitude in degrees (°) or <span class="under tool" data-bs-toggle="tooltip" data-bs-title="hundredths of a turn">centi<a href="https://en.wikipedia.org/wiki/Turn_%28angle%29#:~:text=a%20unit%20of%20plane%20angle%20measurement%20equal%20to%202%CF%80%C2%A0radians%2C%20360%C2%A0degrees">turns</a></span> (<a href="https://en.wikipedia.org/wiki/Turn_%28angle%29#:~:text=the%20Greek%20letter,to%20one%20turn">ct</a>), you can look up your Dec time zone (TZ) in the table below.</p>
<table class="table">
<colgroup>
<col style="width: 12%">
<col style="width: 12%">
<col style="width: 12%">
<col style="width: 12%">
<col style="width: 12%">
<col style="width: 12%">
<col style="width: 12%">
<col style="width: 12%">
</colgroup>
<thead>
<tr class="header">
<th style="text-align: center;">TZ<br>+</th>
<th style="text-align: center;">TZ<br>-</th>
<th style="text-align: center;">Start<br>°</th>
<th style="text-align: center;">Mid<br>°</th>
<th style="text-align: center;">End<br>°</th>
<th style="text-align: center;">Start<br><span class="math inline">\(ct\)</span></th>
<th style="text-align: center;">Mid<br><span class="math inline">\(ct\)</span></th>
<th style="text-align: center;">End<br><span class="math inline">\(ct\)</span></th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: center;">9</td>
<td style="text-align: center;">-1</td>
<td style="text-align: center;">-54</td>
<td style="text-align: center;">-36</td>
<td style="text-align: center;">-18</td>
<td style="text-align: center;">90</td>
<td style="text-align: center;">95</td>
<td style="text-align: center;">100</td>
</tr>
<tr class="even">
<td style="text-align: center;">8</td>
<td style="text-align: center;">-2</td>
<td style="text-align: center;">-90</td>
<td style="text-align: center;">-72</td>
<td style="text-align: center;">-54</td>
<td style="text-align: center;">80</td>
<td style="text-align: center;">85</td>
<td style="text-align: center;">90</td>
</tr>
<tr class="odd">
<td style="text-align: center;">7</td>
<td style="text-align: center;">-3</td>
<td style="text-align: center;">-126</td>
<td style="text-align: center;">-108</td>
<td style="text-align: center;">-90</td>
<td style="text-align: center;">70</td>
<td style="text-align: center;">75</td>
<td style="text-align: center;">80</td>
</tr>
<tr class="even">
<td style="text-align: center;">6</td>
<td style="text-align: center;">-4</td>
<td style="text-align: center;">-162</td>
<td style="text-align: center;">-144</td>
<td style="text-align: center;">-126</td>
<td style="text-align: center;">60</td>
<td style="text-align: center;">65</td>
<td style="text-align: center;">70</td>
</tr>
<tr class="odd">
<td style="text-align: center;">5</td>
<td style="text-align: center;">-5</td>
<td style="text-align: center;">162</td>
<td style="text-align: center;">180</td>
<td style="text-align: center;">-162</td>
<td style="text-align: center;">50</td>
<td style="text-align: center;">55</td>
<td style="text-align: center;">60</td>
</tr>
<tr class="even">
<td style="text-align: center;">4</td>
<td style="text-align: center;">-6</td>
<td style="text-align: center;">126</td>
<td style="text-align: center;">144</td>
<td style="text-align: center;">162</td>
<td style="text-align: center;">40</td>
<td style="text-align: center;">45</td>
<td style="text-align: center;">50</td>
</tr>
<tr class="odd">
<td style="text-align: center;">3</td>
<td style="text-align: center;">-7</td>
<td style="text-align: center;">90</td>
<td style="text-align: center;">108</td>
<td style="text-align: center;">126</td>
<td style="text-align: center;">30</td>
<td style="text-align: center;">35</td>
<td style="text-align: center;">40</td>
</tr>
<tr class="even">
<td style="text-align: center;">2</td>
<td style="text-align: center;">-8</td>
<td style="text-align: center;">54</td>
<td style="text-align: center;">72</td>
<td style="text-align: center;">90</td>
<td style="text-align: center;">20</td>
<td style="text-align: center;">25</td>
<td style="text-align: center;">30</td>
</tr>
<tr class="odd">
<td style="text-align: center;">1</td>
<td style="text-align: center;">-9</td>
<td style="text-align: center;">18</td>
<td style="text-align: center;">36</td>
<td style="text-align: center;">54</td>
<td style="text-align: center;">10</td>
<td style="text-align: center;">15</td>
<td style="text-align: center;">20</td>
</tr>
<tr class="even">
<td style="text-align: center;">0</td>
<td style="text-align: center;">-10</td>
<td style="text-align: center;">-18</td>
<td style="text-align: center;">0</td>
<td style="text-align: center;">18</td>
<td style="text-align: center;">0</td>
<td style="text-align: center;">5</td>
<td style="text-align: center;">10</td>
</tr>
</tbody>
</table>
<p>Dec times in Zone 0 and 5 can be directly converted to and from UTC times with an offset of 0 and 12 <span class="teal">hours</span>, respectively. The other Dec time zones will differ from the closest UTC time by 8.<span class="over">3</span>, 16.<span class="over">6</span>, 25, 33.<span class="over">3</span>, 41.<span class="over">6</span> or 50 <span class="under tool" data-bs-toggle="tooltip" data-bs-title="thousands of a day">millidays</span>. To find the difference δ, convert the UTC offset <span class="teal">hours</span> <span class="teal">o<sub>H</sub></span> and <span class="olive">minutes</span> <span class="olive">o<sub>M</sub></span> into <span class="under tool" data-bs-toggle="tooltip" data-bs-title="tenths of a turn">deci<a href="https://en.wikipedia.org/wiki/Turn_%28angle%29#:~:text=a%20unit%20of%20plane%20angle%20measurement%20equal%20to%202%CF%80%C2%A0radians%2C%20360%C2%A0degrees">turns</a></span> of the longitude λ and then subtract the Dec zone number <span class="lime">z</span>:</p>
<p><span class="math display">\[\lambda = o_H \div 2.4 + o_M \div 144\]</span></p>
<p><span class="math display">\[z = \lfloor\lambda + 1 \div 2\rfloor\]</span></p>
<p><span class="math display">\[\delta = \lambda - z\]</span></p>
<p>We can avoid dealing with the time zone difference by shifting the time zone so that we always convert between Zone 0 and <a href="https://en.wikipedia.org/wiki/List_of_UTC_offsets#UTC+00:00,_Z">UTC+00:00</a> or Zone 5 and <a href="https://en.wikipedia.org/wiki/List_of_UTC_offsets#UTC+12:00,_M">UTC+12:00</a>. To obtain the Zone 0 time, we evaluate a Dec time as a math expression, add 10, and get the remainder after dividing by 10 to make sure the result is less than 10 <a href="https://en.wikipedia.org/wiki/Decimal_time#:~:text=dividing%20the%20day%20into%2010%20decidays" class="under tool" data-bs-toggle="tooltip" data-bs-title="tenths of a day">decidays</a>: (<span class="cyan"><span><span id="ojs-element-id-5"></span></span></span> <span><span id="ojs-element-id-6"></span></span> <span class="lime"><span><span id="ojs-element-id-7"></span></span></span> + 10) <a href="https://en.wikipedia.org/wiki/Modulo#:~:text=returns%20the%20remainder">mod</a> 10 = <span class="cyan"><span><span id="ojs-element-id-8"></span></span></span>.</p>
<div class="callout callout-style-default callout-warning callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Bad Pun Alert
</div>
</div>
<div class="callout-body-container callout-body">
<p>Sorry if reading this takes a long <span class="cyan">time</span>; I hope you don’t <span class="lime">zone</span> out!</p>
</div>
</div>
</section>
<section id="unit" class="level4">
<h4 class="anchored" data-anchor-id="unit">Unit</h4>
<p>Dec uses <a href="https://en.wikipedia.org/wiki/Metric_prefix#:~:text=a%20unit%20prefix%20that%20precedes%20a%20basic%20unit%20of%20measure%20to%20indicate%20a%20multiple%20or%20submultiple%20of%20the%20unit">metric prefixes</a> to create <a href="https://en.wikipedia.org/wiki/Multiple_%28mathematics%29#Submultiple:~:text=of%20%22a%20being-,a%20unit%20fraction,-of%20b%22%20">submultiples</a> of a day that can naturally be combined together into a single <a href="https://en.wikipedia.org/wiki/Decimal#:~:text=system%20for%20denoting%20integer%20and%20non%2Dinteger%20numbers">decimal</a> number. Conversion between decimal units is as simple as moving↔︎️or removing❌the <a href="https://en.wikipedia.org/wiki/Decimal_separator#:~:text=a%20symbol%20that%20separates%20the%20integer%20part%20from%20the%20fractional%20part%20of%20a%20number">decimal separator</a>. In contrast, an <span class="teal">hh</span>:<span class="olive">mm</span>:<span class="purple">ss</span> time is a <a href="https://en.wikipedia.org/wiki/Mixed_radix#:~:text=non%2Dstandard%20positional%20numeral%20systems%20in%20which%20the%20numerical%20base%20varies%20from%20position%20to%20position">mixed-radix</a> number, where <span class="teal">hh</span> is the <a href="https://en.wikipedia.org/wiki/List_of_numeral_systems#:~:text=12-,Duodecimal,-%2C%20dozenal">base-12</a> or <a href="https://en.wikipedia.org/wiki/List_of_numeral_systems#:~:text=24-,Quadravigesimal,-%5B48%5D">base-24</a> <span class="teal">hour</span>, <span class="olive">mm</span> is the <a href="https://en.wikipedia.org/wiki/List_of_numeral_systems#:~:text=60-,Sexagesimal,-Babylonian%20numerals%20and">base-60</a> <span class="olive">minute</span>, and <span class="purple">ss</span> is the base-60 <span class="purple">second</span>.</p>
<table class="table">
<colgroup>
<col style="width: 30%">
<col style="width: 15%">
<col style="width: 18%">
<col style="width: 36%">
</colgroup>
<thead>
<tr class="header">
<th>Prefix</th>
<th>Power</th>
<th>Day</th>
<th><span class="teal">hh</span>:<span class="olive">mm</span>:<span class="purple">ss</span>.<span class="purple">sss</span></th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td></td>
<td>0</td>
<td>1</td>
<td>24:00:00.000</td>
</tr>
<tr class="even">
<td>deci</td>
<td>-1</td>
<td>.1</td>
<td>02:24:00.000</td>
</tr>
<tr class="odd">
<td>centi</td>
<td>-2</td>
<td>.01</td>
<td>00:14:24.000</td>
</tr>
<tr class="even">
<td>milli</td>
<td>-3</td>
<td>.001</td>
<td>00:01:26.400</td>
</tr>
<tr class="odd">
<td>decimilli</td>
<td>-4</td>
<td>.0001</td>
<td>00:00:08.640</td>
</tr>
<tr class="even">
<td>centimilli</td>
<td>-5</td>
<td>.00001</td>
<td>00:00:00.864</td>
</tr>
</tbody>
</table>
<p>To convert the <span class="teal">hour</span> <span class="teal">h</span>, <span class="olive">minute</span> <span class="olive">m</span>, and <span class="purple">second</span> <span class="purple">s</span> into the <a href="https://en.wikipedia.org/wiki/Decimal_time#:~:text=dividing%20the%20day%20into%2010%20decidays" class="under tool" data-bs-toggle="tooltip" data-bs-title="a tenth of a day">deciday</a> <span class="cyan">d</span>, Dec uses the following equation: <span class="cyan">d</span> = <span class="teal">h</span> ÷ 2.4 + <span class="olive">m</span> ÷ 144 + <span class="purple">s</span> ÷ 8640. The current equation values in Zone <span class="lime"><span><span id="ojs-element-id-9"></span></span></span> are: <span class="cyan"><span><span id="ojs-element-id-10"></span></span></span> = <span class="teal"><span><span id="ojs-element-id-11"></span></span></span> ÷ 2.4 + <span class="olive"><span><span id="ojs-element-id-12"></span></span></span> ÷ 144 + <span class="purple"><span><span id="ojs-element-id-13"></span></span></span> ÷ 8640. Inversely, we can convert <a href="https://en.wikipedia.org/wiki/Decimal_time#:~:text=dividing%20the%20day%20into%2010%20decidays" class="under tool" data-bs-toggle="tooltip" data-bs-title="tenths of a day">decidays</a> into <span class="teal">hours</span>: <span class="teal">h</span> = <span class="cyan">d</span> × 2.4, <span class="olive">minutes</span>: <span class="olive">m</span> = <span class="teal">h</span> <a href="https://en.wikipedia.org/wiki/Modulo#:~:text=returns%20the%20remainder">mod</a> 1 × 60, and <span class="purple">seconds</span>: <span class="purple">s</span> = <span class="olive">m</span> <a href="https://en.wikipedia.org/wiki/Modulo#:~:text=returns%20the%20remainder">mod</a> 1 × 60.</p>
<p>Instead of dealing with <span class="teal">hours</span>, <span class="olive">minutes</span>, and <span class="purple">seconds</span>, we can convert the <a href="https://en.wikipedia.org/wiki/Unix_time#:~:text=the%20number%20of%20non%2Dleap%20seconds%20that%20have%20elapsed%20since%2000%3A00%3A00%20UTC%20on%201%C2%A0January%201970">UNIX timestamp</a> <span class="purple">u</span> into the Dec time <span class="cyan">d</span>+<span class="lime">0</span>. First, we divide <span class="purple">u</span> by 86400 to convert seconds to days, then isolate the <a href="https://en.wikipedia.org/wiki/Fractional_part#:~:text=the%20excess%20beyond%20that%20number%27s%20integer%20part">decimal part</a> of the <a href="https://en.wikipedia.org/wiki/Quotient#:~:text=a%20quantity%20produced%20by%20the%20division%20of%20two%20numbers">quotient</a>, and finally multiply by 10: <span class="cyan">d</span> + <span class="lime">0</span> = <span class="purple">u</span> ÷ 86400 <a href="https://en.wikipedia.org/wiki/Modulo#:~:text=returns%20the%20remainder">mod</a> 1 × 10. The current values in this equation are <span class="cyan"><span><span id="ojs-element-id-14"></span></span></span> + <span class="lime">0</span> = <span class="purple"><span><span id="ojs-element-id-15"></span></span></span> ÷ 86400 <a href="https://en.wikipedia.org/wiki/Modulo#:~:text=returns%20the%20remainder">mod</a> 1 × 10.</p>
<p>The concept of measuring time in decimal days is not novel. In the late 1700s, the <a href="https://en.wikipedia.org/wiki/French_Republican_calendar#:~:text=a%20calendar%20created%20and%20implemented%20during%20the%20French%20Revolution">French Republican calendar</a> time system referred to <a href="https://en.wikipedia.org/wiki/Decimal_time#:~:text=dividing%20the%20day%20into%2010%20decidays" class="under tool" data-bs-toggle="tooltip" data-bs-title="tenths of a day">decidays</a> as decimal <span class="teal">hours</span>, <span class="under tool" data-bs-toggle="tooltip" data-bs-title="hundredths of a day">centidays</span> as <a href="https://en.wikipedia.org/wiki/Decimal_time#:~:text=into%20tenths%2C%20or-,d%C3%A9cimes,-%2C%20instead%20of%20minutes">décimes</a>, <span class="under tool" data-bs-toggle="tooltip" data-bs-title="thousandths of a day">millidays</span> as decimal <span class="olive">minutes</span>, and <span class="under tool" data-bs-toggle="tooltip" data-bs-title="hundred thousandths of a day">centimillidays</span> as decimal <span class="purple">seconds</span>. Similarly, <a href="https://en.wikipedia.org/wiki/Swatch_Internet_Time#:~:text=a%20decimal%20time%20system%20introduced%20in%201998%20by%20the%20Swatch%20corporation">Swatch Internet Time</a>, a <a href="https://en.wikipedia.org/wiki/Decimal_time#:~:text=the%20representation%20of%20the%20time%20of%20day%20using%20units%20which%20are%20decimally%20related">decimal time</a> system introduced in 1998, uses the term “.beats” for <span class="under tool" data-bs-toggle="tooltip" data-bs-title="thousandths of a day">millidays</span>.</p>
<p>Swatch Internet Time differs from Dec in that it <a href="https://en.wikipedia.org/wiki/Swatch_Internet_Time#Calculation_from_UTC+1:~:text=There%20are%20no%20time%20zones%20in%20Swatch%20Internet%20Time">has no time zones</a> and is obtained from the <a href="https://en.wikipedia.org/wiki/Swatch_Internet_Time#Calculation_from_UTC+1:~:text=The%20formula%20for%20calculating%20the%20time%20in%20.beats%20from%20UTC%2B1"><span class="teal">hours</span>, <span class="olive">minutes</span>, and <span class="purple">seconds</span></a> of <a href="https://en.wikipedia.org/wiki/UTC%2B01:00#:~:text=a%20time%20offset%20from%20UTC%20of%20%2B01%3A00">UTC+01:00</a>. In contrast, the major innovations described in this article are the Dec time zone system and the simple equation for obtaining the Dec time in Zone 0 from a UNIX timestamp, but Dec has much more to offer than <a href="https://en.wikipedia.org/wiki/Decimal_time#:~:text=dividing%20the%20day%20into%2010%20decidays" class="under tool" data-bs-toggle="tooltip" data-bs-title="a tenth of a day">deciday</a> times and zones.</p>
</section>
<section id="next" class="level4">
<h4 class="anchored" data-anchor-id="next">Next</h4>
<p>The next article in the <a href="../../dec">Dec section</a> of my site compares Dec to the <a href="https://en.wikipedia.org/wiki/ISO_8601#:~:text=an%20international%20standard%20covering%20the%20worldwide%20exchange%20and%20communication%20of%20date%20and%20time%2Drelated%20data">ISO 8601</a> international standard for dates and times. Like ISO 8601, Dec allows for <a href="https://en.wikipedia.org/wiki/ISO_8601#Combined_date_and_time_representations">combined date and time representations</a> that can be paired up to express <a href="https://en.wikipedia.org/wiki/ISO_8601#Time_intervals:~:text=the%20intervening%20time%20between%20two%20time%20points">time intervals</a>. In Dec, the combination of a date and time is called a snap🫰and a time interval expressed as a pair of snaps is called a span🌈.</p>
<p>My <a href="../../dec/iso">ISO 8601 article</a> is unique because it avoids the use of Observable in favor of leveraging <a href="https://jupyter.org">Jupyter</a> support in Quarto to make the code underlying Dec available in multiple programming languages. Observable is a great visualization tool but does not translate well into Jupyter notebooks. After the next article, I return to the use of Observable in my Dec <a href="../../dec/span">snap</a>🫰and <a href="../../dec/span">span</a>🌈articles.</p>
<div class="cell" data-layout-align="default">
<div class="cell-output-display">
<div id="timenav">
<div>
<pre class="mermaid mermaid-js" data-label="timenav">%%{init: {'theme': 'default', 'themeVariables': { 'fontSize': '32px'}}}%%
flowchart LR
   A[Dec]--&gt;B[date]--&gt;C[time]--&gt;D[snap]--&gt;E[span]
   click A "/dec"
   click B "/dec/date"
   click C "/dec/time"
   click D "/dec/snap"
   click E "/dec/span"
</pre>
</div>
</div>
</div>
</div>
</section>
<section id="cite" class="level4">
<h4 class="anchored" data-anchor-id="cite">Cite</h4>
<p>Please spread the good word about Dec using the citation information at the bottom of this article. You may also want to cite the Observable notebooks that I adapted into the clock🕓, bar📊chart, map🗺️, and daylight☀️plot visualizations in this article or the 2014 blog post which proposed a system of 20 decimal time zones, each 5 <span class="under tool" data-bs-toggle="tooltip" data-bs-title="hundredths of a day">centidays</span> wide, based on the <a href="https://en.wikipedia.org/wiki/Prime_meridian_(Greenwich)#:~:text=a%20geographical%20reference%20line%20that%20passes%20through%20the%20Royal%20Observatory%2C%20Greenwich%2C%20in%20London%2C%20England">Greenwich Meridian</a>:</p>
<ul>
<li><a href="https://www.2x2.graphics">Pearson, Tom</a>. <span class="tool" data-bs-toggle="tooltip" data-bs-title="2013-07-03"><u><span class="yellow">2013</span>+<span class="cyan">124</span></u></span>. “Simple D3 clock.” <span class="yellow"><span><span id="ojs-element-id-16"></span></span></span>+<span class="cyan"><span><span id="ojs-element-id-17"></span></span></span>. <a href="https://observablehq.com/@d3/simple-clock" class="uri">https://observablehq.com/@d3/simple-clock</a>.</li>
<li><a href="https://fheyen.github.io">Heyen, Frank</a>. <span class="tool" data-bs-toggle="tooltip" data-bs-title="2021-11-02"><u><span class="yellow">2021</span>+<span class="cyan">246</span></u></span>. “BarChart Clock.” <span class="yellow"><span><span id="ojs-element-id-18"></span></span></span>+<span class="cyan"><span><span id="ojs-element-id-19"></span></span></span>. <a href="https://observablehq.com/@fheyen/barchart-clock" class="uri">https://observablehq.com/@fheyen/barchart-clock</a>.</li>
<li><a href="https://enjalot.github.io">Johnson, Ian</a>. <span class="tool" data-bs-toggle="tooltip" data-bs-title="2021-05-30"><u><span class="yellow">2021</span>+<span class="cyan">090</span></u></span>. “Draggable World Map Coordinates Input.” <span class="yellow"><span><span id="ojs-element-id-20"></span></span></span>+<span class="cyan"><span><span id="ojs-element-id-21"></span></span></span>. <a href="https://observablehq.com/@enjalot/draggable-world-map-coordinates-input" class="uri">https://observablehq.com/@enjalot/draggable-world-map-coordinates-input</a>.</li>
<li><a href="https://www.danbridges.org">Bridges, Dan</a>. <span class="tool" data-bs-toggle="tooltip" data-bs-title="2022-01-06"><u><span class="yellow">2021</span>+<span class="cyan">311</span></u></span>. “Visualizing Seasonal Daylight.” <span class="yellow"><span><span id="ojs-element-id-22"></span></span></span>+<span class="cyan"><span><span id="ojs-element-id-23"></span></span></span>. <a href="https://observablehq.com/@dbridges/visualizing-seasonal-daylight" class="uri">https://observablehq.com/@dbridges/visualizing-seasonal-daylight</a>.</li>
<li><a href="https://www.brinckerhoff.org">Clements, John</a>. <span class="tool" data-bs-toggle="tooltip" data-bs-title="2021-05-31"><u><span class="yellow">2014</span>+<span class="cyan">091</span></u></span>, “Decimal Time Zones.” <span class="yellow"><span><span id="ojs-element-id-24"></span></span></span>+<span class="cyan"><span><span id="ojs-element-id-25"></span></span></span>. <a href="https://www.brinckerhoff.org/blog/2014/05/31/decimal-time-zones" class="uri">https://www.brinckerhoff.org/blog/2014/05/31/decimal-time-zones</a>.</li>
</ul>
<div class="cell hidden">
<div class="sourceCode cell-code hidden" id="cb2" data-startfrom="832" data-source-offset="-0"><pre class="sourceCode js code-with-copy"><code class="sourceCode javascript" style="counter-reset: source-line 831;"><span id="cb2-832"><a href="#cb2-832" aria-hidden="true" tabindex="-1"></a><span class="kw">function</span> <span class="fu">unix2dote</span>(unix<span class="op">,</span> zone<span class="op">,</span> offset <span class="op">=</span> <span class="dv">719468</span>) {</span>
<span id="cb2-833"><a href="#cb2-833" aria-hidden="true" tabindex="-1"></a>  <span class="cf">return</span> [(unix <span class="op">??</span> <span class="bu">Date</span><span class="op">.</span><span class="fu">now</span>()) <span class="op">/</span> <span class="dv">86400000</span> <span class="op">+</span> (</span>
<span id="cb2-834"><a href="#cb2-834" aria-hidden="true" tabindex="-1"></a>    zone <span class="op">=</span> zone <span class="op">??</span> <span class="op">-</span><span class="bu">Math</span><span class="op">.</span><span class="fu">round</span>(</span>
<span id="cb2-835"><a href="#cb2-835" aria-hidden="true" tabindex="-1"></a>      (<span class="kw">new</span> <span class="bu">Date</span>)<span class="op">.</span><span class="fu">getTimezoneOffset</span>() <span class="op">/</span> <span class="dv">144</span>)</span>
<span id="cb2-836"><a href="#cb2-836" aria-hidden="true" tabindex="-1"></a>    ) <span class="op">/</span> <span class="dv">10</span> <span class="op">+</span> offset<span class="op">,</span> zone]</span>
<span id="cb2-837"><a href="#cb2-837" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb2-838"><a href="#cb2-838" aria-hidden="true" tabindex="-1"></a><span class="kw">function</span> <span class="fu">unix2dote1</span>(unix<span class="op">,</span> zone<span class="op">,</span> offset <span class="op">=</span> <span class="dv">719468</span>) {</span>
<span id="cb2-839"><a href="#cb2-839" aria-hidden="true" tabindex="-1"></a>  <span class="cf">return</span> [</span>
<span id="cb2-840"><a href="#cb2-840" aria-hidden="true" tabindex="-1"></a>    (unix <span class="op">??</span> <span class="bu">Date</span><span class="op">.</span><span class="fu">now</span>()) <span class="op">/</span> <span class="dv">86400000</span></span>
<span id="cb2-841"><a href="#cb2-841" aria-hidden="true" tabindex="-1"></a>    <span class="op">+</span> (zone <span class="op">=</span> zone <span class="op">??</span> (<span class="dv">10</span> <span class="op">-</span> <span class="bu">Math</span><span class="op">.</span><span class="fu">round</span>(</span>
<span id="cb2-842"><a href="#cb2-842" aria-hidden="true" tabindex="-1"></a>        (<span class="kw">new</span> <span class="bu">Date</span>)<span class="op">.</span><span class="fu">getTimezoneOffset</span>() <span class="op">/</span> <span class="dv">144</span>)) <span class="op">%</span> <span class="dv">10</span></span>
<span id="cb2-843"><a href="#cb2-843" aria-hidden="true" tabindex="-1"></a>      ) <span class="op">/</span> <span class="dv">10</span> <span class="op">+</span> offset<span class="op">,</span> zone]</span>
<span id="cb2-844"><a href="#cb2-844" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb2-845"><a href="#cb2-845" aria-hidden="true" tabindex="-1"></a><span class="kw">function</span> <span class="fu">dote2date</span>(dote<span class="op">,</span> zone <span class="op">=</span> <span class="dv">0</span>) {</span>
<span id="cb2-846"><a href="#cb2-846" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> cote <span class="op">=</span> <span class="bu">Math</span><span class="op">.</span><span class="fu">floor</span>((</span>
<span id="cb2-847"><a href="#cb2-847" aria-hidden="true" tabindex="-1"></a>      dote <span class="op">&gt;=</span> <span class="dv">0</span> <span class="op">?</span> dote</span>
<span id="cb2-848"><a href="#cb2-848" aria-hidden="true" tabindex="-1"></a>      <span class="op">:</span> dote <span class="op">-</span> <span class="dv">146096</span></span>
<span id="cb2-849"><a href="#cb2-849" aria-hidden="true" tabindex="-1"></a>    ) <span class="op">/</span> <span class="dv">146097</span>)<span class="op">,</span></span>
<span id="cb2-850"><a href="#cb2-850" aria-hidden="true" tabindex="-1"></a>  dotc <span class="op">=</span> dote <span class="op">-</span> cote <span class="op">*</span> <span class="dv">146097</span><span class="op">,</span></span>
<span id="cb2-851"><a href="#cb2-851" aria-hidden="true" tabindex="-1"></a>  yotc <span class="op">=</span> <span class="bu">Math</span><span class="op">.</span><span class="fu">floor</span>((dotc</span>
<span id="cb2-852"><a href="#cb2-852" aria-hidden="true" tabindex="-1"></a>    <span class="op">-</span> <span class="bu">Math</span><span class="op">.</span><span class="fu">floor</span>(dotc <span class="op">/</span> <span class="dv">1460</span>)</span>
<span id="cb2-853"><a href="#cb2-853" aria-hidden="true" tabindex="-1"></a>    <span class="op">+</span> <span class="bu">Math</span><span class="op">.</span><span class="fu">floor</span>(dotc <span class="op">/</span> <span class="dv">36524</span>)</span>
<span id="cb2-854"><a href="#cb2-854" aria-hidden="true" tabindex="-1"></a>    <span class="op">-</span> <span class="bu">Math</span><span class="op">.</span><span class="fu">floor</span>(dotc <span class="op">/</span> <span class="dv">146096</span>)</span>
<span id="cb2-855"><a href="#cb2-855" aria-hidden="true" tabindex="-1"></a>  ) <span class="op">/</span> <span class="dv">365</span>)<span class="op">;</span></span>
<span id="cb2-856"><a href="#cb2-856" aria-hidden="true" tabindex="-1"></a>  <span class="cf">return</span> [</span>
<span id="cb2-857"><a href="#cb2-857" aria-hidden="true" tabindex="-1"></a>    yotc <span class="op">+</span> cote <span class="op">*</span> <span class="dv">400</span><span class="op">,</span></span>
<span id="cb2-858"><a href="#cb2-858" aria-hidden="true" tabindex="-1"></a>    dotc <span class="op">-</span> (yotc <span class="op">*</span> <span class="dv">365</span></span>
<span id="cb2-859"><a href="#cb2-859" aria-hidden="true" tabindex="-1"></a>      <span class="op">+</span> <span class="bu">Math</span><span class="op">.</span><span class="fu">floor</span>(yotc <span class="op">/</span> <span class="dv">4</span>)</span>
<span id="cb2-860"><a href="#cb2-860" aria-hidden="true" tabindex="-1"></a>      <span class="op">-</span> <span class="bu">Math</span><span class="op">.</span><span class="fu">floor</span>(yotc <span class="op">/</span> <span class="dv">100</span>)</span>
<span id="cb2-861"><a href="#cb2-861" aria-hidden="true" tabindex="-1"></a>  )<span class="op">,</span> zone]}</span>
<span id="cb2-862"><a href="#cb2-862" aria-hidden="true" tabindex="-1"></a>dz <span class="op">=</span> <span class="fu">unix2dote</span>(now)</span>
<span id="cb2-863"><a href="#cb2-863" aria-hidden="true" tabindex="-1"></a>ydz <span class="op">=</span> <span class="fu">dote2date</span>(<span class="op">...</span>dz)</span>
<span id="cb2-864"><a href="#cb2-864" aria-hidden="true" tabindex="-1"></a>decYear <span class="op">=</span> ydz[<span class="dv">0</span>]<span class="op">.</span><span class="fu">toString</span>()<span class="op">.</span><span class="fu">padStart</span>(<span class="dv">4</span><span class="op">,</span> <span class="st">"0"</span>)</span>
<span id="cb2-865"><a href="#cb2-865" aria-hidden="true" tabindex="-1"></a>decDate <span class="op">=</span> <span class="bu">Math</span><span class="op">.</span><span class="fu">floor</span>(ydz[<span class="dv">1</span>])<span class="op">.</span><span class="fu">toString</span>()<span class="op">.</span><span class="fu">padStart</span>(<span class="dv">3</span><span class="op">,</span> <span class="st">"0"</span>)</span>
<span id="cb2-866"><a href="#cb2-866" aria-hidden="true" tabindex="-1"></a>browserDote <span class="op">=</span> <span class="fu">unix2dote</span>(now)</span>
<span id="cb2-867"><a href="#cb2-867" aria-hidden="true" tabindex="-1"></a>browserTime <span class="op">=</span> browserDote[<span class="dv">0</span>] <span class="op">%</span> <span class="dv">1</span> <span class="op">*</span> <span class="dv">10</span></span>
<span id="cb2-868"><a href="#cb2-868" aria-hidden="true" tabindex="-1"></a>browserZone <span class="op">=</span> browserDote[<span class="dv">1</span>]</span>
<span id="cb2-869"><a href="#cb2-869" aria-hidden="true" tabindex="-1"></a>browserSign <span class="op">=</span> browserZone <span class="op">&gt;</span> <span class="dv">0</span> <span class="op">?</span> <span class="st">"-"</span> <span class="op">:</span> <span class="st">"+"</span></span>
<span id="cb2-870"><a href="#cb2-870" aria-hidden="true" tabindex="-1"></a>zone0time <span class="op">=</span> (browserTime <span class="op">-</span> browserZone <span class="op">+</span> <span class="dv">10</span>) <span class="op">%</span> <span class="dv">10</span></span>
<span id="cb2-871"><a href="#cb2-871" aria-hidden="true" tabindex="-1"></a>hours <span class="op">=</span> browserTime <span class="op">*</span> <span class="fl">2.4</span></span>
<span id="cb2-872"><a href="#cb2-872" aria-hidden="true" tabindex="-1"></a>minutes <span class="op">=</span> hours <span class="op">%</span> <span class="dv">1</span> <span class="op">*</span> <span class="dv">60</span></span>
<span id="cb2-873"><a href="#cb2-873" aria-hidden="true" tabindex="-1"></a>seconds <span class="op">=</span> minutes <span class="op">%</span> <span class="dv">1</span> <span class="op">*</span> <span class="dv">60</span></span>
<span id="cb2-874"><a href="#cb2-874" aria-hidden="true" tabindex="-1"></a>selectedDote <span class="op">=</span> <span class="fu">unix2dote</span>(now<span class="op">,</span> <span class="fu">long2zone</span>(location[<span class="dv">0</span>]))</span>
<span id="cb2-875"><a href="#cb2-875" aria-hidden="true" tabindex="-1"></a>selectedExact <span class="op">=</span> selectedDote[<span class="dv">0</span>] <span class="op">%</span> <span class="dv">1</span></span>
<span id="cb2-876"><a href="#cb2-876" aria-hidden="true" tabindex="-1"></a>selectedExactN <span class="op">=</span> (<span class="dv">1</span> <span class="op">-</span> selectedExact) <span class="op">%</span> <span class="dv">1</span></span>
<span id="cb2-877"><a href="#cb2-877" aria-hidden="true" tabindex="-1"></a>selectedZone <span class="op">=</span> selectedDote[<span class="dv">1</span>]</span>
<span id="cb2-878"><a href="#cb2-878" aria-hidden="true" tabindex="-1"></a>decTime <span class="op">=</span> (selectedExact <span class="op">*</span> <span class="dv">10</span>)<span class="op">.</span><span class="fu">toFixed</span>(<span class="dv">4</span>)</span>
<span id="cb2-879"><a href="#cb2-879" aria-hidden="true" tabindex="-1"></a>decTimeN <span class="op">=</span> (selectedExactN <span class="op">*</span> <span class="dv">10</span>)<span class="op">.</span><span class="fu">toFixed</span>(<span class="dv">4</span>)</span>
<span id="cb2-880"><a href="#cb2-880" aria-hidden="true" tabindex="-1"></a>barDD <span class="op">=</span> decTime[<span class="dv">0</span>]</span>
<span id="cb2-881"><a href="#cb2-881" aria-hidden="true" tabindex="-1"></a>barDDN <span class="op">=</span> decTimeN[<span class="dv">0</span>]</span>
<span id="cb2-882"><a href="#cb2-882" aria-hidden="true" tabindex="-1"></a>barMils <span class="op">=</span> decTime<span class="op">.</span><span class="fu">slice</span>(<span class="dv">2</span><span class="op">,</span> <span class="dv">4</span>)</span>
<span id="cb2-883"><a href="#cb2-883" aria-hidden="true" tabindex="-1"></a>barMilsN <span class="op">=</span> decTimeN<span class="op">.</span><span class="fu">slice</span>(<span class="dv">2</span><span class="op">,</span> <span class="dv">4</span>)</span>
<span id="cb2-884"><a href="#cb2-884" aria-hidden="true" tabindex="-1"></a>barBeats <span class="op">=</span> decTime<span class="op">.</span><span class="fu">slice</span>(<span class="dv">4</span><span class="op">,</span> <span class="dv">6</span>)</span>
<span id="cb2-885"><a href="#cb2-885" aria-hidden="true" tabindex="-1"></a>barBeatsN <span class="op">=</span> decTimeN<span class="op">.</span><span class="fu">slice</span>(<span class="dv">4</span><span class="op">,</span> <span class="dv">6</span>)</span>
<span id="cb2-886"><a href="#cb2-886" aria-hidden="true" tabindex="-1"></a><span class="kw">function</span> <span class="fu">lati2turn1</span>(degrees <span class="op">=</span> <span class="op">-</span><span class="dv">180</span><span class="op">,</span> e <span class="op">=</span> <span class="dv">3</span>) {</span>
<span id="cb2-887"><a href="#cb2-887" aria-hidden="true" tabindex="-1"></a>  <span class="co">// turns: e=0, deciturns: e=1, etc.</span></span>
<span id="cb2-888"><a href="#cb2-888" aria-hidden="true" tabindex="-1"></a>  <span class="cf">return</span> (degrees <span class="op">%=</span> <span class="dv">360</span>) <span class="op">/</span> (<span class="dv">360</span> <span class="op">/</span> <span class="dv">10</span><span class="op">**</span>e) <span class="op">%</span> <span class="dv">10</span><span class="op">**</span>e<span class="op">;</span></span>
<span id="cb2-889"><a href="#cb2-889" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb2-890"><a href="#cb2-890" aria-hidden="true" tabindex="-1"></a>graticule <span class="op">=</span> d3<span class="op">.</span><span class="fu">geoGraticule</span>()<span class="op">.</span><span class="fu">stepMinor</span>([<span class="dv">36</span><span class="op">,</span><span class="dv">36</span>])<span class="op">.</span><span class="fu">stepMajor</span>([<span class="dv">36</span><span class="op">,</span><span class="dv">36</span>])()</span>
<span id="cb2-891"><a href="#cb2-891" aria-hidden="true" tabindex="-1"></a>graticule<span class="op">.</span><span class="at">coordinates</span> <span class="op">=</span> graticule<span class="op">.</span><span class="at">coordinates</span><span class="op">.</span><span class="fu">map</span>(</span>
<span id="cb2-892"><a href="#cb2-892" aria-hidden="true" tabindex="-1"></a>  i <span class="kw">=&gt;</span> i<span class="op">.</span><span class="fu">map</span>(j <span class="kw">=&gt;</span> j<span class="op">.</span><span class="fu">map</span>((k<span class="op">,</span> index<span class="op">,</span> arr) <span class="kw">=&gt;</span> i<span class="op">.</span><span class="at">length</span> <span class="op">===</span> <span class="dv">3</span> <span class="op">&amp;&amp;</span> index <span class="op">===</span> <span class="dv">0</span> <span class="op">?</span> k <span class="op">-</span> <span class="dv">18</span> <span class="op">:</span> k))</span>
<span id="cb2-893"><a href="#cb2-893" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display hidden">
<div>
<div id="ojs-cell-2-1" data-nodetype="declaration">

</div>
</div>
</div>
<div class="cell-output cell-output-display hidden">
<div>
<div id="ojs-cell-2-2" data-nodetype="declaration">

</div>
</div>
</div>
<div class="cell-output cell-output-display hidden">
<div>
<div id="ojs-cell-2-3" data-nodetype="declaration">

</div>
</div>
</div>
<div class="cell-output cell-output-display hidden">
<div>
<div id="ojs-cell-2-4" data-nodetype="declaration">

</div>
</div>
</div>
<div class="cell-output cell-output-display hidden">
<div>
<div id="ojs-cell-2-5" data-nodetype="declaration">

</div>
</div>
</div>
<div class="cell-output cell-output-display hidden">
<div>
<div id="ojs-cell-2-6" data-nodetype="declaration">

</div>
</div>
</div>
<div class="cell-output cell-output-display hidden">
<div>
<div id="ojs-cell-2-7" data-nodetype="declaration">

</div>
</div>
</div>
<div class="cell-output cell-output-display hidden">
<div>
<div id="ojs-cell-2-8" data-nodetype="declaration">

</div>
</div>
</div>
<div class="cell-output cell-output-display hidden">
<div>
<div id="ojs-cell-2-9" data-nodetype="declaration">

</div>
</div>
</div>
<div class="cell-output cell-output-display hidden">
<div>
<div id="ojs-cell-2-10" data-nodetype="declaration">

</div>
</div>
</div>
<div class="cell-output cell-output-display hidden">
<div>
<div id="ojs-cell-2-11" data-nodetype="declaration">

</div>
</div>
</div>
<div class="cell-output cell-output-display hidden">
<div>
<div id="ojs-cell-2-12" data-nodetype="declaration">

</div>
</div>
</div>
<div class="cell-output cell-output-display hidden">
<div>
<div id="ojs-cell-2-13" data-nodetype="declaration">

</div>
</div>
</div>
<div class="cell-output cell-output-display hidden">
<div>
<div id="ojs-cell-2-14" data-nodetype="declaration">

</div>
</div>
</div>
<div class="cell-output cell-output-display hidden">
<div>
<div id="ojs-cell-2-15" data-nodetype="declaration">

</div>
</div>
</div>
<div class="cell-output cell-output-display hidden">
<div>
<div id="ojs-cell-2-16" data-nodetype="declaration">

</div>
</div>
</div>
<div class="cell-output cell-output-display hidden">
<div>
<div id="ojs-cell-2-17" data-nodetype="declaration">

</div>
</div>
</div>
<div class="cell-output cell-output-display hidden">
<div>
<div id="ojs-cell-2-18" data-nodetype="declaration">

</div>
</div>
</div>
<div class="cell-output cell-output-display hidden">
<div>
<div id="ojs-cell-2-19" data-nodetype="declaration">

</div>
</div>
</div>
<div class="cell-output cell-output-display hidden">
<div>
<div id="ojs-cell-2-20" data-nodetype="declaration">

</div>
</div>
</div>
<div class="cell-output cell-output-display hidden">
<div>
<div id="ojs-cell-2-21" data-nodetype="declaration">

</div>
</div>
</div>
<div class="cell-output cell-output-display hidden">
<div>
<div id="ojs-cell-2-22" data-nodetype="declaration">

</div>
</div>
</div>
<div class="cell-output cell-output-display hidden">
<div>
<div id="ojs-cell-2-23" data-nodetype="declaration">

</div>
</div>
</div>
<div class="cell-output cell-output-display hidden">
<div>
<div id="ojs-cell-2-24" data-nodetype="declaration">

</div>
</div>
</div>
<div class="cell-output cell-output-display hidden">
<div>
<div id="ojs-cell-2-25" data-nodetype="declaration">

</div>
</div>
</div>
<div class="cell-output cell-output-display hidden">
<div>
<div id="ojs-cell-2-26" data-nodetype="declaration">

</div>
</div>
</div>
<div class="cell-output cell-output-display hidden">
<div>
<div id="ojs-cell-2-27" data-nodetype="declaration">

</div>
</div>
</div>
<div class="cell-output cell-output-display hidden">
<div>
<div id="ojs-cell-2-28" data-nodetype="declaration">

</div>
</div>
</div>
<div class="cell-output cell-output-display hidden">
<div>
<div id="ojs-cell-2-29" data-nodetype="declaration">

</div>
</div>
</div>
<div class="cell-output cell-output-display hidden">
<div>
<div id="ojs-cell-2-30" data-nodetype="expression">

</div>
</div>
</div>
<div class="sourceCode cell-code hidden" id="cb3" data-startfrom="894" data-source-offset="-2012"><pre class="sourceCode js code-with-copy"><code class="sourceCode javascript" style="counter-reset: source-line 893;"><span id="cb3-894"><a href="#cb3-894" aria-hidden="true" tabindex="-1"></a><span class="kw">function</span> <span class="fu">long2turn</span>(degrees <span class="op">=</span> <span class="op">-</span><span class="dv">180</span><span class="op">,</span> e <span class="op">=</span> <span class="dv">3</span>) {</span>
<span id="cb3-895"><a href="#cb3-895" aria-hidden="true" tabindex="-1"></a>  <span class="co">// turns: e=0, deciturns: e=1, etc.</span></span>
<span id="cb3-896"><a href="#cb3-896" aria-hidden="true" tabindex="-1"></a>  <span class="cf">return</span> (((degrees <span class="op">%=</span> <span class="dv">360</span>) <span class="op">&lt;</span> <span class="dv">0</span> <span class="op">?</span> degrees <span class="op">+</span> <span class="dv">360</span> <span class="op">:</span> degrees) <span class="op">+</span> <span class="dv">18</span>) <span class="op">/</span> (<span class="dv">360</span> <span class="op">/</span> <span class="dv">10</span><span class="op">**</span>e) <span class="op">%</span> <span class="dv">10</span><span class="op">**</span>e<span class="op">;</span></span>
<span id="cb3-897"><a href="#cb3-897" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb3-898"><a href="#cb3-898" aria-hidden="true" tabindex="-1"></a><span class="co">// https://github.com/topojson/world-atlas</span></span>
<span id="cb3-899"><a href="#cb3-899" aria-hidden="true" tabindex="-1"></a>world <span class="op">=</span> d3<span class="op">.</span><span class="fu">json</span>(<span class="st">"https://cdn.jsdelivr.net/npm/world-atlas@2/countries-110m.json"</span>)</span>
<span id="cb3-900"><a href="#cb3-900" aria-hidden="true" tabindex="-1"></a>countries <span class="op">=</span> topojson<span class="op">.</span><span class="fu">feature</span>(world<span class="op">,</span> world<span class="op">.</span><span class="at">objects</span><span class="op">.</span><span class="at">countries</span>)</span>
<span id="cb3-901"><a href="#cb3-901" aria-hidden="true" tabindex="-1"></a>topojson <span class="op">=</span> <span class="pp">require</span>(<span class="st">"topojson-client@3"</span>)</span>
<span id="cb3-902"><a href="#cb3-902" aria-hidden="true" tabindex="-1"></a><span class="kw">function</span> <span class="fu">long2zone</span>(degrees <span class="op">=</span> <span class="op">-</span><span class="dv">180</span>) {</span>
<span id="cb3-903"><a href="#cb3-903" aria-hidden="true" tabindex="-1"></a>  <span class="cf">return</span> <span class="bu">Math</span><span class="op">.</span><span class="fu">floor</span>(<span class="fu">long2turn</span>(degrees<span class="op">,</span> <span class="dv">1</span>))<span class="op">;</span></span>
<span id="cb3-904"><a href="#cb3-904" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb3-905"><a href="#cb3-905" aria-hidden="true" tabindex="-1"></a><span class="kw">function</span> <span class="fu">year2leap</span>(year <span class="op">=</span> <span class="dv">1970</span>) {</span>
<span id="cb3-906"><a href="#cb3-906" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> year <span class="op">%</span> <span class="dv">4</span> <span class="op">==</span> <span class="dv">0</span> <span class="op">&amp;&amp;</span> year <span class="op">%</span> <span class="dv">100</span> <span class="op">!=</span> <span class="dv">0</span> <span class="op">||</span> year <span class="op">%</span> <span class="dv">400</span> <span class="op">==</span> <span class="dv">0</span><span class="op">;</span></span>
<span id="cb3-907"><a href="#cb3-907" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb3-908"><a href="#cb3-908" aria-hidden="true" tabindex="-1"></a><span class="co">// https://observablehq.com/@dbridges/visualizing-seasonal-daylight</span></span>
<span id="cb3-909"><a href="#cb3-909" aria-hidden="true" tabindex="-1"></a>solarSystem <span class="op">=</span> (<span class="bu">root</span><span class="op">,</span> width<span class="op">,</span> location<span class="op">,</span> date<span class="op">,</span> hour) <span class="kw">=&gt;</span> {</span>
<span id="cb3-910"><a href="#cb3-910" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> earthRadius <span class="op">=</span> <span class="fl">0.04</span> <span class="op">*</span> width<span class="op">;</span></span>
<span id="cb3-911"><a href="#cb3-911" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> sunRadius <span class="op">=</span> <span class="fl">0.08</span> <span class="op">*</span> width<span class="op">;</span></span>
<span id="cb3-912"><a href="#cb3-912" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> solarSystemRadius <span class="op">=</span> width <span class="op">/</span> <span class="dv">2</span> <span class="op">-</span> <span class="dv">20</span><span class="op">;</span></span>
<span id="cb3-913"><a href="#cb3-913" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> stretch <span class="op">=</span> <span class="fl">0.3</span><span class="op">;</span></span>
<span id="cb3-914"><a href="#cb3-914" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> solarAngle <span class="op">=</span> <span class="fu">getSolarAngle</span>(date)<span class="op">;</span></span>
<span id="cb3-915"><a href="#cb3-915" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> solarAngleDeg <span class="op">=</span> (solarAngle <span class="op">*</span> <span class="dv">180</span>) <span class="op">/</span> <span class="bu">Math</span><span class="op">.</span><span class="cn">PI</span><span class="op">;</span></span>
<span id="cb3-916"><a href="#cb3-916" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> x <span class="op">=</span> solarSystemRadius <span class="op">*</span> <span class="bu">Math</span><span class="op">.</span><span class="fu">sin</span>(solarAngle)<span class="op">;</span></span>
<span id="cb3-917"><a href="#cb3-917" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> y <span class="op">=</span> stretch <span class="op">*</span> solarSystemRadius <span class="op">*</span> <span class="bu">Math</span><span class="op">.</span><span class="fu">cos</span>(solarAngle)<span class="op">;</span></span>
<span id="cb3-918"><a href="#cb3-918" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> spin <span class="op">=</span> <span class="dv">180</span> <span class="op">+</span> <span class="op">-</span>location[<span class="dv">0</span>] <span class="op">+</span> solarAngleDeg <span class="op">+</span> <span class="dv">360</span> <span class="op">*</span> ((hour <span class="op">+</span> <span class="dv">12</span>) <span class="op">/</span> <span class="dv">24</span>)<span class="op">;</span></span>
<span id="cb3-919"><a href="#cb3-919" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> earthGeo <span class="op">=</span> { <span class="dt">type</span><span class="op">:</span> <span class="st">"Sphere"</span> }<span class="op">;</span></span>
<span id="cb3-920"><a href="#cb3-920" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> projection <span class="op">=</span> d3</span>
<span id="cb3-921"><a href="#cb3-921" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">geoOrthographic</span>()</span>
<span id="cb3-922"><a href="#cb3-922" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">fitWidth</span>(earthRadius <span class="op">*</span> <span class="dv">2</span><span class="op">,</span> earthGeo)</span>
<span id="cb3-923"><a href="#cb3-923" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">rotate</span>([spin<span class="op">,</span> <span class="dv">0</span><span class="op">,</span> <span class="fl">23.5</span>])</span>
<span id="cb3-924"><a href="#cb3-924" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">translate</span>([<span class="dv">0</span><span class="op">,</span> <span class="dv">0</span>])<span class="op">;</span></span>
<span id="cb3-925"><a href="#cb3-925" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> staticProjection <span class="op">=</span> d3</span>
<span id="cb3-926"><a href="#cb3-926" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">geoOrthographic</span>()</span>
<span id="cb3-927"><a href="#cb3-927" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">fitWidth</span>(earthRadius <span class="op">*</span> <span class="dv">2</span><span class="op">,</span> earthGeo)</span>
<span id="cb3-928"><a href="#cb3-928" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">rotate</span>([solarAngleDeg <span class="op">-</span> <span class="dv">90</span><span class="op">,</span> <span class="dv">0</span>])</span>
<span id="cb3-929"><a href="#cb3-929" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">translate</span>([<span class="dv">0</span><span class="op">,</span> <span class="dv">0</span>])<span class="op">;</span></span>
<span id="cb3-930"><a href="#cb3-930" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> path <span class="op">=</span> d3<span class="op">.</span><span class="fu">geoPath</span>(projection)<span class="op">.</span><span class="fu">pointRadius</span>(<span class="fl">1.5</span>)<span class="op">;</span></span>
<span id="cb3-931"><a href="#cb3-931" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> staticPath <span class="op">=</span> d3<span class="op">.</span><span class="fu">geoPath</span>(staticProjection)<span class="op">;</span></span>
<span id="cb3-932"><a href="#cb3-932" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> solarSystem <span class="op">=</span> <span class="bu">root</span></span>
<span id="cb3-933"><a href="#cb3-933" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">append</span>(<span class="st">"g"</span>)</span>
<span id="cb3-934"><a href="#cb3-934" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">"transform"</span><span class="op">,</span> <span class="vs">`translate(</span><span class="sc">${</span>width <span class="op">/</span> <span class="dv">2</span><span class="sc">}</span><span class="vs">)`</span>)<span class="op">;</span></span>
<span id="cb3-935"><a href="#cb3-935" aria-hidden="true" tabindex="-1"></a>  solarSystem<span class="op">.</span><span class="fu">append</span>(<span class="st">"circle"</span>)<span class="op">.</span><span class="fu">attr</span>(<span class="st">"r"</span><span class="op">,</span> sunRadius)<span class="op">.</span><span class="fu">attr</span>(<span class="st">"fill"</span><span class="op">,</span> colors<span class="op">.</span><span class="at">sun</span>)<span class="op">;</span></span>
<span id="cb3-936"><a href="#cb3-936" aria-hidden="true" tabindex="-1"></a>  <span class="co">/* Draw orbit */</span></span>
<span id="cb3-937"><a href="#cb3-937" aria-hidden="true" tabindex="-1"></a>  solarSystem</span>
<span id="cb3-938"><a href="#cb3-938" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">append</span>(<span class="st">"ellipse"</span>)</span>
<span id="cb3-939"><a href="#cb3-939" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">"rx"</span><span class="op">,</span> solarSystemRadius)</span>
<span id="cb3-940"><a href="#cb3-940" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">"ry"</span><span class="op">,</span> stretch <span class="op">*</span> solarSystemRadius)</span>
<span id="cb3-941"><a href="#cb3-941" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">"fill"</span><span class="op">,</span> <span class="st">"none"</span>)</span>
<span id="cb3-942"><a href="#cb3-942" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">"stroke"</span><span class="op">,</span> <span class="st">"black"</span>)<span class="op">;</span></span>
<span id="cb3-943"><a href="#cb3-943" aria-hidden="true" tabindex="-1"></a>  <span class="co">/* Draw month ticks */</span></span>
<span id="cb3-944"><a href="#cb3-944" aria-hidden="true" tabindex="-1"></a>  d3<span class="op">.</span><span class="fu">range</span>(<span class="dv">12</span>)<span class="op">.</span><span class="fu">map</span>((m) <span class="kw">=&gt;</span> {</span>
<span id="cb3-945"><a href="#cb3-945" aria-hidden="true" tabindex="-1"></a>    <span class="kw">const</span> d <span class="op">=</span> <span class="kw">new</span> <span class="bu">Date</span>(date<span class="op">.</span><span class="fu">getFullYear</span>()<span class="op">,</span> m<span class="op">,</span> <span class="dv">1</span>)<span class="op">;</span></span>
<span id="cb3-946"><a href="#cb3-946" aria-hidden="true" tabindex="-1"></a>    <span class="kw">const</span> angle <span class="op">=</span> <span class="fu">getSolarAngle</span>(d)<span class="op">;</span></span>
<span id="cb3-947"><a href="#cb3-947" aria-hidden="true" tabindex="-1"></a>    solarSystem</span>
<span id="cb3-948"><a href="#cb3-948" aria-hidden="true" tabindex="-1"></a>      <span class="op">.</span><span class="fu">append</span>(<span class="st">"line"</span>)</span>
<span id="cb3-949"><a href="#cb3-949" aria-hidden="true" tabindex="-1"></a>      <span class="op">.</span><span class="fu">attr</span>(<span class="st">"x1"</span><span class="op">,</span> (solarSystemRadius <span class="op">+</span> <span class="dv">6</span>) <span class="op">*</span> <span class="bu">Math</span><span class="op">.</span><span class="fu">sin</span>(angle))</span>
<span id="cb3-950"><a href="#cb3-950" aria-hidden="true" tabindex="-1"></a>      <span class="op">.</span><span class="fu">attr</span>(<span class="st">"y1"</span><span class="op">,</span> (solarSystemRadius <span class="op">+</span> <span class="dv">6</span>) <span class="op">*</span> stretch <span class="op">*</span> <span class="bu">Math</span><span class="op">.</span><span class="fu">cos</span>(angle))</span>
<span id="cb3-951"><a href="#cb3-951" aria-hidden="true" tabindex="-1"></a>      <span class="op">.</span><span class="fu">attr</span>(<span class="st">"x2"</span><span class="op">,</span> (solarSystemRadius <span class="op">-</span> <span class="dv">6</span>) <span class="op">*</span> <span class="bu">Math</span><span class="op">.</span><span class="fu">sin</span>(angle))</span>
<span id="cb3-952"><a href="#cb3-952" aria-hidden="true" tabindex="-1"></a>      <span class="op">.</span><span class="fu">attr</span>(<span class="st">"y2"</span><span class="op">,</span> (solarSystemRadius <span class="op">-</span> <span class="dv">6</span>) <span class="op">*</span> stretch <span class="op">*</span> <span class="bu">Math</span><span class="op">.</span><span class="fu">cos</span>(angle))</span>
<span id="cb3-953"><a href="#cb3-953" aria-hidden="true" tabindex="-1"></a>      <span class="op">.</span><span class="fu">attr</span>(<span class="st">"stroke"</span><span class="op">,</span> <span class="st">"black"</span>)<span class="op">;</span></span>
<span id="cb3-954"><a href="#cb3-954" aria-hidden="true" tabindex="-1"></a>    <span class="kw">const</span> startMonthAngle <span class="op">=</span> <span class="fu">getSolarAngle</span>(<span class="kw">new</span> <span class="bu">Date</span>(date<span class="op">.</span><span class="fu">getFullYear</span>()<span class="op">,</span> m<span class="op">,</span> <span class="dv">1</span>))<span class="op">;</span></span>
<span id="cb3-955"><a href="#cb3-955" aria-hidden="true" tabindex="-1"></a>    solarSystem</span>
<span id="cb3-956"><a href="#cb3-956" aria-hidden="true" tabindex="-1"></a>      <span class="op">.</span><span class="fu">append</span>(<span class="st">"text"</span>)</span>
<span id="cb3-957"><a href="#cb3-957" aria-hidden="true" tabindex="-1"></a>      <span class="op">.</span><span class="fu">text</span>(<span class="fu">date2doty</span>(d))</span>
<span id="cb3-958"><a href="#cb3-958" aria-hidden="true" tabindex="-1"></a>      <span class="op">.</span><span class="fu">attr</span>(<span class="st">"x"</span><span class="op">,</span> (solarSystemRadius <span class="op">+</span> <span class="dv">18</span>) <span class="op">*</span> <span class="bu">Math</span><span class="op">.</span><span class="fu">sin</span>(startMonthAngle))</span>
<span id="cb3-959"><a href="#cb3-959" aria-hidden="true" tabindex="-1"></a>      <span class="op">.</span><span class="fu">attr</span>(</span>
<span id="cb3-960"><a href="#cb3-960" aria-hidden="true" tabindex="-1"></a>        <span class="st">"y"</span><span class="op">,</span></span>
<span id="cb3-961"><a href="#cb3-961" aria-hidden="true" tabindex="-1"></a>        (solarSystemRadius <span class="op">+</span> <span class="dv">18</span>) <span class="op">*</span> <span class="fl">1.18</span> <span class="op">*</span> stretch <span class="op">*</span> <span class="bu">Math</span><span class="op">.</span><span class="fu">cos</span>(startMonthAngle)</span>
<span id="cb3-962"><a href="#cb3-962" aria-hidden="true" tabindex="-1"></a>      )</span>
<span id="cb3-963"><a href="#cb3-963" aria-hidden="true" tabindex="-1"></a>      <span class="op">.</span><span class="fu">attr</span>(<span class="st">"text-anchor"</span><span class="op">,</span> <span class="st">"middle"</span>)</span>
<span id="cb3-964"><a href="#cb3-964" aria-hidden="true" tabindex="-1"></a>      <span class="op">.</span><span class="fu">attr</span>(<span class="st">"font-size"</span><span class="op">,</span> fontSize <span class="op">*</span> (width <span class="op">&lt;</span> <span class="dv">165</span> <span class="op">?</span> <span class="op">.</span><span class="dv">9</span> <span class="op">:</span> width <span class="op">&lt;</span> <span class="dv">265</span> <span class="op">?</span> <span class="dv">1</span> <span class="op">:</span> width <span class="op">&lt;</span> <span class="dv">365</span> <span class="op">?</span> <span class="fl">1.1</span> <span class="op">:</span> <span class="fl">1.2</span>))</span>
<span id="cb3-965"><a href="#cb3-965" aria-hidden="true" tabindex="-1"></a>      <span class="op">.</span><span class="fu">attr</span>(<span class="st">"dominant-baseline"</span><span class="op">,</span> <span class="st">"middle"</span>)</span>
<span id="cb3-966"><a href="#cb3-966" aria-hidden="true" tabindex="-1"></a>      <span class="op">.</span><span class="fu">attr</span>(<span class="st">"font-size"</span><span class="op">,</span> fontSize <span class="op">*</span> (width <span class="op">&lt;</span> <span class="dv">165</span> <span class="op">?</span> <span class="op">.</span><span class="dv">9</span> <span class="op">:</span> width <span class="op">&lt;</span> <span class="dv">265</span> <span class="op">?</span> <span class="dv">1</span> <span class="op">:</span> width <span class="op">&lt;</span> <span class="dv">365</span> <span class="op">?</span> <span class="fl">1.1</span> <span class="op">:</span> <span class="fl">1.2</span>))</span>
<span id="cb3-967"><a href="#cb3-967" aria-hidden="true" tabindex="-1"></a>      <span class="op">.</span><span class="fu">attr</span>(<span class="st">"font-family"</span><span class="op">,</span> <span class="st">"sans-serif"</span>)</span>
<span id="cb3-968"><a href="#cb3-968" aria-hidden="true" tabindex="-1"></a>      <span class="op">.</span><span class="fu">attr</span>(<span class="st">"fill"</span><span class="op">,</span> <span class="st">"black"</span>)<span class="op">;</span></span>
<span id="cb3-969"><a href="#cb3-969" aria-hidden="true" tabindex="-1"></a>  })<span class="op">;</span></span>
<span id="cb3-970"><a href="#cb3-970" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> earth <span class="op">=</span> solarSystem</span>
<span id="cb3-971"><a href="#cb3-971" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">append</span>(<span class="st">"g"</span>)</span>
<span id="cb3-972"><a href="#cb3-972" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">"transform"</span><span class="op">,</span> <span class="vs">`translate(</span><span class="sc">${</span>x<span class="sc">}</span><span class="vs">, </span><span class="sc">${</span>y<span class="sc">}</span><span class="vs">)`</span>)<span class="op">;</span></span>
<span id="cb3-973"><a href="#cb3-973" aria-hidden="true" tabindex="-1"></a>  earth</span>
<span id="cb3-974"><a href="#cb3-974" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">append</span>(<span class="st">"line"</span>)</span>
<span id="cb3-975"><a href="#cb3-975" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">"y1"</span><span class="op">,</span> <span class="op">-</span><span class="fl">1.5</span> <span class="op">*</span> earthRadius)</span>
<span id="cb3-976"><a href="#cb3-976" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">"y2"</span><span class="op">,</span> <span class="fl">1.5</span> <span class="op">*</span> earthRadius)</span>
<span id="cb3-977"><a href="#cb3-977" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">"stroke"</span><span class="op">,</span> <span class="st">"blue"</span>)</span>
<span id="cb3-978"><a href="#cb3-978" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">"transform"</span><span class="op">,</span> <span class="vs">`rotate(-23.5)`</span>)<span class="op">;</span></span>
<span id="cb3-979"><a href="#cb3-979" aria-hidden="true" tabindex="-1"></a>  earth<span class="op">.</span><span class="fu">append</span>(<span class="st">"path"</span>)<span class="op">.</span><span class="fu">attr</span>(<span class="st">"d"</span><span class="op">,</span> <span class="fu">path</span>(earthGeo))<span class="op">.</span><span class="fu">attr</span>(<span class="st">"fill"</span><span class="op">,</span> colors<span class="op">.</span><span class="at">ocean</span>)<span class="op">;</span></span>
<span id="cb3-980"><a href="#cb3-980" aria-hidden="true" tabindex="-1"></a>  earth<span class="op">.</span><span class="fu">append</span>(<span class="st">"path"</span>)<span class="op">.</span><span class="fu">attr</span>(<span class="st">"d"</span><span class="op">,</span> <span class="fu">path</span>(land))<span class="op">.</span><span class="fu">attr</span>(<span class="st">"fill"</span><span class="op">,</span> colors<span class="op">.</span><span class="at">land</span>)<span class="op">;</span></span>
<span id="cb3-981"><a href="#cb3-981" aria-hidden="true" tabindex="-1"></a>  earth<span class="op">.</span><span class="fu">append</span>(<span class="st">"path"</span>)</span>
<span id="cb3-982"><a href="#cb3-982" aria-hidden="true" tabindex="-1"></a>  <span class="op">.</span><span class="fu">attr</span>(<span class="st">"d"</span><span class="op">,</span> <span class="fu">path</span>(countries))</span>
<span id="cb3-983"><a href="#cb3-983" aria-hidden="true" tabindex="-1"></a>  <span class="op">.</span><span class="fu">attr</span>(<span class="st">"stroke-width"</span><span class="op">,</span> <span class="st">".075"</span>)</span>
<span id="cb3-984"><a href="#cb3-984" aria-hidden="true" tabindex="-1"></a>  <span class="op">.</span><span class="fu">attr</span>(<span class="st">"fill"</span><span class="op">,</span> <span class="st">"none"</span>)</span>
<span id="cb3-985"><a href="#cb3-985" aria-hidden="true" tabindex="-1"></a>  <span class="op">.</span><span class="fu">attr</span>(<span class="st">"stroke"</span><span class="op">,</span> <span class="st">"#555"</span>)<span class="op">;</span></span>
<span id="cb3-986"><a href="#cb3-986" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> shadowPolygon <span class="op">=</span> [</span>
<span id="cb3-987"><a href="#cb3-987" aria-hidden="true" tabindex="-1"></a>    [<span class="dv">0</span><span class="op">,</span> <span class="op">-</span><span class="dv">90</span>]<span class="op">,</span></span>
<span id="cb3-988"><a href="#cb3-988" aria-hidden="true" tabindex="-1"></a>    [<span class="dv">0</span><span class="op">,</span> <span class="dv">0</span>]<span class="op">,</span></span>
<span id="cb3-989"><a href="#cb3-989" aria-hidden="true" tabindex="-1"></a>    [<span class="dv">0</span><span class="op">,</span> <span class="dv">90</span>]<span class="op">,</span></span>
<span id="cb3-990"><a href="#cb3-990" aria-hidden="true" tabindex="-1"></a>    [<span class="dv">180</span><span class="op">,</span> <span class="dv">0</span>]<span class="op">,</span></span>
<span id="cb3-991"><a href="#cb3-991" aria-hidden="true" tabindex="-1"></a>    [<span class="dv">0</span><span class="op">,</span> <span class="op">-</span><span class="dv">90</span>]</span>
<span id="cb3-992"><a href="#cb3-992" aria-hidden="true" tabindex="-1"></a>  ]<span class="op">;</span></span>
<span id="cb3-993"><a href="#cb3-993" aria-hidden="true" tabindex="-1"></a>  earth</span>
<span id="cb3-994"><a href="#cb3-994" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">append</span>(<span class="st">"path"</span>)</span>
<span id="cb3-995"><a href="#cb3-995" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">"d"</span><span class="op">,</span> <span class="fu">staticPath</span>({ <span class="dt">type</span><span class="op">:</span> <span class="st">"Polygon"</span><span class="op">,</span> <span class="dt">coordinates</span><span class="op">:</span> [shadowPolygon] }))</span>
<span id="cb3-996"><a href="#cb3-996" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">"fill"</span><span class="op">,</span> <span class="st">"rgba(0, 0, 0, 0.5)"</span>)<span class="op">;</span></span>
<span id="cb3-997"><a href="#cb3-997" aria-hidden="true" tabindex="-1"></a>  earth</span>
<span id="cb3-998"><a href="#cb3-998" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">append</span>(<span class="st">"path"</span>)</span>
<span id="cb3-999"><a href="#cb3-999" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">"d"</span><span class="op">,</span> <span class="fu">path</span>({ <span class="dt">type</span><span class="op">:</span> <span class="st">"Point"</span><span class="op">,</span> <span class="dt">coordinates</span><span class="op">:</span> location }))</span>
<span id="cb3-1000"><a href="#cb3-1000" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">"r"</span><span class="op">,</span> <span class="dv">18</span>)</span>
<span id="cb3-1001"><a href="#cb3-1001" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">"stroke-width"</span><span class="op">,</span> <span class="op">.</span><span class="dv">3</span>)</span>
<span id="cb3-1002"><a href="#cb3-1002" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">"stroke"</span><span class="op">,</span> <span class="st">"black"</span>)</span>
<span id="cb3-1003"><a href="#cb3-1003" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">"fill"</span><span class="op">,</span> <span class="st">"red"</span>)<span class="op">;</span></span>
<span id="cb3-1004"><a href="#cb3-1004" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb3-1005"><a href="#cb3-1005" aria-hidden="true" tabindex="-1"></a><span class="kw">function</span> <span class="fu">greg2doty</span>(month <span class="op">=</span> <span class="dv">1</span><span class="op">,</span> day <span class="op">=</span> <span class="dv">1</span>) {</span>
<span id="cb3-1006"><a href="#cb3-1006" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> <span class="bu">Math</span><span class="op">.</span><span class="fu">floor</span>(</span>
<span id="cb3-1007"><a href="#cb3-1007" aria-hidden="true" tabindex="-1"></a>        (<span class="dv">153</span> <span class="op">*</span> (month <span class="op">&gt;</span> <span class="dv">2</span> <span class="op">?</span> month <span class="op">-</span> <span class="dv">3</span> <span class="op">:</span> month <span class="op">+</span> <span class="dv">9</span>) <span class="op">+</span> <span class="dv">2</span>) <span class="op">/</span> <span class="dv">5</span> <span class="op">+</span> day <span class="op">-</span> <span class="dv">1</span></span>
<span id="cb3-1008"><a href="#cb3-1008" aria-hidden="true" tabindex="-1"></a>)}</span>
<span id="cb3-1009"><a href="#cb3-1009" aria-hidden="true" tabindex="-1"></a><span class="kw">function</span> <span class="fu">date2doty</span>(date) {</span>
<span id="cb3-1010"><a href="#cb3-1010" aria-hidden="true" tabindex="-1"></a>  <span class="cf">return</span> <span class="fu">greg2doty</span>(date<span class="op">.</span><span class="fu">getMonth</span>() <span class="op">+</span> <span class="dv">1</span><span class="op">,</span> date<span class="op">.</span><span class="fu">getDate</span>())</span>
<span id="cb3-1011"><a href="#cb3-1011" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb3-1012"><a href="#cb3-1012" aria-hidden="true" tabindex="-1"></a><span class="kw">function</span> <span class="fu">date2doty1</span>(date) {</span>
<span id="cb3-1013"><a href="#cb3-1013" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> doty <span class="op">=</span> <span class="fu">greg2doty</span>(date<span class="op">.</span><span class="fu">getMonth</span>() <span class="op">+</span> <span class="dv">1</span><span class="op">,</span> date<span class="op">.</span><span class="fu">getDate</span>())</span>
<span id="cb3-1014"><a href="#cb3-1014" aria-hidden="true" tabindex="-1"></a>  <span class="cf">return</span> doty <span class="op">===</span> <span class="dv">31</span> <span class="op">?</span> <span class="st">"Day "</span> <span class="op">+</span> <span class="bu">String</span>(doty) <span class="op">:</span> doty</span>
<span id="cb3-1015"><a href="#cb3-1015" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb3-1016"><a href="#cb3-1016" aria-hidden="true" tabindex="-1"></a><span class="co">// https://observablehq.com/@dbridges/visualizing-seasonal-daylight</span></span>
<span id="cb3-1017"><a href="#cb3-1017" aria-hidden="true" tabindex="-1"></a>globe <span class="op">=</span> (<span class="bu">root</span><span class="op">,</span> { width<span class="op">,</span> location<span class="op">,</span> date<span class="op">,</span> hour }) <span class="kw">=&gt;</span> {</span>
<span id="cb3-1018"><a href="#cb3-1018" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> solarAngle <span class="op">=</span> <span class="fu">getSolarAngle</span>(date)<span class="op">;</span></span>
<span id="cb3-1019"><a href="#cb3-1019" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> solarAngleDeg <span class="op">=</span> <span class="fu">toDegrees</span>(solarAngle)<span class="op">;</span></span>
<span id="cb3-1020"><a href="#cb3-1020" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> hourSpin <span class="op">=</span> <span class="dv">360</span> <span class="op">*</span> ((hour <span class="op">+</span> <span class="dv">12</span>) <span class="op">/</span> <span class="dv">24</span>)<span class="op">;</span></span>
<span id="cb3-1021"><a href="#cb3-1021" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> spin <span class="op">=</span> (<span class="dv">180</span> <span class="op">+</span> <span class="op">-</span>location[<span class="dv">0</span>] <span class="op">+</span> solarAngleDeg <span class="op">+</span> hourSpin)<span class="op">;</span></span>
<span id="cb3-1022"><a href="#cb3-1022" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> tilt <span class="op">=</span> <span class="op">-</span><span class="dv">15</span><span class="op">;</span></span>
<span id="cb3-1023"><a href="#cb3-1023" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> projection <span class="op">=</span> d3<span class="op">.</span><span class="fu">geoOrthographic</span>()</span>
<span id="cb3-1024"><a href="#cb3-1024" aria-hidden="true" tabindex="-1"></a>                       <span class="op">.</span><span class="fu">fitWidth</span>(width<span class="op">,</span> graticule)</span>
<span id="cb3-1025"><a href="#cb3-1025" aria-hidden="true" tabindex="-1"></a>                       <span class="op">.</span><span class="fu">rotate</span>([spin<span class="op">,</span> tilt<span class="op">,</span> <span class="fl">23.5</span>])<span class="op">;</span></span>
<span id="cb3-1026"><a href="#cb3-1026" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> path <span class="op">=</span> d3<span class="op">.</span><span class="fu">geoPath</span>(projection)<span class="op">;</span></span>
<span id="cb3-1027"><a href="#cb3-1027" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> unClippedProjection <span class="op">=</span> d3<span class="op">.</span><span class="fu">geoOrthographic</span>()</span>
<span id="cb3-1028"><a href="#cb3-1028" aria-hidden="true" tabindex="-1"></a>                                <span class="op">.</span><span class="fu">clipAngle</span>(<span class="kw">null</span>)</span>
<span id="cb3-1029"><a href="#cb3-1029" aria-hidden="true" tabindex="-1"></a>                                <span class="op">.</span><span class="fu">fitWidth</span>(width<span class="op">,</span> graticule)</span>
<span id="cb3-1030"><a href="#cb3-1030" aria-hidden="true" tabindex="-1"></a>                                <span class="op">.</span><span class="fu">rotate</span>([spin<span class="op">,</span> tilt<span class="op">,</span> <span class="fl">23.5</span>])<span class="op">;</span></span>
<span id="cb3-1031"><a href="#cb3-1031" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> unClippedPath <span class="op">=</span> d3<span class="op">.</span><span class="fu">geoPath</span>(unClippedProjection)<span class="op">;</span></span>
<span id="cb3-1032"><a href="#cb3-1032" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> staticProjection <span class="op">=</span> d3<span class="op">.</span><span class="fu">geoOrthographic</span>()</span>
<span id="cb3-1033"><a href="#cb3-1033" aria-hidden="true" tabindex="-1"></a>                             <span class="op">.</span><span class="fu">fitWidth</span>(width<span class="op">,</span> graticule)</span>
<span id="cb3-1034"><a href="#cb3-1034" aria-hidden="true" tabindex="-1"></a>                             <span class="op">.</span><span class="fu">rotate</span>([solarAngleDeg <span class="op">-</span> <span class="dv">90</span><span class="op">,</span> tilt])<span class="op">;</span></span>
<span id="cb3-1035"><a href="#cb3-1035" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> staticPath <span class="op">=</span> d3<span class="op">.</span><span class="fu">geoPath</span>(staticProjection)<span class="op">;</span></span>
<span id="cb3-1036"><a href="#cb3-1036" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> background <span class="op">=</span> <span class="bu">root</span><span class="op">.</span><span class="fu">append</span>(<span class="st">"g"</span>)<span class="op">;</span></span>
<span id="cb3-1037"><a href="#cb3-1037" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> earth <span class="op">=</span> <span class="bu">root</span><span class="op">.</span><span class="fu">append</span>(<span class="st">"g"</span>)<span class="op">.</span><span class="fu">style</span>(<span class="st">"opacity"</span><span class="op">,</span> <span class="fl">0.75</span>)<span class="op">;</span></span>
<span id="cb3-1038"><a href="#cb3-1038" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> foreground <span class="op">=</span> <span class="bu">root</span><span class="op">.</span><span class="fu">append</span>(<span class="st">"g"</span>)<span class="op">;</span></span>
<span id="cb3-1039"><a href="#cb3-1039" aria-hidden="true" tabindex="-1"></a>  earth<span class="op">.</span><span class="fu">append</span>(<span class="st">"path"</span>)</span>
<span id="cb3-1040"><a href="#cb3-1040" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">"d"</span><span class="op">,</span> <span class="fu">path</span>({<span class="dt">type</span><span class="op">:</span> <span class="st">"Sphere"</span>}))</span>
<span id="cb3-1041"><a href="#cb3-1041" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">"fill"</span><span class="op">,</span> colors<span class="op">.</span><span class="at">ocean</span>)</span>
<span id="cb3-1042"><a href="#cb3-1042" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">"stroke"</span><span class="op">,</span> <span class="st">"#9ecbda"</span>)<span class="op">;</span></span>
<span id="cb3-1043"><a href="#cb3-1043" aria-hidden="true" tabindex="-1"></a>  earth<span class="op">.</span><span class="fu">append</span>(<span class="st">"path"</span>)</span>
<span id="cb3-1044"><a href="#cb3-1044" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">"d"</span><span class="op">,</span> <span class="fu">path</span>(graticule))</span>
<span id="cb3-1045"><a href="#cb3-1045" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">"stroke-width"</span><span class="op">,</span> <span class="st">"1"</span>)</span>
<span id="cb3-1046"><a href="#cb3-1046" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">"fill"</span><span class="op">,</span> <span class="st">"none"</span>)</span>
<span id="cb3-1047"><a href="#cb3-1047" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">"stroke"</span><span class="op">,</span> <span class="st">"#888"</span>)<span class="op">;</span></span>
<span id="cb3-1048"><a href="#cb3-1048" aria-hidden="true" tabindex="-1"></a>  earth<span class="op">.</span><span class="fu">append</span>(<span class="st">"path"</span>)</span>
<span id="cb3-1049"><a href="#cb3-1049" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">"d"</span><span class="op">,</span> <span class="fu">path</span>(land))</span>
<span id="cb3-1050"><a href="#cb3-1050" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">"fill"</span><span class="op">,</span> colors<span class="op">.</span><span class="at">land</span>)<span class="op">;</span></span>
<span id="cb3-1051"><a href="#cb3-1051" aria-hidden="true" tabindex="-1"></a>  earth<span class="op">.</span><span class="fu">append</span>(<span class="st">"path"</span>)</span>
<span id="cb3-1052"><a href="#cb3-1052" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">"d"</span><span class="op">,</span> <span class="fu">path</span>(countries))</span>
<span id="cb3-1053"><a href="#cb3-1053" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">"stroke-width"</span><span class="op">,</span> <span class="st">"1"</span>)</span>
<span id="cb3-1054"><a href="#cb3-1054" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">"fill"</span><span class="op">,</span> <span class="st">"none"</span>)</span>
<span id="cb3-1055"><a href="#cb3-1055" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">"stroke"</span><span class="op">,</span> <span class="st">"#000"</span>)<span class="op">;</span></span>
<span id="cb3-1056"><a href="#cb3-1056" aria-hidden="true" tabindex="-1"></a>  background<span class="op">.</span><span class="fu">append</span>(<span class="st">"path"</span>)</span>
<span id="cb3-1057"><a href="#cb3-1057" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">"d"</span><span class="op">,</span> <span class="fu">unClippedPath</span>({<span class="dt">type</span><span class="op">:</span> <span class="st">"Point"</span><span class="op">,</span> <span class="dt">coordinates</span><span class="op">:</span> location}))</span>
<span id="cb3-1058"><a href="#cb3-1058" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">"fill"</span><span class="op">,</span> <span class="st">"red"</span>)<span class="op">;</span></span>
<span id="cb3-1059"><a href="#cb3-1059" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> latitudeCoords <span class="op">=</span> (latitude<span class="op">,</span> start<span class="op">,</span> end) <span class="kw">=&gt;</span> {</span>
<span id="cb3-1060"><a href="#cb3-1060" aria-hidden="true" tabindex="-1"></a>    <span class="kw">const</span> longitudes <span class="op">=</span> d3<span class="op">.</span><span class="fu">range</span>(start<span class="op">,</span> end<span class="op">,</span> <span class="dv">2</span>)<span class="op">.</span><span class="fu">concat</span>(end)<span class="op">;</span></span>
<span id="cb3-1061"><a href="#cb3-1061" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> longitudes<span class="op">.</span><span class="fu">map</span>(d <span class="kw">=&gt;</span> [d<span class="op">,</span> latitude])<span class="op">;</span></span>
<span id="cb3-1062"><a href="#cb3-1062" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb3-1063"><a href="#cb3-1063" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> correctSpin <span class="op">=</span> d3<span class="op">.</span><span class="fu">geoRotation</span>([<span class="op">-</span>hourSpin<span class="op">,</span> <span class="dv">0</span>])<span class="op">;</span></span>
<span id="cb3-1064"><a href="#cb3-1064" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> correctTilt <span class="op">=</span> d3<span class="op">.</span><span class="fu">geoRotation</span>([<span class="dv">6</span><span class="op">,</span> <span class="dv">0</span><span class="op">,</span> <span class="dv">0</span>])<span class="op">;</span></span>
<span id="cb3-1065"><a href="#cb3-1065" aria-hidden="true" tabindex="-1"></a>  <span class="co">/* total angular extent of day/night */</span></span>
<span id="cb3-1066"><a href="#cb3-1066" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> dayExtent <span class="op">=</span> <span class="dv">360</span> <span class="op">*</span> <span class="fu">dayLength</span>(date<span class="op">,</span> location[<span class="dv">1</span>]) <span class="op">/</span> <span class="dv">24</span><span class="op">;</span></span>
<span id="cb3-1067"><a href="#cb3-1067" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> nightExtent <span class="op">=</span> <span class="dv">360</span> <span class="op">-</span> dayExtent<span class="op">;</span></span>
<span id="cb3-1068"><a href="#cb3-1068" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> dayLine <span class="op">=</span> {</span>
<span id="cb3-1069"><a href="#cb3-1069" aria-hidden="true" tabindex="-1"></a>    <span class="dt">type</span><span class="op">:</span> <span class="st">"LineString"</span><span class="op">,</span></span>
<span id="cb3-1070"><a href="#cb3-1070" aria-hidden="true" tabindex="-1"></a>    <span class="dt">coordinates</span><span class="op">:</span> <span class="fu">latitudeCoords</span>(location[<span class="dv">1</span>]<span class="op">,</span></span>
<span id="cb3-1071"><a href="#cb3-1071" aria-hidden="true" tabindex="-1"></a>                                location[<span class="dv">0</span>] <span class="op">-</span> dayExtent <span class="op">/</span> <span class="dv">2</span><span class="op">,</span></span>
<span id="cb3-1072"><a href="#cb3-1072" aria-hidden="true" tabindex="-1"></a>                                location[<span class="dv">0</span>] <span class="op">+</span> dayExtent <span class="op">/</span> <span class="dv">2</span>)<span class="op">.</span><span class="fu">map</span>(d <span class="kw">=&gt;</span> <span class="fu">correctSpin</span>(d))</span>
<span id="cb3-1073"><a href="#cb3-1073" aria-hidden="true" tabindex="-1"></a>  }<span class="op">;</span></span>
<span id="cb3-1074"><a href="#cb3-1074" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> nightLine <span class="op">=</span> {</span>
<span id="cb3-1075"><a href="#cb3-1075" aria-hidden="true" tabindex="-1"></a>    <span class="dt">type</span><span class="op">:</span> <span class="st">"LineString"</span><span class="op">,</span></span>
<span id="cb3-1076"><a href="#cb3-1076" aria-hidden="true" tabindex="-1"></a>    <span class="dt">coordinates</span><span class="op">:</span> <span class="fu">latitudeCoords</span>(location[<span class="dv">1</span>]<span class="op">,</span></span>
<span id="cb3-1077"><a href="#cb3-1077" aria-hidden="true" tabindex="-1"></a>                                location[<span class="dv">0</span>] <span class="op">-</span> dayExtent <span class="op">/</span> <span class="dv">2</span> <span class="op">-</span> nightExtent<span class="op">,</span></span>
<span id="cb3-1078"><a href="#cb3-1078" aria-hidden="true" tabindex="-1"></a>                                location[<span class="dv">0</span>] <span class="op">-</span> dayExtent <span class="op">/</span> <span class="dv">2</span>)<span class="op">.</span><span class="fu">map</span>(d <span class="kw">=&gt;</span> <span class="fu">correctSpin</span>(d))</span>
<span id="cb3-1079"><a href="#cb3-1079" aria-hidden="true" tabindex="-1"></a>  }<span class="op">;</span></span>
<span id="cb3-1080"><a href="#cb3-1080" aria-hidden="true" tabindex="-1"></a>  background<span class="op">.</span><span class="fu">append</span>(<span class="st">"path"</span>)</span>
<span id="cb3-1081"><a href="#cb3-1081" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">"d"</span><span class="op">,</span> <span class="fu">unClippedPath</span>(dayLine))</span>
<span id="cb3-1082"><a href="#cb3-1082" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">"fill"</span><span class="op">,</span> <span class="st">"none"</span>)</span>
<span id="cb3-1083"><a href="#cb3-1083" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">"stroke"</span><span class="op">,</span> colors<span class="op">.</span><span class="at">day</span>)</span>
<span id="cb3-1084"><a href="#cb3-1084" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">"stroke-width"</span><span class="op">,</span> <span class="dv">3</span>)<span class="op">;</span></span>
<span id="cb3-1085"><a href="#cb3-1085" aria-hidden="true" tabindex="-1"></a>  background<span class="op">.</span><span class="fu">append</span>(<span class="st">"path"</span>)</span>
<span id="cb3-1086"><a href="#cb3-1086" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">"d"</span><span class="op">,</span> <span class="fu">unClippedPath</span>(nightLine))</span>
<span id="cb3-1087"><a href="#cb3-1087" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">"fill"</span><span class="op">,</span> <span class="st">"none"</span>)</span>
<span id="cb3-1088"><a href="#cb3-1088" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">"stroke"</span><span class="op">,</span> colors<span class="op">.</span><span class="at">night</span>)</span>
<span id="cb3-1089"><a href="#cb3-1089" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">"stroke-width"</span><span class="op">,</span> <span class="dv">3</span>)<span class="op">;</span></span>
<span id="cb3-1090"><a href="#cb3-1090" aria-hidden="true" tabindex="-1"></a>  foreground<span class="op">.</span><span class="fu">append</span>(<span class="st">"path"</span>)</span>
<span id="cb3-1091"><a href="#cb3-1091" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">"d"</span><span class="op">,</span> <span class="fu">path</span>(dayLine))</span>
<span id="cb3-1092"><a href="#cb3-1092" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">"fill"</span><span class="op">,</span> <span class="st">"none"</span>)</span>
<span id="cb3-1093"><a href="#cb3-1093" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">"stroke"</span><span class="op">,</span> colors<span class="op">.</span><span class="at">day</span>)</span>
<span id="cb3-1094"><a href="#cb3-1094" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">"stroke-width"</span><span class="op">,</span> <span class="dv">3</span>)<span class="op">;</span></span>
<span id="cb3-1095"><a href="#cb3-1095" aria-hidden="true" tabindex="-1"></a>  foreground<span class="op">.</span><span class="fu">append</span>(<span class="st">"path"</span>)</span>
<span id="cb3-1096"><a href="#cb3-1096" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">"d"</span><span class="op">,</span> <span class="fu">path</span>(nightLine))</span>
<span id="cb3-1097"><a href="#cb3-1097" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">"fill"</span><span class="op">,</span> <span class="st">"none"</span>)</span>
<span id="cb3-1098"><a href="#cb3-1098" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">"stroke"</span><span class="op">,</span> colors<span class="op">.</span><span class="at">night</span>)</span>
<span id="cb3-1099"><a href="#cb3-1099" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">"stroke-width"</span><span class="op">,</span> <span class="dv">3</span>)<span class="op">;</span></span>
<span id="cb3-1100"><a href="#cb3-1100" aria-hidden="true" tabindex="-1"></a>  foreground<span class="op">.</span><span class="fu">append</span>(<span class="st">"path"</span>)</span>
<span id="cb3-1101"><a href="#cb3-1101" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">"d"</span><span class="op">,</span> <span class="fu">path</span>({<span class="dt">type</span><span class="op">:</span> <span class="st">"Point"</span><span class="op">,</span> <span class="dt">coordinates</span><span class="op">:</span> location}))</span>
<span id="cb3-1102"><a href="#cb3-1102" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">"stroke-width"</span><span class="op">,</span> <span class="op">.</span><span class="dv">5</span>)</span>
<span id="cb3-1103"><a href="#cb3-1103" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">"stroke"</span><span class="op">,</span> <span class="st">"black"</span>)</span>
<span id="cb3-1104"><a href="#cb3-1104" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">"fill"</span><span class="op">,</span> <span class="st">"red"</span>)<span class="op">;</span></span>
<span id="cb3-1105"><a href="#cb3-1105" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> shadowPolygon <span class="op">=</span> [[<span class="dv">0</span><span class="op">,</span> <span class="op">-</span><span class="dv">90</span>]<span class="op">,</span> [<span class="dv">0</span><span class="op">,</span> <span class="dv">0</span>]<span class="op">,</span> [<span class="dv">0</span><span class="op">,</span> <span class="dv">90</span>]<span class="op">,</span> [<span class="dv">180</span><span class="op">,</span> <span class="dv">0</span>]<span class="op">,</span> [<span class="dv">0</span><span class="op">,</span> <span class="op">-</span><span class="dv">90</span>]]<span class="op">.</span><span class="fu">map</span>(d <span class="kw">=&gt;</span> <span class="fu">correctTilt</span>(d))<span class="op">;</span></span>
<span id="cb3-1106"><a href="#cb3-1106" aria-hidden="true" tabindex="-1"></a>  foreground<span class="op">.</span><span class="fu">append</span>(<span class="st">"path"</span>)</span>
<span id="cb3-1107"><a href="#cb3-1107" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">"d"</span><span class="op">,</span> <span class="fu">staticPath</span>({<span class="dt">type</span><span class="op">:</span> <span class="st">"Polygon"</span><span class="op">,</span> <span class="dt">coordinates</span><span class="op">:</span> [shadowPolygon]}))</span>
<span id="cb3-1108"><a href="#cb3-1108" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">"fill"</span><span class="op">,</span> <span class="st">"rgba(0, 0, 0, 0.25)"</span>)<span class="op">;</span></span>
<span id="cb3-1109"><a href="#cb3-1109" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb3-1110"><a href="#cb3-1110" aria-hidden="true" tabindex="-1"></a>dayOfYear <span class="op">=</span> (date) <span class="kw">=&gt;</span> {</span>
<span id="cb3-1111"><a href="#cb3-1111" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> yearStart <span class="op">=</span> <span class="kw">new</span> <span class="bu">Date</span>(date<span class="op">.</span><span class="fu">getFullYear</span>()<span class="op">,</span> <span class="dv">0</span><span class="op">,</span> <span class="dv">1</span><span class="op">+</span><span class="dv">60</span>)<span class="op">;</span></span>
<span id="cb3-1112"><a href="#cb3-1112" aria-hidden="true" tabindex="-1"></a>  <span class="cf">return</span> <span class="bu">Math</span><span class="op">.</span><span class="fu">floor</span>((date<span class="op">.</span><span class="fu">getTime</span>() <span class="op">-</span> yearStart<span class="op">.</span><span class="fu">getTime</span>())<span class="op">/</span><span class="dv">86400000</span>) <span class="op">+</span> <span class="dv">1</span></span>
<span id="cb3-1113"><a href="#cb3-1113" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb3-1114"><a href="#cb3-1114" aria-hidden="true" tabindex="-1"></a><span class="co">// https://observablehq.com/@dbridges/visualizing-seasonal-daylight</span></span>
<span id="cb3-1115"><a href="#cb3-1115" aria-hidden="true" tabindex="-1"></a>daylightPlot <span class="op">=</span> (</span>
<span id="cb3-1116"><a href="#cb3-1116" aria-hidden="true" tabindex="-1"></a>  <span class="bu">root</span><span class="op">,</span></span>
<span id="cb3-1117"><a href="#cb3-1117" aria-hidden="true" tabindex="-1"></a>  { width<span class="op">,</span> height<span class="op">,</span> year<span class="op">,</span> latitude<span class="op">,</span> defaultDate<span class="op">,</span> defaultHour }</span>
<span id="cb3-1118"><a href="#cb3-1118" aria-hidden="true" tabindex="-1"></a>) <span class="kw">=&gt;</span> {</span>
<span id="cb3-1119"><a href="#cb3-1119" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> margin <span class="op">=</span> { <span class="dt">top</span><span class="op">:</span> <span class="dv">24</span><span class="op">,</span> <span class="dt">bottom</span><span class="op">:</span> <span class="dv">32</span><span class="op">,</span> <span class="dt">left</span><span class="op">:</span> <span class="dv">48</span><span class="op">,</span> <span class="dt">right</span><span class="op">:</span> <span class="dv">0</span> }<span class="op">;</span></span>
<span id="cb3-1120"><a href="#cb3-1120" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> chartWidth <span class="op">=</span> width <span class="op">-</span> margin<span class="op">.</span><span class="at">left</span> <span class="op">-</span> margin<span class="op">.</span><span class="at">right</span><span class="op">;</span></span>
<span id="cb3-1121"><a href="#cb3-1121" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> chartHeight <span class="op">=</span> height <span class="op">-</span> margin<span class="op">.</span><span class="at">top</span> <span class="op">-</span> margin<span class="op">.</span><span class="at">bottom</span><span class="op">;</span></span>
<span id="cb3-1122"><a href="#cb3-1122" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> xTickValues <span class="op">=</span></span>
<span id="cb3-1123"><a href="#cb3-1123" aria-hidden="true" tabindex="-1"></a>    width <span class="op">&gt;</span> <span class="dv">280</span> <span class="op">?</span> [<span class="dv">3</span><span class="op">,</span> <span class="dv">6</span><span class="op">,</span> <span class="dv">9</span><span class="op">,</span> <span class="dv">12</span><span class="op">,</span> <span class="dv">15</span><span class="op">,</span> <span class="dv">18</span><span class="op">,</span> <span class="dv">21</span>] <span class="op">:</span> width <span class="op">&gt;</span> <span class="dv">140</span> <span class="op">?</span> [<span class="dv">6</span><span class="op">,</span> <span class="dv">12</span><span class="op">,</span> <span class="dv">18</span>] <span class="op">:</span> [<span class="dv">12</span>]<span class="op">;</span></span>
<span id="cb3-1124"><a href="#cb3-1124" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> xScale <span class="op">=</span> d3</span>
<span id="cb3-1125"><a href="#cb3-1125" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">scaleLinear</span>()</span>
<span id="cb3-1126"><a href="#cb3-1126" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">domain</span>([<span class="dv">0</span><span class="op">,</span> <span class="dv">24</span>])</span>
<span id="cb3-1127"><a href="#cb3-1127" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">range</span>([margin<span class="op">.</span><span class="at">left</span><span class="op">,</span> margin<span class="op">.</span><span class="at">left</span> <span class="op">+</span> chartWidth])</span>
<span id="cb3-1128"><a href="#cb3-1128" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">clamp</span>(<span class="kw">true</span>)<span class="op">;</span></span>
<span id="cb3-1129"><a href="#cb3-1129" aria-hidden="true" tabindex="-1"></a>  <span class="co">// y-axis scale</span></span>
<span id="cb3-1130"><a href="#cb3-1130" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> yScale <span class="op">=</span> d3</span>
<span id="cb3-1131"><a href="#cb3-1131" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">scaleTime</span>()</span>
<span id="cb3-1132"><a href="#cb3-1132" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">domain</span>([<span class="kw">new</span> <span class="bu">Date</span>(year<span class="op">,</span> <span class="dv">0</span><span class="op">,</span> <span class="dv">1</span><span class="op">+</span><span class="dv">60</span>)<span class="op">,</span> <span class="kw">new</span> <span class="bu">Date</span>(year<span class="op">,</span> <span class="dv">11</span><span class="op">,</span> <span class="dv">31</span><span class="op">+</span><span class="dv">60</span>)])</span>
<span id="cb3-1133"><a href="#cb3-1133" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">range</span>([margin<span class="op">.</span><span class="at">top</span><span class="op">,</span> margin<span class="op">.</span><span class="at">top</span> <span class="op">+</span> chartHeight])</span>
<span id="cb3-1134"><a href="#cb3-1134" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">clamp</span>(<span class="kw">true</span>)<span class="op">;</span></span>
<span id="cb3-1135"><a href="#cb3-1135" aria-hidden="true" tabindex="-1"></a>  <span class="co">// y-axis labels</span></span>
<span id="cb3-1136"><a href="#cb3-1136" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> yAxis <span class="op">=</span> d3</span>
<span id="cb3-1137"><a href="#cb3-1137" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">axisLeft</span>(yScale)</span>
<span id="cb3-1138"><a href="#cb3-1138" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">tickValues</span>(d3<span class="op">.</span><span class="at">timeMonth</span><span class="op">.</span><span class="fu">range</span>(<span class="kw">new</span> <span class="bu">Date</span>(year<span class="op">,</span> <span class="dv">0</span><span class="op">,</span> <span class="dv">1</span><span class="op">+</span><span class="dv">60</span>)<span class="op">,</span> <span class="kw">new</span> <span class="bu">Date</span>(year<span class="op">,</span> <span class="dv">12</span><span class="op">,</span> <span class="dv">1</span><span class="op">+</span><span class="dv">57</span>)))</span>
<span id="cb3-1139"><a href="#cb3-1139" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">tickSize</span>(chartWidth)</span>
<span id="cb3-1140"><a href="#cb3-1140" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">tickFormat</span>(date2doty1)<span class="op">;</span></span>
<span id="cb3-1141"><a href="#cb3-1141" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> xAxis <span class="op">=</span> d3</span>
<span id="cb3-1142"><a href="#cb3-1142" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">axisBottom</span>(xScale)</span>
<span id="cb3-1143"><a href="#cb3-1143" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">tickValues</span>(xTickValues)</span>
<span id="cb3-1144"><a href="#cb3-1144" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">tickSize</span>(chartHeight)</span>
<span id="cb3-1145"><a href="#cb3-1145" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">tickFormat</span>((d) <span class="kw">=&gt;</span> {</span>
<span id="cb3-1146"><a href="#cb3-1146" aria-hidden="true" tabindex="-1"></a>      <span class="cf">return</span> <span class="vs">`</span><span class="sc">${</span>d <span class="op">/</span> <span class="op">.</span><span class="bn">024</span><span class="sc">}</span><span class="vs">`</span><span class="op">;</span></span>
<span id="cb3-1147"><a href="#cb3-1147" aria-hidden="true" tabindex="-1"></a>    })<span class="op">;</span></span>
<span id="cb3-1148"><a href="#cb3-1148" aria-hidden="true" tabindex="-1"></a>  <span class="kw">let</span> date <span class="op">=</span> defaultDate <span class="op">||</span> <span class="kw">new</span> <span class="bu">Date</span>()<span class="op">;</span></span>
<span id="cb3-1149"><a href="#cb3-1149" aria-hidden="true" tabindex="-1"></a>  <span class="kw">let</span> hour <span class="op">=</span> defaultHour <span class="op">!=</span> <span class="kw">null</span> <span class="op">?</span> defaultHour <span class="op">:</span> date<span class="op">.</span><span class="fu">getHours</span>()<span class="op">;</span></span>
<span id="cb3-1150"><a href="#cb3-1150" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> handleMouseMove <span class="op">=</span> (e) <span class="kw">=&gt;</span> {}<span class="op">;</span></span>
<span id="cb3-1151"><a href="#cb3-1151" aria-hidden="true" tabindex="-1"></a>  <span class="bu">root</span></span>
<span id="cb3-1152"><a href="#cb3-1152" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">append</span>(<span class="st">"rect"</span>)</span>
<span id="cb3-1153"><a href="#cb3-1153" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">"x"</span><span class="op">,</span> margin<span class="op">.</span><span class="at">left</span>)</span>
<span id="cb3-1154"><a href="#cb3-1154" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">"y"</span><span class="op">,</span> margin<span class="op">.</span><span class="at">top</span>)</span>
<span id="cb3-1155"><a href="#cb3-1155" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">"width"</span><span class="op">,</span> chartWidth)</span>
<span id="cb3-1156"><a href="#cb3-1156" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">"height"</span><span class="op">,</span> chartHeight)</span>
<span id="cb3-1157"><a href="#cb3-1157" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">"rx"</span><span class="op">,</span> <span class="fl">0.05</span> <span class="op">*</span> width)</span>
<span id="cb3-1158"><a href="#cb3-1158" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">"fill"</span><span class="op">,</span> colors<span class="op">.</span><span class="at">night</span>)<span class="op">;</span></span>
<span id="cb3-1159"><a href="#cb3-1159" aria-hidden="true" tabindex="-1"></a>  <span class="bu">root</span></span>
<span id="cb3-1160"><a href="#cb3-1160" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">append</span>(<span class="st">"g"</span>)</span>
<span id="cb3-1161"><a href="#cb3-1161" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">"transform"</span><span class="op">,</span> <span class="vs">`translate(</span><span class="sc">${</span>margin<span class="op">.</span><span class="at">left</span> <span class="op">+</span> chartWidth<span class="sc">}</span><span class="vs">, 0)`</span>)</span>
<span id="cb3-1162"><a href="#cb3-1162" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">call</span>(yAxis)</span>
<span id="cb3-1163"><a href="#cb3-1163" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">call</span>((g) <span class="kw">=&gt;</span> g<span class="op">.</span><span class="fu">select</span>(<span class="st">".domain"</span>)<span class="op">.</span><span class="fu">remove</span>())</span>
<span id="cb3-1164"><a href="#cb3-1164" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">call</span>((g) <span class="kw">=&gt;</span> g<span class="op">.</span><span class="fu">selectAll</span>(<span class="st">".tick"</span>)<span class="op">.</span><span class="fu">attr</span>(<span class="st">"color"</span><span class="op">,</span> colors<span class="op">.</span><span class="at">grid</span>))</span>
<span id="cb3-1165"><a href="#cb3-1165" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">call</span>((g) <span class="kw">=&gt;</span> g<span class="op">.</span><span class="fu">selectAll</span>(<span class="st">".tick text"</span>)<span class="op">.</span><span class="fu">attr</span>(<span class="st">"font-size"</span><span class="op">,</span> fontSize <span class="op">*</span> (width <span class="op">&lt;</span> <span class="dv">165</span> <span class="op">?</span> <span class="op">.</span><span class="dv">7</span> <span class="op">:</span> width <span class="op">&lt;</span> <span class="dv">265</span> <span class="op">?</span> <span class="op">.</span><span class="dv">9</span> <span class="op">:</span> width <span class="op">&lt;</span> <span class="dv">365</span> <span class="op">?</span> <span class="fl">1.3</span> <span class="op">:</span> <span class="fl">1.4</span>)))</span>
<span id="cb3-1166"><a href="#cb3-1166" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">call</span>((g) <span class="kw">=&gt;</span> g<span class="op">.</span><span class="fu">selectAll</span>(<span class="st">".tick text"</span>)<span class="op">.</span><span class="fu">attr</span>(<span class="st">"color"</span><span class="op">,</span> <span class="st">"black"</span>))</span>
<span id="cb3-1167"><a href="#cb3-1167" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">call</span>((g) <span class="kw">=&gt;</span> g<span class="op">.</span><span class="fu">selectAll</span>(<span class="st">".tick line"</span>)<span class="op">.</span><span class="fu">attr</span>(<span class="st">"stroke-dasharray"</span><span class="op">,</span> <span class="st">"5 3"</span>))<span class="op">;</span></span>
<span id="cb3-1168"><a href="#cb3-1168" aria-hidden="true" tabindex="-1"></a>  <span class="bu">root</span></span>
<span id="cb3-1169"><a href="#cb3-1169" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">append</span>(<span class="st">"g"</span>)</span>
<span id="cb3-1170"><a href="#cb3-1170" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">"transform"</span><span class="op">,</span> <span class="vs">`translate(0, </span><span class="sc">${</span>margin<span class="op">.</span><span class="at">top</span><span class="sc">}</span><span class="vs">)`</span>)</span>
<span id="cb3-1171"><a href="#cb3-1171" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">call</span>(xAxis)</span>
<span id="cb3-1172"><a href="#cb3-1172" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">call</span>((g) <span class="kw">=&gt;</span> g<span class="op">.</span><span class="fu">select</span>(<span class="st">".domain"</span>)<span class="op">.</span><span class="fu">remove</span>())</span>
<span id="cb3-1173"><a href="#cb3-1173" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">call</span>((g) <span class="kw">=&gt;</span> g<span class="op">.</span><span class="fu">selectAll</span>(<span class="st">".tick"</span>)<span class="op">.</span><span class="fu">attr</span>(<span class="st">"color"</span><span class="op">,</span> colors<span class="op">.</span><span class="at">grid</span>))</span>
<span id="cb3-1174"><a href="#cb3-1174" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">call</span>((g) <span class="kw">=&gt;</span> g<span class="op">.</span><span class="fu">selectAll</span>(<span class="st">".tick text"</span>)<span class="op">.</span><span class="fu">attr</span>(<span class="st">"font-size"</span><span class="op">,</span> fontSize <span class="op">*</span> (width <span class="op">&lt;</span> <span class="dv">165</span> <span class="op">?</span> <span class="op">.</span><span class="dv">9</span> <span class="op">:</span> width <span class="op">&lt;</span> <span class="dv">265</span> <span class="op">?</span> <span class="fl">1.1</span> <span class="op">:</span> width <span class="op">&lt;</span> <span class="dv">365</span> <span class="op">?</span> <span class="fl">1.2</span> <span class="op">:</span> <span class="fl">1.3</span>)))</span>
<span id="cb3-1175"><a href="#cb3-1175" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">call</span>((g) <span class="kw">=&gt;</span> g<span class="op">.</span><span class="fu">selectAll</span>(<span class="st">".tick text"</span>)<span class="op">.</span><span class="fu">attr</span>(<span class="st">"color"</span><span class="op">,</span> <span class="st">"black"</span>))</span>
<span id="cb3-1176"><a href="#cb3-1176" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">call</span>((g) <span class="kw">=&gt;</span> g<span class="op">.</span><span class="fu">selectAll</span>(<span class="st">".tick line"</span>)<span class="op">.</span><span class="fu">attr</span>(<span class="st">"stroke-dasharray"</span><span class="op">,</span> <span class="st">"5 3"</span>))<span class="op">;</span></span>
<span id="cb3-1177"><a href="#cb3-1177" aria-hidden="true" tabindex="-1"></a>  <span class="bu">root</span></span>
<span id="cb3-1178"><a href="#cb3-1178" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">append</span>(<span class="st">"text"</span>)</span>
<span id="cb3-1179"><a href="#cb3-1179" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">text</span>(<span class="st">"Time of day (millidays)"</span>)</span>
<span id="cb3-1180"><a href="#cb3-1180" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">"x"</span><span class="op">,</span> margin<span class="op">.</span><span class="at">left</span> <span class="op">+</span> chartWidth <span class="op">/</span> <span class="dv">2</span>)</span>
<span id="cb3-1181"><a href="#cb3-1181" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">"y"</span><span class="op">,</span> margin<span class="op">.</span><span class="at">top</span> <span class="op">+</span> chartHeight <span class="op">+</span> margin<span class="op">.</span><span class="at">bottom</span> <span class="op">-</span> (width <span class="op">&lt;</span> <span class="dv">165</span> <span class="op">?</span> <span class="dv">9</span> <span class="op">:</span> width <span class="op">&lt;</span> <span class="dv">265</span> <span class="op">?</span> <span class="dv">6</span> <span class="op">:</span> width <span class="op">&lt;</span> <span class="dv">365</span> <span class="op">?</span> <span class="dv">2</span> <span class="op">:</span> <span class="dv">0</span>))</span>
<span id="cb3-1182"><a href="#cb3-1182" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">"text-anchor"</span><span class="op">,</span> <span class="st">"middle"</span>)</span>
<span id="cb3-1183"><a href="#cb3-1183" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">"font-size"</span><span class="op">,</span> fontSize <span class="op">*</span> (width <span class="op">&lt;</span> <span class="dv">165</span> <span class="op">?</span> <span class="op">.</span><span class="dv">85</span> <span class="op">:</span> width <span class="op">&lt;</span> <span class="dv">265</span> <span class="op">?</span> <span class="fl">1.15</span> <span class="op">:</span> width <span class="op">&lt;</span> <span class="dv">365</span> <span class="op">?</span> <span class="fl">1.5</span> <span class="op">:</span> <span class="fl">1.6</span>))</span>
<span id="cb3-1184"><a href="#cb3-1184" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">"font-family"</span><span class="op">,</span> <span class="st">"sans-serif"</span>)</span>
<span id="cb3-1185"><a href="#cb3-1185" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">"fill"</span><span class="op">,</span> <span class="st">"black"</span>)<span class="op">;</span></span>
<span id="cb3-1186"><a href="#cb3-1186" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> data <span class="op">=</span> <span class="fu">yearDates</span>(year)</span>
<span id="cb3-1187"><a href="#cb3-1187" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">map</span>((d) <span class="kw">=&gt;</span> [d<span class="op">,</span> <span class="fu">dayLength</span>(d<span class="op">,</span> latitude)])</span>
<span id="cb3-1188"><a href="#cb3-1188" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">filter</span>(([_<span class="op">,</span> d]) <span class="kw">=&gt;</span> d <span class="op">&gt;</span> <span class="dv">0</span>)<span class="op">;</span></span>
<span id="cb3-1189"><a href="#cb3-1189" aria-hidden="true" tabindex="-1"></a>  <span class="co">/* Render separate polygons for each continuous sequence of</span></span>
<span id="cb3-1190"><a href="#cb3-1190" aria-hidden="true" tabindex="-1"></a><span class="co">   * days with more than 0 hours of day light</span></span>
<span id="cb3-1191"><a href="#cb3-1191" aria-hidden="true" tabindex="-1"></a><span class="co">   */</span></span>
<span id="cb3-1192"><a href="#cb3-1192" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> polys <span class="op">=</span> []<span class="op">;</span></span>
<span id="cb3-1193"><a href="#cb3-1193" aria-hidden="true" tabindex="-1"></a>  <span class="kw">let</span> currentPoly <span class="op">=</span> []<span class="op">;</span></span>
<span id="cb3-1194"><a href="#cb3-1194" aria-hidden="true" tabindex="-1"></a>  <span class="cf">for</span> (<span class="kw">let</span> i <span class="op">=</span> <span class="dv">0</span><span class="op">;</span> i <span class="op">&lt;</span> data<span class="op">.</span><span class="at">length</span><span class="op">;</span> i<span class="op">++</span>) {</span>
<span id="cb3-1195"><a href="#cb3-1195" aria-hidden="true" tabindex="-1"></a>    <span class="kw">const</span> currentDate <span class="op">=</span> data[i][<span class="dv">0</span>]<span class="op">;</span></span>
<span id="cb3-1196"><a href="#cb3-1196" aria-hidden="true" tabindex="-1"></a>    <span class="kw">const</span> prevDate <span class="op">=</span> (data[i <span class="op">-</span> <span class="dv">1</span>] <span class="op">||</span> [])[<span class="dv">0</span>]<span class="op">;</span></span>
<span id="cb3-1197"><a href="#cb3-1197" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> (</span>
<span id="cb3-1198"><a href="#cb3-1198" aria-hidden="true" tabindex="-1"></a>      i <span class="op">===</span> <span class="dv">0</span> <span class="op">||</span></span>
<span id="cb3-1199"><a href="#cb3-1199" aria-hidden="true" tabindex="-1"></a>      currentDate<span class="op">.</span><span class="fu">getTime</span>() <span class="op">-</span> prevDate<span class="op">.</span><span class="fu">getTime</span>() <span class="op">&lt;</span> <span class="dv">3600</span> <span class="op">*</span> <span class="dv">24</span> <span class="op">*</span> <span class="dv">1000</span> <span class="op">*</span> <span class="fl">1.5</span></span>
<span id="cb3-1200"><a href="#cb3-1200" aria-hidden="true" tabindex="-1"></a>    ) {</span>
<span id="cb3-1201"><a href="#cb3-1201" aria-hidden="true" tabindex="-1"></a>      currentPoly<span class="op">.</span><span class="fu">push</span>(data[i])<span class="op">;</span></span>
<span id="cb3-1202"><a href="#cb3-1202" aria-hidden="true" tabindex="-1"></a>    } <span class="cf">else</span> {</span>
<span id="cb3-1203"><a href="#cb3-1203" aria-hidden="true" tabindex="-1"></a>      polys<span class="op">.</span><span class="fu">push</span>(currentPoly)<span class="op">;</span></span>
<span id="cb3-1204"><a href="#cb3-1204" aria-hidden="true" tabindex="-1"></a>      currentPoly <span class="op">=</span> [data[i]]<span class="op">;</span></span>
<span id="cb3-1205"><a href="#cb3-1205" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb3-1206"><a href="#cb3-1206" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb3-1207"><a href="#cb3-1207" aria-hidden="true" tabindex="-1"></a>  polys<span class="op">.</span><span class="fu">push</span>(currentPoly)<span class="op">;</span></span>
<span id="cb3-1208"><a href="#cb3-1208" aria-hidden="true" tabindex="-1"></a>  polys<span class="op">.</span><span class="fu">forEach</span>((p) <span class="kw">=&gt;</span> {</span>
<span id="cb3-1209"><a href="#cb3-1209" aria-hidden="true" tabindex="-1"></a>    <span class="kw">const</span> points <span class="op">=</span> [</span>
<span id="cb3-1210"><a href="#cb3-1210" aria-hidden="true" tabindex="-1"></a>      <span class="op">...</span>p<span class="op">.</span><span class="fu">map</span>(([d<span class="op">,</span> l]) <span class="kw">=&gt;</span> <span class="vs">`</span><span class="sc">${</span><span class="fu">xScale</span>(<span class="dv">12</span> <span class="op">-</span> l <span class="op">/</span> <span class="dv">2</span>)<span class="sc">}</span><span class="vs">,</span><span class="sc">${</span><span class="fu">yScale</span>(d)<span class="sc">}</span><span class="vs">`</span>)<span class="op">,</span></span>
<span id="cb3-1211"><a href="#cb3-1211" aria-hidden="true" tabindex="-1"></a>      <span class="op">...</span>p<span class="op">.</span><span class="fu">reverse</span>()<span class="op">.</span><span class="fu">map</span>(([d<span class="op">,</span> l]) <span class="kw">=&gt;</span> <span class="vs">`</span><span class="sc">${</span><span class="fu">xScale</span>(<span class="dv">12</span> <span class="op">+</span> l <span class="op">/</span> <span class="dv">2</span>)<span class="sc">}</span><span class="vs">,</span><span class="sc">${</span><span class="fu">yScale</span>(d)<span class="sc">}</span><span class="vs">`</span>)</span>
<span id="cb3-1212"><a href="#cb3-1212" aria-hidden="true" tabindex="-1"></a>    ]<span class="op">.</span><span class="fu">join</span>(<span class="st">" "</span>)<span class="op">;</span></span>
<span id="cb3-1213"><a href="#cb3-1213" aria-hidden="true" tabindex="-1"></a>    <span class="bu">root</span><span class="op">.</span><span class="fu">append</span>(<span class="st">"polygon"</span>)<span class="op">.</span><span class="fu">attr</span>(<span class="st">"points"</span><span class="op">,</span> points)<span class="op">.</span><span class="fu">attr</span>(<span class="st">"fill"</span><span class="op">,</span> colors<span class="op">.</span><span class="at">day</span>)<span class="op">;</span></span>
<span id="cb3-1214"><a href="#cb3-1214" aria-hidden="true" tabindex="-1"></a>  })<span class="op">;</span></span>
<span id="cb3-1215"><a href="#cb3-1215" aria-hidden="true" tabindex="-1"></a>  <span class="co">/* Legend */</span></span>
<span id="cb3-1216"><a href="#cb3-1216" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> legend <span class="op">=</span> <span class="bu">root</span></span>
<span id="cb3-1217"><a href="#cb3-1217" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">append</span>(<span class="st">"g"</span>)</span>
<span id="cb3-1218"><a href="#cb3-1218" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">"transform"</span><span class="op">,</span> <span class="vs">`translate(</span><span class="sc">${</span>margin<span class="op">.</span><span class="at">left</span> <span class="op">+</span> chartWidth <span class="op">/</span> <span class="dv">2</span> <span class="op">-</span> <span class="dv">64</span><span class="sc">}</span><span class="vs">)`</span>)<span class="op">;</span></span>
<span id="cb3-1219"><a href="#cb3-1219" aria-hidden="true" tabindex="-1"></a>  legend</span>
<span id="cb3-1220"><a href="#cb3-1220" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">append</span>(<span class="st">"rect"</span>)</span>
<span id="cb3-1221"><a href="#cb3-1221" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">"rx"</span><span class="op">,</span> <span class="dv">5</span>)</span>
<span id="cb3-1222"><a href="#cb3-1222" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">"x"</span><span class="op">,</span> <span class="op">-</span><span class="dv">34</span> <span class="op">+</span> <span class="dv">4</span> <span class="op">*</span> (width <span class="op">&lt;</span> <span class="dv">165</span> <span class="op">?</span> <span class="fl">12.7</span> <span class="op">:</span> width <span class="op">&lt;</span> <span class="dv">265</span> <span class="op">?</span> <span class="fl">5.5</span> <span class="op">:</span> width <span class="op">&lt;</span> <span class="dv">365</span> <span class="op">?</span> <span class="dv">3</span> <span class="op">:</span> <span class="dv">0</span>))</span>
<span id="cb3-1223"><a href="#cb3-1223" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">"y"</span><span class="op">,</span> <span class="fl">4.5</span> <span class="op">*</span> (width <span class="op">&lt;</span> <span class="dv">165</span> <span class="op">?</span> <span class="fl">1.9</span> <span class="op">:</span> width <span class="op">&lt;</span> <span class="dv">265</span> <span class="op">?</span> <span class="fl">1.4</span> <span class="op">:</span> width <span class="op">&lt;</span> <span class="dv">365</span> <span class="op">?</span> <span class="op">.</span><span class="dv">9</span> <span class="op">:</span> <span class="op">.</span><span class="dv">8</span>))</span>
<span id="cb3-1224"><a href="#cb3-1224" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">"width"</span><span class="op">,</span> fontSize <span class="op">*</span> (width <span class="op">&lt;</span> <span class="dv">165</span> <span class="op">?</span> <span class="dv">1</span> <span class="op">:</span> width <span class="op">&lt;</span> <span class="dv">265</span> <span class="op">?</span> <span class="fl">1.2</span> <span class="op">:</span> width <span class="op">&lt;</span> <span class="dv">365</span> <span class="op">?</span> <span class="fl">1.4</span> <span class="op">:</span> <span class="fl">1.6</span>))</span>
<span id="cb3-1225"><a href="#cb3-1225" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">"height"</span><span class="op">,</span> fontSize <span class="op">*</span> (width <span class="op">&lt;</span> <span class="dv">165</span> <span class="op">?</span> <span class="dv">1</span> <span class="op">:</span> width <span class="op">&lt;</span> <span class="dv">265</span> <span class="op">?</span> <span class="fl">1.2</span> <span class="op">:</span> width <span class="op">&lt;</span> <span class="dv">365</span> <span class="op">?</span> <span class="fl">1.4</span> <span class="op">:</span> <span class="fl">1.6</span>))</span>
<span id="cb3-1226"><a href="#cb3-1226" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">"fill"</span><span class="op">,</span> colors<span class="op">.</span><span class="at">night</span>)<span class="op">;</span></span>
<span id="cb3-1227"><a href="#cb3-1227" aria-hidden="true" tabindex="-1"></a>  legend</span>
<span id="cb3-1228"><a href="#cb3-1228" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">append</span>(<span class="st">"text"</span>)</span>
<span id="cb3-1229"><a href="#cb3-1229" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">"x"</span><span class="op">,</span> <span class="op">-</span><span class="dv">16</span> <span class="op">+</span> <span class="dv">4</span> <span class="op">*</span> (width <span class="op">&lt;</span> <span class="dv">165</span> <span class="op">?</span> <span class="fl">11.8</span> <span class="op">:</span> width <span class="op">&lt;</span> <span class="dv">265</span> <span class="op">?</span> <span class="fl">4.9</span> <span class="op">:</span> width <span class="op">&lt;</span> <span class="dv">365</span> <span class="op">?</span> <span class="fl">2.8</span> <span class="op">:</span> <span class="dv">0</span>))</span>
<span id="cb3-1230"><a href="#cb3-1230" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">"y"</span><span class="op">,</span> <span class="dv">19</span>)</span>
<span id="cb3-1231"><a href="#cb3-1231" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">"font-size"</span><span class="op">,</span> fontSize <span class="op">*</span> (width <span class="op">&lt;</span> <span class="dv">165</span> <span class="op">?</span> <span class="dv">1</span> <span class="op">:</span> width <span class="op">&lt;</span> <span class="dv">265</span> <span class="op">?</span> <span class="fl">1.2</span> <span class="op">:</span> width <span class="op">&lt;</span> <span class="dv">365</span> <span class="op">?</span> <span class="fl">1.4</span> <span class="op">:</span> <span class="fl">1.6</span>))</span>
<span id="cb3-1232"><a href="#cb3-1232" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">"font-family"</span><span class="op">,</span> <span class="st">"sans-serif"</span>)</span>
<span id="cb3-1233"><a href="#cb3-1233" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">text</span>(<span class="st">"Night"</span>)<span class="op">;</span></span>
<span id="cb3-1234"><a href="#cb3-1234" aria-hidden="true" tabindex="-1"></a>  legend</span>
<span id="cb3-1235"><a href="#cb3-1235" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">append</span>(<span class="st">"rect"</span>)</span>
<span id="cb3-1236"><a href="#cb3-1236" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">"x"</span><span class="op">,</span> <span class="dv">34</span> <span class="op">+</span> <span class="dv">4</span> <span class="op">*</span> (width <span class="op">&lt;</span> <span class="dv">165</span> <span class="op">?</span> <span class="fl">7.8</span> <span class="op">:</span> width <span class="op">&lt;</span> <span class="dv">265</span> <span class="op">?</span> <span class="fl">8.2</span> <span class="op">:</span> width <span class="op">&lt;</span> <span class="dv">365</span> <span class="op">?</span> <span class="fl">6.9</span> <span class="op">:</span> <span class="fl">4.2</span>))</span>
<span id="cb3-1237"><a href="#cb3-1237" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">"rx"</span><span class="op">,</span> <span class="dv">5</span>)</span>
<span id="cb3-1238"><a href="#cb3-1238" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">"y"</span><span class="op">,</span> <span class="fl">4.5</span> <span class="op">*</span> (width <span class="op">&lt;</span> <span class="dv">165</span> <span class="op">?</span> <span class="fl">1.9</span> <span class="op">:</span> width <span class="op">&lt;</span> <span class="dv">265</span> <span class="op">?</span> <span class="fl">1.4</span> <span class="op">:</span> width <span class="op">&lt;</span> <span class="dv">365</span> <span class="op">?</span> <span class="op">.</span><span class="dv">9</span> <span class="op">:</span> <span class="op">.</span><span class="dv">8</span>))</span>
<span id="cb3-1239"><a href="#cb3-1239" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">"width"</span><span class="op">,</span> fontSize <span class="op">*</span> (width <span class="op">&lt;</span> <span class="dv">165</span> <span class="op">?</span> <span class="dv">1</span> <span class="op">:</span> width <span class="op">&lt;</span> <span class="dv">265</span> <span class="op">?</span> <span class="fl">1.2</span> <span class="op">:</span> width <span class="op">&lt;</span> <span class="dv">365</span> <span class="op">?</span> <span class="fl">1.4</span> <span class="op">:</span> <span class="fl">1.6</span>))</span>
<span id="cb3-1240"><a href="#cb3-1240" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">"height"</span><span class="op">,</span> fontSize <span class="op">*</span> (width <span class="op">&lt;</span> <span class="dv">165</span> <span class="op">?</span> <span class="dv">1</span> <span class="op">:</span> width <span class="op">&lt;</span> <span class="dv">265</span> <span class="op">?</span> <span class="fl">1.2</span> <span class="op">:</span> width <span class="op">&lt;</span> <span class="dv">365</span> <span class="op">?</span> <span class="fl">1.4</span> <span class="op">:</span> <span class="fl">1.6</span>))</span>
<span id="cb3-1241"><a href="#cb3-1241" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">"fill"</span><span class="op">,</span> colors<span class="op">.</span><span class="at">day</span>)<span class="op">;</span></span>
<span id="cb3-1242"><a href="#cb3-1242" aria-hidden="true" tabindex="-1"></a>  legend</span>
<span id="cb3-1243"><a href="#cb3-1243" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">append</span>(<span class="st">"text"</span>)</span>
<span id="cb3-1244"><a href="#cb3-1244" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">"x"</span><span class="op">,</span> <span class="dv">52</span> <span class="op">+</span> <span class="dv">4</span> <span class="op">*</span> (width <span class="op">&lt;</span> <span class="dv">165</span> <span class="op">?</span> <span class="fl">6.8</span> <span class="op">:</span> width <span class="op">&lt;</span> <span class="dv">265</span> <span class="op">?</span> <span class="fl">7.8</span> <span class="op">:</span> width <span class="op">&lt;</span> <span class="dv">365</span> <span class="op">?</span> <span class="fl">6.9</span> <span class="op">:</span> <span class="fl">4.2</span>))</span>
<span id="cb3-1245"><a href="#cb3-1245" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">"y"</span><span class="op">,</span> <span class="dv">19</span>)</span>
<span id="cb3-1246"><a href="#cb3-1246" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">"font-size"</span><span class="op">,</span> fontSize <span class="op">*</span> (width <span class="op">&lt;</span> <span class="dv">165</span> <span class="op">?</span> <span class="dv">1</span> <span class="op">:</span> width <span class="op">&lt;</span> <span class="dv">265</span> <span class="op">?</span> <span class="fl">1.2</span> <span class="op">:</span> width <span class="op">&lt;</span> <span class="dv">365</span> <span class="op">?</span> <span class="fl">1.4</span> <span class="op">:</span> <span class="fl">1.6</span>))</span>
<span id="cb3-1247"><a href="#cb3-1247" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">"font-family"</span><span class="op">,</span> <span class="st">"sans-serif"</span>)</span>
<span id="cb3-1248"><a href="#cb3-1248" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">text</span>(<span class="st">"Day"</span>)<span class="op">;</span></span>
<span id="cb3-1249"><a href="#cb3-1249" aria-hidden="true" tabindex="-1"></a>  <span class="co">/* Time and date controls */</span></span>
<span id="cb3-1250"><a href="#cb3-1250" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> dateLine <span class="op">=</span> <span class="bu">root</span><span class="op">.</span><span class="fu">append</span>(<span class="st">"g"</span>)<span class="op">;</span></span>
<span id="cb3-1251"><a href="#cb3-1251" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> updateControlPositions <span class="op">=</span> () <span class="kw">=&gt;</span> {</span>
<span id="cb3-1252"><a href="#cb3-1252" aria-hidden="true" tabindex="-1"></a>    dateLine</span>
<span id="cb3-1253"><a href="#cb3-1253" aria-hidden="true" tabindex="-1"></a>      <span class="op">.</span><span class="fu">select</span>(<span class="st">"line"</span>)</span>
<span id="cb3-1254"><a href="#cb3-1254" aria-hidden="true" tabindex="-1"></a>      <span class="op">.</span><span class="fu">attr</span>(<span class="st">"id"</span><span class="op">,</span> <span class="st">"dateline"</span>)</span>
<span id="cb3-1255"><a href="#cb3-1255" aria-hidden="true" tabindex="-1"></a>      <span class="op">.</span><span class="fu">attr</span>(<span class="st">"x1"</span><span class="op">,</span> <span class="fu">xScale</span>(<span class="dv">0</span>))</span>
<span id="cb3-1256"><a href="#cb3-1256" aria-hidden="true" tabindex="-1"></a>      <span class="op">.</span><span class="fu">attr</span>(<span class="st">"y1"</span><span class="op">,</span> <span class="fu">yScale</span>(date))</span>
<span id="cb3-1257"><a href="#cb3-1257" aria-hidden="true" tabindex="-1"></a>      <span class="op">.</span><span class="fu">attr</span>(<span class="st">"x2"</span><span class="op">,</span> <span class="fu">xScale</span>(<span class="dv">24</span>))</span>
<span id="cb3-1258"><a href="#cb3-1258" aria-hidden="true" tabindex="-1"></a>      <span class="op">.</span><span class="fu">attr</span>(<span class="st">"y2"</span><span class="op">,</span> <span class="fu">yScale</span>(date))<span class="op">;</span></span>
<span id="cb3-1259"><a href="#cb3-1259" aria-hidden="true" tabindex="-1"></a>    dateLine</span>
<span id="cb3-1260"><a href="#cb3-1260" aria-hidden="true" tabindex="-1"></a>      <span class="op">.</span><span class="fu">select</span>(<span class="st">"rect"</span>)</span>
<span id="cb3-1261"><a href="#cb3-1261" aria-hidden="true" tabindex="-1"></a>      <span class="op">.</span><span class="fu">attr</span>(<span class="st">"id"</span><span class="op">,</span> <span class="st">"daterect"</span>)</span>
<span id="cb3-1262"><a href="#cb3-1262" aria-hidden="true" tabindex="-1"></a>      <span class="op">.</span><span class="fu">attr</span>(<span class="st">"x"</span><span class="op">,</span> <span class="fu">xScale</span>(<span class="dv">0</span>))</span>
<span id="cb3-1263"><a href="#cb3-1263" aria-hidden="true" tabindex="-1"></a>      <span class="op">.</span><span class="fu">attr</span>(<span class="st">"y"</span><span class="op">,</span> <span class="fu">yScale</span>(date) <span class="op">-</span> <span class="dv">4</span>)<span class="op">;</span></span>
<span id="cb3-1264"><a href="#cb3-1264" aria-hidden="true" tabindex="-1"></a>    <span class="bu">root</span></span>
<span id="cb3-1265"><a href="#cb3-1265" aria-hidden="true" tabindex="-1"></a>      <span class="op">.</span><span class="fu">select</span>(<span class="st">"#time-control"</span>)</span>
<span id="cb3-1266"><a href="#cb3-1266" aria-hidden="true" tabindex="-1"></a>      <span class="op">.</span><span class="fu">attr</span>(<span class="st">"cx"</span><span class="op">,</span> <span class="fu">xScale</span>(hour))</span>
<span id="cb3-1267"><a href="#cb3-1267" aria-hidden="true" tabindex="-1"></a>      <span class="op">.</span><span class="fu">attr</span>(<span class="st">"cy"</span><span class="op">,</span> <span class="fu">yScale</span>(date))<span class="op">;</span></span>
<span id="cb3-1268"><a href="#cb3-1268" aria-hidden="true" tabindex="-1"></a>  }<span class="op">;</span></span>
<span id="cb3-1269"><a href="#cb3-1269" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> dispatchDateHourChange <span class="op">=</span> () <span class="kw">=&gt;</span> {</span>
<span id="cb3-1270"><a href="#cb3-1270" aria-hidden="true" tabindex="-1"></a>    <span class="kw">const</span> detail <span class="op">=</span> { date<span class="op">,</span> hour }<span class="op">;</span></span>
<span id="cb3-1271"><a href="#cb3-1271" aria-hidden="true" tabindex="-1"></a>    <span class="kw">const</span> changeEvent <span class="op">=</span> <span class="kw">new</span> <span class="bu">CustomEvent</span>(EventType<span class="op">.</span><span class="at">DateHourChange</span><span class="op">,</span> {</span>
<span id="cb3-1272"><a href="#cb3-1272" aria-hidden="true" tabindex="-1"></a>      detail<span class="op">,</span></span>
<span id="cb3-1273"><a href="#cb3-1273" aria-hidden="true" tabindex="-1"></a>      <span class="dt">bubbles</span><span class="op">:</span> <span class="kw">true</span></span>
<span id="cb3-1274"><a href="#cb3-1274" aria-hidden="true" tabindex="-1"></a>    })<span class="op">;</span></span>
<span id="cb3-1275"><a href="#cb3-1275" aria-hidden="true" tabindex="-1"></a>    <span class="bu">root</span><span class="op">.</span><span class="fu">node</span>()<span class="op">.</span><span class="fu">dispatchEvent</span>(changeEvent)<span class="op">;</span></span>
<span id="cb3-1276"><a href="#cb3-1276" aria-hidden="true" tabindex="-1"></a>  }<span class="op">;</span></span>
<span id="cb3-1277"><a href="#cb3-1277" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> handleDateLineDrag <span class="op">=</span> ({ y }) <span class="kw">=&gt;</span> {</span>
<span id="cb3-1278"><a href="#cb3-1278" aria-hidden="true" tabindex="-1"></a>    date <span class="op">=</span> yScale<span class="op">.</span><span class="fu">invert</span>(y)<span class="op">;</span></span>
<span id="cb3-1279"><a href="#cb3-1279" aria-hidden="true" tabindex="-1"></a>    <span class="fu">updateControlPositions</span>()<span class="op">;</span></span>
<span id="cb3-1280"><a href="#cb3-1280" aria-hidden="true" tabindex="-1"></a>    <span class="fu">dispatchDateHourChange</span>()<span class="op">;</span></span>
<span id="cb3-1281"><a href="#cb3-1281" aria-hidden="true" tabindex="-1"></a>  }<span class="op">;</span></span>
<span id="cb3-1282"><a href="#cb3-1282" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> handleTimeCircleDrag <span class="op">=</span> ({ x }) <span class="kw">=&gt;</span> {</span>
<span id="cb3-1283"><a href="#cb3-1283" aria-hidden="true" tabindex="-1"></a>    hour <span class="op">=</span> xScale<span class="op">.</span><span class="fu">invert</span>(x)<span class="op">;</span></span>
<span id="cb3-1284"><a href="#cb3-1284" aria-hidden="true" tabindex="-1"></a>    <span class="fu">updateControlPositions</span>()<span class="op">;</span></span>
<span id="cb3-1285"><a href="#cb3-1285" aria-hidden="true" tabindex="-1"></a>    <span class="fu">dispatchDateHourChange</span>()<span class="op">;</span></span>
<span id="cb3-1286"><a href="#cb3-1286" aria-hidden="true" tabindex="-1"></a>  }<span class="op">;</span></span>
<span id="cb3-1287"><a href="#cb3-1287" aria-hidden="true" tabindex="-1"></a>  dateLine<span class="op">.</span><span class="fu">append</span>(<span class="st">"line"</span>)<span class="op">.</span><span class="fu">attr</span>(<span class="st">"stroke-width"</span><span class="op">,</span> <span class="dv">4</span>)<span class="op">.</span><span class="fu">attr</span>(<span class="st">"stroke"</span><span class="op">,</span> <span class="st">"red"</span>)<span class="op">;</span></span>
<span id="cb3-1288"><a href="#cb3-1288" aria-hidden="true" tabindex="-1"></a>  dateLine</span>
<span id="cb3-1289"><a href="#cb3-1289" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">append</span>(<span class="st">"rect"</span>)</span>
<span id="cb3-1290"><a href="#cb3-1290" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">"width"</span><span class="op">,</span> chartWidth)</span>
<span id="cb3-1291"><a href="#cb3-1291" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">"height"</span><span class="op">,</span> <span class="dv">8</span>)</span>
<span id="cb3-1292"><a href="#cb3-1292" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">"fill"</span><span class="op">,</span> <span class="st">"rgba(0, 0, 0, 0)"</span>)</span>
<span id="cb3-1293"><a href="#cb3-1293" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">style</span>(<span class="st">"cursor"</span><span class="op">,</span> <span class="st">"row-resize"</span>)</span>
<span id="cb3-1294"><a href="#cb3-1294" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">call</span>(d3<span class="op">.</span><span class="fu">drag</span>()<span class="op">.</span><span class="fu">on</span>(<span class="st">"drag"</span><span class="op">,</span> handleDateLineDrag))<span class="op">;</span></span>
<span id="cb3-1295"><a href="#cb3-1295" aria-hidden="true" tabindex="-1"></a>  <span class="bu">root</span></span>
<span id="cb3-1296"><a href="#cb3-1296" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">append</span>(<span class="st">"circle"</span>)</span>
<span id="cb3-1297"><a href="#cb3-1297" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">"id"</span><span class="op">,</span> <span class="st">"time-control"</span>)</span>
<span id="cb3-1298"><a href="#cb3-1298" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">"r"</span><span class="op">,</span> <span class="dv">12</span>)</span>
<span id="cb3-1299"><a href="#cb3-1299" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">"fill"</span><span class="op">,</span> <span class="st">"red"</span>)</span>
<span id="cb3-1300"><a href="#cb3-1300" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">"stroke-width"</span><span class="op">,</span> <span class="op">.</span><span class="dv">6</span>)</span>
<span id="cb3-1301"><a href="#cb3-1301" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">"stroke"</span><span class="op">,</span> <span class="st">"black"</span>)</span>
<span id="cb3-1302"><a href="#cb3-1302" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">style</span>(<span class="st">"cursor"</span><span class="op">,</span> <span class="st">"pointer"</span>)</span>
<span id="cb3-1303"><a href="#cb3-1303" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">call</span>(d3<span class="op">.</span><span class="fu">drag</span>()<span class="op">.</span><span class="fu">on</span>(<span class="st">"drag"</span><span class="op">,</span> handleTimeCircleDrag))<span class="op">;</span></span>
<span id="cb3-1304"><a href="#cb3-1304" aria-hidden="true" tabindex="-1"></a>  <span class="fu">updateControlPositions</span>()<span class="op">;</span></span>
<span id="cb3-1305"><a href="#cb3-1305" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb3-1306"><a href="#cb3-1306" aria-hidden="true" tabindex="-1"></a>fontSize <span class="op">=</span> <span class="dv">12</span><span class="op">;</span></span>
<span id="cb3-1307"><a href="#cb3-1307" aria-hidden="true" tabindex="-1"></a>getSolarAngle <span class="op">=</span> (date) <span class="kw">=&gt;</span> (<span class="fu">dayOfYear</span>(date) <span class="op">+</span> <span class="dv">10</span>) <span class="op">/</span> <span class="dv">365</span> <span class="op">*</span> <span class="bu">Math</span><span class="op">.</span><span class="cn">PI</span> <span class="op">*</span> <span class="dv">2</span> <span class="op">-</span> <span class="bu">Math</span><span class="op">.</span><span class="cn">PI</span> <span class="op">/</span> <span class="dv">2</span><span class="op">;</span></span>
<span id="cb3-1308"><a href="#cb3-1308" aria-hidden="true" tabindex="-1"></a><span class="co">/*</span></span>
<span id="cb3-1309"><a href="#cb3-1309" aria-hidden="true" tabindex="-1"></a><span class="co"> * Formulas uses the CBM model as reviewed here:</span></span>
<span id="cb3-1310"><a href="#cb3-1310" aria-hidden="true" tabindex="-1"></a><span class="co"> * https://www.ikhebeenvraag.be/mediastorage/FSDocument/171/Forsythe+-+A+model+comparison+for+daylength+as+a+function+of+latitude+and+day+of+year+-+1995.pdf</span></span>
<span id="cb3-1311"><a href="#cb3-1311" aria-hidden="true" tabindex="-1"></a><span class="co"> */</span></span>
<span id="cb3-1312"><a href="#cb3-1312" aria-hidden="true" tabindex="-1"></a>dayLength <span class="op">=</span> (date<span class="op">,</span> latitude) <span class="kw">=&gt;</span> {</span>
<span id="cb3-1313"><a href="#cb3-1313" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> yearStart <span class="op">=</span> <span class="kw">new</span> <span class="bu">Date</span>(date<span class="op">.</span><span class="fu">getFullYear</span>()<span class="op">,</span> <span class="dv">0</span><span class="op">,</span> <span class="dv">1</span>)<span class="op">;</span></span>
<span id="cb3-1314"><a href="#cb3-1314" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> dayOfYear <span class="op">=</span> <span class="bu">Math</span><span class="op">.</span><span class="fu">floor</span>((date<span class="op">.</span><span class="fu">getTime</span>() <span class="op">-</span> yearStart<span class="op">.</span><span class="fu">getTime</span>())<span class="op">/</span><span class="dv">86400000</span>) <span class="op">+</span> <span class="dv">1</span><span class="op">;</span></span>
<span id="cb3-1315"><a href="#cb3-1315" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> revAngle <span class="op">=</span> <span class="fl">0.2163108</span> <span class="op">+</span> <span class="dv">2</span> <span class="op">*</span> <span class="bu">Math</span><span class="op">.</span><span class="fu">atan</span>(<span class="fl">0.9671396</span> <span class="op">*</span> <span class="bu">Math</span><span class="op">.</span><span class="fu">tan</span>(<span class="fl">0.00860</span> <span class="op">*</span> (dayOfYear <span class="op">-</span> <span class="dv">186</span>)))<span class="op">;</span></span>
<span id="cb3-1316"><a href="#cb3-1316" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> decAngle <span class="op">=</span> <span class="bu">Math</span><span class="op">.</span><span class="fu">asin</span>(<span class="fl">0.39795</span> <span class="op">*</span> <span class="bu">Math</span><span class="op">.</span><span class="fu">cos</span>(revAngle))<span class="op">;</span></span>
<span id="cb3-1317"><a href="#cb3-1317" aria-hidden="true" tabindex="-1"></a>  <span class="co">/* daylight coefficient selected for apparent sunrise/sunset */</span></span>
<span id="cb3-1318"><a href="#cb3-1318" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> p <span class="op">=</span> <span class="fl">0.8333</span></span>
<span id="cb3-1319"><a href="#cb3-1319" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> intResult <span class="op">=</span></span>
<span id="cb3-1320"><a href="#cb3-1320" aria-hidden="true" tabindex="-1"></a>    (<span class="bu">Math</span><span class="op">.</span><span class="fu">sin</span>((p <span class="op">*</span> <span class="bu">Math</span><span class="op">.</span><span class="cn">PI</span>) <span class="op">/</span> <span class="dv">180</span>) <span class="op">+</span></span>
<span id="cb3-1321"><a href="#cb3-1321" aria-hidden="true" tabindex="-1"></a>      <span class="bu">Math</span><span class="op">.</span><span class="fu">sin</span>((latitude <span class="op">*</span> <span class="bu">Math</span><span class="op">.</span><span class="cn">PI</span>) <span class="op">/</span> <span class="dv">180</span>) <span class="op">*</span> <span class="bu">Math</span><span class="op">.</span><span class="fu">sin</span>(decAngle)) <span class="op">/</span></span>
<span id="cb3-1322"><a href="#cb3-1322" aria-hidden="true" tabindex="-1"></a>    (<span class="bu">Math</span><span class="op">.</span><span class="fu">cos</span>((latitude <span class="op">*</span> <span class="bu">Math</span><span class="op">.</span><span class="cn">PI</span>) <span class="op">/</span> <span class="dv">180</span>) <span class="op">*</span> <span class="bu">Math</span><span class="op">.</span><span class="fu">cos</span>(decAngle))<span class="op">;</span></span>
<span id="cb3-1323"><a href="#cb3-1323" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (intResult <span class="op">&gt;=</span> <span class="dv">1</span>) <span class="cf">return</span> <span class="dv">24</span><span class="op">;</span></span>
<span id="cb3-1324"><a href="#cb3-1324" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (intResult <span class="op">&lt;=</span> <span class="op">-</span><span class="dv">1</span>) <span class="cf">return</span> <span class="dv">0</span><span class="op">;</span></span>
<span id="cb3-1325"><a href="#cb3-1325" aria-hidden="true" tabindex="-1"></a>  <span class="cf">return</span> <span class="dv">24</span> <span class="op">-</span> <span class="dv">24</span> <span class="op">*</span> <span class="bu">Math</span><span class="op">.</span><span class="fu">acos</span>(intResult) <span class="op">/</span> <span class="bu">Math</span><span class="op">.</span><span class="cn">PI</span><span class="op">;</span></span>
<span id="cb3-1326"><a href="#cb3-1326" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb3-1327"><a href="#cb3-1327" aria-hidden="true" tabindex="-1"></a>yearDates <span class="op">=</span> (year) <span class="kw">=&gt;</span> {</span>
<span id="cb3-1328"><a href="#cb3-1328" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> startDate <span class="op">=</span> <span class="kw">new</span> <span class="bu">Date</span>(year<span class="op">,</span> <span class="dv">0</span><span class="op">,</span> <span class="dv">1</span><span class="op">+</span><span class="dv">60</span>)<span class="op">;</span></span>
<span id="cb3-1329"><a href="#cb3-1329" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> endDate <span class="op">=</span> <span class="kw">new</span> <span class="bu">Date</span>(year <span class="op">+</span> <span class="dv">1</span><span class="op">,</span> <span class="dv">0</span><span class="op">,</span> <span class="dv">1</span><span class="op">+</span><span class="dv">60</span>)<span class="op">;</span></span>
<span id="cb3-1330"><a href="#cb3-1330" aria-hidden="true" tabindex="-1"></a>  <span class="cf">return</span> d3<span class="op">.</span><span class="at">timeDay</span><span class="op">.</span><span class="fu">range</span>(startDate<span class="op">,</span> endDate)<span class="op">;</span></span>
<span id="cb3-1331"><a href="#cb3-1331" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb3-1332"><a href="#cb3-1332" aria-hidden="true" tabindex="-1"></a>height <span class="op">=</span> <span class="fl">0.65</span> <span class="op">*</span> width<span class="op">;</span></span>
<span id="cb3-1333"><a href="#cb3-1333" aria-hidden="true" tabindex="-1"></a>EventType <span class="op">=</span> ({</span>
<span id="cb3-1334"><a href="#cb3-1334" aria-hidden="true" tabindex="-1"></a>  <span class="dt">LocationChange</span><span class="op">:</span> <span class="st">"LOCATION_CHANGE"</span><span class="op">,</span></span>
<span id="cb3-1335"><a href="#cb3-1335" aria-hidden="true" tabindex="-1"></a>  <span class="dt">DateHourChange</span><span class="op">:</span> <span class="st">"DATE_HOUR_CHANGE"</span></span>
<span id="cb3-1336"><a href="#cb3-1336" aria-hidden="true" tabindex="-1"></a>})</span>
<span id="cb3-1337"><a href="#cb3-1337" aria-hidden="true" tabindex="-1"></a>colors <span class="op">=</span> ({</span>
<span id="cb3-1338"><a href="#cb3-1338" aria-hidden="true" tabindex="-1"></a>  <span class="dt">night</span><span class="op">:</span> <span class="st">"#719fb6"</span><span class="op">,</span></span>
<span id="cb3-1339"><a href="#cb3-1339" aria-hidden="true" tabindex="-1"></a>  <span class="dt">day</span><span class="op">:</span> <span class="st">"#ffe438"</span><span class="op">,</span></span>
<span id="cb3-1340"><a href="#cb3-1340" aria-hidden="true" tabindex="-1"></a>  <span class="dt">grid</span><span class="op">:</span> <span class="st">"#4b6a79"</span><span class="op">,</span></span>
<span id="cb3-1341"><a href="#cb3-1341" aria-hidden="true" tabindex="-1"></a>  <span class="dt">ocean</span><span class="op">:</span> <span class="st">"#adeeff"</span><span class="op">,</span></span>
<span id="cb3-1342"><a href="#cb3-1342" aria-hidden="true" tabindex="-1"></a>  <span class="dt">land</span><span class="op">:</span> <span class="st">"#f5f1dc"</span><span class="op">,</span></span>
<span id="cb3-1343"><a href="#cb3-1343" aria-hidden="true" tabindex="-1"></a>  <span class="dt">sun</span><span class="op">:</span> <span class="st">"#ffe438"</span></span>
<span id="cb3-1344"><a href="#cb3-1344" aria-hidden="true" tabindex="-1"></a>})</span>
<span id="cb3-1345"><a href="#cb3-1345" aria-hidden="true" tabindex="-1"></a>toRadians <span class="op">=</span> (val) <span class="kw">=&gt;</span> val <span class="op">*</span> <span class="bu">Math</span><span class="op">.</span><span class="cn">PI</span> <span class="op">/</span> <span class="dv">180</span></span>
<span id="cb3-1346"><a href="#cb3-1346" aria-hidden="true" tabindex="-1"></a>toDegrees <span class="op">=</span> (val) <span class="kw">=&gt;</span> val <span class="op">*</span> <span class="dv">180</span> <span class="op">/</span> <span class="bu">Math</span><span class="op">.</span><span class="cn">PI</span><span class="op">;</span></span>
<span id="cb3-1347"><a href="#cb3-1347" aria-hidden="true" tabindex="-1"></a>land <span class="op">=</span> topojson<span class="op">.</span><span class="fu">feature</span>(world<span class="op">,</span> world<span class="op">.</span><span class="at">objects</span><span class="op">.</span><span class="at">land</span>)<span class="op">;</span></span>
<span id="cb3-1348"><a href="#cb3-1348" aria-hidden="true" tabindex="-1"></a>d3 <span class="op">=</span> <span class="pp">require</span>(<span class="st">"d3@7"</span><span class="op">,</span> <span class="st">"d3-geo-projection@3"</span>)</span>
<span id="cb3-1349"><a href="#cb3-1349" aria-hidden="true" tabindex="-1"></a><span class="kw">function</span> <span class="fu">input</span>(config) {</span>
<span id="cb3-1350"><a href="#cb3-1350" aria-hidden="true" tabindex="-1"></a>  <span class="kw">let</span> {</span>
<span id="cb3-1351"><a href="#cb3-1351" aria-hidden="true" tabindex="-1"></a>    form<span class="op">,</span></span>
<span id="cb3-1352"><a href="#cb3-1352" aria-hidden="true" tabindex="-1"></a>    type <span class="op">=</span> <span class="st">"text"</span><span class="op">,</span></span>
<span id="cb3-1353"><a href="#cb3-1353" aria-hidden="true" tabindex="-1"></a>    attributes <span class="op">=</span> {}<span class="op">,</span></span>
<span id="cb3-1354"><a href="#cb3-1354" aria-hidden="true" tabindex="-1"></a>    action<span class="op">,</span></span>
<span id="cb3-1355"><a href="#cb3-1355" aria-hidden="true" tabindex="-1"></a>    getValue<span class="op">,</span></span>
<span id="cb3-1356"><a href="#cb3-1356" aria-hidden="true" tabindex="-1"></a>    title<span class="op">,</span></span>
<span id="cb3-1357"><a href="#cb3-1357" aria-hidden="true" tabindex="-1"></a>    description<span class="op">,</span></span>
<span id="cb3-1358"><a href="#cb3-1358" aria-hidden="true" tabindex="-1"></a>    format<span class="op">,</span></span>
<span id="cb3-1359"><a href="#cb3-1359" aria-hidden="true" tabindex="-1"></a>    display<span class="op">,</span></span>
<span id="cb3-1360"><a href="#cb3-1360" aria-hidden="true" tabindex="-1"></a>    submit<span class="op">,</span></span>
<span id="cb3-1361"><a href="#cb3-1361" aria-hidden="true" tabindex="-1"></a>    options</span>
<span id="cb3-1362"><a href="#cb3-1362" aria-hidden="true" tabindex="-1"></a>  } <span class="op">=</span> config<span class="op">;</span></span>
<span id="cb3-1363"><a href="#cb3-1363" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> wrapper <span class="op">=</span> <span class="fu">html</span><span class="vs">`&lt;div&gt;&lt;/div&gt;`</span><span class="op">;</span></span>
<span id="cb3-1364"><a href="#cb3-1364" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (<span class="op">!</span>form)</span>
<span id="cb3-1365"><a href="#cb3-1365" aria-hidden="true" tabindex="-1"></a>    form <span class="op">=</span> <span class="fu">html</span><span class="vs">`&lt;form&gt;</span></span>
<span id="cb3-1366"><a href="#cb3-1366" aria-hidden="true" tabindex="-1"></a><span class="vs">    &lt;input name=input type=</span><span class="sc">${</span>type<span class="sc">}</span><span class="vs"> /&gt;</span></span>
<span id="cb3-1367"><a href="#cb3-1367" aria-hidden="true" tabindex="-1"></a><span class="vs">  &lt;/form&gt;`</span><span class="op">;</span></span>
<span id="cb3-1368"><a href="#cb3-1368" aria-hidden="true" tabindex="-1"></a>  <span class="bu">Object</span><span class="op">.</span><span class="fu">keys</span>(attributes)<span class="op">.</span><span class="fu">forEach</span>(key <span class="kw">=&gt;</span> {</span>
<span id="cb3-1369"><a href="#cb3-1369" aria-hidden="true" tabindex="-1"></a>    <span class="kw">const</span> val <span class="op">=</span> attributes[key]<span class="op">;</span></span>
<span id="cb3-1370"><a href="#cb3-1370" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> (val <span class="op">!=</span> <span class="kw">null</span>) form<span class="op">.</span><span class="at">input</span><span class="op">.</span><span class="fu">setAttribute</span>(key<span class="op">,</span> val)<span class="op">;</span></span>
<span id="cb3-1371"><a href="#cb3-1371" aria-hidden="true" tabindex="-1"></a>  })<span class="op">;</span></span>
<span id="cb3-1372"><a href="#cb3-1372" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (submit)</span>
<span id="cb3-1373"><a href="#cb3-1373" aria-hidden="true" tabindex="-1"></a>    form<span class="op">.</span><span class="fu">append</span>(</span>
<span id="cb3-1374"><a href="#cb3-1374" aria-hidden="true" tabindex="-1"></a>      <span class="fu">html</span><span class="vs">`&lt;input name=submit type=submit style="margin: 0 0.75em" value="</span><span class="sc">${</span></span>
<span id="cb3-1375"><a href="#cb3-1375" aria-hidden="true" tabindex="-1"></a>        <span class="kw">typeof</span> submit <span class="op">==</span> <span class="st">"string"</span> <span class="op">?</span> submit <span class="op">:</span> <span class="st">"Submit"</span></span>
<span id="cb3-1376"><a href="#cb3-1376" aria-hidden="true" tabindex="-1"></a>      <span class="sc">}</span><span class="vs">" /&gt;`</span></span>
<span id="cb3-1377"><a href="#cb3-1377" aria-hidden="true" tabindex="-1"></a>    )<span class="op">;</span></span>
<span id="cb3-1378"><a href="#cb3-1378" aria-hidden="true" tabindex="-1"></a>  form<span class="op">.</span><span class="fu">append</span>(</span>
<span id="cb3-1379"><a href="#cb3-1379" aria-hidden="true" tabindex="-1"></a>    <span class="fu">html</span><span class="vs">`&lt;output name=output style="font: 14px Menlo, Consolas, monospace; margin-left: 0.1em; text-align:center;"&gt;&lt;/output&gt;`</span></span>
<span id="cb3-1380"><a href="#cb3-1380" aria-hidden="true" tabindex="-1"></a>  )<span class="op">;</span></span>
<span id="cb3-1381"><a href="#cb3-1381" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (title)</span>
<span id="cb3-1382"><a href="#cb3-1382" aria-hidden="true" tabindex="-1"></a>    form<span class="op">.</span><span class="fu">prepend</span>(</span>
<span id="cb3-1383"><a href="#cb3-1383" aria-hidden="true" tabindex="-1"></a>      <span class="fu">html</span><span class="vs">`&lt;div style="font: 700 0.9rem sans-serif; margin-bottom: 3px;"&gt;</span><span class="sc">${</span>title<span class="sc">}</span><span class="vs">&lt;/div&gt;`</span></span>
<span id="cb3-1384"><a href="#cb3-1384" aria-hidden="true" tabindex="-1"></a>    )<span class="op">;</span></span>
<span id="cb3-1385"><a href="#cb3-1385" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (description)</span>
<span id="cb3-1386"><a href="#cb3-1386" aria-hidden="true" tabindex="-1"></a>    form<span class="op">.</span><span class="fu">append</span>(</span>
<span id="cb3-1387"><a href="#cb3-1387" aria-hidden="true" tabindex="-1"></a>      <span class="fu">html</span><span class="vs">`&lt;div style="font-size: 0.85rem; font-style: italic; margin-top: 3px;"&gt;</span><span class="sc">${</span>description<span class="sc">}</span><span class="vs">&lt;/div&gt;`</span></span>
<span id="cb3-1388"><a href="#cb3-1388" aria-hidden="true" tabindex="-1"></a>    )<span class="op">;</span></span>
<span id="cb3-1389"><a href="#cb3-1389" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (format)</span>
<span id="cb3-1390"><a href="#cb3-1390" aria-hidden="true" tabindex="-1"></a>    format <span class="op">=</span> <span class="kw">typeof</span> format <span class="op">===</span> <span class="st">"function"</span> <span class="op">?</span> format <span class="op">:</span> d3format<span class="op">.</span><span class="fu">format</span>(format)<span class="op">;</span></span>
<span id="cb3-1391"><a href="#cb3-1391" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (action) {</span>
<span id="cb3-1392"><a href="#cb3-1392" aria-hidden="true" tabindex="-1"></a>    <span class="fu">action</span>(form)<span class="op">;</span></span>
<span id="cb3-1393"><a href="#cb3-1393" aria-hidden="true" tabindex="-1"></a>  } <span class="cf">else</span> {</span>
<span id="cb3-1394"><a href="#cb3-1394" aria-hidden="true" tabindex="-1"></a>    <span class="kw">const</span> verb <span class="op">=</span> submit</span>
<span id="cb3-1395"><a href="#cb3-1395" aria-hidden="true" tabindex="-1"></a>      <span class="op">?</span> <span class="st">"onsubmit"</span></span>
<span id="cb3-1396"><a href="#cb3-1396" aria-hidden="true" tabindex="-1"></a>      <span class="op">:</span> type <span class="op">==</span> <span class="st">"button"</span></span>
<span id="cb3-1397"><a href="#cb3-1397" aria-hidden="true" tabindex="-1"></a>      <span class="op">?</span> <span class="st">"onclick"</span></span>
<span id="cb3-1398"><a href="#cb3-1398" aria-hidden="true" tabindex="-1"></a>      <span class="op">:</span> type <span class="op">==</span> <span class="st">"checkbox"</span> <span class="op">||</span> type <span class="op">==</span> <span class="st">"radio"</span></span>
<span id="cb3-1399"><a href="#cb3-1399" aria-hidden="true" tabindex="-1"></a>      <span class="op">?</span> <span class="st">"onchange"</span></span>
<span id="cb3-1400"><a href="#cb3-1400" aria-hidden="true" tabindex="-1"></a>      <span class="op">:</span> <span class="st">"oninput"</span><span class="op">;</span></span>
<span id="cb3-1401"><a href="#cb3-1401" aria-hidden="true" tabindex="-1"></a>    form[verb] <span class="op">=</span> e <span class="kw">=&gt;</span> {</span>
<span id="cb3-1402"><a href="#cb3-1402" aria-hidden="true" tabindex="-1"></a>      e <span class="op">&amp;&amp;</span> e<span class="op">.</span><span class="fu">preventDefault</span>()<span class="op">;</span></span>
<span id="cb3-1403"><a href="#cb3-1403" aria-hidden="true" tabindex="-1"></a>      <span class="kw">const</span> value <span class="op">=</span> getValue <span class="op">?</span> <span class="fu">getValue</span>(form<span class="op">.</span><span class="at">input</span>) <span class="op">:</span> form<span class="op">.</span><span class="at">input</span><span class="op">.</span><span class="at">value</span><span class="op">;</span></span>
<span id="cb3-1404"><a href="#cb3-1404" aria-hidden="true" tabindex="-1"></a>      <span class="cf">if</span> (form<span class="op">.</span><span class="at">output</span>) {</span>
<span id="cb3-1405"><a href="#cb3-1405" aria-hidden="true" tabindex="-1"></a>        <span class="kw">const</span> out <span class="op">=</span> display <span class="op">?</span> <span class="fu">display</span>(value) <span class="op">:</span> format <span class="op">?</span> <span class="fu">format</span>(value) <span class="op">:</span> value<span class="op">;</span></span>
<span id="cb3-1406"><a href="#cb3-1406" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> (out <span class="kw">instanceof</span> <span class="bu">window</span><span class="op">.</span><span class="at">Element</span>) {</span>
<span id="cb3-1407"><a href="#cb3-1407" aria-hidden="true" tabindex="-1"></a>          <span class="cf">while</span> (form<span class="op">.</span><span class="at">output</span><span class="op">.</span><span class="fu">hasChildNodes</span>()) {</span>
<span id="cb3-1408"><a href="#cb3-1408" aria-hidden="true" tabindex="-1"></a>            form<span class="op">.</span><span class="at">output</span><span class="op">.</span><span class="fu">removeChild</span>(form<span class="op">.</span><span class="at">output</span><span class="op">.</span><span class="at">lastChild</span>)<span class="op">;</span></span>
<span id="cb3-1409"><a href="#cb3-1409" aria-hidden="true" tabindex="-1"></a>          }</span>
<span id="cb3-1410"><a href="#cb3-1410" aria-hidden="true" tabindex="-1"></a>          form<span class="op">.</span><span class="at">output</span><span class="op">.</span><span class="fu">append</span>(out)<span class="op">;</span></span>
<span id="cb3-1411"><a href="#cb3-1411" aria-hidden="true" tabindex="-1"></a>        } <span class="cf">else</span> {</span>
<span id="cb3-1412"><a href="#cb3-1412" aria-hidden="true" tabindex="-1"></a>          form<span class="op">.</span><span class="at">output</span><span class="op">.</span><span class="at">value</span> <span class="op">=</span> out<span class="op">;</span></span>
<span id="cb3-1413"><a href="#cb3-1413" aria-hidden="true" tabindex="-1"></a>        }</span>
<span id="cb3-1414"><a href="#cb3-1414" aria-hidden="true" tabindex="-1"></a>      }</span>
<span id="cb3-1415"><a href="#cb3-1415" aria-hidden="true" tabindex="-1"></a>      form<span class="op">.</span><span class="at">value</span> <span class="op">=</span> value<span class="op">;</span></span>
<span id="cb3-1416"><a href="#cb3-1416" aria-hidden="true" tabindex="-1"></a>      <span class="cf">if</span> (verb <span class="op">!==</span> <span class="st">"oninput"</span>)</span>
<span id="cb3-1417"><a href="#cb3-1417" aria-hidden="true" tabindex="-1"></a>        form<span class="op">.</span><span class="fu">dispatchEvent</span>(<span class="kw">new</span> <span class="bu">CustomEvent</span>(<span class="st">"input"</span><span class="op">,</span> { <span class="dt">bubbles</span><span class="op">:</span> <span class="kw">true</span> }))<span class="op">;</span></span>
<span id="cb3-1418"><a href="#cb3-1418" aria-hidden="true" tabindex="-1"></a>    }<span class="op">;</span></span>
<span id="cb3-1419"><a href="#cb3-1419" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> (verb <span class="op">!==</span> <span class="st">"oninput"</span>)</span>
<span id="cb3-1420"><a href="#cb3-1420" aria-hidden="true" tabindex="-1"></a>      wrapper<span class="op">.</span><span class="at">oninput</span> <span class="op">=</span> e <span class="kw">=&gt;</span> e <span class="op">&amp;&amp;</span> e<span class="op">.</span><span class="fu">stopPropagation</span>() <span class="op">&amp;&amp;</span> e<span class="op">.</span><span class="fu">preventDefault</span>()<span class="op">;</span></span>
<span id="cb3-1421"><a href="#cb3-1421" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> (verb <span class="op">!==</span> <span class="st">"onsubmit"</span>) form<span class="op">.</span><span class="at">onsubmit</span> <span class="op">=</span> e <span class="kw">=&gt;</span> e <span class="op">&amp;&amp;</span> e<span class="op">.</span><span class="fu">preventDefault</span>()<span class="op">;</span></span>
<span id="cb3-1422"><a href="#cb3-1422" aria-hidden="true" tabindex="-1"></a>    form[verb]()<span class="op">;</span></span>
<span id="cb3-1423"><a href="#cb3-1423" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb3-1424"><a href="#cb3-1424" aria-hidden="true" tabindex="-1"></a>  <span class="cf">while</span> (form<span class="op">.</span><span class="at">childNodes</span><span class="op">.</span><span class="at">length</span>) {</span>
<span id="cb3-1425"><a href="#cb3-1425" aria-hidden="true" tabindex="-1"></a>    wrapper<span class="op">.</span><span class="fu">appendChild</span>(form<span class="op">.</span><span class="at">childNodes</span>[<span class="dv">0</span>])<span class="op">;</span></span>
<span id="cb3-1426"><a href="#cb3-1426" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb3-1427"><a href="#cb3-1427" aria-hidden="true" tabindex="-1"></a>  form<span class="op">.</span><span class="fu">append</span>(wrapper)<span class="op">;</span></span>
<span id="cb3-1428"><a href="#cb3-1428" aria-hidden="true" tabindex="-1"></a>  <span class="cf">return</span> form<span class="op">;</span></span>
<span id="cb3-1429"><a href="#cb3-1429" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb3-1430"><a href="#cb3-1430" aria-hidden="true" tabindex="-1"></a>d3format <span class="op">=</span> <span class="pp">require</span>(<span class="st">"d3-format@1"</span>)</span>
<span id="cb3-1431"><a href="#cb3-1431" aria-hidden="true" tabindex="-1"></a><span class="co">// https://observablehq.com/@enjalot/draggable-world-map-coordinates-input</span></span>
<span id="cb3-1432"><a href="#cb3-1432" aria-hidden="true" tabindex="-1"></a><span class="kw">function</span> <span class="fu">worldMapCoordinates</span>(config <span class="op">=</span> {}<span class="op">,</span> dimensions) {</span>
<span id="cb3-1433"><a href="#cb3-1433" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> {</span>
<span id="cb3-1434"><a href="#cb3-1434" aria-hidden="true" tabindex="-1"></a>    value <span class="op">=</span> []<span class="op">,</span> title<span class="op">,</span> description<span class="op">,</span> width <span class="op">=</span> dimensions[<span class="dv">0</span>]</span>
<span id="cb3-1435"><a href="#cb3-1435" aria-hidden="true" tabindex="-1"></a>  } <span class="op">=</span> <span class="bu">Array</span><span class="op">.</span><span class="fu">isArray</span>(config) <span class="op">?</span> {<span class="dt">value</span><span class="op">:</span> config} <span class="op">:</span> config<span class="op">;</span></span>
<span id="cb3-1436"><a href="#cb3-1436" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> height <span class="op">=</span> dimensions[<span class="dv">1</span>]<span class="op">;</span></span>
<span id="cb3-1437"><a href="#cb3-1437" aria-hidden="true" tabindex="-1"></a>  <span class="kw">let</span> [lon<span class="op">,</span> lat] <span class="op">=</span> value<span class="op">;</span></span>
<span id="cb3-1438"><a href="#cb3-1438" aria-hidden="true" tabindex="-1"></a>  lon <span class="op">=</span> lon <span class="op">!=</span> <span class="kw">null</span> <span class="op">?</span> lon <span class="op">:</span> <span class="kw">null</span><span class="op">;</span></span>
<span id="cb3-1439"><a href="#cb3-1439" aria-hidden="true" tabindex="-1"></a>  lat <span class="op">=</span> lat <span class="op">!=</span> <span class="kw">null</span> <span class="op">?</span> lat <span class="op">:</span> <span class="kw">null</span><span class="op">;</span></span>
<span id="cb3-1440"><a href="#cb3-1440" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> formEl <span class="op">=</span> <span class="fu">html</span><span class="vs">`&lt;form style="width: </span><span class="sc">${</span>width<span class="sc">}</span><span class="vs">px;"&gt;&lt;/form&gt;`</span><span class="op">;</span></span>
<span id="cb3-1441"><a href="#cb3-1441" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> context <span class="op">=</span> DOM<span class="op">.</span><span class="fu">context2d</span>(width<span class="op">,</span> height<span class="op">-</span>width<span class="op">/</span><span class="fl">13.2</span>)<span class="op">;</span></span>
<span id="cb3-1442"><a href="#cb3-1442" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> canvas <span class="op">=</span> context<span class="op">.</span><span class="at">canvas</span><span class="op">;</span></span>
<span id="cb3-1443"><a href="#cb3-1443" aria-hidden="true" tabindex="-1"></a>  canvas<span class="op">.</span><span class="at">style</span><span class="op">.</span><span class="at">margin</span> <span class="op">=</span> <span class="vs">`-10px 0px -26px 0px`</span><span class="op">;</span></span>
<span id="cb3-1444"><a href="#cb3-1444" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> projection <span class="op">=</span> d3</span>
<span id="cb3-1445"><a href="#cb3-1445" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">geoEquirectangular</span>()</span>
<span id="cb3-1446"><a href="#cb3-1446" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">precision</span>(<span class="fl">0.1</span>)</span>
<span id="cb3-1447"><a href="#cb3-1447" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">fitSize</span>([width<span class="op">,</span> height]<span class="op">,</span> { <span class="dt">type</span><span class="op">:</span> <span class="st">"Sphere"</span> })<span class="op">.</span><span class="fu">rotate</span>([<span class="op">-</span><span class="dv">153</span><span class="op">,</span> <span class="dv">0</span>])<span class="op">;</span></span>
<span id="cb3-1448"><a href="#cb3-1448" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> path <span class="op">=</span> d3<span class="op">.</span><span class="fu">geoPath</span>(projection<span class="op">,</span> context)<span class="op">.</span><span class="fu">pointRadius</span>(<span class="fl">2.5</span>)<span class="op">;</span></span>
<span id="cb3-1449"><a href="#cb3-1449" aria-hidden="true" tabindex="-1"></a>  formEl<span class="op">.</span><span class="fu">append</span>(canvas)<span class="op">;</span></span>
<span id="cb3-1450"><a href="#cb3-1450" aria-hidden="true" tabindex="-1"></a>  <span class="kw">function</span> <span class="fu">draw</span>() {</span>
<span id="cb3-1451"><a href="#cb3-1451" aria-hidden="true" tabindex="-1"></a>    context<span class="op">.</span><span class="at">fillStyle</span> <span class="op">=</span> <span class="st">"#fff"</span><span class="op">;</span></span>
<span id="cb3-1452"><a href="#cb3-1452" aria-hidden="true" tabindex="-1"></a>    context<span class="op">.</span><span class="fu">fillRect</span>(<span class="dv">0</span><span class="op">,</span> <span class="dv">0</span><span class="op">,</span> width<span class="op">,</span> height)<span class="op">;</span></span>
<span id="cb3-1453"><a href="#cb3-1453" aria-hidden="true" tabindex="-1"></a>    context<span class="op">.</span><span class="fu">beginPath</span>()<span class="op">;</span> <span class="fu">path</span>({<span class="dt">type</span><span class="op">:</span> <span class="st">"Sphere"</span>})<span class="op">;</span></span>
<span id="cb3-1454"><a href="#cb3-1454" aria-hidden="true" tabindex="-1"></a>    context<span class="op">.</span><span class="at">fillStyle</span> <span class="op">=</span> colors<span class="op">.</span><span class="at">ocean</span><span class="op">;</span> context<span class="op">.</span><span class="fu">fill</span>()<span class="op">;</span></span>
<span id="cb3-1455"><a href="#cb3-1455" aria-hidden="true" tabindex="-1"></a>    context<span class="op">.</span><span class="fu">beginPath</span>()<span class="op">;</span></span>
<span id="cb3-1456"><a href="#cb3-1456" aria-hidden="true" tabindex="-1"></a>    <span class="fu">path</span>(graticule)<span class="op">;</span></span>
<span id="cb3-1457"><a href="#cb3-1457" aria-hidden="true" tabindex="-1"></a>    context<span class="op">.</span><span class="at">lineWidth</span> <span class="op">=</span> <span class="fl">0.95</span><span class="op">;</span></span>
<span id="cb3-1458"><a href="#cb3-1458" aria-hidden="true" tabindex="-1"></a>    context<span class="op">.</span><span class="at">strokeStyle</span> <span class="op">=</span> <span class="vs">`#aaa`</span><span class="op">;</span></span>
<span id="cb3-1459"><a href="#cb3-1459" aria-hidden="true" tabindex="-1"></a>    context<span class="op">.</span><span class="fu">stroke</span>()<span class="op">;</span></span>
<span id="cb3-1460"><a href="#cb3-1460" aria-hidden="true" tabindex="-1"></a>    context<span class="op">.</span><span class="fu">beginPath</span>()<span class="op">;</span></span>
<span id="cb3-1461"><a href="#cb3-1461" aria-hidden="true" tabindex="-1"></a>    <span class="fu">path</span>(land)<span class="op">;</span></span>
<span id="cb3-1462"><a href="#cb3-1462" aria-hidden="true" tabindex="-1"></a>    context<span class="op">.</span><span class="at">fillStyle</span> <span class="op">=</span> colors<span class="op">.</span><span class="at">land</span><span class="op">;</span></span>
<span id="cb3-1463"><a href="#cb3-1463" aria-hidden="true" tabindex="-1"></a>    context<span class="op">.</span><span class="fu">fill</span>()<span class="op">;</span></span>
<span id="cb3-1464"><a href="#cb3-1464" aria-hidden="true" tabindex="-1"></a>    context<span class="op">.</span><span class="fu">beginPath</span>()<span class="op">;</span></span>
<span id="cb3-1465"><a href="#cb3-1465" aria-hidden="true" tabindex="-1"></a>    <span class="fu">path</span>(countries)<span class="op">;</span></span>
<span id="cb3-1466"><a href="#cb3-1466" aria-hidden="true" tabindex="-1"></a>    context<span class="op">.</span><span class="at">lineWidth</span> <span class="op">=</span> <span class="op">.</span><span class="dv">95</span><span class="op">;</span></span>
<span id="cb3-1467"><a href="#cb3-1467" aria-hidden="true" tabindex="-1"></a>    context<span class="op">.</span><span class="at">strokeStyle</span> <span class="op">=</span> <span class="vs">`#000`</span><span class="op">;</span></span>
<span id="cb3-1468"><a href="#cb3-1468" aria-hidden="true" tabindex="-1"></a>    context<span class="op">.</span><span class="fu">stroke</span>()<span class="op">;</span></span>
<span id="cb3-1469"><a href="#cb3-1469" aria-hidden="true" tabindex="-1"></a>    context<span class="op">.</span><span class="at">fillStyle</span> <span class="op">=</span> <span class="vs">`#000`</span><span class="op">;</span></span>
<span id="cb3-1470"><a href="#cb3-1470" aria-hidden="true" tabindex="-1"></a>    context<span class="op">.</span><span class="at">font</span> <span class="op">=</span> width <span class="op">&lt;</span> <span class="dv">760</span> <span class="op">?</span> <span class="st">"14px serif"</span> <span class="op">:</span> width <span class="op">&lt;</span> <span class="dv">990</span> <span class="op">?</span> <span class="st">"17px serif"</span> <span class="op">:</span> <span class="st">"23px serif"</span><span class="op">;</span></span>
<span id="cb3-1471"><a href="#cb3-1471" aria-hidden="true" tabindex="-1"></a>    d3<span class="op">.</span><span class="fu">range</span>(<span class="op">-</span><span class="fl">1.5</span><span class="op">,</span> <span class="dv">342</span> <span class="op">+</span> <span class="dv">1</span><span class="op">,</span> <span class="dv">36</span>)<span class="op">.</span><span class="fu">map</span>(x <span class="kw">=&gt;</span>  context<span class="op">.</span><span class="fu">fillText</span>(<span class="fu">long2zone</span>(x)<span class="op">,</span> <span class="op">...</span><span class="fu">projection</span>([x<span class="op">,</span> <span class="dv">84</span> <span class="op">-</span> (width <span class="op">&lt;</span> <span class="dv">500</span>) <span class="op">*</span> <span class="fl">8.8</span>])))<span class="op">;</span></span>
<span id="cb3-1472"><a href="#cb3-1472" aria-hidden="true" tabindex="-1"></a>    d3<span class="op">.</span><span class="fu">range</span>(<span class="op">-</span><span class="fl">1.5</span><span class="op">,</span> <span class="dv">342</span> <span class="op">+</span> <span class="dv">1</span><span class="op">,</span> <span class="dv">36</span>)<span class="op">.</span><span class="fu">map</span>(x <span class="kw">=&gt;</span>  context<span class="op">.</span><span class="fu">fillText</span>(<span class="fu">long2zone</span>(x)<span class="op">,</span> <span class="op">...</span><span class="fu">projection</span>([x<span class="op">,</span> <span class="op">-</span><span class="dv">66</span> <span class="op">+</span> (width <span class="op">&lt;</span> <span class="dv">500</span>) <span class="op">*</span> <span class="fl">1.1</span>])))<span class="op">;</span></span>
<span id="cb3-1473"><a href="#cb3-1473" aria-hidden="true" tabindex="-1"></a>    context<span class="op">.</span><span class="fu">beginPath</span>()<span class="op">,</span> <span class="fu">path</span>(night)<span class="op">,</span> context<span class="op">.</span><span class="at">fillStyle</span> <span class="op">=</span> <span class="st">"rgba(0,0,255,0.1)"</span><span class="op">,</span> context<span class="op">.</span><span class="fu">fill</span>()<span class="op">;</span></span>
<span id="cb3-1474"><a href="#cb3-1474" aria-hidden="true" tabindex="-1"></a>    context<span class="op">.</span><span class="fu">beginPath</span>()<span class="op">;</span> path<span class="op">.</span><span class="fu">pointRadius</span>(<span class="dv">17</span>)<span class="op">;</span> <span class="fu">path</span>({<span class="dt">type</span><span class="op">:</span> <span class="st">"Point"</span><span class="op">,</span> <span class="dt">coordinates</span><span class="op">:</span> sun})<span class="op">;</span> context<span class="op">.</span><span class="at">strokeStyle</span> <span class="op">=</span> <span class="st">"#0008"</span><span class="op">;</span> context<span class="op">.</span><span class="at">fillStyle</span> <span class="op">=</span> <span class="st">"#ff08"</span><span class="op">;</span> context<span class="op">.</span><span class="at">lineWidth</span> <span class="op">=</span> <span class="dv">1</span><span class="op">;</span> context<span class="op">.</span><span class="fu">stroke</span>()<span class="op">;</span> context<span class="op">.</span><span class="fu">fill</span>()<span class="op">;</span></span>
<span id="cb3-1475"><a href="#cb3-1475" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> (lon <span class="op">!=</span> <span class="kw">null</span> <span class="op">&amp;&amp;</span> lat <span class="op">!=</span> <span class="kw">null</span>) {</span>
<span id="cb3-1476"><a href="#cb3-1476" aria-hidden="true" tabindex="-1"></a>      path<span class="op">.</span><span class="fu">pointRadius</span>(<span class="dv">17</span>)<span class="op">;</span> context<span class="op">.</span><span class="at">strokeStyle</span> <span class="op">=</span> <span class="st">"black"</span><span class="op">;</span></span>
<span id="cb3-1477"><a href="#cb3-1477" aria-hidden="true" tabindex="-1"></a>      context<span class="op">.</span><span class="fu">beginPath</span>()<span class="op">;</span> <span class="fu">path</span>({<span class="dt">type</span><span class="op">:</span> <span class="st">"Point"</span><span class="op">,</span> <span class="dt">coordinates</span><span class="op">:</span> [lon<span class="op">,</span> lat]})<span class="op">;</span> context<span class="op">.</span><span class="at">lineWidth</span> <span class="op">=</span> <span class="dv">1</span><span class="op">;</span> context<span class="op">.</span><span class="fu">stroke</span>()<span class="op">;</span></span>
<span id="cb3-1478"><a href="#cb3-1478" aria-hidden="true" tabindex="-1"></a>      context<span class="op">.</span><span class="at">lineWidth</span> <span class="op">=</span> <span class="dv">6</span><span class="op">;</span></span>
<span id="cb3-1479"><a href="#cb3-1479" aria-hidden="true" tabindex="-1"></a>      path<span class="op">.</span><span class="fu">pointRadius</span>(<span class="dv">14</span>)<span class="op">;</span> context<span class="op">.</span><span class="at">strokeStyle</span> <span class="op">=</span> <span class="st">"red"</span><span class="op">;</span></span>
<span id="cb3-1480"><a href="#cb3-1480" aria-hidden="true" tabindex="-1"></a>      context<span class="op">.</span><span class="fu">beginPath</span>()<span class="op">;</span> <span class="fu">path</span>({<span class="dt">type</span><span class="op">:</span> <span class="st">"Point"</span><span class="op">,</span> <span class="dt">coordinates</span><span class="op">:</span> [lon<span class="op">,</span> lat]})<span class="op">;</span> context<span class="op">.</span><span class="fu">stroke</span>()<span class="op">;</span></span>
<span id="cb3-1481"><a href="#cb3-1481" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb3-1482"><a href="#cb3-1482" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb3-1483"><a href="#cb3-1483" aria-hidden="true" tabindex="-1"></a>  <span class="kw">let</span> drag <span class="op">=</span> d3<span class="op">.</span><span class="fu">drag</span>()</span>
<span id="cb3-1484"><a href="#cb3-1484" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">on</span>(<span class="st">"drag"</span><span class="op">,</span> (<span class="bu">event</span>) <span class="kw">=&gt;</span> {</span>
<span id="cb3-1485"><a href="#cb3-1485" aria-hidden="true" tabindex="-1"></a>      <span class="kw">let</span> coords <span class="op">=</span> projection<span class="op">.</span><span class="fu">invert</span>([<span class="bu">event</span><span class="op">.</span><span class="at">x</span><span class="op">,</span> <span class="bu">event</span><span class="op">.</span><span class="at">y</span>])<span class="op">;</span></span>
<span id="cb3-1486"><a href="#cb3-1486" aria-hidden="true" tabindex="-1"></a>      lon <span class="op">=</span> <span class="op">+</span>coords[<span class="dv">0</span>]<span class="op">.</span><span class="fu">toFixed</span>(<span class="dv">2</span>)<span class="op">;</span></span>
<span id="cb3-1487"><a href="#cb3-1487" aria-hidden="true" tabindex="-1"></a>      lat <span class="op">=</span> <span class="op">+</span>coords[<span class="dv">1</span>]<span class="op">.</span><span class="fu">toFixed</span>(<span class="dv">2</span>)<span class="op">;</span></span>
<span id="cb3-1488"><a href="#cb3-1488" aria-hidden="true" tabindex="-1"></a>      <span class="fu">draw</span>()<span class="op">;</span></span>
<span id="cb3-1489"><a href="#cb3-1489" aria-hidden="true" tabindex="-1"></a>      canvas<span class="op">.</span><span class="fu">dispatchEvent</span>(<span class="kw">new</span> <span class="bu">CustomEvent</span>(<span class="st">"input"</span><span class="op">,</span> { <span class="dt">bubbles</span><span class="op">:</span> <span class="kw">true</span> }))<span class="op">;</span></span>
<span id="cb3-1490"><a href="#cb3-1490" aria-hidden="true" tabindex="-1"></a>    })</span>
<span id="cb3-1491"><a href="#cb3-1491" aria-hidden="true" tabindex="-1"></a>  d3<span class="op">.</span><span class="fu">select</span>(canvas)<span class="op">.</span><span class="fu">call</span>(drag)</span>
<span id="cb3-1492"><a href="#cb3-1492" aria-hidden="true" tabindex="-1"></a>  canvas<span class="op">.</span><span class="at">onclick</span> <span class="op">=</span> <span class="kw">function</span>(ev) {</span>
<span id="cb3-1493"><a href="#cb3-1493" aria-hidden="true" tabindex="-1"></a>    <span class="kw">const</span> { offsetX<span class="op">,</span> offsetY } <span class="op">=</span> ev<span class="op">;</span></span>
<span id="cb3-1494"><a href="#cb3-1494" aria-hidden="true" tabindex="-1"></a>    <span class="kw">let</span> coords <span class="op">=</span> projection<span class="op">.</span><span class="fu">invert</span>([offsetX<span class="op">,</span> offsetY])<span class="op">;</span></span>
<span id="cb3-1495"><a href="#cb3-1495" aria-hidden="true" tabindex="-1"></a>    lon <span class="op">=</span> <span class="op">+</span>coords[<span class="dv">0</span>]<span class="op">.</span><span class="fu">toFixed</span>(<span class="dv">2</span>)<span class="op">;</span></span>
<span id="cb3-1496"><a href="#cb3-1496" aria-hidden="true" tabindex="-1"></a>    lat <span class="op">=</span> <span class="op">+</span>coords[<span class="dv">1</span>]<span class="op">.</span><span class="fu">toFixed</span>(<span class="dv">2</span>)<span class="op">;</span></span>
<span id="cb3-1497"><a href="#cb3-1497" aria-hidden="true" tabindex="-1"></a>    <span class="fu">draw</span>()<span class="op">;</span></span>
<span id="cb3-1498"><a href="#cb3-1498" aria-hidden="true" tabindex="-1"></a>    canvas<span class="op">.</span><span class="fu">dispatchEvent</span>(<span class="kw">new</span> <span class="bu">CustomEvent</span>(<span class="st">"input"</span><span class="op">,</span> { <span class="dt">bubbles</span><span class="op">:</span> <span class="kw">true</span> }))<span class="op">;</span></span>
<span id="cb3-1499"><a href="#cb3-1499" aria-hidden="true" tabindex="-1"></a>  }<span class="op">;</span></span>
<span id="cb3-1500"><a href="#cb3-1500" aria-hidden="true" tabindex="-1"></a>  <span class="fu">draw</span>()<span class="op">;</span></span>
<span id="cb3-1501"><a href="#cb3-1501" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> form <span class="op">=</span> <span class="fu">input</span>({</span>
<span id="cb3-1502"><a href="#cb3-1502" aria-hidden="true" tabindex="-1"></a>    <span class="dt">type</span><span class="op">:</span> <span class="st">"worldMapCoordinates"</span><span class="op">,</span></span>
<span id="cb3-1503"><a href="#cb3-1503" aria-hidden="true" tabindex="-1"></a>    title<span class="op">,</span></span>
<span id="cb3-1504"><a href="#cb3-1504" aria-hidden="true" tabindex="-1"></a>    description<span class="op">,</span></span>
<span id="cb3-1505"><a href="#cb3-1505" aria-hidden="true" tabindex="-1"></a>    <span class="dt">display</span><span class="op">:</span> v <span class="kw">=&gt;</span> (width <span class="op">&gt;</span> <span class="dv">300</span>) <span class="op">?</span> <span class="fu">html</span><span class="vs">`&lt;div style="width: </span><span class="sc">${</span>width<span class="sc">}</span><span class="vs">px; white-space: nowrap; color: #444; text-align: center; font: </span><span class="sc">${</span>width <span class="op">/</span> <span class="dv">50</span><span class="sc">}</span><span class="vs">px monospace; position: relative; top: -</span><span class="sc">${</span>width <span class="op">/</span> <span class="dv">30</span><span class="sc">}</span><span class="vs">px;  margin-bottom: -.4em;"&gt;</span></span>
<span id="cb3-1506"><a href="#cb3-1506" aria-hidden="true" tabindex="-1"></a><span class="vs">            &lt;span style="color: #000;"&gt;Zone:&lt;/span&gt; </span><span class="sc">${</span>lon <span class="op">!=</span> <span class="kw">null</span> <span class="op">?</span> <span class="fu">long2zone</span>(lon) <span class="op">:</span> <span class="st">""</span><span class="sc">}</span></span>
<span id="cb3-1507"><a href="#cb3-1507" aria-hidden="true" tabindex="-1"></a><span class="vs">            &amp;nbsp; &amp;nbsp;</span></span>
<span id="cb3-1508"><a href="#cb3-1508" aria-hidden="true" tabindex="-1"></a><span class="vs">            &lt;span style="color: #000;"&gt;Longitude:&lt;/span&gt; </span><span class="sc">${</span>lon <span class="op">!=</span> <span class="kw">null</span> <span class="op">?</span> (<span class="fu">long2turn</span>(lon))<span class="op">.</span><span class="fu">toFixed</span>(<span class="dv">0</span>) <span class="op">:</span> <span class="st">""</span><span class="sc">}</span></span>
<span id="cb3-1509"><a href="#cb3-1509" aria-hidden="true" tabindex="-1"></a><span class="vs">            &amp;nbsp; &amp;nbsp;</span></span>
<span id="cb3-1510"><a href="#cb3-1510" aria-hidden="true" tabindex="-1"></a><span class="vs">            &lt;span style="color: #000;"&gt;Latitude:&lt;/span&gt; </span><span class="sc">${</span>lat <span class="op">!=</span> <span class="kw">null</span> <span class="op">?</span> ((<span class="fu">lati2turn1</span>(lat)))<span class="op">.</span><span class="fu">toFixed</span>(<span class="dv">0</span>) <span class="op">:</span> <span class="st">""</span><span class="sc">}</span></span>
<span id="cb3-1511"><a href="#cb3-1511" aria-hidden="true" tabindex="-1"></a><span class="vs">          &lt;/div&gt;`</span> <span class="op">:</span> <span class="st">''</span><span class="op">,</span></span>
<span id="cb3-1512"><a href="#cb3-1512" aria-hidden="true" tabindex="-1"></a>    <span class="dt">getValue</span><span class="op">:</span> () <span class="kw">=&gt;</span> [lon <span class="op">!=</span> <span class="kw">null</span> <span class="op">?</span> lon <span class="op">:</span> <span class="kw">null</span><span class="op">,</span> lat <span class="op">!=</span> <span class="kw">null</span> <span class="op">?</span> lat <span class="op">:</span> <span class="kw">null</span>]<span class="op">,</span></span>
<span id="cb3-1513"><a href="#cb3-1513" aria-hidden="true" tabindex="-1"></a>    <span class="dt">form</span><span class="op">:</span> formEl</span>
<span id="cb3-1514"><a href="#cb3-1514" aria-hidden="true" tabindex="-1"></a>  })<span class="op">;</span></span>
<span id="cb3-1515"><a href="#cb3-1515" aria-hidden="true" tabindex="-1"></a>  <span class="cf">return</span> form<span class="op">;</span></span>
<span id="cb3-1516"><a href="#cb3-1516" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb3-1517"><a href="#cb3-1517" aria-hidden="true" tabindex="-1"></a>sun <span class="op">=</span> {</span>
<span id="cb3-1518"><a href="#cb3-1518" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> now <span class="op">=</span> <span class="kw">new</span> <span class="bu">Date</span><span class="op">;</span></span>
<span id="cb3-1519"><a href="#cb3-1519" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> day <span class="op">=</span> <span class="kw">new</span> <span class="bu">Date</span>(<span class="op">+</span>now)<span class="op">.</span><span class="fu">setUTCHours</span>(<span class="dv">0</span><span class="op">,</span> <span class="dv">0</span><span class="op">,</span> <span class="dv">0</span><span class="op">,</span> <span class="dv">0</span>)<span class="op">;</span></span>
<span id="cb3-1520"><a href="#cb3-1520" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> t <span class="op">=</span> solar<span class="op">.</span><span class="fu">century</span>(now)<span class="op">;</span></span>
<span id="cb3-1521"><a href="#cb3-1521" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> longitude <span class="op">=</span> (day <span class="op">-</span> now) <span class="op">/</span> <span class="fl">864e5</span> <span class="op">*</span> <span class="dv">360</span> <span class="op">-</span> <span class="dv">180</span><span class="op">;</span></span>
<span id="cb3-1522"><a href="#cb3-1522" aria-hidden="true" tabindex="-1"></a>  <span class="cf">return</span> [longitude <span class="op">-</span> solar<span class="op">.</span><span class="fu">equationOfTime</span>(t) <span class="op">/</span> <span class="dv">4</span><span class="op">,</span> solar<span class="op">.</span><span class="fu">declination</span>(t)]<span class="op">;</span></span>
<span id="cb3-1523"><a href="#cb3-1523" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb3-1524"><a href="#cb3-1524" aria-hidden="true" tabindex="-1"></a>night <span class="op">=</span> d3<span class="op">.</span><span class="fu">geoCircle</span>()</span>
<span id="cb3-1525"><a href="#cb3-1525" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">radius</span>(<span class="dv">90</span>)</span>
<span id="cb3-1526"><a href="#cb3-1526" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">center</span>(<span class="fu">antipode</span>(sun))</span>
<span id="cb3-1527"><a href="#cb3-1527" aria-hidden="true" tabindex="-1"></a>  ()</span>
<span id="cb3-1528"><a href="#cb3-1528" aria-hidden="true" tabindex="-1"></a>antipode <span class="op">=</span> ([longitude<span class="op">,</span> latitude]) <span class="kw">=&gt;</span> [longitude <span class="op">+</span> <span class="dv">180</span><span class="op">,</span> <span class="op">-</span>latitude]</span>
<span id="cb3-1529"><a href="#cb3-1529" aria-hidden="true" tabindex="-1"></a>solar <span class="op">=</span> <span class="pp">require</span>(<span class="st">"solar-calculator@0.3/dist/solar-calculator.min.js"</span>)</span>
<span id="cb3-1530"><a href="#cb3-1530" aria-hidden="true" tabindex="-1"></a>viewof fancySecondsOFF <span class="op">=</span> Inputs<span class="op">.</span><span class="fu">toggle</span>({</span>
<span id="cb3-1531"><a href="#cb3-1531" aria-hidden="true" tabindex="-1"></a>  <span class="dt">label</span><span class="op">:</span> <span class="st">"Ticking clock"</span><span class="op">,</span></span>
<span id="cb3-1532"><a href="#cb3-1532" aria-hidden="true" tabindex="-1"></a>  <span class="dt">value</span><span class="op">:</span> <span class="kw">true</span><span class="op">,</span></span>
<span id="cb3-1533"><a href="#cb3-1533" aria-hidden="true" tabindex="-1"></a>})</span>
<span id="cb3-1534"><a href="#cb3-1534" aria-hidden="true" tabindex="-1"></a><span class="kw">function</span> <span class="fu">setStyle</span>(content<span class="op">,</span> style <span class="op">=</span> {}) {</span>
<span id="cb3-1535"><a href="#cb3-1535" aria-hidden="true" tabindex="-1"></a>  <span class="kw">function</span> <span class="fu">yiq</span>(color) {</span>
<span id="cb3-1536"><a href="#cb3-1536" aria-hidden="true" tabindex="-1"></a>    <span class="kw">const</span> {r<span class="op">,</span> g<span class="op">,</span> b} <span class="op">=</span> d3<span class="op">.</span><span class="fu">rgb</span>(color)<span class="op">;</span></span>
<span id="cb3-1537"><a href="#cb3-1537" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> (r <span class="op">*</span> <span class="dv">299</span> <span class="op">+</span> g <span class="op">*</span> <span class="dv">587</span> <span class="op">+</span> b <span class="op">*</span> <span class="dv">114</span>) <span class="op">/</span> <span class="dv">1000</span> <span class="op">/</span> <span class="dv">255</span><span class="op">;</span> <span class="co">// returns values between 0 and 1</span></span>
<span id="cb3-1538"><a href="#cb3-1538" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb3-1539"><a href="#cb3-1539" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> {</span>
<span id="cb3-1540"><a href="#cb3-1540" aria-hidden="true" tabindex="-1"></a>    background<span class="op">,</span></span>
<span id="cb3-1541"><a href="#cb3-1541" aria-hidden="true" tabindex="-1"></a>    color <span class="op">=</span> <span class="fu">yiq</span>(background) <span class="op">&gt;=</span> <span class="fl">0.6</span> <span class="op">?</span> <span class="st">"#111"</span> <span class="op">:</span> <span class="st">"white"</span><span class="op">,</span></span>
<span id="cb3-1542"><a href="#cb3-1542" aria-hidden="true" tabindex="-1"></a>    padding <span class="op">=</span> <span class="st">"0 1px"</span><span class="op">,</span></span>
<span id="cb3-1543"><a href="#cb3-1543" aria-hidden="true" tabindex="-1"></a>    borderRadius <span class="op">=</span> <span class="st">"4px"</span><span class="op">,</span></span>
<span id="cb3-1544"><a href="#cb3-1544" aria-hidden="true" tabindex="-1"></a>    fontWeight <span class="op">=</span> <span class="dv">900</span><span class="op">,</span></span>
<span id="cb3-1545"><a href="#cb3-1545" aria-hidden="true" tabindex="-1"></a>    fontSize <span class="op">=</span> <span class="st">"1em"</span><span class="op">,</span></span>
<span id="cb3-1546"><a href="#cb3-1546" aria-hidden="true" tabindex="-1"></a>    <span class="op">...</span>rest</span>
<span id="cb3-1547"><a href="#cb3-1547" aria-hidden="true" tabindex="-1"></a>  } <span class="op">=</span> <span class="kw">typeof</span> style <span class="op">===</span> <span class="st">"string"</span> <span class="op">?</span> {<span class="dt">background</span><span class="op">:</span> style} <span class="op">:</span> style<span class="op">;</span></span>
<span id="cb3-1548"><a href="#cb3-1548" aria-hidden="true" tabindex="-1"></a>  <span class="cf">return</span> htl<span class="op">.</span><span class="fu">html</span><span class="vs">`&lt;span style=</span><span class="sc">${</span>{</span>
<span id="cb3-1549"><a href="#cb3-1549" aria-hidden="true" tabindex="-1"></a>    background<span class="op">,</span></span>
<span id="cb3-1550"><a href="#cb3-1550" aria-hidden="true" tabindex="-1"></a>    color<span class="op">,</span></span>
<span id="cb3-1551"><a href="#cb3-1551" aria-hidden="true" tabindex="-1"></a>    padding<span class="op">,</span></span>
<span id="cb3-1552"><a href="#cb3-1552" aria-hidden="true" tabindex="-1"></a>    borderRadius<span class="op">,</span></span>
<span id="cb3-1553"><a href="#cb3-1553" aria-hidden="true" tabindex="-1"></a>    fontWeight<span class="op">,</span></span>
<span id="cb3-1554"><a href="#cb3-1554" aria-hidden="true" tabindex="-1"></a>    <span class="op">...</span>rest</span>
<span id="cb3-1555"><a href="#cb3-1555" aria-hidden="true" tabindex="-1"></a>  }<span class="sc">}</span><span class="vs">&gt;</span><span class="sc">${</span>content<span class="sc">}</span><span class="vs">&lt;/span&gt;`</span><span class="op">;</span></span>
<span id="cb3-1556"><a href="#cb3-1556" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb3-1557"><a href="#cb3-1557" aria-hidden="true" tabindex="-1"></a><span class="kw">function</span> <span class="fu">yiq</span>(color) {</span>
<span id="cb3-1558"><a href="#cb3-1558" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> {r<span class="op">,</span> g<span class="op">,</span> b} <span class="op">=</span> d3<span class="op">.</span><span class="fu">rgb</span>(color)<span class="op">;</span></span>
<span id="cb3-1559"><a href="#cb3-1559" aria-hidden="true" tabindex="-1"></a>  <span class="cf">return</span> (r <span class="op">*</span> <span class="dv">299</span> <span class="op">+</span> g <span class="op">*</span> <span class="dv">587</span> <span class="op">+</span> b <span class="op">*</span> <span class="dv">114</span>) <span class="op">/</span> <span class="dv">1000</span> <span class="op">/</span> <span class="dv">255</span><span class="op">;</span> <span class="co">// returns values between 0 and 1</span></span>
<span id="cb3-1560"><a href="#cb3-1560" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb3-1561"><a href="#cb3-1561" aria-hidden="true" tabindex="-1"></a><span class="kw">function</span> <span class="fu">textcolor</span>(content<span class="op">,</span> style <span class="op">=</span> {}) {</span>
<span id="cb3-1562"><a href="#cb3-1562" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> {</span>
<span id="cb3-1563"><a href="#cb3-1563" aria-hidden="true" tabindex="-1"></a>    background<span class="op">,</span></span>
<span id="cb3-1564"><a href="#cb3-1564" aria-hidden="true" tabindex="-1"></a>    color <span class="op">=</span> <span class="fu">yiq</span>(background) <span class="op">&gt;</span> <span class="fl">0.51</span> <span class="op">?</span> <span class="st">"#000"</span> <span class="op">:</span> <span class="st">"white"</span><span class="op">,</span></span>
<span id="cb3-1565"><a href="#cb3-1565" aria-hidden="true" tabindex="-1"></a>    padding <span class="op">=</span> <span class="st">"0 5px"</span><span class="op">,</span></span>
<span id="cb3-1566"><a href="#cb3-1566" aria-hidden="true" tabindex="-1"></a>    borderRadius <span class="op">=</span> <span class="st">"4px"</span><span class="op">,</span></span>
<span id="cb3-1567"><a href="#cb3-1567" aria-hidden="true" tabindex="-1"></a>    fontWeight <span class="op">=</span> <span class="dv">400</span><span class="op">,</span></span>
<span id="cb3-1568"><a href="#cb3-1568" aria-hidden="true" tabindex="-1"></a>    fontFamily <span class="op">=</span> <span class="st">"monospace"</span><span class="op">,</span></span>
<span id="cb3-1569"><a href="#cb3-1569" aria-hidden="true" tabindex="-1"></a>    <span class="op">...</span>rest</span>
<span id="cb3-1570"><a href="#cb3-1570" aria-hidden="true" tabindex="-1"></a>  } <span class="op">=</span> <span class="kw">typeof</span> style <span class="op">===</span> <span class="st">"string"</span> <span class="op">?</span> {<span class="dt">background</span><span class="op">:</span> style} <span class="op">:</span> style<span class="op">;</span></span>
<span id="cb3-1571"><a href="#cb3-1571" aria-hidden="true" tabindex="-1"></a>  <span class="cf">return</span> htl<span class="op">.</span><span class="fu">html</span><span class="vs">`&lt;span style=</span><span class="sc">${</span>{</span>
<span id="cb3-1572"><a href="#cb3-1572" aria-hidden="true" tabindex="-1"></a>    background<span class="op">,</span></span>
<span id="cb3-1573"><a href="#cb3-1573" aria-hidden="true" tabindex="-1"></a>    color<span class="op">,</span></span>
<span id="cb3-1574"><a href="#cb3-1574" aria-hidden="true" tabindex="-1"></a>    padding<span class="op">,</span></span>
<span id="cb3-1575"><a href="#cb3-1575" aria-hidden="true" tabindex="-1"></a>    borderRadius<span class="op">,</span></span>
<span id="cb3-1576"><a href="#cb3-1576" aria-hidden="true" tabindex="-1"></a>    fontWeight<span class="op">,</span></span>
<span id="cb3-1577"><a href="#cb3-1577" aria-hidden="true" tabindex="-1"></a>    fontFamily<span class="op">,</span></span>
<span id="cb3-1578"><a href="#cb3-1578" aria-hidden="true" tabindex="-1"></a>    <span class="op">...</span>rest</span>
<span id="cb3-1579"><a href="#cb3-1579" aria-hidden="true" tabindex="-1"></a>  }<span class="sc">}</span><span class="vs">&gt;</span><span class="sc">${</span>content<span class="sc">}</span><span class="vs">&lt;/span&gt;`</span><span class="op">;</span></span>
<span id="cb3-1580"><a href="#cb3-1580" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb3-1581"><a href="#cb3-1581" aria-hidden="true" tabindex="-1"></a>elapsed <span class="op">=</span> {</span>
<span id="cb3-1582"><a href="#cb3-1582" aria-hidden="true" tabindex="-1"></a>  <span class="kw">let</span> i <span class="op">=</span> <span class="dv">0</span><span class="op">;</span></span>
<span id="cb3-1583"><a href="#cb3-1583" aria-hidden="true" tabindex="-1"></a>  <span class="cf">while</span> (<span class="kw">true</span>) {</span>
<span id="cb3-1584"><a href="#cb3-1584" aria-hidden="true" tabindex="-1"></a>    <span class="kw">yield</span> Promises<span class="op">.</span><span class="fu">tick</span>(<span class="dv">864</span><span class="op">,</span> <span class="op">++</span>i)<span class="op">;</span></span>
<span id="cb3-1585"><a href="#cb3-1585" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb3-1586"><a href="#cb3-1586" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb3-1587"><a href="#cb3-1587" aria-hidden="true" tabindex="-1"></a>piecewiseColor <span class="op">=</span> d3<span class="op">.</span><span class="fu">piecewise</span>(d3<span class="op">.</span><span class="at">interpolateRgb</span><span class="op">,</span> [</span>
<span id="cb3-1588"><a href="#cb3-1588" aria-hidden="true" tabindex="-1"></a>  <span class="st">"#f00"</span><span class="op">,</span> <span class="co">// red</span></span>
<span id="cb3-1589"><a href="#cb3-1589" aria-hidden="true" tabindex="-1"></a>  <span class="st">"#f0f"</span><span class="op">,</span> <span class="co">// magenta</span></span>
<span id="cb3-1590"><a href="#cb3-1590" aria-hidden="true" tabindex="-1"></a>  <span class="st">"#a0f"</span><span class="op">,</span> <span class="co">// violet</span></span>
<span id="cb3-1591"><a href="#cb3-1591" aria-hidden="true" tabindex="-1"></a>  <span class="st">"#00f"</span><span class="op">,</span> <span class="co">// blue</span></span>
<span id="cb3-1592"><a href="#cb3-1592" aria-hidden="true" tabindex="-1"></a>  <span class="st">"#0af"</span><span class="op">,</span> <span class="co">// azure</span></span>
<span id="cb3-1593"><a href="#cb3-1593" aria-hidden="true" tabindex="-1"></a>  <span class="st">"#0ff"</span><span class="op">,</span> <span class="co">// cyan</span></span>
<span id="cb3-1594"><a href="#cb3-1594" aria-hidden="true" tabindex="-1"></a>  <span class="st">"#0f0"</span><span class="op">,</span> <span class="co">// green</span></span>
<span id="cb3-1595"><a href="#cb3-1595" aria-hidden="true" tabindex="-1"></a>  <span class="st">"#af0"</span><span class="op">,</span> <span class="co">// lime</span></span>
<span id="cb3-1596"><a href="#cb3-1596" aria-hidden="true" tabindex="-1"></a>  <span class="st">"#ff0"</span><span class="op">,</span> <span class="co">// yellow</span></span>
<span id="cb3-1597"><a href="#cb3-1597" aria-hidden="true" tabindex="-1"></a>  <span class="st">"#fa0"</span><span class="op">,</span> <span class="co">// orange</span></span>
<span id="cb3-1598"><a href="#cb3-1598" aria-hidden="true" tabindex="-1"></a>  <span class="st">"#f00"</span><span class="op">,</span> <span class="co">// red</span></span>
<span id="cb3-1599"><a href="#cb3-1599" aria-hidden="true" tabindex="-1"></a>])</span>
<span id="cb3-1600"><a href="#cb3-1600" aria-hidden="true" tabindex="-1"></a>slStr <span class="op">=</span> <span class="vs">`, 100%, 50%)`</span></span>
<span id="cb3-1601"><a href="#cb3-1601" aria-hidden="true" tabindex="-1"></a>elaTime <span class="op">=</span> elapsed <span class="op">%</span> <span class="fl">1e5</span></span>
<span id="cb3-1602"><a href="#cb3-1602" aria-hidden="true" tabindex="-1"></a>elaTimeHsl <span class="op">=</span> <span class="fu">textcolor</span>(elaTime<span class="op">,</span> <span class="vs">`hsl(</span><span class="sc">${</span>d3<span class="op">.</span><span class="fu">hsl</span>(<span class="fu">piecewiseColor</span>(elaTime <span class="op">%</span> <span class="dv">1000</span> <span class="op">/</span> <span class="dv">1000</span>))<span class="op">.</span><span class="at">h</span><span class="sc">}</span><span class="vs">`</span> <span class="op">+</span> slStr)</span>
<span id="cb3-1603"><a href="#cb3-1603" aria-hidden="true" tabindex="-1"></a>decMoty <span class="op">=</span> <span class="bu">Math</span><span class="op">.</span><span class="fu">floor</span>((<span class="dv">5</span> <span class="op">*</span> decDate <span class="op">+</span> <span class="dv">2</span>) <span class="op">/</span> <span class="dv">153</span>)</span>
<span id="cb3-1604"><a href="#cb3-1604" aria-hidden="true" tabindex="-1"></a>isoYear <span class="op">=</span> decYear <span class="op">+</span> (decMoty <span class="op">&gt;</span> <span class="dv">9</span>)</span>
<span id="cb3-1605"><a href="#cb3-1605" aria-hidden="true" tabindex="-1"></a>month <span class="op">=</span> decMoty <span class="op">&lt;</span> <span class="dv">10</span> <span class="op">?</span> decMoty <span class="op">+</span> <span class="dv">3</span> <span class="op">:</span> decMoty <span class="op">-</span> <span class="dv">9</span></span>
<span id="cb3-1606"><a href="#cb3-1606" aria-hidden="true" tabindex="-1"></a>decHour <span class="op">=</span> decTime <span class="op">*</span> <span class="dv">24</span></span>
<span id="cb3-1607"><a href="#cb3-1607" aria-hidden="true" tabindex="-1"></a>decMinute <span class="op">=</span> (decHour <span class="op">%</span> <span class="dv">1</span>) <span class="op">*</span> <span class="dv">60</span></span>
<span id="cb3-1608"><a href="#cb3-1608" aria-hidden="true" tabindex="-1"></a>decSecond <span class="op">=</span> (decMinute <span class="op">%</span> <span class="dv">1</span>) <span class="op">*</span> <span class="dv">60</span></span>
<span id="cb3-1609"><a href="#cb3-1609" aria-hidden="true" tabindex="-1"></a>isoHour <span class="op">=</span> <span class="bu">Math</span><span class="op">.</span><span class="fu">floor</span>(decHour)</span>
<span id="cb3-1610"><a href="#cb3-1610" aria-hidden="true" tabindex="-1"></a>isoMinute <span class="op">=</span> <span class="bu">Math</span><span class="op">.</span><span class="fu">floor</span>(decMinute)</span>
<span id="cb3-1611"><a href="#cb3-1611" aria-hidden="true" tabindex="-1"></a>isoSecond <span class="op">=</span> <span class="bu">Math</span><span class="op">.</span><span class="fu">floor</span>(decSecond)</span>
<span id="cb3-1612"><a href="#cb3-1612" aria-hidden="true" tabindex="-1"></a>decDek <span class="op">=</span> <span class="bu">Math</span><span class="op">.</span><span class="fu">floor</span>(decDate <span class="op">/</span> <span class="dv">10</span>)</span>
<span id="cb3-1613"><a href="#cb3-1613" aria-hidden="true" tabindex="-1"></a>decDod <span class="op">=</span> decDate <span class="op">%</span> <span class="dv">10</span></span>
<span id="cb3-1614"><a href="#cb3-1614" aria-hidden="true" tabindex="-1"></a>decDotm <span class="op">=</span> <span class="bu">Math</span><span class="op">.</span><span class="fu">floor</span>(decDate <span class="op">-</span> (<span class="dv">153</span> <span class="op">*</span> decMoty <span class="op">+</span> <span class="dv">2</span>) <span class="op">/</span> <span class="dv">5</span> <span class="op">+</span> <span class="dv">1</span>)</span>
<span id="cb3-1615"><a href="#cb3-1615" aria-hidden="true" tabindex="-1"></a>decDoty <span class="op">=</span> decDate<span class="op">.</span><span class="fu">toString</span>()<span class="op">.</span><span class="fu">padStart</span>(<span class="dv">3</span><span class="op">,</span> <span class="st">"0"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display hidden">
<div>
<div id="ojs-cell-2-31" data-nodetype="declaration">

</div>
</div>
</div>
<div class="cell-output cell-output-display hidden">
<div>
<div id="ojs-cell-2-32" data-nodetype="declaration">

</div>
</div>
</div>
<div class="cell-output cell-output-display hidden">
<div>
<div id="ojs-cell-2-33" data-nodetype="declaration">

</div>
</div>
</div>
<div class="cell-output cell-output-display hidden">
<div>
<div id="ojs-cell-2-34" data-nodetype="declaration">

</div>
</div>
</div>
<div class="cell-output cell-output-display hidden">
<div>
<div id="ojs-cell-2-35" data-nodetype="declaration">

</div>
</div>
</div>
<div class="cell-output cell-output-display hidden">
<div>
<div id="ojs-cell-2-36" data-nodetype="declaration">

</div>
</div>
</div>
<div class="cell-output cell-output-display hidden">
<div>
<div id="ojs-cell-2-37" data-nodetype="declaration">

</div>
</div>
</div>
<div class="cell-output cell-output-display hidden">
<div>
<div id="ojs-cell-2-38" data-nodetype="declaration">

</div>
</div>
</div>
<div class="cell-output cell-output-display hidden">
<div>
<div id="ojs-cell-2-39" data-nodetype="declaration">

</div>
</div>
</div>
<div class="cell-output cell-output-display hidden">
<div>
<div id="ojs-cell-2-40" data-nodetype="declaration">

</div>
</div>
</div>
<div class="cell-output cell-output-display hidden">
<div>
<div id="ojs-cell-2-41" data-nodetype="declaration">

</div>
</div>
</div>
<div class="cell-output cell-output-display hidden">
<div>
<div id="ojs-cell-2-42" data-nodetype="declaration">

</div>
</div>
</div>
<div class="cell-output cell-output-display hidden">
<div>
<div id="ojs-cell-2-43" data-nodetype="declaration">

</div>
</div>
</div>
<div class="cell-output cell-output-display hidden">
<div>
<div id="ojs-cell-2-44" data-nodetype="declaration">

</div>
</div>
</div>
<div class="cell-output cell-output-display hidden">
<div>
<div id="ojs-cell-2-45" data-nodetype="declaration">

</div>
</div>
</div>
<div class="cell-output cell-output-display hidden">
<div>
<div id="ojs-cell-2-46" data-nodetype="declaration">

</div>
</div>
</div>
<div class="cell-output cell-output-display hidden">
<div>
<div id="ojs-cell-2-47" data-nodetype="declaration">

</div>
</div>
</div>
<div class="cell-output cell-output-display hidden">
<div>
<div id="ojs-cell-2-48" data-nodetype="declaration">

</div>
</div>
</div>
<div class="cell-output cell-output-display hidden">
<div>
<div id="ojs-cell-2-49" data-nodetype="declaration">

</div>
</div>
</div>
<div class="cell-output cell-output-display hidden">
<div>
<div id="ojs-cell-2-50" data-nodetype="declaration">

</div>
</div>
</div>
<div class="cell-output cell-output-display hidden">
<div>
<div id="ojs-cell-2-51" data-nodetype="declaration">

</div>
</div>
</div>
<div class="cell-output cell-output-display hidden">
<div>
<div id="ojs-cell-2-52" data-nodetype="declaration">

</div>
</div>
</div>
<div class="cell-output cell-output-display hidden">
<div>
<div id="ojs-cell-2-53" data-nodetype="declaration">

</div>
</div>
</div>
<div class="cell-output cell-output-display hidden">
<div>
<div id="ojs-cell-2-54" data-nodetype="declaration">

</div>
</div>
</div>
<div class="cell-output cell-output-display hidden">
<div>
<div id="ojs-cell-2-55" data-nodetype="declaration">

</div>
</div>
</div>
<div class="cell-output cell-output-display hidden">
<div>
<div id="ojs-cell-2-56" data-nodetype="declaration">

</div>
</div>
</div>
<div class="cell-output cell-output-display hidden">
<div>
<div id="ojs-cell-2-57" data-nodetype="declaration">

</div>
</div>
</div>
<div class="cell-output cell-output-display hidden">
<div>
<div id="ojs-cell-2-58" data-nodetype="declaration">

</div>
</div>
</div>
<div class="cell-output cell-output-display hidden">
<div>
<div id="ojs-cell-2-59" data-nodetype="declaration">

</div>
</div>
</div>
<div class="cell-output cell-output-display hidden">
<div>
<div id="ojs-cell-2-60" data-nodetype="declaration">

</div>
</div>
</div>
<div class="cell-output cell-output-display hidden">
<div>
<div id="ojs-cell-2-61" data-nodetype="declaration">

</div>
</div>
</div>
<div class="cell-output cell-output-display hidden">
<div>
<div id="ojs-cell-2-62" data-nodetype="declaration">

</div>
</div>
</div>
<div class="cell-output cell-output-display hidden">
<div>
<div id="ojs-cell-2-63" data-nodetype="declaration">

</div>
</div>
</div>
<div class="cell-output cell-output-display hidden">
<div>
<div id="ojs-cell-2-64" data-nodetype="declaration">

</div>
</div>
</div>
<div class="cell-output cell-output-display hidden">
<div>
<div id="ojs-cell-2-65" data-nodetype="declaration">

</div>
</div>
</div>
<div class="cell-output cell-output-display hidden">
<div>
<div id="ojs-cell-2-66" data-nodetype="declaration">

</div>
</div>
</div>
<div class="cell-output cell-output-display hidden">
<div>
<div id="ojs-cell-2-67" data-nodetype="declaration">

</div>
</div>
</div>
<div class="cell-output cell-output-display hidden">
<div>
<div id="ojs-cell-2-68" data-nodetype="declaration">

</div>
</div>
</div>
<div class="cell-output cell-output-display hidden">
<div>
<div id="ojs-cell-2-69" data-nodetype="declaration">

</div>
</div>
</div>
<div class="cell-output cell-output-display hidden">
<div>
<div id="ojs-cell-2-70" data-nodetype="declaration">

</div>
</div>
</div>
<div class="cell-output cell-output-display hidden">
<div>
<div id="ojs-cell-2-71" data-nodetype="declaration">

</div>
</div>
</div>
<div class="cell-output cell-output-display hidden">
<div>
<div id="ojs-cell-2-72" data-nodetype="declaration">

</div>
</div>
</div>
<div class="cell-output cell-output-display hidden">
<div>
<div id="ojs-cell-2-73" data-nodetype="declaration">

</div>
</div>
</div>
<div class="cell-output cell-output-display hidden">
<div>
<div id="ojs-cell-2-74" data-nodetype="declaration">

</div>
</div>
</div>
<div class="cell-output cell-output-display hidden">
<div>
<div id="ojs-cell-2-75" data-nodetype="declaration">

</div>
</div>
</div>
<div class="cell-output cell-output-display hidden">
<div>
<div id="ojs-cell-2-76" data-nodetype="declaration">

</div>
</div>
</div>
<div class="cell-output cell-output-display hidden">
<div>
<div id="ojs-cell-2-77" data-nodetype="declaration">

</div>
</div>
</div>
<div class="cell-output cell-output-display hidden">
<div>
<div id="ojs-cell-2-78" data-nodetype="declaration">

</div>
</div>
</div>
<div class="cell-output cell-output-display hidden">
<div>
<div id="ojs-cell-2-79" data-nodetype="declaration">

</div>
</div>
</div>
<div class="cell-output cell-output-display hidden">
<div>
<div id="ojs-cell-2-80" data-nodetype="declaration">

</div>
</div>
</div>
<div class="cell-output cell-output-display hidden">
<div>
<div id="ojs-cell-2-81" data-nodetype="declaration">

</div>
</div>
</div>
<div class="cell-output cell-output-display hidden">
<div>
<div id="ojs-cell-2-82" data-nodetype="declaration">

</div>
</div>
</div>
<div class="cell-output cell-output-display hidden">
<div>
<div id="ojs-cell-2-83" data-nodetype="declaration">

</div>
</div>
</div>
</div>
<div class="cell hidden">
<div class="sourceCode cell-code hidden" id="cb4" data-startfrom="1620" data-source-offset="0"><pre class="sourceCode js code-with-copy"><code class="sourceCode javascript" style="counter-reset: source-line 1619;"><span id="cb4-1620"><a href="#cb4-1620" aria-hidden="true" tabindex="-1"></a><span class="fu">html</span><span class="vs">`</span></span>
<span id="cb4-1621"><a href="#cb4-1621" aria-hidden="true" tabindex="-1"></a><span class="vs">&lt;style&gt;</span></span>
<span id="cb4-1622"><a href="#cb4-1622" aria-hidden="true" tabindex="-1"></a><span class="vs">.color0 {</span></span>
<span id="cb4-1623"><a href="#cb4-1623" aria-hidden="true" tabindex="-1"></a><span class="vs">  background: hsl(0 100% 50%);</span></span>
<span id="cb4-1624"><a href="#cb4-1624" aria-hidden="true" tabindex="-1"></a><span class="vs">  color: </span><span class="sc">${</span><span class="fu">yiq</span>(<span class="vs">`hsl(0, 100%, 50%)`</span>) <span class="op">&gt;</span> <span class="fl">0.51</span> <span class="op">?</span> <span class="st">"black"</span> <span class="op">:</span> <span class="st">"white"</span><span class="sc">}</span><span class="vs">;</span></span>
<span id="cb4-1625"><a href="#cb4-1625" aria-hidden="true" tabindex="-1"></a><span class="vs">  padding: 0px 5px;</span></span>
<span id="cb4-1626"><a href="#cb4-1626" aria-hidden="true" tabindex="-1"></a><span class="vs">  border-radius: 4px;</span></span>
<span id="cb4-1627"><a href="#cb4-1627" aria-hidden="true" tabindex="-1"></a><span class="vs">  font-weight: 400;</span></span>
<span id="cb4-1628"><a href="#cb4-1628" aria-hidden="true" tabindex="-1"></a><span class="vs">  font-family: monospace;</span></span>
<span id="cb4-1629"><a href="#cb4-1629" aria-hidden="true" tabindex="-1"></a><span class="vs">}</span></span>
<span id="cb4-1630"><a href="#cb4-1630" aria-hidden="true" tabindex="-1"></a><span class="vs">.color1 {</span></span>
<span id="cb4-1631"><a href="#cb4-1631" aria-hidden="true" tabindex="-1"></a><span class="vs">  background: hsl(300 100% 50%);</span></span>
<span id="cb4-1632"><a href="#cb4-1632" aria-hidden="true" tabindex="-1"></a><span class="vs">  color: </span><span class="sc">${</span><span class="fu">yiq</span>(<span class="vs">`hsl(300, 100%, 50%)`</span>) <span class="op">&gt;</span> <span class="fl">0.51</span> <span class="op">?</span> <span class="st">"black"</span> <span class="op">:</span> <span class="st">"white"</span><span class="sc">}</span><span class="vs">;</span></span>
<span id="cb4-1633"><a href="#cb4-1633" aria-hidden="true" tabindex="-1"></a><span class="vs">  padding: 0px 5px;</span></span>
<span id="cb4-1634"><a href="#cb4-1634" aria-hidden="true" tabindex="-1"></a><span class="vs">  border-radius: 4px;</span></span>
<span id="cb4-1635"><a href="#cb4-1635" aria-hidden="true" tabindex="-1"></a><span class="vs">  font-weight: 400;</span></span>
<span id="cb4-1636"><a href="#cb4-1636" aria-hidden="true" tabindex="-1"></a><span class="vs">  font-family: monospace;</span></span>
<span id="cb4-1637"><a href="#cb4-1637" aria-hidden="true" tabindex="-1"></a><span class="vs">}</span></span>
<span id="cb4-1638"><a href="#cb4-1638" aria-hidden="true" tabindex="-1"></a><span class="vs">.color2 {</span></span>
<span id="cb4-1639"><a href="#cb4-1639" aria-hidden="true" tabindex="-1"></a><span class="vs">  background: hsl(280 100% 50%);</span></span>
<span id="cb4-1640"><a href="#cb4-1640" aria-hidden="true" tabindex="-1"></a><span class="vs">  color: </span><span class="sc">${</span><span class="fu">yiq</span>(<span class="vs">`hsl(280, 100%, 50%)`</span>) <span class="op">&gt;</span> <span class="fl">0.51</span> <span class="op">?</span> <span class="st">"black"</span> <span class="op">:</span> <span class="st">"white"</span><span class="sc">}</span><span class="vs">;</span></span>
<span id="cb4-1641"><a href="#cb4-1641" aria-hidden="true" tabindex="-1"></a><span class="vs">  padding: 0px 5px;</span></span>
<span id="cb4-1642"><a href="#cb4-1642" aria-hidden="true" tabindex="-1"></a><span class="vs">  border-radius: 4px;</span></span>
<span id="cb4-1643"><a href="#cb4-1643" aria-hidden="true" tabindex="-1"></a><span class="vs">  font-weight: 400;</span></span>
<span id="cb4-1644"><a href="#cb4-1644" aria-hidden="true" tabindex="-1"></a><span class="vs">  font-family: monospace;</span></span>
<span id="cb4-1645"><a href="#cb4-1645" aria-hidden="true" tabindex="-1"></a><span class="vs">}</span></span>
<span id="cb4-1646"><a href="#cb4-1646" aria-hidden="true" tabindex="-1"></a><span class="vs">.color3 {</span></span>
<span id="cb4-1647"><a href="#cb4-1647" aria-hidden="true" tabindex="-1"></a><span class="vs">  background: hsl(240 100% 50%);</span></span>
<span id="cb4-1648"><a href="#cb4-1648" aria-hidden="true" tabindex="-1"></a><span class="vs">  color: </span><span class="sc">${</span><span class="fu">yiq</span>(<span class="vs">`hsl(240, 100%, 50%)`</span>) <span class="op">&gt;</span> <span class="fl">0.51</span> <span class="op">?</span> <span class="st">"black"</span> <span class="op">:</span> <span class="st">"white"</span><span class="sc">}</span><span class="vs">;</span></span>
<span id="cb4-1649"><a href="#cb4-1649" aria-hidden="true" tabindex="-1"></a><span class="vs">  padding: 0px 5px;</span></span>
<span id="cb4-1650"><a href="#cb4-1650" aria-hidden="true" tabindex="-1"></a><span class="vs">  border-radius: 4px;</span></span>
<span id="cb4-1651"><a href="#cb4-1651" aria-hidden="true" tabindex="-1"></a><span class="vs">  font-weight: 400;</span></span>
<span id="cb4-1652"><a href="#cb4-1652" aria-hidden="true" tabindex="-1"></a><span class="vs">  font-family: monospace;</span></span>
<span id="cb4-1653"><a href="#cb4-1653" aria-hidden="true" tabindex="-1"></a><span class="vs">}</span></span>
<span id="cb4-1654"><a href="#cb4-1654" aria-hidden="true" tabindex="-1"></a><span class="vs">.color4 {</span></span>
<span id="cb4-1655"><a href="#cb4-1655" aria-hidden="true" tabindex="-1"></a><span class="vs">  background: hsl(200 100% 50%);</span></span>
<span id="cb4-1656"><a href="#cb4-1656" aria-hidden="true" tabindex="-1"></a><span class="vs">  color: </span><span class="sc">${</span><span class="fu">yiq</span>(<span class="vs">`hsl(200, 100%, 50%)`</span>) <span class="op">&gt;</span> <span class="fl">0.51</span> <span class="op">?</span> <span class="st">"black"</span> <span class="op">:</span> <span class="st">"white"</span><span class="sc">}</span><span class="vs">;</span></span>
<span id="cb4-1657"><a href="#cb4-1657" aria-hidden="true" tabindex="-1"></a><span class="vs">  padding: 0px 5px;</span></span>
<span id="cb4-1658"><a href="#cb4-1658" aria-hidden="true" tabindex="-1"></a><span class="vs">  border-radius: 4px;</span></span>
<span id="cb4-1659"><a href="#cb4-1659" aria-hidden="true" tabindex="-1"></a><span class="vs">  font-weight: 400;</span></span>
<span id="cb4-1660"><a href="#cb4-1660" aria-hidden="true" tabindex="-1"></a><span class="vs">  font-family: monospace;</span></span>
<span id="cb4-1661"><a href="#cb4-1661" aria-hidden="true" tabindex="-1"></a><span class="vs">}</span></span>
<span id="cb4-1662"><a href="#cb4-1662" aria-hidden="true" tabindex="-1"></a><span class="vs">.color5 {</span></span>
<span id="cb4-1663"><a href="#cb4-1663" aria-hidden="true" tabindex="-1"></a><span class="vs">  background: hsl(180 100% 50%);</span></span>
<span id="cb4-1664"><a href="#cb4-1664" aria-hidden="true" tabindex="-1"></a><span class="vs">  color: </span><span class="sc">${</span><span class="fu">yiq</span>(<span class="vs">`hsl(180, 100%, 50%)`</span>) <span class="op">&gt;</span> <span class="fl">0.51</span> <span class="op">?</span> <span class="st">"black"</span> <span class="op">:</span> <span class="st">"white"</span><span class="sc">}</span><span class="vs">;</span></span>
<span id="cb4-1665"><a href="#cb4-1665" aria-hidden="true" tabindex="-1"></a><span class="vs">  padding: 0px 5px;</span></span>
<span id="cb4-1666"><a href="#cb4-1666" aria-hidden="true" tabindex="-1"></a><span class="vs">  border-radius: 4px;</span></span>
<span id="cb4-1667"><a href="#cb4-1667" aria-hidden="true" tabindex="-1"></a><span class="vs">  font-weight: 400;</span></span>
<span id="cb4-1668"><a href="#cb4-1668" aria-hidden="true" tabindex="-1"></a><span class="vs">  font-family: monospace;</span></span>
<span id="cb4-1669"><a href="#cb4-1669" aria-hidden="true" tabindex="-1"></a><span class="vs">}</span></span>
<span id="cb4-1670"><a href="#cb4-1670" aria-hidden="true" tabindex="-1"></a><span class="vs">.color6 {</span></span>
<span id="cb4-1671"><a href="#cb4-1671" aria-hidden="true" tabindex="-1"></a><span class="vs">  background: hsl(120 100% 50%);</span></span>
<span id="cb4-1672"><a href="#cb4-1672" aria-hidden="true" tabindex="-1"></a><span class="vs">  color: </span><span class="sc">${</span><span class="fu">yiq</span>(<span class="vs">`hsl(120, 100%, 50%)`</span>) <span class="op">&gt;</span> <span class="fl">0.51</span> <span class="op">?</span> <span class="st">"black"</span> <span class="op">:</span> <span class="st">"white"</span><span class="sc">}</span><span class="vs">;</span></span>
<span id="cb4-1673"><a href="#cb4-1673" aria-hidden="true" tabindex="-1"></a><span class="vs">  padding: 0px 5px;</span></span>
<span id="cb4-1674"><a href="#cb4-1674" aria-hidden="true" tabindex="-1"></a><span class="vs">  border-radius: 4px;</span></span>
<span id="cb4-1675"><a href="#cb4-1675" aria-hidden="true" tabindex="-1"></a><span class="vs">  font-weight: 400;</span></span>
<span id="cb4-1676"><a href="#cb4-1676" aria-hidden="true" tabindex="-1"></a><span class="vs">  font-family: monospace;</span></span>
<span id="cb4-1677"><a href="#cb4-1677" aria-hidden="true" tabindex="-1"></a><span class="vs">}</span></span>
<span id="cb4-1678"><a href="#cb4-1678" aria-hidden="true" tabindex="-1"></a><span class="vs">.color7 {</span></span>
<span id="cb4-1679"><a href="#cb4-1679" aria-hidden="true" tabindex="-1"></a><span class="vs">  background: hsl(80 100% 50%);</span></span>
<span id="cb4-1680"><a href="#cb4-1680" aria-hidden="true" tabindex="-1"></a><span class="vs">  color: </span><span class="sc">${</span><span class="fu">yiq</span>(<span class="vs">`hsl(80, 100%, 50%)`</span>) <span class="op">&gt;</span> <span class="fl">0.51</span> <span class="op">?</span> <span class="st">"black"</span> <span class="op">:</span> <span class="st">"white"</span><span class="sc">}</span><span class="vs">;</span></span>
<span id="cb4-1681"><a href="#cb4-1681" aria-hidden="true" tabindex="-1"></a><span class="vs">  padding: 0px 5px;</span></span>
<span id="cb4-1682"><a href="#cb4-1682" aria-hidden="true" tabindex="-1"></a><span class="vs">  border-radius: 4px;</span></span>
<span id="cb4-1683"><a href="#cb4-1683" aria-hidden="true" tabindex="-1"></a><span class="vs">  font-weight: 400;</span></span>
<span id="cb4-1684"><a href="#cb4-1684" aria-hidden="true" tabindex="-1"></a><span class="vs">  font-family: monospace;</span></span>
<span id="cb4-1685"><a href="#cb4-1685" aria-hidden="true" tabindex="-1"></a><span class="vs">}</span></span>
<span id="cb4-1686"><a href="#cb4-1686" aria-hidden="true" tabindex="-1"></a><span class="vs">.color8 {</span></span>
<span id="cb4-1687"><a href="#cb4-1687" aria-hidden="true" tabindex="-1"></a><span class="vs">  background: hsl(60 100% 50%);</span></span>
<span id="cb4-1688"><a href="#cb4-1688" aria-hidden="true" tabindex="-1"></a><span class="vs">  color: </span><span class="sc">${</span><span class="fu">yiq</span>(<span class="vs">`hsl(60, 100%, 50%)`</span>) <span class="op">&gt;</span> <span class="fl">0.51</span> <span class="op">?</span> <span class="st">"black"</span> <span class="op">:</span> <span class="st">"white"</span><span class="sc">}</span><span class="vs">;</span></span>
<span id="cb4-1689"><a href="#cb4-1689" aria-hidden="true" tabindex="-1"></a><span class="vs">  padding: 0px 5px;</span></span>
<span id="cb4-1690"><a href="#cb4-1690" aria-hidden="true" tabindex="-1"></a><span class="vs">  border-radius: 4px;</span></span>
<span id="cb4-1691"><a href="#cb4-1691" aria-hidden="true" tabindex="-1"></a><span class="vs">  font-weight: 400;</span></span>
<span id="cb4-1692"><a href="#cb4-1692" aria-hidden="true" tabindex="-1"></a><span class="vs">  font-family: monospace;</span></span>
<span id="cb4-1693"><a href="#cb4-1693" aria-hidden="true" tabindex="-1"></a><span class="vs">}</span></span>
<span id="cb4-1694"><a href="#cb4-1694" aria-hidden="true" tabindex="-1"></a><span class="vs">.color9 {</span></span>
<span id="cb4-1695"><a href="#cb4-1695" aria-hidden="true" tabindex="-1"></a><span class="vs">  background: hsl(40 100% 50%);</span></span>
<span id="cb4-1696"><a href="#cb4-1696" aria-hidden="true" tabindex="-1"></a><span class="vs">  color: </span><span class="sc">${</span><span class="fu">yiq</span>(<span class="vs">`hsl(40, 100%, 50%)`</span>) <span class="op">&gt;</span> <span class="fl">0.51</span> <span class="op">?</span> <span class="st">"black"</span> <span class="op">:</span> <span class="st">"white"</span><span class="sc">}</span><span class="vs">;</span></span>
<span id="cb4-1697"><a href="#cb4-1697" aria-hidden="true" tabindex="-1"></a><span class="vs">  padding: 0px 5px;</span></span>
<span id="cb4-1698"><a href="#cb4-1698" aria-hidden="true" tabindex="-1"></a><span class="vs">  border-radius: 4px;</span></span>
<span id="cb4-1699"><a href="#cb4-1699" aria-hidden="true" tabindex="-1"></a><span class="vs">  font-weight: 400;</span></span>
<span id="cb4-1700"><a href="#cb4-1700" aria-hidden="true" tabindex="-1"></a><span class="vs">  font-family: monospace;</span></span>
<span id="cb4-1701"><a href="#cb4-1701" aria-hidden="true" tabindex="-1"></a><span class="vs">}</span></span>
<span id="cb4-1702"><a href="#cb4-1702" aria-hidden="true" tabindex="-1"></a><span class="vs">&lt;/style&gt;</span></span>
<span id="cb4-1703"><a href="#cb4-1703" aria-hidden="true" tabindex="-1"></a><span class="vs">`</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display hidden">
<div id="ojs-cell-3" data-nodetype="expression">

</div>
</div>
</div>
<style>
#barClock {
  width: 98%;
  overflow: visible;
}
.tickLabel, .tickLabel1, .tickLabel2, .timeLabel {
  fill: #000;
  font-family: monospace;
  text-anchor: middle;
}
.timeLabel {
  text-anchor: start;
}
.timeBar, .timeBarFull, .timeBarFullN {
  x: 1px;
  height: 25px;
  rx: 5px;
  stroke: #aaa;
}
.timeBar {
  fill: #e8e8e8;
}
.timeBarFull {
  fill: #ccffff;
}
.timeBarFullN {
  fill: #ffcccc;
}
.background {
  fill: white;
}
.tickDek, .tickDotd, .tickDotd1, .tickC, .tickC1, .tickM, .tickM1, .tickB, .tickB1 {
  stroke: none;
  fill: #666;
  width: 1px;
}
#clock {
  stroke: #000;
  font-family: "HelveticaNeue-Light", "Helvetica Neue Light", "Helvetica Neue", Helvetica, Arial, "Lucida Grande", sans-serif;
}
#clock #rim {
  fill: none;
  stroke: #999;
  stroke-width: 3px;
}
#clock .second-hand {
  stroke-width: 3;
}
#clock .minute-hand {
  stroke-width: 8;
  stroke-linecap: round;
}
#clock .hour-hand {
  stroke-width: 12;
  stroke-linecap: round;
}
#clock .hands-cover {
  stroke-width: 3;
  fill: #fff;
}
#clock .second-tick {
  stroke-width: 3;
  fill: #000;
}
#clock .hour-tick {
  stroke-width: 8; // same as the minute hand
}
#clock .second-label {
  font-size: 18px;
}
#clock .hour-label {
  font-size: 32px
}
.clocks * {
  margin: -10px 0px 10px 0px;
  padding: 0px;
}
#title-block-header > div:nth-child(2) {
  display: none;
}
h4.hiddenheading, h5.hiddenheading {
  display: none;
}
</style>


<!-- -->

<div class="ojs-auto-generated hidden">
<script type="ojs-module-contents">
eyJjb250ZW50cyI6WyAgeyJtZXRob2ROYW1lIjoiaW50ZXJwcmV0IiwiaW5saW5lIjoidHJ1ZSIsInNvdXJjZSI6Imh0bC5odG1sYDxzcGFuPiR7c2VsZWN0ZWRab25lfTwvc3Bhbj5gIiwgImNlbGxOYW1lIjoib2pzLWVsZW1lbnQtaWQtMSJ9LCAgeyJtZXRob2ROYW1lIjoiaW50ZXJwcmV0IiwiaW5saW5lIjoidHJ1ZSIsInNvdXJjZSI6Imh0bC5odG1sYDxzcGFuPiR7ZGVjVGltZX08L3NwYW4+YCIsICJjZWxsTmFtZSI6Im9qcy1lbGVtZW50LWlkLTIifSwgIHsibWV0aG9kTmFtZSI6ImludGVycHJldCIsImlubGluZSI6InRydWUiLCJzb3VyY2UiOiJodGwuaHRtbGA8c3Bhbj4ke2RlY1RpbWVOfTwvc3Bhbj5gIiwgImNlbGxOYW1lIjoib2pzLWVsZW1lbnQtaWQtMyJ9LCAgeyJtZXRob2ROYW1lIjoiaW50ZXJwcmV0IiwiaW5saW5lIjoidHJ1ZSIsInNvdXJjZSI6Imh0bC5odG1sYDxzcGFuPiR7Y2xvY2t9JHtjbG9jazF9PC9zcGFuPmAiLCAiY2VsbE5hbWUiOiJvanMtZWxlbWVudC1pZC00In0sICB7Im1ldGhvZE5hbWUiOiJpbnRlcnByZXQiLCJpbmxpbmUiOiJ0cnVlIiwic291cmNlIjoiaHRsLmh0bWxgPHNwYW4+JHticm93c2VyVGltZS50b0ZpeGVkKDQpfTwvc3Bhbj5gIiwgImNlbGxOYW1lIjoib2pzLWVsZW1lbnQtaWQtNSJ9LCAgeyJtZXRob2ROYW1lIjoiaW50ZXJwcmV0IiwiaW5saW5lIjoidHJ1ZSIsInNvdXJjZSI6Imh0bC5odG1sYDxzcGFuPiR7YnJvd3NlclNpZ259PC9zcGFuPmAiLCAiY2VsbE5hbWUiOiJvanMtZWxlbWVudC1pZC02In0sICB7Im1ldGhvZE5hbWUiOiJpbnRlcnByZXQiLCJpbmxpbmUiOiJ0cnVlIiwic291cmNlIjoiaHRsLmh0bWxgPHNwYW4+JHtNYXRoLmFicyhicm93c2VyWm9uZSl9PC9zcGFuPmAiLCAiY2VsbE5hbWUiOiJvanMtZWxlbWVudC1pZC03In0sICB7Im1ldGhvZE5hbWUiOiJpbnRlcnByZXQiLCJpbmxpbmUiOiJ0cnVlIiwic291cmNlIjoiaHRsLmh0bWxgPHNwYW4+JHt6b25lMHRpbWUudG9GaXhlZCg0KX08L3NwYW4+YCIsICJjZWxsTmFtZSI6Im9qcy1lbGVtZW50LWlkLTgifSwgIHsibWV0aG9kTmFtZSI6ImludGVycHJldCIsImlubGluZSI6InRydWUiLCJzb3VyY2UiOiJodGwuaHRtbGA8c3Bhbj4ke2Jyb3dzZXJab25lfTwvc3Bhbj5gIiwgImNlbGxOYW1lIjoib2pzLWVsZW1lbnQtaWQtOSJ9LCAgeyJtZXRob2ROYW1lIjoiaW50ZXJwcmV0IiwiaW5saW5lIjoidHJ1ZSIsInNvdXJjZSI6Imh0bC5odG1sYDxzcGFuPiR7YnJvd3NlclRpbWUudG9GaXhlZCg0KX08L3NwYW4+YCIsICJjZWxsTmFtZSI6Im9qcy1lbGVtZW50LWlkLTEwIn0sICB7Im1ldGhvZE5hbWUiOiJpbnRlcnByZXQiLCJpbmxpbmUiOiJ0cnVlIiwic291cmNlIjoiaHRsLmh0bWxgPHNwYW4+JHtNYXRoLmZsb29yKGhvdXJzKS50b1N0cmluZygpLnBhZFN0YXJ0KDIsIFwiMFwiKX08L3NwYW4+YCIsICJjZWxsTmFtZSI6Im9qcy1lbGVtZW50LWlkLTExIn0sICB7Im1ldGhvZE5hbWUiOiJpbnRlcnByZXQiLCJpbmxpbmUiOiJ0cnVlIiwic291cmNlIjoiaHRsLmh0bWxgPHNwYW4+JHtNYXRoLmZsb29yKG1pbnV0ZXMpLnRvU3RyaW5nKCkucGFkU3RhcnQoMiwgXCIwXCIpfTwvc3Bhbj5gIiwgImNlbGxOYW1lIjoib2pzLWVsZW1lbnQtaWQtMTIifSwgIHsibWV0aG9kTmFtZSI6ImludGVycHJldCIsImlubGluZSI6InRydWUiLCJzb3VyY2UiOiJodGwuaHRtbGA8c3Bhbj4ke01hdGguZmxvb3Ioc2Vjb25kcykudG9TdHJpbmcoKS5wYWRTdGFydCgyLCBcIjBcIil9PC9zcGFuPmAiLCAiY2VsbE5hbWUiOiJvanMtZWxlbWVudC1pZC0xMyJ9LCAgeyJtZXRob2ROYW1lIjoiaW50ZXJwcmV0IiwiaW5saW5lIjoidHJ1ZSIsInNvdXJjZSI6Imh0bC5odG1sYDxzcGFuPiR7YnJvd3NlclRpbWUudG9GaXhlZCg0KX08L3NwYW4+YCIsICJjZWxsTmFtZSI6Im9qcy1lbGVtZW50LWlkLTE0In0sICB7Im1ldGhvZE5hbWUiOiJpbnRlcnByZXQiLCJpbmxpbmUiOiJ0cnVlIiwic291cmNlIjoiaHRsLmh0bWxgPHNwYW4+JHtNYXRoLmZsb29yKG5vdyAvIDEwMDApfTwvc3Bhbj5gIiwgImNlbGxOYW1lIjoib2pzLWVsZW1lbnQtaWQtMTUifSwgIHsibWV0aG9kTmFtZSI6ImludGVycHJldCIsImlubGluZSI6InRydWUiLCJzb3VyY2UiOiJodGwuaHRtbGA8c3Bhbj4ke2RlY1llYXJ9PC9zcGFuPmAiLCAiY2VsbE5hbWUiOiJvanMtZWxlbWVudC1pZC0xNiJ9LCAgeyJtZXRob2ROYW1lIjoiaW50ZXJwcmV0IiwiaW5saW5lIjoidHJ1ZSIsInNvdXJjZSI6Imh0bC5odG1sYDxzcGFuPiR7ZGVjRGF0ZX08L3NwYW4+YCIsICJjZWxsTmFtZSI6Im9qcy1lbGVtZW50LWlkLTE3In0sICB7Im1ldGhvZE5hbWUiOiJpbnRlcnByZXQiLCJpbmxpbmUiOiJ0cnVlIiwic291cmNlIjoiaHRsLmh0bWxgPHNwYW4+JHtkZWNZZWFyfTwvc3Bhbj5gIiwgImNlbGxOYW1lIjoib2pzLWVsZW1lbnQtaWQtMTgifSwgIHsibWV0aG9kTmFtZSI6ImludGVycHJldCIsImlubGluZSI6InRydWUiLCJzb3VyY2UiOiJodGwuaHRtbGA8c3Bhbj4ke2RlY0RhdGV9PC9zcGFuPmAiLCAiY2VsbE5hbWUiOiJvanMtZWxlbWVudC1pZC0xOSJ9LCAgeyJtZXRob2ROYW1lIjoiaW50ZXJwcmV0IiwiaW5saW5lIjoidHJ1ZSIsInNvdXJjZSI6Imh0bC5odG1sYDxzcGFuPiR7ZGVjWWVhcn08L3NwYW4+YCIsICJjZWxsTmFtZSI6Im9qcy1lbGVtZW50LWlkLTIwIn0sICB7Im1ldGhvZE5hbWUiOiJpbnRlcnByZXQiLCJpbmxpbmUiOiJ0cnVlIiwic291cmNlIjoiaHRsLmh0bWxgPHNwYW4+JHtkZWNEYXRlfTwvc3Bhbj5gIiwgImNlbGxOYW1lIjoib2pzLWVsZW1lbnQtaWQtMjEifSwgIHsibWV0aG9kTmFtZSI6ImludGVycHJldCIsImlubGluZSI6InRydWUiLCJzb3VyY2UiOiJodGwuaHRtbGA8c3Bhbj4ke2RlY1llYXJ9PC9zcGFuPmAiLCAiY2VsbE5hbWUiOiJvanMtZWxlbWVudC1pZC0yMiJ9LCAgeyJtZXRob2ROYW1lIjoiaW50ZXJwcmV0IiwiaW5saW5lIjoidHJ1ZSIsInNvdXJjZSI6Imh0bC5odG1sYDxzcGFuPiR7ZGVjRGF0ZX08L3NwYW4+YCIsICJjZWxsTmFtZSI6Im9qcy1lbGVtZW50LWlkLTIzIn0sICB7Im1ldGhvZE5hbWUiOiJpbnRlcnByZXQiLCJpbmxpbmUiOiJ0cnVlIiwic291cmNlIjoiaHRsLmh0bWxgPHNwYW4+JHtkZWNZZWFyfTwvc3Bhbj5gIiwgImNlbGxOYW1lIjoib2pzLWVsZW1lbnQtaWQtMjQifSwgIHsibWV0aG9kTmFtZSI6ImludGVycHJldCIsImlubGluZSI6InRydWUiLCJzb3VyY2UiOiJodGwuaHRtbGA8c3Bhbj4ke2RlY0RhdGV9PC9zcGFuPmAiLCAiY2VsbE5hbWUiOiJvanMtZWxlbWVudC1pZC0yNSJ9XX0=
</script>
</div>
</section>

<a onclick="window.scrollTo(0, 0); return false;" role="button" id="quarto-back-to-top"><i class="bi bi-arrow-up"></i> Back to top</a><div id="quarto-appendix" class="default"><section class="quarto-appendix-contents" id="quarto-reuse"><h2 class="anchored quarto-appendix-heading">Reuse</h2><div class="quarto-appendix-contents"><div><a rel="license" href="https://creativecommons.org/licenses/by-sa/4.0/">CC BY-SA 4.0</a></div></div></section><section class="quarto-appendix-contents" id="quarto-citation"><h2 class="anchored quarto-appendix-heading">Citation</h2><div><div class="quarto-appendix-secondary-label">BibTeX citation:</div><pre class="sourceCode code-with-copy quarto-appendix-bibtex"><code class="sourceCode bibtex">@online{laptev2024,
  author = {Laptev, Martin},
  title = {Dec {Time}},
  date = {2024},
  urldate = {2024},
  url = {https://maptv.github.io/dec/time},
  langid = {en}
}
</code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre><div class="quarto-appendix-secondary-label">For attribution, please cite this work as:</div><div id="ref-laptev2024" class="csl-entry quarto-appendix-citeas" role="listitem">
Laptev, Martin. 2024. <span>“Dec Time.”</span> 2024. <a href="https://maptv.github.io/dec/time">https://maptv.github.io/dec/time</a>.
</div></div></section></div></main> <!-- /main -->
<script src="../../asset/cite.js"></script>
<style>
#title-block-header > div.quarto-title-banner.page-columns.page-full { margin: 0px; padding: 0px; }
#title-block-header { margin: 0px; }
main#quarto-document-content { margin: 0px; padding: 0px; }
ul.navbar-nav.navbar-nav-scroll { -webkit-flex-direction: row; }
#quarto-sidebar { padding: 0px; overflow-x: hidden !important; }
#quarto-sidebar > * { padding: 0px; }
div.quarto-title-meta { padding-bottom: 8px; }
h2, h3 { margin: 0px; }
h3 { margin-top: 17px !important; }
div.cell.page-columns.page-full { height: 0px !important; }
@media only screen and (max-width: 991px) { #quarto-search { display: none !important; } #quarto-sidebar { padding: 0px 9px 0px 9px !important; } }
@media only screen and (max-width: 767px) { div.cell.page-columns.page-full { display: none !important; } }
nav.quarto-secondary-nav { padding: 0px !important; }
nav.quarto-secondary-nav > div.container-fluid.d-flex { margin-top: -12px !important; margin-bottom: -14px !important; }
.quarto-secondary-nav-title { margin-top: 10px !important; }
.navbar-logo { max-height: 40px !important; }
section#cite a.uri { word-break: break-all !important; }
</style>
<script src="../../asset/stamp.js"></script>
<script>
const tooltipTriggerList = document.querySelectorAll('[data-bs-toggle="tooltip"]')
const tooltipList = [...tooltipTriggerList].map(tooltipTriggerEl => new bootstrap.Tooltip(tooltipTriggerEl))
</script>
<script type="ojs-module-contents">
eyJjb250ZW50cyI6W3sibWV0aG9kTmFtZSI6ImludGVycHJldCIsImNlbGxOYW1lIjoib2pzLWNlbGwtMSIsImlubGluZSI6ZmFsc2UsInNvdXJjZSI6Ii8vIGh0dHBzOi8vb2JzZXJ2YWJsZWhxLmNvbS9AZmhleWVuL2JhcmNoYXJ0LWNsb2NrXG5iYXJDaGFydCA9IHtcbmNvbnN0IFcgPSB3aWR0aDtcbiAgY29uc3QgSCA9IDg4O1xuICBjb25zdCBiYXJYID0gMTtcbiAgY29uc3QgZmlyc3RCYXJZID0gMTtcbiAgY29uc3Qgc3ZnID0gZDNcbiAgICAuY3JlYXRlKFwic3ZnXCIpXG4gICAgLmF0dHIoXCJ3aWR0aFwiLCBXKVxuICAgIC5hdHRyKFwidmlld0JveFwiLCBbMCwgMCwgVyAqIChXIDwgMzcwID8gLjczIDogVyA8IDQyMCA/IC43NiA6IFcgPCA0NzAgPyAuNzkgOiBXIDwgNTIwID8gLjgxIDogVyA8IDU3MCA/IC44MyA6IFcgPCA2MjAgPyAuODQgOiBXIDwgNjcwID8gLjg1IDogVyA8IDcyMCA/IC44NiA6IC44NyksIEhdKTtcbiAgY29uc3QgeFJhbmdlID0gWzAsIFcgLSAxMDBdO1xuICBjb25zdCBzY2FsZUREID0gZDMuc2NhbGVMaW5lYXIoKVxuICAgIC5kb21haW4oWzAsIDEwXSlcbiAgICAucmFuZ2UoeFJhbmdlKTtcbiAgY29uc3Qgc2NhbGVNYW5kQiA9IGQzLnNjYWxlTGluZWFyKClcbiAgICAuZG9tYWluKFswLCAxMDBdKVxuICAgIC5yYW5nZSh4UmFuZ2UpO1xuICAvLyBCYWNrZ3JvdW5kIGJhcnMgdG8gc2hvdyB3aGVyZSAxMDAlIGxpZXNcbiAgc3ZnLnNlbGVjdEFsbCgnLmJhY2tncm91bmQnKVxuICAgIC5kYXRhKFtcbiAgICAgICdkZCcsIFwibWlsc1wiLCAnYmVhdHMnXSlcbiAgICAuZW50ZXIoKVxuICAgIC5hcHBlbmQoJ3JlY3QnKVxuICAgIC5hdHRyKCdjbGFzcycsICdiYWNrZ3JvdW5kIHRpbWVCYXInKVxuICAgIC5hdHRyKCd3aWR0aCcsIFctMTAwKVxuICAgIC5hdHRyKCd5JywgKGQsaSk9PmkqMzArZmlyc3RCYXJZKVxuICAvLyBCZWF0c1xuICBzdmdcbiAgICAuYXBwZW5kKCdyZWN0JylcbiAgICAuYXR0cignY2xhc3MnLCAndGltZUJhcicpXG4gICAgLmF0dHIoJ3knLCBmaXJzdEJhclkrNjApXG4gICAgLmF0dHIoJ3dpZHRoJywgZCA9PiBzY2FsZU1hbmRCKE51bWJlcihiYXJCZWF0cykpKVxuICBzdmdcbiAgICAuYXBwZW5kKCdyZWN0JylcbiAgICAuYXR0cignY2xhc3MnLCAndGltZUJhckZ1bGwnKVxuICAgIC5hdHRyKCd5JywgZmlyc3RCYXJZKzYwKVxuICAgIC5hdHRyKCd3aWR0aCcsIGQgPT4gc2NhbGVNYW5kQihiYXJCZWF0cykpXG4gIC8vIENlbnRzL01pbHNcbiAgc3ZnXG4gICAgLmFwcGVuZCgncmVjdCcpXG4gICAgLmF0dHIoJ2NsYXNzJywgJ3RpbWVCYXInKVxuICAgIC5hdHRyKCd5JywgZmlyc3RCYXJZKVxuICAgIC5hdHRyKCd3aWR0aCcsIGQgPT4gc2NhbGVERChOdW1iZXIoYmFyREQpK051bWJlcihiYXJNaWxzKS8xMDArTnVtYmVyKGJhckJlYXRzKS8xMDAwMCkpXG4gIHN2Z1xuICAgIC5hcHBlbmQoJ3JlY3QnKVxuICAgIC5hdHRyKCdjbGFzcycsICd0aW1lQmFyRnVsbCcpXG4gICAgLmF0dHIoJ3knLCBmaXJzdEJhclkpXG4gICAgLmF0dHIoJ3dpZHRoJywgZCA9PiBzY2FsZUREKGJhckREKSlcbiAgc3ZnXG4gICAgLmFwcGVuZCgncmVjdCcpXG4gICAgLmF0dHIoJ2NsYXNzJywgJ3RpbWVCYXInKVxuICAgIC5hdHRyKCd5JywgZmlyc3RCYXJZKzMwKVxuICAgIC5hdHRyKCd3aWR0aCcsIGQgPT4gc2NhbGVNYW5kQihOdW1iZXIoYmFyTWlscykrTnVtYmVyKGJhckJlYXRzKS8xMDApKVxuICBzdmdcbiAgICAuYXBwZW5kKCdyZWN0JylcbiAgICAuYXR0cignY2xhc3MnLCAndGltZUJhckZ1bGwnKVxuICAgIC5hdHRyKCd5JywgZmlyc3RCYXJZKzMwKVxuICAgIC5hdHRyKCd3aWR0aCcsIGQgPT4gc2NhbGVNYW5kQihiYXJNaWxzKSlcbiAgLy8gQ2VudCB0aWNrc1xuICBzdmcuc2VsZWN0QWxsKCcudGlja0MnKVxuICAgIC5kYXRhKGQzLnJhbmdlKHdpZHRoID4gNTAwID8gMTAgOiAxMCwgMTAwKSlcbiAgICAuZW50ZXIoKVxuICAgIC5hcHBlbmQoJ3JlY3QnKVxuICAgIC5hdHRyKCdjbGFzcycsICd0aWNrQycpXG4gICAgLmF0dHIoJ3gnLCBkPT5zY2FsZUREKGQvMTApK2JhclgpXG4gICAgLmF0dHIoJ3knLCBmaXJzdEJhclkrMzApXG4gICAgLmF0dHIoJ2hlaWdodCcsIGQ9PmQlMj09PTA/IDg6NSlcbiAgc3ZnLnNlbGVjdEFsbCgnLnRpY2tCMScpXG4gICAgLmRhdGEoZDMucmFuZ2Uod2lkdGggPiA1MDAgPyAxMCA6IDEwLCAxMDApKVxuICAgIC5lbnRlcigpXG4gICAgLmFwcGVuZCgncmVjdCcpXG4gICAgLmF0dHIoJ2NsYXNzJywgJ3RpY2tCMScpXG4gICAgLmF0dHIoJ3gnLCBkPT5zY2FsZUREKGQvMTApK2JhclgpXG4gICAgLmF0dHIoJ3knLCBkPT5kJTI9PT0wPyBmaXJzdEJhclkrNzc6Zmlyc3RCYXJZKzgwKVxuICAgIC5hdHRyKCdoZWlnaHQnLCBkPT5kJTI9PT0wPyA4OjUpXG4gIHN2Zy5zZWxlY3RBbGwoJy50aWNrQzEnKVxuICAgIC5kYXRhKGQzLnJhbmdlKHdpZHRoID4gNTAwID8gMTAgOiAxMCwgMTAwKSlcbiAgICAuZW50ZXIoKVxuICAgIC5hcHBlbmQoJ3JlY3QnKVxuICAgIC5hdHRyKCdjbGFzcycsICd0aWNrQzEnKVxuICAgIC5hdHRyKCd4JywgZD0+c2NhbGVERChkLzEwKStiYXJYKVxuICAgIC5hdHRyKCd5JywgZD0+ZCUyPT09MD8gZmlyc3RCYXJZKzQ3OmZpcnN0QmFyWSs1MClcbiAgICAuYXR0cignaGVpZ2h0JywgZD0+ZCUyPT09MD8gODo1KVxuICAvLyBNaWwgdGlja3NcbiAgc3ZnLnNlbGVjdEFsbCgnLnRpY2tNJylcbiAgICAuZGF0YShkMy5yYW5nZSh3aWR0aCA+IDUwMCA/IDEgOiAxLCAxMCkpXG4gICAgLmVudGVyKClcbiAgICAuYXBwZW5kKCdyZWN0JylcbiAgICAuYXR0cignY2xhc3MnLCAndGlja00nKVxuICAgIC5hdHRyKCd4JywgZD0+c2NhbGVERChkKStiYXJYKVxuICAgIC5hdHRyKCd5JywgZmlyc3RCYXJZKzIwKVxuICAgIC5hdHRyKCdoZWlnaHQnLCA2KVxuICBzdmcuc2VsZWN0QWxsKCcudGlja0xhYmVsMScpXG4gICAgLmRhdGEoZDMucmFuZ2Uod2lkdGggPiA1MDAgPyAxIDogMSwgMTApKVxuICAgIC5lbnRlcigpXG4gICAgLmFwcGVuZCgndGV4dCcpXG4gICAgLmF0dHIoJ2NsYXNzJywgJ3RpY2tMYWJlbDEnKVxuICAgIC5hdHRyKCd4JywgZD0+c2NhbGVERChkKStiYXJYKy41KVxuICAgIC5hdHRyKCd5JywgZmlyc3RCYXJZKzE4KVxuICAgIC8vLnN0eWxlKFwiZm9udC1zaXplXCIsIGB7VyA8IDU1MCA/IDEyIDogVyA8IDY1MCA/IDE0IDogVyA8IDc1MCA/IDE2IDogVyA8IDg1MCA/IDE4IDogMjB9cHhgKVxuICAgIC50ZXh0KGQ9PmQpXG4gIC8vIENlbnQgdGlja3NcbiAgc3ZnLnNlbGVjdEFsbCgnLnRpY2tDMicpXG4gICAgLmRhdGEoZDMucmFuZ2Uod2lkdGggPiA1MDAgPyAxMCA6IDEwLCAxMDApKVxuICAgIC5lbnRlcigpXG4gICAgLmFwcGVuZCgncmVjdCcpXG4gICAgLmF0dHIoJ2NsYXNzJywgJ3RpY2tDMicpXG4gICAgLmF0dHIoJ3gnLCBkPT5zY2FsZUREKGQvMTApK2JhclgpXG4gICAgLmF0dHIoJ3knLCBmaXJzdEJhclkrMTApXG4gICAgLmF0dHIoJ2hlaWdodCcsIGQ9PmQlMj09PTA/IDk6NilcbiAgLy8gQmVhdCB0aWNrc1xuICBzdmcuc2VsZWN0QWxsKCcudGlja0InKVxuICAgIC5kYXRhKGQzLnJhbmdlKHdpZHRoID4gNTAwID8gMTAgOiAxMCwgMTAwKSlcbiAgICAuZW50ZXIoKVxuICAgIC5hcHBlbmQoJ3JlY3QnKVxuICAgIC5hdHRyKCdjbGFzcycsICd0aWNrQicpXG4gICAgLmF0dHIoJ3gnLCBkPT5zY2FsZUREKGQvMTApK2JhclgpXG4gICAgLmF0dHIoJ3knLCBmaXJzdEJhclkrNjApXG4gICAgLmF0dHIoJ2hlaWdodCcsIGQ9PmQlMj09PTA/IDk6NilcbiAgLy8gTGFiZWxzXG4gIHN2Zy5zZWxlY3RBbGwoJy50aW1lTGFiZWwnKVxuICAgIC5kYXRhKFtgKyR7YmFyRER9YCwgYCR7YmFyTWlsc31gLCBgJHtiYXJCZWF0c31gXSlcbiAgICAuZW50ZXIoKVxuICAgIC5hcHBlbmQoJ3RleHQnKVxuICAgIC5hdHRyKCdjbGFzcycsICd0aW1lTGFiZWwnKVxuICAgIC5hdHRyKCd4JywgYmFyWCsyKVxuICAgIC5hdHRyKCd5JywgKGQsaSk9PmkqMzArZmlyc3RCYXJZKzIwKVxuICAgIC5zdHlsZShcImZvbnQtc2l6ZVwiLCBgJHtXIDwgMzAwID8gMTQgOiBXIDwgNDAwID8gMTYgOiBXIDwgNTAwID8gMTggOiBXIDwgNjAwID8gMjAgOiAyMn1weGApXG4gICAgLnRleHQoZD0+ZCk7XG4gIHN2Zy5hdHRyKFwiaWRcIiwgXCJiYXJDbG9ja1wiKTtcbiAgcmV0dXJuIHN2Zy5ub2RlKCk7XG59XG5iYXJDaGFydDEgPSB7XG5jb25zdCBXID0gd2lkdGg7XG4gIGNvbnN0IEggPSA4ODtcbiAgY29uc3QgYmFyWCA9IDE7XG4gIGNvbnN0IGZpcnN0QmFyWSA9IDE7XG4gIGNvbnN0IHN2ZyA9IGQzXG4gICAgLmNyZWF0ZShcInN2Z1wiKVxuICAgIC5hdHRyKFwid2lkdGhcIiwgVylcbiAgICAuYXR0cihcInZpZXdCb3hcIiwgWzAsIDAsIFcgKiAoVyA8IDM3MCA/IC43MyA6IFcgPCA0MjAgPyAuNzYgOiBXIDwgNDcwID8gLjc5IDogVyA8IDUyMCA/IC44MSA6IFcgPCA1NzAgPyAuODMgOiBXIDwgNjIwID8gLjg0IDogVyA8IDY3MCA/IC44NSA6IFcgPCA3MjAgPyAuODYgOiAuODcpLCBIXSk7XG4gIGNvbnN0IHhSYW5nZSA9IFswLCBXIC0gMTAwXTtcbiAgY29uc3Qgc2NhbGVERCA9IGQzLnNjYWxlTGluZWFyKClcbiAgICAuZG9tYWluKFswLCAxMF0pXG4gICAgLnJhbmdlKHhSYW5nZSk7XG4gIGNvbnN0IHNjYWxlTWFuZEIgPSBkMy5zY2FsZUxpbmVhcigpXG4gICAgLmRvbWFpbihbMCwgMTAwXSlcbiAgICAucmFuZ2UoeFJhbmdlKTtcbiAgLy8gY29uc3Qgc2NhbGVEZWsgPSBkMy5zY2FsZUxpbmVhcigpXG4gIC8vICAuZG9tYWluKFswLCAzN10pXG4gIC8vICAucmFuZ2UoeFJhbmdlKTtcbiAgLy8gQmFja2dyb3VuZCBiYXJzIHRvIHNob3cgd2hlcmUgMTAwJSBsaWVzXG4gIHN2Zy5zZWxlY3RBbGwoJy5iYWNrZ3JvdW5kJylcbiAgICAuZGF0YShbXG4gICAgICAvLyAnZGVrJywgJ2RvdGQnLFxuICAgICAgJ2RkJywgXCJtaWxzXCIsICdiZWF0cyddKVxuICAgIC5lbnRlcigpXG4gICAgLmFwcGVuZCgncmVjdCcpXG4gICAgLmF0dHIoJ2NsYXNzJywgJ2JhY2tncm91bmQgdGltZUJhcicpXG4gICAgLmF0dHIoJ3dpZHRoJywgVy0xMDApXG4gICAgLmF0dHIoJ3knLCAoZCxpKT0+aSozMCtmaXJzdEJhclkpXG4gIC8vIEJlYXRzXG4gIHN2Z1xuICAgIC5hcHBlbmQoJ3JlY3QnKVxuICAgIC5hdHRyKCdjbGFzcycsICd0aW1lQmFyJylcbiAgICAuYXR0cigneScsIGZpcnN0QmFyWSs2MClcbiAgICAuYXR0cignd2lkdGgnLCBkID0+IHNjYWxlTWFuZEIoTnVtYmVyKGJhckJlYXRzTikpKVxuICBzdmdcbiAgICAuYXBwZW5kKCdyZWN0JylcbiAgICAuYXR0cignY2xhc3MnLCAndGltZUJhckZ1bGxOJylcbiAgICAuYXR0cigneScsIGZpcnN0QmFyWSs2MClcbiAgICAuYXR0cignd2lkdGgnLCBkID0+IHNjYWxlTWFuZEIoYmFyQmVhdHNOKSlcbiAgLy8gQ2VudHMvTWlsc1xuICBzdmdcbiAgICAuYXBwZW5kKCdyZWN0JylcbiAgICAuYXR0cignY2xhc3MnLCAndGltZUJhcicpXG4gICAgLmF0dHIoJ3knLCBmaXJzdEJhclkpXG4gICAgLmF0dHIoJ3dpZHRoJywgZCA9PiBzY2FsZUREKE51bWJlcihiYXJERE4pK051bWJlcihiYXJNaWxzTikvMTAwK051bWJlcihiYXJCZWF0c04pLzEwMDAwKSlcbiAgc3ZnXG4gICAgLmFwcGVuZCgncmVjdCcpXG4gICAgLmF0dHIoJ2NsYXNzJywgJ3RpbWVCYXJGdWxsTicpXG4gICAgLmF0dHIoJ3knLCBmaXJzdEJhclkpXG4gICAgLmF0dHIoJ3dpZHRoJywgZCA9PiBzY2FsZUREKGJhckRETikpXG4gIHN2Z1xuICAgIC5hcHBlbmQoJ3JlY3QnKVxuICAgIC5hdHRyKCdjbGFzcycsICd0aW1lQmFyJylcbiAgICAuYXR0cigneScsIGZpcnN0QmFyWSszMClcbiAgICAuYXR0cignd2lkdGgnLCBkID0+IHNjYWxlTWFuZEIoTnVtYmVyKGJhck1pbHNOKStOdW1iZXIoYmFyQmVhdHNOKS8xMDApKVxuICBzdmdcbiAgICAuYXBwZW5kKCdyZWN0JylcbiAgICAuYXR0cignY2xhc3MnLCAndGltZUJhckZ1bGxOJylcbiAgICAuYXR0cigneScsIGZpcnN0QmFyWSszMClcbiAgICAuYXR0cignd2lkdGgnLCBkID0+IHNjYWxlTWFuZEIoYmFyTWlsc04pKVxuICAvLyBDZW50IHRpY2tzXG4gIHN2Zy5zZWxlY3RBbGwoJy50aWNrQycpXG4gICAgLmRhdGEoZDMucmFuZ2Uod2lkdGggPiA1MDAgPyAxMCA6IDEwLCAxMDApKVxuICAgIC5lbnRlcigpXG4gICAgLmFwcGVuZCgncmVjdCcpXG4gICAgLmF0dHIoJ2NsYXNzJywgJ3RpY2tDJylcbiAgICAuYXR0cigneCcsIGQ9PnNjYWxlREQoZC8xMCkrYmFyWClcbiAgICAuYXR0cigneScsIGZpcnN0QmFyWSszMClcbiAgICAuYXR0cignaGVpZ2h0JywgZD0+ZCUyPT09MD8gODo1KVxuICBzdmcuc2VsZWN0QWxsKCcudGlja0IxJylcbiAgICAuZGF0YShkMy5yYW5nZSh3aWR0aCA+IDUwMCA/IDEwIDogMTAsIDEwMCkpXG4gICAgLmVudGVyKClcbiAgICAuYXBwZW5kKCdyZWN0JylcbiAgICAuYXR0cignY2xhc3MnLCAndGlja0IxJylcbiAgICAuYXR0cigneCcsIGQ9PnNjYWxlREQoZC8xMCkrYmFyWClcbiAgICAuYXR0cigneScsIGQ9PmQlMj09PTA/IGZpcnN0QmFyWSs3NzpmaXJzdEJhclkrODApXG4gICAgLmF0dHIoJ2hlaWdodCcsIGQ9PmQlMj09PTA/IDg6NSlcbiAgc3ZnLnNlbGVjdEFsbCgnLnRpY2tDMScpXG4gICAgLmRhdGEoZDMucmFuZ2Uod2lkdGggPiA1MDAgPyAxMCA6IDEwLCAxMDApKVxuICAgIC5lbnRlcigpXG4gICAgLmFwcGVuZCgncmVjdCcpXG4gICAgLmF0dHIoJ2NsYXNzJywgJ3RpY2tDMScpXG4gICAgLmF0dHIoJ3gnLCBkPT5zY2FsZUREKGQvMTApK2JhclgpXG4gICAgLmF0dHIoJ3knLCBkPT5kJTI9PT0wPyBmaXJzdEJhclkrNDc6Zmlyc3RCYXJZKzUwKVxuICAgIC5hdHRyKCdoZWlnaHQnLCBkPT5kJTI9PT0wPyA4OjUpXG4gIC8vIE1pbCB0aWNrc1xuICBzdmcuc2VsZWN0QWxsKCcudGlja00nKVxuICAgIC5kYXRhKGQzLnJhbmdlKHdpZHRoID4gNTAwID8gMSA6IDEsIDEwKSlcbiAgICAuZW50ZXIoKVxuICAgIC5hcHBlbmQoJ3JlY3QnKVxuICAgIC5hdHRyKCdjbGFzcycsICd0aWNrTScpXG4gICAgLmF0dHIoJ3gnLCBkPT5zY2FsZUREKGQpK2JhclgpXG4gICAgLmF0dHIoJ3knLCBmaXJzdEJhclkrMjApXG4gICAgLmF0dHIoJ2hlaWdodCcsIDYpXG4gIHN2Zy5zZWxlY3RBbGwoJy50aWNrTGFiZWwxJylcbiAgICAuZGF0YShkMy5yYW5nZSh3aWR0aCA+IDUwMCA/IDEgOiAxLCAxMCkpXG4gICAgLmVudGVyKClcbiAgICAuYXBwZW5kKCd0ZXh0JylcbiAgICAuYXR0cignY2xhc3MnLCAndGlja0xhYmVsMScpXG4gICAgLmF0dHIoJ3gnLCBkPT5zY2FsZUREKGQpK2JhclgrLjUpXG4gICAgLmF0dHIoJ3knLCBmaXJzdEJhclkrMTgpXG4gICAgLy8uc3R5bGUoXCJmb250LXNpemVcIiwgYHtXIDwgMzUwID8gMTIgOiBXIDwgNDUwID8gMTQgOiBXIDwgNTUwID8gMTYgOiBXIDwgNjUwID8gMTggOiAyMH1weGApXG4gICAgLnRleHQoZD0+ZClcbiAgLy8gQ2VudCB0aWNrc1xuICBzdmcuc2VsZWN0QWxsKCcudGlja0MyJylcbiAgICAuZGF0YShkMy5yYW5nZSh3aWR0aCA+IDUwMCA/IDEwIDogMTAsIDEwMCkpXG4gICAgLmVudGVyKClcbiAgICAuYXBwZW5kKCdyZWN0JylcbiAgICAuYXR0cignY2xhc3MnLCAndGlja0MyJylcbiAgICAuYXR0cigneCcsIGQ9PnNjYWxlREQoZC8xMCkrYmFyWClcbiAgICAuYXR0cigneScsIGZpcnN0QmFyWSsxMClcbiAgICAuYXR0cignaGVpZ2h0JywgZD0+ZCUyPT09MD8gOTo2KVxuICAvLyBCZWF0IHRpY2tzXG4gIHN2Zy5zZWxlY3RBbGwoJy50aWNrQicpXG4gICAgLmRhdGEoZDMucmFuZ2Uod2lkdGggPiA1MDAgPyAxMCA6IDEwLCAxMDApKVxuICAgIC5lbnRlcigpXG4gICAgLmFwcGVuZCgncmVjdCcpXG4gICAgLmF0dHIoJ2NsYXNzJywgJ3RpY2tCJylcbiAgICAuYXR0cigneCcsIGQ9PnNjYWxlREQoZC8xMCkrYmFyWClcbiAgICAuYXR0cigneScsIGZpcnN0QmFyWSs2MClcbiAgICAuYXR0cignaGVpZ2h0JywgZD0+ZCUyPT09MD8gOTo2KVxuICAvLyBMYWJlbHNcbiAgc3ZnLnNlbGVjdEFsbCgnLnRpbWVMYWJlbCcpXG4gICAgLmRhdGEoW2AtJHtiYXJERE59YCwgYCR7YmFyTWlsc059YCwgYCR7YmFyQmVhdHNOfWBdKVxuICAgIC5lbnRlcigpXG4gICAgLmFwcGVuZCgndGV4dCcpXG4gICAgLmF0dHIoJ2NsYXNzJywgJ3RpbWVMYWJlbCcpXG4gICAgLmF0dHIoJ3gnLCBiYXJYKzIpXG4gICAgLmF0dHIoJ3knLCAoZCxpKT0+aSozMCtmaXJzdEJhclkrMjApXG4gICAgLnN0eWxlKFwiZm9udC1zaXplXCIsIGAke1cgPCAzMDAgPyAxNCA6IFcgPCA0MDAgPyAxNiA6IFcgPCA1MDAgPyAxOCA6IFcgPCA2MDAgPyAyMCA6IDIyfXB4YClcbiAgICAudGV4dChkPT5kKTtcbiAgc3ZnLmF0dHIoXCJpZFwiLCBcImJhckNsb2NrXCIpO1xuICByZXR1cm4gc3ZnLm5vZGUoKTtcbn1cbnZpZXdvZiBsb2NhdGlvbiA9IHdvcmxkTWFwQ29vcmRpbmF0ZXMoWzE2MiwgMF0sIFt3aWR0aCAqIC45OTgsIE1hdGgucm91bmQoKDIxIC8gNDApICogd2lkdGgpXSlcbi8vIGh0dHBzOi8vb2JzZXJ2YWJsZWhxLmNvbS9AZGJyaWRnZXMvdmlzdWFsaXppbmctc2Vhc29uYWwtZGF5bGlnaHRcbmFwcCA9IHtcbmNvbnN0IHN2ZyA9IGQzLnNlbGVjdChET00uc3ZnKHdpZHRoLCBoZWlnaHQgLSAod2lkdGggPCA0MDAgPyAxMCA6IHdpZHRoIDwgNjAwID8gMTUgOiB3aWR0aCA8IDcwMCA/IDMwIDogNDApKSk7XG4gIHN2Zy5zdHlsZShcInVzZXItc2VsZWN0XCIsIFwibm9uZVwiKVxuICAgICAuc3R5bGUoXCItd2Via2l0LXVzZXItc2VsZWN0XCIsIFwibm9uZVwiKTtcbiAgc3ZnLmF0dHIoXCJpZFwiLCBcImRheWxpZ2h0YXBwXCIpXG4gIGNvbnN0IG1hcmdpbiA9IHt0b3A6IDAsIGxlZnQ6IDEwLCByaWdodDogMTAsIGJvdHRvbTogMCwgaW5uZXI6IDN9O1xuICBjb25zdCBjb250ZW50V2lkdGggPSB3aWR0aCAtIG1hcmdpbi5sZWZ0IC0gbWFyZ2luLnJpZ2h0IC0gbWFyZ2luLmlubmVyO1xuICBjb25zdCBjb2x1bW5XaWR0aCA9IGNvbnRlbnRXaWR0aCAvIDI7XG4gIGNvbnN0IGRhdGUyMDIyID0gbmV3IERhdGUoMjAyMiwgbmV3IERhdGUoKS5nZXRNb250aCgpLCBuZXcgRGF0ZSgpLmdldERhdGUoKSwgbmV3IERhdGUoKS5nZXRIb3VycygpKVxuICBsZXQgc2VsZWN0aW9uID0ge1xuICAgIGRhdGU6IGRhdGUyMDIyLFxuICAgIGhvdXI6IGRhdGUyMDIyLmdldEhvdXJzKClcbiAgfVxuICBjb25zdCByZW5kZXJQbG90ID0gKCkgPT4ge1xuICAgIHN2Zy5zZWxlY3RBbGwoXCIjZGF5bGlnaHRwbG90ICpcIikucmVtb3ZlKCk7XG4gICAgc3ZnLnNlbGVjdChcIiNkYXlsaWdodHBsb3RcIikuY2FsbChkYXlsaWdodFBsb3QsIHtcbiAgICAgIHdpZHRoOiBjb2x1bW5XaWR0aCAvIDEuMjYsXG4gICAgICBoZWlnaHQ6IGhlaWdodCAvIDEuNTEgLSBtYXJnaW4udG9wIC0gbWFyZ2luLmJvdHRvbSxcbiAgICAgIHllYXI6IGRhdGUyMDIyLmdldEZ1bGxZZWFyKCksXG4gICAgICBsYXRpdHVkZTogbG9jYXRpb25bMV0sXG4gICAgICBkZWZhdWx0RGF0ZTogc2VsZWN0aW9uLmRhdGUsXG4gICAgICBkZWZhdWx0SG91cjogc2VsZWN0aW9uLmhvdXJcbiAgICB9KVxuICB9XG4gIGNvbnN0IHJlbmRlckdsb2JlID0gKCkgPT4ge1xuICAgIHN2Zy5zZWxlY3RBbGwoXCIjZ2xvYmUgKlwiKS5yZW1vdmUoKTtcbiAgICBzdmcuc2VsZWN0QWxsKFwiI2dsb2JlXCIpLmNhbGwoZ2xvYmUsIHsgd2lkdGg6IGNvbHVtbldpZHRoICogMS4yLCBsb2NhdGlvbiwgLi4uc2VsZWN0aW9uIH0pO1xuICB9XG4gIGNvbnN0IHJlbmRlclNvbGFyU3lzdGVtID0gKCkgPT4ge1xuICAgIHN2Zy5zZWxlY3RBbGwoXCIjc29sYXItc3lzdGVtICpcIikucmVtb3ZlKCk7XG4gICAgc3ZnLnNlbGVjdEFsbChcIiNzb2xhci1zeXN0ZW1cIikuY2FsbChzb2xhclN5c3RlbSxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBjb2x1bW5XaWR0aCAvIDEuMSxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBsb2NhdGlvbixcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBzZWxlY3Rpb24uZGF0ZSxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBzZWxlY3Rpb24uaG91cik7XG4gIH1cbiAgY29uc3Qgc2V0U2VsZWN0aW9uID0gKG5ld1NlbGVjdGlvbiwgZm9yY2VSZW5kZXIgPSBmYWxzZSkgPT4ge1xuICAgIGNvbnN0IHByZXYgPSB7Li4uc2VsZWN0aW9ufTtcbiAgICBzZWxlY3Rpb24gPSBuZXdTZWxlY3Rpb247XG4gICAgc3ZnLm5vZGUoKS52YWx1ZSA9IHNlbGVjdGlvbjtcbiAgICBpZiAoZm9yY2VSZW5kZXIpIHtcbiAgICAgIHJlbmRlclBsb3QoKTtcbiAgICAgIHJlbmRlclNvbGFyU3lzdGVtKCk7XG4gICAgICByZW5kZXJHbG9iZSgpO1xuICAgIH0gZWxzZSBpZiAocHJldi5ob3VyICE9PSBzZWxlY3Rpb24uaG91ciB8fCBwcmV2LmRhdGUgIT09IHNlbGVjdGlvbi5kYXRlKSB7XG4gICAgICByZW5kZXJTb2xhclN5c3RlbSgpO1xuICAgICAgcmVuZGVyR2xvYmUoKTtcbiAgICB9XG4gIH1cbiAgc3ZnLmFwcGVuZChcImdcIilcbiAgICAuYXR0cihcImlkXCIsIFwic29sYXItc3lzdGVtXCIpXG4gICAgLmF0dHIoXCJ0cmFuc2Zvcm1cIiwgYHRyYW5zbGF0ZSgke21hcmdpbi5sZWZ0ICsgMn0sICR7bWFyZ2luLnRvcCArIGhlaWdodCAvIDcuNX0pYCk7XG4gIGNvbnN0IHBsb3QgPSBzdmcuYXBwZW5kKFwiZ1wiKVxuICAgIC5hdHRyKFwiaWRcIiwgXCJkYXlsaWdodHBsb3RcIilcbiAgICAuYXR0cihcInRyYW5zZm9ybVwiLCBgdHJhbnNsYXRlKCR7bWFyZ2luLmxlZnR9LCAke21hcmdpbi50b3AgKyBoZWlnaHQgLyA0fSlgKTtcbiAgc3ZnLmFwcGVuZChcImdcIilcbiAgICAuYXR0cihcImlkXCIsIFwiZ2xvYmVcIilcbiAgICAuYXR0cihcInRyYW5zZm9ybVwiLCBgdHJhbnNsYXRlKCR7bWFyZ2luLmxlZnQgKyBtYXJnaW4uaW5uZXIgKyBjb2x1bW5XaWR0aCAvIDEuMjV9LCAke21hcmdpbi50b3AgKyBOdW1iZXIoY29sdW1uV2lkdGggPCAzMDApICogMTJ9KWApO1xuICBzZXRTZWxlY3Rpb24oc2VsZWN0aW9uLCB0cnVlKTtcbiAgY29uc3QgaGFuZGxlRGF0ZUhvdXJDaGFuZ2UgPSAoeyB0YXJnZXQsIGRldGFpbDogeyBkYXRlLCBob3VyIH19KSA9PiB7XG4gICAgaWYgKGRhdGUgIT0gbnVsbCAmJiBob3VyICE9IG51bGwpIHNldFNlbGVjdGlvbih7Li4uc2VsZWN0aW9uLCBkYXRlLCBob3VyfSk7XG4gIH1cbiAgc3ZnLm5vZGUoKS5hZGRFdmVudExpc3RlbmVyKEV2ZW50VHlwZS5EYXRlSG91ckNoYW5nZSwgaGFuZGxlRGF0ZUhvdXJDaGFuZ2UsIGZhbHNlKTtcbiAgcmV0dXJuIHN2Zy5ub2RlKCk7XG59XG4vLyBodHRwczovL29ic2VydmFibGVocS5jb20vQGQzL3NpbXBsZS1jbG9ja1xuLy8gaHR0cHM6Ly9vYnNlcnZhYmxlaHEuY29tL0BkcmlvL2xldHMtYnVpbGQtYW4tYW5hbG9nLWNsb2NrXG5jbG9jayA9IHtcbiAgY29uc3QgY2xvY2tSYWRpdXMgPSAyMDAsXG4gICAgbWFyZ2luID0gNTAsXG4gICAgdyA9IChjbG9ja1JhZGl1cyArIG1hcmdpbikgKiAyLFxuICAgIGggPSAoY2xvY2tSYWRpdXMgKyBtYXJnaW4pICogMixcbiAgICBob3VySGFuZExlbmd0aCA9ICgyICogY2xvY2tSYWRpdXMpIC8gMyxcbiAgICBtaW51dGVIYW5kTGVuZ3RoID0gY2xvY2tSYWRpdXMsXG4gICAgc2Vjb25kSGFuZExlbmd0aCA9IGNsb2NrUmFkaXVzIC0gMTIsXG4gICAgc2Vjb25kSGFuZEJhbGFuY2UgPSAzMCxcbiAgICBzZWNvbmRUaWNrU3RhcnQgPSBjbG9ja1JhZGl1cyxcbiAgICBzZWNvbmRUaWNrTGVuZ3RoID0gLTEwLFxuICAgIGhvdXJUaWNrU3RhcnQgPSBjbG9ja1JhZGl1cyxcbiAgICBob3VyVGlja0xlbmd0aCA9IC0xOCxcbiAgICBzZWNvbmRMYWJlbFJhZGl1cyA9IGNsb2NrUmFkaXVzICsgMTYsXG4gICAgc2Vjb25kTGFiZWxZT2Zmc2V0ID0gNSxcbiAgICBob3VyTGFiZWxSYWRpdXMgPSBjbG9ja1JhZGl1cyAtIDQwLFxuICAgIGhvdXJMYWJlbFlPZmZzZXQgPSA3LFxuICAgIHJhZGlhbnMgPSBNYXRoLlBJIC8gMTgwO1xuICBjb25zdCB0ZW4gPSBkM1xuICAgIC5zY2FsZUxpbmVhcigpXG4gICAgLnJhbmdlKFswLCAzNjBdKVxuICAgIC5kb21haW4oWzAsIDEwXSk7XG4gIGNvbnN0IHN0byA9IGQzXG4gICAgLnNjYWxlTGluZWFyKClcbiAgICAucmFuZ2UoWzAsIDM2MF0pXG4gICAgLmRvbWFpbihbMCwgMTAwXSk7XG4gIGNvbnN0IGhhbmREYXRhID0gW1xuICAgIHtcbiAgICAgIHR5cGU6IFwiaG91clwiLFxuICAgICAgdmFsdWU6IDAsXG4gICAgICBsZW5ndGg6IC1ob3VySGFuZExlbmd0aCxcbiAgICAgIHNjYWxlOiB0ZW5cbiAgICB9LFxuICAgIHtcbiAgICAgIHR5cGU6IFwibWludXRlXCIsXG4gICAgICB2YWx1ZTogMCxcbiAgICAgIGxlbmd0aDogLW1pbnV0ZUhhbmRMZW5ndGgsXG4gICAgICBzY2FsZTogc3RvXG4gICAgfSxcbiAgICB7XG4gICAgICB0eXBlOiBcInNlY29uZFwiLFxuICAgICAgdmFsdWU6IDAsXG4gICAgICBsZW5ndGg6IC1zZWNvbmRIYW5kTGVuZ3RoLFxuICAgICAgc2NhbGU6IHN0byxcbiAgICAgIGJhbGFuY2U6IHNlY29uZEhhbmRCYWxhbmNlXG4gICAgfVxuICBdO1xuICBmdW5jdGlvbiBkcmF3Q2xvY2soKSB7XG4gICAgLy8gY3JlYXRlIGFsbCB0aGUgY2xvY2sgZWxlbWVudHNcbiAgICB1cGRhdGVEYXRhKCk7IC8vZHJhdyB0aGVtIGluIHRoZSBjb3JyZWN0IHN0YXJ0aW5nIHBvc2l0aW9uXG4gICAgY29uc3QgZmFjZSA9IHN2Z1xuICAgICAgLmFwcGVuZChcImdcIilcbiAgICAgIC5hdHRyKFwiaWRcIiwgXCJjbG9jay1mYWNlXCIpXG4gICAgICAuYXR0cihcInRyYW5zZm9ybVwiLCBgdHJhbnNsYXRlKCR7W3cgLyAyLCBoIC8gMl19KWApO1xuICAgIC8vIGFkZCBtYXJrcyBmb3Igc2Vjb25kc1xuICAgIGZhY2VcbiAgICAgIC5zZWxlY3RBbGwoXCIuc2Vjb25kLXRpY2tcIilcbiAgICAgIC5kYXRhKGQzLnJhbmdlKDAsIDEwMCkpXG4gICAgICAuZW50ZXIoKVxuICAgICAgLmFwcGVuZChcImxpbmVcIilcbiAgICAgIC5hdHRyKFwiY2xhc3NcIiwgXCJzZWNvbmQtdGlja1wiKVxuICAgICAgLmF0dHIoXCJ4MVwiLCAwKVxuICAgICAgLmF0dHIoXCJ4MlwiLCAwKVxuICAgICAgLmF0dHIoXCJ5MVwiLCBzZWNvbmRUaWNrU3RhcnQpXG4gICAgICAuYXR0cihcInkyXCIsIHNlY29uZFRpY2tTdGFydCArIHNlY29uZFRpY2tMZW5ndGgpXG4gICAgICAuYXR0cihcInRyYW5zZm9ybVwiLCBkID0+IGByb3RhdGUoJHtzdG8oZCl9KWApO1xuICAgIC8vIGFuZCBsYWJlbHMuLi5cbiAgICBmYWNlXG4gICAgICAuc2VsZWN0QWxsKFwiLnNlY29uZC1sYWJlbFwiKVxuICAgICAgLmRhdGEoZDMucmFuZ2UoMCwgMTAwLCA1KSlcbiAgICAgIC5lbnRlcigpXG4gICAgICAuYXBwZW5kKFwidGV4dFwiKVxuICAgICAgLmF0dHIoXCJjbGFzc1wiLCBcInNlY29uZC1sYWJlbFwiKVxuICAgICAgLmF0dHIoXCJ0ZXh0LWFuY2hvclwiLCBcIm1pZGRsZVwiKVxuICAgICAgLmF0dHIoXCJ4XCIsIGQgPT4gc2Vjb25kTGFiZWxSYWRpdXMgKiBNYXRoLnNpbihzdG8oZCkgKiByYWRpYW5zKSlcbiAgICAgIC5hdHRyKFxuICAgICAgICBcInlcIixcbiAgICAgICAgZCA9PlxuICAgICAgICAgIC1zZWNvbmRMYWJlbFJhZGl1cyAqIE1hdGguY29zKHN0byhkKSAqIHJhZGlhbnMpICsgc2Vjb25kTGFiZWxZT2Zmc2V0XG4gICAgICApXG4gICAgICAudGV4dChkID0+IGQpO1xuICAgIC8vIC4uLiBhbmQgaG91cnNcbiAgICBmYWNlXG4gICAgICAuc2VsZWN0QWxsKFwiLmhvdXItdGlja1wiKVxuICAgICAgLmRhdGEoZDMucmFuZ2UoMCwgMTAsIDEpKVxuICAgICAgLmVudGVyKClcbiAgICAgIC5hcHBlbmQoXCJsaW5lXCIpXG4gICAgICAuYXR0cihcImNsYXNzXCIsIFwiaG91ci10aWNrXCIpXG4gICAgICAuYXR0cihcIngxXCIsIDApXG4gICAgICAuYXR0cihcIngyXCIsIDApXG4gICAgICAuYXR0cihcInkxXCIsIGhvdXJUaWNrU3RhcnQpXG4gICAgICAuYXR0cihcInkyXCIsIGhvdXJUaWNrU3RhcnQgKyBob3VyVGlja0xlbmd0aClcbiAgICAgIC5hdHRyKFwidHJhbnNmb3JtXCIsIGQgPT4gYHJvdGF0ZSgke3RlbihkKX0pYCk7XG4gICAgZmFjZVxuICAgICAgLnNlbGVjdEFsbChcIi5ob3VyLWxhYmVsXCIpXG4gICAgICAuZGF0YShkMy5yYW5nZSgwLCAxMCwgMSkpXG4gICAgICAuZW50ZXIoKVxuICAgICAgLmFwcGVuZChcInRleHRcIilcbiAgICAgIC5hdHRyKFwiY2xhc3NcIiwgXCJob3VyLWxhYmVsXCIpXG4gICAgICAuYXR0cihcInRleHQtYW5jaG9yXCIsIFwibWlkZGxlXCIpXG4gICAgICAuYXR0cihcInhcIiwgZCA9PiBob3VyTGFiZWxSYWRpdXMgKiBNYXRoLnNpbih0ZW4oZCkgKiByYWRpYW5zKSlcbiAgICAgIC5hdHRyKFxuICAgICAgICBcInlcIixcbiAgICAgICAgZCA9PiAtaG91ckxhYmVsUmFkaXVzICogTWF0aC5jb3ModGVuKGQpICogcmFkaWFucykgKyBob3VyTGFiZWxZT2Zmc2V0XG4gICAgICApXG4gICAgICAudGV4dChkID0+IGQpO1xuICAgIGNvbnN0IGhhbmRzID0gZmFjZS5hcHBlbmQoXCJnXCIpLmF0dHIoXCJpZFwiLCBcImNsb2NrLWhhbmRzXCIpO1xuICAgIGhhbmRzXG4gICAgICAuc2VsZWN0QWxsKFwibGluZVwiKVxuICAgICAgLmRhdGEoaGFuZERhdGEpXG4gICAgICAuZW50ZXIoKVxuICAgICAgLmFwcGVuZChcImxpbmVcIilcbiAgICAgIC5hdHRyKFwiY2xhc3NcIiwgZCA9PiBkLnR5cGUgKyBcIi1oYW5kXCIpXG4gICAgICAuYXR0cihcIngxXCIsIDApXG4gICAgICAuYXR0cihcInkxXCIsIGQgPT4gZC5iYWxhbmNlIHx8IDApXG4gICAgICAuYXR0cihcIngyXCIsIDApXG4gICAgICAuYXR0cihcInkyXCIsIGQgPT4gZC5sZW5ndGgpXG4gICAgICAuYXR0cihcInRyYW5zZm9ybVwiLCBkID0+IGByb3RhdGUoJHtkLnNjYWxlKGQudmFsdWUpfSlgKTtcbiAgICBmYWNlXG4gICAgICAuYXBwZW5kKFwiZ1wiKVxuICAgICAgLmF0dHIoXCJpZFwiLCBcImZhY2Utb3ZlcmxheVwiKVxuICAgICAgLmFwcGVuZChcImNpcmNsZVwiKVxuICAgICAgLmF0dHIoXCJjbGFzc1wiLCBcImhhbmRzLWNvdmVyXCIpXG4gICAgICAuYXR0cihcInhcIiwgMClcbiAgICAgIC5hdHRyKFwieVwiLCAwKVxuICAgICAgLmF0dHIoXCJyXCIsIGNsb2NrUmFkaXVzIC8gMjApO1xuICB9XG4gIGZ1bmN0aW9uIG1vdmVIYW5kcygpIHtcbiAgICBjb25zdCBzZWwgPSBkM1xuICAgICAgLnNlbGVjdChcIiNjbG9jay1oYW5kcy1maW5hbFwiKVxuICAgICAgLnNlbGVjdEFsbChcImxpbmVcIilcbiAgICAgIC5kYXRhKGhhbmREYXRhKVxuICAgICAgLnRyYW5zaXRpb24oKTtcbiAgICBpZiAoZmFuY3lTZWNvbmRzT0ZGKSBzZWwuZWFzZShkMy5lYXNlRWxhc3RpYy5wZXJpb2QoMC41KSk7XG4gICAgc2VsLmF0dHIoXCJ0cmFuc2Zvcm1cIiwgZCA9PiBgcm90YXRlKCR7ZC5zY2FsZShkLnZhbHVlKX0pYCk7XG4gIH1cbiAgZnVuY3Rpb24gdXBkYXRlRGF0YSgpIHtcbiAgICBoYW5kRGF0YVswXS52YWx1ZSA9ICFmYW5jeVNlY29uZHNPRkYgPyBNYXRoLmZsb29yKHNlbGVjdGVkRXhhY3QgKiAxMCkgOiBkZWNUaW1lWzBdO1xuICAgIGhhbmREYXRhWzFdLnZhbHVlID0gIWZhbmN5U2Vjb25kc09GRiA/IE1hdGguZmxvb3Ioc2VsZWN0ZWRFeGFjdCAqIDEwICUgMSAqIDEwMCkgOiBkZWNUaW1lLnNsaWNlKDIsIDQpO1xuICAgIGhhbmREYXRhWzJdLnZhbHVlID0gIWZhbmN5U2Vjb25kc09GRiA/IHNlbGVjdGVkRXhhY3QgKiAxMCAlIDEgKiAxMDAgJSAxICogMTAwIDogZGVjVGltZS5zbGljZSg0LCA2KTtcbiAgfVxuICBjb25zdCBzdmcgPSBkM1xuICAgIC5jcmVhdGUoXCJzdmdcIilcbiAgICAuYXR0cihcInZpZXdCb3hcIiwgWzAsIDAsIHcsIGhdKVxuICAgIC5zdHlsZShcIm1heC13aWR0aFwiLCBgJHt3aWR0aCAvIDIuMX1weGApXG4gICAgLmF0dHIoXCJjbGFzc1wiLCBcImNsb2NrLXRvcFwiKVxuICAgIC5hdHRyKFwiaWRcIiwgXCJjbG9ja1wiKTtcbiAgc3ZnXG4gICAgLmFwcGVuZChcInRleHRcIilcbiAgICAudGV4dChgKyR7ZGVjVGltZX0tJHtzZWxlY3RlZFpvbmV9YClcbiAgICAuYXR0cihcInhcIiwgY2xvY2tSYWRpdXMgKyBtYXJnaW4pXG4gICAgLmF0dHIoXCJ5XCIsIGNsb2NrUmFkaXVzICogMiArIG1hcmdpbiAqIDEuOTc1KVxuICAgIC5hdHRyKFwidGV4dC1hbmNob3JcIiwgXCJtaWRkbGVcIilcbiAgICAuYXR0cihcImZvbnQtc2l6ZVwiLCAzMilcbiAgICAuYXR0cihcImZvbnQtZmFtaWx5XCIsIFwibW9ub3NwYWNlXCIpO1xuICBkcmF3Q2xvY2soKTtcbiAgLy8gQW5pbWF0aW9uXG4gIGNvbnN0IGludGVydmFsID0gc2V0SW50ZXJ2YWwoXG4gICAgKCkgPT4ge1xuICAgICAgdXBkYXRlRGF0YSgpO1xuICAgICAgbW92ZUhhbmRzKCk7XG4gICAgfSxcbiAgICAhZmFuY3lTZWNvbmRzT0ZGID8gMTAgOiA4NjRcbiAgKTtcbiAgaW52YWxpZGF0aW9uLnRoZW4oKCkgPT4gY2xlYXJJbnRlcnZhbChpbnRlcnZhbCkpO1xuICByZXR1cm4gc3ZnLm5vZGUoKTtcbn1cbmNsb2NrMSA9IHtcbiAgY29uc3QgY2xvY2tSYWRpdXMgPSAyMDAsXG4gICAgbWFyZ2luID0gNTAsXG4gICAgdyA9IChjbG9ja1JhZGl1cyArIG1hcmdpbikgKiAyLFxuICAgIGggPSAoY2xvY2tSYWRpdXMgKyBtYXJnaW4pICogMixcbiAgICBob3VySGFuZExlbmd0aCA9ICgyICogY2xvY2tSYWRpdXMpIC8gMyxcbiAgICBtaW51dGVIYW5kTGVuZ3RoID0gY2xvY2tSYWRpdXMsXG4gICAgc2Vjb25kSGFuZExlbmd0aCA9IGNsb2NrUmFkaXVzIC0gMTIsXG4gICAgc2Vjb25kSGFuZEJhbGFuY2UgPSAzMCxcbiAgICBzZWNvbmRUaWNrU3RhcnQgPSBjbG9ja1JhZGl1cyxcbiAgICBzZWNvbmRUaWNrTGVuZ3RoID0gLTEwLFxuICAgIGhvdXJUaWNrU3RhcnQgPSBjbG9ja1JhZGl1cyxcbiAgICBob3VyVGlja0xlbmd0aCA9IC0xOCxcbiAgICBzZWNvbmRMYWJlbFJhZGl1cyA9IGNsb2NrUmFkaXVzICsgMTYsXG4gICAgc2Vjb25kTGFiZWxZT2Zmc2V0ID0gNSxcbiAgICBob3VyTGFiZWxSYWRpdXMgPSBjbG9ja1JhZGl1cyAtIDQwLFxuICAgIGhvdXJMYWJlbFlPZmZzZXQgPSA3LFxuICAgIHJhZGlhbnMgPSBNYXRoLlBJIC8gMTgwO1xuICBjb25zdCB0ZW4gPSBkM1xuICAgIC5zY2FsZUxpbmVhcigpXG4gICAgLnJhbmdlKFswLCAzNjBdKVxuICAgIC5kb21haW4oWzAsIDEwXSk7XG4gIGNvbnN0IHN0byA9IGQzXG4gICAgLnNjYWxlTGluZWFyKClcbiAgICAucmFuZ2UoWzAsIDM2MF0pXG4gICAgLmRvbWFpbihbMCwgMTAwXSk7XG4gIGNvbnN0IGhhbmREYXRhID0gW1xuICAgIHtcbiAgICAgIHR5cGU6IFwiaG91clwiLFxuICAgICAgdmFsdWU6IDAsXG4gICAgICBsZW5ndGg6IC1ob3VySGFuZExlbmd0aCxcbiAgICAgIHNjYWxlOiB0ZW5cbiAgICB9LFxuICAgIHtcbiAgICAgIHR5cGU6IFwibWludXRlXCIsXG4gICAgICB2YWx1ZTogMCxcbiAgICAgIGxlbmd0aDogLW1pbnV0ZUhhbmRMZW5ndGgsXG4gICAgICBzY2FsZTogc3RvXG4gICAgfSxcbiAgICB7XG4gICAgICB0eXBlOiBcInNlY29uZFwiLFxuICAgICAgdmFsdWU6IDAsXG4gICAgICBsZW5ndGg6IC1zZWNvbmRIYW5kTGVuZ3RoLFxuICAgICAgc2NhbGU6IHN0byxcbiAgICAgIGJhbGFuY2U6IHNlY29uZEhhbmRCYWxhbmNlXG4gICAgfVxuICBdO1xuICBmdW5jdGlvbiBkcmF3Q2xvY2soKSB7XG4gICAgLy8gY3JlYXRlIGFsbCB0aGUgY2xvY2sgZWxlbWVudHNcbiAgICB1cGRhdGVEYXRhKCk7IC8vZHJhdyB0aGVtIGluIHRoZSBjb3JyZWN0IHN0YXJ0aW5nIHBvc2l0aW9uXG4gICAgY29uc3QgZmFjZSA9IHN2Z1xuICAgICAgLmFwcGVuZChcImdcIilcbiAgICAgIC5hdHRyKFwiaWRcIiwgXCJjbG9jay1mYWNlXCIpXG4gICAgICAuYXR0cihcInRyYW5zZm9ybVwiLCBgdHJhbnNsYXRlKCR7W3cgLyAyLCBoIC8gMl19KWApO1xuICAgIC8vIGFkZCBtYXJrcyBmb3Igc2Vjb25kc1xuICAgIGZhY2VcbiAgICAgIC5zZWxlY3RBbGwoXCIuc2Vjb25kLXRpY2tcIilcbiAgICAgIC5kYXRhKGQzLnJhbmdlKDAsIDEwMCkpXG4gICAgICAuZW50ZXIoKVxuICAgICAgLmFwcGVuZChcImxpbmVcIilcbiAgICAgIC5hdHRyKFwiY2xhc3NcIiwgXCJzZWNvbmQtdGlja1wiKVxuICAgICAgLmF0dHIoXCJ4MVwiLCAwKVxuICAgICAgLmF0dHIoXCJ4MlwiLCAwKVxuICAgICAgLmF0dHIoXCJ5MVwiLCBzZWNvbmRUaWNrU3RhcnQpXG4gICAgICAuYXR0cihcInkyXCIsIHNlY29uZFRpY2tTdGFydCArIHNlY29uZFRpY2tMZW5ndGgpXG4gICAgICAuYXR0cihcInRyYW5zZm9ybVwiLCBkID0+IGByb3RhdGUoJHtzdG8oZCl9KWApO1xuICAgIC8vIGFuZCBsYWJlbHMuLi5cbiAgICBmYWNlXG4gICAgICAuc2VsZWN0QWxsKFwiLnNlY29uZC1sYWJlbFwiKVxuICAgICAgLmRhdGEoZDMucmFuZ2UoMCwgMTAwLCA1KSlcbiAgICAgIC5lbnRlcigpXG4gICAgICAuYXBwZW5kKFwidGV4dFwiKVxuICAgICAgLmF0dHIoXCJjbGFzc1wiLCBcInNlY29uZC1sYWJlbFwiKVxuICAgICAgLmF0dHIoXCJ0ZXh0LWFuY2hvclwiLCBcIm1pZGRsZVwiKVxuICAgICAgLmF0dHIoXCJ4XCIsIGQgPT4gc2Vjb25kTGFiZWxSYWRpdXMgKiBNYXRoLnNpbihzdG8oZCkgKiByYWRpYW5zKSlcbiAgICAgIC5hdHRyKFxuICAgICAgICBcInlcIixcbiAgICAgICAgZCA9PlxuICAgICAgICAgIC1zZWNvbmRMYWJlbFJhZGl1cyAqIE1hdGguY29zKHN0byhkKSAqIHJhZGlhbnMpICsgc2Vjb25kTGFiZWxZT2Zmc2V0XG4gICAgICApXG4gICAgICAudGV4dChkID0+IGQpO1xuICAgIC8vIC4uLiBhbmQgaG91cnNcbiAgICBmYWNlXG4gICAgICAuc2VsZWN0QWxsKFwiLmhvdXItdGlja1wiKVxuICAgICAgLmRhdGEoZDMucmFuZ2UoMCwgMTAsIDEpKVxuICAgICAgLmVudGVyKClcbiAgICAgIC5hcHBlbmQoXCJsaW5lXCIpXG4gICAgICAuYXR0cihcImNsYXNzXCIsIFwiaG91ci10aWNrXCIpXG4gICAgICAuYXR0cihcIngxXCIsIDApXG4gICAgICAuYXR0cihcIngyXCIsIDApXG4gICAgICAuYXR0cihcInkxXCIsIGhvdXJUaWNrU3RhcnQpXG4gICAgICAuYXR0cihcInkyXCIsIGhvdXJUaWNrU3RhcnQgKyBob3VyVGlja0xlbmd0aClcbiAgICAgIC5hdHRyKFwidHJhbnNmb3JtXCIsIGQgPT4gYHJvdGF0ZSgke3RlbihkKX0pYCk7XG4gICAgZmFjZVxuICAgICAgLnNlbGVjdEFsbChcIi5ob3VyLWxhYmVsXCIpXG4gICAgICAuZGF0YShkMy5yYW5nZSgwLCAxMCwgMSkpXG4gICAgICAuZW50ZXIoKVxuICAgICAgLmFwcGVuZChcInRleHRcIilcbiAgICAgIC5hdHRyKFwiY2xhc3NcIiwgXCJob3VyLWxhYmVsXCIpXG4gICAgICAuYXR0cihcInRleHQtYW5jaG9yXCIsIFwibWlkZGxlXCIpXG4gICAgICAuYXR0cihcInhcIiwgZCA9PiBob3VyTGFiZWxSYWRpdXMgKiBNYXRoLnNpbih0ZW4oZCkgKiByYWRpYW5zKSlcbiAgICAgIC5hdHRyKFxuICAgICAgICBcInlcIixcbiAgICAgICAgZCA9PiAtaG91ckxhYmVsUmFkaXVzICogTWF0aC5jb3ModGVuKGQpICogcmFkaWFucykgKyBob3VyTGFiZWxZT2Zmc2V0XG4gICAgICApXG4gICAgICAudGV4dChkID0+IGQpO1xuICAgIGNvbnN0IGhhbmRzID0gZmFjZS5hcHBlbmQoXCJnXCIpLmF0dHIoXCJpZFwiLCBcImNsb2NrLWhhbmRzXCIpO1xuICAgIGhhbmRzXG4gICAgICAuc2VsZWN0QWxsKFwibGluZVwiKVxuICAgICAgLmRhdGEoaGFuZERhdGEpXG4gICAgICAuZW50ZXIoKVxuICAgICAgLmFwcGVuZChcImxpbmVcIilcbiAgICAgIC5hdHRyKFwiY2xhc3NcIiwgZCA9PiBkLnR5cGUgKyBcIi1oYW5kXCIpXG4gICAgICAuYXR0cihcIngxXCIsIDApXG4gICAgICAuYXR0cihcInkxXCIsIGQgPT4gZC5iYWxhbmNlIHx8IDApXG4gICAgICAuYXR0cihcIngyXCIsIDApXG4gICAgICAuYXR0cihcInkyXCIsIGQgPT4gZC5sZW5ndGgpXG4gICAgICAuYXR0cihcInRyYW5zZm9ybVwiLCBkID0+IGByb3RhdGUoJHtkLnNjYWxlKGQudmFsdWUpfSlgKTtcbiAgICBmYWNlXG4gICAgICAuYXBwZW5kKFwiZ1wiKVxuICAgICAgLmF0dHIoXCJpZFwiLCBcImZhY2Utb3ZlcmxheVwiKVxuICAgICAgLmFwcGVuZChcImNpcmNsZVwiKVxuICAgICAgLmF0dHIoXCJjbGFzc1wiLCBcImhhbmRzLWNvdmVyXCIpXG4gICAgICAuYXR0cihcInhcIiwgMClcbiAgICAgIC5hdHRyKFwieVwiLCAwKVxuICAgICAgLmF0dHIoXCJyXCIsIGNsb2NrUmFkaXVzIC8gMjApO1xuICB9XG4gIGZ1bmN0aW9uIG1vdmVIYW5kcygpIHtcbiAgICBjb25zdCBzZWwgPSBkM1xuICAgICAgLnNlbGVjdChcIiNjbG9jay1oYW5kcy1maW5hbFwiKVxuICAgICAgLnNlbGVjdEFsbChcImxpbmVcIilcbiAgICAgIC5kYXRhKGhhbmREYXRhKVxuICAgICAgLnRyYW5zaXRpb24oKTtcbiAgICBpZiAoZmFuY3lTZWNvbmRzT0ZGKSBzZWwuZWFzZShkMy5lYXNlRWxhc3RpYy5wZXJpb2QoMC41KSk7XG4gICAgc2VsLmF0dHIoXCJ0cmFuc2Zvcm1cIiwgZCA9PiBgcm90YXRlKCR7ZC5zY2FsZShkLnZhbHVlKX0pYCk7XG4gIH1cbiAgZnVuY3Rpb24gdXBkYXRlRGF0YSgpIHtcbiAgICBoYW5kRGF0YVswXS52YWx1ZSA9ICFmYW5jeVNlY29uZHNPRkYgPyBNYXRoLmZsb29yKHNlbGVjdGVkRXhhY3ROICogMTApIDogZGVjVGltZU5bMF07XG4gICAgaGFuZERhdGFbMV0udmFsdWUgPSAhZmFuY3lTZWNvbmRzT0ZGID8gTWF0aC5mbG9vcihzZWxlY3RlZEV4YWN0TiAqIDEwICUgMSAqIDEwMCkgOiBkZWNUaW1lTi5zbGljZSgyLCA0KTtcbiAgICBoYW5kRGF0YVsyXS52YWx1ZSA9ICFmYW5jeVNlY29uZHNPRkYgPyBzZWxlY3RlZEV4YWN0TiAqIDEwICUgMSAqIDEwMCAlIDEgKiAxMDAgOiBkZWNUaW1lTi5zbGljZSg0LCA2KTtcbiAgfVxuICBjb25zdCBzdmcgPSBkM1xuICAgIC5jcmVhdGUoXCJzdmdcIilcbiAgICAuYXR0cihcInZpZXdCb3hcIiwgWzAsIDAsIHcsIGhdKVxuICAgIC5zdHlsZShcIm1heC13aWR0aFwiLCBgJHt3aWR0aCAvIDIuMX1weGApXG4gICAgLmF0dHIoXCJjbGFzc1wiLCBcImNsb2NrLWJ0bVwiKVxuICAgIC5hdHRyKFwiaWRcIiwgXCJjbG9ja1wiKTtcbiAgc3ZnXG4gICAgLmFwcGVuZChcInRleHRcIilcbiAgICAudGV4dChgLSR7ZGVjVGltZU59LSR7c2VsZWN0ZWRab25lfWApXG4gICAgLmF0dHIoXCJ4XCIsIGNsb2NrUmFkaXVzICsgbWFyZ2luKVxuICAgIC5hdHRyKFwieVwiLCBjbG9ja1JhZGl1cyAqIDIgKyBtYXJnaW4gKiAxLjk3NSlcbiAgICAuYXR0cihcInRleHQtYW5jaG9yXCIsIFwibWlkZGxlXCIpXG4gICAgLmF0dHIoXCJmb250LXNpemVcIiwgMzIpXG4gICAgLmF0dHIoXCJmb250LWZhbWlseVwiLCBcIm1vbm9zcGFjZVwiKTtcbiAgZHJhd0Nsb2NrKCk7XG4gIC8vIEFuaW1hdGlvblxuICBjb25zdCBpbnRlcnZhbCA9IHNldEludGVydmFsKFxuICAgICgpID0+IHtcbiAgICAgIHVwZGF0ZURhdGEoKTtcbiAgICAgIG1vdmVIYW5kcygpO1xuICAgIH0sXG4gICAgIWZhbmN5U2Vjb25kc09GRiA/IDEwIDogODY0XG4gICk7XG4gIGludmFsaWRhdGlvbi50aGVuKCgpID0+IGNsZWFySW50ZXJ2YWwoaW50ZXJ2YWwpKTtcbiAgcmV0dXJuIHN2Zy5ub2RlKCk7XG59XG4ifSx7Im1ldGhvZE5hbWUiOiJpbnRlcnByZXQiLCJjZWxsTmFtZSI6Im9qcy1jZWxsLTIiLCJpbmxpbmUiOmZhbHNlLCJzb3VyY2UiOiJmdW5jdGlvbiB1bml4MmRvdGUodW5peCwgem9uZSwgb2Zmc2V0ID0gNzE5NDY4KSB7XG4gIHJldHVybiBbKHVuaXggPz8gRGF0ZS5ub3coKSkgLyA4NjQwMDAwMCArIChcbiAgICB6b25lID0gem9uZSA/PyAtTWF0aC5yb3VuZChcbiAgICAgIChuZXcgRGF0ZSkuZ2V0VGltZXpvbmVPZmZzZXQoKSAvIDE0NClcbiAgICApIC8gMTAgKyBvZmZzZXQsIHpvbmVdXG59XG5mdW5jdGlvbiB1bml4MmRvdGUxKHVuaXgsIHpvbmUsIG9mZnNldCA9IDcxOTQ2OCkge1xuICByZXR1cm4gW1xuICAgICh1bml4ID8/IERhdGUubm93KCkpIC8gODY0MDAwMDBcbiAgICArICh6b25lID0gem9uZSA/PyAoMTAgLSBNYXRoLnJvdW5kKFxuICAgICAgICAobmV3IERhdGUpLmdldFRpbWV6b25lT2Zmc2V0KCkgLyAxNDQpKSAlIDEwXG4gICAgICApIC8gMTAgKyBvZmZzZXQsIHpvbmVdXG59XG5mdW5jdGlvbiBkb3RlMmRhdGUoZG90ZSwgem9uZSA9IDApIHtcbiAgY29uc3QgY290ZSA9IE1hdGguZmxvb3IoKFxuICAgICAgZG90ZSA+PSAwID8gZG90ZVxuICAgICAgOiBkb3RlIC0gMTQ2MDk2XG4gICAgKSAvIDE0NjA5NyksXG4gIGRvdGMgPSBkb3RlIC0gY290ZSAqIDE0NjA5NyxcbiAgeW90YyA9IE1hdGguZmxvb3IoKGRvdGNcbiAgICAtIE1hdGguZmxvb3IoZG90YyAvIDE0NjApXG4gICAgKyBNYXRoLmZsb29yKGRvdGMgLyAzNjUyNClcbiAgICAtIE1hdGguZmxvb3IoZG90YyAvIDE0NjA5NilcbiAgKSAvIDM2NSk7XG4gIHJldHVybiBbXG4gICAgeW90YyArIGNvdGUgKiA0MDAsXG4gICAgZG90YyAtICh5b3RjICogMzY1XG4gICAgICArIE1hdGguZmxvb3IoeW90YyAvIDQpXG4gICAgICAtIE1hdGguZmxvb3IoeW90YyAvIDEwMClcbiAgKSwgem9uZV19XG5keiA9IHVuaXgyZG90ZShub3cpXG55ZHogPSBkb3RlMmRhdGUoLi4uZHopXG5kZWNZZWFyID0geWR6WzBdLnRvU3RyaW5nKCkucGFkU3RhcnQoNCwgXCIwXCIpXG5kZWNEYXRlID0gTWF0aC5mbG9vcih5ZHpbMV0pLnRvU3RyaW5nKCkucGFkU3RhcnQoMywgXCIwXCIpXG5icm93c2VyRG90ZSA9IHVuaXgyZG90ZShub3cpXG5icm93c2VyVGltZSA9IGJyb3dzZXJEb3RlWzBdICUgMSAqIDEwXG5icm93c2VyWm9uZSA9IGJyb3dzZXJEb3RlWzFdXG5icm93c2VyU2lnbiA9IGJyb3dzZXJab25lID4gMCA/IFwiLVwiIDogXCIrXCJcbnpvbmUwdGltZSA9IChicm93c2VyVGltZSAtIGJyb3dzZXJab25lICsgMTApICUgMTBcbmhvdXJzID0gYnJvd3NlclRpbWUgKiAyLjRcbm1pbnV0ZXMgPSBob3VycyAlIDEgKiA2MFxuc2Vjb25kcyA9IG1pbnV0ZXMgJSAxICogNjBcbnNlbGVjdGVkRG90ZSA9IHVuaXgyZG90ZShub3csIGxvbmcyem9uZShsb2NhdGlvblswXSkpXG5zZWxlY3RlZEV4YWN0ID0gc2VsZWN0ZWREb3RlWzBdICUgMVxuc2VsZWN0ZWRFeGFjdE4gPSAoMSAtIHNlbGVjdGVkRXhhY3QpICUgMVxuc2VsZWN0ZWRab25lID0gc2VsZWN0ZWREb3RlWzFdXG5kZWNUaW1lID0gKHNlbGVjdGVkRXhhY3QgKiAxMCkudG9GaXhlZCg0KVxuZGVjVGltZU4gPSAoc2VsZWN0ZWRFeGFjdE4gKiAxMCkudG9GaXhlZCg0KVxuYmFyREQgPSBkZWNUaW1lWzBdXG5iYXJERE4gPSBkZWNUaW1lTlswXVxuYmFyTWlscyA9IGRlY1RpbWUuc2xpY2UoMiwgNClcbmJhck1pbHNOID0gZGVjVGltZU4uc2xpY2UoMiwgNClcbmJhckJlYXRzID0gZGVjVGltZS5zbGljZSg0LCA2KVxuYmFyQmVhdHNOID0gZGVjVGltZU4uc2xpY2UoNCwgNilcbmZ1bmN0aW9uIGxhdGkydHVybjEoZGVncmVlcyA9IC0xODAsIGUgPSAzKSB7XG4gIC8vIHR1cm5zOiBlPTAsIGRlY2l0dXJuczogZT0xLCBldGMuXG4gIHJldHVybiAoZGVncmVlcyAlPSAzNjApIC8gKDM2MCAvIDEwKiplKSAlIDEwKiplO1xufVxuZ3JhdGljdWxlID0gZDMuZ2VvR3JhdGljdWxlKCkuc3RlcE1pbm9yKFszNiwzNl0pLnN0ZXBNYWpvcihbMzYsMzZdKSgpXG5ncmF0aWN1bGUuY29vcmRpbmF0ZXMgPSBncmF0aWN1bGUuY29vcmRpbmF0ZXMubWFwKFxuICBpID0+IGkubWFwKGogPT4gai5tYXAoKGssIGluZGV4LCBhcnIpID0+IGkubGVuZ3RoID09PSAzICYmIGluZGV4ID09PSAwID8gayAtIDE4IDogaykpXG4pXG5mdW5jdGlvbiBsb25nMnR1cm4oZGVncmVlcyA9IC0xODAsIGUgPSAzKSB7XG4gIC8vIHR1cm5zOiBlPTAsIGRlY2l0dXJuczogZT0xLCBldGMuXG4gIHJldHVybiAoKChkZWdyZWVzICU9IDM2MCkgPCAwID8gZGVncmVlcyArIDM2MCA6IGRlZ3JlZXMpICsgMTgpIC8gKDM2MCAvIDEwKiplKSAlIDEwKiplO1xufVxuLy8gaHR0cHM6Ly9naXRodWIuY29tL3RvcG9qc29uL3dvcmxkLWF0bGFzXG53b3JsZCA9IGQzLmpzb24oXCJodHRwczovL2Nkbi5qc2RlbGl2ci5uZXQvbnBtL3dvcmxkLWF0bGFzQDIvY291bnRyaWVzLTExMG0uanNvblwiKVxuY291bnRyaWVzID0gdG9wb2pzb24uZmVhdHVyZSh3b3JsZCwgd29ybGQub2JqZWN0cy5jb3VudHJpZXMpXG50b3BvanNvbiA9IHJlcXVpcmUoXCJ0b3BvanNvbi1jbGllbnRAM1wiKVxuZnVuY3Rpb24gbG9uZzJ6b25lKGRlZ3JlZXMgPSAtMTgwKSB7XG4gIHJldHVybiBNYXRoLmZsb29yKGxvbmcydHVybihkZWdyZWVzLCAxKSk7XG59XG5mdW5jdGlvbiB5ZWFyMmxlYXAoeWVhciA9IDE5NzApIHtcbiAgICByZXR1cm4geWVhciAlIDQgPT0gMCAmJiB5ZWFyICUgMTAwICE9IDAgfHwgeWVhciAlIDQwMCA9PSAwO1xufVxuLy8gaHR0cHM6Ly9vYnNlcnZhYmxlaHEuY29tL0BkYnJpZGdlcy92aXN1YWxpemluZy1zZWFzb25hbC1kYXlsaWdodFxuc29sYXJTeXN0ZW0gPSAocm9vdCwgd2lkdGgsIGxvY2F0aW9uLCBkYXRlLCBob3VyKSA9PiB7XG4gIGNvbnN0IGVhcnRoUmFkaXVzID0gMC4wNCAqIHdpZHRoO1xuICBjb25zdCBzdW5SYWRpdXMgPSAwLjA4ICogd2lkdGg7XG4gIGNvbnN0IHNvbGFyU3lzdGVtUmFkaXVzID0gd2lkdGggLyAyIC0gMjA7XG4gIGNvbnN0IHN0cmV0Y2ggPSAwLjM7XG4gIGNvbnN0IHNvbGFyQW5nbGUgPSBnZXRTb2xhckFuZ2xlKGRhdGUpO1xuICBjb25zdCBzb2xhckFuZ2xlRGVnID0gKHNvbGFyQW5nbGUgKiAxODApIC8gTWF0aC5QSTtcbiAgY29uc3QgeCA9IHNvbGFyU3lzdGVtUmFkaXVzICogTWF0aC5zaW4oc29sYXJBbmdsZSk7XG4gIGNvbnN0IHkgPSBzdHJldGNoICogc29sYXJTeXN0ZW1SYWRpdXMgKiBNYXRoLmNvcyhzb2xhckFuZ2xlKTtcbiAgY29uc3Qgc3BpbiA9IDE4MCArIC1sb2NhdGlvblswXSArIHNvbGFyQW5nbGVEZWcgKyAzNjAgKiAoKGhvdXIgKyAxMikgLyAyNCk7XG4gIGNvbnN0IGVhcnRoR2VvID0geyB0eXBlOiBcIlNwaGVyZVwiIH07XG4gIGNvbnN0IHByb2plY3Rpb24gPSBkM1xuICAgIC5nZW9PcnRob2dyYXBoaWMoKVxuICAgIC5maXRXaWR0aChlYXJ0aFJhZGl1cyAqIDIsIGVhcnRoR2VvKVxuICAgIC5yb3RhdGUoW3NwaW4sIDAsIDIzLjVdKVxuICAgIC50cmFuc2xhdGUoWzAsIDBdKTtcbiAgY29uc3Qgc3RhdGljUHJvamVjdGlvbiA9IGQzXG4gICAgLmdlb09ydGhvZ3JhcGhpYygpXG4gICAgLmZpdFdpZHRoKGVhcnRoUmFkaXVzICogMiwgZWFydGhHZW8pXG4gICAgLnJvdGF0ZShbc29sYXJBbmdsZURlZyAtIDkwLCAwXSlcbiAgICAudHJhbnNsYXRlKFswLCAwXSk7XG4gIGNvbnN0IHBhdGggPSBkMy5nZW9QYXRoKHByb2plY3Rpb24pLnBvaW50UmFkaXVzKDEuNSk7XG4gIGNvbnN0IHN0YXRpY1BhdGggPSBkMy5nZW9QYXRoKHN0YXRpY1Byb2plY3Rpb24pO1xuICBjb25zdCBzb2xhclN5c3RlbSA9IHJvb3RcbiAgICAuYXBwZW5kKFwiZ1wiKVxuICAgIC5hdHRyKFwidHJhbnNmb3JtXCIsIGB0cmFuc2xhdGUoJHt3aWR0aCAvIDJ9KWApO1xuICBzb2xhclN5c3RlbS5hcHBlbmQoXCJjaXJjbGVcIikuYXR0cihcInJcIiwgc3VuUmFkaXVzKS5hdHRyKFwiZmlsbFwiLCBjb2xvcnMuc3VuKTtcbiAgLyogRHJhdyBvcmJpdCAqL1xuICBzb2xhclN5c3RlbVxuICAgIC5hcHBlbmQoXCJlbGxpcHNlXCIpXG4gICAgLmF0dHIoXCJyeFwiLCBzb2xhclN5c3RlbVJhZGl1cylcbiAgICAuYXR0cihcInJ5XCIsIHN0cmV0Y2ggKiBzb2xhclN5c3RlbVJhZGl1cylcbiAgICAuYXR0cihcImZpbGxcIiwgXCJub25lXCIpXG4gICAgLmF0dHIoXCJzdHJva2VcIiwgXCJibGFja1wiKTtcbiAgLyogRHJhdyBtb250aCB0aWNrcyAqL1xuICBkMy5yYW5nZSgxMikubWFwKChtKSA9PiB7XG4gICAgY29uc3QgZCA9IG5ldyBEYXRlKGRhdGUuZ2V0RnVsbFllYXIoKSwgbSwgMSk7XG4gICAgY29uc3QgYW5nbGUgPSBnZXRTb2xhckFuZ2xlKGQpO1xuICAgIHNvbGFyU3lzdGVtXG4gICAgICAuYXBwZW5kKFwibGluZVwiKVxuICAgICAgLmF0dHIoXCJ4MVwiLCAoc29sYXJTeXN0ZW1SYWRpdXMgKyA2KSAqIE1hdGguc2luKGFuZ2xlKSlcbiAgICAgIC5hdHRyKFwieTFcIiwgKHNvbGFyU3lzdGVtUmFkaXVzICsgNikgKiBzdHJldGNoICogTWF0aC5jb3MoYW5nbGUpKVxuICAgICAgLmF0dHIoXCJ4MlwiLCAoc29sYXJTeXN0ZW1SYWRpdXMgLSA2KSAqIE1hdGguc2luKGFuZ2xlKSlcbiAgICAgIC5hdHRyKFwieTJcIiwgKHNvbGFyU3lzdGVtUmFkaXVzIC0gNikgKiBzdHJldGNoICogTWF0aC5jb3MoYW5nbGUpKVxuICAgICAgLmF0dHIoXCJzdHJva2VcIiwgXCJibGFja1wiKTtcbiAgICBjb25zdCBzdGFydE1vbnRoQW5nbGUgPSBnZXRTb2xhckFuZ2xlKG5ldyBEYXRlKGRhdGUuZ2V0RnVsbFllYXIoKSwgbSwgMSkpO1xuICAgIHNvbGFyU3lzdGVtXG4gICAgICAuYXBwZW5kKFwidGV4dFwiKVxuICAgICAgLnRleHQoZGF0ZTJkb3R5KGQpKVxuICAgICAgLmF0dHIoXCJ4XCIsIChzb2xhclN5c3RlbVJhZGl1cyArIDE4KSAqIE1hdGguc2luKHN0YXJ0TW9udGhBbmdsZSkpXG4gICAgICAuYXR0cihcbiAgICAgICAgXCJ5XCIsXG4gICAgICAgIChzb2xhclN5c3RlbVJhZGl1cyArIDE4KSAqIDEuMTggKiBzdHJldGNoICogTWF0aC5jb3Moc3RhcnRNb250aEFuZ2xlKVxuICAgICAgKVxuICAgICAgLmF0dHIoXCJ0ZXh0LWFuY2hvclwiLCBcIm1pZGRsZVwiKVxuICAgICAgLmF0dHIoXCJmb250LXNpemVcIiwgZm9udFNpemUgKiAod2lkdGggPCAxNjUgPyAuOSA6IHdpZHRoIDwgMjY1ID8gMSA6IHdpZHRoIDwgMzY1ID8gMS4xIDogMS4yKSlcbiAgICAgIC5hdHRyKFwiZG9taW5hbnQtYmFzZWxpbmVcIiwgXCJtaWRkbGVcIilcbiAgICAgIC5hdHRyKFwiZm9udC1zaXplXCIsIGZvbnRTaXplICogKHdpZHRoIDwgMTY1ID8gLjkgOiB3aWR0aCA8IDI2NSA/IDEgOiB3aWR0aCA8IDM2NSA/IDEuMSA6IDEuMikpXG4gICAgICAuYXR0cihcImZvbnQtZmFtaWx5XCIsIFwic2Fucy1zZXJpZlwiKVxuICAgICAgLmF0dHIoXCJmaWxsXCIsIFwiYmxhY2tcIik7XG4gIH0pO1xuICBjb25zdCBlYXJ0aCA9IHNvbGFyU3lzdGVtXG4gICAgLmFwcGVuZChcImdcIilcbiAgICAuYXR0cihcInRyYW5zZm9ybVwiLCBgdHJhbnNsYXRlKCR7eH0sICR7eX0pYCk7XG4gIGVhcnRoXG4gICAgLmFwcGVuZChcImxpbmVcIilcbiAgICAuYXR0cihcInkxXCIsIC0xLjUgKiBlYXJ0aFJhZGl1cylcbiAgICAuYXR0cihcInkyXCIsIDEuNSAqIGVhcnRoUmFkaXVzKVxuICAgIC5hdHRyKFwic3Ryb2tlXCIsIFwiYmx1ZVwiKVxuICAgIC5hdHRyKFwidHJhbnNmb3JtXCIsIGByb3RhdGUoLTIzLjUpYCk7XG4gIGVhcnRoLmFwcGVuZChcInBhdGhcIikuYXR0cihcImRcIiwgcGF0aChlYXJ0aEdlbykpLmF0dHIoXCJmaWxsXCIsIGNvbG9ycy5vY2Vhbik7XG4gIGVhcnRoLmFwcGVuZChcInBhdGhcIikuYXR0cihcImRcIiwgcGF0aChsYW5kKSkuYXR0cihcImZpbGxcIiwgY29sb3JzLmxhbmQpO1xuICBlYXJ0aC5hcHBlbmQoXCJwYXRoXCIpXG4gIC5hdHRyKFwiZFwiLCBwYXRoKGNvdW50cmllcykpXG4gIC5hdHRyKFwic3Ryb2tlLXdpZHRoXCIsIFwiLjA3NVwiKVxuICAuYXR0cihcImZpbGxcIiwgXCJub25lXCIpXG4gIC5hdHRyKFwic3Ryb2tlXCIsIFwiIzU1NVwiKTtcbiAgY29uc3Qgc2hhZG93UG9seWdvbiA9IFtcbiAgICBbMCwgLTkwXSxcbiAgICBbMCwgMF0sXG4gICAgWzAsIDkwXSxcbiAgICBbMTgwLCAwXSxcbiAgICBbMCwgLTkwXVxuICBdO1xuICBlYXJ0aFxuICAgIC5hcHBlbmQoXCJwYXRoXCIpXG4gICAgLmF0dHIoXCJkXCIsIHN0YXRpY1BhdGgoeyB0eXBlOiBcIlBvbHlnb25cIiwgY29vcmRpbmF0ZXM6IFtzaGFkb3dQb2x5Z29uXSB9KSlcbiAgICAuYXR0cihcImZpbGxcIiwgXCJyZ2JhKDAsIDAsIDAsIDAuNSlcIik7XG4gIGVhcnRoXG4gICAgLmFwcGVuZChcInBhdGhcIilcbiAgICAuYXR0cihcImRcIiwgcGF0aCh7IHR5cGU6IFwiUG9pbnRcIiwgY29vcmRpbmF0ZXM6IGxvY2F0aW9uIH0pKVxuICAgIC5hdHRyKFwiclwiLCAxOClcbiAgICAuYXR0cihcInN0cm9rZS13aWR0aFwiLCAuMylcbiAgICAuYXR0cihcInN0cm9rZVwiLCBcImJsYWNrXCIpXG4gICAgLmF0dHIoXCJmaWxsXCIsIFwicmVkXCIpO1xufVxuZnVuY3Rpb24gZ3JlZzJkb3R5KG1vbnRoID0gMSwgZGF5ID0gMSkge1xuICAgIHJldHVybiBNYXRoLmZsb29yKFxuICAgICAgICAoMTUzICogKG1vbnRoID4gMiA/IG1vbnRoIC0gMyA6IG1vbnRoICsgOSkgKyAyKSAvIDUgKyBkYXkgLSAxXG4pfVxuZnVuY3Rpb24gZGF0ZTJkb3R5KGRhdGUpIHtcbiAgcmV0dXJuIGdyZWcyZG90eShkYXRlLmdldE1vbnRoKCkgKyAxLCBkYXRlLmdldERhdGUoKSlcbn1cbmZ1bmN0aW9uIGRhdGUyZG90eTEoZGF0ZSkge1xuICBjb25zdCBkb3R5ID0gZ3JlZzJkb3R5KGRhdGUuZ2V0TW9udGgoKSArIDEsIGRhdGUuZ2V0RGF0ZSgpKVxuICByZXR1cm4gZG90eSA9PT0gMzEgPyBcIkRheSBcIiArIFN0cmluZyhkb3R5KSA6IGRvdHlcbn1cbi8vIGh0dHBzOi8vb2JzZXJ2YWJsZWhxLmNvbS9AZGJyaWRnZXMvdmlzdWFsaXppbmctc2Vhc29uYWwtZGF5bGlnaHRcbmdsb2JlID0gKHJvb3QsIHsgd2lkdGgsIGxvY2F0aW9uLCBkYXRlLCBob3VyIH0pID0+IHtcbiAgY29uc3Qgc29sYXJBbmdsZSA9IGdldFNvbGFyQW5nbGUoZGF0ZSk7XG4gIGNvbnN0IHNvbGFyQW5nbGVEZWcgPSB0b0RlZ3JlZXMoc29sYXJBbmdsZSk7XG4gIGNvbnN0IGhvdXJTcGluID0gMzYwICogKChob3VyICsgMTIpIC8gMjQpO1xuICBjb25zdCBzcGluID0gKDE4MCArIC1sb2NhdGlvblswXSArIHNvbGFyQW5nbGVEZWcgKyBob3VyU3Bpbik7XG4gIGNvbnN0IHRpbHQgPSAtMTU7XG4gIGNvbnN0IHByb2plY3Rpb24gPSBkMy5nZW9PcnRob2dyYXBoaWMoKVxuICAgICAgICAgICAgICAgICAgICAgICAuZml0V2lkdGgod2lkdGgsIGdyYXRpY3VsZSlcbiAgICAgICAgICAgICAgICAgICAgICAgLnJvdGF0ZShbc3BpbiwgdGlsdCwgMjMuNV0pO1xuICBjb25zdCBwYXRoID0gZDMuZ2VvUGF0aChwcm9qZWN0aW9uKTtcbiAgY29uc3QgdW5DbGlwcGVkUHJvamVjdGlvbiA9IGQzLmdlb09ydGhvZ3JhcGhpYygpXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIC5jbGlwQW5nbGUobnVsbClcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgLmZpdFdpZHRoKHdpZHRoLCBncmF0aWN1bGUpXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIC5yb3RhdGUoW3NwaW4sIHRpbHQsIDIzLjVdKTtcbiAgY29uc3QgdW5DbGlwcGVkUGF0aCA9IGQzLmdlb1BhdGgodW5DbGlwcGVkUHJvamVjdGlvbik7XG4gIGNvbnN0IHN0YXRpY1Byb2plY3Rpb24gPSBkMy5nZW9PcnRob2dyYXBoaWMoKVxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAuZml0V2lkdGgod2lkdGgsIGdyYXRpY3VsZSlcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgLnJvdGF0ZShbc29sYXJBbmdsZURlZyAtIDkwLCB0aWx0XSk7XG4gIGNvbnN0IHN0YXRpY1BhdGggPSBkMy5nZW9QYXRoKHN0YXRpY1Byb2plY3Rpb24pO1xuICBjb25zdCBiYWNrZ3JvdW5kID0gcm9vdC5hcHBlbmQoXCJnXCIpO1xuICBjb25zdCBlYXJ0aCA9IHJvb3QuYXBwZW5kKFwiZ1wiKS5zdHlsZShcIm9wYWNpdHlcIiwgMC43NSk7XG4gIGNvbnN0IGZvcmVncm91bmQgPSByb290LmFwcGVuZChcImdcIik7XG4gIGVhcnRoLmFwcGVuZChcInBhdGhcIilcbiAgICAuYXR0cihcImRcIiwgcGF0aCh7dHlwZTogXCJTcGhlcmVcIn0pKVxuICAgIC5hdHRyKFwiZmlsbFwiLCBjb2xvcnMub2NlYW4pXG4gICAgLmF0dHIoXCJzdHJva2VcIiwgXCIjOWVjYmRhXCIpO1xuICBlYXJ0aC5hcHBlbmQoXCJwYXRoXCIpXG4gICAgLmF0dHIoXCJkXCIsIHBhdGgoZ3JhdGljdWxlKSlcbiAgICAuYXR0cihcInN0cm9rZS13aWR0aFwiLCBcIjFcIilcbiAgICAuYXR0cihcImZpbGxcIiwgXCJub25lXCIpXG4gICAgLmF0dHIoXCJzdHJva2VcIiwgXCIjODg4XCIpO1xuICBlYXJ0aC5hcHBlbmQoXCJwYXRoXCIpXG4gICAgLmF0dHIoXCJkXCIsIHBhdGgobGFuZCkpXG4gICAgLmF0dHIoXCJmaWxsXCIsIGNvbG9ycy5sYW5kKTtcbiAgZWFydGguYXBwZW5kKFwicGF0aFwiKVxuICAgIC5hdHRyKFwiZFwiLCBwYXRoKGNvdW50cmllcykpXG4gICAgLmF0dHIoXCJzdHJva2Utd2lkdGhcIiwgXCIxXCIpXG4gICAgLmF0dHIoXCJmaWxsXCIsIFwibm9uZVwiKVxuICAgIC5hdHRyKFwic3Ryb2tlXCIsIFwiIzAwMFwiKTtcbiAgYmFja2dyb3VuZC5hcHBlbmQoXCJwYXRoXCIpXG4gICAgLmF0dHIoXCJkXCIsIHVuQ2xpcHBlZFBhdGgoe3R5cGU6IFwiUG9pbnRcIiwgY29vcmRpbmF0ZXM6IGxvY2F0aW9ufSkpXG4gICAgLmF0dHIoXCJmaWxsXCIsIFwicmVkXCIpO1xuICBjb25zdCBsYXRpdHVkZUNvb3JkcyA9IChsYXRpdHVkZSwgc3RhcnQsIGVuZCkgPT4ge1xuICAgIGNvbnN0IGxvbmdpdHVkZXMgPSBkMy5yYW5nZShzdGFydCwgZW5kLCAyKS5jb25jYXQoZW5kKTtcbiAgICByZXR1cm4gbG9uZ2l0dWRlcy5tYXAoZCA9PiBbZCwgbGF0aXR1ZGVdKTtcbiAgfVxuICBjb25zdCBjb3JyZWN0U3BpbiA9IGQzLmdlb1JvdGF0aW9uKFstaG91clNwaW4sIDBdKTtcbiAgY29uc3QgY29ycmVjdFRpbHQgPSBkMy5nZW9Sb3RhdGlvbihbNiwgMCwgMF0pO1xuICAvKiB0b3RhbCBhbmd1bGFyIGV4dGVudCBvZiBkYXkvbmlnaHQgKi9cbiAgY29uc3QgZGF5RXh0ZW50ID0gMzYwICogZGF5TGVuZ3RoKGRhdGUsIGxvY2F0aW9uWzFdKSAvIDI0O1xuICBjb25zdCBuaWdodEV4dGVudCA9IDM2MCAtIGRheUV4dGVudDtcbiAgY29uc3QgZGF5TGluZSA9IHtcbiAgICB0eXBlOiBcIkxpbmVTdHJpbmdcIixcbiAgICBjb29yZGluYXRlczogbGF0aXR1ZGVDb29yZHMobG9jYXRpb25bMV0sXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGxvY2F0aW9uWzBdIC0gZGF5RXh0ZW50IC8gMixcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgbG9jYXRpb25bMF0gKyBkYXlFeHRlbnQgLyAyKS5tYXAoZCA9PiBjb3JyZWN0U3BpbihkKSlcbiAgfTtcbiAgY29uc3QgbmlnaHRMaW5lID0ge1xuICAgIHR5cGU6IFwiTGluZVN0cmluZ1wiLFxuICAgIGNvb3JkaW5hdGVzOiBsYXRpdHVkZUNvb3Jkcyhsb2NhdGlvblsxXSxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgbG9jYXRpb25bMF0gLSBkYXlFeHRlbnQgLyAyIC0gbmlnaHRFeHRlbnQsXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGxvY2F0aW9uWzBdIC0gZGF5RXh0ZW50IC8gMikubWFwKGQgPT4gY29ycmVjdFNwaW4oZCkpXG4gIH07XG4gIGJhY2tncm91bmQuYXBwZW5kKFwicGF0aFwiKVxuICAgIC5hdHRyKFwiZFwiLCB1bkNsaXBwZWRQYXRoKGRheUxpbmUpKVxuICAgIC5hdHRyKFwiZmlsbFwiLCBcIm5vbmVcIilcbiAgICAuYXR0cihcInN0cm9rZVwiLCBjb2xvcnMuZGF5KVxuICAgIC5hdHRyKFwic3Ryb2tlLXdpZHRoXCIsIDMpO1xuICBiYWNrZ3JvdW5kLmFwcGVuZChcInBhdGhcIilcbiAgICAuYXR0cihcImRcIiwgdW5DbGlwcGVkUGF0aChuaWdodExpbmUpKVxuICAgIC5hdHRyKFwiZmlsbFwiLCBcIm5vbmVcIilcbiAgICAuYXR0cihcInN0cm9rZVwiLCBjb2xvcnMubmlnaHQpXG4gICAgLmF0dHIoXCJzdHJva2Utd2lkdGhcIiwgMyk7XG4gIGZvcmVncm91bmQuYXBwZW5kKFwicGF0aFwiKVxuICAgIC5hdHRyKFwiZFwiLCBwYXRoKGRheUxpbmUpKVxuICAgIC5hdHRyKFwiZmlsbFwiLCBcIm5vbmVcIilcbiAgICAuYXR0cihcInN0cm9rZVwiLCBjb2xvcnMuZGF5KVxuICAgIC5hdHRyKFwic3Ryb2tlLXdpZHRoXCIsIDMpO1xuICBmb3JlZ3JvdW5kLmFwcGVuZChcInBhdGhcIilcbiAgICAuYXR0cihcImRcIiwgcGF0aChuaWdodExpbmUpKVxuICAgIC5hdHRyKFwiZmlsbFwiLCBcIm5vbmVcIilcbiAgICAuYXR0cihcInN0cm9rZVwiLCBjb2xvcnMubmlnaHQpXG4gICAgLmF0dHIoXCJzdHJva2Utd2lkdGhcIiwgMyk7XG4gIGZvcmVncm91bmQuYXBwZW5kKFwicGF0aFwiKVxuICAgIC5hdHRyKFwiZFwiLCBwYXRoKHt0eXBlOiBcIlBvaW50XCIsIGNvb3JkaW5hdGVzOiBsb2NhdGlvbn0pKVxuICAgIC5hdHRyKFwic3Ryb2tlLXdpZHRoXCIsIC41KVxuICAgIC5hdHRyKFwic3Ryb2tlXCIsIFwiYmxhY2tcIilcbiAgICAuYXR0cihcImZpbGxcIiwgXCJyZWRcIik7XG4gIGNvbnN0IHNoYWRvd1BvbHlnb24gPSBbWzAsIC05MF0sIFswLCAwXSwgWzAsIDkwXSwgWzE4MCwgMF0sIFswLCAtOTBdXS5tYXAoZCA9PiBjb3JyZWN0VGlsdChkKSk7XG4gIGZvcmVncm91bmQuYXBwZW5kKFwicGF0aFwiKVxuICAgIC5hdHRyKFwiZFwiLCBzdGF0aWNQYXRoKHt0eXBlOiBcIlBvbHlnb25cIiwgY29vcmRpbmF0ZXM6IFtzaGFkb3dQb2x5Z29uXX0pKVxuICAgIC5hdHRyKFwiZmlsbFwiLCBcInJnYmEoMCwgMCwgMCwgMC4yNSlcIik7XG59XG5kYXlPZlllYXIgPSAoZGF0ZSkgPT4ge1xuICBjb25zdCB5ZWFyU3RhcnQgPSBuZXcgRGF0ZShkYXRlLmdldEZ1bGxZZWFyKCksIDAsIDErNjApO1xuICByZXR1cm4gTWF0aC5mbG9vcigoZGF0ZS5nZXRUaW1lKCkgLSB5ZWFyU3RhcnQuZ2V0VGltZSgpKS84NjQwMDAwMCkgKyAxXG59XG4vLyBodHRwczovL29ic2VydmFibGVocS5jb20vQGRicmlkZ2VzL3Zpc3VhbGl6aW5nLXNlYXNvbmFsLWRheWxpZ2h0XG5kYXlsaWdodFBsb3QgPSAoXG4gIHJvb3QsXG4gIHsgd2lkdGgsIGhlaWdodCwgeWVhciwgbGF0aXR1ZGUsIGRlZmF1bHREYXRlLCBkZWZhdWx0SG91ciB9XG4pID0+IHtcbiAgY29uc3QgbWFyZ2luID0geyB0b3A6IDI0LCBib3R0b206IDMyLCBsZWZ0OiA0OCwgcmlnaHQ6IDAgfTtcbiAgY29uc3QgY2hhcnRXaWR0aCA9IHdpZHRoIC0gbWFyZ2luLmxlZnQgLSBtYXJnaW4ucmlnaHQ7XG4gIGNvbnN0IGNoYXJ0SGVpZ2h0ID0gaGVpZ2h0IC0gbWFyZ2luLnRvcCAtIG1hcmdpbi5ib3R0b207XG4gIGNvbnN0IHhUaWNrVmFsdWVzID1cbiAgICB3aWR0aCA+IDI4MCA/IFszLCA2LCA5LCAxMiwgMTUsIDE4LCAyMV0gOiB3aWR0aCA+IDE0MCA/IFs2LCAxMiwgMThdIDogWzEyXTtcbiAgY29uc3QgeFNjYWxlID0gZDNcbiAgICAuc2NhbGVMaW5lYXIoKVxuICAgIC5kb21haW4oWzAsIDI0XSlcbiAgICAucmFuZ2UoW21hcmdpbi5sZWZ0LCBtYXJnaW4ubGVmdCArIGNoYXJ0V2lkdGhdKVxuICAgIC5jbGFtcCh0cnVlKTtcbiAgLy8geS1heGlzIHNjYWxlXG4gIGNvbnN0IHlTY2FsZSA9IGQzXG4gICAgLnNjYWxlVGltZSgpXG4gICAgLmRvbWFpbihbbmV3IERhdGUoeWVhciwgMCwgMSs2MCksIG5ldyBEYXRlKHllYXIsIDExLCAzMSs2MCldKVxuICAgIC5yYW5nZShbbWFyZ2luLnRvcCwgbWFyZ2luLnRvcCArIGNoYXJ0SGVpZ2h0XSlcbiAgICAuY2xhbXAodHJ1ZSk7XG4gIC8vIHktYXhpcyBsYWJlbHNcbiAgY29uc3QgeUF4aXMgPSBkM1xuICAgIC5heGlzTGVmdCh5U2NhbGUpXG4gICAgLnRpY2tWYWx1ZXMoZDMudGltZU1vbnRoLnJhbmdlKG5ldyBEYXRlKHllYXIsIDAsIDErNjApLCBuZXcgRGF0ZSh5ZWFyLCAxMiwgMSs1NykpKVxuICAgIC50aWNrU2l6ZShjaGFydFdpZHRoKVxuICAgIC50aWNrRm9ybWF0KGRhdGUyZG90eTEpO1xuICBjb25zdCB4QXhpcyA9IGQzXG4gICAgLmF4aXNCb3R0b20oeFNjYWxlKVxuICAgIC50aWNrVmFsdWVzKHhUaWNrVmFsdWVzKVxuICAgIC50aWNrU2l6ZShjaGFydEhlaWdodClcbiAgICAudGlja0Zvcm1hdCgoZCkgPT4ge1xuICAgICAgcmV0dXJuIGAke2QgLyAuMDI0fWA7XG4gICAgfSk7XG4gIGxldCBkYXRlID0gZGVmYXVsdERhdGUgfHwgbmV3IERhdGUoKTtcbiAgbGV0IGhvdXIgPSBkZWZhdWx0SG91ciAhPSBudWxsID8gZGVmYXVsdEhvdXIgOiBkYXRlLmdldEhvdXJzKCk7XG4gIGNvbnN0IGhhbmRsZU1vdXNlTW92ZSA9IChlKSA9PiB7fTtcbiAgcm9vdFxuICAgIC5hcHBlbmQoXCJyZWN0XCIpXG4gICAgLmF0dHIoXCJ4XCIsIG1hcmdpbi5sZWZ0KVxuICAgIC5hdHRyKFwieVwiLCBtYXJnaW4udG9wKVxuICAgIC5hdHRyKFwid2lkdGhcIiwgY2hhcnRXaWR0aClcbiAgICAuYXR0cihcImhlaWdodFwiLCBjaGFydEhlaWdodClcbiAgICAuYXR0cihcInJ4XCIsIDAuMDUgKiB3aWR0aClcbiAgICAuYXR0cihcImZpbGxcIiwgY29sb3JzLm5pZ2h0KTtcbiAgcm9vdFxuICAgIC5hcHBlbmQoXCJnXCIpXG4gICAgLmF0dHIoXCJ0cmFuc2Zvcm1cIiwgYHRyYW5zbGF0ZSgke21hcmdpbi5sZWZ0ICsgY2hhcnRXaWR0aH0sIDApYClcbiAgICAuY2FsbCh5QXhpcylcbiAgICAuY2FsbCgoZykgPT4gZy5zZWxlY3QoXCIuZG9tYWluXCIpLnJlbW92ZSgpKVxuICAgIC5jYWxsKChnKSA9PiBnLnNlbGVjdEFsbChcIi50aWNrXCIpLmF0dHIoXCJjb2xvclwiLCBjb2xvcnMuZ3JpZCkpXG4gICAgLmNhbGwoKGcpID0+IGcuc2VsZWN0QWxsKFwiLnRpY2sgdGV4dFwiKS5hdHRyKFwiZm9udC1zaXplXCIsIGZvbnRTaXplICogKHdpZHRoIDwgMTY1ID8gLjcgOiB3aWR0aCA8IDI2NSA/IC45IDogd2lkdGggPCAzNjUgPyAxLjMgOiAxLjQpKSlcbiAgICAuY2FsbCgoZykgPT4gZy5zZWxlY3RBbGwoXCIudGljayB0ZXh0XCIpLmF0dHIoXCJjb2xvclwiLCBcImJsYWNrXCIpKVxuICAgIC5jYWxsKChnKSA9PiBnLnNlbGVjdEFsbChcIi50aWNrIGxpbmVcIikuYXR0cihcInN0cm9rZS1kYXNoYXJyYXlcIiwgXCI1IDNcIikpO1xuICByb290XG4gICAgLmFwcGVuZChcImdcIilcbiAgICAuYXR0cihcInRyYW5zZm9ybVwiLCBgdHJhbnNsYXRlKDAsICR7bWFyZ2luLnRvcH0pYClcbiAgICAuY2FsbCh4QXhpcylcbiAgICAuY2FsbCgoZykgPT4gZy5zZWxlY3QoXCIuZG9tYWluXCIpLnJlbW92ZSgpKVxuICAgIC5jYWxsKChnKSA9PiBnLnNlbGVjdEFsbChcIi50aWNrXCIpLmF0dHIoXCJjb2xvclwiLCBjb2xvcnMuZ3JpZCkpXG4gICAgLmNhbGwoKGcpID0+IGcuc2VsZWN0QWxsKFwiLnRpY2sgdGV4dFwiKS5hdHRyKFwiZm9udC1zaXplXCIsIGZvbnRTaXplICogKHdpZHRoIDwgMTY1ID8gLjkgOiB3aWR0aCA8IDI2NSA/IDEuMSA6IHdpZHRoIDwgMzY1ID8gMS4yIDogMS4zKSkpXG4gICAgLmNhbGwoKGcpID0+IGcuc2VsZWN0QWxsKFwiLnRpY2sgdGV4dFwiKS5hdHRyKFwiY29sb3JcIiwgXCJibGFja1wiKSlcbiAgICAuY2FsbCgoZykgPT4gZy5zZWxlY3RBbGwoXCIudGljayBsaW5lXCIpLmF0dHIoXCJzdHJva2UtZGFzaGFycmF5XCIsIFwiNSAzXCIpKTtcbiAgcm9vdFxuICAgIC5hcHBlbmQoXCJ0ZXh0XCIpXG4gICAgLnRleHQoXCJUaW1lIG9mIGRheSAobWlsbGlkYXlzKVwiKVxuICAgIC5hdHRyKFwieFwiLCBtYXJnaW4ubGVmdCArIGNoYXJ0V2lkdGggLyAyKVxuICAgIC5hdHRyKFwieVwiLCBtYXJnaW4udG9wICsgY2hhcnRIZWlnaHQgKyBtYXJnaW4uYm90dG9tIC0gKHdpZHRoIDwgMTY1ID8gOSA6IHdpZHRoIDwgMjY1ID8gNiA6IHdpZHRoIDwgMzY1ID8gMiA6IDApKVxuICAgIC5hdHRyKFwidGV4dC1hbmNob3JcIiwgXCJtaWRkbGVcIilcbiAgICAuYXR0cihcImZvbnQtc2l6ZVwiLCBmb250U2l6ZSAqICh3aWR0aCA8IDE2NSA/IC44NSA6IHdpZHRoIDwgMjY1ID8gMS4xNSA6IHdpZHRoIDwgMzY1ID8gMS41IDogMS42KSlcbiAgICAuYXR0cihcImZvbnQtZmFtaWx5XCIsIFwic2Fucy1zZXJpZlwiKVxuICAgIC5hdHRyKFwiZmlsbFwiLCBcImJsYWNrXCIpO1xuICBjb25zdCBkYXRhID0geWVhckRhdGVzKHllYXIpXG4gICAgLm1hcCgoZCkgPT4gW2QsIGRheUxlbmd0aChkLCBsYXRpdHVkZSldKVxuICAgIC5maWx0ZXIoKFtfLCBkXSkgPT4gZCA+IDApO1xuICAvKiBSZW5kZXIgc2VwYXJhdGUgcG9seWdvbnMgZm9yIGVhY2ggY29udGludW91cyBzZXF1ZW5jZSBvZlxuICAgKiBkYXlzIHdpdGggbW9yZSB0aGFuIDAgaG91cnMgb2YgZGF5IGxpZ2h0XG4gICAqL1xuICBjb25zdCBwb2x5cyA9IFtdO1xuICBsZXQgY3VycmVudFBvbHkgPSBbXTtcbiAgZm9yIChsZXQgaSA9IDA7IGkgPCBkYXRhLmxlbmd0aDsgaSsrKSB7XG4gICAgY29uc3QgY3VycmVudERhdGUgPSBkYXRhW2ldWzBdO1xuICAgIGNvbnN0IHByZXZEYXRlID0gKGRhdGFbaSAtIDFdIHx8IFtdKVswXTtcbiAgICBpZiAoXG4gICAgICBpID09PSAwIHx8XG4gICAgICBjdXJyZW50RGF0ZS5nZXRUaW1lKCkgLSBwcmV2RGF0ZS5nZXRUaW1lKCkgPCAzNjAwICogMjQgKiAxMDAwICogMS41XG4gICAgKSB7XG4gICAgICBjdXJyZW50UG9seS5wdXNoKGRhdGFbaV0pO1xuICAgIH0gZWxzZSB7XG4gICAgICBwb2x5cy5wdXNoKGN1cnJlbnRQb2x5KTtcbiAgICAgIGN1cnJlbnRQb2x5ID0gW2RhdGFbaV1dO1xuICAgIH1cbiAgfVxuICBwb2x5cy5wdXNoKGN1cnJlbnRQb2x5KTtcbiAgcG9seXMuZm9yRWFjaCgocCkgPT4ge1xuICAgIGNvbnN0IHBvaW50cyA9IFtcbiAgICAgIC4uLnAubWFwKChbZCwgbF0pID0+IGAke3hTY2FsZSgxMiAtIGwgLyAyKX0sJHt5U2NhbGUoZCl9YCksXG4gICAgICAuLi5wLnJldmVyc2UoKS5tYXAoKFtkLCBsXSkgPT4gYCR7eFNjYWxlKDEyICsgbCAvIDIpfSwke3lTY2FsZShkKX1gKVxuICAgIF0uam9pbihcIiBcIik7XG4gICAgcm9vdC5hcHBlbmQoXCJwb2x5Z29uXCIpLmF0dHIoXCJwb2ludHNcIiwgcG9pbnRzKS5hdHRyKFwiZmlsbFwiLCBjb2xvcnMuZGF5KTtcbiAgfSk7XG4gIC8qIExlZ2VuZCAqL1xuICBjb25zdCBsZWdlbmQgPSByb290XG4gICAgLmFwcGVuZChcImdcIilcbiAgICAuYXR0cihcInRyYW5zZm9ybVwiLCBgdHJhbnNsYXRlKCR7bWFyZ2luLmxlZnQgKyBjaGFydFdpZHRoIC8gMiAtIDY0fSlgKTtcbiAgbGVnZW5kXG4gICAgLmFwcGVuZChcInJlY3RcIilcbiAgICAuYXR0cihcInJ4XCIsIDUpXG4gICAgLmF0dHIoXCJ4XCIsIC0zNCArIDQgKiAod2lkdGggPCAxNjUgPyAxMi43IDogd2lkdGggPCAyNjUgPyA1LjUgOiB3aWR0aCA8IDM2NSA/IDMgOiAwKSlcbiAgICAuYXR0cihcInlcIiwgNC41ICogKHdpZHRoIDwgMTY1ID8gMS45IDogd2lkdGggPCAyNjUgPyAxLjQgOiB3aWR0aCA8IDM2NSA/IC45IDogLjgpKVxuICAgIC5hdHRyKFwid2lkdGhcIiwgZm9udFNpemUgKiAod2lkdGggPCAxNjUgPyAxIDogd2lkdGggPCAyNjUgPyAxLjIgOiB3aWR0aCA8IDM2NSA/IDEuNCA6IDEuNikpXG4gICAgLmF0dHIoXCJoZWlnaHRcIiwgZm9udFNpemUgKiAod2lkdGggPCAxNjUgPyAxIDogd2lkdGggPCAyNjUgPyAxLjIgOiB3aWR0aCA8IDM2NSA/IDEuNCA6IDEuNikpXG4gICAgLmF0dHIoXCJmaWxsXCIsIGNvbG9ycy5uaWdodCk7XG4gIGxlZ2VuZFxuICAgIC5hcHBlbmQoXCJ0ZXh0XCIpXG4gICAgLmF0dHIoXCJ4XCIsIC0xNiArIDQgKiAod2lkdGggPCAxNjUgPyAxMS44IDogd2lkdGggPCAyNjUgPyA0LjkgOiB3aWR0aCA8IDM2NSA/IDIuOCA6IDApKVxuICAgIC5hdHRyKFwieVwiLCAxOSlcbiAgICAuYXR0cihcImZvbnQtc2l6ZVwiLCBmb250U2l6ZSAqICh3aWR0aCA8IDE2NSA/IDEgOiB3aWR0aCA8IDI2NSA/IDEuMiA6IHdpZHRoIDwgMzY1ID8gMS40IDogMS42KSlcbiAgICAuYXR0cihcImZvbnQtZmFtaWx5XCIsIFwic2Fucy1zZXJpZlwiKVxuICAgIC50ZXh0KFwiTmlnaHRcIik7XG4gIGxlZ2VuZFxuICAgIC5hcHBlbmQoXCJyZWN0XCIpXG4gICAgLmF0dHIoXCJ4XCIsIDM0ICsgNCAqICh3aWR0aCA8IDE2NSA/IDcuOCA6IHdpZHRoIDwgMjY1ID8gOC4yIDogd2lkdGggPCAzNjUgPyA2LjkgOiA0LjIpKVxuICAgIC5hdHRyKFwicnhcIiwgNSlcbiAgICAuYXR0cihcInlcIiwgNC41ICogKHdpZHRoIDwgMTY1ID8gMS45IDogd2lkdGggPCAyNjUgPyAxLjQgOiB3aWR0aCA8IDM2NSA/IC45IDogLjgpKVxuICAgIC5hdHRyKFwid2lkdGhcIiwgZm9udFNpemUgKiAod2lkdGggPCAxNjUgPyAxIDogd2lkdGggPCAyNjUgPyAxLjIgOiB3aWR0aCA8IDM2NSA/IDEuNCA6IDEuNikpXG4gICAgLmF0dHIoXCJoZWlnaHRcIiwgZm9udFNpemUgKiAod2lkdGggPCAxNjUgPyAxIDogd2lkdGggPCAyNjUgPyAxLjIgOiB3aWR0aCA8IDM2NSA/IDEuNCA6IDEuNikpXG4gICAgLmF0dHIoXCJmaWxsXCIsIGNvbG9ycy5kYXkpO1xuICBsZWdlbmRcbiAgICAuYXBwZW5kKFwidGV4dFwiKVxuICAgIC5hdHRyKFwieFwiLCA1MiArIDQgKiAod2lkdGggPCAxNjUgPyA2LjggOiB3aWR0aCA8IDI2NSA/IDcuOCA6IHdpZHRoIDwgMzY1ID8gNi45IDogNC4yKSlcbiAgICAuYXR0cihcInlcIiwgMTkpXG4gICAgLmF0dHIoXCJmb250LXNpemVcIiwgZm9udFNpemUgKiAod2lkdGggPCAxNjUgPyAxIDogd2lkdGggPCAyNjUgPyAxLjIgOiB3aWR0aCA8IDM2NSA/IDEuNCA6IDEuNikpXG4gICAgLmF0dHIoXCJmb250LWZhbWlseVwiLCBcInNhbnMtc2VyaWZcIilcbiAgICAudGV4dChcIkRheVwiKTtcbiAgLyogVGltZSBhbmQgZGF0ZSBjb250cm9scyAqL1xuICBjb25zdCBkYXRlTGluZSA9IHJvb3QuYXBwZW5kKFwiZ1wiKTtcbiAgY29uc3QgdXBkYXRlQ29udHJvbFBvc2l0aW9ucyA9ICgpID0+IHtcbiAgICBkYXRlTGluZVxuICAgICAgLnNlbGVjdChcImxpbmVcIilcbiAgICAgIC5hdHRyKFwiaWRcIiwgXCJkYXRlbGluZVwiKVxuICAgICAgLmF0dHIoXCJ4MVwiLCB4U2NhbGUoMCkpXG4gICAgICAuYXR0cihcInkxXCIsIHlTY2FsZShkYXRlKSlcbiAgICAgIC5hdHRyKFwieDJcIiwgeFNjYWxlKDI0KSlcbiAgICAgIC5hdHRyKFwieTJcIiwgeVNjYWxlKGRhdGUpKTtcbiAgICBkYXRlTGluZVxuICAgICAgLnNlbGVjdChcInJlY3RcIilcbiAgICAgIC5hdHRyKFwiaWRcIiwgXCJkYXRlcmVjdFwiKVxuICAgICAgLmF0dHIoXCJ4XCIsIHhTY2FsZSgwKSlcbiAgICAgIC5hdHRyKFwieVwiLCB5U2NhbGUoZGF0ZSkgLSA0KTtcbiAgICByb290XG4gICAgICAuc2VsZWN0KFwiI3RpbWUtY29udHJvbFwiKVxuICAgICAgLmF0dHIoXCJjeFwiLCB4U2NhbGUoaG91cikpXG4gICAgICAuYXR0cihcImN5XCIsIHlTY2FsZShkYXRlKSk7XG4gIH07XG4gIGNvbnN0IGRpc3BhdGNoRGF0ZUhvdXJDaGFuZ2UgPSAoKSA9PiB7XG4gICAgY29uc3QgZGV0YWlsID0geyBkYXRlLCBob3VyIH07XG4gICAgY29uc3QgY2hhbmdlRXZlbnQgPSBuZXcgQ3VzdG9tRXZlbnQoRXZlbnRUeXBlLkRhdGVIb3VyQ2hhbmdlLCB7XG4gICAgICBkZXRhaWwsXG4gICAgICBidWJibGVzOiB0cnVlXG4gICAgfSk7XG4gICAgcm9vdC5ub2RlKCkuZGlzcGF0Y2hFdmVudChjaGFuZ2VFdmVudCk7XG4gIH07XG4gIGNvbnN0IGhhbmRsZURhdGVMaW5lRHJhZyA9ICh7IHkgfSkgPT4ge1xuICAgIGRhdGUgPSB5U2NhbGUuaW52ZXJ0KHkpO1xuICAgIHVwZGF0ZUNvbnRyb2xQb3NpdGlvbnMoKTtcbiAgICBkaXNwYXRjaERhdGVIb3VyQ2hhbmdlKCk7XG4gIH07XG4gIGNvbnN0IGhhbmRsZVRpbWVDaXJjbGVEcmFnID0gKHsgeCB9KSA9PiB7XG4gICAgaG91ciA9IHhTY2FsZS5pbnZlcnQoeCk7XG4gICAgdXBkYXRlQ29udHJvbFBvc2l0aW9ucygpO1xuICAgIGRpc3BhdGNoRGF0ZUhvdXJDaGFuZ2UoKTtcbiAgfTtcbiAgZGF0ZUxpbmUuYXBwZW5kKFwibGluZVwiKS5hdHRyKFwic3Ryb2tlLXdpZHRoXCIsIDQpLmF0dHIoXCJzdHJva2VcIiwgXCJyZWRcIik7XG4gIGRhdGVMaW5lXG4gICAgLmFwcGVuZChcInJlY3RcIilcbiAgICAuYXR0cihcIndpZHRoXCIsIGNoYXJ0V2lkdGgpXG4gICAgLmF0dHIoXCJoZWlnaHRcIiwgOClcbiAgICAuYXR0cihcImZpbGxcIiwgXCJyZ2JhKDAsIDAsIDAsIDApXCIpXG4gICAgLnN0eWxlKFwiY3Vyc29yXCIsIFwicm93LXJlc2l6ZVwiKVxuICAgIC5jYWxsKGQzLmRyYWcoKS5vbihcImRyYWdcIiwgaGFuZGxlRGF0ZUxpbmVEcmFnKSk7XG4gIHJvb3RcbiAgICAuYXBwZW5kKFwiY2lyY2xlXCIpXG4gICAgLmF0dHIoXCJpZFwiLCBcInRpbWUtY29udHJvbFwiKVxuICAgIC5hdHRyKFwiclwiLCAxMilcbiAgICAuYXR0cihcImZpbGxcIiwgXCJyZWRcIilcbiAgICAuYXR0cihcInN0cm9rZS13aWR0aFwiLCAuNilcbiAgICAuYXR0cihcInN0cm9rZVwiLCBcImJsYWNrXCIpXG4gICAgLnN0eWxlKFwiY3Vyc29yXCIsIFwicG9pbnRlclwiKVxuICAgIC5jYWxsKGQzLmRyYWcoKS5vbihcImRyYWdcIiwgaGFuZGxlVGltZUNpcmNsZURyYWcpKTtcbiAgdXBkYXRlQ29udHJvbFBvc2l0aW9ucygpO1xufVxuZm9udFNpemUgPSAxMjtcbmdldFNvbGFyQW5nbGUgPSAoZGF0ZSkgPT4gKGRheU9mWWVhcihkYXRlKSArIDEwKSAvIDM2NSAqIE1hdGguUEkgKiAyIC0gTWF0aC5QSSAvIDI7XG4vKlxuICogRm9ybXVsYXMgdXNlcyB0aGUgQ0JNIG1vZGVsIGFzIHJldmlld2VkIGhlcmU6XG4gKiBodHRwczovL3d3dy5pa2hlYmVlbnZyYWFnLmJlL21lZGlhc3RvcmFnZS9GU0RvY3VtZW50LzE3MS9Gb3JzeXRoZSstK0ErbW9kZWwrY29tcGFyaXNvbitmb3IrZGF5bGVuZ3RoK2FzK2ErZnVuY3Rpb24rb2YrbGF0aXR1ZGUrYW5kK2RheStvZit5ZWFyKy0rMTk5NS5wZGZcbiAqL1xuZGF5TGVuZ3RoID0gKGRhdGUsIGxhdGl0dWRlKSA9PiB7XG4gIGNvbnN0IHllYXJTdGFydCA9IG5ldyBEYXRlKGRhdGUuZ2V0RnVsbFllYXIoKSwgMCwgMSk7XG4gIGNvbnN0IGRheU9mWWVhciA9IE1hdGguZmxvb3IoKGRhdGUuZ2V0VGltZSgpIC0geWVhclN0YXJ0LmdldFRpbWUoKSkvODY0MDAwMDApICsgMTtcbiAgY29uc3QgcmV2QW5nbGUgPSAwLjIxNjMxMDggKyAyICogTWF0aC5hdGFuKDAuOTY3MTM5NiAqIE1hdGgudGFuKDAuMDA4NjAgKiAoZGF5T2ZZZWFyIC0gMTg2KSkpO1xuICBjb25zdCBkZWNBbmdsZSA9IE1hdGguYXNpbigwLjM5Nzk1ICogTWF0aC5jb3MocmV2QW5nbGUpKTtcbiAgLyogZGF5bGlnaHQgY29lZmZpY2llbnQgc2VsZWN0ZWQgZm9yIGFwcGFyZW50IHN1bnJpc2Uvc3Vuc2V0ICovXG4gIGNvbnN0IHAgPSAwLjgzMzNcbiAgY29uc3QgaW50UmVzdWx0ID1cbiAgICAoTWF0aC5zaW4oKHAgKiBNYXRoLlBJKSAvIDE4MCkgK1xuICAgICAgTWF0aC5zaW4oKGxhdGl0dWRlICogTWF0aC5QSSkgLyAxODApICogTWF0aC5zaW4oZGVjQW5nbGUpKSAvXG4gICAgKE1hdGguY29zKChsYXRpdHVkZSAqIE1hdGguUEkpIC8gMTgwKSAqIE1hdGguY29zKGRlY0FuZ2xlKSk7XG4gIGlmIChpbnRSZXN1bHQgPj0gMSkgcmV0dXJuIDI0O1xuICBpZiAoaW50UmVzdWx0IDw9IC0xKSByZXR1cm4gMDtcbiAgcmV0dXJuIDI0IC0gMjQgKiBNYXRoLmFjb3MoaW50UmVzdWx0KSAvIE1hdGguUEk7XG59XG55ZWFyRGF0ZXMgPSAoeWVhcikgPT4ge1xuICBjb25zdCBzdGFydERhdGUgPSBuZXcgRGF0ZSh5ZWFyLCAwLCAxKzYwKTtcbiAgY29uc3QgZW5kRGF0ZSA9IG5ldyBEYXRlKHllYXIgKyAxLCAwLCAxKzYwKTtcbiAgcmV0dXJuIGQzLnRpbWVEYXkucmFuZ2Uoc3RhcnREYXRlLCBlbmREYXRlKTtcbn1cbmhlaWdodCA9IDAuNjUgKiB3aWR0aDtcbkV2ZW50VHlwZSA9ICh7XG4gIExvY2F0aW9uQ2hhbmdlOiBcIkxPQ0FUSU9OX0NIQU5HRVwiLFxuICBEYXRlSG91ckNoYW5nZTogXCJEQVRFX0hPVVJfQ0hBTkdFXCJcbn0pXG5jb2xvcnMgPSAoe1xuICBuaWdodDogXCIjNzE5ZmI2XCIsXG4gIGRheTogXCIjZmZlNDM4XCIsXG4gIGdyaWQ6IFwiIzRiNmE3OVwiLFxuICBvY2VhbjogXCIjYWRlZWZmXCIsXG4gIGxhbmQ6IFwiI2Y1ZjFkY1wiLFxuICBzdW46IFwiI2ZmZTQzOFwiXG59KVxudG9SYWRpYW5zID0gKHZhbCkgPT4gdmFsICogTWF0aC5QSSAvIDE4MFxudG9EZWdyZWVzID0gKHZhbCkgPT4gdmFsICogMTgwIC8gTWF0aC5QSTtcbmxhbmQgPSB0b3BvanNvbi5mZWF0dXJlKHdvcmxkLCB3b3JsZC5vYmplY3RzLmxhbmQpO1xuZDMgPSByZXF1aXJlKFwiZDNAN1wiLCBcImQzLWdlby1wcm9qZWN0aW9uQDNcIilcbmZ1bmN0aW9uIGlucHV0KGNvbmZpZykge1xuICBsZXQge1xuICAgIGZvcm0sXG4gICAgdHlwZSA9IFwidGV4dFwiLFxuICAgIGF0dHJpYnV0ZXMgPSB7fSxcbiAgICBhY3Rpb24sXG4gICAgZ2V0VmFsdWUsXG4gICAgdGl0bGUsXG4gICAgZGVzY3JpcHRpb24sXG4gICAgZm9ybWF0LFxuICAgIGRpc3BsYXksXG4gICAgc3VibWl0LFxuICAgIG9wdGlvbnNcbiAgfSA9IGNvbmZpZztcbiAgY29uc3Qgd3JhcHBlciA9IGh0bWxgPGRpdj48L2Rpdj5gO1xuICBpZiAoIWZvcm0pXG4gICAgZm9ybSA9IGh0bWxgPGZvcm0+XG5cdDxpbnB1dCBuYW1lPWlucHV0IHR5cGU9JHt0eXBlfSAvPlxuICA8L2Zvcm0+YDtcbiAgT2JqZWN0LmtleXMoYXR0cmlidXRlcykuZm9yRWFjaChrZXkgPT4ge1xuICAgIGNvbnN0IHZhbCA9IGF0dHJpYnV0ZXNba2V5XTtcbiAgICBpZiAodmFsICE9IG51bGwpIGZvcm0uaW5wdXQuc2V0QXR0cmlidXRlKGtleSwgdmFsKTtcbiAgfSk7XG4gIGlmIChzdWJtaXQpXG4gICAgZm9ybS5hcHBlbmQoXG4gICAgICBodG1sYDxpbnB1dCBuYW1lPXN1Ym1pdCB0eXBlPXN1Ym1pdCBzdHlsZT1cIm1hcmdpbjogMCAwLjc1ZW1cIiB2YWx1ZT1cIiR7XG4gICAgICAgIHR5cGVvZiBzdWJtaXQgPT0gXCJzdHJpbmdcIiA/IHN1Ym1pdCA6IFwiU3VibWl0XCJcbiAgICAgIH1cIiAvPmBcbiAgICApO1xuICBmb3JtLmFwcGVuZChcbiAgICBodG1sYDxvdXRwdXQgbmFtZT1vdXRwdXQgc3R5bGU9XCJmb250OiAxNHB4IE1lbmxvLCBDb25zb2xhcywgbW9ub3NwYWNlOyBtYXJnaW4tbGVmdDogMC4xZW07IHRleHQtYWxpZ246Y2VudGVyO1wiPjwvb3V0cHV0PmBcbiAgKTtcbiAgaWYgKHRpdGxlKVxuICAgIGZvcm0ucHJlcGVuZChcbiAgICAgIGh0bWxgPGRpdiBzdHlsZT1cImZvbnQ6IDcwMCAwLjlyZW0gc2Fucy1zZXJpZjsgbWFyZ2luLWJvdHRvbTogM3B4O1wiPiR7dGl0bGV9PC9kaXY+YFxuICAgICk7XG4gIGlmIChkZXNjcmlwdGlvbilcbiAgICBmb3JtLmFwcGVuZChcbiAgICAgIGh0bWxgPGRpdiBzdHlsZT1cImZvbnQtc2l6ZTogMC44NXJlbTsgZm9udC1zdHlsZTogaXRhbGljOyBtYXJnaW4tdG9wOiAzcHg7XCI+JHtkZXNjcmlwdGlvbn08L2Rpdj5gXG4gICAgKTtcbiAgaWYgKGZvcm1hdClcbiAgICBmb3JtYXQgPSB0eXBlb2YgZm9ybWF0ID09PSBcImZ1bmN0aW9uXCIgPyBmb3JtYXQgOiBkM2Zvcm1hdC5mb3JtYXQoZm9ybWF0KTtcbiAgaWYgKGFjdGlvbikge1xuICAgIGFjdGlvbihmb3JtKTtcbiAgfSBlbHNlIHtcbiAgICBjb25zdCB2ZXJiID0gc3VibWl0XG4gICAgICA/IFwib25zdWJtaXRcIlxuICAgICAgOiB0eXBlID09IFwiYnV0dG9uXCJcbiAgICAgID8gXCJvbmNsaWNrXCJcbiAgICAgIDogdHlwZSA9PSBcImNoZWNrYm94XCIgfHwgdHlwZSA9PSBcInJhZGlvXCJcbiAgICAgID8gXCJvbmNoYW5nZVwiXG4gICAgICA6IFwib25pbnB1dFwiO1xuICAgIGZvcm1bdmVyYl0gPSBlID0+IHtcbiAgICAgIGUgJiYgZS5wcmV2ZW50RGVmYXVsdCgpO1xuICAgICAgY29uc3QgdmFsdWUgPSBnZXRWYWx1ZSA/IGdldFZhbHVlKGZvcm0uaW5wdXQpIDogZm9ybS5pbnB1dC52YWx1ZTtcbiAgICAgIGlmIChmb3JtLm91dHB1dCkge1xuICAgICAgICBjb25zdCBvdXQgPSBkaXNwbGF5ID8gZGlzcGxheSh2YWx1ZSkgOiBmb3JtYXQgPyBmb3JtYXQodmFsdWUpIDogdmFsdWU7XG4gICAgICAgIGlmIChvdXQgaW5zdGFuY2VvZiB3aW5kb3cuRWxlbWVudCkge1xuICAgICAgICAgIHdoaWxlIChmb3JtLm91dHB1dC5oYXNDaGlsZE5vZGVzKCkpIHtcbiAgICAgICAgICAgIGZvcm0ub3V0cHV0LnJlbW92ZUNoaWxkKGZvcm0ub3V0cHV0Lmxhc3RDaGlsZCk7XG4gICAgICAgICAgfVxuICAgICAgICAgIGZvcm0ub3V0cHV0LmFwcGVuZChvdXQpO1xuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgIGZvcm0ub3V0cHV0LnZhbHVlID0gb3V0O1xuICAgICAgICB9XG4gICAgICB9XG4gICAgICBmb3JtLnZhbHVlID0gdmFsdWU7XG4gICAgICBpZiAodmVyYiAhPT0gXCJvbmlucHV0XCIpXG4gICAgICAgIGZvcm0uZGlzcGF0Y2hFdmVudChuZXcgQ3VzdG9tRXZlbnQoXCJpbnB1dFwiLCB7IGJ1YmJsZXM6IHRydWUgfSkpO1xuICAgIH07XG4gICAgaWYgKHZlcmIgIT09IFwib25pbnB1dFwiKVxuICAgICAgd3JhcHBlci5vbmlucHV0ID0gZSA9PiBlICYmIGUuc3RvcFByb3BhZ2F0aW9uKCkgJiYgZS5wcmV2ZW50RGVmYXVsdCgpO1xuICAgIGlmICh2ZXJiICE9PSBcIm9uc3VibWl0XCIpIGZvcm0ub25zdWJtaXQgPSBlID0+IGUgJiYgZS5wcmV2ZW50RGVmYXVsdCgpO1xuICAgIGZvcm1bdmVyYl0oKTtcbiAgfVxuICB3aGlsZSAoZm9ybS5jaGlsZE5vZGVzLmxlbmd0aCkge1xuICAgIHdyYXBwZXIuYXBwZW5kQ2hpbGQoZm9ybS5jaGlsZE5vZGVzWzBdKTtcbiAgfVxuICBmb3JtLmFwcGVuZCh3cmFwcGVyKTtcbiAgcmV0dXJuIGZvcm07XG59XG5kM2Zvcm1hdCA9IHJlcXVpcmUoXCJkMy1mb3JtYXRAMVwiKVxuLy8gaHR0cHM6Ly9vYnNlcnZhYmxlaHEuY29tL0BlbmphbG90L2RyYWdnYWJsZS13b3JsZC1tYXAtY29vcmRpbmF0ZXMtaW5wdXRcbmZ1bmN0aW9uIHdvcmxkTWFwQ29vcmRpbmF0ZXMoY29uZmlnID0ge30sIGRpbWVuc2lvbnMpIHtcbiAgY29uc3Qge1xuICAgIHZhbHVlID0gW10sIHRpdGxlLCBkZXNjcmlwdGlvbiwgd2lkdGggPSBkaW1lbnNpb25zWzBdXG4gIH0gPSBBcnJheS5pc0FycmF5KGNvbmZpZykgPyB7dmFsdWU6IGNvbmZpZ30gOiBjb25maWc7XG4gIGNvbnN0IGhlaWdodCA9IGRpbWVuc2lvbnNbMV07XG4gIGxldCBbbG9uLCBsYXRdID0gdmFsdWU7XG4gIGxvbiA9IGxvbiAhPSBudWxsID8gbG9uIDogbnVsbDtcbiAgbGF0ID0gbGF0ICE9IG51bGwgPyBsYXQgOiBudWxsO1xuICBjb25zdCBmb3JtRWwgPSBodG1sYDxmb3JtIHN0eWxlPVwid2lkdGg6ICR7d2lkdGh9cHg7XCI+PC9mb3JtPmA7XG4gIGNvbnN0IGNvbnRleHQgPSBET00uY29udGV4dDJkKHdpZHRoLCBoZWlnaHQtd2lkdGgvMTMuMik7XG4gIGNvbnN0IGNhbnZhcyA9IGNvbnRleHQuY2FudmFzO1xuICBjYW52YXMuc3R5bGUubWFyZ2luID0gYC0xMHB4IDBweCAtMjZweCAwcHhgO1xuICBjb25zdCBwcm9qZWN0aW9uID0gZDNcbiAgICAuZ2VvRXF1aXJlY3Rhbmd1bGFyKClcbiAgICAucHJlY2lzaW9uKDAuMSlcbiAgICAuZml0U2l6ZShbd2lkdGgsIGhlaWdodF0sIHsgdHlwZTogXCJTcGhlcmVcIiB9KS5yb3RhdGUoWy0xNTMsIDBdKTtcbiAgY29uc3QgcGF0aCA9IGQzLmdlb1BhdGgocHJvamVjdGlvbiwgY29udGV4dCkucG9pbnRSYWRpdXMoMi41KTtcbiAgZm9ybUVsLmFwcGVuZChjYW52YXMpO1xuICBmdW5jdGlvbiBkcmF3KCkge1xuICAgIGNvbnRleHQuZmlsbFN0eWxlID0gXCIjZmZmXCI7XG4gICAgY29udGV4dC5maWxsUmVjdCgwLCAwLCB3aWR0aCwgaGVpZ2h0KTtcbiAgICBjb250ZXh0LmJlZ2luUGF0aCgpOyBwYXRoKHt0eXBlOiBcIlNwaGVyZVwifSk7XG4gICAgY29udGV4dC5maWxsU3R5bGUgPSBjb2xvcnMub2NlYW47IGNvbnRleHQuZmlsbCgpO1xuICAgIGNvbnRleHQuYmVnaW5QYXRoKCk7XG4gICAgcGF0aChncmF0aWN1bGUpO1xuICAgIGNvbnRleHQubGluZVdpZHRoID0gMC45NTtcbiAgICBjb250ZXh0LnN0cm9rZVN0eWxlID0gYCNhYWFgO1xuICAgIGNvbnRleHQuc3Ryb2tlKCk7XG4gICAgY29udGV4dC5iZWdpblBhdGgoKTtcbiAgICBwYXRoKGxhbmQpO1xuICAgIGNvbnRleHQuZmlsbFN0eWxlID0gY29sb3JzLmxhbmQ7XG4gICAgY29udGV4dC5maWxsKCk7XG4gICAgY29udGV4dC5iZWdpblBhdGgoKTtcbiAgICBwYXRoKGNvdW50cmllcyk7XG4gICAgY29udGV4dC5saW5lV2lkdGggPSAuOTU7XG4gICAgY29udGV4dC5zdHJva2VTdHlsZSA9IGAjMDAwYDtcbiAgICBjb250ZXh0LnN0cm9rZSgpO1xuICAgIGNvbnRleHQuZmlsbFN0eWxlID0gYCMwMDBgO1xuICAgIGNvbnRleHQuZm9udCA9IHdpZHRoIDwgNzYwID8gXCIxNHB4IHNlcmlmXCIgOiB3aWR0aCA8IDk5MCA/IFwiMTdweCBzZXJpZlwiIDogXCIyM3B4IHNlcmlmXCI7XG4gICAgZDMucmFuZ2UoLTEuNSwgMzQyICsgMSwgMzYpLm1hcCh4ID0+ICBjb250ZXh0LmZpbGxUZXh0KGxvbmcyem9uZSh4KSwgLi4ucHJvamVjdGlvbihbeCwgODQgLSAod2lkdGggPCA1MDApICogOC44XSkpKTtcbiAgICBkMy5yYW5nZSgtMS41LCAzNDIgKyAxLCAzNikubWFwKHggPT4gIGNvbnRleHQuZmlsbFRleHQobG9uZzJ6b25lKHgpLCAuLi5wcm9qZWN0aW9uKFt4LCAtNjYgKyAod2lkdGggPCA1MDApICogMS4xXSkpKTtcbiAgICBjb250ZXh0LmJlZ2luUGF0aCgpLCBwYXRoKG5pZ2h0KSwgY29udGV4dC5maWxsU3R5bGUgPSBcInJnYmEoMCwwLDI1NSwwLjEpXCIsIGNvbnRleHQuZmlsbCgpO1xuICAgIGNvbnRleHQuYmVnaW5QYXRoKCk7IHBhdGgucG9pbnRSYWRpdXMoMTcpOyBwYXRoKHt0eXBlOiBcIlBvaW50XCIsIGNvb3JkaW5hdGVzOiBzdW59KTsgY29udGV4dC5zdHJva2VTdHlsZSA9IFwiIzAwMDhcIjsgY29udGV4dC5maWxsU3R5bGUgPSBcIiNmZjA4XCI7IGNvbnRleHQubGluZVdpZHRoID0gMTsgY29udGV4dC5zdHJva2UoKTsgY29udGV4dC5maWxsKCk7XG4gICAgaWYgKGxvbiAhPSBudWxsICYmIGxhdCAhPSBudWxsKSB7XG4gICAgICBwYXRoLnBvaW50UmFkaXVzKDE3KTsgY29udGV4dC5zdHJva2VTdHlsZSA9IFwiYmxhY2tcIjtcbiAgICAgIGNvbnRleHQuYmVnaW5QYXRoKCk7IHBhdGgoe3R5cGU6IFwiUG9pbnRcIiwgY29vcmRpbmF0ZXM6IFtsb24sIGxhdF19KTsgY29udGV4dC5saW5lV2lkdGggPSAxOyBjb250ZXh0LnN0cm9rZSgpO1xuICAgICAgY29udGV4dC5saW5lV2lkdGggPSA2O1xuICAgICAgcGF0aC5wb2ludFJhZGl1cygxNCk7IGNvbnRleHQuc3Ryb2tlU3R5bGUgPSBcInJlZFwiO1xuICAgICAgY29udGV4dC5iZWdpblBhdGgoKTsgcGF0aCh7dHlwZTogXCJQb2ludFwiLCBjb29yZGluYXRlczogW2xvbiwgbGF0XX0pOyBjb250ZXh0LnN0cm9rZSgpO1xuICAgIH1cbiAgfVxuICBsZXQgZHJhZyA9IGQzLmRyYWcoKVxuICAgIC5vbihcImRyYWdcIiwgKGV2ZW50KSA9PiB7XG4gICAgICBsZXQgY29vcmRzID0gcHJvamVjdGlvbi5pbnZlcnQoW2V2ZW50LngsIGV2ZW50LnldKTtcbiAgICAgIGxvbiA9ICtjb29yZHNbMF0udG9GaXhlZCgyKTtcbiAgICAgIGxhdCA9ICtjb29yZHNbMV0udG9GaXhlZCgyKTtcbiAgICAgIGRyYXcoKTtcbiAgICAgIGNhbnZhcy5kaXNwYXRjaEV2ZW50KG5ldyBDdXN0b21FdmVudChcImlucHV0XCIsIHsgYnViYmxlczogdHJ1ZSB9KSk7XG4gICAgfSlcbiAgZDMuc2VsZWN0KGNhbnZhcykuY2FsbChkcmFnKVxuICBjYW52YXMub25jbGljayA9IGZ1bmN0aW9uKGV2KSB7XG4gICAgY29uc3QgeyBvZmZzZXRYLCBvZmZzZXRZIH0gPSBldjtcbiAgICBsZXQgY29vcmRzID0gcHJvamVjdGlvbi5pbnZlcnQoW29mZnNldFgsIG9mZnNldFldKTtcbiAgICBsb24gPSArY29vcmRzWzBdLnRvRml4ZWQoMik7XG4gICAgbGF0ID0gK2Nvb3Jkc1sxXS50b0ZpeGVkKDIpO1xuICAgIGRyYXcoKTtcbiAgICBjYW52YXMuZGlzcGF0Y2hFdmVudChuZXcgQ3VzdG9tRXZlbnQoXCJpbnB1dFwiLCB7IGJ1YmJsZXM6IHRydWUgfSkpO1xuICB9O1xuICBkcmF3KCk7XG4gIGNvbnN0IGZvcm0gPSBpbnB1dCh7XG4gICAgdHlwZTogXCJ3b3JsZE1hcENvb3JkaW5hdGVzXCIsXG4gICAgdGl0bGUsXG4gICAgZGVzY3JpcHRpb24sXG4gICAgZGlzcGxheTogdiA9PiAod2lkdGggPiAzMDApID8gaHRtbGA8ZGl2IHN0eWxlPVwid2lkdGg6ICR7d2lkdGh9cHg7IHdoaXRlLXNwYWNlOiBub3dyYXA7IGNvbG9yOiAjNDQ0OyB0ZXh0LWFsaWduOiBjZW50ZXI7IGZvbnQ6ICR7d2lkdGggLyA1MH1weCBtb25vc3BhY2U7IHBvc2l0aW9uOiByZWxhdGl2ZTsgdG9wOiAtJHt3aWR0aCAvIDMwfXB4OyAgbWFyZ2luLWJvdHRvbTogLS40ZW07XCI+XG4gICAgICAgICAgICA8c3BhbiBzdHlsZT1cImNvbG9yOiAjMDAwO1wiPlpvbmU6PC9zcGFuPiAke2xvbiAhPSBudWxsID8gbG9uZzJ6b25lKGxvbikgOiBcIlwifVxuICAgICAgICAgICAgJm5ic3A7ICZuYnNwO1xuICAgICAgICAgICAgPHNwYW4gc3R5bGU9XCJjb2xvcjogIzAwMDtcIj5Mb25naXR1ZGU6PC9zcGFuPiAke2xvbiAhPSBudWxsID8gKGxvbmcydHVybihsb24pKS50b0ZpeGVkKDApIDogXCJcIn1cbiAgICAgICAgICAgICZuYnNwOyAmbmJzcDtcbiAgICAgICAgICAgIDxzcGFuIHN0eWxlPVwiY29sb3I6ICMwMDA7XCI+TGF0aXR1ZGU6PC9zcGFuPiAke2xhdCAhPSBudWxsID8gKChsYXRpMnR1cm4xKGxhdCkpKS50b0ZpeGVkKDApIDogXCJcIn1cbiAgICAgICAgICA8L2Rpdj5gIDogJycsXG4gICAgZ2V0VmFsdWU6ICgpID0+IFtsb24gIT0gbnVsbCA/IGxvbiA6IG51bGwsIGxhdCAhPSBudWxsID8gbGF0IDogbnVsbF0sXG4gICAgZm9ybTogZm9ybUVsXG4gIH0pO1xuICByZXR1cm4gZm9ybTtcbn1cbnN1biA9IHtcbiAgY29uc3Qgbm93ID0gbmV3IERhdGU7XG4gIGNvbnN0IGRheSA9IG5ldyBEYXRlKCtub3cpLnNldFVUQ0hvdXJzKDAsIDAsIDAsIDApO1xuICBjb25zdCB0ID0gc29sYXIuY2VudHVyeShub3cpO1xuICBjb25zdCBsb25naXR1ZGUgPSAoZGF5IC0gbm93KSAvIDg2NGU1ICogMzYwIC0gMTgwO1xuICByZXR1cm4gW2xvbmdpdHVkZSAtIHNvbGFyLmVxdWF0aW9uT2ZUaW1lKHQpIC8gNCwgc29sYXIuZGVjbGluYXRpb24odCldO1xufVxubmlnaHQgPSBkMy5nZW9DaXJjbGUoKVxuICAgIC5yYWRpdXMoOTApXG4gICAgLmNlbnRlcihhbnRpcG9kZShzdW4pKVxuICAoKVxuYW50aXBvZGUgPSAoW2xvbmdpdHVkZSwgbGF0aXR1ZGVdKSA9PiBbbG9uZ2l0dWRlICsgMTgwLCAtbGF0aXR1ZGVdXG5zb2xhciA9IHJlcXVpcmUoXCJzb2xhci1jYWxjdWxhdG9yQDAuMy9kaXN0L3NvbGFyLWNhbGN1bGF0b3IubWluLmpzXCIpXG52aWV3b2YgZmFuY3lTZWNvbmRzT0ZGID0gSW5wdXRzLnRvZ2dsZSh7XG4gIGxhYmVsOiBcIlRpY2tpbmcgY2xvY2tcIixcbiAgdmFsdWU6IHRydWUsXG59KVxuZnVuY3Rpb24gc2V0U3R5bGUoY29udGVudCwgc3R5bGUgPSB7fSkge1xuICBmdW5jdGlvbiB5aXEoY29sb3IpIHtcbiAgICBjb25zdCB7ciwgZywgYn0gPSBkMy5yZ2IoY29sb3IpO1xuICAgIHJldHVybiAociAqIDI5OSArIGcgKiA1ODcgKyBiICogMTE0KSAvIDEwMDAgLyAyNTU7IC8vIHJldHVybnMgdmFsdWVzIGJldHdlZW4gMCBhbmQgMVxuICB9XG4gIGNvbnN0IHtcbiAgICBiYWNrZ3JvdW5kLFxuICAgIGNvbG9yID0geWlxKGJhY2tncm91bmQpID49IDAuNiA/IFwiIzExMVwiIDogXCJ3aGl0ZVwiLFxuICAgIHBhZGRpbmcgPSBcIjAgMXB4XCIsXG4gICAgYm9yZGVyUmFkaXVzID0gXCI0cHhcIixcbiAgICBmb250V2VpZ2h0ID0gOTAwLFxuICAgIGZvbnRTaXplID0gXCIxZW1cIixcbiAgICAuLi5yZXN0XG4gIH0gPSB0eXBlb2Ygc3R5bGUgPT09IFwic3RyaW5nXCIgPyB7YmFja2dyb3VuZDogc3R5bGV9IDogc3R5bGU7XG4gIHJldHVybiBodGwuaHRtbGA8c3BhbiBzdHlsZT0ke3tcbiAgICBiYWNrZ3JvdW5kLFxuICAgIGNvbG9yLFxuICAgIHBhZGRpbmcsXG4gICAgYm9yZGVyUmFkaXVzLFxuICAgIGZvbnRXZWlnaHQsXG4gICAgLi4ucmVzdFxuICB9fT4ke2NvbnRlbnR9PC9zcGFuPmA7XG59XG5mdW5jdGlvbiB5aXEoY29sb3IpIHtcbiAgY29uc3Qge3IsIGcsIGJ9ID0gZDMucmdiKGNvbG9yKTtcbiAgcmV0dXJuIChyICogMjk5ICsgZyAqIDU4NyArIGIgKiAxMTQpIC8gMTAwMCAvIDI1NTsgLy8gcmV0dXJucyB2YWx1ZXMgYmV0d2VlbiAwIGFuZCAxXG59XG5mdW5jdGlvbiB0ZXh0Y29sb3IoY29udGVudCwgc3R5bGUgPSB7fSkge1xuICBjb25zdCB7XG4gICAgYmFja2dyb3VuZCxcbiAgICBjb2xvciA9IHlpcShiYWNrZ3JvdW5kKSA+IDAuNTEgPyBcIiMwMDBcIiA6IFwid2hpdGVcIixcbiAgICBwYWRkaW5nID0gXCIwIDVweFwiLFxuICAgIGJvcmRlclJhZGl1cyA9IFwiNHB4XCIsXG4gICAgZm9udFdlaWdodCA9IDQwMCxcbiAgICBmb250RmFtaWx5ID0gXCJtb25vc3BhY2VcIixcbiAgICAuLi5yZXN0XG4gIH0gPSB0eXBlb2Ygc3R5bGUgPT09IFwic3RyaW5nXCIgPyB7YmFja2dyb3VuZDogc3R5bGV9IDogc3R5bGU7XG4gIHJldHVybiBodGwuaHRtbGA8c3BhbiBzdHlsZT0ke3tcbiAgICBiYWNrZ3JvdW5kLFxuICAgIGNvbG9yLFxuICAgIHBhZGRpbmcsXG4gICAgYm9yZGVyUmFkaXVzLFxuICAgIGZvbnRXZWlnaHQsXG4gICAgZm9udEZhbWlseSxcbiAgICAuLi5yZXN0XG4gIH19PiR7Y29udGVudH08L3NwYW4+YDtcbn1cbmVsYXBzZWQgPSB7XG4gIGxldCBpID0gMDtcbiAgd2hpbGUgKHRydWUpIHtcbiAgICB5aWVsZCBQcm9taXNlcy50aWNrKDg2NCwgKytpKTtcbiAgfVxufVxucGllY2V3aXNlQ29sb3IgPSBkMy5waWVjZXdpc2UoZDMuaW50ZXJwb2xhdGVSZ2IsIFtcbiAgXCIjZjAwXCIsIC8vIHJlZFxuICBcIiNmMGZcIiwgLy8gbWFnZW50YVxuICBcIiNhMGZcIiwgLy8gdmlvbGV0XG4gIFwiIzAwZlwiLCAvLyBibHVlXG4gIFwiIzBhZlwiLCAvLyBhenVyZVxuICBcIiMwZmZcIiwgLy8gY3lhblxuICBcIiMwZjBcIiwgLy8gZ3JlZW5cbiAgXCIjYWYwXCIsIC8vIGxpbWVcbiAgXCIjZmYwXCIsIC8vIHllbGxvd1xuICBcIiNmYTBcIiwgLy8gb3JhbmdlXG4gIFwiI2YwMFwiLCAvLyByZWRcbl0pXG5zbFN0ciA9IGAsIDEwMCUsIDUwJSlgXG5lbGFUaW1lID0gZWxhcHNlZCAlIDFlNVxuZWxhVGltZUhzbCA9IHRleHRjb2xvcihlbGFUaW1lLCBgaHNsKCR7ZDMuaHNsKHBpZWNld2lzZUNvbG9yKGVsYVRpbWUgJSAxMDAwIC8gMTAwMCkpLmh9YCArIHNsU3RyKVxuZGVjTW90eSA9IE1hdGguZmxvb3IoKDUgKiBkZWNEYXRlICsgMikgLyAxNTMpXG5pc29ZZWFyID0gZGVjWWVhciArIChkZWNNb3R5ID4gOSlcbm1vbnRoID0gZGVjTW90eSA8IDEwID8gZGVjTW90eSArIDMgOiBkZWNNb3R5IC0gOVxuZGVjSG91ciA9IGRlY1RpbWUgKiAyNFxuZGVjTWludXRlID0gKGRlY0hvdXIgJSAxKSAqIDYwXG5kZWNTZWNvbmQgPSAoZGVjTWludXRlICUgMSkgKiA2MFxuaXNvSG91ciA9IE1hdGguZmxvb3IoZGVjSG91cilcbmlzb01pbnV0ZSA9IE1hdGguZmxvb3IoZGVjTWludXRlKVxuaXNvU2Vjb25kID0gTWF0aC5mbG9vcihkZWNTZWNvbmQpXG5kZWNEZWsgPSBNYXRoLmZsb29yKGRlY0RhdGUgLyAxMClcbmRlY0RvZCA9IGRlY0RhdGUgJSAxMFxuZGVjRG90bSA9IE1hdGguZmxvb3IoZGVjRGF0ZSAtICgxNTMgKiBkZWNNb3R5ICsgMikgLyA1ICsgMSlcbmRlY0RvdHkgPSBkZWNEYXRlLnRvU3RyaW5nKCkucGFkU3RhcnQoMywgXCIwXCIpXG4ifSx7Im1ldGhvZE5hbWUiOiJpbnRlcnByZXQiLCJjZWxsTmFtZSI6Im9qcy1jZWxsLTMiLCJpbmxpbmUiOmZhbHNlLCJzb3VyY2UiOiJodG1sYFxuPHN0eWxlPlxuLmNvbG9yMCB7XG4gIGJhY2tncm91bmQ6IGhzbCgwIDEwMCUgNTAlKTtcbiAgY29sb3I6ICR7eWlxKGBoc2woMCwgMTAwJSwgNTAlKWApID4gMC41MSA/IFwiYmxhY2tcIiA6IFwid2hpdGVcIn07XG4gIHBhZGRpbmc6IDBweCA1cHg7XG4gIGJvcmRlci1yYWRpdXM6IDRweDtcbiAgZm9udC13ZWlnaHQ6IDQwMDtcbiAgZm9udC1mYW1pbHk6IG1vbm9zcGFjZTtcbn1cbi5jb2xvcjEge1xuICBiYWNrZ3JvdW5kOiBoc2woMzAwIDEwMCUgNTAlKTtcbiAgY29sb3I6ICR7eWlxKGBoc2woMzAwLCAxMDAlLCA1MCUpYCkgPiAwLjUxID8gXCJibGFja1wiIDogXCJ3aGl0ZVwifTtcbiAgcGFkZGluZzogMHB4IDVweDtcbiAgYm9yZGVyLXJhZGl1czogNHB4O1xuICBmb250LXdlaWdodDogNDAwO1xuICBmb250LWZhbWlseTogbW9ub3NwYWNlO1xufVxuLmNvbG9yMiB7XG4gIGJhY2tncm91bmQ6IGhzbCgyODAgMTAwJSA1MCUpO1xuICBjb2xvcjogJHt5aXEoYGhzbCgyODAsIDEwMCUsIDUwJSlgKSA+IDAuNTEgPyBcImJsYWNrXCIgOiBcIndoaXRlXCJ9O1xuICBwYWRkaW5nOiAwcHggNXB4O1xuICBib3JkZXItcmFkaXVzOiA0cHg7XG4gIGZvbnQtd2VpZ2h0OiA0MDA7XG4gIGZvbnQtZmFtaWx5OiBtb25vc3BhY2U7XG59XG4uY29sb3IzIHtcbiAgYmFja2dyb3VuZDogaHNsKDI0MCAxMDAlIDUwJSk7XG4gIGNvbG9yOiAke3lpcShgaHNsKDI0MCwgMTAwJSwgNTAlKWApID4gMC41MSA/IFwiYmxhY2tcIiA6IFwid2hpdGVcIn07XG4gIHBhZGRpbmc6IDBweCA1cHg7XG4gIGJvcmRlci1yYWRpdXM6IDRweDtcbiAgZm9udC13ZWlnaHQ6IDQwMDtcbiAgZm9udC1mYW1pbHk6IG1vbm9zcGFjZTtcbn1cbi5jb2xvcjQge1xuICBiYWNrZ3JvdW5kOiBoc2woMjAwIDEwMCUgNTAlKTtcbiAgY29sb3I6ICR7eWlxKGBoc2woMjAwLCAxMDAlLCA1MCUpYCkgPiAwLjUxID8gXCJibGFja1wiIDogXCJ3aGl0ZVwifTtcbiAgcGFkZGluZzogMHB4IDVweDtcbiAgYm9yZGVyLXJhZGl1czogNHB4O1xuICBmb250LXdlaWdodDogNDAwO1xuICBmb250LWZhbWlseTogbW9ub3NwYWNlO1xufVxuLmNvbG9yNSB7XG4gIGJhY2tncm91bmQ6IGhzbCgxODAgMTAwJSA1MCUpO1xuICBjb2xvcjogJHt5aXEoYGhzbCgxODAsIDEwMCUsIDUwJSlgKSA+IDAuNTEgPyBcImJsYWNrXCIgOiBcIndoaXRlXCJ9O1xuICBwYWRkaW5nOiAwcHggNXB4O1xuICBib3JkZXItcmFkaXVzOiA0cHg7XG4gIGZvbnQtd2VpZ2h0OiA0MDA7XG4gIGZvbnQtZmFtaWx5OiBtb25vc3BhY2U7XG59XG4uY29sb3I2IHtcbiAgYmFja2dyb3VuZDogaHNsKDEyMCAxMDAlIDUwJSk7XG4gIGNvbG9yOiAke3lpcShgaHNsKDEyMCwgMTAwJSwgNTAlKWApID4gMC41MSA/IFwiYmxhY2tcIiA6IFwid2hpdGVcIn07XG4gIHBhZGRpbmc6IDBweCA1cHg7XG4gIGJvcmRlci1yYWRpdXM6IDRweDtcbiAgZm9udC13ZWlnaHQ6IDQwMDtcbiAgZm9udC1mYW1pbHk6IG1vbm9zcGFjZTtcbn1cbi5jb2xvcjcge1xuICBiYWNrZ3JvdW5kOiBoc2woODAgMTAwJSA1MCUpO1xuICBjb2xvcjogJHt5aXEoYGhzbCg4MCwgMTAwJSwgNTAlKWApID4gMC41MSA/IFwiYmxhY2tcIiA6IFwid2hpdGVcIn07XG4gIHBhZGRpbmc6IDBweCA1cHg7XG4gIGJvcmRlci1yYWRpdXM6IDRweDtcbiAgZm9udC13ZWlnaHQ6IDQwMDtcbiAgZm9udC1mYW1pbHk6IG1vbm9zcGFjZTtcbn1cbi5jb2xvcjgge1xuICBiYWNrZ3JvdW5kOiBoc2woNjAgMTAwJSA1MCUpO1xuICBjb2xvcjogJHt5aXEoYGhzbCg2MCwgMTAwJSwgNTAlKWApID4gMC41MSA/IFwiYmxhY2tcIiA6IFwid2hpdGVcIn07XG4gIHBhZGRpbmc6IDBweCA1cHg7XG4gIGJvcmRlci1yYWRpdXM6IDRweDtcbiAgZm9udC13ZWlnaHQ6IDQwMDtcbiAgZm9udC1mYW1pbHk6IG1vbm9zcGFjZTtcbn1cbi5jb2xvcjkge1xuICBiYWNrZ3JvdW5kOiBoc2woNDAgMTAwJSA1MCUpO1xuICBjb2xvcjogJHt5aXEoYGhzbCg0MCwgMTAwJSwgNTAlKWApID4gMC41MSA/IFwiYmxhY2tcIiA6IFwid2hpdGVcIn07XG4gIHBhZGRpbmc6IDBweCA1cHg7XG4gIGJvcmRlci1yYWRpdXM6IDRweDtcbiAgZm9udC13ZWlnaHQ6IDQwMDtcbiAgZm9udC1mYW1pbHk6IG1vbm9zcGFjZTtcbn1cbjwvc3R5bGU+XG5gXG4ifSx7Im1ldGhvZE5hbWUiOiJpbnRlcnByZXRRdWlldCIsInNvdXJjZSI6InNoaW55SW5wdXQoJ2xvY2F0aW9uJykifSx7Im1ldGhvZE5hbWUiOiJpbnRlcnByZXRRdWlldCIsInNvdXJjZSI6InNoaW55SW5wdXQoJ2ZhbmN5U2Vjb25kc09GRicpIn1dfQ==
</script>
<script type="module">
if (window.location.protocol === "file:") { alert("The OJS runtime does not work with file:// URLs. Please use a web server to view this document."); }
window._ojs.paths.runtimeToDoc = "../../dec/time";
window._ojs.paths.runtimeToRoot = "../..";
window._ojs.paths.docToRoot = "../..";
window._ojs.selfContained = false;
window._ojs.runtime.interpretFromScriptTags();
</script>
<script id="quarto-html-after-body" type="application/javascript">
  window.document.addEventListener("DOMContentLoaded", function (event) {
    // Ensure there is a toggle, if there isn't float one in the top right
    if (window.document.querySelector('.quarto-color-scheme-toggle') === null) {
      const a = window.document.createElement('a');
      a.classList.add('top-right');
      a.classList.add('quarto-color-scheme-toggle');
      a.href = "";
      a.onclick = function() { try { window.quartoToggleColorScheme(); } catch {} return false; };
      const i = window.document.createElement("i");
      i.classList.add('bi');
      a.appendChild(i);
      window.document.body.appendChild(a);
    }
    setColorSchemeToggle(hasAlternateSentinel())
    const icon = "";
    const anchorJS = new window.AnchorJS();
    anchorJS.options = {
      placement: 'right',
      icon: icon
    };
    anchorJS.add('.anchored');
    const isCodeAnnotation = (el) => {
      for (const clz of el.classList) {
        if (clz.startsWith('code-annotation-')) {                     
          return true;
        }
      }
      return false;
    }
    const onCopySuccess = function(e) {
      // button target
      const button = e.trigger;
      // don't keep focus
      button.blur();
      // flash "checked"
      button.classList.add('code-copy-button-checked');
      var currentTitle = button.getAttribute("title");
      button.setAttribute("title", "Copied!");
      let tooltip;
      if (window.bootstrap) {
        button.setAttribute("data-bs-toggle", "tooltip");
        button.setAttribute("data-bs-placement", "left");
        button.setAttribute("data-bs-title", "Copied!");
        tooltip = new bootstrap.Tooltip(button, 
          { trigger: "manual", 
            customClass: "code-copy-button-tooltip",
            offset: [0, -8]});
        tooltip.show();    
      }
      setTimeout(function() {
        if (tooltip) {
          tooltip.hide();
          button.removeAttribute("data-bs-title");
          button.removeAttribute("data-bs-toggle");
          button.removeAttribute("data-bs-placement");
        }
        button.setAttribute("title", currentTitle);
        button.classList.remove('code-copy-button-checked');
      }, 1000);
      // clear code selection
      e.clearSelection();
    }
    const getTextToCopy = function(trigger) {
        const codeEl = trigger.previousElementSibling.cloneNode(true);
        for (const childEl of codeEl.children) {
          if (isCodeAnnotation(childEl)) {
            childEl.remove();
          }
        }
        return codeEl.innerText;
    }
    const clipboard = new window.ClipboardJS('.code-copy-button:not([data-in-quarto-modal])', {
      text: getTextToCopy
    });
    clipboard.on('success', onCopySuccess);
    if (window.document.getElementById('quarto-embedded-source-code-modal')) {
      const clipboardModal = new window.ClipboardJS('.code-copy-button[data-in-quarto-modal]', {
        text: getTextToCopy,
        container: window.document.getElementById('quarto-embedded-source-code-modal')
      });
      clipboardModal.on('success', onCopySuccess);
    }
    const viewSource = window.document.getElementById('quarto-view-source') ||
                       window.document.getElementById('quarto-code-tools-source');
    if (viewSource) {
      const sourceUrl = viewSource.getAttribute("data-quarto-source-url");
      viewSource.addEventListener("click", function(e) {
        if (sourceUrl) {
          // rstudio viewer pane
          if (/\bcapabilities=\b/.test(window.location)) {
            window.open(sourceUrl);
          } else {
            window.location.href = sourceUrl;
          }
        } else {
          const modal = new bootstrap.Modal(document.getElementById('quarto-embedded-source-code-modal'));
          modal.show();
        }
        return false;
      });
    }
    function toggleCodeHandler(show) {
      return function(e) {
        const detailsSrc = window.document.querySelectorAll(".cell > details > .sourceCode");
        for (let i=0; i<detailsSrc.length; i++) {
          const details = detailsSrc[i].parentElement;
          if (show) {
            details.open = true;
          } else {
            details.removeAttribute("open");
          }
        }
        const cellCodeDivs = window.document.querySelectorAll(".cell > .sourceCode");
        const fromCls = show ? "hidden" : "unhidden";
        const toCls = show ? "unhidden" : "hidden";
        for (let i=0; i<cellCodeDivs.length; i++) {
          const codeDiv = cellCodeDivs[i];
          if (codeDiv.classList.contains(fromCls)) {
            codeDiv.classList.remove(fromCls);
            codeDiv.classList.add(toCls);
          } 
        }
        return false;
      }
    }
    const hideAllCode = window.document.getElementById("quarto-hide-all-code");
    if (hideAllCode) {
      hideAllCode.addEventListener("click", toggleCodeHandler(false));
    }
    const showAllCode = window.document.getElementById("quarto-show-all-code");
    if (showAllCode) {
      showAllCode.addEventListener("click", toggleCodeHandler(true));
    }
      var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
      var mailtoRegex = new RegExp(/^mailto:/);
        var filterRegex = new RegExp("https:\/\/maptv\.github\.io");
      var isInternal = (href) => {
          return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
      }
      // Inspect non-navigation links and adorn them if external
     var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
      for (var i=0; i<links.length; i++) {
        const link = links[i];
        if (!isInternal(link.href)) {
          // undo the damage that might have been done by quarto-nav.js in the case of
          // links that we want to consider external
          if (link.dataset.originalHref !== undefined) {
            link.href = link.dataset.originalHref;
          }
            // target, if specified
            link.setAttribute("target", "_blank");
            if (link.getAttribute("rel") === null) {
              link.setAttribute("rel", "noopener");
            }
        }
      }
    function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
      const config = {
        allowHTML: true,
        maxWidth: 500,
        delay: 100,
        arrow: false,
        appendTo: function(el) {
            return el.parentElement;
        },
        interactive: true,
        interactiveBorder: 10,
        theme: 'quarto',
        placement: 'bottom-start',
      };
      if (contentFn) {
        config.content = contentFn;
      }
      if (onTriggerFn) {
        config.onTrigger = onTriggerFn;
      }
      if (onUntriggerFn) {
        config.onUntrigger = onUntriggerFn;
      }
      window.tippy(el, config); 
    }
    const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
    for (var i=0; i<noterefs.length; i++) {
      const ref = noterefs[i];
      tippyHover(ref, function() {
        // use id or data attribute instead here
        let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
        try { href = new URL(href).hash; } catch {}
        const id = href.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note) {
          return note.innerHTML;
        } else {
          return "";
        }
      });
    }
    const xrefs = window.document.querySelectorAll('a.quarto-xref');
    const processXRef = (id, note) => {
      // Strip column container classes
      const stripColumnClz = (el) => {
        el.classList.remove("page-full", "page-columns");
        if (el.children) {
          for (const child of el.children) {
            stripColumnClz(child);
          }
        }
      }
      stripColumnClz(note)
      if (id === null || id.startsWith('sec-')) {
        // Special case sections, only their first couple elements
        const container = document.createElement("div");
        if (note.children && note.children.length > 2) {
          container.appendChild(note.children[0].cloneNode(true));
          for (let i = 1; i < note.children.length; i++) {
            const child = note.children[i];
            if (child.tagName === "P" && child.innerText === "") {
              continue;
            } else {
              container.appendChild(child.cloneNode(true));
              break;
            }
          }
          if (window.Quarto?.typesetMath) {
            window.Quarto.typesetMath(container);
          }
          return container.innerHTML
        } else {
          if (window.Quarto?.typesetMath) {
            window.Quarto.typesetMath(note);
          }
          return note.innerHTML;
        }
      } else {
        // Remove any anchor links if they are present
        const anchorLink = note.querySelector('a.anchorjs-link');
        if (anchorLink) {
          anchorLink.remove();
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        if (note.classList.contains("callout")) {
          return note.outerHTML;
        } else {
          return note.innerHTML;
        }
      }
    }
    for (var i=0; i<xrefs.length; i++) {
      const xref = xrefs[i];
      tippyHover(xref, undefined, function(instance) {
        instance.disable();
        let url = xref.getAttribute('href');
        let hash = undefined; 
        if (url.startsWith('#')) {
          hash = url;
        } else {
          try { hash = new URL(url).hash; } catch {}
        }
        if (hash) {
          const id = hash.replace(/^#\/?/, "");
          const note = window.document.getElementById(id);
          if (note !== null) {
            try {
              const html = processXRef(id, note.cloneNode(true));
              instance.setContent(html);
            } finally {
              instance.enable();
              instance.show();
            }
          } else {
            // See if we can fetch this
            fetch(url.split('#')[0])
            .then(res => res.text())
            .then(html => {
              const parser = new DOMParser();
              const htmlDoc = parser.parseFromString(html, "text/html");
              const note = htmlDoc.getElementById(id);
              if (note !== null) {
                const html = processXRef(id, note);
                instance.setContent(html);
              } 
            }).finally(() => {
              instance.enable();
              instance.show();
            });
          }
        } else {
          // See if we can fetch a full url (with no hash to target)
          // This is a special case and we should probably do some content thinning / targeting
          fetch(url)
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.querySelector('main.content');
            if (note !== null) {
              // This should only happen for chapter cross references
              // (since there is no id in the URL)
              // remove the first header
              if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
                note.children[0].remove();
              }
              const html = processXRef(null, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      }, function(instance) {
      });
    }
        let selectedAnnoteEl;
        const selectorForAnnotation = ( cell, annotation) => {
          let cellAttr = 'data-code-cell="' + cell + '"';
          let lineAttr = 'data-code-annotation="' +  annotation + '"';
          const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
          return selector;
        }
        const selectCodeLines = (annoteEl) => {
          const doc = window.document;
          const targetCell = annoteEl.getAttribute("data-target-cell");
          const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
          const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
          const lines = annoteSpan.getAttribute("data-code-lines").split(",");
          const lineIds = lines.map((line) => {
            return targetCell + "-" + line;
          })
          let top = null;
          let height = null;
          let parent = null;
          if (lineIds.length > 0) {
              //compute the position of the single el (top and bottom and make a div)
              const el = window.document.getElementById(lineIds[0]);
              top = el.offsetTop;
              height = el.offsetHeight;
              parent = el.parentElement.parentElement;
            if (lineIds.length > 1) {
              const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
              const bottom = lastEl.offsetTop + lastEl.offsetHeight;
              height = bottom - top;
            }
            if (top !== null && height !== null && parent !== null) {
              // cook up a div (if necessary) and position it 
              let div = window.document.getElementById("code-annotation-line-highlight");
              if (div === null) {
                div = window.document.createElement("div");
                div.setAttribute("id", "code-annotation-line-highlight");
                div.style.position = 'absolute';
                parent.appendChild(div);
              }
              div.style.top = top - 2 + "px";
              div.style.height = height + 4 + "px";
              div.style.left = 0;
              let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
              if (gutterDiv === null) {
                gutterDiv = window.document.createElement("div");
                gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
                gutterDiv.style.position = 'absolute';
                const codeCell = window.document.getElementById(targetCell);
                const gutter = codeCell.querySelector('.code-annotation-gutter');
                gutter.appendChild(gutterDiv);
              }
              gutterDiv.style.top = top - 2 + "px";
              gutterDiv.style.height = height + 4 + "px";
            }
            selectedAnnoteEl = annoteEl;
          }
        };
        const unselectCodeLines = () => {
          const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
          elementsIds.forEach((elId) => {
            const div = window.document.getElementById(elId);
            if (div) {
              div.remove();
            }
          });
          selectedAnnoteEl = undefined;
        };
          // Handle positioning of the toggle
      window.addEventListener(
        "resize",
        throttle(() => {
          elRect = undefined;
          if (selectedAnnoteEl) {
            selectCodeLines(selectedAnnoteEl);
          }
        }, 10)
      );
      function throttle(fn, ms) {
      let throttle = false;
      let timer;
        return (...args) => {
          if(!throttle) { // first call gets through
              fn.apply(this, args);
              throttle = true;
          } else { // all the others get throttled
              if(timer) clearTimeout(timer); // cancel #2
              timer = setTimeout(() => {
                fn.apply(this, args);
                timer = throttle = false;
              }, ms);
          }
        };
      }
        // Attach click handler to the DT
        const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
        for (const annoteDlNode of annoteDls) {
          annoteDlNode.addEventListener('click', (event) => {
            const clickedEl = event.target;
            if (clickedEl !== selectedAnnoteEl) {
              unselectCodeLines();
              const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
              if (activeEl) {
                activeEl.classList.remove('code-annotation-active');
              }
              selectCodeLines(clickedEl);
              clickedEl.classList.add('code-annotation-active');
            } else {
              // Unselect the line
              unselectCodeLines();
              clickedEl.classList.remove('code-annotation-active');
            }
          });
        }
    const findCites = (el) => {
      const parentEl = el.parentElement;
      if (parentEl) {
        const cites = parentEl.dataset.cites;
        if (cites) {
          return {
            el,
            cites: cites.split(' ')
          };
        } else {
          return findCites(el.parentElement)
        }
      } else {
        return undefined;
      }
    };
    var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
    for (var i=0; i<bibliorefs.length; i++) {
      const ref = bibliorefs[i];
      const citeInfo = findCites(ref);
      if (citeInfo) {
        tippyHover(citeInfo.el, function() {
          var popup = window.document.createElement('div');
          citeInfo.cites.forEach(function(cite) {
            var citeDiv = window.document.createElement('div');
            citeDiv.classList.add('hanging-indent');
            citeDiv.classList.add('csl-entry');
            var biblioDiv = window.document.getElementById('ref-' + cite);
            if (biblioDiv) {
              citeDiv.innerHTML = biblioDiv.innerHTML;
            }
            popup.appendChild(citeDiv);
          });
          return popup.innerHTML;
        });
      }
    }
  });
  </script>
<nav class="page-navigation column-body">
  <div class="nav-page nav-page-previous">
      <a href="../../dec/date/index.html" class="pagination-link" aria-label="Date">
        <i class="bi bi-arrow-left-short"></i> <span class="nav-page-text">Date</span>
      </a>          
  </div>
  <div class="nav-page nav-page-next">
      <a href="../../dec/snap/index.html" class="pagination-link" aria-label="Snap">
        <span class="nav-page-text">Snap</span> <i class="bi bi-arrow-right-short"></i>
      </a>
  </div>
</nav><div class="modal fade" id="quarto-embedded-source-code-modal" tabindex="-1" aria-labelledby="quarto-embedded-source-code-modal-label" aria-hidden="true"><div class="modal-dialog modal-dialog-scrollable"><div class="modal-content"><div class="modal-header"><h5 class="modal-title" id="quarto-embedded-source-code-modal-label">Source Code</h5><button class="btn-close" data-bs-dismiss="modal"></button></div><div class="modal-body"><div class="">
<div class="sourceCode" id="cb5" data-shortcodes="false"><pre class="sourceCode markdown code-with-copy"><code class="sourceCode markdown"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a><span class="co">---</span></span>
<span id="cb5-2"><a href="#cb5-2" aria-hidden="true" tabindex="-1"></a><span class="an">title:</span><span class="co"> Dec Time</span></span>
<span id="cb5-3"><a href="#cb5-3" aria-hidden="true" tabindex="-1"></a><span class="an">author:</span></span>
<span id="cb5-4"><a href="#cb5-4" aria-hidden="true" tabindex="-1"></a><span class="co">  - name: Martin Laptev</span></span>
<span id="cb5-5"><a href="#cb5-5" aria-hidden="true" tabindex="-1"></a><span class="co">    url: https://maptv.github.io</span></span>
<span id="cb5-6"><a href="#cb5-6" aria-hidden="true" tabindex="-1"></a><span class="an">image:</span><span class="co"> /asset/daywide.svg</span></span>
<span id="cb5-7"><a href="#cb5-7" aria-hidden="true" tabindex="-1"></a><span class="an">description:</span><span class="co"> &gt;</span></span>
<span id="cb5-8"><a href="#cb5-8" aria-hidden="true" tabindex="-1"></a><span class="co">  Introducing Declock, a timekeeping system that displays time in decimal days using math notation without the need for hours, minutes, or seconds.</span></span>
<span id="cb5-9"><a href="#cb5-9" aria-hidden="true" tabindex="-1"></a><span class="an">draft:</span><span class="co"> true</span></span>
<span id="cb5-10"><a href="#cb5-10" aria-hidden="true" tabindex="-1"></a><span class="an">citation:</span></span>
<span id="cb5-11"><a href="#cb5-11" aria-hidden="true" tabindex="-1"></a><span class="co">  url: https://maptv.github.io/dec/time</span></span>
<span id="cb5-12"><a href="#cb5-12" aria-hidden="true" tabindex="-1"></a><span class="an">aliases:</span></span>
<span id="cb5-13"><a href="#cb5-13" aria-hidden="true" tabindex="-1"></a><span class="co">  - /dec/time</span></span>
<span id="cb5-14"><a href="#cb5-14" aria-hidden="true" tabindex="-1"></a><span class="co">  - /d/t</span></span>
<span id="cb5-15"><a href="#cb5-15" aria-hidden="true" tabindex="-1"></a><span class="co">  - /time</span></span>
<span id="cb5-16"><a href="#cb5-16" aria-hidden="true" tabindex="-1"></a><span class="co">  - /t</span></span>
<span id="cb5-17"><a href="#cb5-17" aria-hidden="true" tabindex="-1"></a><span class="an">license:</span><span class="co"> CC BY-SA</span></span>
<span id="cb5-18"><a href="#cb5-18" aria-hidden="true" tabindex="-1"></a><span class="an">lightbox:</span><span class="co"> false</span></span>
<span id="cb5-19"><a href="#cb5-19" aria-hidden="true" tabindex="-1"></a><span class="an">toc:</span><span class="co"> true</span></span>
<span id="cb5-20"><a href="#cb5-20" aria-hidden="true" tabindex="-1"></a><span class="an">toc-depth:</span><span class="co"> 4</span></span>
<span id="cb5-21"><a href="#cb5-21" aria-hidden="true" tabindex="-1"></a><span class="an">bread-crumbs:</span><span class="co"> false</span></span>
<span id="cb5-22"><a href="#cb5-22" aria-hidden="true" tabindex="-1"></a><span class="an">format:</span></span>
<span id="cb5-23"><a href="#cb5-23" aria-hidden="true" tabindex="-1"></a><span class="co">  html:</span></span>
<span id="cb5-24"><a href="#cb5-24" aria-hidden="true" tabindex="-1"></a><span class="co">    grid:</span></span>
<span id="cb5-25"><a href="#cb5-25" aria-hidden="true" tabindex="-1"></a><span class="co">      body-width: 850px</span></span>
<span id="cb5-26"><a href="#cb5-26" aria-hidden="true" tabindex="-1"></a><span class="co">    shift-heading-level-by: 3</span></span>
<span id="cb5-27"><a href="#cb5-27" aria-hidden="true" tabindex="-1"></a><span class="co">    include-after-body:</span></span>
<span id="cb5-28"><a href="#cb5-28" aria-hidden="true" tabindex="-1"></a><span class="co">      - ../../asset/cite.html</span></span>
<span id="cb5-29"><a href="#cb5-29" aria-hidden="true" tabindex="-1"></a><span class="co">      - ../../asset/style.html</span></span>
<span id="cb5-30"><a href="#cb5-30" aria-hidden="true" tabindex="-1"></a><span class="co">      - ../../asset/stamp.html</span></span>
<span id="cb5-31"><a href="#cb5-31" aria-hidden="true" tabindex="-1"></a><span class="co">      - ../../asset/tooltip.html</span></span>
<span id="cb5-32"><a href="#cb5-32" aria-hidden="true" tabindex="-1"></a><span class="co">  commonmark: default</span></span>
<span id="cb5-33"><a href="#cb5-33" aria-hidden="true" tabindex="-1"></a><span class="an">filters:</span></span>
<span id="cb5-34"><a href="#cb5-34" aria-hidden="true" tabindex="-1"></a><span class="co">  - ../../asset/date.lua</span></span>
<span id="cb5-35"><a href="#cb5-35" aria-hidden="true" tabindex="-1"></a><span class="co">---</span></span>
<span id="cb5-36"><a href="#cb5-36" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-39"><a href="#cb5-39" aria-hidden="true" tabindex="-1"></a><span class="in">```{mermaid}</span></span>
<span id="cb5-40"><a href="#cb5-40" aria-hidden="true" tabindex="-1"></a>%%| label: timenav</span>
<span id="cb5-41"><a href="#cb5-41" aria-hidden="true" tabindex="-1"></a>%<span class="dt">%</span>{init: {<span class="ot">'</span><span class="ss">theme</span><span class="ot">'</span>: <span class="ot">'</span><span class="ss">default</span><span class="ot">'</span>, <span class="ot">'</span><span class="ss">themeVariables</span><span class="ot">'</span>: { <span class="ot">'</span><span class="ss">fontSize</span><span class="ot">'</span>: <span class="ot">'</span><span class="ss">32px</span><span class="ot">'</span>}}}%%</span>
<span id="cb5-42"><a href="#cb5-42" aria-hidden="true" tabindex="-1"></a>flowchart LR</span>
<span id="cb5-43"><a href="#cb5-43" aria-hidden="true" tabindex="-1"></a>   A[Dec]--&gt;B[date]--&gt;C[<span class="fu">time</span>]--&gt;D[snap]--&gt;E[span]</span>
<span id="cb5-44"><a href="#cb5-44" aria-hidden="true" tabindex="-1"></a>   click A <span class="ot">"</span><span class="st">/dec</span><span class="ot">"</span></span>
<span id="cb5-45"><a href="#cb5-45" aria-hidden="true" tabindex="-1"></a>   click B <span class="ot">"</span><span class="st">/dec/date</span><span class="ot">"</span></span>
<span id="cb5-46"><a href="#cb5-46" aria-hidden="true" tabindex="-1"></a>   click C <span class="ot">"</span><span class="st">/dec/time</span><span class="ot">"</span></span>
<span id="cb5-47"><a href="#cb5-47" aria-hidden="true" tabindex="-1"></a>   click D <span class="ot">"</span><span class="st">/dec/snap</span><span class="ot">"</span></span>
<span id="cb5-48"><a href="#cb5-48" aria-hidden="true" tabindex="-1"></a>   click E <span class="ot">"</span><span class="st">/dec/span</span><span class="ot">"</span></span>
<span id="cb5-49"><a href="#cb5-49" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb5-50"><a href="#cb5-50" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-51"><a href="#cb5-51" aria-hidden="true" tabindex="-1"></a><span class="fu"># Day of year (doy) {.hiddenheading #tod}</span></span>
<span id="cb5-52"><a href="#cb5-52" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-53"><a href="#cb5-53" aria-hidden="true" tabindex="-1"></a>My website provides many examples of the <span class="co">[</span><span class="ot">Quarto</span><span class="co">](https://quarto.org)</span> publishing and the <span class="co">[</span><span class="ot">Dec</span><span class="co">](/dec)</span> measurement systems in action. I leverage Quarto support for the <span class="co">[</span><span class="ot">Observable</span><span class="co">](https://observablehq.com/)</span> data analysis and visualization system to create animated and interactive graphics like the clocks🕓and bar📊charts below, which display the Dec time in the Dec time zone, <span class="co">[</span><span class="ot">\${selectedZone}</span><span class="co">]</span>{.lime}, selected by the red⭕️circle on the <span class="co">[</span><span class="ot">solar☀️terminator</span><span class="co">](https://en.wikipedia.org/wiki/Terminator_%28solar%29#:~:text=a%20moving%20line%20that%20divides%20the%20daylit%20side%20and%20the%20dark%20night%20side%20of%20a%20planetary%20body)</span> map🗺️beneath the bars📊.</span>
<span id="cb5-54"><a href="#cb5-54" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-55"><a href="#cb5-55" aria-hidden="true" tabindex="-1"></a>like the one on the left side of the <span class="co">[</span><span class="ot">navigation bar</span><span class="co">](https://en.wikipedia.org/wiki/Navigation_bar#:~:text=a%20section%20of%20a%20graphical%20user%20interface%20intended%20to%20aid%20visitors%20in%20accessing%20information)</span> (navbar) above.</span>
<span id="cb5-56"><a href="#cb5-56" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-57"><a href="#cb5-57" aria-hidden="true" tabindex="-1"></a>Dec times consist of a time-of-day (<span class="co">[</span><span class="ot">tod</span><span class="co">]</span>{.under .tool data-bs-toggle="tooltip" data-bs-title="time-of-day"}) and a time zone. The <span class="co">[</span><span class="ot">tod</span><span class="co">]</span>{.under .tool data-bs-toggle="tooltip" data-bs-title="time-of-day"} can be obtained from either a day-of-year (<span class="co">[</span><span class="ot">doy</span><span class="co">]</span>{.under .tool data-bs-toggle="tooltip" data-bs-title="day-of-year"}) or a day-of-era (<span class="co">[</span><span class="ot">doe</span><span class="co">]</span>{.under .tool data-bs-toggle="tooltip" data-bs-title="day-of-era"}). To get the <span class="co">[</span><span class="ot">tod</span><span class="co">]</span>{.under .tool data-bs-toggle="tooltip" data-bs-title="time-of-day"} in <span class="co">[</span><span class="ot">fractional days</span><span class="co">](https://en.wikipedia.org/wiki/Decimal_time#Fractional_days:~:text=a%20decimal%20fraction%20of%20a%20day)</span>, we divide by one and keep remainder: <span class="co">[</span><span class="ot">d</span><span class="co">]</span>{.cyan} <span class="co">[</span><span class="ot">mod</span><span class="co">](https://en.wikipedia.org/wiki/Modulo#:~:text=returns%20the%20remainder)</span> 1 = <span class="co">[</span><span class="ot">t</span><span class="co">]</span>{.cyan}. In the times below clocks and on the bar charts, the tod and time zone are both in <span class="co">[</span><span class="ot">decidays</span><span class="co">](https://en.wikipedia.org/wiki/Decimal_time#:~:text=dividing%20the%20day%20into%2010%20decidays)</span>{.under .tool data-bs-toggle="tooltip" data-bs-title="tenths of a day"}: <span class="co">[</span><span class="ot">d</span><span class="co">]</span>{.cyan} <span class="dv">&amp;times;</span> 10 <span class="co">[</span><span class="ot">mod</span><span class="co">](https://en.wikipedia.org/wiki/Modulo#:~:text=returns%20the%20remainder)</span> 10 = <span class="co">[</span><span class="ot">t</span><span class="co">]</span>{.cyan}.</span>
<span id="cb5-58"><a href="#cb5-58" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-59"><a href="#cb5-59" aria-hidden="true" tabindex="-1"></a><span class="fu"># Time of day (tod) {.hiddenheading #tod}</span></span>
<span id="cb5-60"><a href="#cb5-60" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-61"><a href="#cb5-61" aria-hidden="true" tabindex="-1"></a>Dec times are measured in <span class="co">[</span><span class="ot">fractional days</span><span class="co">](https://en.wikipedia.org/wiki/Decimal_time#Fractional_days:~:text=a%20decimal%20fraction%20of%20a%20day)</span>. The shortest, longest, and thinnest clock🕓hands and the top, middle, and bottom bars📊indicate the <span class="co">[</span><span class="ot">decidays</span><span class="co">](https://en.wikipedia.org/wiki/Decimal_time#:~:text=dividing%20the%20day%20into%2010%20decidays)</span>{.under .tool data-bs-toggle="tooltip" data-bs-title="tenths of a day"}, <span class="co">[</span><span class="ot">millidays</span><span class="co">]</span>{.under .tool data-bs-toggle="tooltip" data-bs-title="thousandths of a day"}, and <span class="co">[</span><span class="ot">centimillidays</span><span class="co">]</span>{.under .tool data-bs-toggle="tooltip" data-bs-title="hundred thousandths of a day"}, respectively, of the time since the start, <span class="co">[</span><span class="ot">+\${decTime}</span><span class="co">]</span>{.cyan}, or until the end, <span class="co">[</span><span class="ot">-\${decTimeN}</span><span class="co">]</span>{.pink}, of the day in the </span>
<span id="cb5-62"><a href="#cb5-62" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-63"><a href="#cb5-63" aria-hidden="true" tabindex="-1"></a>:::{.clocks}</span>
<span id="cb5-64"><a href="#cb5-64" aria-hidden="true" tabindex="-1"></a>\${clock}\${clock1}</span>
<span id="cb5-65"><a href="#cb5-65" aria-hidden="true" tabindex="-1"></a>:::</span>
<span id="cb5-66"><a href="#cb5-66" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-69"><a href="#cb5-69" aria-hidden="true" tabindex="-1"></a><span class="in">```{ojs}</span></span>
<span id="cb5-70"><a href="#cb5-70" aria-hidden="true" tabindex="-1"></a><span class="co">//| echo: false</span></span>
<span id="cb5-71"><a href="#cb5-71" aria-hidden="true" tabindex="-1"></a><span class="co">// https://observablehq.com/@fheyen/barchart-clock</span></span>
<span id="cb5-72"><a href="#cb5-72" aria-hidden="true" tabindex="-1"></a>barChart <span class="op">=</span> {</span>
<span id="cb5-73"><a href="#cb5-73" aria-hidden="true" tabindex="-1"></a><span class="kw">const</span> W <span class="op">=</span> width<span class="op">;</span></span>
<span id="cb5-74"><a href="#cb5-74" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> H <span class="op">=</span> <span class="dv">88</span><span class="op">;</span></span>
<span id="cb5-75"><a href="#cb5-75" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> barX <span class="op">=</span> <span class="dv">1</span><span class="op">;</span></span>
<span id="cb5-76"><a href="#cb5-76" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> firstBarY <span class="op">=</span> <span class="dv">1</span><span class="op">;</span></span>
<span id="cb5-77"><a href="#cb5-77" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> svg <span class="op">=</span> d3</span>
<span id="cb5-78"><a href="#cb5-78" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">create</span>(<span class="st">"svg"</span>)</span>
<span id="cb5-79"><a href="#cb5-79" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">"width"</span><span class="op">,</span> W)</span>
<span id="cb5-80"><a href="#cb5-80" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">"viewBox"</span><span class="op">,</span> [<span class="dv">0</span><span class="op">,</span> <span class="dv">0</span><span class="op">,</span> W <span class="op">*</span> (W <span class="op">&lt;</span> <span class="dv">370</span> <span class="op">?</span> <span class="op">.</span><span class="dv">73</span> <span class="op">:</span> W <span class="op">&lt;</span> <span class="dv">420</span> <span class="op">?</span> <span class="op">.</span><span class="dv">76</span> <span class="op">:</span> W <span class="op">&lt;</span> <span class="dv">470</span> <span class="op">?</span> <span class="op">.</span><span class="dv">79</span> <span class="op">:</span> W <span class="op">&lt;</span> <span class="dv">520</span> <span class="op">?</span> <span class="op">.</span><span class="dv">81</span> <span class="op">:</span> W <span class="op">&lt;</span> <span class="dv">570</span> <span class="op">?</span> <span class="op">.</span><span class="dv">83</span> <span class="op">:</span> W <span class="op">&lt;</span> <span class="dv">620</span> <span class="op">?</span> <span class="op">.</span><span class="dv">84</span> <span class="op">:</span> W <span class="op">&lt;</span> <span class="dv">670</span> <span class="op">?</span> <span class="op">.</span><span class="dv">85</span> <span class="op">:</span> W <span class="op">&lt;</span> <span class="dv">720</span> <span class="op">?</span> <span class="op">.</span><span class="dv">86</span> <span class="op">:</span> <span class="op">.</span><span class="dv">87</span>)<span class="op">,</span> H])<span class="op">;</span></span>
<span id="cb5-81"><a href="#cb5-81" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> xRange <span class="op">=</span> [<span class="dv">0</span><span class="op">,</span> W <span class="op">-</span> <span class="dv">100</span>]<span class="op">;</span></span>
<span id="cb5-82"><a href="#cb5-82" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> scaleDD <span class="op">=</span> d3<span class="op">.</span><span class="fu">scaleLinear</span>()</span>
<span id="cb5-83"><a href="#cb5-83" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">domain</span>([<span class="dv">0</span><span class="op">,</span> <span class="dv">10</span>])</span>
<span id="cb5-84"><a href="#cb5-84" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">range</span>(xRange)<span class="op">;</span></span>
<span id="cb5-85"><a href="#cb5-85" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> scaleMandB <span class="op">=</span> d3<span class="op">.</span><span class="fu">scaleLinear</span>()</span>
<span id="cb5-86"><a href="#cb5-86" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">domain</span>([<span class="dv">0</span><span class="op">,</span> <span class="dv">100</span>])</span>
<span id="cb5-87"><a href="#cb5-87" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">range</span>(xRange)<span class="op">;</span></span>
<span id="cb5-88"><a href="#cb5-88" aria-hidden="true" tabindex="-1"></a>  <span class="co">// Background bars to show where 100% lies</span></span>
<span id="cb5-89"><a href="#cb5-89" aria-hidden="true" tabindex="-1"></a>  svg<span class="op">.</span><span class="fu">selectAll</span>(<span class="st">'.background'</span>)</span>
<span id="cb5-90"><a href="#cb5-90" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">data</span>([</span>
<span id="cb5-91"><a href="#cb5-91" aria-hidden="true" tabindex="-1"></a>      <span class="st">'dd'</span><span class="op">,</span> <span class="st">"mils"</span><span class="op">,</span> <span class="st">'beats'</span>])</span>
<span id="cb5-92"><a href="#cb5-92" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">enter</span>()</span>
<span id="cb5-93"><a href="#cb5-93" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">append</span>(<span class="st">'rect'</span>)</span>
<span id="cb5-94"><a href="#cb5-94" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">'class'</span><span class="op">,</span> <span class="st">'background timeBar'</span>)</span>
<span id="cb5-95"><a href="#cb5-95" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">'width'</span><span class="op">,</span> W<span class="op">-</span><span class="dv">100</span>)</span>
<span id="cb5-96"><a href="#cb5-96" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">'y'</span><span class="op">,</span> (d<span class="op">,</span>i)<span class="kw">=&gt;</span>i<span class="op">*</span><span class="dv">30</span><span class="op">+</span>firstBarY)</span>
<span id="cb5-97"><a href="#cb5-97" aria-hidden="true" tabindex="-1"></a>  <span class="co">// Beats</span></span>
<span id="cb5-98"><a href="#cb5-98" aria-hidden="true" tabindex="-1"></a>  svg</span>
<span id="cb5-99"><a href="#cb5-99" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">append</span>(<span class="st">'rect'</span>)</span>
<span id="cb5-100"><a href="#cb5-100" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">'class'</span><span class="op">,</span> <span class="st">'timeBar'</span>)</span>
<span id="cb5-101"><a href="#cb5-101" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">'y'</span><span class="op">,</span> firstBarY<span class="op">+</span><span class="dv">60</span>)</span>
<span id="cb5-102"><a href="#cb5-102" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">'width'</span><span class="op">,</span> d <span class="kw">=&gt;</span> <span class="fu">scaleMandB</span>(<span class="bu">Number</span>(barBeats)))</span>
<span id="cb5-103"><a href="#cb5-103" aria-hidden="true" tabindex="-1"></a>  svg</span>
<span id="cb5-104"><a href="#cb5-104" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">append</span>(<span class="st">'rect'</span>)</span>
<span id="cb5-105"><a href="#cb5-105" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">'class'</span><span class="op">,</span> <span class="st">'timeBarFull'</span>)</span>
<span id="cb5-106"><a href="#cb5-106" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">'y'</span><span class="op">,</span> firstBarY<span class="op">+</span><span class="dv">60</span>)</span>
<span id="cb5-107"><a href="#cb5-107" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">'width'</span><span class="op">,</span> d <span class="kw">=&gt;</span> <span class="fu">scaleMandB</span>(barBeats))</span>
<span id="cb5-108"><a href="#cb5-108" aria-hidden="true" tabindex="-1"></a>  <span class="co">// Cents/Mils</span></span>
<span id="cb5-109"><a href="#cb5-109" aria-hidden="true" tabindex="-1"></a>  svg</span>
<span id="cb5-110"><a href="#cb5-110" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">append</span>(<span class="st">'rect'</span>)</span>
<span id="cb5-111"><a href="#cb5-111" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">'class'</span><span class="op">,</span> <span class="st">'timeBar'</span>)</span>
<span id="cb5-112"><a href="#cb5-112" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">'y'</span><span class="op">,</span> firstBarY)</span>
<span id="cb5-113"><a href="#cb5-113" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">'width'</span><span class="op">,</span> d <span class="kw">=&gt;</span> <span class="fu">scaleDD</span>(<span class="bu">Number</span>(barDD)<span class="op">+</span><span class="bu">Number</span>(barMils)<span class="op">/</span><span class="dv">100</span><span class="op">+</span><span class="bu">Number</span>(barBeats)<span class="op">/</span><span class="dv">10000</span>))</span>
<span id="cb5-114"><a href="#cb5-114" aria-hidden="true" tabindex="-1"></a>  svg</span>
<span id="cb5-115"><a href="#cb5-115" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">append</span>(<span class="st">'rect'</span>)</span>
<span id="cb5-116"><a href="#cb5-116" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">'class'</span><span class="op">,</span> <span class="st">'timeBarFull'</span>)</span>
<span id="cb5-117"><a href="#cb5-117" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">'y'</span><span class="op">,</span> firstBarY)</span>
<span id="cb5-118"><a href="#cb5-118" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">'width'</span><span class="op">,</span> d <span class="kw">=&gt;</span> <span class="fu">scaleDD</span>(barDD))</span>
<span id="cb5-119"><a href="#cb5-119" aria-hidden="true" tabindex="-1"></a>  svg</span>
<span id="cb5-120"><a href="#cb5-120" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">append</span>(<span class="st">'rect'</span>)</span>
<span id="cb5-121"><a href="#cb5-121" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">'class'</span><span class="op">,</span> <span class="st">'timeBar'</span>)</span>
<span id="cb5-122"><a href="#cb5-122" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">'y'</span><span class="op">,</span> firstBarY<span class="op">+</span><span class="dv">30</span>)</span>
<span id="cb5-123"><a href="#cb5-123" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">'width'</span><span class="op">,</span> d <span class="kw">=&gt;</span> <span class="fu">scaleMandB</span>(<span class="bu">Number</span>(barMils)<span class="op">+</span><span class="bu">Number</span>(barBeats)<span class="op">/</span><span class="dv">100</span>))</span>
<span id="cb5-124"><a href="#cb5-124" aria-hidden="true" tabindex="-1"></a>  svg</span>
<span id="cb5-125"><a href="#cb5-125" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">append</span>(<span class="st">'rect'</span>)</span>
<span id="cb5-126"><a href="#cb5-126" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">'class'</span><span class="op">,</span> <span class="st">'timeBarFull'</span>)</span>
<span id="cb5-127"><a href="#cb5-127" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">'y'</span><span class="op">,</span> firstBarY<span class="op">+</span><span class="dv">30</span>)</span>
<span id="cb5-128"><a href="#cb5-128" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">'width'</span><span class="op">,</span> d <span class="kw">=&gt;</span> <span class="fu">scaleMandB</span>(barMils))</span>
<span id="cb5-129"><a href="#cb5-129" aria-hidden="true" tabindex="-1"></a>  <span class="co">// Cent ticks</span></span>
<span id="cb5-130"><a href="#cb5-130" aria-hidden="true" tabindex="-1"></a>  svg<span class="op">.</span><span class="fu">selectAll</span>(<span class="st">'.tickC'</span>)</span>
<span id="cb5-131"><a href="#cb5-131" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">data</span>(d3<span class="op">.</span><span class="fu">range</span>(width <span class="op">&gt;</span> <span class="dv">500</span> <span class="op">?</span> <span class="dv">10</span> <span class="op">:</span> <span class="dv">10</span><span class="op">,</span> <span class="dv">100</span>))</span>
<span id="cb5-132"><a href="#cb5-132" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">enter</span>()</span>
<span id="cb5-133"><a href="#cb5-133" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">append</span>(<span class="st">'rect'</span>)</span>
<span id="cb5-134"><a href="#cb5-134" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">'class'</span><span class="op">,</span> <span class="st">'tickC'</span>)</span>
<span id="cb5-135"><a href="#cb5-135" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">'x'</span><span class="op">,</span> d<span class="kw">=&gt;</span><span class="fu">scaleDD</span>(d<span class="op">/</span><span class="dv">10</span>)<span class="op">+</span>barX)</span>
<span id="cb5-136"><a href="#cb5-136" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">'y'</span><span class="op">,</span> firstBarY<span class="op">+</span><span class="dv">30</span>)</span>
<span id="cb5-137"><a href="#cb5-137" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">'height'</span><span class="op">,</span> d<span class="kw">=&gt;</span>d<span class="op">%</span><span class="dv">2</span><span class="op">===</span><span class="dv">0</span><span class="op">?</span> <span class="dv">8</span><span class="op">:</span><span class="dv">5</span>)</span>
<span id="cb5-138"><a href="#cb5-138" aria-hidden="true" tabindex="-1"></a>  svg<span class="op">.</span><span class="fu">selectAll</span>(<span class="st">'.tickB1'</span>)</span>
<span id="cb5-139"><a href="#cb5-139" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">data</span>(d3<span class="op">.</span><span class="fu">range</span>(width <span class="op">&gt;</span> <span class="dv">500</span> <span class="op">?</span> <span class="dv">10</span> <span class="op">:</span> <span class="dv">10</span><span class="op">,</span> <span class="dv">100</span>))</span>
<span id="cb5-140"><a href="#cb5-140" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">enter</span>()</span>
<span id="cb5-141"><a href="#cb5-141" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">append</span>(<span class="st">'rect'</span>)</span>
<span id="cb5-142"><a href="#cb5-142" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">'class'</span><span class="op">,</span> <span class="st">'tickB1'</span>)</span>
<span id="cb5-143"><a href="#cb5-143" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">'x'</span><span class="op">,</span> d<span class="kw">=&gt;</span><span class="fu">scaleDD</span>(d<span class="op">/</span><span class="dv">10</span>)<span class="op">+</span>barX)</span>
<span id="cb5-144"><a href="#cb5-144" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">'y'</span><span class="op">,</span> d<span class="kw">=&gt;</span>d<span class="op">%</span><span class="dv">2</span><span class="op">===</span><span class="dv">0</span><span class="op">?</span> firstBarY<span class="op">+</span><span class="dv">77</span><span class="op">:</span>firstBarY<span class="op">+</span><span class="dv">80</span>)</span>
<span id="cb5-145"><a href="#cb5-145" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">'height'</span><span class="op">,</span> d<span class="kw">=&gt;</span>d<span class="op">%</span><span class="dv">2</span><span class="op">===</span><span class="dv">0</span><span class="op">?</span> <span class="dv">8</span><span class="op">:</span><span class="dv">5</span>)</span>
<span id="cb5-146"><a href="#cb5-146" aria-hidden="true" tabindex="-1"></a>  svg<span class="op">.</span><span class="fu">selectAll</span>(<span class="st">'.tickC1'</span>)</span>
<span id="cb5-147"><a href="#cb5-147" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">data</span>(d3<span class="op">.</span><span class="fu">range</span>(width <span class="op">&gt;</span> <span class="dv">500</span> <span class="op">?</span> <span class="dv">10</span> <span class="op">:</span> <span class="dv">10</span><span class="op">,</span> <span class="dv">100</span>))</span>
<span id="cb5-148"><a href="#cb5-148" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">enter</span>()</span>
<span id="cb5-149"><a href="#cb5-149" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">append</span>(<span class="st">'rect'</span>)</span>
<span id="cb5-150"><a href="#cb5-150" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">'class'</span><span class="op">,</span> <span class="st">'tickC1'</span>)</span>
<span id="cb5-151"><a href="#cb5-151" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">'x'</span><span class="op">,</span> d<span class="kw">=&gt;</span><span class="fu">scaleDD</span>(d<span class="op">/</span><span class="dv">10</span>)<span class="op">+</span>barX)</span>
<span id="cb5-152"><a href="#cb5-152" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">'y'</span><span class="op">,</span> d<span class="kw">=&gt;</span>d<span class="op">%</span><span class="dv">2</span><span class="op">===</span><span class="dv">0</span><span class="op">?</span> firstBarY<span class="op">+</span><span class="dv">47</span><span class="op">:</span>firstBarY<span class="op">+</span><span class="dv">50</span>)</span>
<span id="cb5-153"><a href="#cb5-153" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">'height'</span><span class="op">,</span> d<span class="kw">=&gt;</span>d<span class="op">%</span><span class="dv">2</span><span class="op">===</span><span class="dv">0</span><span class="op">?</span> <span class="dv">8</span><span class="op">:</span><span class="dv">5</span>)</span>
<span id="cb5-154"><a href="#cb5-154" aria-hidden="true" tabindex="-1"></a>  <span class="co">// Mil ticks</span></span>
<span id="cb5-155"><a href="#cb5-155" aria-hidden="true" tabindex="-1"></a>  svg<span class="op">.</span><span class="fu">selectAll</span>(<span class="st">'.tickM'</span>)</span>
<span id="cb5-156"><a href="#cb5-156" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">data</span>(d3<span class="op">.</span><span class="fu">range</span>(width <span class="op">&gt;</span> <span class="dv">500</span> <span class="op">?</span> <span class="dv">1</span> <span class="op">:</span> <span class="dv">1</span><span class="op">,</span> <span class="dv">10</span>))</span>
<span id="cb5-157"><a href="#cb5-157" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">enter</span>()</span>
<span id="cb5-158"><a href="#cb5-158" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">append</span>(<span class="st">'rect'</span>)</span>
<span id="cb5-159"><a href="#cb5-159" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">'class'</span><span class="op">,</span> <span class="st">'tickM'</span>)</span>
<span id="cb5-160"><a href="#cb5-160" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">'x'</span><span class="op">,</span> d<span class="kw">=&gt;</span><span class="fu">scaleDD</span>(d)<span class="op">+</span>barX)</span>
<span id="cb5-161"><a href="#cb5-161" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">'y'</span><span class="op">,</span> firstBarY<span class="op">+</span><span class="dv">20</span>)</span>
<span id="cb5-162"><a href="#cb5-162" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">'height'</span><span class="op">,</span> <span class="dv">6</span>)</span>
<span id="cb5-163"><a href="#cb5-163" aria-hidden="true" tabindex="-1"></a>  svg<span class="op">.</span><span class="fu">selectAll</span>(<span class="st">'.tickLabel1'</span>)</span>
<span id="cb5-164"><a href="#cb5-164" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">data</span>(d3<span class="op">.</span><span class="fu">range</span>(width <span class="op">&gt;</span> <span class="dv">500</span> <span class="op">?</span> <span class="dv">1</span> <span class="op">:</span> <span class="dv">1</span><span class="op">,</span> <span class="dv">10</span>))</span>
<span id="cb5-165"><a href="#cb5-165" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">enter</span>()</span>
<span id="cb5-166"><a href="#cb5-166" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">append</span>(<span class="st">'text'</span>)</span>
<span id="cb5-167"><a href="#cb5-167" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">'class'</span><span class="op">,</span> <span class="st">'tickLabel1'</span>)</span>
<span id="cb5-168"><a href="#cb5-168" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">'x'</span><span class="op">,</span> d<span class="kw">=&gt;</span><span class="fu">scaleDD</span>(d)<span class="op">+</span>barX<span class="op">+.</span><span class="dv">5</span>)</span>
<span id="cb5-169"><a href="#cb5-169" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">'y'</span><span class="op">,</span> firstBarY<span class="op">+</span><span class="dv">18</span>)</span>
<span id="cb5-170"><a href="#cb5-170" aria-hidden="true" tabindex="-1"></a>    <span class="co">//.style("font-size", `{W &lt; 550 ? 12 : W &lt; 650 ? 14 : W &lt; 750 ? 16 : W &lt; 850 ? 18 : 20}px`)</span></span>
<span id="cb5-171"><a href="#cb5-171" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">text</span>(d<span class="kw">=&gt;</span>d)</span>
<span id="cb5-172"><a href="#cb5-172" aria-hidden="true" tabindex="-1"></a>  <span class="co">// Cent ticks</span></span>
<span id="cb5-173"><a href="#cb5-173" aria-hidden="true" tabindex="-1"></a>  svg<span class="op">.</span><span class="fu">selectAll</span>(<span class="st">'.tickC2'</span>)</span>
<span id="cb5-174"><a href="#cb5-174" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">data</span>(d3<span class="op">.</span><span class="fu">range</span>(width <span class="op">&gt;</span> <span class="dv">500</span> <span class="op">?</span> <span class="dv">10</span> <span class="op">:</span> <span class="dv">10</span><span class="op">,</span> <span class="dv">100</span>))</span>
<span id="cb5-175"><a href="#cb5-175" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">enter</span>()</span>
<span id="cb5-176"><a href="#cb5-176" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">append</span>(<span class="st">'rect'</span>)</span>
<span id="cb5-177"><a href="#cb5-177" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">'class'</span><span class="op">,</span> <span class="st">'tickC2'</span>)</span>
<span id="cb5-178"><a href="#cb5-178" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">'x'</span><span class="op">,</span> d<span class="kw">=&gt;</span><span class="fu">scaleDD</span>(d<span class="op">/</span><span class="dv">10</span>)<span class="op">+</span>barX)</span>
<span id="cb5-179"><a href="#cb5-179" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">'y'</span><span class="op">,</span> firstBarY<span class="op">+</span><span class="dv">10</span>)</span>
<span id="cb5-180"><a href="#cb5-180" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">'height'</span><span class="op">,</span> d<span class="kw">=&gt;</span>d<span class="op">%</span><span class="dv">2</span><span class="op">===</span><span class="dv">0</span><span class="op">?</span> <span class="dv">9</span><span class="op">:</span><span class="dv">6</span>)</span>
<span id="cb5-181"><a href="#cb5-181" aria-hidden="true" tabindex="-1"></a>  <span class="co">// Beat ticks</span></span>
<span id="cb5-182"><a href="#cb5-182" aria-hidden="true" tabindex="-1"></a>  svg<span class="op">.</span><span class="fu">selectAll</span>(<span class="st">'.tickB'</span>)</span>
<span id="cb5-183"><a href="#cb5-183" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">data</span>(d3<span class="op">.</span><span class="fu">range</span>(width <span class="op">&gt;</span> <span class="dv">500</span> <span class="op">?</span> <span class="dv">10</span> <span class="op">:</span> <span class="dv">10</span><span class="op">,</span> <span class="dv">100</span>))</span>
<span id="cb5-184"><a href="#cb5-184" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">enter</span>()</span>
<span id="cb5-185"><a href="#cb5-185" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">append</span>(<span class="st">'rect'</span>)</span>
<span id="cb5-186"><a href="#cb5-186" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">'class'</span><span class="op">,</span> <span class="st">'tickB'</span>)</span>
<span id="cb5-187"><a href="#cb5-187" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">'x'</span><span class="op">,</span> d<span class="kw">=&gt;</span><span class="fu">scaleDD</span>(d<span class="op">/</span><span class="dv">10</span>)<span class="op">+</span>barX)</span>
<span id="cb5-188"><a href="#cb5-188" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">'y'</span><span class="op">,</span> firstBarY<span class="op">+</span><span class="dv">60</span>)</span>
<span id="cb5-189"><a href="#cb5-189" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">'height'</span><span class="op">,</span> d<span class="kw">=&gt;</span>d<span class="op">%</span><span class="dv">2</span><span class="op">===</span><span class="dv">0</span><span class="op">?</span> <span class="dv">9</span><span class="op">:</span><span class="dv">6</span>)</span>
<span id="cb5-190"><a href="#cb5-190" aria-hidden="true" tabindex="-1"></a>  <span class="co">// Labels</span></span>
<span id="cb5-191"><a href="#cb5-191" aria-hidden="true" tabindex="-1"></a>  svg<span class="op">.</span><span class="fu">selectAll</span>(<span class="st">'.timeLabel'</span>)</span>
<span id="cb5-192"><a href="#cb5-192" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">data</span>([<span class="vs">`+</span><span class="sc">${</span>barDD<span class="sc">}</span><span class="vs">`</span><span class="op">,</span> <span class="vs">`</span><span class="sc">${</span>barMils<span class="sc">}</span><span class="vs">`</span><span class="op">,</span> <span class="vs">`</span><span class="sc">${</span>barBeats<span class="sc">}</span><span class="vs">`</span>])</span>
<span id="cb5-193"><a href="#cb5-193" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">enter</span>()</span>
<span id="cb5-194"><a href="#cb5-194" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">append</span>(<span class="st">'text'</span>)</span>
<span id="cb5-195"><a href="#cb5-195" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">'class'</span><span class="op">,</span> <span class="st">'timeLabel'</span>)</span>
<span id="cb5-196"><a href="#cb5-196" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">'x'</span><span class="op">,</span> barX<span class="op">+</span><span class="dv">2</span>)</span>
<span id="cb5-197"><a href="#cb5-197" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">'y'</span><span class="op">,</span> (d<span class="op">,</span>i)<span class="kw">=&gt;</span>i<span class="op">*</span><span class="dv">30</span><span class="op">+</span>firstBarY<span class="op">+</span><span class="dv">20</span>)</span>
<span id="cb5-198"><a href="#cb5-198" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">style</span>(<span class="st">"font-size"</span><span class="op">,</span> <span class="vs">`</span><span class="sc">${</span>W <span class="op">&lt;</span> <span class="dv">300</span> <span class="op">?</span> <span class="dv">14</span> <span class="op">:</span> W <span class="op">&lt;</span> <span class="dv">400</span> <span class="op">?</span> <span class="dv">16</span> <span class="op">:</span> W <span class="op">&lt;</span> <span class="dv">500</span> <span class="op">?</span> <span class="dv">18</span> <span class="op">:</span> W <span class="op">&lt;</span> <span class="dv">600</span> <span class="op">?</span> <span class="dv">20</span> <span class="op">:</span> <span class="dv">22</span><span class="sc">}</span><span class="vs">px`</span>)</span>
<span id="cb5-199"><a href="#cb5-199" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">text</span>(d<span class="kw">=&gt;</span>d)<span class="op">;</span></span>
<span id="cb5-200"><a href="#cb5-200" aria-hidden="true" tabindex="-1"></a>  svg<span class="op">.</span><span class="fu">attr</span>(<span class="st">"id"</span><span class="op">,</span> <span class="st">"barClock"</span>)<span class="op">;</span></span>
<span id="cb5-201"><a href="#cb5-201" aria-hidden="true" tabindex="-1"></a>  <span class="cf">return</span> svg<span class="op">.</span><span class="fu">node</span>()<span class="op">;</span></span>
<span id="cb5-202"><a href="#cb5-202" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb5-203"><a href="#cb5-203" aria-hidden="true" tabindex="-1"></a>barChart1 <span class="op">=</span> {</span>
<span id="cb5-204"><a href="#cb5-204" aria-hidden="true" tabindex="-1"></a><span class="kw">const</span> W <span class="op">=</span> width<span class="op">;</span></span>
<span id="cb5-205"><a href="#cb5-205" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> H <span class="op">=</span> <span class="dv">88</span><span class="op">;</span></span>
<span id="cb5-206"><a href="#cb5-206" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> barX <span class="op">=</span> <span class="dv">1</span><span class="op">;</span></span>
<span id="cb5-207"><a href="#cb5-207" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> firstBarY <span class="op">=</span> <span class="dv">1</span><span class="op">;</span></span>
<span id="cb5-208"><a href="#cb5-208" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> svg <span class="op">=</span> d3</span>
<span id="cb5-209"><a href="#cb5-209" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">create</span>(<span class="st">"svg"</span>)</span>
<span id="cb5-210"><a href="#cb5-210" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">"width"</span><span class="op">,</span> W)</span>
<span id="cb5-211"><a href="#cb5-211" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">"viewBox"</span><span class="op">,</span> [<span class="dv">0</span><span class="op">,</span> <span class="dv">0</span><span class="op">,</span> W <span class="op">*</span> (W <span class="op">&lt;</span> <span class="dv">370</span> <span class="op">?</span> <span class="op">.</span><span class="dv">73</span> <span class="op">:</span> W <span class="op">&lt;</span> <span class="dv">420</span> <span class="op">?</span> <span class="op">.</span><span class="dv">76</span> <span class="op">:</span> W <span class="op">&lt;</span> <span class="dv">470</span> <span class="op">?</span> <span class="op">.</span><span class="dv">79</span> <span class="op">:</span> W <span class="op">&lt;</span> <span class="dv">520</span> <span class="op">?</span> <span class="op">.</span><span class="dv">81</span> <span class="op">:</span> W <span class="op">&lt;</span> <span class="dv">570</span> <span class="op">?</span> <span class="op">.</span><span class="dv">83</span> <span class="op">:</span> W <span class="op">&lt;</span> <span class="dv">620</span> <span class="op">?</span> <span class="op">.</span><span class="dv">84</span> <span class="op">:</span> W <span class="op">&lt;</span> <span class="dv">670</span> <span class="op">?</span> <span class="op">.</span><span class="dv">85</span> <span class="op">:</span> W <span class="op">&lt;</span> <span class="dv">720</span> <span class="op">?</span> <span class="op">.</span><span class="dv">86</span> <span class="op">:</span> <span class="op">.</span><span class="dv">87</span>)<span class="op">,</span> H])<span class="op">;</span></span>
<span id="cb5-212"><a href="#cb5-212" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> xRange <span class="op">=</span> [<span class="dv">0</span><span class="op">,</span> W <span class="op">-</span> <span class="dv">100</span>]<span class="op">;</span></span>
<span id="cb5-213"><a href="#cb5-213" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> scaleDD <span class="op">=</span> d3<span class="op">.</span><span class="fu">scaleLinear</span>()</span>
<span id="cb5-214"><a href="#cb5-214" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">domain</span>([<span class="dv">0</span><span class="op">,</span> <span class="dv">10</span>])</span>
<span id="cb5-215"><a href="#cb5-215" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">range</span>(xRange)<span class="op">;</span></span>
<span id="cb5-216"><a href="#cb5-216" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> scaleMandB <span class="op">=</span> d3<span class="op">.</span><span class="fu">scaleLinear</span>()</span>
<span id="cb5-217"><a href="#cb5-217" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">domain</span>([<span class="dv">0</span><span class="op">,</span> <span class="dv">100</span>])</span>
<span id="cb5-218"><a href="#cb5-218" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">range</span>(xRange)<span class="op">;</span></span>
<span id="cb5-219"><a href="#cb5-219" aria-hidden="true" tabindex="-1"></a>  <span class="co">// const scaleDek = d3.scaleLinear()</span></span>
<span id="cb5-220"><a href="#cb5-220" aria-hidden="true" tabindex="-1"></a>  <span class="co">//  .domain([0, 37])</span></span>
<span id="cb5-221"><a href="#cb5-221" aria-hidden="true" tabindex="-1"></a>  <span class="co">//  .range(xRange);</span></span>
<span id="cb5-222"><a href="#cb5-222" aria-hidden="true" tabindex="-1"></a>  <span class="co">// Background bars to show where 100% lies</span></span>
<span id="cb5-223"><a href="#cb5-223" aria-hidden="true" tabindex="-1"></a>  svg<span class="op">.</span><span class="fu">selectAll</span>(<span class="st">'.background'</span>)</span>
<span id="cb5-224"><a href="#cb5-224" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">data</span>([</span>
<span id="cb5-225"><a href="#cb5-225" aria-hidden="true" tabindex="-1"></a>      <span class="co">// 'dek', 'dotd',</span></span>
<span id="cb5-226"><a href="#cb5-226" aria-hidden="true" tabindex="-1"></a>      <span class="st">'dd'</span><span class="op">,</span> <span class="st">"mils"</span><span class="op">,</span> <span class="st">'beats'</span>])</span>
<span id="cb5-227"><a href="#cb5-227" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">enter</span>()</span>
<span id="cb5-228"><a href="#cb5-228" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">append</span>(<span class="st">'rect'</span>)</span>
<span id="cb5-229"><a href="#cb5-229" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">'class'</span><span class="op">,</span> <span class="st">'background timeBar'</span>)</span>
<span id="cb5-230"><a href="#cb5-230" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">'width'</span><span class="op">,</span> W<span class="op">-</span><span class="dv">100</span>)</span>
<span id="cb5-231"><a href="#cb5-231" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">'y'</span><span class="op">,</span> (d<span class="op">,</span>i)<span class="kw">=&gt;</span>i<span class="op">*</span><span class="dv">30</span><span class="op">+</span>firstBarY)</span>
<span id="cb5-232"><a href="#cb5-232" aria-hidden="true" tabindex="-1"></a>  <span class="co">// Beats</span></span>
<span id="cb5-233"><a href="#cb5-233" aria-hidden="true" tabindex="-1"></a>  svg</span>
<span id="cb5-234"><a href="#cb5-234" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">append</span>(<span class="st">'rect'</span>)</span>
<span id="cb5-235"><a href="#cb5-235" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">'class'</span><span class="op">,</span> <span class="st">'timeBar'</span>)</span>
<span id="cb5-236"><a href="#cb5-236" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">'y'</span><span class="op">,</span> firstBarY<span class="op">+</span><span class="dv">60</span>)</span>
<span id="cb5-237"><a href="#cb5-237" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">'width'</span><span class="op">,</span> d <span class="kw">=&gt;</span> <span class="fu">scaleMandB</span>(<span class="bu">Number</span>(barBeatsN)))</span>
<span id="cb5-238"><a href="#cb5-238" aria-hidden="true" tabindex="-1"></a>  svg</span>
<span id="cb5-239"><a href="#cb5-239" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">append</span>(<span class="st">'rect'</span>)</span>
<span id="cb5-240"><a href="#cb5-240" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">'class'</span><span class="op">,</span> <span class="st">'timeBarFullN'</span>)</span>
<span id="cb5-241"><a href="#cb5-241" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">'y'</span><span class="op">,</span> firstBarY<span class="op">+</span><span class="dv">60</span>)</span>
<span id="cb5-242"><a href="#cb5-242" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">'width'</span><span class="op">,</span> d <span class="kw">=&gt;</span> <span class="fu">scaleMandB</span>(barBeatsN))</span>
<span id="cb5-243"><a href="#cb5-243" aria-hidden="true" tabindex="-1"></a>  <span class="co">// Cents/Mils</span></span>
<span id="cb5-244"><a href="#cb5-244" aria-hidden="true" tabindex="-1"></a>  svg</span>
<span id="cb5-245"><a href="#cb5-245" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">append</span>(<span class="st">'rect'</span>)</span>
<span id="cb5-246"><a href="#cb5-246" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">'class'</span><span class="op">,</span> <span class="st">'timeBar'</span>)</span>
<span id="cb5-247"><a href="#cb5-247" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">'y'</span><span class="op">,</span> firstBarY)</span>
<span id="cb5-248"><a href="#cb5-248" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">'width'</span><span class="op">,</span> d <span class="kw">=&gt;</span> <span class="fu">scaleDD</span>(<span class="bu">Number</span>(barDDN)<span class="op">+</span><span class="bu">Number</span>(barMilsN)<span class="op">/</span><span class="dv">100</span><span class="op">+</span><span class="bu">Number</span>(barBeatsN)<span class="op">/</span><span class="dv">10000</span>))</span>
<span id="cb5-249"><a href="#cb5-249" aria-hidden="true" tabindex="-1"></a>  svg</span>
<span id="cb5-250"><a href="#cb5-250" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">append</span>(<span class="st">'rect'</span>)</span>
<span id="cb5-251"><a href="#cb5-251" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">'class'</span><span class="op">,</span> <span class="st">'timeBarFullN'</span>)</span>
<span id="cb5-252"><a href="#cb5-252" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">'y'</span><span class="op">,</span> firstBarY)</span>
<span id="cb5-253"><a href="#cb5-253" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">'width'</span><span class="op">,</span> d <span class="kw">=&gt;</span> <span class="fu">scaleDD</span>(barDDN))</span>
<span id="cb5-254"><a href="#cb5-254" aria-hidden="true" tabindex="-1"></a>  svg</span>
<span id="cb5-255"><a href="#cb5-255" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">append</span>(<span class="st">'rect'</span>)</span>
<span id="cb5-256"><a href="#cb5-256" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">'class'</span><span class="op">,</span> <span class="st">'timeBar'</span>)</span>
<span id="cb5-257"><a href="#cb5-257" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">'y'</span><span class="op">,</span> firstBarY<span class="op">+</span><span class="dv">30</span>)</span>
<span id="cb5-258"><a href="#cb5-258" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">'width'</span><span class="op">,</span> d <span class="kw">=&gt;</span> <span class="fu">scaleMandB</span>(<span class="bu">Number</span>(barMilsN)<span class="op">+</span><span class="bu">Number</span>(barBeatsN)<span class="op">/</span><span class="dv">100</span>))</span>
<span id="cb5-259"><a href="#cb5-259" aria-hidden="true" tabindex="-1"></a>  svg</span>
<span id="cb5-260"><a href="#cb5-260" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">append</span>(<span class="st">'rect'</span>)</span>
<span id="cb5-261"><a href="#cb5-261" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">'class'</span><span class="op">,</span> <span class="st">'timeBarFullN'</span>)</span>
<span id="cb5-262"><a href="#cb5-262" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">'y'</span><span class="op">,</span> firstBarY<span class="op">+</span><span class="dv">30</span>)</span>
<span id="cb5-263"><a href="#cb5-263" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">'width'</span><span class="op">,</span> d <span class="kw">=&gt;</span> <span class="fu">scaleMandB</span>(barMilsN))</span>
<span id="cb5-264"><a href="#cb5-264" aria-hidden="true" tabindex="-1"></a>  <span class="co">// Cent ticks</span></span>
<span id="cb5-265"><a href="#cb5-265" aria-hidden="true" tabindex="-1"></a>  svg<span class="op">.</span><span class="fu">selectAll</span>(<span class="st">'.tickC'</span>)</span>
<span id="cb5-266"><a href="#cb5-266" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">data</span>(d3<span class="op">.</span><span class="fu">range</span>(width <span class="op">&gt;</span> <span class="dv">500</span> <span class="op">?</span> <span class="dv">10</span> <span class="op">:</span> <span class="dv">10</span><span class="op">,</span> <span class="dv">100</span>))</span>
<span id="cb5-267"><a href="#cb5-267" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">enter</span>()</span>
<span id="cb5-268"><a href="#cb5-268" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">append</span>(<span class="st">'rect'</span>)</span>
<span id="cb5-269"><a href="#cb5-269" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">'class'</span><span class="op">,</span> <span class="st">'tickC'</span>)</span>
<span id="cb5-270"><a href="#cb5-270" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">'x'</span><span class="op">,</span> d<span class="kw">=&gt;</span><span class="fu">scaleDD</span>(d<span class="op">/</span><span class="dv">10</span>)<span class="op">+</span>barX)</span>
<span id="cb5-271"><a href="#cb5-271" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">'y'</span><span class="op">,</span> firstBarY<span class="op">+</span><span class="dv">30</span>)</span>
<span id="cb5-272"><a href="#cb5-272" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">'height'</span><span class="op">,</span> d<span class="kw">=&gt;</span>d<span class="op">%</span><span class="dv">2</span><span class="op">===</span><span class="dv">0</span><span class="op">?</span> <span class="dv">8</span><span class="op">:</span><span class="dv">5</span>)</span>
<span id="cb5-273"><a href="#cb5-273" aria-hidden="true" tabindex="-1"></a>  svg<span class="op">.</span><span class="fu">selectAll</span>(<span class="st">'.tickB1'</span>)</span>
<span id="cb5-274"><a href="#cb5-274" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">data</span>(d3<span class="op">.</span><span class="fu">range</span>(width <span class="op">&gt;</span> <span class="dv">500</span> <span class="op">?</span> <span class="dv">10</span> <span class="op">:</span> <span class="dv">10</span><span class="op">,</span> <span class="dv">100</span>))</span>
<span id="cb5-275"><a href="#cb5-275" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">enter</span>()</span>
<span id="cb5-276"><a href="#cb5-276" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">append</span>(<span class="st">'rect'</span>)</span>
<span id="cb5-277"><a href="#cb5-277" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">'class'</span><span class="op">,</span> <span class="st">'tickB1'</span>)</span>
<span id="cb5-278"><a href="#cb5-278" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">'x'</span><span class="op">,</span> d<span class="kw">=&gt;</span><span class="fu">scaleDD</span>(d<span class="op">/</span><span class="dv">10</span>)<span class="op">+</span>barX)</span>
<span id="cb5-279"><a href="#cb5-279" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">'y'</span><span class="op">,</span> d<span class="kw">=&gt;</span>d<span class="op">%</span><span class="dv">2</span><span class="op">===</span><span class="dv">0</span><span class="op">?</span> firstBarY<span class="op">+</span><span class="dv">77</span><span class="op">:</span>firstBarY<span class="op">+</span><span class="dv">80</span>)</span>
<span id="cb5-280"><a href="#cb5-280" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">'height'</span><span class="op">,</span> d<span class="kw">=&gt;</span>d<span class="op">%</span><span class="dv">2</span><span class="op">===</span><span class="dv">0</span><span class="op">?</span> <span class="dv">8</span><span class="op">:</span><span class="dv">5</span>)</span>
<span id="cb5-281"><a href="#cb5-281" aria-hidden="true" tabindex="-1"></a>  svg<span class="op">.</span><span class="fu">selectAll</span>(<span class="st">'.tickC1'</span>)</span>
<span id="cb5-282"><a href="#cb5-282" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">data</span>(d3<span class="op">.</span><span class="fu">range</span>(width <span class="op">&gt;</span> <span class="dv">500</span> <span class="op">?</span> <span class="dv">10</span> <span class="op">:</span> <span class="dv">10</span><span class="op">,</span> <span class="dv">100</span>))</span>
<span id="cb5-283"><a href="#cb5-283" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">enter</span>()</span>
<span id="cb5-284"><a href="#cb5-284" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">append</span>(<span class="st">'rect'</span>)</span>
<span id="cb5-285"><a href="#cb5-285" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">'class'</span><span class="op">,</span> <span class="st">'tickC1'</span>)</span>
<span id="cb5-286"><a href="#cb5-286" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">'x'</span><span class="op">,</span> d<span class="kw">=&gt;</span><span class="fu">scaleDD</span>(d<span class="op">/</span><span class="dv">10</span>)<span class="op">+</span>barX)</span>
<span id="cb5-287"><a href="#cb5-287" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">'y'</span><span class="op">,</span> d<span class="kw">=&gt;</span>d<span class="op">%</span><span class="dv">2</span><span class="op">===</span><span class="dv">0</span><span class="op">?</span> firstBarY<span class="op">+</span><span class="dv">47</span><span class="op">:</span>firstBarY<span class="op">+</span><span class="dv">50</span>)</span>
<span id="cb5-288"><a href="#cb5-288" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">'height'</span><span class="op">,</span> d<span class="kw">=&gt;</span>d<span class="op">%</span><span class="dv">2</span><span class="op">===</span><span class="dv">0</span><span class="op">?</span> <span class="dv">8</span><span class="op">:</span><span class="dv">5</span>)</span>
<span id="cb5-289"><a href="#cb5-289" aria-hidden="true" tabindex="-1"></a>  <span class="co">// Mil ticks</span></span>
<span id="cb5-290"><a href="#cb5-290" aria-hidden="true" tabindex="-1"></a>  svg<span class="op">.</span><span class="fu">selectAll</span>(<span class="st">'.tickM'</span>)</span>
<span id="cb5-291"><a href="#cb5-291" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">data</span>(d3<span class="op">.</span><span class="fu">range</span>(width <span class="op">&gt;</span> <span class="dv">500</span> <span class="op">?</span> <span class="dv">1</span> <span class="op">:</span> <span class="dv">1</span><span class="op">,</span> <span class="dv">10</span>))</span>
<span id="cb5-292"><a href="#cb5-292" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">enter</span>()</span>
<span id="cb5-293"><a href="#cb5-293" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">append</span>(<span class="st">'rect'</span>)</span>
<span id="cb5-294"><a href="#cb5-294" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">'class'</span><span class="op">,</span> <span class="st">'tickM'</span>)</span>
<span id="cb5-295"><a href="#cb5-295" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">'x'</span><span class="op">,</span> d<span class="kw">=&gt;</span><span class="fu">scaleDD</span>(d)<span class="op">+</span>barX)</span>
<span id="cb5-296"><a href="#cb5-296" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">'y'</span><span class="op">,</span> firstBarY<span class="op">+</span><span class="dv">20</span>)</span>
<span id="cb5-297"><a href="#cb5-297" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">'height'</span><span class="op">,</span> <span class="dv">6</span>)</span>
<span id="cb5-298"><a href="#cb5-298" aria-hidden="true" tabindex="-1"></a>  svg<span class="op">.</span><span class="fu">selectAll</span>(<span class="st">'.tickLabel1'</span>)</span>
<span id="cb5-299"><a href="#cb5-299" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">data</span>(d3<span class="op">.</span><span class="fu">range</span>(width <span class="op">&gt;</span> <span class="dv">500</span> <span class="op">?</span> <span class="dv">1</span> <span class="op">:</span> <span class="dv">1</span><span class="op">,</span> <span class="dv">10</span>))</span>
<span id="cb5-300"><a href="#cb5-300" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">enter</span>()</span>
<span id="cb5-301"><a href="#cb5-301" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">append</span>(<span class="st">'text'</span>)</span>
<span id="cb5-302"><a href="#cb5-302" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">'class'</span><span class="op">,</span> <span class="st">'tickLabel1'</span>)</span>
<span id="cb5-303"><a href="#cb5-303" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">'x'</span><span class="op">,</span> d<span class="kw">=&gt;</span><span class="fu">scaleDD</span>(d)<span class="op">+</span>barX<span class="op">+.</span><span class="dv">5</span>)</span>
<span id="cb5-304"><a href="#cb5-304" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">'y'</span><span class="op">,</span> firstBarY<span class="op">+</span><span class="dv">18</span>)</span>
<span id="cb5-305"><a href="#cb5-305" aria-hidden="true" tabindex="-1"></a>    <span class="co">//.style("font-size", `{W &lt; 350 ? 12 : W &lt; 450 ? 14 : W &lt; 550 ? 16 : W &lt; 650 ? 18 : 20}px`)</span></span>
<span id="cb5-306"><a href="#cb5-306" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">text</span>(d<span class="kw">=&gt;</span>d)</span>
<span id="cb5-307"><a href="#cb5-307" aria-hidden="true" tabindex="-1"></a>  <span class="co">// Cent ticks</span></span>
<span id="cb5-308"><a href="#cb5-308" aria-hidden="true" tabindex="-1"></a>  svg<span class="op">.</span><span class="fu">selectAll</span>(<span class="st">'.tickC2'</span>)</span>
<span id="cb5-309"><a href="#cb5-309" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">data</span>(d3<span class="op">.</span><span class="fu">range</span>(width <span class="op">&gt;</span> <span class="dv">500</span> <span class="op">?</span> <span class="dv">10</span> <span class="op">:</span> <span class="dv">10</span><span class="op">,</span> <span class="dv">100</span>))</span>
<span id="cb5-310"><a href="#cb5-310" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">enter</span>()</span>
<span id="cb5-311"><a href="#cb5-311" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">append</span>(<span class="st">'rect'</span>)</span>
<span id="cb5-312"><a href="#cb5-312" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">'class'</span><span class="op">,</span> <span class="st">'tickC2'</span>)</span>
<span id="cb5-313"><a href="#cb5-313" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">'x'</span><span class="op">,</span> d<span class="kw">=&gt;</span><span class="fu">scaleDD</span>(d<span class="op">/</span><span class="dv">10</span>)<span class="op">+</span>barX)</span>
<span id="cb5-314"><a href="#cb5-314" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">'y'</span><span class="op">,</span> firstBarY<span class="op">+</span><span class="dv">10</span>)</span>
<span id="cb5-315"><a href="#cb5-315" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">'height'</span><span class="op">,</span> d<span class="kw">=&gt;</span>d<span class="op">%</span><span class="dv">2</span><span class="op">===</span><span class="dv">0</span><span class="op">?</span> <span class="dv">9</span><span class="op">:</span><span class="dv">6</span>)</span>
<span id="cb5-316"><a href="#cb5-316" aria-hidden="true" tabindex="-1"></a>  <span class="co">// Beat ticks</span></span>
<span id="cb5-317"><a href="#cb5-317" aria-hidden="true" tabindex="-1"></a>  svg<span class="op">.</span><span class="fu">selectAll</span>(<span class="st">'.tickB'</span>)</span>
<span id="cb5-318"><a href="#cb5-318" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">data</span>(d3<span class="op">.</span><span class="fu">range</span>(width <span class="op">&gt;</span> <span class="dv">500</span> <span class="op">?</span> <span class="dv">10</span> <span class="op">:</span> <span class="dv">10</span><span class="op">,</span> <span class="dv">100</span>))</span>
<span id="cb5-319"><a href="#cb5-319" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">enter</span>()</span>
<span id="cb5-320"><a href="#cb5-320" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">append</span>(<span class="st">'rect'</span>)</span>
<span id="cb5-321"><a href="#cb5-321" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">'class'</span><span class="op">,</span> <span class="st">'tickB'</span>)</span>
<span id="cb5-322"><a href="#cb5-322" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">'x'</span><span class="op">,</span> d<span class="kw">=&gt;</span><span class="fu">scaleDD</span>(d<span class="op">/</span><span class="dv">10</span>)<span class="op">+</span>barX)</span>
<span id="cb5-323"><a href="#cb5-323" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">'y'</span><span class="op">,</span> firstBarY<span class="op">+</span><span class="dv">60</span>)</span>
<span id="cb5-324"><a href="#cb5-324" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">'height'</span><span class="op">,</span> d<span class="kw">=&gt;</span>d<span class="op">%</span><span class="dv">2</span><span class="op">===</span><span class="dv">0</span><span class="op">?</span> <span class="dv">9</span><span class="op">:</span><span class="dv">6</span>)</span>
<span id="cb5-325"><a href="#cb5-325" aria-hidden="true" tabindex="-1"></a>  <span class="co">// Labels</span></span>
<span id="cb5-326"><a href="#cb5-326" aria-hidden="true" tabindex="-1"></a>  svg<span class="op">.</span><span class="fu">selectAll</span>(<span class="st">'.timeLabel'</span>)</span>
<span id="cb5-327"><a href="#cb5-327" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">data</span>([<span class="vs">`-</span><span class="sc">${</span>barDDN<span class="sc">}</span><span class="vs">`</span><span class="op">,</span> <span class="vs">`</span><span class="sc">${</span>barMilsN<span class="sc">}</span><span class="vs">`</span><span class="op">,</span> <span class="vs">`</span><span class="sc">${</span>barBeatsN<span class="sc">}</span><span class="vs">`</span>])</span>
<span id="cb5-328"><a href="#cb5-328" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">enter</span>()</span>
<span id="cb5-329"><a href="#cb5-329" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">append</span>(<span class="st">'text'</span>)</span>
<span id="cb5-330"><a href="#cb5-330" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">'class'</span><span class="op">,</span> <span class="st">'timeLabel'</span>)</span>
<span id="cb5-331"><a href="#cb5-331" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">'x'</span><span class="op">,</span> barX<span class="op">+</span><span class="dv">2</span>)</span>
<span id="cb5-332"><a href="#cb5-332" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">'y'</span><span class="op">,</span> (d<span class="op">,</span>i)<span class="kw">=&gt;</span>i<span class="op">*</span><span class="dv">30</span><span class="op">+</span>firstBarY<span class="op">+</span><span class="dv">20</span>)</span>
<span id="cb5-333"><a href="#cb5-333" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">style</span>(<span class="st">"font-size"</span><span class="op">,</span> <span class="vs">`</span><span class="sc">${</span>W <span class="op">&lt;</span> <span class="dv">300</span> <span class="op">?</span> <span class="dv">14</span> <span class="op">:</span> W <span class="op">&lt;</span> <span class="dv">400</span> <span class="op">?</span> <span class="dv">16</span> <span class="op">:</span> W <span class="op">&lt;</span> <span class="dv">500</span> <span class="op">?</span> <span class="dv">18</span> <span class="op">:</span> W <span class="op">&lt;</span> <span class="dv">600</span> <span class="op">?</span> <span class="dv">20</span> <span class="op">:</span> <span class="dv">22</span><span class="sc">}</span><span class="vs">px`</span>)</span>
<span id="cb5-334"><a href="#cb5-334" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">text</span>(d<span class="kw">=&gt;</span>d)<span class="op">;</span></span>
<span id="cb5-335"><a href="#cb5-335" aria-hidden="true" tabindex="-1"></a>  svg<span class="op">.</span><span class="fu">attr</span>(<span class="st">"id"</span><span class="op">,</span> <span class="st">"barClock"</span>)<span class="op">;</span></span>
<span id="cb5-336"><a href="#cb5-336" aria-hidden="true" tabindex="-1"></a>  <span class="cf">return</span> svg<span class="op">.</span><span class="fu">node</span>()<span class="op">;</span></span>
<span id="cb5-337"><a href="#cb5-337" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb5-338"><a href="#cb5-338" aria-hidden="true" tabindex="-1"></a>viewof location <span class="op">=</span> <span class="fu">worldMapCoordinates</span>([<span class="dv">162</span><span class="op">,</span> <span class="dv">0</span>]<span class="op">,</span> [width <span class="op">*</span> <span class="op">.</span><span class="dv">998</span><span class="op">,</span> <span class="bu">Math</span><span class="op">.</span><span class="fu">round</span>((<span class="dv">21</span> <span class="op">/</span> <span class="dv">40</span>) <span class="op">*</span> width)])</span>
<span id="cb5-339"><a href="#cb5-339" aria-hidden="true" tabindex="-1"></a><span class="co">// https://observablehq.com/@dbridges/visualizing-seasonal-daylight</span></span>
<span id="cb5-340"><a href="#cb5-340" aria-hidden="true" tabindex="-1"></a>app <span class="op">=</span> {</span>
<span id="cb5-341"><a href="#cb5-341" aria-hidden="true" tabindex="-1"></a><span class="kw">const</span> svg <span class="op">=</span> d3<span class="op">.</span><span class="fu">select</span>(DOM<span class="op">.</span><span class="fu">svg</span>(width<span class="op">,</span> height <span class="op">-</span> (width <span class="op">&lt;</span> <span class="dv">400</span> <span class="op">?</span> <span class="dv">10</span> <span class="op">:</span> width <span class="op">&lt;</span> <span class="dv">600</span> <span class="op">?</span> <span class="dv">15</span> <span class="op">:</span> width <span class="op">&lt;</span> <span class="dv">700</span> <span class="op">?</span> <span class="dv">30</span> <span class="op">:</span> <span class="dv">40</span>)))<span class="op">;</span></span>
<span id="cb5-342"><a href="#cb5-342" aria-hidden="true" tabindex="-1"></a>  svg<span class="op">.</span><span class="fu">style</span>(<span class="st">"user-select"</span><span class="op">,</span> <span class="st">"none"</span>)</span>
<span id="cb5-343"><a href="#cb5-343" aria-hidden="true" tabindex="-1"></a>     <span class="op">.</span><span class="fu">style</span>(<span class="st">"-webkit-user-select"</span><span class="op">,</span> <span class="st">"none"</span>)<span class="op">;</span></span>
<span id="cb5-344"><a href="#cb5-344" aria-hidden="true" tabindex="-1"></a>  svg<span class="op">.</span><span class="fu">attr</span>(<span class="st">"id"</span><span class="op">,</span> <span class="st">"daylightapp"</span>)</span>
<span id="cb5-345"><a href="#cb5-345" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> margin <span class="op">=</span> {<span class="dt">top</span><span class="op">:</span> <span class="dv">0</span><span class="op">,</span> <span class="dt">left</span><span class="op">:</span> <span class="dv">10</span><span class="op">,</span> <span class="dt">right</span><span class="op">:</span> <span class="dv">10</span><span class="op">,</span> <span class="dt">bottom</span><span class="op">:</span> <span class="dv">0</span><span class="op">,</span> <span class="dt">inner</span><span class="op">:</span> <span class="dv">3</span>}<span class="op">;</span></span>
<span id="cb5-346"><a href="#cb5-346" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> contentWidth <span class="op">=</span> width <span class="op">-</span> margin<span class="op">.</span><span class="at">left</span> <span class="op">-</span> margin<span class="op">.</span><span class="at">right</span> <span class="op">-</span> margin<span class="op">.</span><span class="at">inner</span><span class="op">;</span></span>
<span id="cb5-347"><a href="#cb5-347" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> columnWidth <span class="op">=</span> contentWidth <span class="op">/</span> <span class="dv">2</span><span class="op">;</span></span>
<span id="cb5-348"><a href="#cb5-348" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> date2022 <span class="op">=</span> <span class="kw">new</span> <span class="bu">Date</span>(<span class="dv">2022</span><span class="op">,</span> <span class="kw">new</span> <span class="bu">Date</span>()<span class="op">.</span><span class="fu">getMonth</span>()<span class="op">,</span> <span class="kw">new</span> <span class="bu">Date</span>()<span class="op">.</span><span class="fu">getDate</span>()<span class="op">,</span> <span class="kw">new</span> <span class="bu">Date</span>()<span class="op">.</span><span class="fu">getHours</span>())</span>
<span id="cb5-349"><a href="#cb5-349" aria-hidden="true" tabindex="-1"></a>  <span class="kw">let</span> selection <span class="op">=</span> {</span>
<span id="cb5-350"><a href="#cb5-350" aria-hidden="true" tabindex="-1"></a>    <span class="dt">date</span><span class="op">:</span> date2022<span class="op">,</span></span>
<span id="cb5-351"><a href="#cb5-351" aria-hidden="true" tabindex="-1"></a>    <span class="dt">hour</span><span class="op">:</span> date2022<span class="op">.</span><span class="fu">getHours</span>()</span>
<span id="cb5-352"><a href="#cb5-352" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb5-353"><a href="#cb5-353" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> renderPlot <span class="op">=</span> () <span class="kw">=&gt;</span> {</span>
<span id="cb5-354"><a href="#cb5-354" aria-hidden="true" tabindex="-1"></a>    svg<span class="op">.</span><span class="fu">selectAll</span>(<span class="st">"#daylightplot *"</span>)<span class="op">.</span><span class="fu">remove</span>()<span class="op">;</span></span>
<span id="cb5-355"><a href="#cb5-355" aria-hidden="true" tabindex="-1"></a>    svg<span class="op">.</span><span class="fu">select</span>(<span class="st">"#daylightplot"</span>)<span class="op">.</span><span class="fu">call</span>(daylightPlot<span class="op">,</span> {</span>
<span id="cb5-356"><a href="#cb5-356" aria-hidden="true" tabindex="-1"></a>      <span class="dt">width</span><span class="op">:</span> columnWidth <span class="op">/</span> <span class="fl">1.26</span><span class="op">,</span></span>
<span id="cb5-357"><a href="#cb5-357" aria-hidden="true" tabindex="-1"></a>      <span class="dt">height</span><span class="op">:</span> height <span class="op">/</span> <span class="fl">1.51</span> <span class="op">-</span> margin<span class="op">.</span><span class="at">top</span> <span class="op">-</span> margin<span class="op">.</span><span class="at">bottom</span><span class="op">,</span></span>
<span id="cb5-358"><a href="#cb5-358" aria-hidden="true" tabindex="-1"></a>      <span class="dt">year</span><span class="op">:</span> date2022<span class="op">.</span><span class="fu">getFullYear</span>()<span class="op">,</span></span>
<span id="cb5-359"><a href="#cb5-359" aria-hidden="true" tabindex="-1"></a>      <span class="dt">latitude</span><span class="op">:</span> location[<span class="dv">1</span>]<span class="op">,</span></span>
<span id="cb5-360"><a href="#cb5-360" aria-hidden="true" tabindex="-1"></a>      <span class="dt">defaultDate</span><span class="op">:</span> selection<span class="op">.</span><span class="at">date</span><span class="op">,</span></span>
<span id="cb5-361"><a href="#cb5-361" aria-hidden="true" tabindex="-1"></a>      <span class="dt">defaultHour</span><span class="op">:</span> selection<span class="op">.</span><span class="at">hour</span></span>
<span id="cb5-362"><a href="#cb5-362" aria-hidden="true" tabindex="-1"></a>    })</span>
<span id="cb5-363"><a href="#cb5-363" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb5-364"><a href="#cb5-364" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> renderGlobe <span class="op">=</span> () <span class="kw">=&gt;</span> {</span>
<span id="cb5-365"><a href="#cb5-365" aria-hidden="true" tabindex="-1"></a>    svg<span class="op">.</span><span class="fu">selectAll</span>(<span class="st">"#globe *"</span>)<span class="op">.</span><span class="fu">remove</span>()<span class="op">;</span></span>
<span id="cb5-366"><a href="#cb5-366" aria-hidden="true" tabindex="-1"></a>    svg<span class="op">.</span><span class="fu">selectAll</span>(<span class="st">"#globe"</span>)<span class="op">.</span><span class="fu">call</span>(globe<span class="op">,</span> { <span class="dt">width</span><span class="op">:</span> columnWidth <span class="op">*</span> <span class="fl">1.2</span><span class="op">,</span> location<span class="op">,</span> <span class="op">...</span>selection })<span class="op">;</span></span>
<span id="cb5-367"><a href="#cb5-367" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb5-368"><a href="#cb5-368" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> renderSolarSystem <span class="op">=</span> () <span class="kw">=&gt;</span> {</span>
<span id="cb5-369"><a href="#cb5-369" aria-hidden="true" tabindex="-1"></a>    svg<span class="op">.</span><span class="fu">selectAll</span>(<span class="st">"#solar-system *"</span>)<span class="op">.</span><span class="fu">remove</span>()<span class="op">;</span></span>
<span id="cb5-370"><a href="#cb5-370" aria-hidden="true" tabindex="-1"></a>    svg<span class="op">.</span><span class="fu">selectAll</span>(<span class="st">"#solar-system"</span>)<span class="op">.</span><span class="fu">call</span>(solarSystem<span class="op">,</span></span>
<span id="cb5-371"><a href="#cb5-371" aria-hidden="true" tabindex="-1"></a>                                        columnWidth <span class="op">/</span> <span class="fl">1.1</span><span class="op">,</span></span>
<span id="cb5-372"><a href="#cb5-372" aria-hidden="true" tabindex="-1"></a>                                        location<span class="op">,</span></span>
<span id="cb5-373"><a href="#cb5-373" aria-hidden="true" tabindex="-1"></a>                                        selection<span class="op">.</span><span class="at">date</span><span class="op">,</span></span>
<span id="cb5-374"><a href="#cb5-374" aria-hidden="true" tabindex="-1"></a>                                        selection<span class="op">.</span><span class="at">hour</span>)<span class="op">;</span></span>
<span id="cb5-375"><a href="#cb5-375" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb5-376"><a href="#cb5-376" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> setSelection <span class="op">=</span> (newSelection<span class="op">,</span> forceRender <span class="op">=</span> <span class="kw">false</span>) <span class="kw">=&gt;</span> {</span>
<span id="cb5-377"><a href="#cb5-377" aria-hidden="true" tabindex="-1"></a>    <span class="kw">const</span> prev <span class="op">=</span> {<span class="op">...</span>selection}<span class="op">;</span></span>
<span id="cb5-378"><a href="#cb5-378" aria-hidden="true" tabindex="-1"></a>    selection <span class="op">=</span> newSelection<span class="op">;</span></span>
<span id="cb5-379"><a href="#cb5-379" aria-hidden="true" tabindex="-1"></a>    svg<span class="op">.</span><span class="fu">node</span>()<span class="op">.</span><span class="at">value</span> <span class="op">=</span> selection<span class="op">;</span></span>
<span id="cb5-380"><a href="#cb5-380" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> (forceRender) {</span>
<span id="cb5-381"><a href="#cb5-381" aria-hidden="true" tabindex="-1"></a>      <span class="fu">renderPlot</span>()<span class="op">;</span></span>
<span id="cb5-382"><a href="#cb5-382" aria-hidden="true" tabindex="-1"></a>      <span class="fu">renderSolarSystem</span>()<span class="op">;</span></span>
<span id="cb5-383"><a href="#cb5-383" aria-hidden="true" tabindex="-1"></a>      <span class="fu">renderGlobe</span>()<span class="op">;</span></span>
<span id="cb5-384"><a href="#cb5-384" aria-hidden="true" tabindex="-1"></a>    } <span class="cf">else</span> <span class="cf">if</span> (prev<span class="op">.</span><span class="at">hour</span> <span class="op">!==</span> selection<span class="op">.</span><span class="at">hour</span> <span class="op">||</span> prev<span class="op">.</span><span class="at">date</span> <span class="op">!==</span> selection<span class="op">.</span><span class="at">date</span>) {</span>
<span id="cb5-385"><a href="#cb5-385" aria-hidden="true" tabindex="-1"></a>      <span class="fu">renderSolarSystem</span>()<span class="op">;</span></span>
<span id="cb5-386"><a href="#cb5-386" aria-hidden="true" tabindex="-1"></a>      <span class="fu">renderGlobe</span>()<span class="op">;</span></span>
<span id="cb5-387"><a href="#cb5-387" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb5-388"><a href="#cb5-388" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb5-389"><a href="#cb5-389" aria-hidden="true" tabindex="-1"></a>  svg<span class="op">.</span><span class="fu">append</span>(<span class="st">"g"</span>)</span>
<span id="cb5-390"><a href="#cb5-390" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">"id"</span><span class="op">,</span> <span class="st">"solar-system"</span>)</span>
<span id="cb5-391"><a href="#cb5-391" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">"transform"</span><span class="op">,</span> <span class="vs">`translate(</span><span class="sc">${</span>margin<span class="op">.</span><span class="at">left</span> <span class="op">+</span> <span class="dv">2</span><span class="sc">}</span><span class="vs">, </span><span class="sc">${</span>margin<span class="op">.</span><span class="at">top</span> <span class="op">+</span> height <span class="op">/</span> <span class="fl">7.5</span><span class="sc">}</span><span class="vs">)`</span>)<span class="op">;</span></span>
<span id="cb5-392"><a href="#cb5-392" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> plot <span class="op">=</span> svg<span class="op">.</span><span class="fu">append</span>(<span class="st">"g"</span>)</span>
<span id="cb5-393"><a href="#cb5-393" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">"id"</span><span class="op">,</span> <span class="st">"daylightplot"</span>)</span>
<span id="cb5-394"><a href="#cb5-394" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">"transform"</span><span class="op">,</span> <span class="vs">`translate(</span><span class="sc">${</span>margin<span class="op">.</span><span class="at">left</span><span class="sc">}</span><span class="vs">, </span><span class="sc">${</span>margin<span class="op">.</span><span class="at">top</span> <span class="op">+</span> height <span class="op">/</span> <span class="dv">4</span><span class="sc">}</span><span class="vs">)`</span>)<span class="op">;</span></span>
<span id="cb5-395"><a href="#cb5-395" aria-hidden="true" tabindex="-1"></a>  svg<span class="op">.</span><span class="fu">append</span>(<span class="st">"g"</span>)</span>
<span id="cb5-396"><a href="#cb5-396" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">"id"</span><span class="op">,</span> <span class="st">"globe"</span>)</span>
<span id="cb5-397"><a href="#cb5-397" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">"transform"</span><span class="op">,</span> <span class="vs">`translate(</span><span class="sc">${</span>margin<span class="op">.</span><span class="at">left</span> <span class="op">+</span> margin<span class="op">.</span><span class="at">inner</span> <span class="op">+</span> columnWidth <span class="op">/</span> <span class="fl">1.25</span><span class="sc">}</span><span class="vs">, </span><span class="sc">${</span>margin<span class="op">.</span><span class="at">top</span> <span class="op">+</span> <span class="bu">Number</span>(columnWidth <span class="op">&lt;</span> <span class="dv">300</span>) <span class="op">*</span> <span class="dv">12</span><span class="sc">}</span><span class="vs">)`</span>)<span class="op">;</span></span>
<span id="cb5-398"><a href="#cb5-398" aria-hidden="true" tabindex="-1"></a>  <span class="fu">setSelection</span>(selection<span class="op">,</span> <span class="kw">true</span>)<span class="op">;</span></span>
<span id="cb5-399"><a href="#cb5-399" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> handleDateHourChange <span class="op">=</span> ({ target<span class="op">,</span> <span class="dt">detail</span><span class="op">:</span> { date<span class="op">,</span> hour }}) <span class="kw">=&gt;</span> {</span>
<span id="cb5-400"><a href="#cb5-400" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> (date <span class="op">!=</span> <span class="kw">null</span> <span class="op">&amp;&amp;</span> hour <span class="op">!=</span> <span class="kw">null</span>) <span class="fu">setSelection</span>({<span class="op">...</span>selection<span class="op">,</span> date<span class="op">,</span> hour})<span class="op">;</span></span>
<span id="cb5-401"><a href="#cb5-401" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb5-402"><a href="#cb5-402" aria-hidden="true" tabindex="-1"></a>  svg<span class="op">.</span><span class="fu">node</span>()<span class="op">.</span><span class="fu">addEventListener</span>(EventType<span class="op">.</span><span class="at">DateHourChange</span><span class="op">,</span> handleDateHourChange<span class="op">,</span> <span class="kw">false</span>)<span class="op">;</span></span>
<span id="cb5-403"><a href="#cb5-403" aria-hidden="true" tabindex="-1"></a>  <span class="cf">return</span> svg<span class="op">.</span><span class="fu">node</span>()<span class="op">;</span></span>
<span id="cb5-404"><a href="#cb5-404" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb5-405"><a href="#cb5-405" aria-hidden="true" tabindex="-1"></a><span class="co">// https://observablehq.com/@d3/simple-clock</span></span>
<span id="cb5-406"><a href="#cb5-406" aria-hidden="true" tabindex="-1"></a><span class="co">// https://observablehq.com/@drio/lets-build-an-analog-clock</span></span>
<span id="cb5-407"><a href="#cb5-407" aria-hidden="true" tabindex="-1"></a>clock <span class="op">=</span> {</span>
<span id="cb5-408"><a href="#cb5-408" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> clockRadius <span class="op">=</span> <span class="dv">200</span><span class="op">,</span></span>
<span id="cb5-409"><a href="#cb5-409" aria-hidden="true" tabindex="-1"></a>    margin <span class="op">=</span> <span class="dv">50</span><span class="op">,</span></span>
<span id="cb5-410"><a href="#cb5-410" aria-hidden="true" tabindex="-1"></a>    w <span class="op">=</span> (clockRadius <span class="op">+</span> margin) <span class="op">*</span> <span class="dv">2</span><span class="op">,</span></span>
<span id="cb5-411"><a href="#cb5-411" aria-hidden="true" tabindex="-1"></a>    h <span class="op">=</span> (clockRadius <span class="op">+</span> margin) <span class="op">*</span> <span class="dv">2</span><span class="op">,</span></span>
<span id="cb5-412"><a href="#cb5-412" aria-hidden="true" tabindex="-1"></a>    hourHandLength <span class="op">=</span> (<span class="dv">2</span> <span class="op">*</span> clockRadius) <span class="op">/</span> <span class="dv">3</span><span class="op">,</span></span>
<span id="cb5-413"><a href="#cb5-413" aria-hidden="true" tabindex="-1"></a>    minuteHandLength <span class="op">=</span> clockRadius<span class="op">,</span></span>
<span id="cb5-414"><a href="#cb5-414" aria-hidden="true" tabindex="-1"></a>    secondHandLength <span class="op">=</span> clockRadius <span class="op">-</span> <span class="dv">12</span><span class="op">,</span></span>
<span id="cb5-415"><a href="#cb5-415" aria-hidden="true" tabindex="-1"></a>    secondHandBalance <span class="op">=</span> <span class="dv">30</span><span class="op">,</span></span>
<span id="cb5-416"><a href="#cb5-416" aria-hidden="true" tabindex="-1"></a>    secondTickStart <span class="op">=</span> clockRadius<span class="op">,</span></span>
<span id="cb5-417"><a href="#cb5-417" aria-hidden="true" tabindex="-1"></a>    secondTickLength <span class="op">=</span> <span class="op">-</span><span class="dv">10</span><span class="op">,</span></span>
<span id="cb5-418"><a href="#cb5-418" aria-hidden="true" tabindex="-1"></a>    hourTickStart <span class="op">=</span> clockRadius<span class="op">,</span></span>
<span id="cb5-419"><a href="#cb5-419" aria-hidden="true" tabindex="-1"></a>    hourTickLength <span class="op">=</span> <span class="op">-</span><span class="dv">18</span><span class="op">,</span></span>
<span id="cb5-420"><a href="#cb5-420" aria-hidden="true" tabindex="-1"></a>    secondLabelRadius <span class="op">=</span> clockRadius <span class="op">+</span> <span class="dv">16</span><span class="op">,</span></span>
<span id="cb5-421"><a href="#cb5-421" aria-hidden="true" tabindex="-1"></a>    secondLabelYOffset <span class="op">=</span> <span class="dv">5</span><span class="op">,</span></span>
<span id="cb5-422"><a href="#cb5-422" aria-hidden="true" tabindex="-1"></a>    hourLabelRadius <span class="op">=</span> clockRadius <span class="op">-</span> <span class="dv">40</span><span class="op">,</span></span>
<span id="cb5-423"><a href="#cb5-423" aria-hidden="true" tabindex="-1"></a>    hourLabelYOffset <span class="op">=</span> <span class="dv">7</span><span class="op">,</span></span>
<span id="cb5-424"><a href="#cb5-424" aria-hidden="true" tabindex="-1"></a>    radians <span class="op">=</span> <span class="bu">Math</span><span class="op">.</span><span class="cn">PI</span> <span class="op">/</span> <span class="dv">180</span><span class="op">;</span></span>
<span id="cb5-425"><a href="#cb5-425" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> ten <span class="op">=</span> d3</span>
<span id="cb5-426"><a href="#cb5-426" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">scaleLinear</span>()</span>
<span id="cb5-427"><a href="#cb5-427" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">range</span>([<span class="dv">0</span><span class="op">,</span> <span class="dv">360</span>])</span>
<span id="cb5-428"><a href="#cb5-428" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">domain</span>([<span class="dv">0</span><span class="op">,</span> <span class="dv">10</span>])<span class="op">;</span></span>
<span id="cb5-429"><a href="#cb5-429" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> sto <span class="op">=</span> d3</span>
<span id="cb5-430"><a href="#cb5-430" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">scaleLinear</span>()</span>
<span id="cb5-431"><a href="#cb5-431" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">range</span>([<span class="dv">0</span><span class="op">,</span> <span class="dv">360</span>])</span>
<span id="cb5-432"><a href="#cb5-432" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">domain</span>([<span class="dv">0</span><span class="op">,</span> <span class="dv">100</span>])<span class="op">;</span></span>
<span id="cb5-433"><a href="#cb5-433" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> handData <span class="op">=</span> [</span>
<span id="cb5-434"><a href="#cb5-434" aria-hidden="true" tabindex="-1"></a>    {</span>
<span id="cb5-435"><a href="#cb5-435" aria-hidden="true" tabindex="-1"></a>      <span class="dt">type</span><span class="op">:</span> <span class="st">"hour"</span><span class="op">,</span></span>
<span id="cb5-436"><a href="#cb5-436" aria-hidden="true" tabindex="-1"></a>      <span class="dt">value</span><span class="op">:</span> <span class="dv">0</span><span class="op">,</span></span>
<span id="cb5-437"><a href="#cb5-437" aria-hidden="true" tabindex="-1"></a>      <span class="dt">length</span><span class="op">:</span> <span class="op">-</span>hourHandLength<span class="op">,</span></span>
<span id="cb5-438"><a href="#cb5-438" aria-hidden="true" tabindex="-1"></a>      <span class="dt">scale</span><span class="op">:</span> ten</span>
<span id="cb5-439"><a href="#cb5-439" aria-hidden="true" tabindex="-1"></a>    }<span class="op">,</span></span>
<span id="cb5-440"><a href="#cb5-440" aria-hidden="true" tabindex="-1"></a>    {</span>
<span id="cb5-441"><a href="#cb5-441" aria-hidden="true" tabindex="-1"></a>      <span class="dt">type</span><span class="op">:</span> <span class="st">"minute"</span><span class="op">,</span></span>
<span id="cb5-442"><a href="#cb5-442" aria-hidden="true" tabindex="-1"></a>      <span class="dt">value</span><span class="op">:</span> <span class="dv">0</span><span class="op">,</span></span>
<span id="cb5-443"><a href="#cb5-443" aria-hidden="true" tabindex="-1"></a>      <span class="dt">length</span><span class="op">:</span> <span class="op">-</span>minuteHandLength<span class="op">,</span></span>
<span id="cb5-444"><a href="#cb5-444" aria-hidden="true" tabindex="-1"></a>      <span class="dt">scale</span><span class="op">:</span> sto</span>
<span id="cb5-445"><a href="#cb5-445" aria-hidden="true" tabindex="-1"></a>    }<span class="op">,</span></span>
<span id="cb5-446"><a href="#cb5-446" aria-hidden="true" tabindex="-1"></a>    {</span>
<span id="cb5-447"><a href="#cb5-447" aria-hidden="true" tabindex="-1"></a>      <span class="dt">type</span><span class="op">:</span> <span class="st">"second"</span><span class="op">,</span></span>
<span id="cb5-448"><a href="#cb5-448" aria-hidden="true" tabindex="-1"></a>      <span class="dt">value</span><span class="op">:</span> <span class="dv">0</span><span class="op">,</span></span>
<span id="cb5-449"><a href="#cb5-449" aria-hidden="true" tabindex="-1"></a>      <span class="dt">length</span><span class="op">:</span> <span class="op">-</span>secondHandLength<span class="op">,</span></span>
<span id="cb5-450"><a href="#cb5-450" aria-hidden="true" tabindex="-1"></a>      <span class="dt">scale</span><span class="op">:</span> sto<span class="op">,</span></span>
<span id="cb5-451"><a href="#cb5-451" aria-hidden="true" tabindex="-1"></a>      <span class="dt">balance</span><span class="op">:</span> secondHandBalance</span>
<span id="cb5-452"><a href="#cb5-452" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb5-453"><a href="#cb5-453" aria-hidden="true" tabindex="-1"></a>  ]<span class="op">;</span></span>
<span id="cb5-454"><a href="#cb5-454" aria-hidden="true" tabindex="-1"></a>  <span class="kw">function</span> <span class="fu">drawClock</span>() {</span>
<span id="cb5-455"><a href="#cb5-455" aria-hidden="true" tabindex="-1"></a>    <span class="co">// create all the clock elements</span></span>
<span id="cb5-456"><a href="#cb5-456" aria-hidden="true" tabindex="-1"></a>    <span class="fu">updateData</span>()<span class="op">;</span> <span class="co">//draw them in the correct starting position</span></span>
<span id="cb5-457"><a href="#cb5-457" aria-hidden="true" tabindex="-1"></a>    <span class="kw">const</span> face <span class="op">=</span> svg</span>
<span id="cb5-458"><a href="#cb5-458" aria-hidden="true" tabindex="-1"></a>      <span class="op">.</span><span class="fu">append</span>(<span class="st">"g"</span>)</span>
<span id="cb5-459"><a href="#cb5-459" aria-hidden="true" tabindex="-1"></a>      <span class="op">.</span><span class="fu">attr</span>(<span class="st">"id"</span><span class="op">,</span> <span class="st">"clock-face"</span>)</span>
<span id="cb5-460"><a href="#cb5-460" aria-hidden="true" tabindex="-1"></a>      <span class="op">.</span><span class="fu">attr</span>(<span class="st">"transform"</span><span class="op">,</span> <span class="vs">`translate(</span><span class="sc">${</span>[w <span class="op">/</span> <span class="dv">2</span><span class="op">,</span> h <span class="op">/</span> <span class="dv">2</span>]<span class="sc">}</span><span class="vs">)`</span>)<span class="op">;</span></span>
<span id="cb5-461"><a href="#cb5-461" aria-hidden="true" tabindex="-1"></a>    <span class="co">// add marks for seconds</span></span>
<span id="cb5-462"><a href="#cb5-462" aria-hidden="true" tabindex="-1"></a>    face</span>
<span id="cb5-463"><a href="#cb5-463" aria-hidden="true" tabindex="-1"></a>      <span class="op">.</span><span class="fu">selectAll</span>(<span class="st">".second-tick"</span>)</span>
<span id="cb5-464"><a href="#cb5-464" aria-hidden="true" tabindex="-1"></a>      <span class="op">.</span><span class="fu">data</span>(d3<span class="op">.</span><span class="fu">range</span>(<span class="dv">0</span><span class="op">,</span> <span class="dv">100</span>))</span>
<span id="cb5-465"><a href="#cb5-465" aria-hidden="true" tabindex="-1"></a>      <span class="op">.</span><span class="fu">enter</span>()</span>
<span id="cb5-466"><a href="#cb5-466" aria-hidden="true" tabindex="-1"></a>      <span class="op">.</span><span class="fu">append</span>(<span class="st">"line"</span>)</span>
<span id="cb5-467"><a href="#cb5-467" aria-hidden="true" tabindex="-1"></a>      <span class="op">.</span><span class="fu">attr</span>(<span class="st">"class"</span><span class="op">,</span> <span class="st">"second-tick"</span>)</span>
<span id="cb5-468"><a href="#cb5-468" aria-hidden="true" tabindex="-1"></a>      <span class="op">.</span><span class="fu">attr</span>(<span class="st">"x1"</span><span class="op">,</span> <span class="dv">0</span>)</span>
<span id="cb5-469"><a href="#cb5-469" aria-hidden="true" tabindex="-1"></a>      <span class="op">.</span><span class="fu">attr</span>(<span class="st">"x2"</span><span class="op">,</span> <span class="dv">0</span>)</span>
<span id="cb5-470"><a href="#cb5-470" aria-hidden="true" tabindex="-1"></a>      <span class="op">.</span><span class="fu">attr</span>(<span class="st">"y1"</span><span class="op">,</span> secondTickStart)</span>
<span id="cb5-471"><a href="#cb5-471" aria-hidden="true" tabindex="-1"></a>      <span class="op">.</span><span class="fu">attr</span>(<span class="st">"y2"</span><span class="op">,</span> secondTickStart <span class="op">+</span> secondTickLength)</span>
<span id="cb5-472"><a href="#cb5-472" aria-hidden="true" tabindex="-1"></a>      <span class="op">.</span><span class="fu">attr</span>(<span class="st">"transform"</span><span class="op">,</span> d <span class="kw">=&gt;</span> <span class="vs">`rotate(</span><span class="sc">${</span><span class="fu">sto</span>(d)<span class="sc">}</span><span class="vs">)`</span>)<span class="op">;</span></span>
<span id="cb5-473"><a href="#cb5-473" aria-hidden="true" tabindex="-1"></a>    <span class="co">// and labels...</span></span>
<span id="cb5-474"><a href="#cb5-474" aria-hidden="true" tabindex="-1"></a>    face</span>
<span id="cb5-475"><a href="#cb5-475" aria-hidden="true" tabindex="-1"></a>      <span class="op">.</span><span class="fu">selectAll</span>(<span class="st">".second-label"</span>)</span>
<span id="cb5-476"><a href="#cb5-476" aria-hidden="true" tabindex="-1"></a>      <span class="op">.</span><span class="fu">data</span>(d3<span class="op">.</span><span class="fu">range</span>(<span class="dv">0</span><span class="op">,</span> <span class="dv">100</span><span class="op">,</span> <span class="dv">5</span>))</span>
<span id="cb5-477"><a href="#cb5-477" aria-hidden="true" tabindex="-1"></a>      <span class="op">.</span><span class="fu">enter</span>()</span>
<span id="cb5-478"><a href="#cb5-478" aria-hidden="true" tabindex="-1"></a>      <span class="op">.</span><span class="fu">append</span>(<span class="st">"text"</span>)</span>
<span id="cb5-479"><a href="#cb5-479" aria-hidden="true" tabindex="-1"></a>      <span class="op">.</span><span class="fu">attr</span>(<span class="st">"class"</span><span class="op">,</span> <span class="st">"second-label"</span>)</span>
<span id="cb5-480"><a href="#cb5-480" aria-hidden="true" tabindex="-1"></a>      <span class="op">.</span><span class="fu">attr</span>(<span class="st">"text-anchor"</span><span class="op">,</span> <span class="st">"middle"</span>)</span>
<span id="cb5-481"><a href="#cb5-481" aria-hidden="true" tabindex="-1"></a>      <span class="op">.</span><span class="fu">attr</span>(<span class="st">"x"</span><span class="op">,</span> d <span class="kw">=&gt;</span> secondLabelRadius <span class="op">*</span> <span class="bu">Math</span><span class="op">.</span><span class="fu">sin</span>(<span class="fu">sto</span>(d) <span class="op">*</span> radians))</span>
<span id="cb5-482"><a href="#cb5-482" aria-hidden="true" tabindex="-1"></a>      <span class="op">.</span><span class="fu">attr</span>(</span>
<span id="cb5-483"><a href="#cb5-483" aria-hidden="true" tabindex="-1"></a>        <span class="st">"y"</span><span class="op">,</span></span>
<span id="cb5-484"><a href="#cb5-484" aria-hidden="true" tabindex="-1"></a>        d <span class="kw">=&gt;</span></span>
<span id="cb5-485"><a href="#cb5-485" aria-hidden="true" tabindex="-1"></a>          <span class="op">-</span>secondLabelRadius <span class="op">*</span> <span class="bu">Math</span><span class="op">.</span><span class="fu">cos</span>(<span class="fu">sto</span>(d) <span class="op">*</span> radians) <span class="op">+</span> secondLabelYOffset</span>
<span id="cb5-486"><a href="#cb5-486" aria-hidden="true" tabindex="-1"></a>      )</span>
<span id="cb5-487"><a href="#cb5-487" aria-hidden="true" tabindex="-1"></a>      <span class="op">.</span><span class="fu">text</span>(d <span class="kw">=&gt;</span> d)<span class="op">;</span></span>
<span id="cb5-488"><a href="#cb5-488" aria-hidden="true" tabindex="-1"></a>    <span class="co">// ... and hours</span></span>
<span id="cb5-489"><a href="#cb5-489" aria-hidden="true" tabindex="-1"></a>    face</span>
<span id="cb5-490"><a href="#cb5-490" aria-hidden="true" tabindex="-1"></a>      <span class="op">.</span><span class="fu">selectAll</span>(<span class="st">".hour-tick"</span>)</span>
<span id="cb5-491"><a href="#cb5-491" aria-hidden="true" tabindex="-1"></a>      <span class="op">.</span><span class="fu">data</span>(d3<span class="op">.</span><span class="fu">range</span>(<span class="dv">0</span><span class="op">,</span> <span class="dv">10</span><span class="op">,</span> <span class="dv">1</span>))</span>
<span id="cb5-492"><a href="#cb5-492" aria-hidden="true" tabindex="-1"></a>      <span class="op">.</span><span class="fu">enter</span>()</span>
<span id="cb5-493"><a href="#cb5-493" aria-hidden="true" tabindex="-1"></a>      <span class="op">.</span><span class="fu">append</span>(<span class="st">"line"</span>)</span>
<span id="cb5-494"><a href="#cb5-494" aria-hidden="true" tabindex="-1"></a>      <span class="op">.</span><span class="fu">attr</span>(<span class="st">"class"</span><span class="op">,</span> <span class="st">"hour-tick"</span>)</span>
<span id="cb5-495"><a href="#cb5-495" aria-hidden="true" tabindex="-1"></a>      <span class="op">.</span><span class="fu">attr</span>(<span class="st">"x1"</span><span class="op">,</span> <span class="dv">0</span>)</span>
<span id="cb5-496"><a href="#cb5-496" aria-hidden="true" tabindex="-1"></a>      <span class="op">.</span><span class="fu">attr</span>(<span class="st">"x2"</span><span class="op">,</span> <span class="dv">0</span>)</span>
<span id="cb5-497"><a href="#cb5-497" aria-hidden="true" tabindex="-1"></a>      <span class="op">.</span><span class="fu">attr</span>(<span class="st">"y1"</span><span class="op">,</span> hourTickStart)</span>
<span id="cb5-498"><a href="#cb5-498" aria-hidden="true" tabindex="-1"></a>      <span class="op">.</span><span class="fu">attr</span>(<span class="st">"y2"</span><span class="op">,</span> hourTickStart <span class="op">+</span> hourTickLength)</span>
<span id="cb5-499"><a href="#cb5-499" aria-hidden="true" tabindex="-1"></a>      <span class="op">.</span><span class="fu">attr</span>(<span class="st">"transform"</span><span class="op">,</span> d <span class="kw">=&gt;</span> <span class="vs">`rotate(</span><span class="sc">${</span><span class="fu">ten</span>(d)<span class="sc">}</span><span class="vs">)`</span>)<span class="op">;</span></span>
<span id="cb5-500"><a href="#cb5-500" aria-hidden="true" tabindex="-1"></a>    face</span>
<span id="cb5-501"><a href="#cb5-501" aria-hidden="true" tabindex="-1"></a>      <span class="op">.</span><span class="fu">selectAll</span>(<span class="st">".hour-label"</span>)</span>
<span id="cb5-502"><a href="#cb5-502" aria-hidden="true" tabindex="-1"></a>      <span class="op">.</span><span class="fu">data</span>(d3<span class="op">.</span><span class="fu">range</span>(<span class="dv">0</span><span class="op">,</span> <span class="dv">10</span><span class="op">,</span> <span class="dv">1</span>))</span>
<span id="cb5-503"><a href="#cb5-503" aria-hidden="true" tabindex="-1"></a>      <span class="op">.</span><span class="fu">enter</span>()</span>
<span id="cb5-504"><a href="#cb5-504" aria-hidden="true" tabindex="-1"></a>      <span class="op">.</span><span class="fu">append</span>(<span class="st">"text"</span>)</span>
<span id="cb5-505"><a href="#cb5-505" aria-hidden="true" tabindex="-1"></a>      <span class="op">.</span><span class="fu">attr</span>(<span class="st">"class"</span><span class="op">,</span> <span class="st">"hour-label"</span>)</span>
<span id="cb5-506"><a href="#cb5-506" aria-hidden="true" tabindex="-1"></a>      <span class="op">.</span><span class="fu">attr</span>(<span class="st">"text-anchor"</span><span class="op">,</span> <span class="st">"middle"</span>)</span>
<span id="cb5-507"><a href="#cb5-507" aria-hidden="true" tabindex="-1"></a>      <span class="op">.</span><span class="fu">attr</span>(<span class="st">"x"</span><span class="op">,</span> d <span class="kw">=&gt;</span> hourLabelRadius <span class="op">*</span> <span class="bu">Math</span><span class="op">.</span><span class="fu">sin</span>(<span class="fu">ten</span>(d) <span class="op">*</span> radians))</span>
<span id="cb5-508"><a href="#cb5-508" aria-hidden="true" tabindex="-1"></a>      <span class="op">.</span><span class="fu">attr</span>(</span>
<span id="cb5-509"><a href="#cb5-509" aria-hidden="true" tabindex="-1"></a>        <span class="st">"y"</span><span class="op">,</span></span>
<span id="cb5-510"><a href="#cb5-510" aria-hidden="true" tabindex="-1"></a>        d <span class="kw">=&gt;</span> <span class="op">-</span>hourLabelRadius <span class="op">*</span> <span class="bu">Math</span><span class="op">.</span><span class="fu">cos</span>(<span class="fu">ten</span>(d) <span class="op">*</span> radians) <span class="op">+</span> hourLabelYOffset</span>
<span id="cb5-511"><a href="#cb5-511" aria-hidden="true" tabindex="-1"></a>      )</span>
<span id="cb5-512"><a href="#cb5-512" aria-hidden="true" tabindex="-1"></a>      <span class="op">.</span><span class="fu">text</span>(d <span class="kw">=&gt;</span> d)<span class="op">;</span></span>
<span id="cb5-513"><a href="#cb5-513" aria-hidden="true" tabindex="-1"></a>    <span class="kw">const</span> hands <span class="op">=</span> face<span class="op">.</span><span class="fu">append</span>(<span class="st">"g"</span>)<span class="op">.</span><span class="fu">attr</span>(<span class="st">"id"</span><span class="op">,</span> <span class="st">"clock-hands"</span>)<span class="op">;</span></span>
<span id="cb5-514"><a href="#cb5-514" aria-hidden="true" tabindex="-1"></a>    hands</span>
<span id="cb5-515"><a href="#cb5-515" aria-hidden="true" tabindex="-1"></a>      <span class="op">.</span><span class="fu">selectAll</span>(<span class="st">"line"</span>)</span>
<span id="cb5-516"><a href="#cb5-516" aria-hidden="true" tabindex="-1"></a>      <span class="op">.</span><span class="fu">data</span>(handData)</span>
<span id="cb5-517"><a href="#cb5-517" aria-hidden="true" tabindex="-1"></a>      <span class="op">.</span><span class="fu">enter</span>()</span>
<span id="cb5-518"><a href="#cb5-518" aria-hidden="true" tabindex="-1"></a>      <span class="op">.</span><span class="fu">append</span>(<span class="st">"line"</span>)</span>
<span id="cb5-519"><a href="#cb5-519" aria-hidden="true" tabindex="-1"></a>      <span class="op">.</span><span class="fu">attr</span>(<span class="st">"class"</span><span class="op">,</span> d <span class="kw">=&gt;</span> d<span class="op">.</span><span class="at">type</span> <span class="op">+</span> <span class="st">"-hand"</span>)</span>
<span id="cb5-520"><a href="#cb5-520" aria-hidden="true" tabindex="-1"></a>      <span class="op">.</span><span class="fu">attr</span>(<span class="st">"x1"</span><span class="op">,</span> <span class="dv">0</span>)</span>
<span id="cb5-521"><a href="#cb5-521" aria-hidden="true" tabindex="-1"></a>      <span class="op">.</span><span class="fu">attr</span>(<span class="st">"y1"</span><span class="op">,</span> d <span class="kw">=&gt;</span> d<span class="op">.</span><span class="at">balance</span> <span class="op">||</span> <span class="dv">0</span>)</span>
<span id="cb5-522"><a href="#cb5-522" aria-hidden="true" tabindex="-1"></a>      <span class="op">.</span><span class="fu">attr</span>(<span class="st">"x2"</span><span class="op">,</span> <span class="dv">0</span>)</span>
<span id="cb5-523"><a href="#cb5-523" aria-hidden="true" tabindex="-1"></a>      <span class="op">.</span><span class="fu">attr</span>(<span class="st">"y2"</span><span class="op">,</span> d <span class="kw">=&gt;</span> d<span class="op">.</span><span class="at">length</span>)</span>
<span id="cb5-524"><a href="#cb5-524" aria-hidden="true" tabindex="-1"></a>      <span class="op">.</span><span class="fu">attr</span>(<span class="st">"transform"</span><span class="op">,</span> d <span class="kw">=&gt;</span> <span class="vs">`rotate(</span><span class="sc">${</span>d<span class="op">.</span><span class="fu">scale</span>(d<span class="op">.</span><span class="at">value</span>)<span class="sc">}</span><span class="vs">)`</span>)<span class="op">;</span></span>
<span id="cb5-525"><a href="#cb5-525" aria-hidden="true" tabindex="-1"></a>    face</span>
<span id="cb5-526"><a href="#cb5-526" aria-hidden="true" tabindex="-1"></a>      <span class="op">.</span><span class="fu">append</span>(<span class="st">"g"</span>)</span>
<span id="cb5-527"><a href="#cb5-527" aria-hidden="true" tabindex="-1"></a>      <span class="op">.</span><span class="fu">attr</span>(<span class="st">"id"</span><span class="op">,</span> <span class="st">"face-overlay"</span>)</span>
<span id="cb5-528"><a href="#cb5-528" aria-hidden="true" tabindex="-1"></a>      <span class="op">.</span><span class="fu">append</span>(<span class="st">"circle"</span>)</span>
<span id="cb5-529"><a href="#cb5-529" aria-hidden="true" tabindex="-1"></a>      <span class="op">.</span><span class="fu">attr</span>(<span class="st">"class"</span><span class="op">,</span> <span class="st">"hands-cover"</span>)</span>
<span id="cb5-530"><a href="#cb5-530" aria-hidden="true" tabindex="-1"></a>      <span class="op">.</span><span class="fu">attr</span>(<span class="st">"x"</span><span class="op">,</span> <span class="dv">0</span>)</span>
<span id="cb5-531"><a href="#cb5-531" aria-hidden="true" tabindex="-1"></a>      <span class="op">.</span><span class="fu">attr</span>(<span class="st">"y"</span><span class="op">,</span> <span class="dv">0</span>)</span>
<span id="cb5-532"><a href="#cb5-532" aria-hidden="true" tabindex="-1"></a>      <span class="op">.</span><span class="fu">attr</span>(<span class="st">"r"</span><span class="op">,</span> clockRadius <span class="op">/</span> <span class="dv">20</span>)<span class="op">;</span></span>
<span id="cb5-533"><a href="#cb5-533" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb5-534"><a href="#cb5-534" aria-hidden="true" tabindex="-1"></a>  <span class="kw">function</span> <span class="fu">moveHands</span>() {</span>
<span id="cb5-535"><a href="#cb5-535" aria-hidden="true" tabindex="-1"></a>    <span class="kw">const</span> sel <span class="op">=</span> d3</span>
<span id="cb5-536"><a href="#cb5-536" aria-hidden="true" tabindex="-1"></a>      <span class="op">.</span><span class="fu">select</span>(<span class="st">"#clock-hands-final"</span>)</span>
<span id="cb5-537"><a href="#cb5-537" aria-hidden="true" tabindex="-1"></a>      <span class="op">.</span><span class="fu">selectAll</span>(<span class="st">"line"</span>)</span>
<span id="cb5-538"><a href="#cb5-538" aria-hidden="true" tabindex="-1"></a>      <span class="op">.</span><span class="fu">data</span>(handData)</span>
<span id="cb5-539"><a href="#cb5-539" aria-hidden="true" tabindex="-1"></a>      <span class="op">.</span><span class="fu">transition</span>()<span class="op">;</span></span>
<span id="cb5-540"><a href="#cb5-540" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> (fancySecondsOFF) sel<span class="op">.</span><span class="fu">ease</span>(d3<span class="op">.</span><span class="at">easeElastic</span><span class="op">.</span><span class="fu">period</span>(<span class="fl">0.5</span>))<span class="op">;</span></span>
<span id="cb5-541"><a href="#cb5-541" aria-hidden="true" tabindex="-1"></a>    sel<span class="op">.</span><span class="fu">attr</span>(<span class="st">"transform"</span><span class="op">,</span> d <span class="kw">=&gt;</span> <span class="vs">`rotate(</span><span class="sc">${</span>d<span class="op">.</span><span class="fu">scale</span>(d<span class="op">.</span><span class="at">value</span>)<span class="sc">}</span><span class="vs">)`</span>)<span class="op">;</span></span>
<span id="cb5-542"><a href="#cb5-542" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb5-543"><a href="#cb5-543" aria-hidden="true" tabindex="-1"></a>  <span class="kw">function</span> <span class="fu">updateData</span>() {</span>
<span id="cb5-544"><a href="#cb5-544" aria-hidden="true" tabindex="-1"></a>    handData[<span class="dv">0</span>]<span class="op">.</span><span class="at">value</span> <span class="op">=</span> <span class="op">!</span>fancySecondsOFF <span class="op">?</span> <span class="bu">Math</span><span class="op">.</span><span class="fu">floor</span>(selectedExact <span class="op">*</span> <span class="dv">10</span>) <span class="op">:</span> decTime[<span class="dv">0</span>]<span class="op">;</span></span>
<span id="cb5-545"><a href="#cb5-545" aria-hidden="true" tabindex="-1"></a>    handData[<span class="dv">1</span>]<span class="op">.</span><span class="at">value</span> <span class="op">=</span> <span class="op">!</span>fancySecondsOFF <span class="op">?</span> <span class="bu">Math</span><span class="op">.</span><span class="fu">floor</span>(selectedExact <span class="op">*</span> <span class="dv">10</span> <span class="op">%</span> <span class="dv">1</span> <span class="op">*</span> <span class="dv">100</span>) <span class="op">:</span> decTime<span class="op">.</span><span class="fu">slice</span>(<span class="dv">2</span><span class="op">,</span> <span class="dv">4</span>)<span class="op">;</span></span>
<span id="cb5-546"><a href="#cb5-546" aria-hidden="true" tabindex="-1"></a>    handData[<span class="dv">2</span>]<span class="op">.</span><span class="at">value</span> <span class="op">=</span> <span class="op">!</span>fancySecondsOFF <span class="op">?</span> selectedExact <span class="op">*</span> <span class="dv">10</span> <span class="op">%</span> <span class="dv">1</span> <span class="op">*</span> <span class="dv">100</span> <span class="op">%</span> <span class="dv">1</span> <span class="op">*</span> <span class="dv">100</span> <span class="op">:</span> decTime<span class="op">.</span><span class="fu">slice</span>(<span class="dv">4</span><span class="op">,</span> <span class="dv">6</span>)<span class="op">;</span></span>
<span id="cb5-547"><a href="#cb5-547" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb5-548"><a href="#cb5-548" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> svg <span class="op">=</span> d3</span>
<span id="cb5-549"><a href="#cb5-549" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">create</span>(<span class="st">"svg"</span>)</span>
<span id="cb5-550"><a href="#cb5-550" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">"viewBox"</span><span class="op">,</span> [<span class="dv">0</span><span class="op">,</span> <span class="dv">0</span><span class="op">,</span> w<span class="op">,</span> h])</span>
<span id="cb5-551"><a href="#cb5-551" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">style</span>(<span class="st">"max-width"</span><span class="op">,</span> <span class="vs">`</span><span class="sc">${</span>width <span class="op">/</span> <span class="fl">2.1</span><span class="sc">}</span><span class="vs">px`</span>)</span>
<span id="cb5-552"><a href="#cb5-552" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">"class"</span><span class="op">,</span> <span class="st">"clock-top"</span>)</span>
<span id="cb5-553"><a href="#cb5-553" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">"id"</span><span class="op">,</span> <span class="st">"clock"</span>)<span class="op">;</span></span>
<span id="cb5-554"><a href="#cb5-554" aria-hidden="true" tabindex="-1"></a>  svg</span>
<span id="cb5-555"><a href="#cb5-555" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">append</span>(<span class="st">"text"</span>)</span>
<span id="cb5-556"><a href="#cb5-556" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">text</span>(<span class="vs">`+</span><span class="sc">${</span>decTime<span class="sc">}</span><span class="vs">-</span><span class="sc">${</span>selectedZone<span class="sc">}</span><span class="vs">`</span>)</span>
<span id="cb5-557"><a href="#cb5-557" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">"x"</span><span class="op">,</span> clockRadius <span class="op">+</span> margin)</span>
<span id="cb5-558"><a href="#cb5-558" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">"y"</span><span class="op">,</span> clockRadius <span class="op">*</span> <span class="dv">2</span> <span class="op">+</span> margin <span class="op">*</span> <span class="fl">1.975</span>)</span>
<span id="cb5-559"><a href="#cb5-559" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">"text-anchor"</span><span class="op">,</span> <span class="st">"middle"</span>)</span>
<span id="cb5-560"><a href="#cb5-560" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">"font-size"</span><span class="op">,</span> <span class="dv">32</span>)</span>
<span id="cb5-561"><a href="#cb5-561" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">"font-family"</span><span class="op">,</span> <span class="st">"monospace"</span>)<span class="op">;</span></span>
<span id="cb5-562"><a href="#cb5-562" aria-hidden="true" tabindex="-1"></a>  <span class="fu">drawClock</span>()<span class="op">;</span></span>
<span id="cb5-563"><a href="#cb5-563" aria-hidden="true" tabindex="-1"></a>  <span class="co">// Animation</span></span>
<span id="cb5-564"><a href="#cb5-564" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> interval <span class="op">=</span> <span class="pp">setInterval</span>(</span>
<span id="cb5-565"><a href="#cb5-565" aria-hidden="true" tabindex="-1"></a>    () <span class="kw">=&gt;</span> {</span>
<span id="cb5-566"><a href="#cb5-566" aria-hidden="true" tabindex="-1"></a>      <span class="fu">updateData</span>()<span class="op">;</span></span>
<span id="cb5-567"><a href="#cb5-567" aria-hidden="true" tabindex="-1"></a>      <span class="fu">moveHands</span>()<span class="op">;</span></span>
<span id="cb5-568"><a href="#cb5-568" aria-hidden="true" tabindex="-1"></a>    }<span class="op">,</span></span>
<span id="cb5-569"><a href="#cb5-569" aria-hidden="true" tabindex="-1"></a>    <span class="op">!</span>fancySecondsOFF <span class="op">?</span> <span class="dv">10</span> <span class="op">:</span> <span class="dv">864</span></span>
<span id="cb5-570"><a href="#cb5-570" aria-hidden="true" tabindex="-1"></a>  )<span class="op">;</span></span>
<span id="cb5-571"><a href="#cb5-571" aria-hidden="true" tabindex="-1"></a>  invalidation<span class="op">.</span><span class="fu">then</span>(() <span class="kw">=&gt;</span> <span class="pp">clearInterval</span>(interval))<span class="op">;</span></span>
<span id="cb5-572"><a href="#cb5-572" aria-hidden="true" tabindex="-1"></a>  <span class="cf">return</span> svg<span class="op">.</span><span class="fu">node</span>()<span class="op">;</span></span>
<span id="cb5-573"><a href="#cb5-573" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb5-574"><a href="#cb5-574" aria-hidden="true" tabindex="-1"></a>clock1 <span class="op">=</span> {</span>
<span id="cb5-575"><a href="#cb5-575" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> clockRadius <span class="op">=</span> <span class="dv">200</span><span class="op">,</span></span>
<span id="cb5-576"><a href="#cb5-576" aria-hidden="true" tabindex="-1"></a>    margin <span class="op">=</span> <span class="dv">50</span><span class="op">,</span></span>
<span id="cb5-577"><a href="#cb5-577" aria-hidden="true" tabindex="-1"></a>    w <span class="op">=</span> (clockRadius <span class="op">+</span> margin) <span class="op">*</span> <span class="dv">2</span><span class="op">,</span></span>
<span id="cb5-578"><a href="#cb5-578" aria-hidden="true" tabindex="-1"></a>    h <span class="op">=</span> (clockRadius <span class="op">+</span> margin) <span class="op">*</span> <span class="dv">2</span><span class="op">,</span></span>
<span id="cb5-579"><a href="#cb5-579" aria-hidden="true" tabindex="-1"></a>    hourHandLength <span class="op">=</span> (<span class="dv">2</span> <span class="op">*</span> clockRadius) <span class="op">/</span> <span class="dv">3</span><span class="op">,</span></span>
<span id="cb5-580"><a href="#cb5-580" aria-hidden="true" tabindex="-1"></a>    minuteHandLength <span class="op">=</span> clockRadius<span class="op">,</span></span>
<span id="cb5-581"><a href="#cb5-581" aria-hidden="true" tabindex="-1"></a>    secondHandLength <span class="op">=</span> clockRadius <span class="op">-</span> <span class="dv">12</span><span class="op">,</span></span>
<span id="cb5-582"><a href="#cb5-582" aria-hidden="true" tabindex="-1"></a>    secondHandBalance <span class="op">=</span> <span class="dv">30</span><span class="op">,</span></span>
<span id="cb5-583"><a href="#cb5-583" aria-hidden="true" tabindex="-1"></a>    secondTickStart <span class="op">=</span> clockRadius<span class="op">,</span></span>
<span id="cb5-584"><a href="#cb5-584" aria-hidden="true" tabindex="-1"></a>    secondTickLength <span class="op">=</span> <span class="op">-</span><span class="dv">10</span><span class="op">,</span></span>
<span id="cb5-585"><a href="#cb5-585" aria-hidden="true" tabindex="-1"></a>    hourTickStart <span class="op">=</span> clockRadius<span class="op">,</span></span>
<span id="cb5-586"><a href="#cb5-586" aria-hidden="true" tabindex="-1"></a>    hourTickLength <span class="op">=</span> <span class="op">-</span><span class="dv">18</span><span class="op">,</span></span>
<span id="cb5-587"><a href="#cb5-587" aria-hidden="true" tabindex="-1"></a>    secondLabelRadius <span class="op">=</span> clockRadius <span class="op">+</span> <span class="dv">16</span><span class="op">,</span></span>
<span id="cb5-588"><a href="#cb5-588" aria-hidden="true" tabindex="-1"></a>    secondLabelYOffset <span class="op">=</span> <span class="dv">5</span><span class="op">,</span></span>
<span id="cb5-589"><a href="#cb5-589" aria-hidden="true" tabindex="-1"></a>    hourLabelRadius <span class="op">=</span> clockRadius <span class="op">-</span> <span class="dv">40</span><span class="op">,</span></span>
<span id="cb5-590"><a href="#cb5-590" aria-hidden="true" tabindex="-1"></a>    hourLabelYOffset <span class="op">=</span> <span class="dv">7</span><span class="op">,</span></span>
<span id="cb5-591"><a href="#cb5-591" aria-hidden="true" tabindex="-1"></a>    radians <span class="op">=</span> <span class="bu">Math</span><span class="op">.</span><span class="cn">PI</span> <span class="op">/</span> <span class="dv">180</span><span class="op">;</span></span>
<span id="cb5-592"><a href="#cb5-592" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> ten <span class="op">=</span> d3</span>
<span id="cb5-593"><a href="#cb5-593" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">scaleLinear</span>()</span>
<span id="cb5-594"><a href="#cb5-594" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">range</span>([<span class="dv">0</span><span class="op">,</span> <span class="dv">360</span>])</span>
<span id="cb5-595"><a href="#cb5-595" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">domain</span>([<span class="dv">0</span><span class="op">,</span> <span class="dv">10</span>])<span class="op">;</span></span>
<span id="cb5-596"><a href="#cb5-596" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> sto <span class="op">=</span> d3</span>
<span id="cb5-597"><a href="#cb5-597" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">scaleLinear</span>()</span>
<span id="cb5-598"><a href="#cb5-598" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">range</span>([<span class="dv">0</span><span class="op">,</span> <span class="dv">360</span>])</span>
<span id="cb5-599"><a href="#cb5-599" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">domain</span>([<span class="dv">0</span><span class="op">,</span> <span class="dv">100</span>])<span class="op">;</span></span>
<span id="cb5-600"><a href="#cb5-600" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> handData <span class="op">=</span> [</span>
<span id="cb5-601"><a href="#cb5-601" aria-hidden="true" tabindex="-1"></a>    {</span>
<span id="cb5-602"><a href="#cb5-602" aria-hidden="true" tabindex="-1"></a>      <span class="dt">type</span><span class="op">:</span> <span class="st">"hour"</span><span class="op">,</span></span>
<span id="cb5-603"><a href="#cb5-603" aria-hidden="true" tabindex="-1"></a>      <span class="dt">value</span><span class="op">:</span> <span class="dv">0</span><span class="op">,</span></span>
<span id="cb5-604"><a href="#cb5-604" aria-hidden="true" tabindex="-1"></a>      <span class="dt">length</span><span class="op">:</span> <span class="op">-</span>hourHandLength<span class="op">,</span></span>
<span id="cb5-605"><a href="#cb5-605" aria-hidden="true" tabindex="-1"></a>      <span class="dt">scale</span><span class="op">:</span> ten</span>
<span id="cb5-606"><a href="#cb5-606" aria-hidden="true" tabindex="-1"></a>    }<span class="op">,</span></span>
<span id="cb5-607"><a href="#cb5-607" aria-hidden="true" tabindex="-1"></a>    {</span>
<span id="cb5-608"><a href="#cb5-608" aria-hidden="true" tabindex="-1"></a>      <span class="dt">type</span><span class="op">:</span> <span class="st">"minute"</span><span class="op">,</span></span>
<span id="cb5-609"><a href="#cb5-609" aria-hidden="true" tabindex="-1"></a>      <span class="dt">value</span><span class="op">:</span> <span class="dv">0</span><span class="op">,</span></span>
<span id="cb5-610"><a href="#cb5-610" aria-hidden="true" tabindex="-1"></a>      <span class="dt">length</span><span class="op">:</span> <span class="op">-</span>minuteHandLength<span class="op">,</span></span>
<span id="cb5-611"><a href="#cb5-611" aria-hidden="true" tabindex="-1"></a>      <span class="dt">scale</span><span class="op">:</span> sto</span>
<span id="cb5-612"><a href="#cb5-612" aria-hidden="true" tabindex="-1"></a>    }<span class="op">,</span></span>
<span id="cb5-613"><a href="#cb5-613" aria-hidden="true" tabindex="-1"></a>    {</span>
<span id="cb5-614"><a href="#cb5-614" aria-hidden="true" tabindex="-1"></a>      <span class="dt">type</span><span class="op">:</span> <span class="st">"second"</span><span class="op">,</span></span>
<span id="cb5-615"><a href="#cb5-615" aria-hidden="true" tabindex="-1"></a>      <span class="dt">value</span><span class="op">:</span> <span class="dv">0</span><span class="op">,</span></span>
<span id="cb5-616"><a href="#cb5-616" aria-hidden="true" tabindex="-1"></a>      <span class="dt">length</span><span class="op">:</span> <span class="op">-</span>secondHandLength<span class="op">,</span></span>
<span id="cb5-617"><a href="#cb5-617" aria-hidden="true" tabindex="-1"></a>      <span class="dt">scale</span><span class="op">:</span> sto<span class="op">,</span></span>
<span id="cb5-618"><a href="#cb5-618" aria-hidden="true" tabindex="-1"></a>      <span class="dt">balance</span><span class="op">:</span> secondHandBalance</span>
<span id="cb5-619"><a href="#cb5-619" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb5-620"><a href="#cb5-620" aria-hidden="true" tabindex="-1"></a>  ]<span class="op">;</span></span>
<span id="cb5-621"><a href="#cb5-621" aria-hidden="true" tabindex="-1"></a>  <span class="kw">function</span> <span class="fu">drawClock</span>() {</span>
<span id="cb5-622"><a href="#cb5-622" aria-hidden="true" tabindex="-1"></a>    <span class="co">// create all the clock elements</span></span>
<span id="cb5-623"><a href="#cb5-623" aria-hidden="true" tabindex="-1"></a>    <span class="fu">updateData</span>()<span class="op">;</span> <span class="co">//draw them in the correct starting position</span></span>
<span id="cb5-624"><a href="#cb5-624" aria-hidden="true" tabindex="-1"></a>    <span class="kw">const</span> face <span class="op">=</span> svg</span>
<span id="cb5-625"><a href="#cb5-625" aria-hidden="true" tabindex="-1"></a>      <span class="op">.</span><span class="fu">append</span>(<span class="st">"g"</span>)</span>
<span id="cb5-626"><a href="#cb5-626" aria-hidden="true" tabindex="-1"></a>      <span class="op">.</span><span class="fu">attr</span>(<span class="st">"id"</span><span class="op">,</span> <span class="st">"clock-face"</span>)</span>
<span id="cb5-627"><a href="#cb5-627" aria-hidden="true" tabindex="-1"></a>      <span class="op">.</span><span class="fu">attr</span>(<span class="st">"transform"</span><span class="op">,</span> <span class="vs">`translate(</span><span class="sc">${</span>[w <span class="op">/</span> <span class="dv">2</span><span class="op">,</span> h <span class="op">/</span> <span class="dv">2</span>]<span class="sc">}</span><span class="vs">)`</span>)<span class="op">;</span></span>
<span id="cb5-628"><a href="#cb5-628" aria-hidden="true" tabindex="-1"></a>    <span class="co">// add marks for seconds</span></span>
<span id="cb5-629"><a href="#cb5-629" aria-hidden="true" tabindex="-1"></a>    face</span>
<span id="cb5-630"><a href="#cb5-630" aria-hidden="true" tabindex="-1"></a>      <span class="op">.</span><span class="fu">selectAll</span>(<span class="st">".second-tick"</span>)</span>
<span id="cb5-631"><a href="#cb5-631" aria-hidden="true" tabindex="-1"></a>      <span class="op">.</span><span class="fu">data</span>(d3<span class="op">.</span><span class="fu">range</span>(<span class="dv">0</span><span class="op">,</span> <span class="dv">100</span>))</span>
<span id="cb5-632"><a href="#cb5-632" aria-hidden="true" tabindex="-1"></a>      <span class="op">.</span><span class="fu">enter</span>()</span>
<span id="cb5-633"><a href="#cb5-633" aria-hidden="true" tabindex="-1"></a>      <span class="op">.</span><span class="fu">append</span>(<span class="st">"line"</span>)</span>
<span id="cb5-634"><a href="#cb5-634" aria-hidden="true" tabindex="-1"></a>      <span class="op">.</span><span class="fu">attr</span>(<span class="st">"class"</span><span class="op">,</span> <span class="st">"second-tick"</span>)</span>
<span id="cb5-635"><a href="#cb5-635" aria-hidden="true" tabindex="-1"></a>      <span class="op">.</span><span class="fu">attr</span>(<span class="st">"x1"</span><span class="op">,</span> <span class="dv">0</span>)</span>
<span id="cb5-636"><a href="#cb5-636" aria-hidden="true" tabindex="-1"></a>      <span class="op">.</span><span class="fu">attr</span>(<span class="st">"x2"</span><span class="op">,</span> <span class="dv">0</span>)</span>
<span id="cb5-637"><a href="#cb5-637" aria-hidden="true" tabindex="-1"></a>      <span class="op">.</span><span class="fu">attr</span>(<span class="st">"y1"</span><span class="op">,</span> secondTickStart)</span>
<span id="cb5-638"><a href="#cb5-638" aria-hidden="true" tabindex="-1"></a>      <span class="op">.</span><span class="fu">attr</span>(<span class="st">"y2"</span><span class="op">,</span> secondTickStart <span class="op">+</span> secondTickLength)</span>
<span id="cb5-639"><a href="#cb5-639" aria-hidden="true" tabindex="-1"></a>      <span class="op">.</span><span class="fu">attr</span>(<span class="st">"transform"</span><span class="op">,</span> d <span class="kw">=&gt;</span> <span class="vs">`rotate(</span><span class="sc">${</span><span class="fu">sto</span>(d)<span class="sc">}</span><span class="vs">)`</span>)<span class="op">;</span></span>
<span id="cb5-640"><a href="#cb5-640" aria-hidden="true" tabindex="-1"></a>    <span class="co">// and labels...</span></span>
<span id="cb5-641"><a href="#cb5-641" aria-hidden="true" tabindex="-1"></a>    face</span>
<span id="cb5-642"><a href="#cb5-642" aria-hidden="true" tabindex="-1"></a>      <span class="op">.</span><span class="fu">selectAll</span>(<span class="st">".second-label"</span>)</span>
<span id="cb5-643"><a href="#cb5-643" aria-hidden="true" tabindex="-1"></a>      <span class="op">.</span><span class="fu">data</span>(d3<span class="op">.</span><span class="fu">range</span>(<span class="dv">0</span><span class="op">,</span> <span class="dv">100</span><span class="op">,</span> <span class="dv">5</span>))</span>
<span id="cb5-644"><a href="#cb5-644" aria-hidden="true" tabindex="-1"></a>      <span class="op">.</span><span class="fu">enter</span>()</span>
<span id="cb5-645"><a href="#cb5-645" aria-hidden="true" tabindex="-1"></a>      <span class="op">.</span><span class="fu">append</span>(<span class="st">"text"</span>)</span>
<span id="cb5-646"><a href="#cb5-646" aria-hidden="true" tabindex="-1"></a>      <span class="op">.</span><span class="fu">attr</span>(<span class="st">"class"</span><span class="op">,</span> <span class="st">"second-label"</span>)</span>
<span id="cb5-647"><a href="#cb5-647" aria-hidden="true" tabindex="-1"></a>      <span class="op">.</span><span class="fu">attr</span>(<span class="st">"text-anchor"</span><span class="op">,</span> <span class="st">"middle"</span>)</span>
<span id="cb5-648"><a href="#cb5-648" aria-hidden="true" tabindex="-1"></a>      <span class="op">.</span><span class="fu">attr</span>(<span class="st">"x"</span><span class="op">,</span> d <span class="kw">=&gt;</span> secondLabelRadius <span class="op">*</span> <span class="bu">Math</span><span class="op">.</span><span class="fu">sin</span>(<span class="fu">sto</span>(d) <span class="op">*</span> radians))</span>
<span id="cb5-649"><a href="#cb5-649" aria-hidden="true" tabindex="-1"></a>      <span class="op">.</span><span class="fu">attr</span>(</span>
<span id="cb5-650"><a href="#cb5-650" aria-hidden="true" tabindex="-1"></a>        <span class="st">"y"</span><span class="op">,</span></span>
<span id="cb5-651"><a href="#cb5-651" aria-hidden="true" tabindex="-1"></a>        d <span class="kw">=&gt;</span></span>
<span id="cb5-652"><a href="#cb5-652" aria-hidden="true" tabindex="-1"></a>          <span class="op">-</span>secondLabelRadius <span class="op">*</span> <span class="bu">Math</span><span class="op">.</span><span class="fu">cos</span>(<span class="fu">sto</span>(d) <span class="op">*</span> radians) <span class="op">+</span> secondLabelYOffset</span>
<span id="cb5-653"><a href="#cb5-653" aria-hidden="true" tabindex="-1"></a>      )</span>
<span id="cb5-654"><a href="#cb5-654" aria-hidden="true" tabindex="-1"></a>      <span class="op">.</span><span class="fu">text</span>(d <span class="kw">=&gt;</span> d)<span class="op">;</span></span>
<span id="cb5-655"><a href="#cb5-655" aria-hidden="true" tabindex="-1"></a>    <span class="co">// ... and hours</span></span>
<span id="cb5-656"><a href="#cb5-656" aria-hidden="true" tabindex="-1"></a>    face</span>
<span id="cb5-657"><a href="#cb5-657" aria-hidden="true" tabindex="-1"></a>      <span class="op">.</span><span class="fu">selectAll</span>(<span class="st">".hour-tick"</span>)</span>
<span id="cb5-658"><a href="#cb5-658" aria-hidden="true" tabindex="-1"></a>      <span class="op">.</span><span class="fu">data</span>(d3<span class="op">.</span><span class="fu">range</span>(<span class="dv">0</span><span class="op">,</span> <span class="dv">10</span><span class="op">,</span> <span class="dv">1</span>))</span>
<span id="cb5-659"><a href="#cb5-659" aria-hidden="true" tabindex="-1"></a>      <span class="op">.</span><span class="fu">enter</span>()</span>
<span id="cb5-660"><a href="#cb5-660" aria-hidden="true" tabindex="-1"></a>      <span class="op">.</span><span class="fu">append</span>(<span class="st">"line"</span>)</span>
<span id="cb5-661"><a href="#cb5-661" aria-hidden="true" tabindex="-1"></a>      <span class="op">.</span><span class="fu">attr</span>(<span class="st">"class"</span><span class="op">,</span> <span class="st">"hour-tick"</span>)</span>
<span id="cb5-662"><a href="#cb5-662" aria-hidden="true" tabindex="-1"></a>      <span class="op">.</span><span class="fu">attr</span>(<span class="st">"x1"</span><span class="op">,</span> <span class="dv">0</span>)</span>
<span id="cb5-663"><a href="#cb5-663" aria-hidden="true" tabindex="-1"></a>      <span class="op">.</span><span class="fu">attr</span>(<span class="st">"x2"</span><span class="op">,</span> <span class="dv">0</span>)</span>
<span id="cb5-664"><a href="#cb5-664" aria-hidden="true" tabindex="-1"></a>      <span class="op">.</span><span class="fu">attr</span>(<span class="st">"y1"</span><span class="op">,</span> hourTickStart)</span>
<span id="cb5-665"><a href="#cb5-665" aria-hidden="true" tabindex="-1"></a>      <span class="op">.</span><span class="fu">attr</span>(<span class="st">"y2"</span><span class="op">,</span> hourTickStart <span class="op">+</span> hourTickLength)</span>
<span id="cb5-666"><a href="#cb5-666" aria-hidden="true" tabindex="-1"></a>      <span class="op">.</span><span class="fu">attr</span>(<span class="st">"transform"</span><span class="op">,</span> d <span class="kw">=&gt;</span> <span class="vs">`rotate(</span><span class="sc">${</span><span class="fu">ten</span>(d)<span class="sc">}</span><span class="vs">)`</span>)<span class="op">;</span></span>
<span id="cb5-667"><a href="#cb5-667" aria-hidden="true" tabindex="-1"></a>    face</span>
<span id="cb5-668"><a href="#cb5-668" aria-hidden="true" tabindex="-1"></a>      <span class="op">.</span><span class="fu">selectAll</span>(<span class="st">".hour-label"</span>)</span>
<span id="cb5-669"><a href="#cb5-669" aria-hidden="true" tabindex="-1"></a>      <span class="op">.</span><span class="fu">data</span>(d3<span class="op">.</span><span class="fu">range</span>(<span class="dv">0</span><span class="op">,</span> <span class="dv">10</span><span class="op">,</span> <span class="dv">1</span>))</span>
<span id="cb5-670"><a href="#cb5-670" aria-hidden="true" tabindex="-1"></a>      <span class="op">.</span><span class="fu">enter</span>()</span>
<span id="cb5-671"><a href="#cb5-671" aria-hidden="true" tabindex="-1"></a>      <span class="op">.</span><span class="fu">append</span>(<span class="st">"text"</span>)</span>
<span id="cb5-672"><a href="#cb5-672" aria-hidden="true" tabindex="-1"></a>      <span class="op">.</span><span class="fu">attr</span>(<span class="st">"class"</span><span class="op">,</span> <span class="st">"hour-label"</span>)</span>
<span id="cb5-673"><a href="#cb5-673" aria-hidden="true" tabindex="-1"></a>      <span class="op">.</span><span class="fu">attr</span>(<span class="st">"text-anchor"</span><span class="op">,</span> <span class="st">"middle"</span>)</span>
<span id="cb5-674"><a href="#cb5-674" aria-hidden="true" tabindex="-1"></a>      <span class="op">.</span><span class="fu">attr</span>(<span class="st">"x"</span><span class="op">,</span> d <span class="kw">=&gt;</span> hourLabelRadius <span class="op">*</span> <span class="bu">Math</span><span class="op">.</span><span class="fu">sin</span>(<span class="fu">ten</span>(d) <span class="op">*</span> radians))</span>
<span id="cb5-675"><a href="#cb5-675" aria-hidden="true" tabindex="-1"></a>      <span class="op">.</span><span class="fu">attr</span>(</span>
<span id="cb5-676"><a href="#cb5-676" aria-hidden="true" tabindex="-1"></a>        <span class="st">"y"</span><span class="op">,</span></span>
<span id="cb5-677"><a href="#cb5-677" aria-hidden="true" tabindex="-1"></a>        d <span class="kw">=&gt;</span> <span class="op">-</span>hourLabelRadius <span class="op">*</span> <span class="bu">Math</span><span class="op">.</span><span class="fu">cos</span>(<span class="fu">ten</span>(d) <span class="op">*</span> radians) <span class="op">+</span> hourLabelYOffset</span>
<span id="cb5-678"><a href="#cb5-678" aria-hidden="true" tabindex="-1"></a>      )</span>
<span id="cb5-679"><a href="#cb5-679" aria-hidden="true" tabindex="-1"></a>      <span class="op">.</span><span class="fu">text</span>(d <span class="kw">=&gt;</span> d)<span class="op">;</span></span>
<span id="cb5-680"><a href="#cb5-680" aria-hidden="true" tabindex="-1"></a>    <span class="kw">const</span> hands <span class="op">=</span> face<span class="op">.</span><span class="fu">append</span>(<span class="st">"g"</span>)<span class="op">.</span><span class="fu">attr</span>(<span class="st">"id"</span><span class="op">,</span> <span class="st">"clock-hands"</span>)<span class="op">;</span></span>
<span id="cb5-681"><a href="#cb5-681" aria-hidden="true" tabindex="-1"></a>    hands</span>
<span id="cb5-682"><a href="#cb5-682" aria-hidden="true" tabindex="-1"></a>      <span class="op">.</span><span class="fu">selectAll</span>(<span class="st">"line"</span>)</span>
<span id="cb5-683"><a href="#cb5-683" aria-hidden="true" tabindex="-1"></a>      <span class="op">.</span><span class="fu">data</span>(handData)</span>
<span id="cb5-684"><a href="#cb5-684" aria-hidden="true" tabindex="-1"></a>      <span class="op">.</span><span class="fu">enter</span>()</span>
<span id="cb5-685"><a href="#cb5-685" aria-hidden="true" tabindex="-1"></a>      <span class="op">.</span><span class="fu">append</span>(<span class="st">"line"</span>)</span>
<span id="cb5-686"><a href="#cb5-686" aria-hidden="true" tabindex="-1"></a>      <span class="op">.</span><span class="fu">attr</span>(<span class="st">"class"</span><span class="op">,</span> d <span class="kw">=&gt;</span> d<span class="op">.</span><span class="at">type</span> <span class="op">+</span> <span class="st">"-hand"</span>)</span>
<span id="cb5-687"><a href="#cb5-687" aria-hidden="true" tabindex="-1"></a>      <span class="op">.</span><span class="fu">attr</span>(<span class="st">"x1"</span><span class="op">,</span> <span class="dv">0</span>)</span>
<span id="cb5-688"><a href="#cb5-688" aria-hidden="true" tabindex="-1"></a>      <span class="op">.</span><span class="fu">attr</span>(<span class="st">"y1"</span><span class="op">,</span> d <span class="kw">=&gt;</span> d<span class="op">.</span><span class="at">balance</span> <span class="op">||</span> <span class="dv">0</span>)</span>
<span id="cb5-689"><a href="#cb5-689" aria-hidden="true" tabindex="-1"></a>      <span class="op">.</span><span class="fu">attr</span>(<span class="st">"x2"</span><span class="op">,</span> <span class="dv">0</span>)</span>
<span id="cb5-690"><a href="#cb5-690" aria-hidden="true" tabindex="-1"></a>      <span class="op">.</span><span class="fu">attr</span>(<span class="st">"y2"</span><span class="op">,</span> d <span class="kw">=&gt;</span> d<span class="op">.</span><span class="at">length</span>)</span>
<span id="cb5-691"><a href="#cb5-691" aria-hidden="true" tabindex="-1"></a>      <span class="op">.</span><span class="fu">attr</span>(<span class="st">"transform"</span><span class="op">,</span> d <span class="kw">=&gt;</span> <span class="vs">`rotate(</span><span class="sc">${</span>d<span class="op">.</span><span class="fu">scale</span>(d<span class="op">.</span><span class="at">value</span>)<span class="sc">}</span><span class="vs">)`</span>)<span class="op">;</span></span>
<span id="cb5-692"><a href="#cb5-692" aria-hidden="true" tabindex="-1"></a>    face</span>
<span id="cb5-693"><a href="#cb5-693" aria-hidden="true" tabindex="-1"></a>      <span class="op">.</span><span class="fu">append</span>(<span class="st">"g"</span>)</span>
<span id="cb5-694"><a href="#cb5-694" aria-hidden="true" tabindex="-1"></a>      <span class="op">.</span><span class="fu">attr</span>(<span class="st">"id"</span><span class="op">,</span> <span class="st">"face-overlay"</span>)</span>
<span id="cb5-695"><a href="#cb5-695" aria-hidden="true" tabindex="-1"></a>      <span class="op">.</span><span class="fu">append</span>(<span class="st">"circle"</span>)</span>
<span id="cb5-696"><a href="#cb5-696" aria-hidden="true" tabindex="-1"></a>      <span class="op">.</span><span class="fu">attr</span>(<span class="st">"class"</span><span class="op">,</span> <span class="st">"hands-cover"</span>)</span>
<span id="cb5-697"><a href="#cb5-697" aria-hidden="true" tabindex="-1"></a>      <span class="op">.</span><span class="fu">attr</span>(<span class="st">"x"</span><span class="op">,</span> <span class="dv">0</span>)</span>
<span id="cb5-698"><a href="#cb5-698" aria-hidden="true" tabindex="-1"></a>      <span class="op">.</span><span class="fu">attr</span>(<span class="st">"y"</span><span class="op">,</span> <span class="dv">0</span>)</span>
<span id="cb5-699"><a href="#cb5-699" aria-hidden="true" tabindex="-1"></a>      <span class="op">.</span><span class="fu">attr</span>(<span class="st">"r"</span><span class="op">,</span> clockRadius <span class="op">/</span> <span class="dv">20</span>)<span class="op">;</span></span>
<span id="cb5-700"><a href="#cb5-700" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb5-701"><a href="#cb5-701" aria-hidden="true" tabindex="-1"></a>  <span class="kw">function</span> <span class="fu">moveHands</span>() {</span>
<span id="cb5-702"><a href="#cb5-702" aria-hidden="true" tabindex="-1"></a>    <span class="kw">const</span> sel <span class="op">=</span> d3</span>
<span id="cb5-703"><a href="#cb5-703" aria-hidden="true" tabindex="-1"></a>      <span class="op">.</span><span class="fu">select</span>(<span class="st">"#clock-hands-final"</span>)</span>
<span id="cb5-704"><a href="#cb5-704" aria-hidden="true" tabindex="-1"></a>      <span class="op">.</span><span class="fu">selectAll</span>(<span class="st">"line"</span>)</span>
<span id="cb5-705"><a href="#cb5-705" aria-hidden="true" tabindex="-1"></a>      <span class="op">.</span><span class="fu">data</span>(handData)</span>
<span id="cb5-706"><a href="#cb5-706" aria-hidden="true" tabindex="-1"></a>      <span class="op">.</span><span class="fu">transition</span>()<span class="op">;</span></span>
<span id="cb5-707"><a href="#cb5-707" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> (fancySecondsOFF) sel<span class="op">.</span><span class="fu">ease</span>(d3<span class="op">.</span><span class="at">easeElastic</span><span class="op">.</span><span class="fu">period</span>(<span class="fl">0.5</span>))<span class="op">;</span></span>
<span id="cb5-708"><a href="#cb5-708" aria-hidden="true" tabindex="-1"></a>    sel<span class="op">.</span><span class="fu">attr</span>(<span class="st">"transform"</span><span class="op">,</span> d <span class="kw">=&gt;</span> <span class="vs">`rotate(</span><span class="sc">${</span>d<span class="op">.</span><span class="fu">scale</span>(d<span class="op">.</span><span class="at">value</span>)<span class="sc">}</span><span class="vs">)`</span>)<span class="op">;</span></span>
<span id="cb5-709"><a href="#cb5-709" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb5-710"><a href="#cb5-710" aria-hidden="true" tabindex="-1"></a>  <span class="kw">function</span> <span class="fu">updateData</span>() {</span>
<span id="cb5-711"><a href="#cb5-711" aria-hidden="true" tabindex="-1"></a>    handData[<span class="dv">0</span>]<span class="op">.</span><span class="at">value</span> <span class="op">=</span> <span class="op">!</span>fancySecondsOFF <span class="op">?</span> <span class="bu">Math</span><span class="op">.</span><span class="fu">floor</span>(selectedExactN <span class="op">*</span> <span class="dv">10</span>) <span class="op">:</span> decTimeN[<span class="dv">0</span>]<span class="op">;</span></span>
<span id="cb5-712"><a href="#cb5-712" aria-hidden="true" tabindex="-1"></a>    handData[<span class="dv">1</span>]<span class="op">.</span><span class="at">value</span> <span class="op">=</span> <span class="op">!</span>fancySecondsOFF <span class="op">?</span> <span class="bu">Math</span><span class="op">.</span><span class="fu">floor</span>(selectedExactN <span class="op">*</span> <span class="dv">10</span> <span class="op">%</span> <span class="dv">1</span> <span class="op">*</span> <span class="dv">100</span>) <span class="op">:</span> decTimeN<span class="op">.</span><span class="fu">slice</span>(<span class="dv">2</span><span class="op">,</span> <span class="dv">4</span>)<span class="op">;</span></span>
<span id="cb5-713"><a href="#cb5-713" aria-hidden="true" tabindex="-1"></a>    handData[<span class="dv">2</span>]<span class="op">.</span><span class="at">value</span> <span class="op">=</span> <span class="op">!</span>fancySecondsOFF <span class="op">?</span> selectedExactN <span class="op">*</span> <span class="dv">10</span> <span class="op">%</span> <span class="dv">1</span> <span class="op">*</span> <span class="dv">100</span> <span class="op">%</span> <span class="dv">1</span> <span class="op">*</span> <span class="dv">100</span> <span class="op">:</span> decTimeN<span class="op">.</span><span class="fu">slice</span>(<span class="dv">4</span><span class="op">,</span> <span class="dv">6</span>)<span class="op">;</span></span>
<span id="cb5-714"><a href="#cb5-714" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb5-715"><a href="#cb5-715" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> svg <span class="op">=</span> d3</span>
<span id="cb5-716"><a href="#cb5-716" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">create</span>(<span class="st">"svg"</span>)</span>
<span id="cb5-717"><a href="#cb5-717" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">"viewBox"</span><span class="op">,</span> [<span class="dv">0</span><span class="op">,</span> <span class="dv">0</span><span class="op">,</span> w<span class="op">,</span> h])</span>
<span id="cb5-718"><a href="#cb5-718" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">style</span>(<span class="st">"max-width"</span><span class="op">,</span> <span class="vs">`</span><span class="sc">${</span>width <span class="op">/</span> <span class="fl">2.1</span><span class="sc">}</span><span class="vs">px`</span>)</span>
<span id="cb5-719"><a href="#cb5-719" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">"class"</span><span class="op">,</span> <span class="st">"clock-btm"</span>)</span>
<span id="cb5-720"><a href="#cb5-720" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">"id"</span><span class="op">,</span> <span class="st">"clock"</span>)<span class="op">;</span></span>
<span id="cb5-721"><a href="#cb5-721" aria-hidden="true" tabindex="-1"></a>  svg</span>
<span id="cb5-722"><a href="#cb5-722" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">append</span>(<span class="st">"text"</span>)</span>
<span id="cb5-723"><a href="#cb5-723" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">text</span>(<span class="vs">`-</span><span class="sc">${</span>decTimeN<span class="sc">}</span><span class="vs">-</span><span class="sc">${</span>selectedZone<span class="sc">}</span><span class="vs">`</span>)</span>
<span id="cb5-724"><a href="#cb5-724" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">"x"</span><span class="op">,</span> clockRadius <span class="op">+</span> margin)</span>
<span id="cb5-725"><a href="#cb5-725" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">"y"</span><span class="op">,</span> clockRadius <span class="op">*</span> <span class="dv">2</span> <span class="op">+</span> margin <span class="op">*</span> <span class="fl">1.975</span>)</span>
<span id="cb5-726"><a href="#cb5-726" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">"text-anchor"</span><span class="op">,</span> <span class="st">"middle"</span>)</span>
<span id="cb5-727"><a href="#cb5-727" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">"font-size"</span><span class="op">,</span> <span class="dv">32</span>)</span>
<span id="cb5-728"><a href="#cb5-728" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">"font-family"</span><span class="op">,</span> <span class="st">"monospace"</span>)<span class="op">;</span></span>
<span id="cb5-729"><a href="#cb5-729" aria-hidden="true" tabindex="-1"></a>  <span class="fu">drawClock</span>()<span class="op">;</span></span>
<span id="cb5-730"><a href="#cb5-730" aria-hidden="true" tabindex="-1"></a>  <span class="co">// Animation</span></span>
<span id="cb5-731"><a href="#cb5-731" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> interval <span class="op">=</span> <span class="pp">setInterval</span>(</span>
<span id="cb5-732"><a href="#cb5-732" aria-hidden="true" tabindex="-1"></a>    () <span class="kw">=&gt;</span> {</span>
<span id="cb5-733"><a href="#cb5-733" aria-hidden="true" tabindex="-1"></a>      <span class="fu">updateData</span>()<span class="op">;</span></span>
<span id="cb5-734"><a href="#cb5-734" aria-hidden="true" tabindex="-1"></a>      <span class="fu">moveHands</span>()<span class="op">;</span></span>
<span id="cb5-735"><a href="#cb5-735" aria-hidden="true" tabindex="-1"></a>    }<span class="op">,</span></span>
<span id="cb5-736"><a href="#cb5-736" aria-hidden="true" tabindex="-1"></a>    <span class="op">!</span>fancySecondsOFF <span class="op">?</span> <span class="dv">10</span> <span class="op">:</span> <span class="dv">864</span></span>
<span id="cb5-737"><a href="#cb5-737" aria-hidden="true" tabindex="-1"></a>  )<span class="op">;</span></span>
<span id="cb5-738"><a href="#cb5-738" aria-hidden="true" tabindex="-1"></a>  invalidation<span class="op">.</span><span class="fu">then</span>(() <span class="kw">=&gt;</span> <span class="pp">clearInterval</span>(interval))<span class="op">;</span></span>
<span id="cb5-739"><a href="#cb5-739" aria-hidden="true" tabindex="-1"></a>  <span class="cf">return</span> svg<span class="op">.</span><span class="fu">node</span>()<span class="op">;</span></span>
<span id="cb5-740"><a href="#cb5-740" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb5-741"><a href="#cb5-741" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb5-742"><a href="#cb5-742" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-743"><a href="#cb5-743" aria-hidden="true" tabindex="-1"></a>The plot to the lower left of the map🗺️visualizes the night (blue) and day (yellow) time of day (x-axis) throughout every day of the year (y-axis) at the <span class="co">[</span><span class="ot">latitude</span><span class="co">](https://en.wikipedia.org/wiki/Latitude#:~:text=a%20geographic%20coordinate%20that%20specifies%20the%20north%2Dsouth%20position%20of%20a%20point%20on%20the%20surface%20of%20the%20Earth)</span> of the red⭕️circle on the map🗺️. The vertical↕position of the red<span class="dt">&lt;</span><span class="kw">font</span><span class="ot"> color</span><span class="op">=</span><span class="st">red</span><span class="dt">&gt;</span>—<span class="dt">&lt;/</span><span class="kw">font</span><span class="dt">&gt;</span>line (time of day) and the↔️horizontal position of the red🔴dot (day of the year) on the plot control the🌐globes above and to the right of the plot.</span>
<span id="cb5-744"><a href="#cb5-744" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-745"><a href="#cb5-745" aria-hidden="true" tabindex="-1"></a><span class="fu"># Zone</span></span>
<span id="cb5-746"><a href="#cb5-746" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-747"><a href="#cb5-747" aria-hidden="true" tabindex="-1"></a>Drag the red⭕️circle across the <span class="co">[</span><span class="ot">meridians</span><span class="co">](https://en.wikipedia.org/wiki/Meridian_%28geography%29#:~:text=words%2C%20it%20is-,a%20line%20of%20longitude,-.%20The%20position%20of)</span> (vertical↕gray lines) on the map🗺️to see how changing time zones affects the time. Only the first digit of the Dec times shown above, the <span class="co">[</span><span class="ot">deciday</span><span class="co">]</span>{.under .tool data-bs-toggle="tooltip" data-bs-title="a tenth of a day"}, varies across time zones, because the 10 Dec time zones, numbered 0 through 9 on the map🗺️, are each 1 <span class="co">[</span><span class="ot">deci[turn](https://en.wikipedia.org/wiki/Turn_%28angle%29#:~:text=a%20unit%20of%20plane%20angle%20measurement%20equal%20to%202%CF%80%C2%A0radians%2C%20360%C2%A0degrees)</span><span class="co">]</span>{.under .tool data-bs-toggle="tooltip" data-bs-title="a tenth of a turn"} (<span class="co">[</span><span class="ot">dt</span><span class="co">](https://en.wikipedia.org/wiki/Turn_%28angle%29#:~:text=the%20Greek%20letter,to%20one%20turn)</span>) wide. Simply put, a <span class="co">[</span><span class="ot">deciturn</span><span class="co">]</span>{.under .tool data-bs-toggle="tooltip" data-bs-title="a tenth of a turn"} of longitude translates into a <span class="co">[</span><span class="ot">deciday</span><span class="co">]</span>{.under .tool data-bs-toggle="tooltip" data-bs-title="a tenth of a day"} of time.</span>
<span id="cb5-748"><a href="#cb5-748" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-749"><a href="#cb5-749" aria-hidden="true" tabindex="-1"></a>The leftmost vertical↕line on the map🗺️is <span class="co">[</span><span class="ot">Meridian 0</span><span class="co">](https://en.wikipedia.org/wiki/18th_meridian_west#:~:text=a%20line%20of%20longitude%20that%20extends%20from%20the%20North%20Pole%20across%20the%20Arctic%20Ocean%2C%20Greenland%2C%20Iceland%2C%20the%20Atlantic%20Ocean%2C%20the%20Canary%20Islands%2C%20the%20Southern%20Ocean%2C%20and%20Antarctica%20to%20the%20South%20Pole)</span>, the Dec <span class="co">[</span><span class="ot">International Date Line</span><span class="co">](https://en.wikipedia.org/wiki/International_Date_Line#:~:text=the%20line%20between%20the%20South%20and%20North%20Poles%20that%20is%20the%20boundary%20between%20one%20calendar%20day%20and%20the%20next)</span> and <span class="co">[</span><span class="ot">prime meridian</span><span class="co">](https://en.wikipedia.org/wiki/Prime_meridian#:~:text=an%20arbitrarily%2Dchosen%20meridian%20%28a%20line%20of%20longitude%29%20in%20a%20geographic%20coordinate%20system%20at%20which%20longitude%20is%20defined%20to%20be%200%C2%B0)</span>, which cuts across the Atlantic Ocean through Iceland🇮🇸just West of Africa🌍and is the boundary between Zone 9 and Zone 0, the rightmost and leftmost Dec time zones on the map🗺️, respectively. Arranging Dec time zones from 0 to 9 yields</span>
<span id="cb5-750"><a href="#cb5-750" aria-hidden="true" tabindex="-1"></a>a <span class="co">[</span><span class="ot">Pacific-centric</span><span class="co">]</span>(https://en.wikipedia.org/wiki/World_map#:~:text=south%2Dup%20map-,Pacific%2Dcentric%20map,-(more%20commonly%20used)) map🗺️.</span>
<span id="cb5-751"><a href="#cb5-751" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-752"><a href="#cb5-752" aria-hidden="true" tabindex="-1"></a>While only positive Dec time zones are shown on the map🗺️, every Dec time zone can also be expressed as a negative number. Each pair of time zone numbers produces the same Dec time, but result in <span class="co">[</span><span class="ot">Dec dates</span><span class="co">](/dec/date)</span>🗓️that are 1 day apart. Negative time zone numbers can be useful for getting <span class="co">[</span><span class="ot">Dec dates</span><span class="co">](/dec/date)</span>🗓️to match <span class="co">[</span><span class="ot">Gregorian calendar</span><span class="co">](https://en.wikipedia.org/wiki/Gregorian_calendar#:~:text=the%20calendar%20used%20in%20most%20parts%20of%20the%20world)</span> dates🗓️with negative <span class="co">[</span><span class="ot">UTC offsets</span><span class="co">]</span>(https://en.wikipedia.org/wiki/UTC_offset#:~:text=the%20difference%20in%20hours%20and%20minutes%20between%20Coordinated%20Universal%20Time%20(UTC)%20and%20the%20standard%20time%20at%20a%20particular%20place).</span>
<span id="cb5-753"><a href="#cb5-753" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-754"><a href="#cb5-754" aria-hidden="true" tabindex="-1"></a>There are <span class="co">[</span><span class="ot">37 UTC offsets</span><span class="co">](https://en.wikipedia.org/wiki/List_of_UTC_offsets)</span>, but only 10 Dec time zones. Conversion between Dec time zones and UTC offsets is inexact, because UTC offsets depend on geographic and political boundaries, whereas Dec time zones are determined solely by longitude. If you know your longitude in degrees (°) or <span class="co">[</span><span class="ot">centi[turns](https://en.wikipedia.org/wiki/Turn_%28angle%29#:~:text=a%20unit%20of%20plane%20angle%20measurement%20equal%20to%202%CF%80%C2%A0radians%2C%20360%C2%A0degrees)</span><span class="co">]</span>{.under .tool data-bs-toggle="tooltip" data-bs-title="hundredths of a turn"}  (<span class="co">[</span><span class="ot">ct</span><span class="co">](https://en.wikipedia.org/wiki/Turn_%28angle%29#:~:text=the%20Greek%20letter,to%20one%20turn)</span>), you can look up your Dec time zone (TZ) in the table below.</span>
<span id="cb5-755"><a href="#cb5-755" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-756"><a href="#cb5-756" aria-hidden="true" tabindex="-1"></a><span class="pp">|</span> TZ<span class="dt">&lt;</span><span class="kw">br</span><span class="dt">&gt;</span>+ <span class="pp">|</span> TZ<span class="dt">&lt;</span><span class="kw">br</span><span class="dt">&gt;</span>- <span class="pp">|</span> Start<span class="dt">&lt;</span><span class="kw">br</span><span class="dt">&gt;</span>° <span class="pp">|</span> Mid<span class="dt">&lt;</span><span class="kw">br</span><span class="dt">&gt;</span>° <span class="pp">|</span> End<span class="dt">&lt;</span><span class="kw">br</span><span class="dt">&gt;</span>° <span class="pp">|</span> Start<span class="dt">&lt;</span><span class="kw">br</span><span class="dt">&gt;</span>$ct$ <span class="pp">|</span> Mid<span class="dt">&lt;</span><span class="kw">br</span><span class="dt">&gt;</span>$ct$ <span class="pp">|</span> End<span class="dt">&lt;</span><span class="kw">br</span><span class="dt">&gt;</span>$ct$ <span class="pp">|</span></span>
<span id="cb5-757"><a href="#cb5-757" aria-hidden="true" tabindex="-1"></a><span class="pp">| :---:</span>   <span class="pp">| :---:</span>   <span class="pp">| :---:</span>      <span class="pp">| :---:</span>    <span class="pp">| :---:</span>    <span class="pp">| :---:</span>         <span class="pp">| :---:</span>       <span class="pp">| :---:</span>       <span class="pp">|</span></span>
<span id="cb5-758"><a href="#cb5-758" aria-hidden="true" tabindex="-1"></a><span class="pp">|</span> 9       <span class="pp">|</span> -1      <span class="pp">|</span> -54        <span class="pp">|</span> -36      <span class="pp">|</span> -18      <span class="pp">|</span> 90            <span class="pp">|</span> 95          <span class="pp">|</span> 100         <span class="pp">|</span></span>
<span id="cb5-759"><a href="#cb5-759" aria-hidden="true" tabindex="-1"></a><span class="pp">|</span> 8       <span class="pp">|</span> -2      <span class="pp">|</span> -90        <span class="pp">|</span> -72      <span class="pp">|</span> -54      <span class="pp">|</span> 80            <span class="pp">|</span> 85          <span class="pp">|</span> 90          <span class="pp">|</span></span>
<span id="cb5-760"><a href="#cb5-760" aria-hidden="true" tabindex="-1"></a><span class="pp">|</span> 7       <span class="pp">|</span> -3      <span class="pp">|</span> -126       <span class="pp">|</span> -108     <span class="pp">|</span> -90      <span class="pp">|</span> 70            <span class="pp">|</span> 75          <span class="pp">|</span> 80          <span class="pp">|</span></span>
<span id="cb5-761"><a href="#cb5-761" aria-hidden="true" tabindex="-1"></a><span class="pp">|</span> 6       <span class="pp">|</span> -4      <span class="pp">|</span> -162       <span class="pp">|</span> -144     <span class="pp">|</span> -126     <span class="pp">|</span> 60            <span class="pp">|</span> 65          <span class="pp">|</span> 70          <span class="pp">|</span></span>
<span id="cb5-762"><a href="#cb5-762" aria-hidden="true" tabindex="-1"></a><span class="pp">|</span> 5       <span class="pp">|</span> -5      <span class="pp">|</span> 162        <span class="pp">|</span> 180      <span class="pp">|</span> -162     <span class="pp">|</span> 50            <span class="pp">|</span> 55          <span class="pp">|</span> 60          <span class="pp">|</span></span>
<span id="cb5-763"><a href="#cb5-763" aria-hidden="true" tabindex="-1"></a><span class="pp">|</span> 4       <span class="pp">|</span> -6      <span class="pp">|</span> 126        <span class="pp">|</span> 144      <span class="pp">|</span> 162      <span class="pp">|</span> 40            <span class="pp">|</span> 45          <span class="pp">|</span> 50          <span class="pp">|</span></span>
<span id="cb5-764"><a href="#cb5-764" aria-hidden="true" tabindex="-1"></a><span class="pp">|</span> 3       <span class="pp">|</span> -7      <span class="pp">|</span> 90         <span class="pp">|</span> 108      <span class="pp">|</span> 126      <span class="pp">|</span> 30            <span class="pp">|</span> 35          <span class="pp">|</span> 40          <span class="pp">|</span></span>
<span id="cb5-765"><a href="#cb5-765" aria-hidden="true" tabindex="-1"></a><span class="pp">|</span> 2       <span class="pp">|</span> -8      <span class="pp">|</span> 54         <span class="pp">|</span> 72       <span class="pp">|</span> 90       <span class="pp">|</span> 20            <span class="pp">|</span> 25          <span class="pp">|</span> 30          <span class="pp">|</span></span>
<span id="cb5-766"><a href="#cb5-766" aria-hidden="true" tabindex="-1"></a><span class="pp">|</span> 1       <span class="pp">|</span> -9      <span class="pp">|</span> 18         <span class="pp">|</span> 36       <span class="pp">|</span> 54       <span class="pp">|</span> 10            <span class="pp">|</span> 15          <span class="pp">|</span> 20          <span class="pp">|</span></span>
<span id="cb5-767"><a href="#cb5-767" aria-hidden="true" tabindex="-1"></a><span class="pp">|</span> 0       <span class="pp">|</span> -10     <span class="pp">|</span> -18        <span class="pp">|</span> 0        <span class="pp">|</span> 18       <span class="pp">|</span> 0             <span class="pp">|</span> 5           <span class="pp">|</span> 10          <span class="pp">|</span></span>
<span id="cb5-768"><a href="#cb5-768" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-769"><a href="#cb5-769" aria-hidden="true" tabindex="-1"></a>Dec times in Zone 0 and 5 can be directly converted to and from UTC times with an offset of 0 and 12 <span class="co">[</span><span class="ot">hours</span><span class="co">]</span>{.teal}, respectively. The other Dec time zones will differ from the closest UTC time by 8.<span class="co">[</span><span class="ot">3</span><span class="co">]</span>{.over}, 16.<span class="co">[</span><span class="ot">6</span><span class="co">]</span>{.over}, 25, 33.<span class="co">[</span><span class="ot">3</span><span class="co">]</span>{.over}, 41.<span class="co">[</span><span class="ot">6</span><span class="co">]</span>{.over} or 50 <span class="co">[</span><span class="ot">millidays</span><span class="co">]</span>{.under .tool data-bs-toggle="tooltip" data-bs-title="thousands of a day"}. To find the difference <span class="dv">&amp;delta;</span>, convert the UTC offset <span class="co">[</span><span class="ot">hours</span><span class="co">]</span>{.teal} <span class="co">[</span><span class="ot">o~H~</span><span class="co">]</span>{.teal} and <span class="co">[</span><span class="ot">minutes</span><span class="co">]</span>{.olive} <span class="co">[</span><span class="ot">o~M~</span><span class="co">]</span>{.olive} into <span class="co">[</span><span class="ot">deci[turns](https://en.wikipedia.org/wiki/Turn_%28angle%29#:~:text=a%20unit%20of%20plane%20angle%20measurement%20equal%20to%202%CF%80%C2%A0radians%2C%20360%C2%A0degrees)</span><span class="co">]</span>{.under .tool data-bs-toggle="tooltip" data-bs-title="tenths of a turn"} of the longitude <span class="dv">&amp;lambda;</span> and then subtract the Dec zone number <span class="co">[</span><span class="ot">z</span><span class="co">]</span>{.lime}:</span>
<span id="cb5-770"><a href="#cb5-770" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-771"><a href="#cb5-771" aria-hidden="true" tabindex="-1"></a>$$\lambda = o_H \div 2.4 + o_M \div 144$$</span>
<span id="cb5-772"><a href="#cb5-772" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-773"><a href="#cb5-773" aria-hidden="true" tabindex="-1"></a>$$z = \lfloor\lambda + 1 \div 2\rfloor$$</span>
<span id="cb5-774"><a href="#cb5-774" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-775"><a href="#cb5-775" aria-hidden="true" tabindex="-1"></a>$$\delta = \lambda - z$$</span>
<span id="cb5-776"><a href="#cb5-776" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-777"><a href="#cb5-777" aria-hidden="true" tabindex="-1"></a>We can avoid dealing with the time zone difference by shifting the time zone so that we always convert between Zone 0 and <span class="co">[</span><span class="ot">UTC+00:00</span><span class="co">](https://en.wikipedia.org/wiki/List_of_UTC_offsets#UTC+00:00,_Z)</span> or Zone 5 and <span class="co">[</span><span class="ot">UTC+12:00</span><span class="co">](https://en.wikipedia.org/wiki/List_of_UTC_offsets#UTC+12:00,_M)</span>. To obtain the Zone 0 time, we evaluate a Dec time as a math expression, add 10, and get the remainder after dividing by 10 to make sure the result is less than 10 <span class="co">[</span><span class="ot">decidays</span><span class="co">](https://en.wikipedia.org/wiki/Decimal_time#:~:text=dividing%20the%20day%20into%2010%20decidays)</span>{.under .tool data-bs-toggle="tooltip" data-bs-title="tenths of a day"}: (<span class="co">[</span><span class="ot">\${browserTime.toFixed(4)}</span><span class="co">]</span>{.cyan} \${browserSign} <span class="co">[</span><span class="ot">\${Math.abs(browserZone)}</span><span class="co">]</span>{.lime} + 10) <span class="co">[</span><span class="ot">mod</span><span class="co">](https://en.wikipedia.org/wiki/Modulo#:~:text=returns%20the%20remainder)</span> 10 = <span class="co">[</span><span class="ot">\${zone0time.toFixed(4)}</span><span class="co">]</span>{.cyan}.</span>
<span id="cb5-778"><a href="#cb5-778" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-779"><a href="#cb5-779" aria-hidden="true" tabindex="-1"></a>::: {.callout-warning}</span>
<span id="cb5-780"><a href="#cb5-780" aria-hidden="true" tabindex="-1"></a><span class="fu"># Bad Pun Alert</span></span>
<span id="cb5-781"><a href="#cb5-781" aria-hidden="true" tabindex="-1"></a>Sorry if reading this takes a long <span class="co">[</span><span class="ot">time</span><span class="co">]</span>{.cyan}; I hope you don’t <span class="co">[</span><span class="ot">zone</span><span class="co">]</span>{.lime} out!</span>
<span id="cb5-782"><a href="#cb5-782" aria-hidden="true" tabindex="-1"></a>:::</span>
<span id="cb5-783"><a href="#cb5-783" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-784"><a href="#cb5-784" aria-hidden="true" tabindex="-1"></a><span class="fu"># Unit</span></span>
<span id="cb5-785"><a href="#cb5-785" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-786"><a href="#cb5-786" aria-hidden="true" tabindex="-1"></a>Dec uses <span class="co">[</span><span class="ot">metric prefixes</span><span class="co">](https://en.wikipedia.org/wiki/Metric_prefix#:~:text=a%20unit%20prefix%20that%20precedes%20a%20basic%20unit%20of%20measure%20to%20indicate%20a%20multiple%20or%20submultiple%20of%20the%20unit)</span> to create <span class="co">[</span><span class="ot">submultiples</span><span class="co">](https://en.wikipedia.org/wiki/Multiple_%28mathematics%29#Submultiple:~:text=of%20%22a%20being-,a%20unit%20fraction,-of%20b%22%20)</span> of a day that can naturally be combined together into a single <span class="co">[</span><span class="ot">decimal</span><span class="co">](https://en.wikipedia.org/wiki/Decimal#:~:text=system%20for%20denoting%20integer%20and%20non%2Dinteger%20numbers)</span> number. Conversion between decimal units is as simple as moving↔︎️or removing❌the <span class="co">[</span><span class="ot">decimal separator</span><span class="co">](https://en.wikipedia.org/wiki/Decimal_separator#:~:text=a%20symbol%20that%20separates%20the%20integer%20part%20from%20the%20fractional%20part%20of%20a%20number)</span>. In contrast, an <span class="co">[</span><span class="ot">hh</span><span class="co">]</span>{.teal}:<span class="co">[</span><span class="ot">mm</span><span class="co">]</span>{.olive}:<span class="co">[</span><span class="ot">ss</span><span class="co">]</span>{.purple} time is a <span class="co">[</span><span class="ot">mixed-radix</span><span class="co">](https://en.wikipedia.org/wiki/Mixed_radix#:~:text=non%2Dstandard%20positional%20numeral%20systems%20in%20which%20the%20numerical%20base%20varies%20from%20position%20to%20position)</span> number, where <span class="co">[</span><span class="ot">hh</span><span class="co">]</span>{.teal} is the <span class="co">[</span><span class="ot">base-12</span><span class="co">](https://en.wikipedia.org/wiki/List_of_numeral_systems#:~:text=12-,Duodecimal,-%2C%20dozenal)</span> or <span class="co">[</span><span class="ot">base-24</span><span class="co">](https://en.wikipedia.org/wiki/List_of_numeral_systems#:~:text=24-,Quadravigesimal,-%5B48%5D)</span> <span class="co">[</span><span class="ot">hour</span><span class="co">]</span>{.teal}, <span class="co">[</span><span class="ot">mm</span><span class="co">]</span>{.olive} is the <span class="co">[</span><span class="ot">base-60</span><span class="co">](https://en.wikipedia.org/wiki/List_of_numeral_systems#:~:text=60-,Sexagesimal,-Babylonian%20numerals%20and)</span> <span class="co">[</span><span class="ot">minute</span><span class="co">]</span>{.olive}, and <span class="co">[</span><span class="ot">ss</span><span class="co">]</span>{.purple} is the base-60 <span class="co">[</span><span class="ot">second</span><span class="co">]</span>{.purple}.</span>
<span id="cb5-787"><a href="#cb5-787" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-788"><a href="#cb5-788" aria-hidden="true" tabindex="-1"></a><span class="pp">|</span> Prefix     <span class="pp">|</span> Power <span class="pp">|</span> Day    <span class="pp">|</span> <span class="co">[</span><span class="ot">hh</span><span class="co">]</span>{.teal}:<span class="co">[</span><span class="ot">mm</span><span class="co">]</span>{.olive}:<span class="co">[</span><span class="ot">ss</span><span class="co">]</span>{.purple}.<span class="co">[</span><span class="ot">sss</span><span class="co">]</span>{.purple} <span class="pp">|</span></span>
<span id="cb5-789"><a href="#cb5-789" aria-hidden="true" tabindex="-1"></a><span class="pp">| ----------</span> <span class="pp">| -----</span> <span class="pp">| ------</span> <span class="pp">| ------------</span> <span class="pp">|</span></span>
<span id="cb5-790"><a href="#cb5-790" aria-hidden="true" tabindex="-1"></a><span class="pp">|</span>            <span class="pp">|</span>  0    <span class="pp">|</span> 1      <span class="pp">|</span> 24<span class="sc">:00:</span>00.000 <span class="pp">|</span></span>
<span id="cb5-791"><a href="#cb5-791" aria-hidden="true" tabindex="-1"></a><span class="pp">|</span> deci       <span class="pp">|</span> -1    <span class="pp">|</span> .1     <span class="pp">|</span> 02<span class="sc">:24:</span>00.000 <span class="pp">|</span></span>
<span id="cb5-792"><a href="#cb5-792" aria-hidden="true" tabindex="-1"></a><span class="pp">|</span> centi      <span class="pp">|</span> -2    <span class="pp">|</span> .01    <span class="pp">|</span> 00<span class="sc">:14:</span>24.000 <span class="pp">|</span></span>
<span id="cb5-793"><a href="#cb5-793" aria-hidden="true" tabindex="-1"></a><span class="pp">|</span> milli      <span class="pp">|</span> -3    <span class="pp">|</span> .001   <span class="pp">|</span> 00<span class="sc">:01:</span>26.400 <span class="pp">|</span></span>
<span id="cb5-794"><a href="#cb5-794" aria-hidden="true" tabindex="-1"></a><span class="pp">|</span> decimilli  <span class="pp">|</span> -4    <span class="pp">|</span> .0001  <span class="pp">|</span> 00<span class="sc">:00:</span>08.640 <span class="pp">|</span></span>
<span id="cb5-795"><a href="#cb5-795" aria-hidden="true" tabindex="-1"></a><span class="pp">|</span> centimilli <span class="pp">|</span> -5    <span class="pp">|</span> .00001 <span class="pp">|</span> 00<span class="sc">:00:</span>00.864 <span class="pp">|</span></span>
<span id="cb5-796"><a href="#cb5-796" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-797"><a href="#cb5-797" aria-hidden="true" tabindex="-1"></a>To convert the <span class="co">[</span><span class="ot">hour</span><span class="co">]</span>{.teal} <span class="co">[</span><span class="ot">h</span><span class="co">]</span>{.teal}, <span class="co">[</span><span class="ot">minute</span><span class="co">]</span>{.olive} <span class="co">[</span><span class="ot">m</span><span class="co">]</span>{.olive}, and <span class="co">[</span><span class="ot">second</span><span class="co">]</span>{.purple} <span class="co">[</span><span class="ot">s</span><span class="co">]</span>{.purple} into the <span class="co">[</span><span class="ot">deciday</span><span class="co">](https://en.wikipedia.org/wiki/Decimal_time#:~:text=dividing%20the%20day%20into%2010%20decidays)</span>{.under .tool data-bs-toggle="tooltip" data-bs-title="a tenth of a day"} <span class="co">[</span><span class="ot">d</span><span class="co">]</span>{.cyan}, Dec uses the following equation: <span class="co">[</span><span class="ot">d</span><span class="co">]</span>{.cyan} = <span class="co">[</span><span class="ot">h</span><span class="co">]</span>{.teal} <span class="dv">&amp;div;</span> 2.4 + <span class="co">[</span><span class="ot">m</span><span class="co">]</span>{.olive} <span class="dv">&amp;div;</span> 144 + <span class="co">[</span><span class="ot">s</span><span class="co">]</span>{.purple} <span class="dv">&amp;div;</span> 8640. The current equation values in Zone <span class="co">[</span><span class="ot">\${browserZone}</span><span class="co">]</span>{.lime} are: <span class="co">[</span><span class="ot">\${browserTime.toFixed(4)}</span><span class="co">]</span>{.cyan} = <span class="co">[</span><span class="ot">\${Math.floor(hours).toString().padStart(2, "0")}</span><span class="co">]</span>{.teal} <span class="dv">&amp;div;</span> 2.4 + <span class="co">[</span><span class="ot">\${Math.floor(minutes).toString().padStart(2, "0")}</span><span class="co">]</span>{.olive} <span class="dv">&amp;div;</span> 144 + <span class="co">[</span><span class="ot">\${Math.floor(seconds).toString().padStart(2, "0")}</span><span class="co">]</span>{.purple} <span class="dv">&amp;div;</span> 8640. Inversely, we can convert <span class="co">[</span><span class="ot">decidays</span><span class="co">](https://en.wikipedia.org/wiki/Decimal_time#:~:text=dividing%20the%20day%20into%2010%20decidays)</span>{.under .tool data-bs-toggle="tooltip" data-bs-title="tenths of a day"} into <span class="co">[</span><span class="ot">hours</span><span class="co">]</span>{.teal}: <span class="co">[</span><span class="ot">h</span><span class="co">]</span>{.teal} = <span class="co">[</span><span class="ot">d</span><span class="co">]</span>{.cyan} <span class="dv">&amp;times;</span> 2.4, <span class="co">[</span><span class="ot">minutes</span><span class="co">]</span>{.olive}: <span class="co">[</span><span class="ot">m</span><span class="co">]</span>{.olive} = <span class="co">[</span><span class="ot">h</span><span class="co">]</span>{.teal} <span class="co">[</span><span class="ot">mod</span><span class="co">](https://en.wikipedia.org/wiki/Modulo#:~:text=returns%20the%20remainder)</span> 1 <span class="dv">&amp;times;</span> 60, and <span class="co">[</span><span class="ot">seconds</span><span class="co">]</span>{.purple}: <span class="co">[</span><span class="ot">s</span><span class="co">]</span>{.purple} = <span class="co">[</span><span class="ot">m</span><span class="co">]</span>{.olive} <span class="co">[</span><span class="ot">mod</span><span class="co">](https://en.wikipedia.org/wiki/Modulo#:~:text=returns%20the%20remainder)</span> 1 <span class="dv">&amp;times;</span> 60.</span>
<span id="cb5-798"><a href="#cb5-798" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-799"><a href="#cb5-799" aria-hidden="true" tabindex="-1"></a>Instead of dealing with <span class="co">[</span><span class="ot">hours</span><span class="co">]</span>{.teal}, <span class="co">[</span><span class="ot">minutes</span><span class="co">]</span>{.olive}, and <span class="co">[</span><span class="ot">seconds</span><span class="co">]</span>{.purple}, we can convert the <span class="co">[</span><span class="ot">UNIX timestamp</span><span class="co">](https://en.wikipedia.org/wiki/Unix_time#:~:text=the%20number%20of%20non%2Dleap%20seconds%20that%20have%20elapsed%20since%2000%3A00%3A00%20UTC%20on%201%C2%A0January%201970)</span> <span class="co">[</span><span class="ot">u</span><span class="co">]</span>{.purple} into the Dec time <span class="co">[</span><span class="ot">d</span><span class="co">]</span>{.cyan}+<span class="co">[</span><span class="ot">0</span><span class="co">]</span>{.lime}. First, we divide <span class="co">[</span><span class="ot">u</span><span class="co">]</span>{.purple} by 86400 to convert seconds to days, then isolate the <span class="co">[</span><span class="ot">decimal part</span><span class="co">](https://en.wikipedia.org/wiki/Fractional_part#:~:text=the%20excess%20beyond%20that%20number%27s%20integer%20part)</span> of the <span class="co">[</span><span class="ot">quotient</span><span class="co">](https://en.wikipedia.org/wiki/Quotient#:~:text=a%20quantity%20produced%20by%20the%20division%20of%20two%20numbers)</span>, and finally multiply by 10: <span class="co">[</span><span class="ot">d</span><span class="co">]</span>{.cyan} + <span class="co">[</span><span class="ot">0</span><span class="co">]</span>{.lime} = <span class="co">[</span><span class="ot">u</span><span class="co">]</span>{.purple} <span class="dv">&amp;div;</span> 86400 <span class="co">[</span><span class="ot">mod</span><span class="co">](https://en.wikipedia.org/wiki/Modulo#:~:text=returns%20the%20remainder)</span> 1 <span class="dv">&amp;times;</span> 10. The current values in this equation are <span class="co">[</span><span class="ot">\${browserTime.toFixed(4)}</span><span class="co">]</span>{.cyan} + <span class="co">[</span><span class="ot">0</span><span class="co">]</span>{.lime} = <span class="co">[</span><span class="ot">\${Math.floor(now / 1000)}</span><span class="co">]</span>{.purple} <span class="dv">&amp;div;</span> 86400 <span class="co">[</span><span class="ot">mod</span><span class="co">](https://en.wikipedia.org/wiki/Modulo#:~:text=returns%20the%20remainder)</span> 1 <span class="dv">&amp;times;</span> 10.</span>
<span id="cb5-800"><a href="#cb5-800" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-801"><a href="#cb5-801" aria-hidden="true" tabindex="-1"></a>The concept of measuring time in decimal days is not novel. In the late 1700s, the <span class="co">[</span><span class="ot">French Republican calendar</span><span class="co">](https://en.wikipedia.org/wiki/French_Republican_calendar#:~:text=a%20calendar%20created%20and%20implemented%20during%20the%20French%20Revolution)</span> time system referred to <span class="co">[</span><span class="ot">decidays</span><span class="co">](https://en.wikipedia.org/wiki/Decimal_time#:~:text=dividing%20the%20day%20into%2010%20decidays)</span>{.under .tool data-bs-toggle="tooltip" data-bs-title="tenths of a day"} as decimal <span class="co">[</span><span class="ot">hours</span><span class="co">]</span>{.teal}, <span class="co">[</span><span class="ot">centidays</span><span class="co">]</span>{.under .tool data-bs-toggle="tooltip" data-bs-title="hundredths of a day"} as <span class="co">[</span><span class="ot">décimes</span><span class="co">](https://en.wikipedia.org/wiki/Decimal_time#:~:text=into%20tenths%2C%20or-,d%C3%A9cimes,-%2C%20instead%20of%20minutes)</span>, <span class="co">[</span><span class="ot">millidays</span><span class="co">]</span>{.under .tool data-bs-toggle="tooltip" data-bs-title="thousandths of a day"} as decimal <span class="co">[</span><span class="ot">minutes</span><span class="co">]</span>{.olive}, and <span class="co">[</span><span class="ot">centimillidays</span><span class="co">]</span>{.under .tool data-bs-toggle="tooltip" data-bs-title="hundred thousandths of a day"} as decimal <span class="co">[</span><span class="ot">seconds</span><span class="co">]</span>{.purple}. Similarly, <span class="co">[</span><span class="ot">Swatch Internet Time</span><span class="co">](https://en.wikipedia.org/wiki/Swatch_Internet_Time#:~:text=a%20decimal%20time%20system%20introduced%20in%201998%20by%20the%20Swatch%20corporation)</span>, a <span class="co">[</span><span class="ot">decimal time</span><span class="co">](https://en.wikipedia.org/wiki/Decimal_time#:~:text=the%20representation%20of%20the%20time%20of%20day%20using%20units%20which%20are%20decimally%20related)</span> system introduced in 1998, uses the term ".beats" for <span class="co">[</span><span class="ot">millidays</span><span class="co">]</span>{.under .tool data-bs-toggle="tooltip" data-bs-title="thousandths of a day"}.</span>
<span id="cb5-802"><a href="#cb5-802" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-803"><a href="#cb5-803" aria-hidden="true" tabindex="-1"></a>Swatch Internet Time differs from Dec in that it <span class="co">[</span><span class="ot">has no time zones</span><span class="co">](https://en.wikipedia.org/wiki/Swatch_Internet_Time#Calculation_from_UTC+1:~:text=There%20are%20no%20time%20zones%20in%20Swatch%20Internet%20Time)</span> and is obtained from the [<span class="co">[</span><span class="ot">hours</span><span class="co">]</span>{.teal}, <span class="co">[</span><span class="ot">minutes</span><span class="co">]</span>{.olive}, and <span class="co">[</span><span class="ot">seconds</span><span class="co">]</span>{.purple}](https://en.wikipedia.org/wiki/Swatch_Internet_Time#Calculation_from_UTC+1:~:text=The%20formula%20for%20calculating%20the%20time%20in%20.beats%20from%20UTC%2B1) of <span class="co">[</span><span class="ot">UTC+01:00</span><span class="co">](https://en.wikipedia.org/wiki/UTC%2B01:00#:~:text=a%20time%20offset%20from%20UTC%20of%20%2B01%3A00)</span>. In contrast, the major innovations described in this article are the Dec time zone system and the simple equation for obtaining the Dec time in Zone 0 from a UNIX timestamp, but Dec has much more to offer than <span class="co">[</span><span class="ot">deciday</span><span class="co">](https://en.wikipedia.org/wiki/Decimal_time#:~:text=dividing%20the%20day%20into%2010%20decidays)</span>{.under .tool data-bs-toggle="tooltip" data-bs-title="a tenth of a day"} times and zones.</span>
<span id="cb5-804"><a href="#cb5-804" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-805"><a href="#cb5-805" aria-hidden="true" tabindex="-1"></a><span class="fu"># Next</span></span>
<span id="cb5-806"><a href="#cb5-806" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-807"><a href="#cb5-807" aria-hidden="true" tabindex="-1"></a>The next article in the <span class="co">[</span><span class="ot">Dec section</span><span class="co">](/dec)</span> of my site compares Dec to the <span class="co">[</span><span class="ot">ISO 8601</span><span class="co">](https://en.wikipedia.org/wiki/ISO_8601#:~:text=an%20international%20standard%20covering%20the%20worldwide%20exchange%20and%20communication%20of%20date%20and%20time%2Drelated%20data)</span> international standard for dates and times. Like ISO 8601, Dec allows for <span class="co">[</span><span class="ot">combined date and time representations</span><span class="co">](https://en.wikipedia.org/wiki/ISO_8601#Combined_date_and_time_representations)</span> that can be paired up to express <span class="co">[</span><span class="ot">time intervals</span><span class="co">](https://en.wikipedia.org/wiki/ISO_8601#Time_intervals:~:text=the%20intervening%20time%20between%20two%20time%20points)</span>. In Dec, the combination of a date and time is called a snap🫰and a time interval expressed as a pair of snaps is called a span🌈.</span>
<span id="cb5-808"><a href="#cb5-808" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-809"><a href="#cb5-809" aria-hidden="true" tabindex="-1"></a>My <span class="co">[</span><span class="ot">ISO 8601 article</span><span class="co">](/dec/iso)</span> is unique because it avoids the use of Observable in favor of leveraging <span class="co">[</span><span class="ot">Jupyter</span><span class="co">](https://jupyter.org)</span> support in Quarto to make the code underlying Dec available in multiple programming languages. Observable is a great visualization tool but does not translate well into Jupyter notebooks. After the next article, I return to the use of Observable in my Dec <span class="co">[</span><span class="ot">snap</span><span class="co">](/dec/span)</span>🫰and <span class="co">[</span><span class="ot">span</span><span class="co">](/dec/span)</span>🌈articles.</span>
<span id="cb5-810"><a href="#cb5-810" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-813"><a href="#cb5-813" aria-hidden="true" tabindex="-1"></a><span class="in">```{mermaid}</span></span>
<span id="cb5-814"><a href="#cb5-814" aria-hidden="true" tabindex="-1"></a>%%| label: timenav</span>
<span id="cb5-815"><a href="#cb5-815" aria-hidden="true" tabindex="-1"></a>%<span class="dt">%</span>{init: {<span class="ot">'</span><span class="ss">theme</span><span class="ot">'</span>: <span class="ot">'</span><span class="ss">default</span><span class="ot">'</span>, <span class="ot">'</span><span class="ss">themeVariables</span><span class="ot">'</span>: { <span class="ot">'</span><span class="ss">fontSize</span><span class="ot">'</span>: <span class="ot">'</span><span class="ss">32px</span><span class="ot">'</span>}}}%%</span>
<span id="cb5-816"><a href="#cb5-816" aria-hidden="true" tabindex="-1"></a>flowchart LR</span>
<span id="cb5-817"><a href="#cb5-817" aria-hidden="true" tabindex="-1"></a>   A[Dec]--&gt;B[date]--&gt;C[<span class="fu">time</span>]--&gt;D[snap]--&gt;E[span]</span>
<span id="cb5-818"><a href="#cb5-818" aria-hidden="true" tabindex="-1"></a>   click A <span class="ot">"</span><span class="st">/dec</span><span class="ot">"</span></span>
<span id="cb5-819"><a href="#cb5-819" aria-hidden="true" tabindex="-1"></a>   click B <span class="ot">"</span><span class="st">/dec/date</span><span class="ot">"</span></span>
<span id="cb5-820"><a href="#cb5-820" aria-hidden="true" tabindex="-1"></a>   click C <span class="ot">"</span><span class="st">/dec/time</span><span class="ot">"</span></span>
<span id="cb5-821"><a href="#cb5-821" aria-hidden="true" tabindex="-1"></a>   click D <span class="ot">"</span><span class="st">/dec/snap</span><span class="ot">"</span></span>
<span id="cb5-822"><a href="#cb5-822" aria-hidden="true" tabindex="-1"></a>   click E <span class="ot">"</span><span class="st">/dec/span</span><span class="ot">"</span></span>
<span id="cb5-823"><a href="#cb5-823" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb5-824"><a href="#cb5-824" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-825"><a href="#cb5-825" aria-hidden="true" tabindex="-1"></a><span class="fu"># Cite</span></span>
<span id="cb5-826"><a href="#cb5-826" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-827"><a href="#cb5-827" aria-hidden="true" tabindex="-1"></a>Please spread the good word about Dec using the citation information at the bottom of this article. You may also want to cite the Observable notebooks that I adapted into the clock🕓, bar📊chart, map🗺️, and daylight☀️plot visualizations in this article or the 2014 blog post which proposed a system of 20 decimal time zones, each 5 <span class="co">[</span><span class="ot">centidays</span><span class="co">]</span>{.under .tool data-bs-toggle="tooltip" data-bs-title="hundredths of a day"} wide, based on the <span class="co">[</span><span class="ot">Greenwich Meridian</span><span class="co">]</span>(https://en.wikipedia.org/wiki/Prime_meridian_(Greenwich)#:~:text=a%20geographical%20reference%20line%20that%20passes%20through%20the%20Royal%20Observatory%2C%20Greenwich%2C%20in%20London%2C%20England):</span>
<span id="cb5-828"><a href="#cb5-828" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-829"><a href="#cb5-829" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span><span class="co">[</span><span class="ot">Pearson, Tom</span><span class="co">](https://www.2x2.graphics)</span>. [<span class="co">[</span><span class="ot">2013</span><span class="co">]</span>{.yellow}+<span class="co">[</span><span class="ot">124</span><span class="co">]</span>{.cyan}]{.underline .tool data-bs-toggle="tooltip" data-bs-title="2013-07-03"}. “Simple D3 clock.” <span class="co">[</span><span class="ot">\${decYear}</span><span class="co">]</span>{.yellow}+<span class="co">[</span><span class="ot">\${decDate}</span><span class="co">]</span>{.cyan}. <span class="ot">&lt;https://observablehq.com/@d3/simple-clock&gt;</span>.</span>
<span id="cb5-830"><a href="#cb5-830" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span><span class="co">[</span><span class="ot">Heyen, Frank</span><span class="co">](https://fheyen.github.io)</span>. [<span class="co">[</span><span class="ot">2021</span><span class="co">]</span>{.yellow}+<span class="co">[</span><span class="ot">246</span><span class="co">]</span>{.cyan}]{.underline .tool data-bs-toggle="tooltip" data-bs-title="2021-11-02"}. “BarChart Clock.” <span class="co">[</span><span class="ot">\${decYear}</span><span class="co">]</span>{.yellow}+<span class="co">[</span><span class="ot">\${decDate}</span><span class="co">]</span>{.cyan}. <span class="ot">&lt;https://observablehq.com/@fheyen/barchart-clock&gt;</span>.</span>
<span id="cb5-831"><a href="#cb5-831" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span><span class="co">[</span><span class="ot">Johnson, Ian</span><span class="co">](https://enjalot.github.io)</span>. [<span class="co">[</span><span class="ot">2021</span><span class="co">]</span>{.yellow}+<span class="co">[</span><span class="ot">090</span><span class="co">]</span>{.cyan}]{.underline .tool data-bs-toggle="tooltip" data-bs-title="2021-05-30"}. “Draggable World Map Coordinates Input.” <span class="co">[</span><span class="ot">\${decYear}</span><span class="co">]</span>{.yellow}+<span class="co">[</span><span class="ot">\${decDate}</span><span class="co">]</span>{.cyan}. <span class="ot">&lt;https://observablehq.com/@enjalot/draggable-world-map-coordinates-input&gt;</span>.</span>
<span id="cb5-832"><a href="#cb5-832" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span><span class="co">[</span><span class="ot">Bridges, Dan</span><span class="co">](https://www.danbridges.org)</span>. [<span class="co">[</span><span class="ot">2021</span><span class="co">]</span>{.yellow}+<span class="co">[</span><span class="ot">311</span><span class="co">]</span>{.cyan}]{.underline .tool data-bs-toggle="tooltip" data-bs-title="2022-01-06"}. “Visualizing Seasonal Daylight.” <span class="co">[</span><span class="ot">\${decYear}</span><span class="co">]</span>{.yellow}+<span class="co">[</span><span class="ot">\${decDate}</span><span class="co">]</span>{.cyan}. <span class="ot">&lt;https://observablehq.com/@dbridges/visualizing-seasonal-daylight&gt;</span>.</span>
<span id="cb5-833"><a href="#cb5-833" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span><span class="co">[</span><span class="ot">Clements, John</span><span class="co">](https://www.brinckerhoff.org)</span>. [<span class="co">[</span><span class="ot">2014</span><span class="co">]</span>{.yellow}+<span class="co">[</span><span class="ot">091</span><span class="co">]</span>{.cyan}]{.underline .tool data-bs-toggle="tooltip" data-bs-title="2021-05-31"}, “Decimal Time Zones.” <span class="co">[</span><span class="ot">\${decYear}</span><span class="co">]</span>{.yellow}+<span class="co">[</span><span class="ot">\${decDate}</span><span class="co">]</span>{.cyan}. <span class="ot">&lt;https://www.brinckerhoff.org/blog/2014/05/31/decimal-time-zones&gt;</span>.</span>
<span id="cb5-834"><a href="#cb5-834" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-837"><a href="#cb5-837" aria-hidden="true" tabindex="-1"></a><span class="in">```{ojs}</span></span>
<span id="cb5-838"><a href="#cb5-838" aria-hidden="true" tabindex="-1"></a><span class="co">//| echo: false</span></span>
<span id="cb5-839"><a href="#cb5-839" aria-hidden="true" tabindex="-1"></a><span class="co">//| output: false</span></span>
<span id="cb5-840"><a href="#cb5-840" aria-hidden="true" tabindex="-1"></a><span class="kw">function</span> <span class="fu">unix2dote</span>(unix<span class="op">,</span> zone<span class="op">,</span> offset <span class="op">=</span> <span class="dv">719468</span>) {</span>
<span id="cb5-841"><a href="#cb5-841" aria-hidden="true" tabindex="-1"></a>  <span class="cf">return</span> [(unix <span class="op">??</span> <span class="bu">Date</span><span class="op">.</span><span class="fu">now</span>()) <span class="op">/</span> <span class="dv">86400000</span> <span class="op">+</span> (</span>
<span id="cb5-842"><a href="#cb5-842" aria-hidden="true" tabindex="-1"></a>    zone <span class="op">=</span> zone <span class="op">??</span> <span class="op">-</span><span class="bu">Math</span><span class="op">.</span><span class="fu">round</span>(</span>
<span id="cb5-843"><a href="#cb5-843" aria-hidden="true" tabindex="-1"></a>      (<span class="kw">new</span> <span class="bu">Date</span>)<span class="op">.</span><span class="fu">getTimezoneOffset</span>() <span class="op">/</span> <span class="dv">144</span>)</span>
<span id="cb5-844"><a href="#cb5-844" aria-hidden="true" tabindex="-1"></a>    ) <span class="op">/</span> <span class="dv">10</span> <span class="op">+</span> offset<span class="op">,</span> zone]</span>
<span id="cb5-845"><a href="#cb5-845" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb5-846"><a href="#cb5-846" aria-hidden="true" tabindex="-1"></a><span class="kw">function</span> <span class="fu">unix2dote1</span>(unix<span class="op">,</span> zone<span class="op">,</span> offset <span class="op">=</span> <span class="dv">719468</span>) {</span>
<span id="cb5-847"><a href="#cb5-847" aria-hidden="true" tabindex="-1"></a>  <span class="cf">return</span> [</span>
<span id="cb5-848"><a href="#cb5-848" aria-hidden="true" tabindex="-1"></a>    (unix <span class="op">??</span> <span class="bu">Date</span><span class="op">.</span><span class="fu">now</span>()) <span class="op">/</span> <span class="dv">86400000</span></span>
<span id="cb5-849"><a href="#cb5-849" aria-hidden="true" tabindex="-1"></a>    <span class="op">+</span> (zone <span class="op">=</span> zone <span class="op">??</span> (<span class="dv">10</span> <span class="op">-</span> <span class="bu">Math</span><span class="op">.</span><span class="fu">round</span>(</span>
<span id="cb5-850"><a href="#cb5-850" aria-hidden="true" tabindex="-1"></a>        (<span class="kw">new</span> <span class="bu">Date</span>)<span class="op">.</span><span class="fu">getTimezoneOffset</span>() <span class="op">/</span> <span class="dv">144</span>)) <span class="op">%</span> <span class="dv">10</span></span>
<span id="cb5-851"><a href="#cb5-851" aria-hidden="true" tabindex="-1"></a>      ) <span class="op">/</span> <span class="dv">10</span> <span class="op">+</span> offset<span class="op">,</span> zone]</span>
<span id="cb5-852"><a href="#cb5-852" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb5-853"><a href="#cb5-853" aria-hidden="true" tabindex="-1"></a><span class="kw">function</span> <span class="fu">dote2date</span>(dote<span class="op">,</span> zone <span class="op">=</span> <span class="dv">0</span>) {</span>
<span id="cb5-854"><a href="#cb5-854" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> cote <span class="op">=</span> <span class="bu">Math</span><span class="op">.</span><span class="fu">floor</span>((</span>
<span id="cb5-855"><a href="#cb5-855" aria-hidden="true" tabindex="-1"></a>      dote <span class="op">&gt;=</span> <span class="dv">0</span> <span class="op">?</span> dote</span>
<span id="cb5-856"><a href="#cb5-856" aria-hidden="true" tabindex="-1"></a>      <span class="op">:</span> dote <span class="op">-</span> <span class="dv">146096</span></span>
<span id="cb5-857"><a href="#cb5-857" aria-hidden="true" tabindex="-1"></a>    ) <span class="op">/</span> <span class="dv">146097</span>)<span class="op">,</span></span>
<span id="cb5-858"><a href="#cb5-858" aria-hidden="true" tabindex="-1"></a>  dotc <span class="op">=</span> dote <span class="op">-</span> cote <span class="op">*</span> <span class="dv">146097</span><span class="op">,</span></span>
<span id="cb5-859"><a href="#cb5-859" aria-hidden="true" tabindex="-1"></a>  yotc <span class="op">=</span> <span class="bu">Math</span><span class="op">.</span><span class="fu">floor</span>((dotc</span>
<span id="cb5-860"><a href="#cb5-860" aria-hidden="true" tabindex="-1"></a>    <span class="op">-</span> <span class="bu">Math</span><span class="op">.</span><span class="fu">floor</span>(dotc <span class="op">/</span> <span class="dv">1460</span>)</span>
<span id="cb5-861"><a href="#cb5-861" aria-hidden="true" tabindex="-1"></a>    <span class="op">+</span> <span class="bu">Math</span><span class="op">.</span><span class="fu">floor</span>(dotc <span class="op">/</span> <span class="dv">36524</span>)</span>
<span id="cb5-862"><a href="#cb5-862" aria-hidden="true" tabindex="-1"></a>    <span class="op">-</span> <span class="bu">Math</span><span class="op">.</span><span class="fu">floor</span>(dotc <span class="op">/</span> <span class="dv">146096</span>)</span>
<span id="cb5-863"><a href="#cb5-863" aria-hidden="true" tabindex="-1"></a>  ) <span class="op">/</span> <span class="dv">365</span>)<span class="op">;</span></span>
<span id="cb5-864"><a href="#cb5-864" aria-hidden="true" tabindex="-1"></a>  <span class="cf">return</span> [</span>
<span id="cb5-865"><a href="#cb5-865" aria-hidden="true" tabindex="-1"></a>    yotc <span class="op">+</span> cote <span class="op">*</span> <span class="dv">400</span><span class="op">,</span></span>
<span id="cb5-866"><a href="#cb5-866" aria-hidden="true" tabindex="-1"></a>    dotc <span class="op">-</span> (yotc <span class="op">*</span> <span class="dv">365</span></span>
<span id="cb5-867"><a href="#cb5-867" aria-hidden="true" tabindex="-1"></a>      <span class="op">+</span> <span class="bu">Math</span><span class="op">.</span><span class="fu">floor</span>(yotc <span class="op">/</span> <span class="dv">4</span>)</span>
<span id="cb5-868"><a href="#cb5-868" aria-hidden="true" tabindex="-1"></a>      <span class="op">-</span> <span class="bu">Math</span><span class="op">.</span><span class="fu">floor</span>(yotc <span class="op">/</span> <span class="dv">100</span>)</span>
<span id="cb5-869"><a href="#cb5-869" aria-hidden="true" tabindex="-1"></a>  )<span class="op">,</span> zone]}</span>
<span id="cb5-870"><a href="#cb5-870" aria-hidden="true" tabindex="-1"></a>dz <span class="op">=</span> <span class="fu">unix2dote</span>(now)</span>
<span id="cb5-871"><a href="#cb5-871" aria-hidden="true" tabindex="-1"></a>ydz <span class="op">=</span> <span class="fu">dote2date</span>(<span class="op">...</span>dz)</span>
<span id="cb5-872"><a href="#cb5-872" aria-hidden="true" tabindex="-1"></a>decYear <span class="op">=</span> ydz[<span class="dv">0</span>]<span class="op">.</span><span class="fu">toString</span>()<span class="op">.</span><span class="fu">padStart</span>(<span class="dv">4</span><span class="op">,</span> <span class="st">"0"</span>)</span>
<span id="cb5-873"><a href="#cb5-873" aria-hidden="true" tabindex="-1"></a>decDate <span class="op">=</span> <span class="bu">Math</span><span class="op">.</span><span class="fu">floor</span>(ydz[<span class="dv">1</span>])<span class="op">.</span><span class="fu">toString</span>()<span class="op">.</span><span class="fu">padStart</span>(<span class="dv">3</span><span class="op">,</span> <span class="st">"0"</span>)</span>
<span id="cb5-874"><a href="#cb5-874" aria-hidden="true" tabindex="-1"></a>browserDote <span class="op">=</span> <span class="fu">unix2dote</span>(now)</span>
<span id="cb5-875"><a href="#cb5-875" aria-hidden="true" tabindex="-1"></a>browserTime <span class="op">=</span> browserDote[<span class="dv">0</span>] <span class="op">%</span> <span class="dv">1</span> <span class="op">*</span> <span class="dv">10</span></span>
<span id="cb5-876"><a href="#cb5-876" aria-hidden="true" tabindex="-1"></a>browserZone <span class="op">=</span> browserDote[<span class="dv">1</span>]</span>
<span id="cb5-877"><a href="#cb5-877" aria-hidden="true" tabindex="-1"></a>browserSign <span class="op">=</span> browserZone <span class="op">&gt;</span> <span class="dv">0</span> <span class="op">?</span> <span class="st">"-"</span> <span class="op">:</span> <span class="st">"+"</span></span>
<span id="cb5-878"><a href="#cb5-878" aria-hidden="true" tabindex="-1"></a>zone0time <span class="op">=</span> (browserTime <span class="op">-</span> browserZone <span class="op">+</span> <span class="dv">10</span>) <span class="op">%</span> <span class="dv">10</span></span>
<span id="cb5-879"><a href="#cb5-879" aria-hidden="true" tabindex="-1"></a>hours <span class="op">=</span> browserTime <span class="op">*</span> <span class="fl">2.4</span></span>
<span id="cb5-880"><a href="#cb5-880" aria-hidden="true" tabindex="-1"></a>minutes <span class="op">=</span> hours <span class="op">%</span> <span class="dv">1</span> <span class="op">*</span> <span class="dv">60</span></span>
<span id="cb5-881"><a href="#cb5-881" aria-hidden="true" tabindex="-1"></a>seconds <span class="op">=</span> minutes <span class="op">%</span> <span class="dv">1</span> <span class="op">*</span> <span class="dv">60</span></span>
<span id="cb5-882"><a href="#cb5-882" aria-hidden="true" tabindex="-1"></a>selectedDote <span class="op">=</span> <span class="fu">unix2dote</span>(now<span class="op">,</span> <span class="fu">long2zone</span>(location[<span class="dv">0</span>]))</span>
<span id="cb5-883"><a href="#cb5-883" aria-hidden="true" tabindex="-1"></a>selectedExact <span class="op">=</span> selectedDote[<span class="dv">0</span>] <span class="op">%</span> <span class="dv">1</span></span>
<span id="cb5-884"><a href="#cb5-884" aria-hidden="true" tabindex="-1"></a>selectedExactN <span class="op">=</span> (<span class="dv">1</span> <span class="op">-</span> selectedExact) <span class="op">%</span> <span class="dv">1</span></span>
<span id="cb5-885"><a href="#cb5-885" aria-hidden="true" tabindex="-1"></a>selectedZone <span class="op">=</span> selectedDote[<span class="dv">1</span>]</span>
<span id="cb5-886"><a href="#cb5-886" aria-hidden="true" tabindex="-1"></a>decTime <span class="op">=</span> (selectedExact <span class="op">*</span> <span class="dv">10</span>)<span class="op">.</span><span class="fu">toFixed</span>(<span class="dv">4</span>)</span>
<span id="cb5-887"><a href="#cb5-887" aria-hidden="true" tabindex="-1"></a>decTimeN <span class="op">=</span> (selectedExactN <span class="op">*</span> <span class="dv">10</span>)<span class="op">.</span><span class="fu">toFixed</span>(<span class="dv">4</span>)</span>
<span id="cb5-888"><a href="#cb5-888" aria-hidden="true" tabindex="-1"></a>barDD <span class="op">=</span> decTime[<span class="dv">0</span>]</span>
<span id="cb5-889"><a href="#cb5-889" aria-hidden="true" tabindex="-1"></a>barDDN <span class="op">=</span> decTimeN[<span class="dv">0</span>]</span>
<span id="cb5-890"><a href="#cb5-890" aria-hidden="true" tabindex="-1"></a>barMils <span class="op">=</span> decTime<span class="op">.</span><span class="fu">slice</span>(<span class="dv">2</span><span class="op">,</span> <span class="dv">4</span>)</span>
<span id="cb5-891"><a href="#cb5-891" aria-hidden="true" tabindex="-1"></a>barMilsN <span class="op">=</span> decTimeN<span class="op">.</span><span class="fu">slice</span>(<span class="dv">2</span><span class="op">,</span> <span class="dv">4</span>)</span>
<span id="cb5-892"><a href="#cb5-892" aria-hidden="true" tabindex="-1"></a>barBeats <span class="op">=</span> decTime<span class="op">.</span><span class="fu">slice</span>(<span class="dv">4</span><span class="op">,</span> <span class="dv">6</span>)</span>
<span id="cb5-893"><a href="#cb5-893" aria-hidden="true" tabindex="-1"></a>barBeatsN <span class="op">=</span> decTimeN<span class="op">.</span><span class="fu">slice</span>(<span class="dv">4</span><span class="op">,</span> <span class="dv">6</span>)</span>
<span id="cb5-894"><a href="#cb5-894" aria-hidden="true" tabindex="-1"></a><span class="kw">function</span> <span class="fu">lati2turn1</span>(degrees <span class="op">=</span> <span class="op">-</span><span class="dv">180</span><span class="op">,</span> e <span class="op">=</span> <span class="dv">3</span>) {</span>
<span id="cb5-895"><a href="#cb5-895" aria-hidden="true" tabindex="-1"></a>  <span class="co">// turns: e=0, deciturns: e=1, etc.</span></span>
<span id="cb5-896"><a href="#cb5-896" aria-hidden="true" tabindex="-1"></a>  <span class="cf">return</span> (degrees <span class="op">%=</span> <span class="dv">360</span>) <span class="op">/</span> (<span class="dv">360</span> <span class="op">/</span> <span class="dv">10</span><span class="op">**</span>e) <span class="op">%</span> <span class="dv">10</span><span class="op">**</span>e<span class="op">;</span></span>
<span id="cb5-897"><a href="#cb5-897" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb5-898"><a href="#cb5-898" aria-hidden="true" tabindex="-1"></a>graticule <span class="op">=</span> d3<span class="op">.</span><span class="fu">geoGraticule</span>()<span class="op">.</span><span class="fu">stepMinor</span>([<span class="dv">36</span><span class="op">,</span><span class="dv">36</span>])<span class="op">.</span><span class="fu">stepMajor</span>([<span class="dv">36</span><span class="op">,</span><span class="dv">36</span>])()</span>
<span id="cb5-899"><a href="#cb5-899" aria-hidden="true" tabindex="-1"></a>graticule<span class="op">.</span><span class="at">coordinates</span> <span class="op">=</span> graticule<span class="op">.</span><span class="at">coordinates</span><span class="op">.</span><span class="fu">map</span>(</span>
<span id="cb5-900"><a href="#cb5-900" aria-hidden="true" tabindex="-1"></a>  i <span class="kw">=&gt;</span> i<span class="op">.</span><span class="fu">map</span>(j <span class="kw">=&gt;</span> j<span class="op">.</span><span class="fu">map</span>((k<span class="op">,</span> index<span class="op">,</span> arr) <span class="kw">=&gt;</span> i<span class="op">.</span><span class="at">length</span> <span class="op">===</span> <span class="dv">3</span> <span class="op">&amp;&amp;</span> index <span class="op">===</span> <span class="dv">0</span> <span class="op">?</span> k <span class="op">-</span> <span class="dv">18</span> <span class="op">:</span> k))</span>
<span id="cb5-901"><a href="#cb5-901" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb5-902"><a href="#cb5-902" aria-hidden="true" tabindex="-1"></a><span class="kw">function</span> <span class="fu">long2turn</span>(degrees <span class="op">=</span> <span class="op">-</span><span class="dv">180</span><span class="op">,</span> e <span class="op">=</span> <span class="dv">3</span>) {</span>
<span id="cb5-903"><a href="#cb5-903" aria-hidden="true" tabindex="-1"></a>  <span class="co">// turns: e=0, deciturns: e=1, etc.</span></span>
<span id="cb5-904"><a href="#cb5-904" aria-hidden="true" tabindex="-1"></a>  <span class="cf">return</span> (((degrees <span class="op">%=</span> <span class="dv">360</span>) <span class="op">&lt;</span> <span class="dv">0</span> <span class="op">?</span> degrees <span class="op">+</span> <span class="dv">360</span> <span class="op">:</span> degrees) <span class="op">+</span> <span class="dv">18</span>) <span class="op">/</span> (<span class="dv">360</span> <span class="op">/</span> <span class="dv">10</span><span class="op">**</span>e) <span class="op">%</span> <span class="dv">10</span><span class="op">**</span>e<span class="op">;</span></span>
<span id="cb5-905"><a href="#cb5-905" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb5-906"><a href="#cb5-906" aria-hidden="true" tabindex="-1"></a><span class="co">// https://github.com/topojson/world-atlas</span></span>
<span id="cb5-907"><a href="#cb5-907" aria-hidden="true" tabindex="-1"></a>world <span class="op">=</span> d3<span class="op">.</span><span class="fu">json</span>(<span class="st">"https://cdn.jsdelivr.net/npm/world-atlas@2/countries-110m.json"</span>)</span>
<span id="cb5-908"><a href="#cb5-908" aria-hidden="true" tabindex="-1"></a>countries <span class="op">=</span> topojson<span class="op">.</span><span class="fu">feature</span>(world<span class="op">,</span> world<span class="op">.</span><span class="at">objects</span><span class="op">.</span><span class="at">countries</span>)</span>
<span id="cb5-909"><a href="#cb5-909" aria-hidden="true" tabindex="-1"></a>topojson <span class="op">=</span> <span class="pp">require</span>(<span class="st">"topojson-client@3"</span>)</span>
<span id="cb5-910"><a href="#cb5-910" aria-hidden="true" tabindex="-1"></a><span class="kw">function</span> <span class="fu">long2zone</span>(degrees <span class="op">=</span> <span class="op">-</span><span class="dv">180</span>) {</span>
<span id="cb5-911"><a href="#cb5-911" aria-hidden="true" tabindex="-1"></a>  <span class="cf">return</span> <span class="bu">Math</span><span class="op">.</span><span class="fu">floor</span>(<span class="fu">long2turn</span>(degrees<span class="op">,</span> <span class="dv">1</span>))<span class="op">;</span></span>
<span id="cb5-912"><a href="#cb5-912" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb5-913"><a href="#cb5-913" aria-hidden="true" tabindex="-1"></a><span class="kw">function</span> <span class="fu">year2leap</span>(year <span class="op">=</span> <span class="dv">1970</span>) {</span>
<span id="cb5-914"><a href="#cb5-914" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> year <span class="op">%</span> <span class="dv">4</span> <span class="op">==</span> <span class="dv">0</span> <span class="op">&amp;&amp;</span> year <span class="op">%</span> <span class="dv">100</span> <span class="op">!=</span> <span class="dv">0</span> <span class="op">||</span> year <span class="op">%</span> <span class="dv">400</span> <span class="op">==</span> <span class="dv">0</span><span class="op">;</span></span>
<span id="cb5-915"><a href="#cb5-915" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb5-916"><a href="#cb5-916" aria-hidden="true" tabindex="-1"></a><span class="co">// https://observablehq.com/@dbridges/visualizing-seasonal-daylight</span></span>
<span id="cb5-917"><a href="#cb5-917" aria-hidden="true" tabindex="-1"></a>solarSystem <span class="op">=</span> (<span class="bu">root</span><span class="op">,</span> width<span class="op">,</span> location<span class="op">,</span> date<span class="op">,</span> hour) <span class="kw">=&gt;</span> {</span>
<span id="cb5-918"><a href="#cb5-918" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> earthRadius <span class="op">=</span> <span class="fl">0.04</span> <span class="op">*</span> width<span class="op">;</span></span>
<span id="cb5-919"><a href="#cb5-919" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> sunRadius <span class="op">=</span> <span class="fl">0.08</span> <span class="op">*</span> width<span class="op">;</span></span>
<span id="cb5-920"><a href="#cb5-920" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> solarSystemRadius <span class="op">=</span> width <span class="op">/</span> <span class="dv">2</span> <span class="op">-</span> <span class="dv">20</span><span class="op">;</span></span>
<span id="cb5-921"><a href="#cb5-921" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> stretch <span class="op">=</span> <span class="fl">0.3</span><span class="op">;</span></span>
<span id="cb5-922"><a href="#cb5-922" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> solarAngle <span class="op">=</span> <span class="fu">getSolarAngle</span>(date)<span class="op">;</span></span>
<span id="cb5-923"><a href="#cb5-923" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> solarAngleDeg <span class="op">=</span> (solarAngle <span class="op">*</span> <span class="dv">180</span>) <span class="op">/</span> <span class="bu">Math</span><span class="op">.</span><span class="cn">PI</span><span class="op">;</span></span>
<span id="cb5-924"><a href="#cb5-924" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> x <span class="op">=</span> solarSystemRadius <span class="op">*</span> <span class="bu">Math</span><span class="op">.</span><span class="fu">sin</span>(solarAngle)<span class="op">;</span></span>
<span id="cb5-925"><a href="#cb5-925" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> y <span class="op">=</span> stretch <span class="op">*</span> solarSystemRadius <span class="op">*</span> <span class="bu">Math</span><span class="op">.</span><span class="fu">cos</span>(solarAngle)<span class="op">;</span></span>
<span id="cb5-926"><a href="#cb5-926" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> spin <span class="op">=</span> <span class="dv">180</span> <span class="op">+</span> <span class="op">-</span>location[<span class="dv">0</span>] <span class="op">+</span> solarAngleDeg <span class="op">+</span> <span class="dv">360</span> <span class="op">*</span> ((hour <span class="op">+</span> <span class="dv">12</span>) <span class="op">/</span> <span class="dv">24</span>)<span class="op">;</span></span>
<span id="cb5-927"><a href="#cb5-927" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> earthGeo <span class="op">=</span> { <span class="dt">type</span><span class="op">:</span> <span class="st">"Sphere"</span> }<span class="op">;</span></span>
<span id="cb5-928"><a href="#cb5-928" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> projection <span class="op">=</span> d3</span>
<span id="cb5-929"><a href="#cb5-929" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">geoOrthographic</span>()</span>
<span id="cb5-930"><a href="#cb5-930" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">fitWidth</span>(earthRadius <span class="op">*</span> <span class="dv">2</span><span class="op">,</span> earthGeo)</span>
<span id="cb5-931"><a href="#cb5-931" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">rotate</span>([spin<span class="op">,</span> <span class="dv">0</span><span class="op">,</span> <span class="fl">23.5</span>])</span>
<span id="cb5-932"><a href="#cb5-932" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">translate</span>([<span class="dv">0</span><span class="op">,</span> <span class="dv">0</span>])<span class="op">;</span></span>
<span id="cb5-933"><a href="#cb5-933" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> staticProjection <span class="op">=</span> d3</span>
<span id="cb5-934"><a href="#cb5-934" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">geoOrthographic</span>()</span>
<span id="cb5-935"><a href="#cb5-935" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">fitWidth</span>(earthRadius <span class="op">*</span> <span class="dv">2</span><span class="op">,</span> earthGeo)</span>
<span id="cb5-936"><a href="#cb5-936" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">rotate</span>([solarAngleDeg <span class="op">-</span> <span class="dv">90</span><span class="op">,</span> <span class="dv">0</span>])</span>
<span id="cb5-937"><a href="#cb5-937" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">translate</span>([<span class="dv">0</span><span class="op">,</span> <span class="dv">0</span>])<span class="op">;</span></span>
<span id="cb5-938"><a href="#cb5-938" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> path <span class="op">=</span> d3<span class="op">.</span><span class="fu">geoPath</span>(projection)<span class="op">.</span><span class="fu">pointRadius</span>(<span class="fl">1.5</span>)<span class="op">;</span></span>
<span id="cb5-939"><a href="#cb5-939" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> staticPath <span class="op">=</span> d3<span class="op">.</span><span class="fu">geoPath</span>(staticProjection)<span class="op">;</span></span>
<span id="cb5-940"><a href="#cb5-940" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> solarSystem <span class="op">=</span> <span class="bu">root</span></span>
<span id="cb5-941"><a href="#cb5-941" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">append</span>(<span class="st">"g"</span>)</span>
<span id="cb5-942"><a href="#cb5-942" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">"transform"</span><span class="op">,</span> <span class="vs">`translate(</span><span class="sc">${</span>width <span class="op">/</span> <span class="dv">2</span><span class="sc">}</span><span class="vs">)`</span>)<span class="op">;</span></span>
<span id="cb5-943"><a href="#cb5-943" aria-hidden="true" tabindex="-1"></a>  solarSystem<span class="op">.</span><span class="fu">append</span>(<span class="st">"circle"</span>)<span class="op">.</span><span class="fu">attr</span>(<span class="st">"r"</span><span class="op">,</span> sunRadius)<span class="op">.</span><span class="fu">attr</span>(<span class="st">"fill"</span><span class="op">,</span> colors<span class="op">.</span><span class="at">sun</span>)<span class="op">;</span></span>
<span id="cb5-944"><a href="#cb5-944" aria-hidden="true" tabindex="-1"></a>  <span class="co">/* Draw orbit */</span></span>
<span id="cb5-945"><a href="#cb5-945" aria-hidden="true" tabindex="-1"></a>  solarSystem</span>
<span id="cb5-946"><a href="#cb5-946" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">append</span>(<span class="st">"ellipse"</span>)</span>
<span id="cb5-947"><a href="#cb5-947" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">"rx"</span><span class="op">,</span> solarSystemRadius)</span>
<span id="cb5-948"><a href="#cb5-948" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">"ry"</span><span class="op">,</span> stretch <span class="op">*</span> solarSystemRadius)</span>
<span id="cb5-949"><a href="#cb5-949" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">"fill"</span><span class="op">,</span> <span class="st">"none"</span>)</span>
<span id="cb5-950"><a href="#cb5-950" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">"stroke"</span><span class="op">,</span> <span class="st">"black"</span>)<span class="op">;</span></span>
<span id="cb5-951"><a href="#cb5-951" aria-hidden="true" tabindex="-1"></a>  <span class="co">/* Draw month ticks */</span></span>
<span id="cb5-952"><a href="#cb5-952" aria-hidden="true" tabindex="-1"></a>  d3<span class="op">.</span><span class="fu">range</span>(<span class="dv">12</span>)<span class="op">.</span><span class="fu">map</span>((m) <span class="kw">=&gt;</span> {</span>
<span id="cb5-953"><a href="#cb5-953" aria-hidden="true" tabindex="-1"></a>    <span class="kw">const</span> d <span class="op">=</span> <span class="kw">new</span> <span class="bu">Date</span>(date<span class="op">.</span><span class="fu">getFullYear</span>()<span class="op">,</span> m<span class="op">,</span> <span class="dv">1</span>)<span class="op">;</span></span>
<span id="cb5-954"><a href="#cb5-954" aria-hidden="true" tabindex="-1"></a>    <span class="kw">const</span> angle <span class="op">=</span> <span class="fu">getSolarAngle</span>(d)<span class="op">;</span></span>
<span id="cb5-955"><a href="#cb5-955" aria-hidden="true" tabindex="-1"></a>    solarSystem</span>
<span id="cb5-956"><a href="#cb5-956" aria-hidden="true" tabindex="-1"></a>      <span class="op">.</span><span class="fu">append</span>(<span class="st">"line"</span>)</span>
<span id="cb5-957"><a href="#cb5-957" aria-hidden="true" tabindex="-1"></a>      <span class="op">.</span><span class="fu">attr</span>(<span class="st">"x1"</span><span class="op">,</span> (solarSystemRadius <span class="op">+</span> <span class="dv">6</span>) <span class="op">*</span> <span class="bu">Math</span><span class="op">.</span><span class="fu">sin</span>(angle))</span>
<span id="cb5-958"><a href="#cb5-958" aria-hidden="true" tabindex="-1"></a>      <span class="op">.</span><span class="fu">attr</span>(<span class="st">"y1"</span><span class="op">,</span> (solarSystemRadius <span class="op">+</span> <span class="dv">6</span>) <span class="op">*</span> stretch <span class="op">*</span> <span class="bu">Math</span><span class="op">.</span><span class="fu">cos</span>(angle))</span>
<span id="cb5-959"><a href="#cb5-959" aria-hidden="true" tabindex="-1"></a>      <span class="op">.</span><span class="fu">attr</span>(<span class="st">"x2"</span><span class="op">,</span> (solarSystemRadius <span class="op">-</span> <span class="dv">6</span>) <span class="op">*</span> <span class="bu">Math</span><span class="op">.</span><span class="fu">sin</span>(angle))</span>
<span id="cb5-960"><a href="#cb5-960" aria-hidden="true" tabindex="-1"></a>      <span class="op">.</span><span class="fu">attr</span>(<span class="st">"y2"</span><span class="op">,</span> (solarSystemRadius <span class="op">-</span> <span class="dv">6</span>) <span class="op">*</span> stretch <span class="op">*</span> <span class="bu">Math</span><span class="op">.</span><span class="fu">cos</span>(angle))</span>
<span id="cb5-961"><a href="#cb5-961" aria-hidden="true" tabindex="-1"></a>      <span class="op">.</span><span class="fu">attr</span>(<span class="st">"stroke"</span><span class="op">,</span> <span class="st">"black"</span>)<span class="op">;</span></span>
<span id="cb5-962"><a href="#cb5-962" aria-hidden="true" tabindex="-1"></a>    <span class="kw">const</span> startMonthAngle <span class="op">=</span> <span class="fu">getSolarAngle</span>(<span class="kw">new</span> <span class="bu">Date</span>(date<span class="op">.</span><span class="fu">getFullYear</span>()<span class="op">,</span> m<span class="op">,</span> <span class="dv">1</span>))<span class="op">;</span></span>
<span id="cb5-963"><a href="#cb5-963" aria-hidden="true" tabindex="-1"></a>    solarSystem</span>
<span id="cb5-964"><a href="#cb5-964" aria-hidden="true" tabindex="-1"></a>      <span class="op">.</span><span class="fu">append</span>(<span class="st">"text"</span>)</span>
<span id="cb5-965"><a href="#cb5-965" aria-hidden="true" tabindex="-1"></a>      <span class="op">.</span><span class="fu">text</span>(<span class="fu">date2doty</span>(d))</span>
<span id="cb5-966"><a href="#cb5-966" aria-hidden="true" tabindex="-1"></a>      <span class="op">.</span><span class="fu">attr</span>(<span class="st">"x"</span><span class="op">,</span> (solarSystemRadius <span class="op">+</span> <span class="dv">18</span>) <span class="op">*</span> <span class="bu">Math</span><span class="op">.</span><span class="fu">sin</span>(startMonthAngle))</span>
<span id="cb5-967"><a href="#cb5-967" aria-hidden="true" tabindex="-1"></a>      <span class="op">.</span><span class="fu">attr</span>(</span>
<span id="cb5-968"><a href="#cb5-968" aria-hidden="true" tabindex="-1"></a>        <span class="st">"y"</span><span class="op">,</span></span>
<span id="cb5-969"><a href="#cb5-969" aria-hidden="true" tabindex="-1"></a>        (solarSystemRadius <span class="op">+</span> <span class="dv">18</span>) <span class="op">*</span> <span class="fl">1.18</span> <span class="op">*</span> stretch <span class="op">*</span> <span class="bu">Math</span><span class="op">.</span><span class="fu">cos</span>(startMonthAngle)</span>
<span id="cb5-970"><a href="#cb5-970" aria-hidden="true" tabindex="-1"></a>      )</span>
<span id="cb5-971"><a href="#cb5-971" aria-hidden="true" tabindex="-1"></a>      <span class="op">.</span><span class="fu">attr</span>(<span class="st">"text-anchor"</span><span class="op">,</span> <span class="st">"middle"</span>)</span>
<span id="cb5-972"><a href="#cb5-972" aria-hidden="true" tabindex="-1"></a>      <span class="op">.</span><span class="fu">attr</span>(<span class="st">"font-size"</span><span class="op">,</span> fontSize <span class="op">*</span> (width <span class="op">&lt;</span> <span class="dv">165</span> <span class="op">?</span> <span class="op">.</span><span class="dv">9</span> <span class="op">:</span> width <span class="op">&lt;</span> <span class="dv">265</span> <span class="op">?</span> <span class="dv">1</span> <span class="op">:</span> width <span class="op">&lt;</span> <span class="dv">365</span> <span class="op">?</span> <span class="fl">1.1</span> <span class="op">:</span> <span class="fl">1.2</span>))</span>
<span id="cb5-973"><a href="#cb5-973" aria-hidden="true" tabindex="-1"></a>      <span class="op">.</span><span class="fu">attr</span>(<span class="st">"dominant-baseline"</span><span class="op">,</span> <span class="st">"middle"</span>)</span>
<span id="cb5-974"><a href="#cb5-974" aria-hidden="true" tabindex="-1"></a>      <span class="op">.</span><span class="fu">attr</span>(<span class="st">"font-size"</span><span class="op">,</span> fontSize <span class="op">*</span> (width <span class="op">&lt;</span> <span class="dv">165</span> <span class="op">?</span> <span class="op">.</span><span class="dv">9</span> <span class="op">:</span> width <span class="op">&lt;</span> <span class="dv">265</span> <span class="op">?</span> <span class="dv">1</span> <span class="op">:</span> width <span class="op">&lt;</span> <span class="dv">365</span> <span class="op">?</span> <span class="fl">1.1</span> <span class="op">:</span> <span class="fl">1.2</span>))</span>
<span id="cb5-975"><a href="#cb5-975" aria-hidden="true" tabindex="-1"></a>      <span class="op">.</span><span class="fu">attr</span>(<span class="st">"font-family"</span><span class="op">,</span> <span class="st">"sans-serif"</span>)</span>
<span id="cb5-976"><a href="#cb5-976" aria-hidden="true" tabindex="-1"></a>      <span class="op">.</span><span class="fu">attr</span>(<span class="st">"fill"</span><span class="op">,</span> <span class="st">"black"</span>)<span class="op">;</span></span>
<span id="cb5-977"><a href="#cb5-977" aria-hidden="true" tabindex="-1"></a>  })<span class="op">;</span></span>
<span id="cb5-978"><a href="#cb5-978" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> earth <span class="op">=</span> solarSystem</span>
<span id="cb5-979"><a href="#cb5-979" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">append</span>(<span class="st">"g"</span>)</span>
<span id="cb5-980"><a href="#cb5-980" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">"transform"</span><span class="op">,</span> <span class="vs">`translate(</span><span class="sc">${</span>x<span class="sc">}</span><span class="vs">, </span><span class="sc">${</span>y<span class="sc">}</span><span class="vs">)`</span>)<span class="op">;</span></span>
<span id="cb5-981"><a href="#cb5-981" aria-hidden="true" tabindex="-1"></a>  earth</span>
<span id="cb5-982"><a href="#cb5-982" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">append</span>(<span class="st">"line"</span>)</span>
<span id="cb5-983"><a href="#cb5-983" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">"y1"</span><span class="op">,</span> <span class="op">-</span><span class="fl">1.5</span> <span class="op">*</span> earthRadius)</span>
<span id="cb5-984"><a href="#cb5-984" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">"y2"</span><span class="op">,</span> <span class="fl">1.5</span> <span class="op">*</span> earthRadius)</span>
<span id="cb5-985"><a href="#cb5-985" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">"stroke"</span><span class="op">,</span> <span class="st">"blue"</span>)</span>
<span id="cb5-986"><a href="#cb5-986" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">"transform"</span><span class="op">,</span> <span class="vs">`rotate(-23.5)`</span>)<span class="op">;</span></span>
<span id="cb5-987"><a href="#cb5-987" aria-hidden="true" tabindex="-1"></a>  earth<span class="op">.</span><span class="fu">append</span>(<span class="st">"path"</span>)<span class="op">.</span><span class="fu">attr</span>(<span class="st">"d"</span><span class="op">,</span> <span class="fu">path</span>(earthGeo))<span class="op">.</span><span class="fu">attr</span>(<span class="st">"fill"</span><span class="op">,</span> colors<span class="op">.</span><span class="at">ocean</span>)<span class="op">;</span></span>
<span id="cb5-988"><a href="#cb5-988" aria-hidden="true" tabindex="-1"></a>  earth<span class="op">.</span><span class="fu">append</span>(<span class="st">"path"</span>)<span class="op">.</span><span class="fu">attr</span>(<span class="st">"d"</span><span class="op">,</span> <span class="fu">path</span>(land))<span class="op">.</span><span class="fu">attr</span>(<span class="st">"fill"</span><span class="op">,</span> colors<span class="op">.</span><span class="at">land</span>)<span class="op">;</span></span>
<span id="cb5-989"><a href="#cb5-989" aria-hidden="true" tabindex="-1"></a>  earth<span class="op">.</span><span class="fu">append</span>(<span class="st">"path"</span>)</span>
<span id="cb5-990"><a href="#cb5-990" aria-hidden="true" tabindex="-1"></a>  <span class="op">.</span><span class="fu">attr</span>(<span class="st">"d"</span><span class="op">,</span> <span class="fu">path</span>(countries))</span>
<span id="cb5-991"><a href="#cb5-991" aria-hidden="true" tabindex="-1"></a>  <span class="op">.</span><span class="fu">attr</span>(<span class="st">"stroke-width"</span><span class="op">,</span> <span class="st">".075"</span>)</span>
<span id="cb5-992"><a href="#cb5-992" aria-hidden="true" tabindex="-1"></a>  <span class="op">.</span><span class="fu">attr</span>(<span class="st">"fill"</span><span class="op">,</span> <span class="st">"none"</span>)</span>
<span id="cb5-993"><a href="#cb5-993" aria-hidden="true" tabindex="-1"></a>  <span class="op">.</span><span class="fu">attr</span>(<span class="st">"stroke"</span><span class="op">,</span> <span class="st">"#555"</span>)<span class="op">;</span></span>
<span id="cb5-994"><a href="#cb5-994" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> shadowPolygon <span class="op">=</span> [</span>
<span id="cb5-995"><a href="#cb5-995" aria-hidden="true" tabindex="-1"></a>    [<span class="dv">0</span><span class="op">,</span> <span class="op">-</span><span class="dv">90</span>]<span class="op">,</span></span>
<span id="cb5-996"><a href="#cb5-996" aria-hidden="true" tabindex="-1"></a>    [<span class="dv">0</span><span class="op">,</span> <span class="dv">0</span>]<span class="op">,</span></span>
<span id="cb5-997"><a href="#cb5-997" aria-hidden="true" tabindex="-1"></a>    [<span class="dv">0</span><span class="op">,</span> <span class="dv">90</span>]<span class="op">,</span></span>
<span id="cb5-998"><a href="#cb5-998" aria-hidden="true" tabindex="-1"></a>    [<span class="dv">180</span><span class="op">,</span> <span class="dv">0</span>]<span class="op">,</span></span>
<span id="cb5-999"><a href="#cb5-999" aria-hidden="true" tabindex="-1"></a>    [<span class="dv">0</span><span class="op">,</span> <span class="op">-</span><span class="dv">90</span>]</span>
<span id="cb5-1000"><a href="#cb5-1000" aria-hidden="true" tabindex="-1"></a>  ]<span class="op">;</span></span>
<span id="cb5-1001"><a href="#cb5-1001" aria-hidden="true" tabindex="-1"></a>  earth</span>
<span id="cb5-1002"><a href="#cb5-1002" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">append</span>(<span class="st">"path"</span>)</span>
<span id="cb5-1003"><a href="#cb5-1003" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">"d"</span><span class="op">,</span> <span class="fu">staticPath</span>({ <span class="dt">type</span><span class="op">:</span> <span class="st">"Polygon"</span><span class="op">,</span> <span class="dt">coordinates</span><span class="op">:</span> [shadowPolygon] }))</span>
<span id="cb5-1004"><a href="#cb5-1004" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">"fill"</span><span class="op">,</span> <span class="st">"rgba(0, 0, 0, 0.5)"</span>)<span class="op">;</span></span>
<span id="cb5-1005"><a href="#cb5-1005" aria-hidden="true" tabindex="-1"></a>  earth</span>
<span id="cb5-1006"><a href="#cb5-1006" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">append</span>(<span class="st">"path"</span>)</span>
<span id="cb5-1007"><a href="#cb5-1007" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">"d"</span><span class="op">,</span> <span class="fu">path</span>({ <span class="dt">type</span><span class="op">:</span> <span class="st">"Point"</span><span class="op">,</span> <span class="dt">coordinates</span><span class="op">:</span> location }))</span>
<span id="cb5-1008"><a href="#cb5-1008" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">"r"</span><span class="op">,</span> <span class="dv">18</span>)</span>
<span id="cb5-1009"><a href="#cb5-1009" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">"stroke-width"</span><span class="op">,</span> <span class="op">.</span><span class="dv">3</span>)</span>
<span id="cb5-1010"><a href="#cb5-1010" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">"stroke"</span><span class="op">,</span> <span class="st">"black"</span>)</span>
<span id="cb5-1011"><a href="#cb5-1011" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">"fill"</span><span class="op">,</span> <span class="st">"red"</span>)<span class="op">;</span></span>
<span id="cb5-1012"><a href="#cb5-1012" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb5-1013"><a href="#cb5-1013" aria-hidden="true" tabindex="-1"></a><span class="kw">function</span> <span class="fu">greg2doty</span>(month <span class="op">=</span> <span class="dv">1</span><span class="op">,</span> day <span class="op">=</span> <span class="dv">1</span>) {</span>
<span id="cb5-1014"><a href="#cb5-1014" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> <span class="bu">Math</span><span class="op">.</span><span class="fu">floor</span>(</span>
<span id="cb5-1015"><a href="#cb5-1015" aria-hidden="true" tabindex="-1"></a>        (<span class="dv">153</span> <span class="op">*</span> (month <span class="op">&gt;</span> <span class="dv">2</span> <span class="op">?</span> month <span class="op">-</span> <span class="dv">3</span> <span class="op">:</span> month <span class="op">+</span> <span class="dv">9</span>) <span class="op">+</span> <span class="dv">2</span>) <span class="op">/</span> <span class="dv">5</span> <span class="op">+</span> day <span class="op">-</span> <span class="dv">1</span></span>
<span id="cb5-1016"><a href="#cb5-1016" aria-hidden="true" tabindex="-1"></a>)}</span>
<span id="cb5-1017"><a href="#cb5-1017" aria-hidden="true" tabindex="-1"></a><span class="kw">function</span> <span class="fu">date2doty</span>(date) {</span>
<span id="cb5-1018"><a href="#cb5-1018" aria-hidden="true" tabindex="-1"></a>  <span class="cf">return</span> <span class="fu">greg2doty</span>(date<span class="op">.</span><span class="fu">getMonth</span>() <span class="op">+</span> <span class="dv">1</span><span class="op">,</span> date<span class="op">.</span><span class="fu">getDate</span>())</span>
<span id="cb5-1019"><a href="#cb5-1019" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb5-1020"><a href="#cb5-1020" aria-hidden="true" tabindex="-1"></a><span class="kw">function</span> <span class="fu">date2doty1</span>(date) {</span>
<span id="cb5-1021"><a href="#cb5-1021" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> doty <span class="op">=</span> <span class="fu">greg2doty</span>(date<span class="op">.</span><span class="fu">getMonth</span>() <span class="op">+</span> <span class="dv">1</span><span class="op">,</span> date<span class="op">.</span><span class="fu">getDate</span>())</span>
<span id="cb5-1022"><a href="#cb5-1022" aria-hidden="true" tabindex="-1"></a>  <span class="cf">return</span> doty <span class="op">===</span> <span class="dv">31</span> <span class="op">?</span> <span class="st">"Day "</span> <span class="op">+</span> <span class="bu">String</span>(doty) <span class="op">:</span> doty</span>
<span id="cb5-1023"><a href="#cb5-1023" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb5-1024"><a href="#cb5-1024" aria-hidden="true" tabindex="-1"></a><span class="co">// https://observablehq.com/@dbridges/visualizing-seasonal-daylight</span></span>
<span id="cb5-1025"><a href="#cb5-1025" aria-hidden="true" tabindex="-1"></a>globe <span class="op">=</span> (<span class="bu">root</span><span class="op">,</span> { width<span class="op">,</span> location<span class="op">,</span> date<span class="op">,</span> hour }) <span class="kw">=&gt;</span> {</span>
<span id="cb5-1026"><a href="#cb5-1026" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> solarAngle <span class="op">=</span> <span class="fu">getSolarAngle</span>(date)<span class="op">;</span></span>
<span id="cb5-1027"><a href="#cb5-1027" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> solarAngleDeg <span class="op">=</span> <span class="fu">toDegrees</span>(solarAngle)<span class="op">;</span></span>
<span id="cb5-1028"><a href="#cb5-1028" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> hourSpin <span class="op">=</span> <span class="dv">360</span> <span class="op">*</span> ((hour <span class="op">+</span> <span class="dv">12</span>) <span class="op">/</span> <span class="dv">24</span>)<span class="op">;</span></span>
<span id="cb5-1029"><a href="#cb5-1029" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> spin <span class="op">=</span> (<span class="dv">180</span> <span class="op">+</span> <span class="op">-</span>location[<span class="dv">0</span>] <span class="op">+</span> solarAngleDeg <span class="op">+</span> hourSpin)<span class="op">;</span></span>
<span id="cb5-1030"><a href="#cb5-1030" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> tilt <span class="op">=</span> <span class="op">-</span><span class="dv">15</span><span class="op">;</span></span>
<span id="cb5-1031"><a href="#cb5-1031" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> projection <span class="op">=</span> d3<span class="op">.</span><span class="fu">geoOrthographic</span>()</span>
<span id="cb5-1032"><a href="#cb5-1032" aria-hidden="true" tabindex="-1"></a>                       <span class="op">.</span><span class="fu">fitWidth</span>(width<span class="op">,</span> graticule)</span>
<span id="cb5-1033"><a href="#cb5-1033" aria-hidden="true" tabindex="-1"></a>                       <span class="op">.</span><span class="fu">rotate</span>([spin<span class="op">,</span> tilt<span class="op">,</span> <span class="fl">23.5</span>])<span class="op">;</span></span>
<span id="cb5-1034"><a href="#cb5-1034" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> path <span class="op">=</span> d3<span class="op">.</span><span class="fu">geoPath</span>(projection)<span class="op">;</span></span>
<span id="cb5-1035"><a href="#cb5-1035" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> unClippedProjection <span class="op">=</span> d3<span class="op">.</span><span class="fu">geoOrthographic</span>()</span>
<span id="cb5-1036"><a href="#cb5-1036" aria-hidden="true" tabindex="-1"></a>                                <span class="op">.</span><span class="fu">clipAngle</span>(<span class="kw">null</span>)</span>
<span id="cb5-1037"><a href="#cb5-1037" aria-hidden="true" tabindex="-1"></a>                                <span class="op">.</span><span class="fu">fitWidth</span>(width<span class="op">,</span> graticule)</span>
<span id="cb5-1038"><a href="#cb5-1038" aria-hidden="true" tabindex="-1"></a>                                <span class="op">.</span><span class="fu">rotate</span>([spin<span class="op">,</span> tilt<span class="op">,</span> <span class="fl">23.5</span>])<span class="op">;</span></span>
<span id="cb5-1039"><a href="#cb5-1039" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> unClippedPath <span class="op">=</span> d3<span class="op">.</span><span class="fu">geoPath</span>(unClippedProjection)<span class="op">;</span></span>
<span id="cb5-1040"><a href="#cb5-1040" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> staticProjection <span class="op">=</span> d3<span class="op">.</span><span class="fu">geoOrthographic</span>()</span>
<span id="cb5-1041"><a href="#cb5-1041" aria-hidden="true" tabindex="-1"></a>                             <span class="op">.</span><span class="fu">fitWidth</span>(width<span class="op">,</span> graticule)</span>
<span id="cb5-1042"><a href="#cb5-1042" aria-hidden="true" tabindex="-1"></a>                             <span class="op">.</span><span class="fu">rotate</span>([solarAngleDeg <span class="op">-</span> <span class="dv">90</span><span class="op">,</span> tilt])<span class="op">;</span></span>
<span id="cb5-1043"><a href="#cb5-1043" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> staticPath <span class="op">=</span> d3<span class="op">.</span><span class="fu">geoPath</span>(staticProjection)<span class="op">;</span></span>
<span id="cb5-1044"><a href="#cb5-1044" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> background <span class="op">=</span> <span class="bu">root</span><span class="op">.</span><span class="fu">append</span>(<span class="st">"g"</span>)<span class="op">;</span></span>
<span id="cb5-1045"><a href="#cb5-1045" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> earth <span class="op">=</span> <span class="bu">root</span><span class="op">.</span><span class="fu">append</span>(<span class="st">"g"</span>)<span class="op">.</span><span class="fu">style</span>(<span class="st">"opacity"</span><span class="op">,</span> <span class="fl">0.75</span>)<span class="op">;</span></span>
<span id="cb5-1046"><a href="#cb5-1046" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> foreground <span class="op">=</span> <span class="bu">root</span><span class="op">.</span><span class="fu">append</span>(<span class="st">"g"</span>)<span class="op">;</span></span>
<span id="cb5-1047"><a href="#cb5-1047" aria-hidden="true" tabindex="-1"></a>  earth<span class="op">.</span><span class="fu">append</span>(<span class="st">"path"</span>)</span>
<span id="cb5-1048"><a href="#cb5-1048" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">"d"</span><span class="op">,</span> <span class="fu">path</span>({<span class="dt">type</span><span class="op">:</span> <span class="st">"Sphere"</span>}))</span>
<span id="cb5-1049"><a href="#cb5-1049" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">"fill"</span><span class="op">,</span> colors<span class="op">.</span><span class="at">ocean</span>)</span>
<span id="cb5-1050"><a href="#cb5-1050" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">"stroke"</span><span class="op">,</span> <span class="st">"#9ecbda"</span>)<span class="op">;</span></span>
<span id="cb5-1051"><a href="#cb5-1051" aria-hidden="true" tabindex="-1"></a>  earth<span class="op">.</span><span class="fu">append</span>(<span class="st">"path"</span>)</span>
<span id="cb5-1052"><a href="#cb5-1052" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">"d"</span><span class="op">,</span> <span class="fu">path</span>(graticule))</span>
<span id="cb5-1053"><a href="#cb5-1053" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">"stroke-width"</span><span class="op">,</span> <span class="st">"1"</span>)</span>
<span id="cb5-1054"><a href="#cb5-1054" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">"fill"</span><span class="op">,</span> <span class="st">"none"</span>)</span>
<span id="cb5-1055"><a href="#cb5-1055" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">"stroke"</span><span class="op">,</span> <span class="st">"#888"</span>)<span class="op">;</span></span>
<span id="cb5-1056"><a href="#cb5-1056" aria-hidden="true" tabindex="-1"></a>  earth<span class="op">.</span><span class="fu">append</span>(<span class="st">"path"</span>)</span>
<span id="cb5-1057"><a href="#cb5-1057" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">"d"</span><span class="op">,</span> <span class="fu">path</span>(land))</span>
<span id="cb5-1058"><a href="#cb5-1058" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">"fill"</span><span class="op">,</span> colors<span class="op">.</span><span class="at">land</span>)<span class="op">;</span></span>
<span id="cb5-1059"><a href="#cb5-1059" aria-hidden="true" tabindex="-1"></a>  earth<span class="op">.</span><span class="fu">append</span>(<span class="st">"path"</span>)</span>
<span id="cb5-1060"><a href="#cb5-1060" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">"d"</span><span class="op">,</span> <span class="fu">path</span>(countries))</span>
<span id="cb5-1061"><a href="#cb5-1061" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">"stroke-width"</span><span class="op">,</span> <span class="st">"1"</span>)</span>
<span id="cb5-1062"><a href="#cb5-1062" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">"fill"</span><span class="op">,</span> <span class="st">"none"</span>)</span>
<span id="cb5-1063"><a href="#cb5-1063" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">"stroke"</span><span class="op">,</span> <span class="st">"#000"</span>)<span class="op">;</span></span>
<span id="cb5-1064"><a href="#cb5-1064" aria-hidden="true" tabindex="-1"></a>  background<span class="op">.</span><span class="fu">append</span>(<span class="st">"path"</span>)</span>
<span id="cb5-1065"><a href="#cb5-1065" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">"d"</span><span class="op">,</span> <span class="fu">unClippedPath</span>({<span class="dt">type</span><span class="op">:</span> <span class="st">"Point"</span><span class="op">,</span> <span class="dt">coordinates</span><span class="op">:</span> location}))</span>
<span id="cb5-1066"><a href="#cb5-1066" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">"fill"</span><span class="op">,</span> <span class="st">"red"</span>)<span class="op">;</span></span>
<span id="cb5-1067"><a href="#cb5-1067" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> latitudeCoords <span class="op">=</span> (latitude<span class="op">,</span> start<span class="op">,</span> end) <span class="kw">=&gt;</span> {</span>
<span id="cb5-1068"><a href="#cb5-1068" aria-hidden="true" tabindex="-1"></a>    <span class="kw">const</span> longitudes <span class="op">=</span> d3<span class="op">.</span><span class="fu">range</span>(start<span class="op">,</span> end<span class="op">,</span> <span class="dv">2</span>)<span class="op">.</span><span class="fu">concat</span>(end)<span class="op">;</span></span>
<span id="cb5-1069"><a href="#cb5-1069" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> longitudes<span class="op">.</span><span class="fu">map</span>(d <span class="kw">=&gt;</span> [d<span class="op">,</span> latitude])<span class="op">;</span></span>
<span id="cb5-1070"><a href="#cb5-1070" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb5-1071"><a href="#cb5-1071" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> correctSpin <span class="op">=</span> d3<span class="op">.</span><span class="fu">geoRotation</span>([<span class="op">-</span>hourSpin<span class="op">,</span> <span class="dv">0</span>])<span class="op">;</span></span>
<span id="cb5-1072"><a href="#cb5-1072" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> correctTilt <span class="op">=</span> d3<span class="op">.</span><span class="fu">geoRotation</span>([<span class="dv">6</span><span class="op">,</span> <span class="dv">0</span><span class="op">,</span> <span class="dv">0</span>])<span class="op">;</span></span>
<span id="cb5-1073"><a href="#cb5-1073" aria-hidden="true" tabindex="-1"></a>  <span class="co">/* total angular extent of day/night */</span></span>
<span id="cb5-1074"><a href="#cb5-1074" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> dayExtent <span class="op">=</span> <span class="dv">360</span> <span class="op">*</span> <span class="fu">dayLength</span>(date<span class="op">,</span> location[<span class="dv">1</span>]) <span class="op">/</span> <span class="dv">24</span><span class="op">;</span></span>
<span id="cb5-1075"><a href="#cb5-1075" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> nightExtent <span class="op">=</span> <span class="dv">360</span> <span class="op">-</span> dayExtent<span class="op">;</span></span>
<span id="cb5-1076"><a href="#cb5-1076" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> dayLine <span class="op">=</span> {</span>
<span id="cb5-1077"><a href="#cb5-1077" aria-hidden="true" tabindex="-1"></a>    <span class="dt">type</span><span class="op">:</span> <span class="st">"LineString"</span><span class="op">,</span></span>
<span id="cb5-1078"><a href="#cb5-1078" aria-hidden="true" tabindex="-1"></a>    <span class="dt">coordinates</span><span class="op">:</span> <span class="fu">latitudeCoords</span>(location[<span class="dv">1</span>]<span class="op">,</span></span>
<span id="cb5-1079"><a href="#cb5-1079" aria-hidden="true" tabindex="-1"></a>                                location[<span class="dv">0</span>] <span class="op">-</span> dayExtent <span class="op">/</span> <span class="dv">2</span><span class="op">,</span></span>
<span id="cb5-1080"><a href="#cb5-1080" aria-hidden="true" tabindex="-1"></a>                                location[<span class="dv">0</span>] <span class="op">+</span> dayExtent <span class="op">/</span> <span class="dv">2</span>)<span class="op">.</span><span class="fu">map</span>(d <span class="kw">=&gt;</span> <span class="fu">correctSpin</span>(d))</span>
<span id="cb5-1081"><a href="#cb5-1081" aria-hidden="true" tabindex="-1"></a>  }<span class="op">;</span></span>
<span id="cb5-1082"><a href="#cb5-1082" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> nightLine <span class="op">=</span> {</span>
<span id="cb5-1083"><a href="#cb5-1083" aria-hidden="true" tabindex="-1"></a>    <span class="dt">type</span><span class="op">:</span> <span class="st">"LineString"</span><span class="op">,</span></span>
<span id="cb5-1084"><a href="#cb5-1084" aria-hidden="true" tabindex="-1"></a>    <span class="dt">coordinates</span><span class="op">:</span> <span class="fu">latitudeCoords</span>(location[<span class="dv">1</span>]<span class="op">,</span></span>
<span id="cb5-1085"><a href="#cb5-1085" aria-hidden="true" tabindex="-1"></a>                                location[<span class="dv">0</span>] <span class="op">-</span> dayExtent <span class="op">/</span> <span class="dv">2</span> <span class="op">-</span> nightExtent<span class="op">,</span></span>
<span id="cb5-1086"><a href="#cb5-1086" aria-hidden="true" tabindex="-1"></a>                                location[<span class="dv">0</span>] <span class="op">-</span> dayExtent <span class="op">/</span> <span class="dv">2</span>)<span class="op">.</span><span class="fu">map</span>(d <span class="kw">=&gt;</span> <span class="fu">correctSpin</span>(d))</span>
<span id="cb5-1087"><a href="#cb5-1087" aria-hidden="true" tabindex="-1"></a>  }<span class="op">;</span></span>
<span id="cb5-1088"><a href="#cb5-1088" aria-hidden="true" tabindex="-1"></a>  background<span class="op">.</span><span class="fu">append</span>(<span class="st">"path"</span>)</span>
<span id="cb5-1089"><a href="#cb5-1089" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">"d"</span><span class="op">,</span> <span class="fu">unClippedPath</span>(dayLine))</span>
<span id="cb5-1090"><a href="#cb5-1090" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">"fill"</span><span class="op">,</span> <span class="st">"none"</span>)</span>
<span id="cb5-1091"><a href="#cb5-1091" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">"stroke"</span><span class="op">,</span> colors<span class="op">.</span><span class="at">day</span>)</span>
<span id="cb5-1092"><a href="#cb5-1092" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">"stroke-width"</span><span class="op">,</span> <span class="dv">3</span>)<span class="op">;</span></span>
<span id="cb5-1093"><a href="#cb5-1093" aria-hidden="true" tabindex="-1"></a>  background<span class="op">.</span><span class="fu">append</span>(<span class="st">"path"</span>)</span>
<span id="cb5-1094"><a href="#cb5-1094" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">"d"</span><span class="op">,</span> <span class="fu">unClippedPath</span>(nightLine))</span>
<span id="cb5-1095"><a href="#cb5-1095" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">"fill"</span><span class="op">,</span> <span class="st">"none"</span>)</span>
<span id="cb5-1096"><a href="#cb5-1096" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">"stroke"</span><span class="op">,</span> colors<span class="op">.</span><span class="at">night</span>)</span>
<span id="cb5-1097"><a href="#cb5-1097" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">"stroke-width"</span><span class="op">,</span> <span class="dv">3</span>)<span class="op">;</span></span>
<span id="cb5-1098"><a href="#cb5-1098" aria-hidden="true" tabindex="-1"></a>  foreground<span class="op">.</span><span class="fu">append</span>(<span class="st">"path"</span>)</span>
<span id="cb5-1099"><a href="#cb5-1099" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">"d"</span><span class="op">,</span> <span class="fu">path</span>(dayLine))</span>
<span id="cb5-1100"><a href="#cb5-1100" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">"fill"</span><span class="op">,</span> <span class="st">"none"</span>)</span>
<span id="cb5-1101"><a href="#cb5-1101" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">"stroke"</span><span class="op">,</span> colors<span class="op">.</span><span class="at">day</span>)</span>
<span id="cb5-1102"><a href="#cb5-1102" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">"stroke-width"</span><span class="op">,</span> <span class="dv">3</span>)<span class="op">;</span></span>
<span id="cb5-1103"><a href="#cb5-1103" aria-hidden="true" tabindex="-1"></a>  foreground<span class="op">.</span><span class="fu">append</span>(<span class="st">"path"</span>)</span>
<span id="cb5-1104"><a href="#cb5-1104" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">"d"</span><span class="op">,</span> <span class="fu">path</span>(nightLine))</span>
<span id="cb5-1105"><a href="#cb5-1105" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">"fill"</span><span class="op">,</span> <span class="st">"none"</span>)</span>
<span id="cb5-1106"><a href="#cb5-1106" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">"stroke"</span><span class="op">,</span> colors<span class="op">.</span><span class="at">night</span>)</span>
<span id="cb5-1107"><a href="#cb5-1107" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">"stroke-width"</span><span class="op">,</span> <span class="dv">3</span>)<span class="op">;</span></span>
<span id="cb5-1108"><a href="#cb5-1108" aria-hidden="true" tabindex="-1"></a>  foreground<span class="op">.</span><span class="fu">append</span>(<span class="st">"path"</span>)</span>
<span id="cb5-1109"><a href="#cb5-1109" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">"d"</span><span class="op">,</span> <span class="fu">path</span>({<span class="dt">type</span><span class="op">:</span> <span class="st">"Point"</span><span class="op">,</span> <span class="dt">coordinates</span><span class="op">:</span> location}))</span>
<span id="cb5-1110"><a href="#cb5-1110" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">"stroke-width"</span><span class="op">,</span> <span class="op">.</span><span class="dv">5</span>)</span>
<span id="cb5-1111"><a href="#cb5-1111" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">"stroke"</span><span class="op">,</span> <span class="st">"black"</span>)</span>
<span id="cb5-1112"><a href="#cb5-1112" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">"fill"</span><span class="op">,</span> <span class="st">"red"</span>)<span class="op">;</span></span>
<span id="cb5-1113"><a href="#cb5-1113" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> shadowPolygon <span class="op">=</span> [[<span class="dv">0</span><span class="op">,</span> <span class="op">-</span><span class="dv">90</span>]<span class="op">,</span> [<span class="dv">0</span><span class="op">,</span> <span class="dv">0</span>]<span class="op">,</span> [<span class="dv">0</span><span class="op">,</span> <span class="dv">90</span>]<span class="op">,</span> [<span class="dv">180</span><span class="op">,</span> <span class="dv">0</span>]<span class="op">,</span> [<span class="dv">0</span><span class="op">,</span> <span class="op">-</span><span class="dv">90</span>]]<span class="op">.</span><span class="fu">map</span>(d <span class="kw">=&gt;</span> <span class="fu">correctTilt</span>(d))<span class="op">;</span></span>
<span id="cb5-1114"><a href="#cb5-1114" aria-hidden="true" tabindex="-1"></a>  foreground<span class="op">.</span><span class="fu">append</span>(<span class="st">"path"</span>)</span>
<span id="cb5-1115"><a href="#cb5-1115" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">"d"</span><span class="op">,</span> <span class="fu">staticPath</span>({<span class="dt">type</span><span class="op">:</span> <span class="st">"Polygon"</span><span class="op">,</span> <span class="dt">coordinates</span><span class="op">:</span> [shadowPolygon]}))</span>
<span id="cb5-1116"><a href="#cb5-1116" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">"fill"</span><span class="op">,</span> <span class="st">"rgba(0, 0, 0, 0.25)"</span>)<span class="op">;</span></span>
<span id="cb5-1117"><a href="#cb5-1117" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb5-1118"><a href="#cb5-1118" aria-hidden="true" tabindex="-1"></a>dayOfYear <span class="op">=</span> (date) <span class="kw">=&gt;</span> {</span>
<span id="cb5-1119"><a href="#cb5-1119" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> yearStart <span class="op">=</span> <span class="kw">new</span> <span class="bu">Date</span>(date<span class="op">.</span><span class="fu">getFullYear</span>()<span class="op">,</span> <span class="dv">0</span><span class="op">,</span> <span class="dv">1</span><span class="op">+</span><span class="dv">60</span>)<span class="op">;</span></span>
<span id="cb5-1120"><a href="#cb5-1120" aria-hidden="true" tabindex="-1"></a>  <span class="cf">return</span> <span class="bu">Math</span><span class="op">.</span><span class="fu">floor</span>((date<span class="op">.</span><span class="fu">getTime</span>() <span class="op">-</span> yearStart<span class="op">.</span><span class="fu">getTime</span>())<span class="op">/</span><span class="dv">86400000</span>) <span class="op">+</span> <span class="dv">1</span></span>
<span id="cb5-1121"><a href="#cb5-1121" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb5-1122"><a href="#cb5-1122" aria-hidden="true" tabindex="-1"></a><span class="co">// https://observablehq.com/@dbridges/visualizing-seasonal-daylight</span></span>
<span id="cb5-1123"><a href="#cb5-1123" aria-hidden="true" tabindex="-1"></a>daylightPlot <span class="op">=</span> (</span>
<span id="cb5-1124"><a href="#cb5-1124" aria-hidden="true" tabindex="-1"></a>  <span class="bu">root</span><span class="op">,</span></span>
<span id="cb5-1125"><a href="#cb5-1125" aria-hidden="true" tabindex="-1"></a>  { width<span class="op">,</span> height<span class="op">,</span> year<span class="op">,</span> latitude<span class="op">,</span> defaultDate<span class="op">,</span> defaultHour }</span>
<span id="cb5-1126"><a href="#cb5-1126" aria-hidden="true" tabindex="-1"></a>) <span class="kw">=&gt;</span> {</span>
<span id="cb5-1127"><a href="#cb5-1127" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> margin <span class="op">=</span> { <span class="dt">top</span><span class="op">:</span> <span class="dv">24</span><span class="op">,</span> <span class="dt">bottom</span><span class="op">:</span> <span class="dv">32</span><span class="op">,</span> <span class="dt">left</span><span class="op">:</span> <span class="dv">48</span><span class="op">,</span> <span class="dt">right</span><span class="op">:</span> <span class="dv">0</span> }<span class="op">;</span></span>
<span id="cb5-1128"><a href="#cb5-1128" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> chartWidth <span class="op">=</span> width <span class="op">-</span> margin<span class="op">.</span><span class="at">left</span> <span class="op">-</span> margin<span class="op">.</span><span class="at">right</span><span class="op">;</span></span>
<span id="cb5-1129"><a href="#cb5-1129" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> chartHeight <span class="op">=</span> height <span class="op">-</span> margin<span class="op">.</span><span class="at">top</span> <span class="op">-</span> margin<span class="op">.</span><span class="at">bottom</span><span class="op">;</span></span>
<span id="cb5-1130"><a href="#cb5-1130" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> xTickValues <span class="op">=</span></span>
<span id="cb5-1131"><a href="#cb5-1131" aria-hidden="true" tabindex="-1"></a>    width <span class="op">&gt;</span> <span class="dv">280</span> <span class="op">?</span> [<span class="dv">3</span><span class="op">,</span> <span class="dv">6</span><span class="op">,</span> <span class="dv">9</span><span class="op">,</span> <span class="dv">12</span><span class="op">,</span> <span class="dv">15</span><span class="op">,</span> <span class="dv">18</span><span class="op">,</span> <span class="dv">21</span>] <span class="op">:</span> width <span class="op">&gt;</span> <span class="dv">140</span> <span class="op">?</span> [<span class="dv">6</span><span class="op">,</span> <span class="dv">12</span><span class="op">,</span> <span class="dv">18</span>] <span class="op">:</span> [<span class="dv">12</span>]<span class="op">;</span></span>
<span id="cb5-1132"><a href="#cb5-1132" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> xScale <span class="op">=</span> d3</span>
<span id="cb5-1133"><a href="#cb5-1133" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">scaleLinear</span>()</span>
<span id="cb5-1134"><a href="#cb5-1134" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">domain</span>([<span class="dv">0</span><span class="op">,</span> <span class="dv">24</span>])</span>
<span id="cb5-1135"><a href="#cb5-1135" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">range</span>([margin<span class="op">.</span><span class="at">left</span><span class="op">,</span> margin<span class="op">.</span><span class="at">left</span> <span class="op">+</span> chartWidth])</span>
<span id="cb5-1136"><a href="#cb5-1136" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">clamp</span>(<span class="kw">true</span>)<span class="op">;</span></span>
<span id="cb5-1137"><a href="#cb5-1137" aria-hidden="true" tabindex="-1"></a>  <span class="co">// y-axis scale</span></span>
<span id="cb5-1138"><a href="#cb5-1138" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> yScale <span class="op">=</span> d3</span>
<span id="cb5-1139"><a href="#cb5-1139" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">scaleTime</span>()</span>
<span id="cb5-1140"><a href="#cb5-1140" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">domain</span>([<span class="kw">new</span> <span class="bu">Date</span>(year<span class="op">,</span> <span class="dv">0</span><span class="op">,</span> <span class="dv">1</span><span class="op">+</span><span class="dv">60</span>)<span class="op">,</span> <span class="kw">new</span> <span class="bu">Date</span>(year<span class="op">,</span> <span class="dv">11</span><span class="op">,</span> <span class="dv">31</span><span class="op">+</span><span class="dv">60</span>)])</span>
<span id="cb5-1141"><a href="#cb5-1141" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">range</span>([margin<span class="op">.</span><span class="at">top</span><span class="op">,</span> margin<span class="op">.</span><span class="at">top</span> <span class="op">+</span> chartHeight])</span>
<span id="cb5-1142"><a href="#cb5-1142" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">clamp</span>(<span class="kw">true</span>)<span class="op">;</span></span>
<span id="cb5-1143"><a href="#cb5-1143" aria-hidden="true" tabindex="-1"></a>  <span class="co">// y-axis labels</span></span>
<span id="cb5-1144"><a href="#cb5-1144" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> yAxis <span class="op">=</span> d3</span>
<span id="cb5-1145"><a href="#cb5-1145" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">axisLeft</span>(yScale)</span>
<span id="cb5-1146"><a href="#cb5-1146" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">tickValues</span>(d3<span class="op">.</span><span class="at">timeMonth</span><span class="op">.</span><span class="fu">range</span>(<span class="kw">new</span> <span class="bu">Date</span>(year<span class="op">,</span> <span class="dv">0</span><span class="op">,</span> <span class="dv">1</span><span class="op">+</span><span class="dv">60</span>)<span class="op">,</span> <span class="kw">new</span> <span class="bu">Date</span>(year<span class="op">,</span> <span class="dv">12</span><span class="op">,</span> <span class="dv">1</span><span class="op">+</span><span class="dv">57</span>)))</span>
<span id="cb5-1147"><a href="#cb5-1147" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">tickSize</span>(chartWidth)</span>
<span id="cb5-1148"><a href="#cb5-1148" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">tickFormat</span>(date2doty1)<span class="op">;</span></span>
<span id="cb5-1149"><a href="#cb5-1149" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> xAxis <span class="op">=</span> d3</span>
<span id="cb5-1150"><a href="#cb5-1150" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">axisBottom</span>(xScale)</span>
<span id="cb5-1151"><a href="#cb5-1151" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">tickValues</span>(xTickValues)</span>
<span id="cb5-1152"><a href="#cb5-1152" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">tickSize</span>(chartHeight)</span>
<span id="cb5-1153"><a href="#cb5-1153" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">tickFormat</span>((d) <span class="kw">=&gt;</span> {</span>
<span id="cb5-1154"><a href="#cb5-1154" aria-hidden="true" tabindex="-1"></a>      <span class="cf">return</span> <span class="vs">`</span><span class="sc">${</span>d <span class="op">/</span> <span class="op">.</span><span class="bn">024</span><span class="sc">}</span><span class="vs">`</span><span class="op">;</span></span>
<span id="cb5-1155"><a href="#cb5-1155" aria-hidden="true" tabindex="-1"></a>    })<span class="op">;</span></span>
<span id="cb5-1156"><a href="#cb5-1156" aria-hidden="true" tabindex="-1"></a>  <span class="kw">let</span> date <span class="op">=</span> defaultDate <span class="op">||</span> <span class="kw">new</span> <span class="bu">Date</span>()<span class="op">;</span></span>
<span id="cb5-1157"><a href="#cb5-1157" aria-hidden="true" tabindex="-1"></a>  <span class="kw">let</span> hour <span class="op">=</span> defaultHour <span class="op">!=</span> <span class="kw">null</span> <span class="op">?</span> defaultHour <span class="op">:</span> date<span class="op">.</span><span class="fu">getHours</span>()<span class="op">;</span></span>
<span id="cb5-1158"><a href="#cb5-1158" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> handleMouseMove <span class="op">=</span> (e) <span class="kw">=&gt;</span> {}<span class="op">;</span></span>
<span id="cb5-1159"><a href="#cb5-1159" aria-hidden="true" tabindex="-1"></a>  <span class="bu">root</span></span>
<span id="cb5-1160"><a href="#cb5-1160" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">append</span>(<span class="st">"rect"</span>)</span>
<span id="cb5-1161"><a href="#cb5-1161" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">"x"</span><span class="op">,</span> margin<span class="op">.</span><span class="at">left</span>)</span>
<span id="cb5-1162"><a href="#cb5-1162" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">"y"</span><span class="op">,</span> margin<span class="op">.</span><span class="at">top</span>)</span>
<span id="cb5-1163"><a href="#cb5-1163" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">"width"</span><span class="op">,</span> chartWidth)</span>
<span id="cb5-1164"><a href="#cb5-1164" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">"height"</span><span class="op">,</span> chartHeight)</span>
<span id="cb5-1165"><a href="#cb5-1165" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">"rx"</span><span class="op">,</span> <span class="fl">0.05</span> <span class="op">*</span> width)</span>
<span id="cb5-1166"><a href="#cb5-1166" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">"fill"</span><span class="op">,</span> colors<span class="op">.</span><span class="at">night</span>)<span class="op">;</span></span>
<span id="cb5-1167"><a href="#cb5-1167" aria-hidden="true" tabindex="-1"></a>  <span class="bu">root</span></span>
<span id="cb5-1168"><a href="#cb5-1168" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">append</span>(<span class="st">"g"</span>)</span>
<span id="cb5-1169"><a href="#cb5-1169" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">"transform"</span><span class="op">,</span> <span class="vs">`translate(</span><span class="sc">${</span>margin<span class="op">.</span><span class="at">left</span> <span class="op">+</span> chartWidth<span class="sc">}</span><span class="vs">, 0)`</span>)</span>
<span id="cb5-1170"><a href="#cb5-1170" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">call</span>(yAxis)</span>
<span id="cb5-1171"><a href="#cb5-1171" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">call</span>((g) <span class="kw">=&gt;</span> g<span class="op">.</span><span class="fu">select</span>(<span class="st">".domain"</span>)<span class="op">.</span><span class="fu">remove</span>())</span>
<span id="cb5-1172"><a href="#cb5-1172" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">call</span>((g) <span class="kw">=&gt;</span> g<span class="op">.</span><span class="fu">selectAll</span>(<span class="st">".tick"</span>)<span class="op">.</span><span class="fu">attr</span>(<span class="st">"color"</span><span class="op">,</span> colors<span class="op">.</span><span class="at">grid</span>))</span>
<span id="cb5-1173"><a href="#cb5-1173" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">call</span>((g) <span class="kw">=&gt;</span> g<span class="op">.</span><span class="fu">selectAll</span>(<span class="st">".tick text"</span>)<span class="op">.</span><span class="fu">attr</span>(<span class="st">"font-size"</span><span class="op">,</span> fontSize <span class="op">*</span> (width <span class="op">&lt;</span> <span class="dv">165</span> <span class="op">?</span> <span class="op">.</span><span class="dv">7</span> <span class="op">:</span> width <span class="op">&lt;</span> <span class="dv">265</span> <span class="op">?</span> <span class="op">.</span><span class="dv">9</span> <span class="op">:</span> width <span class="op">&lt;</span> <span class="dv">365</span> <span class="op">?</span> <span class="fl">1.3</span> <span class="op">:</span> <span class="fl">1.4</span>)))</span>
<span id="cb5-1174"><a href="#cb5-1174" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">call</span>((g) <span class="kw">=&gt;</span> g<span class="op">.</span><span class="fu">selectAll</span>(<span class="st">".tick text"</span>)<span class="op">.</span><span class="fu">attr</span>(<span class="st">"color"</span><span class="op">,</span> <span class="st">"black"</span>))</span>
<span id="cb5-1175"><a href="#cb5-1175" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">call</span>((g) <span class="kw">=&gt;</span> g<span class="op">.</span><span class="fu">selectAll</span>(<span class="st">".tick line"</span>)<span class="op">.</span><span class="fu">attr</span>(<span class="st">"stroke-dasharray"</span><span class="op">,</span> <span class="st">"5 3"</span>))<span class="op">;</span></span>
<span id="cb5-1176"><a href="#cb5-1176" aria-hidden="true" tabindex="-1"></a>  <span class="bu">root</span></span>
<span id="cb5-1177"><a href="#cb5-1177" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">append</span>(<span class="st">"g"</span>)</span>
<span id="cb5-1178"><a href="#cb5-1178" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">"transform"</span><span class="op">,</span> <span class="vs">`translate(0, </span><span class="sc">${</span>margin<span class="op">.</span><span class="at">top</span><span class="sc">}</span><span class="vs">)`</span>)</span>
<span id="cb5-1179"><a href="#cb5-1179" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">call</span>(xAxis)</span>
<span id="cb5-1180"><a href="#cb5-1180" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">call</span>((g) <span class="kw">=&gt;</span> g<span class="op">.</span><span class="fu">select</span>(<span class="st">".domain"</span>)<span class="op">.</span><span class="fu">remove</span>())</span>
<span id="cb5-1181"><a href="#cb5-1181" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">call</span>((g) <span class="kw">=&gt;</span> g<span class="op">.</span><span class="fu">selectAll</span>(<span class="st">".tick"</span>)<span class="op">.</span><span class="fu">attr</span>(<span class="st">"color"</span><span class="op">,</span> colors<span class="op">.</span><span class="at">grid</span>))</span>
<span id="cb5-1182"><a href="#cb5-1182" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">call</span>((g) <span class="kw">=&gt;</span> g<span class="op">.</span><span class="fu">selectAll</span>(<span class="st">".tick text"</span>)<span class="op">.</span><span class="fu">attr</span>(<span class="st">"font-size"</span><span class="op">,</span> fontSize <span class="op">*</span> (width <span class="op">&lt;</span> <span class="dv">165</span> <span class="op">?</span> <span class="op">.</span><span class="dv">9</span> <span class="op">:</span> width <span class="op">&lt;</span> <span class="dv">265</span> <span class="op">?</span> <span class="fl">1.1</span> <span class="op">:</span> width <span class="op">&lt;</span> <span class="dv">365</span> <span class="op">?</span> <span class="fl">1.2</span> <span class="op">:</span> <span class="fl">1.3</span>)))</span>
<span id="cb5-1183"><a href="#cb5-1183" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">call</span>((g) <span class="kw">=&gt;</span> g<span class="op">.</span><span class="fu">selectAll</span>(<span class="st">".tick text"</span>)<span class="op">.</span><span class="fu">attr</span>(<span class="st">"color"</span><span class="op">,</span> <span class="st">"black"</span>))</span>
<span id="cb5-1184"><a href="#cb5-1184" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">call</span>((g) <span class="kw">=&gt;</span> g<span class="op">.</span><span class="fu">selectAll</span>(<span class="st">".tick line"</span>)<span class="op">.</span><span class="fu">attr</span>(<span class="st">"stroke-dasharray"</span><span class="op">,</span> <span class="st">"5 3"</span>))<span class="op">;</span></span>
<span id="cb5-1185"><a href="#cb5-1185" aria-hidden="true" tabindex="-1"></a>  <span class="bu">root</span></span>
<span id="cb5-1186"><a href="#cb5-1186" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">append</span>(<span class="st">"text"</span>)</span>
<span id="cb5-1187"><a href="#cb5-1187" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">text</span>(<span class="st">"Time of day (millidays)"</span>)</span>
<span id="cb5-1188"><a href="#cb5-1188" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">"x"</span><span class="op">,</span> margin<span class="op">.</span><span class="at">left</span> <span class="op">+</span> chartWidth <span class="op">/</span> <span class="dv">2</span>)</span>
<span id="cb5-1189"><a href="#cb5-1189" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">"y"</span><span class="op">,</span> margin<span class="op">.</span><span class="at">top</span> <span class="op">+</span> chartHeight <span class="op">+</span> margin<span class="op">.</span><span class="at">bottom</span> <span class="op">-</span> (width <span class="op">&lt;</span> <span class="dv">165</span> <span class="op">?</span> <span class="dv">9</span> <span class="op">:</span> width <span class="op">&lt;</span> <span class="dv">265</span> <span class="op">?</span> <span class="dv">6</span> <span class="op">:</span> width <span class="op">&lt;</span> <span class="dv">365</span> <span class="op">?</span> <span class="dv">2</span> <span class="op">:</span> <span class="dv">0</span>))</span>
<span id="cb5-1190"><a href="#cb5-1190" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">"text-anchor"</span><span class="op">,</span> <span class="st">"middle"</span>)</span>
<span id="cb5-1191"><a href="#cb5-1191" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">"font-size"</span><span class="op">,</span> fontSize <span class="op">*</span> (width <span class="op">&lt;</span> <span class="dv">165</span> <span class="op">?</span> <span class="op">.</span><span class="dv">85</span> <span class="op">:</span> width <span class="op">&lt;</span> <span class="dv">265</span> <span class="op">?</span> <span class="fl">1.15</span> <span class="op">:</span> width <span class="op">&lt;</span> <span class="dv">365</span> <span class="op">?</span> <span class="fl">1.5</span> <span class="op">:</span> <span class="fl">1.6</span>))</span>
<span id="cb5-1192"><a href="#cb5-1192" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">"font-family"</span><span class="op">,</span> <span class="st">"sans-serif"</span>)</span>
<span id="cb5-1193"><a href="#cb5-1193" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">"fill"</span><span class="op">,</span> <span class="st">"black"</span>)<span class="op">;</span></span>
<span id="cb5-1194"><a href="#cb5-1194" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> data <span class="op">=</span> <span class="fu">yearDates</span>(year)</span>
<span id="cb5-1195"><a href="#cb5-1195" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">map</span>((d) <span class="kw">=&gt;</span> [d<span class="op">,</span> <span class="fu">dayLength</span>(d<span class="op">,</span> latitude)])</span>
<span id="cb5-1196"><a href="#cb5-1196" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">filter</span>(([_<span class="op">,</span> d]) <span class="kw">=&gt;</span> d <span class="op">&gt;</span> <span class="dv">0</span>)<span class="op">;</span></span>
<span id="cb5-1197"><a href="#cb5-1197" aria-hidden="true" tabindex="-1"></a>  <span class="co">/* Render separate polygons for each continuous sequence of</span></span>
<span id="cb5-1198"><a href="#cb5-1198" aria-hidden="true" tabindex="-1"></a><span class="co">   * days with more than 0 hours of day light</span></span>
<span id="cb5-1199"><a href="#cb5-1199" aria-hidden="true" tabindex="-1"></a><span class="co">   */</span></span>
<span id="cb5-1200"><a href="#cb5-1200" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> polys <span class="op">=</span> []<span class="op">;</span></span>
<span id="cb5-1201"><a href="#cb5-1201" aria-hidden="true" tabindex="-1"></a>  <span class="kw">let</span> currentPoly <span class="op">=</span> []<span class="op">;</span></span>
<span id="cb5-1202"><a href="#cb5-1202" aria-hidden="true" tabindex="-1"></a>  <span class="cf">for</span> (<span class="kw">let</span> i <span class="op">=</span> <span class="dv">0</span><span class="op">;</span> i <span class="op">&lt;</span> data<span class="op">.</span><span class="at">length</span><span class="op">;</span> i<span class="op">++</span>) {</span>
<span id="cb5-1203"><a href="#cb5-1203" aria-hidden="true" tabindex="-1"></a>    <span class="kw">const</span> currentDate <span class="op">=</span> data[i][<span class="dv">0</span>]<span class="op">;</span></span>
<span id="cb5-1204"><a href="#cb5-1204" aria-hidden="true" tabindex="-1"></a>    <span class="kw">const</span> prevDate <span class="op">=</span> (data[i <span class="op">-</span> <span class="dv">1</span>] <span class="op">||</span> [])[<span class="dv">0</span>]<span class="op">;</span></span>
<span id="cb5-1205"><a href="#cb5-1205" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> (</span>
<span id="cb5-1206"><a href="#cb5-1206" aria-hidden="true" tabindex="-1"></a>      i <span class="op">===</span> <span class="dv">0</span> <span class="op">||</span></span>
<span id="cb5-1207"><a href="#cb5-1207" aria-hidden="true" tabindex="-1"></a>      currentDate<span class="op">.</span><span class="fu">getTime</span>() <span class="op">-</span> prevDate<span class="op">.</span><span class="fu">getTime</span>() <span class="op">&lt;</span> <span class="dv">3600</span> <span class="op">*</span> <span class="dv">24</span> <span class="op">*</span> <span class="dv">1000</span> <span class="op">*</span> <span class="fl">1.5</span></span>
<span id="cb5-1208"><a href="#cb5-1208" aria-hidden="true" tabindex="-1"></a>    ) {</span>
<span id="cb5-1209"><a href="#cb5-1209" aria-hidden="true" tabindex="-1"></a>      currentPoly<span class="op">.</span><span class="fu">push</span>(data[i])<span class="op">;</span></span>
<span id="cb5-1210"><a href="#cb5-1210" aria-hidden="true" tabindex="-1"></a>    } <span class="cf">else</span> {</span>
<span id="cb5-1211"><a href="#cb5-1211" aria-hidden="true" tabindex="-1"></a>      polys<span class="op">.</span><span class="fu">push</span>(currentPoly)<span class="op">;</span></span>
<span id="cb5-1212"><a href="#cb5-1212" aria-hidden="true" tabindex="-1"></a>      currentPoly <span class="op">=</span> [data[i]]<span class="op">;</span></span>
<span id="cb5-1213"><a href="#cb5-1213" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb5-1214"><a href="#cb5-1214" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb5-1215"><a href="#cb5-1215" aria-hidden="true" tabindex="-1"></a>  polys<span class="op">.</span><span class="fu">push</span>(currentPoly)<span class="op">;</span></span>
<span id="cb5-1216"><a href="#cb5-1216" aria-hidden="true" tabindex="-1"></a>  polys<span class="op">.</span><span class="fu">forEach</span>((p) <span class="kw">=&gt;</span> {</span>
<span id="cb5-1217"><a href="#cb5-1217" aria-hidden="true" tabindex="-1"></a>    <span class="kw">const</span> points <span class="op">=</span> [</span>
<span id="cb5-1218"><a href="#cb5-1218" aria-hidden="true" tabindex="-1"></a>      <span class="op">...</span>p<span class="op">.</span><span class="fu">map</span>(([d<span class="op">,</span> l]) <span class="kw">=&gt;</span> <span class="vs">`</span><span class="sc">${</span><span class="fu">xScale</span>(<span class="dv">12</span> <span class="op">-</span> l <span class="op">/</span> <span class="dv">2</span>)<span class="sc">}</span><span class="vs">,</span><span class="sc">${</span><span class="fu">yScale</span>(d)<span class="sc">}</span><span class="vs">`</span>)<span class="op">,</span></span>
<span id="cb5-1219"><a href="#cb5-1219" aria-hidden="true" tabindex="-1"></a>      <span class="op">...</span>p<span class="op">.</span><span class="fu">reverse</span>()<span class="op">.</span><span class="fu">map</span>(([d<span class="op">,</span> l]) <span class="kw">=&gt;</span> <span class="vs">`</span><span class="sc">${</span><span class="fu">xScale</span>(<span class="dv">12</span> <span class="op">+</span> l <span class="op">/</span> <span class="dv">2</span>)<span class="sc">}</span><span class="vs">,</span><span class="sc">${</span><span class="fu">yScale</span>(d)<span class="sc">}</span><span class="vs">`</span>)</span>
<span id="cb5-1220"><a href="#cb5-1220" aria-hidden="true" tabindex="-1"></a>    ]<span class="op">.</span><span class="fu">join</span>(<span class="st">" "</span>)<span class="op">;</span></span>
<span id="cb5-1221"><a href="#cb5-1221" aria-hidden="true" tabindex="-1"></a>    <span class="bu">root</span><span class="op">.</span><span class="fu">append</span>(<span class="st">"polygon"</span>)<span class="op">.</span><span class="fu">attr</span>(<span class="st">"points"</span><span class="op">,</span> points)<span class="op">.</span><span class="fu">attr</span>(<span class="st">"fill"</span><span class="op">,</span> colors<span class="op">.</span><span class="at">day</span>)<span class="op">;</span></span>
<span id="cb5-1222"><a href="#cb5-1222" aria-hidden="true" tabindex="-1"></a>  })<span class="op">;</span></span>
<span id="cb5-1223"><a href="#cb5-1223" aria-hidden="true" tabindex="-1"></a>  <span class="co">/* Legend */</span></span>
<span id="cb5-1224"><a href="#cb5-1224" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> legend <span class="op">=</span> <span class="bu">root</span></span>
<span id="cb5-1225"><a href="#cb5-1225" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">append</span>(<span class="st">"g"</span>)</span>
<span id="cb5-1226"><a href="#cb5-1226" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">"transform"</span><span class="op">,</span> <span class="vs">`translate(</span><span class="sc">${</span>margin<span class="op">.</span><span class="at">left</span> <span class="op">+</span> chartWidth <span class="op">/</span> <span class="dv">2</span> <span class="op">-</span> <span class="dv">64</span><span class="sc">}</span><span class="vs">)`</span>)<span class="op">;</span></span>
<span id="cb5-1227"><a href="#cb5-1227" aria-hidden="true" tabindex="-1"></a>  legend</span>
<span id="cb5-1228"><a href="#cb5-1228" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">append</span>(<span class="st">"rect"</span>)</span>
<span id="cb5-1229"><a href="#cb5-1229" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">"rx"</span><span class="op">,</span> <span class="dv">5</span>)</span>
<span id="cb5-1230"><a href="#cb5-1230" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">"x"</span><span class="op">,</span> <span class="op">-</span><span class="dv">34</span> <span class="op">+</span> <span class="dv">4</span> <span class="op">*</span> (width <span class="op">&lt;</span> <span class="dv">165</span> <span class="op">?</span> <span class="fl">12.7</span> <span class="op">:</span> width <span class="op">&lt;</span> <span class="dv">265</span> <span class="op">?</span> <span class="fl">5.5</span> <span class="op">:</span> width <span class="op">&lt;</span> <span class="dv">365</span> <span class="op">?</span> <span class="dv">3</span> <span class="op">:</span> <span class="dv">0</span>))</span>
<span id="cb5-1231"><a href="#cb5-1231" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">"y"</span><span class="op">,</span> <span class="fl">4.5</span> <span class="op">*</span> (width <span class="op">&lt;</span> <span class="dv">165</span> <span class="op">?</span> <span class="fl">1.9</span> <span class="op">:</span> width <span class="op">&lt;</span> <span class="dv">265</span> <span class="op">?</span> <span class="fl">1.4</span> <span class="op">:</span> width <span class="op">&lt;</span> <span class="dv">365</span> <span class="op">?</span> <span class="op">.</span><span class="dv">9</span> <span class="op">:</span> <span class="op">.</span><span class="dv">8</span>))</span>
<span id="cb5-1232"><a href="#cb5-1232" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">"width"</span><span class="op">,</span> fontSize <span class="op">*</span> (width <span class="op">&lt;</span> <span class="dv">165</span> <span class="op">?</span> <span class="dv">1</span> <span class="op">:</span> width <span class="op">&lt;</span> <span class="dv">265</span> <span class="op">?</span> <span class="fl">1.2</span> <span class="op">:</span> width <span class="op">&lt;</span> <span class="dv">365</span> <span class="op">?</span> <span class="fl">1.4</span> <span class="op">:</span> <span class="fl">1.6</span>))</span>
<span id="cb5-1233"><a href="#cb5-1233" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">"height"</span><span class="op">,</span> fontSize <span class="op">*</span> (width <span class="op">&lt;</span> <span class="dv">165</span> <span class="op">?</span> <span class="dv">1</span> <span class="op">:</span> width <span class="op">&lt;</span> <span class="dv">265</span> <span class="op">?</span> <span class="fl">1.2</span> <span class="op">:</span> width <span class="op">&lt;</span> <span class="dv">365</span> <span class="op">?</span> <span class="fl">1.4</span> <span class="op">:</span> <span class="fl">1.6</span>))</span>
<span id="cb5-1234"><a href="#cb5-1234" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">"fill"</span><span class="op">,</span> colors<span class="op">.</span><span class="at">night</span>)<span class="op">;</span></span>
<span id="cb5-1235"><a href="#cb5-1235" aria-hidden="true" tabindex="-1"></a>  legend</span>
<span id="cb5-1236"><a href="#cb5-1236" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">append</span>(<span class="st">"text"</span>)</span>
<span id="cb5-1237"><a href="#cb5-1237" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">"x"</span><span class="op">,</span> <span class="op">-</span><span class="dv">16</span> <span class="op">+</span> <span class="dv">4</span> <span class="op">*</span> (width <span class="op">&lt;</span> <span class="dv">165</span> <span class="op">?</span> <span class="fl">11.8</span> <span class="op">:</span> width <span class="op">&lt;</span> <span class="dv">265</span> <span class="op">?</span> <span class="fl">4.9</span> <span class="op">:</span> width <span class="op">&lt;</span> <span class="dv">365</span> <span class="op">?</span> <span class="fl">2.8</span> <span class="op">:</span> <span class="dv">0</span>))</span>
<span id="cb5-1238"><a href="#cb5-1238" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">"y"</span><span class="op">,</span> <span class="dv">19</span>)</span>
<span id="cb5-1239"><a href="#cb5-1239" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">"font-size"</span><span class="op">,</span> fontSize <span class="op">*</span> (width <span class="op">&lt;</span> <span class="dv">165</span> <span class="op">?</span> <span class="dv">1</span> <span class="op">:</span> width <span class="op">&lt;</span> <span class="dv">265</span> <span class="op">?</span> <span class="fl">1.2</span> <span class="op">:</span> width <span class="op">&lt;</span> <span class="dv">365</span> <span class="op">?</span> <span class="fl">1.4</span> <span class="op">:</span> <span class="fl">1.6</span>))</span>
<span id="cb5-1240"><a href="#cb5-1240" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">"font-family"</span><span class="op">,</span> <span class="st">"sans-serif"</span>)</span>
<span id="cb5-1241"><a href="#cb5-1241" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">text</span>(<span class="st">"Night"</span>)<span class="op">;</span></span>
<span id="cb5-1242"><a href="#cb5-1242" aria-hidden="true" tabindex="-1"></a>  legend</span>
<span id="cb5-1243"><a href="#cb5-1243" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">append</span>(<span class="st">"rect"</span>)</span>
<span id="cb5-1244"><a href="#cb5-1244" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">"x"</span><span class="op">,</span> <span class="dv">34</span> <span class="op">+</span> <span class="dv">4</span> <span class="op">*</span> (width <span class="op">&lt;</span> <span class="dv">165</span> <span class="op">?</span> <span class="fl">7.8</span> <span class="op">:</span> width <span class="op">&lt;</span> <span class="dv">265</span> <span class="op">?</span> <span class="fl">8.2</span> <span class="op">:</span> width <span class="op">&lt;</span> <span class="dv">365</span> <span class="op">?</span> <span class="fl">6.9</span> <span class="op">:</span> <span class="fl">4.2</span>))</span>
<span id="cb5-1245"><a href="#cb5-1245" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">"rx"</span><span class="op">,</span> <span class="dv">5</span>)</span>
<span id="cb5-1246"><a href="#cb5-1246" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">"y"</span><span class="op">,</span> <span class="fl">4.5</span> <span class="op">*</span> (width <span class="op">&lt;</span> <span class="dv">165</span> <span class="op">?</span> <span class="fl">1.9</span> <span class="op">:</span> width <span class="op">&lt;</span> <span class="dv">265</span> <span class="op">?</span> <span class="fl">1.4</span> <span class="op">:</span> width <span class="op">&lt;</span> <span class="dv">365</span> <span class="op">?</span> <span class="op">.</span><span class="dv">9</span> <span class="op">:</span> <span class="op">.</span><span class="dv">8</span>))</span>
<span id="cb5-1247"><a href="#cb5-1247" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">"width"</span><span class="op">,</span> fontSize <span class="op">*</span> (width <span class="op">&lt;</span> <span class="dv">165</span> <span class="op">?</span> <span class="dv">1</span> <span class="op">:</span> width <span class="op">&lt;</span> <span class="dv">265</span> <span class="op">?</span> <span class="fl">1.2</span> <span class="op">:</span> width <span class="op">&lt;</span> <span class="dv">365</span> <span class="op">?</span> <span class="fl">1.4</span> <span class="op">:</span> <span class="fl">1.6</span>))</span>
<span id="cb5-1248"><a href="#cb5-1248" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">"height"</span><span class="op">,</span> fontSize <span class="op">*</span> (width <span class="op">&lt;</span> <span class="dv">165</span> <span class="op">?</span> <span class="dv">1</span> <span class="op">:</span> width <span class="op">&lt;</span> <span class="dv">265</span> <span class="op">?</span> <span class="fl">1.2</span> <span class="op">:</span> width <span class="op">&lt;</span> <span class="dv">365</span> <span class="op">?</span> <span class="fl">1.4</span> <span class="op">:</span> <span class="fl">1.6</span>))</span>
<span id="cb5-1249"><a href="#cb5-1249" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">"fill"</span><span class="op">,</span> colors<span class="op">.</span><span class="at">day</span>)<span class="op">;</span></span>
<span id="cb5-1250"><a href="#cb5-1250" aria-hidden="true" tabindex="-1"></a>  legend</span>
<span id="cb5-1251"><a href="#cb5-1251" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">append</span>(<span class="st">"text"</span>)</span>
<span id="cb5-1252"><a href="#cb5-1252" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">"x"</span><span class="op">,</span> <span class="dv">52</span> <span class="op">+</span> <span class="dv">4</span> <span class="op">*</span> (width <span class="op">&lt;</span> <span class="dv">165</span> <span class="op">?</span> <span class="fl">6.8</span> <span class="op">:</span> width <span class="op">&lt;</span> <span class="dv">265</span> <span class="op">?</span> <span class="fl">7.8</span> <span class="op">:</span> width <span class="op">&lt;</span> <span class="dv">365</span> <span class="op">?</span> <span class="fl">6.9</span> <span class="op">:</span> <span class="fl">4.2</span>))</span>
<span id="cb5-1253"><a href="#cb5-1253" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">"y"</span><span class="op">,</span> <span class="dv">19</span>)</span>
<span id="cb5-1254"><a href="#cb5-1254" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">"font-size"</span><span class="op">,</span> fontSize <span class="op">*</span> (width <span class="op">&lt;</span> <span class="dv">165</span> <span class="op">?</span> <span class="dv">1</span> <span class="op">:</span> width <span class="op">&lt;</span> <span class="dv">265</span> <span class="op">?</span> <span class="fl">1.2</span> <span class="op">:</span> width <span class="op">&lt;</span> <span class="dv">365</span> <span class="op">?</span> <span class="fl">1.4</span> <span class="op">:</span> <span class="fl">1.6</span>))</span>
<span id="cb5-1255"><a href="#cb5-1255" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">"font-family"</span><span class="op">,</span> <span class="st">"sans-serif"</span>)</span>
<span id="cb5-1256"><a href="#cb5-1256" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">text</span>(<span class="st">"Day"</span>)<span class="op">;</span></span>
<span id="cb5-1257"><a href="#cb5-1257" aria-hidden="true" tabindex="-1"></a>  <span class="co">/* Time and date controls */</span></span>
<span id="cb5-1258"><a href="#cb5-1258" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> dateLine <span class="op">=</span> <span class="bu">root</span><span class="op">.</span><span class="fu">append</span>(<span class="st">"g"</span>)<span class="op">;</span></span>
<span id="cb5-1259"><a href="#cb5-1259" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> updateControlPositions <span class="op">=</span> () <span class="kw">=&gt;</span> {</span>
<span id="cb5-1260"><a href="#cb5-1260" aria-hidden="true" tabindex="-1"></a>    dateLine</span>
<span id="cb5-1261"><a href="#cb5-1261" aria-hidden="true" tabindex="-1"></a>      <span class="op">.</span><span class="fu">select</span>(<span class="st">"line"</span>)</span>
<span id="cb5-1262"><a href="#cb5-1262" aria-hidden="true" tabindex="-1"></a>      <span class="op">.</span><span class="fu">attr</span>(<span class="st">"id"</span><span class="op">,</span> <span class="st">"dateline"</span>)</span>
<span id="cb5-1263"><a href="#cb5-1263" aria-hidden="true" tabindex="-1"></a>      <span class="op">.</span><span class="fu">attr</span>(<span class="st">"x1"</span><span class="op">,</span> <span class="fu">xScale</span>(<span class="dv">0</span>))</span>
<span id="cb5-1264"><a href="#cb5-1264" aria-hidden="true" tabindex="-1"></a>      <span class="op">.</span><span class="fu">attr</span>(<span class="st">"y1"</span><span class="op">,</span> <span class="fu">yScale</span>(date))</span>
<span id="cb5-1265"><a href="#cb5-1265" aria-hidden="true" tabindex="-1"></a>      <span class="op">.</span><span class="fu">attr</span>(<span class="st">"x2"</span><span class="op">,</span> <span class="fu">xScale</span>(<span class="dv">24</span>))</span>
<span id="cb5-1266"><a href="#cb5-1266" aria-hidden="true" tabindex="-1"></a>      <span class="op">.</span><span class="fu">attr</span>(<span class="st">"y2"</span><span class="op">,</span> <span class="fu">yScale</span>(date))<span class="op">;</span></span>
<span id="cb5-1267"><a href="#cb5-1267" aria-hidden="true" tabindex="-1"></a>    dateLine</span>
<span id="cb5-1268"><a href="#cb5-1268" aria-hidden="true" tabindex="-1"></a>      <span class="op">.</span><span class="fu">select</span>(<span class="st">"rect"</span>)</span>
<span id="cb5-1269"><a href="#cb5-1269" aria-hidden="true" tabindex="-1"></a>      <span class="op">.</span><span class="fu">attr</span>(<span class="st">"id"</span><span class="op">,</span> <span class="st">"daterect"</span>)</span>
<span id="cb5-1270"><a href="#cb5-1270" aria-hidden="true" tabindex="-1"></a>      <span class="op">.</span><span class="fu">attr</span>(<span class="st">"x"</span><span class="op">,</span> <span class="fu">xScale</span>(<span class="dv">0</span>))</span>
<span id="cb5-1271"><a href="#cb5-1271" aria-hidden="true" tabindex="-1"></a>      <span class="op">.</span><span class="fu">attr</span>(<span class="st">"y"</span><span class="op">,</span> <span class="fu">yScale</span>(date) <span class="op">-</span> <span class="dv">4</span>)<span class="op">;</span></span>
<span id="cb5-1272"><a href="#cb5-1272" aria-hidden="true" tabindex="-1"></a>    <span class="bu">root</span></span>
<span id="cb5-1273"><a href="#cb5-1273" aria-hidden="true" tabindex="-1"></a>      <span class="op">.</span><span class="fu">select</span>(<span class="st">"#time-control"</span>)</span>
<span id="cb5-1274"><a href="#cb5-1274" aria-hidden="true" tabindex="-1"></a>      <span class="op">.</span><span class="fu">attr</span>(<span class="st">"cx"</span><span class="op">,</span> <span class="fu">xScale</span>(hour))</span>
<span id="cb5-1275"><a href="#cb5-1275" aria-hidden="true" tabindex="-1"></a>      <span class="op">.</span><span class="fu">attr</span>(<span class="st">"cy"</span><span class="op">,</span> <span class="fu">yScale</span>(date))<span class="op">;</span></span>
<span id="cb5-1276"><a href="#cb5-1276" aria-hidden="true" tabindex="-1"></a>  }<span class="op">;</span></span>
<span id="cb5-1277"><a href="#cb5-1277" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> dispatchDateHourChange <span class="op">=</span> () <span class="kw">=&gt;</span> {</span>
<span id="cb5-1278"><a href="#cb5-1278" aria-hidden="true" tabindex="-1"></a>    <span class="kw">const</span> detail <span class="op">=</span> { date<span class="op">,</span> hour }<span class="op">;</span></span>
<span id="cb5-1279"><a href="#cb5-1279" aria-hidden="true" tabindex="-1"></a>    <span class="kw">const</span> changeEvent <span class="op">=</span> <span class="kw">new</span> <span class="bu">CustomEvent</span>(EventType<span class="op">.</span><span class="at">DateHourChange</span><span class="op">,</span> {</span>
<span id="cb5-1280"><a href="#cb5-1280" aria-hidden="true" tabindex="-1"></a>      detail<span class="op">,</span></span>
<span id="cb5-1281"><a href="#cb5-1281" aria-hidden="true" tabindex="-1"></a>      <span class="dt">bubbles</span><span class="op">:</span> <span class="kw">true</span></span>
<span id="cb5-1282"><a href="#cb5-1282" aria-hidden="true" tabindex="-1"></a>    })<span class="op">;</span></span>
<span id="cb5-1283"><a href="#cb5-1283" aria-hidden="true" tabindex="-1"></a>    <span class="bu">root</span><span class="op">.</span><span class="fu">node</span>()<span class="op">.</span><span class="fu">dispatchEvent</span>(changeEvent)<span class="op">;</span></span>
<span id="cb5-1284"><a href="#cb5-1284" aria-hidden="true" tabindex="-1"></a>  }<span class="op">;</span></span>
<span id="cb5-1285"><a href="#cb5-1285" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> handleDateLineDrag <span class="op">=</span> ({ y }) <span class="kw">=&gt;</span> {</span>
<span id="cb5-1286"><a href="#cb5-1286" aria-hidden="true" tabindex="-1"></a>    date <span class="op">=</span> yScale<span class="op">.</span><span class="fu">invert</span>(y)<span class="op">;</span></span>
<span id="cb5-1287"><a href="#cb5-1287" aria-hidden="true" tabindex="-1"></a>    <span class="fu">updateControlPositions</span>()<span class="op">;</span></span>
<span id="cb5-1288"><a href="#cb5-1288" aria-hidden="true" tabindex="-1"></a>    <span class="fu">dispatchDateHourChange</span>()<span class="op">;</span></span>
<span id="cb5-1289"><a href="#cb5-1289" aria-hidden="true" tabindex="-1"></a>  }<span class="op">;</span></span>
<span id="cb5-1290"><a href="#cb5-1290" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> handleTimeCircleDrag <span class="op">=</span> ({ x }) <span class="kw">=&gt;</span> {</span>
<span id="cb5-1291"><a href="#cb5-1291" aria-hidden="true" tabindex="-1"></a>    hour <span class="op">=</span> xScale<span class="op">.</span><span class="fu">invert</span>(x)<span class="op">;</span></span>
<span id="cb5-1292"><a href="#cb5-1292" aria-hidden="true" tabindex="-1"></a>    <span class="fu">updateControlPositions</span>()<span class="op">;</span></span>
<span id="cb5-1293"><a href="#cb5-1293" aria-hidden="true" tabindex="-1"></a>    <span class="fu">dispatchDateHourChange</span>()<span class="op">;</span></span>
<span id="cb5-1294"><a href="#cb5-1294" aria-hidden="true" tabindex="-1"></a>  }<span class="op">;</span></span>
<span id="cb5-1295"><a href="#cb5-1295" aria-hidden="true" tabindex="-1"></a>  dateLine<span class="op">.</span><span class="fu">append</span>(<span class="st">"line"</span>)<span class="op">.</span><span class="fu">attr</span>(<span class="st">"stroke-width"</span><span class="op">,</span> <span class="dv">4</span>)<span class="op">.</span><span class="fu">attr</span>(<span class="st">"stroke"</span><span class="op">,</span> <span class="st">"red"</span>)<span class="op">;</span></span>
<span id="cb5-1296"><a href="#cb5-1296" aria-hidden="true" tabindex="-1"></a>  dateLine</span>
<span id="cb5-1297"><a href="#cb5-1297" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">append</span>(<span class="st">"rect"</span>)</span>
<span id="cb5-1298"><a href="#cb5-1298" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">"width"</span><span class="op">,</span> chartWidth)</span>
<span id="cb5-1299"><a href="#cb5-1299" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">"height"</span><span class="op">,</span> <span class="dv">8</span>)</span>
<span id="cb5-1300"><a href="#cb5-1300" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">"fill"</span><span class="op">,</span> <span class="st">"rgba(0, 0, 0, 0)"</span>)</span>
<span id="cb5-1301"><a href="#cb5-1301" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">style</span>(<span class="st">"cursor"</span><span class="op">,</span> <span class="st">"row-resize"</span>)</span>
<span id="cb5-1302"><a href="#cb5-1302" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">call</span>(d3<span class="op">.</span><span class="fu">drag</span>()<span class="op">.</span><span class="fu">on</span>(<span class="st">"drag"</span><span class="op">,</span> handleDateLineDrag))<span class="op">;</span></span>
<span id="cb5-1303"><a href="#cb5-1303" aria-hidden="true" tabindex="-1"></a>  <span class="bu">root</span></span>
<span id="cb5-1304"><a href="#cb5-1304" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">append</span>(<span class="st">"circle"</span>)</span>
<span id="cb5-1305"><a href="#cb5-1305" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">"id"</span><span class="op">,</span> <span class="st">"time-control"</span>)</span>
<span id="cb5-1306"><a href="#cb5-1306" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">"r"</span><span class="op">,</span> <span class="dv">12</span>)</span>
<span id="cb5-1307"><a href="#cb5-1307" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">"fill"</span><span class="op">,</span> <span class="st">"red"</span>)</span>
<span id="cb5-1308"><a href="#cb5-1308" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">"stroke-width"</span><span class="op">,</span> <span class="op">.</span><span class="dv">6</span>)</span>
<span id="cb5-1309"><a href="#cb5-1309" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">"stroke"</span><span class="op">,</span> <span class="st">"black"</span>)</span>
<span id="cb5-1310"><a href="#cb5-1310" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">style</span>(<span class="st">"cursor"</span><span class="op">,</span> <span class="st">"pointer"</span>)</span>
<span id="cb5-1311"><a href="#cb5-1311" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">call</span>(d3<span class="op">.</span><span class="fu">drag</span>()<span class="op">.</span><span class="fu">on</span>(<span class="st">"drag"</span><span class="op">,</span> handleTimeCircleDrag))<span class="op">;</span></span>
<span id="cb5-1312"><a href="#cb5-1312" aria-hidden="true" tabindex="-1"></a>  <span class="fu">updateControlPositions</span>()<span class="op">;</span></span>
<span id="cb5-1313"><a href="#cb5-1313" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb5-1314"><a href="#cb5-1314" aria-hidden="true" tabindex="-1"></a>fontSize <span class="op">=</span> <span class="dv">12</span><span class="op">;</span></span>
<span id="cb5-1315"><a href="#cb5-1315" aria-hidden="true" tabindex="-1"></a>getSolarAngle <span class="op">=</span> (date) <span class="kw">=&gt;</span> (<span class="fu">dayOfYear</span>(date) <span class="op">+</span> <span class="dv">10</span>) <span class="op">/</span> <span class="dv">365</span> <span class="op">*</span> <span class="bu">Math</span><span class="op">.</span><span class="cn">PI</span> <span class="op">*</span> <span class="dv">2</span> <span class="op">-</span> <span class="bu">Math</span><span class="op">.</span><span class="cn">PI</span> <span class="op">/</span> <span class="dv">2</span><span class="op">;</span></span>
<span id="cb5-1316"><a href="#cb5-1316" aria-hidden="true" tabindex="-1"></a><span class="co">/*</span></span>
<span id="cb5-1317"><a href="#cb5-1317" aria-hidden="true" tabindex="-1"></a><span class="co"> * Formulas uses the CBM model as reviewed here:</span></span>
<span id="cb5-1318"><a href="#cb5-1318" aria-hidden="true" tabindex="-1"></a><span class="co"> * https://www.ikhebeenvraag.be/mediastorage/FSDocument/171/Forsythe+-+A+model+comparison+for+daylength+as+a+function+of+latitude+and+day+of+year+-+1995.pdf</span></span>
<span id="cb5-1319"><a href="#cb5-1319" aria-hidden="true" tabindex="-1"></a><span class="co"> */</span></span>
<span id="cb5-1320"><a href="#cb5-1320" aria-hidden="true" tabindex="-1"></a>dayLength <span class="op">=</span> (date<span class="op">,</span> latitude) <span class="kw">=&gt;</span> {</span>
<span id="cb5-1321"><a href="#cb5-1321" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> yearStart <span class="op">=</span> <span class="kw">new</span> <span class="bu">Date</span>(date<span class="op">.</span><span class="fu">getFullYear</span>()<span class="op">,</span> <span class="dv">0</span><span class="op">,</span> <span class="dv">1</span>)<span class="op">;</span></span>
<span id="cb5-1322"><a href="#cb5-1322" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> dayOfYear <span class="op">=</span> <span class="bu">Math</span><span class="op">.</span><span class="fu">floor</span>((date<span class="op">.</span><span class="fu">getTime</span>() <span class="op">-</span> yearStart<span class="op">.</span><span class="fu">getTime</span>())<span class="op">/</span><span class="dv">86400000</span>) <span class="op">+</span> <span class="dv">1</span><span class="op">;</span></span>
<span id="cb5-1323"><a href="#cb5-1323" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> revAngle <span class="op">=</span> <span class="fl">0.2163108</span> <span class="op">+</span> <span class="dv">2</span> <span class="op">*</span> <span class="bu">Math</span><span class="op">.</span><span class="fu">atan</span>(<span class="fl">0.9671396</span> <span class="op">*</span> <span class="bu">Math</span><span class="op">.</span><span class="fu">tan</span>(<span class="fl">0.00860</span> <span class="op">*</span> (dayOfYear <span class="op">-</span> <span class="dv">186</span>)))<span class="op">;</span></span>
<span id="cb5-1324"><a href="#cb5-1324" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> decAngle <span class="op">=</span> <span class="bu">Math</span><span class="op">.</span><span class="fu">asin</span>(<span class="fl">0.39795</span> <span class="op">*</span> <span class="bu">Math</span><span class="op">.</span><span class="fu">cos</span>(revAngle))<span class="op">;</span></span>
<span id="cb5-1325"><a href="#cb5-1325" aria-hidden="true" tabindex="-1"></a>  <span class="co">/* daylight coefficient selected for apparent sunrise/sunset */</span></span>
<span id="cb5-1326"><a href="#cb5-1326" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> p <span class="op">=</span> <span class="fl">0.8333</span></span>
<span id="cb5-1327"><a href="#cb5-1327" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> intResult <span class="op">=</span></span>
<span id="cb5-1328"><a href="#cb5-1328" aria-hidden="true" tabindex="-1"></a>    (<span class="bu">Math</span><span class="op">.</span><span class="fu">sin</span>((p <span class="op">*</span> <span class="bu">Math</span><span class="op">.</span><span class="cn">PI</span>) <span class="op">/</span> <span class="dv">180</span>) <span class="op">+</span></span>
<span id="cb5-1329"><a href="#cb5-1329" aria-hidden="true" tabindex="-1"></a>      <span class="bu">Math</span><span class="op">.</span><span class="fu">sin</span>((latitude <span class="op">*</span> <span class="bu">Math</span><span class="op">.</span><span class="cn">PI</span>) <span class="op">/</span> <span class="dv">180</span>) <span class="op">*</span> <span class="bu">Math</span><span class="op">.</span><span class="fu">sin</span>(decAngle)) <span class="op">/</span></span>
<span id="cb5-1330"><a href="#cb5-1330" aria-hidden="true" tabindex="-1"></a>    (<span class="bu">Math</span><span class="op">.</span><span class="fu">cos</span>((latitude <span class="op">*</span> <span class="bu">Math</span><span class="op">.</span><span class="cn">PI</span>) <span class="op">/</span> <span class="dv">180</span>) <span class="op">*</span> <span class="bu">Math</span><span class="op">.</span><span class="fu">cos</span>(decAngle))<span class="op">;</span></span>
<span id="cb5-1331"><a href="#cb5-1331" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (intResult <span class="op">&gt;=</span> <span class="dv">1</span>) <span class="cf">return</span> <span class="dv">24</span><span class="op">;</span></span>
<span id="cb5-1332"><a href="#cb5-1332" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (intResult <span class="op">&lt;=</span> <span class="op">-</span><span class="dv">1</span>) <span class="cf">return</span> <span class="dv">0</span><span class="op">;</span></span>
<span id="cb5-1333"><a href="#cb5-1333" aria-hidden="true" tabindex="-1"></a>  <span class="cf">return</span> <span class="dv">24</span> <span class="op">-</span> <span class="dv">24</span> <span class="op">*</span> <span class="bu">Math</span><span class="op">.</span><span class="fu">acos</span>(intResult) <span class="op">/</span> <span class="bu">Math</span><span class="op">.</span><span class="cn">PI</span><span class="op">;</span></span>
<span id="cb5-1334"><a href="#cb5-1334" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb5-1335"><a href="#cb5-1335" aria-hidden="true" tabindex="-1"></a>yearDates <span class="op">=</span> (year) <span class="kw">=&gt;</span> {</span>
<span id="cb5-1336"><a href="#cb5-1336" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> startDate <span class="op">=</span> <span class="kw">new</span> <span class="bu">Date</span>(year<span class="op">,</span> <span class="dv">0</span><span class="op">,</span> <span class="dv">1</span><span class="op">+</span><span class="dv">60</span>)<span class="op">;</span></span>
<span id="cb5-1337"><a href="#cb5-1337" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> endDate <span class="op">=</span> <span class="kw">new</span> <span class="bu">Date</span>(year <span class="op">+</span> <span class="dv">1</span><span class="op">,</span> <span class="dv">0</span><span class="op">,</span> <span class="dv">1</span><span class="op">+</span><span class="dv">60</span>)<span class="op">;</span></span>
<span id="cb5-1338"><a href="#cb5-1338" aria-hidden="true" tabindex="-1"></a>  <span class="cf">return</span> d3<span class="op">.</span><span class="at">timeDay</span><span class="op">.</span><span class="fu">range</span>(startDate<span class="op">,</span> endDate)<span class="op">;</span></span>
<span id="cb5-1339"><a href="#cb5-1339" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb5-1340"><a href="#cb5-1340" aria-hidden="true" tabindex="-1"></a>height <span class="op">=</span> <span class="fl">0.65</span> <span class="op">*</span> width<span class="op">;</span></span>
<span id="cb5-1341"><a href="#cb5-1341" aria-hidden="true" tabindex="-1"></a>EventType <span class="op">=</span> ({</span>
<span id="cb5-1342"><a href="#cb5-1342" aria-hidden="true" tabindex="-1"></a>  <span class="dt">LocationChange</span><span class="op">:</span> <span class="st">"LOCATION_CHANGE"</span><span class="op">,</span></span>
<span id="cb5-1343"><a href="#cb5-1343" aria-hidden="true" tabindex="-1"></a>  <span class="dt">DateHourChange</span><span class="op">:</span> <span class="st">"DATE_HOUR_CHANGE"</span></span>
<span id="cb5-1344"><a href="#cb5-1344" aria-hidden="true" tabindex="-1"></a>})</span>
<span id="cb5-1345"><a href="#cb5-1345" aria-hidden="true" tabindex="-1"></a>colors <span class="op">=</span> ({</span>
<span id="cb5-1346"><a href="#cb5-1346" aria-hidden="true" tabindex="-1"></a>  <span class="dt">night</span><span class="op">:</span> <span class="st">"#719fb6"</span><span class="op">,</span></span>
<span id="cb5-1347"><a href="#cb5-1347" aria-hidden="true" tabindex="-1"></a>  <span class="dt">day</span><span class="op">:</span> <span class="st">"#ffe438"</span><span class="op">,</span></span>
<span id="cb5-1348"><a href="#cb5-1348" aria-hidden="true" tabindex="-1"></a>  <span class="dt">grid</span><span class="op">:</span> <span class="st">"#4b6a79"</span><span class="op">,</span></span>
<span id="cb5-1349"><a href="#cb5-1349" aria-hidden="true" tabindex="-1"></a>  <span class="dt">ocean</span><span class="op">:</span> <span class="st">"#adeeff"</span><span class="op">,</span></span>
<span id="cb5-1350"><a href="#cb5-1350" aria-hidden="true" tabindex="-1"></a>  <span class="dt">land</span><span class="op">:</span> <span class="st">"#f5f1dc"</span><span class="op">,</span></span>
<span id="cb5-1351"><a href="#cb5-1351" aria-hidden="true" tabindex="-1"></a>  <span class="dt">sun</span><span class="op">:</span> <span class="st">"#ffe438"</span></span>
<span id="cb5-1352"><a href="#cb5-1352" aria-hidden="true" tabindex="-1"></a>})</span>
<span id="cb5-1353"><a href="#cb5-1353" aria-hidden="true" tabindex="-1"></a>toRadians <span class="op">=</span> (val) <span class="kw">=&gt;</span> val <span class="op">*</span> <span class="bu">Math</span><span class="op">.</span><span class="cn">PI</span> <span class="op">/</span> <span class="dv">180</span></span>
<span id="cb5-1354"><a href="#cb5-1354" aria-hidden="true" tabindex="-1"></a>toDegrees <span class="op">=</span> (val) <span class="kw">=&gt;</span> val <span class="op">*</span> <span class="dv">180</span> <span class="op">/</span> <span class="bu">Math</span><span class="op">.</span><span class="cn">PI</span><span class="op">;</span></span>
<span id="cb5-1355"><a href="#cb5-1355" aria-hidden="true" tabindex="-1"></a>land <span class="op">=</span> topojson<span class="op">.</span><span class="fu">feature</span>(world<span class="op">,</span> world<span class="op">.</span><span class="at">objects</span><span class="op">.</span><span class="at">land</span>)<span class="op">;</span></span>
<span id="cb5-1356"><a href="#cb5-1356" aria-hidden="true" tabindex="-1"></a>d3 <span class="op">=</span> <span class="pp">require</span>(<span class="st">"d3@7"</span><span class="op">,</span> <span class="st">"d3-geo-projection@3"</span>)</span>
<span id="cb5-1357"><a href="#cb5-1357" aria-hidden="true" tabindex="-1"></a><span class="kw">function</span> <span class="fu">input</span>(config) {</span>
<span id="cb5-1358"><a href="#cb5-1358" aria-hidden="true" tabindex="-1"></a>  <span class="kw">let</span> {</span>
<span id="cb5-1359"><a href="#cb5-1359" aria-hidden="true" tabindex="-1"></a>    form<span class="op">,</span></span>
<span id="cb5-1360"><a href="#cb5-1360" aria-hidden="true" tabindex="-1"></a>    type <span class="op">=</span> <span class="st">"text"</span><span class="op">,</span></span>
<span id="cb5-1361"><a href="#cb5-1361" aria-hidden="true" tabindex="-1"></a>    attributes <span class="op">=</span> {}<span class="op">,</span></span>
<span id="cb5-1362"><a href="#cb5-1362" aria-hidden="true" tabindex="-1"></a>    action<span class="op">,</span></span>
<span id="cb5-1363"><a href="#cb5-1363" aria-hidden="true" tabindex="-1"></a>    getValue<span class="op">,</span></span>
<span id="cb5-1364"><a href="#cb5-1364" aria-hidden="true" tabindex="-1"></a>    title<span class="op">,</span></span>
<span id="cb5-1365"><a href="#cb5-1365" aria-hidden="true" tabindex="-1"></a>    description<span class="op">,</span></span>
<span id="cb5-1366"><a href="#cb5-1366" aria-hidden="true" tabindex="-1"></a>    format<span class="op">,</span></span>
<span id="cb5-1367"><a href="#cb5-1367" aria-hidden="true" tabindex="-1"></a>    display<span class="op">,</span></span>
<span id="cb5-1368"><a href="#cb5-1368" aria-hidden="true" tabindex="-1"></a>    submit<span class="op">,</span></span>
<span id="cb5-1369"><a href="#cb5-1369" aria-hidden="true" tabindex="-1"></a>    options</span>
<span id="cb5-1370"><a href="#cb5-1370" aria-hidden="true" tabindex="-1"></a>  } <span class="op">=</span> config<span class="op">;</span></span>
<span id="cb5-1371"><a href="#cb5-1371" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> wrapper <span class="op">=</span> <span class="fu">html</span><span class="vs">`&lt;div&gt;&lt;/div&gt;`</span><span class="op">;</span></span>
<span id="cb5-1372"><a href="#cb5-1372" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (<span class="op">!</span>form)</span>
<span id="cb5-1373"><a href="#cb5-1373" aria-hidden="true" tabindex="-1"></a>    form <span class="op">=</span> <span class="fu">html</span><span class="vs">`&lt;form&gt;</span></span>
<span id="cb5-1374"><a href="#cb5-1374" aria-hidden="true" tabindex="-1"></a><span class="vs">    &lt;input name=input type=</span><span class="sc">${</span>type<span class="sc">}</span><span class="vs"> /&gt;</span></span>
<span id="cb5-1375"><a href="#cb5-1375" aria-hidden="true" tabindex="-1"></a><span class="vs">  &lt;/form&gt;`</span><span class="op">;</span></span>
<span id="cb5-1376"><a href="#cb5-1376" aria-hidden="true" tabindex="-1"></a>  <span class="bu">Object</span><span class="op">.</span><span class="fu">keys</span>(attributes)<span class="op">.</span><span class="fu">forEach</span>(key <span class="kw">=&gt;</span> {</span>
<span id="cb5-1377"><a href="#cb5-1377" aria-hidden="true" tabindex="-1"></a>    <span class="kw">const</span> val <span class="op">=</span> attributes[key]<span class="op">;</span></span>
<span id="cb5-1378"><a href="#cb5-1378" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> (val <span class="op">!=</span> <span class="kw">null</span>) form<span class="op">.</span><span class="at">input</span><span class="op">.</span><span class="fu">setAttribute</span>(key<span class="op">,</span> val)<span class="op">;</span></span>
<span id="cb5-1379"><a href="#cb5-1379" aria-hidden="true" tabindex="-1"></a>  })<span class="op">;</span></span>
<span id="cb5-1380"><a href="#cb5-1380" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (submit)</span>
<span id="cb5-1381"><a href="#cb5-1381" aria-hidden="true" tabindex="-1"></a>    form<span class="op">.</span><span class="fu">append</span>(</span>
<span id="cb5-1382"><a href="#cb5-1382" aria-hidden="true" tabindex="-1"></a>      <span class="fu">html</span><span class="vs">`&lt;input name=submit type=submit style="margin: 0 0.75em" value="</span><span class="sc">${</span></span>
<span id="cb5-1383"><a href="#cb5-1383" aria-hidden="true" tabindex="-1"></a>        <span class="kw">typeof</span> submit <span class="op">==</span> <span class="st">"string"</span> <span class="op">?</span> submit <span class="op">:</span> <span class="st">"Submit"</span></span>
<span id="cb5-1384"><a href="#cb5-1384" aria-hidden="true" tabindex="-1"></a>      <span class="sc">}</span><span class="vs">" /&gt;`</span></span>
<span id="cb5-1385"><a href="#cb5-1385" aria-hidden="true" tabindex="-1"></a>    )<span class="op">;</span></span>
<span id="cb5-1386"><a href="#cb5-1386" aria-hidden="true" tabindex="-1"></a>  form<span class="op">.</span><span class="fu">append</span>(</span>
<span id="cb5-1387"><a href="#cb5-1387" aria-hidden="true" tabindex="-1"></a>    <span class="fu">html</span><span class="vs">`&lt;output name=output style="font: 14px Menlo, Consolas, monospace; margin-left: 0.1em; text-align:center;"&gt;&lt;/output&gt;`</span></span>
<span id="cb5-1388"><a href="#cb5-1388" aria-hidden="true" tabindex="-1"></a>  )<span class="op">;</span></span>
<span id="cb5-1389"><a href="#cb5-1389" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (title)</span>
<span id="cb5-1390"><a href="#cb5-1390" aria-hidden="true" tabindex="-1"></a>    form<span class="op">.</span><span class="fu">prepend</span>(</span>
<span id="cb5-1391"><a href="#cb5-1391" aria-hidden="true" tabindex="-1"></a>      <span class="fu">html</span><span class="vs">`&lt;div style="font: 700 0.9rem sans-serif; margin-bottom: 3px;"&gt;</span><span class="sc">${</span>title<span class="sc">}</span><span class="vs">&lt;/div&gt;`</span></span>
<span id="cb5-1392"><a href="#cb5-1392" aria-hidden="true" tabindex="-1"></a>    )<span class="op">;</span></span>
<span id="cb5-1393"><a href="#cb5-1393" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (description)</span>
<span id="cb5-1394"><a href="#cb5-1394" aria-hidden="true" tabindex="-1"></a>    form<span class="op">.</span><span class="fu">append</span>(</span>
<span id="cb5-1395"><a href="#cb5-1395" aria-hidden="true" tabindex="-1"></a>      <span class="fu">html</span><span class="vs">`&lt;div style="font-size: 0.85rem; font-style: italic; margin-top: 3px;"&gt;</span><span class="sc">${</span>description<span class="sc">}</span><span class="vs">&lt;/div&gt;`</span></span>
<span id="cb5-1396"><a href="#cb5-1396" aria-hidden="true" tabindex="-1"></a>    )<span class="op">;</span></span>
<span id="cb5-1397"><a href="#cb5-1397" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (format)</span>
<span id="cb5-1398"><a href="#cb5-1398" aria-hidden="true" tabindex="-1"></a>    format <span class="op">=</span> <span class="kw">typeof</span> format <span class="op">===</span> <span class="st">"function"</span> <span class="op">?</span> format <span class="op">:</span> d3format<span class="op">.</span><span class="fu">format</span>(format)<span class="op">;</span></span>
<span id="cb5-1399"><a href="#cb5-1399" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (action) {</span>
<span id="cb5-1400"><a href="#cb5-1400" aria-hidden="true" tabindex="-1"></a>    <span class="fu">action</span>(form)<span class="op">;</span></span>
<span id="cb5-1401"><a href="#cb5-1401" aria-hidden="true" tabindex="-1"></a>  } <span class="cf">else</span> {</span>
<span id="cb5-1402"><a href="#cb5-1402" aria-hidden="true" tabindex="-1"></a>    <span class="kw">const</span> verb <span class="op">=</span> submit</span>
<span id="cb5-1403"><a href="#cb5-1403" aria-hidden="true" tabindex="-1"></a>      <span class="op">?</span> <span class="st">"onsubmit"</span></span>
<span id="cb5-1404"><a href="#cb5-1404" aria-hidden="true" tabindex="-1"></a>      <span class="op">:</span> type <span class="op">==</span> <span class="st">"button"</span></span>
<span id="cb5-1405"><a href="#cb5-1405" aria-hidden="true" tabindex="-1"></a>      <span class="op">?</span> <span class="st">"onclick"</span></span>
<span id="cb5-1406"><a href="#cb5-1406" aria-hidden="true" tabindex="-1"></a>      <span class="op">:</span> type <span class="op">==</span> <span class="st">"checkbox"</span> <span class="op">||</span> type <span class="op">==</span> <span class="st">"radio"</span></span>
<span id="cb5-1407"><a href="#cb5-1407" aria-hidden="true" tabindex="-1"></a>      <span class="op">?</span> <span class="st">"onchange"</span></span>
<span id="cb5-1408"><a href="#cb5-1408" aria-hidden="true" tabindex="-1"></a>      <span class="op">:</span> <span class="st">"oninput"</span><span class="op">;</span></span>
<span id="cb5-1409"><a href="#cb5-1409" aria-hidden="true" tabindex="-1"></a>    form[verb] <span class="op">=</span> e <span class="kw">=&gt;</span> {</span>
<span id="cb5-1410"><a href="#cb5-1410" aria-hidden="true" tabindex="-1"></a>      e <span class="op">&amp;&amp;</span> e<span class="op">.</span><span class="fu">preventDefault</span>()<span class="op">;</span></span>
<span id="cb5-1411"><a href="#cb5-1411" aria-hidden="true" tabindex="-1"></a>      <span class="kw">const</span> value <span class="op">=</span> getValue <span class="op">?</span> <span class="fu">getValue</span>(form<span class="op">.</span><span class="at">input</span>) <span class="op">:</span> form<span class="op">.</span><span class="at">input</span><span class="op">.</span><span class="at">value</span><span class="op">;</span></span>
<span id="cb5-1412"><a href="#cb5-1412" aria-hidden="true" tabindex="-1"></a>      <span class="cf">if</span> (form<span class="op">.</span><span class="at">output</span>) {</span>
<span id="cb5-1413"><a href="#cb5-1413" aria-hidden="true" tabindex="-1"></a>        <span class="kw">const</span> out <span class="op">=</span> display <span class="op">?</span> <span class="fu">display</span>(value) <span class="op">:</span> format <span class="op">?</span> <span class="fu">format</span>(value) <span class="op">:</span> value<span class="op">;</span></span>
<span id="cb5-1414"><a href="#cb5-1414" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> (out <span class="kw">instanceof</span> <span class="bu">window</span><span class="op">.</span><span class="at">Element</span>) {</span>
<span id="cb5-1415"><a href="#cb5-1415" aria-hidden="true" tabindex="-1"></a>          <span class="cf">while</span> (form<span class="op">.</span><span class="at">output</span><span class="op">.</span><span class="fu">hasChildNodes</span>()) {</span>
<span id="cb5-1416"><a href="#cb5-1416" aria-hidden="true" tabindex="-1"></a>            form<span class="op">.</span><span class="at">output</span><span class="op">.</span><span class="fu">removeChild</span>(form<span class="op">.</span><span class="at">output</span><span class="op">.</span><span class="at">lastChild</span>)<span class="op">;</span></span>
<span id="cb5-1417"><a href="#cb5-1417" aria-hidden="true" tabindex="-1"></a>          }</span>
<span id="cb5-1418"><a href="#cb5-1418" aria-hidden="true" tabindex="-1"></a>          form<span class="op">.</span><span class="at">output</span><span class="op">.</span><span class="fu">append</span>(out)<span class="op">;</span></span>
<span id="cb5-1419"><a href="#cb5-1419" aria-hidden="true" tabindex="-1"></a>        } <span class="cf">else</span> {</span>
<span id="cb5-1420"><a href="#cb5-1420" aria-hidden="true" tabindex="-1"></a>          form<span class="op">.</span><span class="at">output</span><span class="op">.</span><span class="at">value</span> <span class="op">=</span> out<span class="op">;</span></span>
<span id="cb5-1421"><a href="#cb5-1421" aria-hidden="true" tabindex="-1"></a>        }</span>
<span id="cb5-1422"><a href="#cb5-1422" aria-hidden="true" tabindex="-1"></a>      }</span>
<span id="cb5-1423"><a href="#cb5-1423" aria-hidden="true" tabindex="-1"></a>      form<span class="op">.</span><span class="at">value</span> <span class="op">=</span> value<span class="op">;</span></span>
<span id="cb5-1424"><a href="#cb5-1424" aria-hidden="true" tabindex="-1"></a>      <span class="cf">if</span> (verb <span class="op">!==</span> <span class="st">"oninput"</span>)</span>
<span id="cb5-1425"><a href="#cb5-1425" aria-hidden="true" tabindex="-1"></a>        form<span class="op">.</span><span class="fu">dispatchEvent</span>(<span class="kw">new</span> <span class="bu">CustomEvent</span>(<span class="st">"input"</span><span class="op">,</span> { <span class="dt">bubbles</span><span class="op">:</span> <span class="kw">true</span> }))<span class="op">;</span></span>
<span id="cb5-1426"><a href="#cb5-1426" aria-hidden="true" tabindex="-1"></a>    }<span class="op">;</span></span>
<span id="cb5-1427"><a href="#cb5-1427" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> (verb <span class="op">!==</span> <span class="st">"oninput"</span>)</span>
<span id="cb5-1428"><a href="#cb5-1428" aria-hidden="true" tabindex="-1"></a>      wrapper<span class="op">.</span><span class="at">oninput</span> <span class="op">=</span> e <span class="kw">=&gt;</span> e <span class="op">&amp;&amp;</span> e<span class="op">.</span><span class="fu">stopPropagation</span>() <span class="op">&amp;&amp;</span> e<span class="op">.</span><span class="fu">preventDefault</span>()<span class="op">;</span></span>
<span id="cb5-1429"><a href="#cb5-1429" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> (verb <span class="op">!==</span> <span class="st">"onsubmit"</span>) form<span class="op">.</span><span class="at">onsubmit</span> <span class="op">=</span> e <span class="kw">=&gt;</span> e <span class="op">&amp;&amp;</span> e<span class="op">.</span><span class="fu">preventDefault</span>()<span class="op">;</span></span>
<span id="cb5-1430"><a href="#cb5-1430" aria-hidden="true" tabindex="-1"></a>    form[verb]()<span class="op">;</span></span>
<span id="cb5-1431"><a href="#cb5-1431" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb5-1432"><a href="#cb5-1432" aria-hidden="true" tabindex="-1"></a>  <span class="cf">while</span> (form<span class="op">.</span><span class="at">childNodes</span><span class="op">.</span><span class="at">length</span>) {</span>
<span id="cb5-1433"><a href="#cb5-1433" aria-hidden="true" tabindex="-1"></a>    wrapper<span class="op">.</span><span class="fu">appendChild</span>(form<span class="op">.</span><span class="at">childNodes</span>[<span class="dv">0</span>])<span class="op">;</span></span>
<span id="cb5-1434"><a href="#cb5-1434" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb5-1435"><a href="#cb5-1435" aria-hidden="true" tabindex="-1"></a>  form<span class="op">.</span><span class="fu">append</span>(wrapper)<span class="op">;</span></span>
<span id="cb5-1436"><a href="#cb5-1436" aria-hidden="true" tabindex="-1"></a>  <span class="cf">return</span> form<span class="op">;</span></span>
<span id="cb5-1437"><a href="#cb5-1437" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb5-1438"><a href="#cb5-1438" aria-hidden="true" tabindex="-1"></a>d3format <span class="op">=</span> <span class="pp">require</span>(<span class="st">"d3-format@1"</span>)</span>
<span id="cb5-1439"><a href="#cb5-1439" aria-hidden="true" tabindex="-1"></a><span class="co">// https://observablehq.com/@enjalot/draggable-world-map-coordinates-input</span></span>
<span id="cb5-1440"><a href="#cb5-1440" aria-hidden="true" tabindex="-1"></a><span class="kw">function</span> <span class="fu">worldMapCoordinates</span>(config <span class="op">=</span> {}<span class="op">,</span> dimensions) {</span>
<span id="cb5-1441"><a href="#cb5-1441" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> {</span>
<span id="cb5-1442"><a href="#cb5-1442" aria-hidden="true" tabindex="-1"></a>    value <span class="op">=</span> []<span class="op">,</span> title<span class="op">,</span> description<span class="op">,</span> width <span class="op">=</span> dimensions[<span class="dv">0</span>]</span>
<span id="cb5-1443"><a href="#cb5-1443" aria-hidden="true" tabindex="-1"></a>  } <span class="op">=</span> <span class="bu">Array</span><span class="op">.</span><span class="fu">isArray</span>(config) <span class="op">?</span> {<span class="dt">value</span><span class="op">:</span> config} <span class="op">:</span> config<span class="op">;</span></span>
<span id="cb5-1444"><a href="#cb5-1444" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> height <span class="op">=</span> dimensions[<span class="dv">1</span>]<span class="op">;</span></span>
<span id="cb5-1445"><a href="#cb5-1445" aria-hidden="true" tabindex="-1"></a>  <span class="kw">let</span> [lon<span class="op">,</span> lat] <span class="op">=</span> value<span class="op">;</span></span>
<span id="cb5-1446"><a href="#cb5-1446" aria-hidden="true" tabindex="-1"></a>  lon <span class="op">=</span> lon <span class="op">!=</span> <span class="kw">null</span> <span class="op">?</span> lon <span class="op">:</span> <span class="kw">null</span><span class="op">;</span></span>
<span id="cb5-1447"><a href="#cb5-1447" aria-hidden="true" tabindex="-1"></a>  lat <span class="op">=</span> lat <span class="op">!=</span> <span class="kw">null</span> <span class="op">?</span> lat <span class="op">:</span> <span class="kw">null</span><span class="op">;</span></span>
<span id="cb5-1448"><a href="#cb5-1448" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> formEl <span class="op">=</span> <span class="fu">html</span><span class="vs">`&lt;form style="width: </span><span class="sc">${</span>width<span class="sc">}</span><span class="vs">px;"&gt;&lt;/form&gt;`</span><span class="op">;</span></span>
<span id="cb5-1449"><a href="#cb5-1449" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> context <span class="op">=</span> DOM<span class="op">.</span><span class="fu">context2d</span>(width<span class="op">,</span> height<span class="op">-</span>width<span class="op">/</span><span class="fl">13.2</span>)<span class="op">;</span></span>
<span id="cb5-1450"><a href="#cb5-1450" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> canvas <span class="op">=</span> context<span class="op">.</span><span class="at">canvas</span><span class="op">;</span></span>
<span id="cb5-1451"><a href="#cb5-1451" aria-hidden="true" tabindex="-1"></a>  canvas<span class="op">.</span><span class="at">style</span><span class="op">.</span><span class="at">margin</span> <span class="op">=</span> <span class="vs">`-10px 0px -26px 0px`</span><span class="op">;</span></span>
<span id="cb5-1452"><a href="#cb5-1452" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> projection <span class="op">=</span> d3</span>
<span id="cb5-1453"><a href="#cb5-1453" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">geoEquirectangular</span>()</span>
<span id="cb5-1454"><a href="#cb5-1454" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">precision</span>(<span class="fl">0.1</span>)</span>
<span id="cb5-1455"><a href="#cb5-1455" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">fitSize</span>([width<span class="op">,</span> height]<span class="op">,</span> { <span class="dt">type</span><span class="op">:</span> <span class="st">"Sphere"</span> })<span class="op">.</span><span class="fu">rotate</span>([<span class="op">-</span><span class="dv">153</span><span class="op">,</span> <span class="dv">0</span>])<span class="op">;</span></span>
<span id="cb5-1456"><a href="#cb5-1456" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> path <span class="op">=</span> d3<span class="op">.</span><span class="fu">geoPath</span>(projection<span class="op">,</span> context)<span class="op">.</span><span class="fu">pointRadius</span>(<span class="fl">2.5</span>)<span class="op">;</span></span>
<span id="cb5-1457"><a href="#cb5-1457" aria-hidden="true" tabindex="-1"></a>  formEl<span class="op">.</span><span class="fu">append</span>(canvas)<span class="op">;</span></span>
<span id="cb5-1458"><a href="#cb5-1458" aria-hidden="true" tabindex="-1"></a>  <span class="kw">function</span> <span class="fu">draw</span>() {</span>
<span id="cb5-1459"><a href="#cb5-1459" aria-hidden="true" tabindex="-1"></a>    context<span class="op">.</span><span class="at">fillStyle</span> <span class="op">=</span> <span class="st">"#fff"</span><span class="op">;</span></span>
<span id="cb5-1460"><a href="#cb5-1460" aria-hidden="true" tabindex="-1"></a>    context<span class="op">.</span><span class="fu">fillRect</span>(<span class="dv">0</span><span class="op">,</span> <span class="dv">0</span><span class="op">,</span> width<span class="op">,</span> height)<span class="op">;</span></span>
<span id="cb5-1461"><a href="#cb5-1461" aria-hidden="true" tabindex="-1"></a>    context<span class="op">.</span><span class="fu">beginPath</span>()<span class="op">;</span> <span class="fu">path</span>({<span class="dt">type</span><span class="op">:</span> <span class="st">"Sphere"</span>})<span class="op">;</span></span>
<span id="cb5-1462"><a href="#cb5-1462" aria-hidden="true" tabindex="-1"></a>    context<span class="op">.</span><span class="at">fillStyle</span> <span class="op">=</span> colors<span class="op">.</span><span class="at">ocean</span><span class="op">;</span> context<span class="op">.</span><span class="fu">fill</span>()<span class="op">;</span></span>
<span id="cb5-1463"><a href="#cb5-1463" aria-hidden="true" tabindex="-1"></a>    context<span class="op">.</span><span class="fu">beginPath</span>()<span class="op">;</span></span>
<span id="cb5-1464"><a href="#cb5-1464" aria-hidden="true" tabindex="-1"></a>    <span class="fu">path</span>(graticule)<span class="op">;</span></span>
<span id="cb5-1465"><a href="#cb5-1465" aria-hidden="true" tabindex="-1"></a>    context<span class="op">.</span><span class="at">lineWidth</span> <span class="op">=</span> <span class="fl">0.95</span><span class="op">;</span></span>
<span id="cb5-1466"><a href="#cb5-1466" aria-hidden="true" tabindex="-1"></a>    context<span class="op">.</span><span class="at">strokeStyle</span> <span class="op">=</span> <span class="vs">`#aaa`</span><span class="op">;</span></span>
<span id="cb5-1467"><a href="#cb5-1467" aria-hidden="true" tabindex="-1"></a>    context<span class="op">.</span><span class="fu">stroke</span>()<span class="op">;</span></span>
<span id="cb5-1468"><a href="#cb5-1468" aria-hidden="true" tabindex="-1"></a>    context<span class="op">.</span><span class="fu">beginPath</span>()<span class="op">;</span></span>
<span id="cb5-1469"><a href="#cb5-1469" aria-hidden="true" tabindex="-1"></a>    <span class="fu">path</span>(land)<span class="op">;</span></span>
<span id="cb5-1470"><a href="#cb5-1470" aria-hidden="true" tabindex="-1"></a>    context<span class="op">.</span><span class="at">fillStyle</span> <span class="op">=</span> colors<span class="op">.</span><span class="at">land</span><span class="op">;</span></span>
<span id="cb5-1471"><a href="#cb5-1471" aria-hidden="true" tabindex="-1"></a>    context<span class="op">.</span><span class="fu">fill</span>()<span class="op">;</span></span>
<span id="cb5-1472"><a href="#cb5-1472" aria-hidden="true" tabindex="-1"></a>    context<span class="op">.</span><span class="fu">beginPath</span>()<span class="op">;</span></span>
<span id="cb5-1473"><a href="#cb5-1473" aria-hidden="true" tabindex="-1"></a>    <span class="fu">path</span>(countries)<span class="op">;</span></span>
<span id="cb5-1474"><a href="#cb5-1474" aria-hidden="true" tabindex="-1"></a>    context<span class="op">.</span><span class="at">lineWidth</span> <span class="op">=</span> <span class="op">.</span><span class="dv">95</span><span class="op">;</span></span>
<span id="cb5-1475"><a href="#cb5-1475" aria-hidden="true" tabindex="-1"></a>    context<span class="op">.</span><span class="at">strokeStyle</span> <span class="op">=</span> <span class="vs">`#000`</span><span class="op">;</span></span>
<span id="cb5-1476"><a href="#cb5-1476" aria-hidden="true" tabindex="-1"></a>    context<span class="op">.</span><span class="fu">stroke</span>()<span class="op">;</span></span>
<span id="cb5-1477"><a href="#cb5-1477" aria-hidden="true" tabindex="-1"></a>    context<span class="op">.</span><span class="at">fillStyle</span> <span class="op">=</span> <span class="vs">`#000`</span><span class="op">;</span></span>
<span id="cb5-1478"><a href="#cb5-1478" aria-hidden="true" tabindex="-1"></a>    context<span class="op">.</span><span class="at">font</span> <span class="op">=</span> width <span class="op">&lt;</span> <span class="dv">760</span> <span class="op">?</span> <span class="st">"14px serif"</span> <span class="op">:</span> width <span class="op">&lt;</span> <span class="dv">990</span> <span class="op">?</span> <span class="st">"17px serif"</span> <span class="op">:</span> <span class="st">"23px serif"</span><span class="op">;</span></span>
<span id="cb5-1479"><a href="#cb5-1479" aria-hidden="true" tabindex="-1"></a>    d3<span class="op">.</span><span class="fu">range</span>(<span class="op">-</span><span class="fl">1.5</span><span class="op">,</span> <span class="dv">342</span> <span class="op">+</span> <span class="dv">1</span><span class="op">,</span> <span class="dv">36</span>)<span class="op">.</span><span class="fu">map</span>(x <span class="kw">=&gt;</span>  context<span class="op">.</span><span class="fu">fillText</span>(<span class="fu">long2zone</span>(x)<span class="op">,</span> <span class="op">...</span><span class="fu">projection</span>([x<span class="op">,</span> <span class="dv">84</span> <span class="op">-</span> (width <span class="op">&lt;</span> <span class="dv">500</span>) <span class="op">*</span> <span class="fl">8.8</span>])))<span class="op">;</span></span>
<span id="cb5-1480"><a href="#cb5-1480" aria-hidden="true" tabindex="-1"></a>    d3<span class="op">.</span><span class="fu">range</span>(<span class="op">-</span><span class="fl">1.5</span><span class="op">,</span> <span class="dv">342</span> <span class="op">+</span> <span class="dv">1</span><span class="op">,</span> <span class="dv">36</span>)<span class="op">.</span><span class="fu">map</span>(x <span class="kw">=&gt;</span>  context<span class="op">.</span><span class="fu">fillText</span>(<span class="fu">long2zone</span>(x)<span class="op">,</span> <span class="op">...</span><span class="fu">projection</span>([x<span class="op">,</span> <span class="op">-</span><span class="dv">66</span> <span class="op">+</span> (width <span class="op">&lt;</span> <span class="dv">500</span>) <span class="op">*</span> <span class="fl">1.1</span>])))<span class="op">;</span></span>
<span id="cb5-1481"><a href="#cb5-1481" aria-hidden="true" tabindex="-1"></a>    context<span class="op">.</span><span class="fu">beginPath</span>()<span class="op">,</span> <span class="fu">path</span>(night)<span class="op">,</span> context<span class="op">.</span><span class="at">fillStyle</span> <span class="op">=</span> <span class="st">"rgba(0,0,255,0.1)"</span><span class="op">,</span> context<span class="op">.</span><span class="fu">fill</span>()<span class="op">;</span></span>
<span id="cb5-1482"><a href="#cb5-1482" aria-hidden="true" tabindex="-1"></a>    context<span class="op">.</span><span class="fu">beginPath</span>()<span class="op">;</span> path<span class="op">.</span><span class="fu">pointRadius</span>(<span class="dv">17</span>)<span class="op">;</span> <span class="fu">path</span>({<span class="dt">type</span><span class="op">:</span> <span class="st">"Point"</span><span class="op">,</span> <span class="dt">coordinates</span><span class="op">:</span> sun})<span class="op">;</span> context<span class="op">.</span><span class="at">strokeStyle</span> <span class="op">=</span> <span class="st">"#0008"</span><span class="op">;</span> context<span class="op">.</span><span class="at">fillStyle</span> <span class="op">=</span> <span class="st">"#ff08"</span><span class="op">;</span> context<span class="op">.</span><span class="at">lineWidth</span> <span class="op">=</span> <span class="dv">1</span><span class="op">;</span> context<span class="op">.</span><span class="fu">stroke</span>()<span class="op">;</span> context<span class="op">.</span><span class="fu">fill</span>()<span class="op">;</span></span>
<span id="cb5-1483"><a href="#cb5-1483" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> (lon <span class="op">!=</span> <span class="kw">null</span> <span class="op">&amp;&amp;</span> lat <span class="op">!=</span> <span class="kw">null</span>) {</span>
<span id="cb5-1484"><a href="#cb5-1484" aria-hidden="true" tabindex="-1"></a>      path<span class="op">.</span><span class="fu">pointRadius</span>(<span class="dv">17</span>)<span class="op">;</span> context<span class="op">.</span><span class="at">strokeStyle</span> <span class="op">=</span> <span class="st">"black"</span><span class="op">;</span></span>
<span id="cb5-1485"><a href="#cb5-1485" aria-hidden="true" tabindex="-1"></a>      context<span class="op">.</span><span class="fu">beginPath</span>()<span class="op">;</span> <span class="fu">path</span>({<span class="dt">type</span><span class="op">:</span> <span class="st">"Point"</span><span class="op">,</span> <span class="dt">coordinates</span><span class="op">:</span> [lon<span class="op">,</span> lat]})<span class="op">;</span> context<span class="op">.</span><span class="at">lineWidth</span> <span class="op">=</span> <span class="dv">1</span><span class="op">;</span> context<span class="op">.</span><span class="fu">stroke</span>()<span class="op">;</span></span>
<span id="cb5-1486"><a href="#cb5-1486" aria-hidden="true" tabindex="-1"></a>      context<span class="op">.</span><span class="at">lineWidth</span> <span class="op">=</span> <span class="dv">6</span><span class="op">;</span></span>
<span id="cb5-1487"><a href="#cb5-1487" aria-hidden="true" tabindex="-1"></a>      path<span class="op">.</span><span class="fu">pointRadius</span>(<span class="dv">14</span>)<span class="op">;</span> context<span class="op">.</span><span class="at">strokeStyle</span> <span class="op">=</span> <span class="st">"red"</span><span class="op">;</span></span>
<span id="cb5-1488"><a href="#cb5-1488" aria-hidden="true" tabindex="-1"></a>      context<span class="op">.</span><span class="fu">beginPath</span>()<span class="op">;</span> <span class="fu">path</span>({<span class="dt">type</span><span class="op">:</span> <span class="st">"Point"</span><span class="op">,</span> <span class="dt">coordinates</span><span class="op">:</span> [lon<span class="op">,</span> lat]})<span class="op">;</span> context<span class="op">.</span><span class="fu">stroke</span>()<span class="op">;</span></span>
<span id="cb5-1489"><a href="#cb5-1489" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb5-1490"><a href="#cb5-1490" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb5-1491"><a href="#cb5-1491" aria-hidden="true" tabindex="-1"></a>  <span class="kw">let</span> drag <span class="op">=</span> d3<span class="op">.</span><span class="fu">drag</span>()</span>
<span id="cb5-1492"><a href="#cb5-1492" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">on</span>(<span class="st">"drag"</span><span class="op">,</span> (<span class="bu">event</span>) <span class="kw">=&gt;</span> {</span>
<span id="cb5-1493"><a href="#cb5-1493" aria-hidden="true" tabindex="-1"></a>      <span class="kw">let</span> coords <span class="op">=</span> projection<span class="op">.</span><span class="fu">invert</span>([<span class="bu">event</span><span class="op">.</span><span class="at">x</span><span class="op">,</span> <span class="bu">event</span><span class="op">.</span><span class="at">y</span>])<span class="op">;</span></span>
<span id="cb5-1494"><a href="#cb5-1494" aria-hidden="true" tabindex="-1"></a>      lon <span class="op">=</span> <span class="op">+</span>coords[<span class="dv">0</span>]<span class="op">.</span><span class="fu">toFixed</span>(<span class="dv">2</span>)<span class="op">;</span></span>
<span id="cb5-1495"><a href="#cb5-1495" aria-hidden="true" tabindex="-1"></a>      lat <span class="op">=</span> <span class="op">+</span>coords[<span class="dv">1</span>]<span class="op">.</span><span class="fu">toFixed</span>(<span class="dv">2</span>)<span class="op">;</span></span>
<span id="cb5-1496"><a href="#cb5-1496" aria-hidden="true" tabindex="-1"></a>      <span class="fu">draw</span>()<span class="op">;</span></span>
<span id="cb5-1497"><a href="#cb5-1497" aria-hidden="true" tabindex="-1"></a>      canvas<span class="op">.</span><span class="fu">dispatchEvent</span>(<span class="kw">new</span> <span class="bu">CustomEvent</span>(<span class="st">"input"</span><span class="op">,</span> { <span class="dt">bubbles</span><span class="op">:</span> <span class="kw">true</span> }))<span class="op">;</span></span>
<span id="cb5-1498"><a href="#cb5-1498" aria-hidden="true" tabindex="-1"></a>    })</span>
<span id="cb5-1499"><a href="#cb5-1499" aria-hidden="true" tabindex="-1"></a>  d3<span class="op">.</span><span class="fu">select</span>(canvas)<span class="op">.</span><span class="fu">call</span>(drag)</span>
<span id="cb5-1500"><a href="#cb5-1500" aria-hidden="true" tabindex="-1"></a>  canvas<span class="op">.</span><span class="at">onclick</span> <span class="op">=</span> <span class="kw">function</span>(ev) {</span>
<span id="cb5-1501"><a href="#cb5-1501" aria-hidden="true" tabindex="-1"></a>    <span class="kw">const</span> { offsetX<span class="op">,</span> offsetY } <span class="op">=</span> ev<span class="op">;</span></span>
<span id="cb5-1502"><a href="#cb5-1502" aria-hidden="true" tabindex="-1"></a>    <span class="kw">let</span> coords <span class="op">=</span> projection<span class="op">.</span><span class="fu">invert</span>([offsetX<span class="op">,</span> offsetY])<span class="op">;</span></span>
<span id="cb5-1503"><a href="#cb5-1503" aria-hidden="true" tabindex="-1"></a>    lon <span class="op">=</span> <span class="op">+</span>coords[<span class="dv">0</span>]<span class="op">.</span><span class="fu">toFixed</span>(<span class="dv">2</span>)<span class="op">;</span></span>
<span id="cb5-1504"><a href="#cb5-1504" aria-hidden="true" tabindex="-1"></a>    lat <span class="op">=</span> <span class="op">+</span>coords[<span class="dv">1</span>]<span class="op">.</span><span class="fu">toFixed</span>(<span class="dv">2</span>)<span class="op">;</span></span>
<span id="cb5-1505"><a href="#cb5-1505" aria-hidden="true" tabindex="-1"></a>    <span class="fu">draw</span>()<span class="op">;</span></span>
<span id="cb5-1506"><a href="#cb5-1506" aria-hidden="true" tabindex="-1"></a>    canvas<span class="op">.</span><span class="fu">dispatchEvent</span>(<span class="kw">new</span> <span class="bu">CustomEvent</span>(<span class="st">"input"</span><span class="op">,</span> { <span class="dt">bubbles</span><span class="op">:</span> <span class="kw">true</span> }))<span class="op">;</span></span>
<span id="cb5-1507"><a href="#cb5-1507" aria-hidden="true" tabindex="-1"></a>  }<span class="op">;</span></span>
<span id="cb5-1508"><a href="#cb5-1508" aria-hidden="true" tabindex="-1"></a>  <span class="fu">draw</span>()<span class="op">;</span></span>
<span id="cb5-1509"><a href="#cb5-1509" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> form <span class="op">=</span> <span class="fu">input</span>({</span>
<span id="cb5-1510"><a href="#cb5-1510" aria-hidden="true" tabindex="-1"></a>    <span class="dt">type</span><span class="op">:</span> <span class="st">"worldMapCoordinates"</span><span class="op">,</span></span>
<span id="cb5-1511"><a href="#cb5-1511" aria-hidden="true" tabindex="-1"></a>    title<span class="op">,</span></span>
<span id="cb5-1512"><a href="#cb5-1512" aria-hidden="true" tabindex="-1"></a>    description<span class="op">,</span></span>
<span id="cb5-1513"><a href="#cb5-1513" aria-hidden="true" tabindex="-1"></a>    <span class="dt">display</span><span class="op">:</span> v <span class="kw">=&gt;</span> (width <span class="op">&gt;</span> <span class="dv">300</span>) <span class="op">?</span> <span class="fu">html</span><span class="vs">`&lt;div style="width: </span><span class="sc">${</span>width<span class="sc">}</span><span class="vs">px; white-space: nowrap; color: #444; text-align: center; font: </span><span class="sc">${</span>width <span class="op">/</span> <span class="dv">50</span><span class="sc">}</span><span class="vs">px monospace; position: relative; top: -</span><span class="sc">${</span>width <span class="op">/</span> <span class="dv">30</span><span class="sc">}</span><span class="vs">px;  margin-bottom: -.4em;"&gt;</span></span>
<span id="cb5-1514"><a href="#cb5-1514" aria-hidden="true" tabindex="-1"></a><span class="vs">            &lt;span style="color: #000;"&gt;Zone:&lt;/span&gt; </span><span class="sc">${</span>lon <span class="op">!=</span> <span class="kw">null</span> <span class="op">?</span> <span class="fu">long2zone</span>(lon) <span class="op">:</span> <span class="st">""</span><span class="sc">}</span></span>
<span id="cb5-1515"><a href="#cb5-1515" aria-hidden="true" tabindex="-1"></a><span class="vs">            &amp;nbsp; &amp;nbsp;</span></span>
<span id="cb5-1516"><a href="#cb5-1516" aria-hidden="true" tabindex="-1"></a><span class="vs">            &lt;span style="color: #000;"&gt;Longitude:&lt;/span&gt; </span><span class="sc">${</span>lon <span class="op">!=</span> <span class="kw">null</span> <span class="op">?</span> (<span class="fu">long2turn</span>(lon))<span class="op">.</span><span class="fu">toFixed</span>(<span class="dv">0</span>) <span class="op">:</span> <span class="st">""</span><span class="sc">}</span></span>
<span id="cb5-1517"><a href="#cb5-1517" aria-hidden="true" tabindex="-1"></a><span class="vs">            &amp;nbsp; &amp;nbsp;</span></span>
<span id="cb5-1518"><a href="#cb5-1518" aria-hidden="true" tabindex="-1"></a><span class="vs">            &lt;span style="color: #000;"&gt;Latitude:&lt;/span&gt; </span><span class="sc">${</span>lat <span class="op">!=</span> <span class="kw">null</span> <span class="op">?</span> ((<span class="fu">lati2turn1</span>(lat)))<span class="op">.</span><span class="fu">toFixed</span>(<span class="dv">0</span>) <span class="op">:</span> <span class="st">""</span><span class="sc">}</span></span>
<span id="cb5-1519"><a href="#cb5-1519" aria-hidden="true" tabindex="-1"></a><span class="vs">          &lt;/div&gt;`</span> <span class="op">:</span> <span class="st">''</span><span class="op">,</span></span>
<span id="cb5-1520"><a href="#cb5-1520" aria-hidden="true" tabindex="-1"></a>    <span class="dt">getValue</span><span class="op">:</span> () <span class="kw">=&gt;</span> [lon <span class="op">!=</span> <span class="kw">null</span> <span class="op">?</span> lon <span class="op">:</span> <span class="kw">null</span><span class="op">,</span> lat <span class="op">!=</span> <span class="kw">null</span> <span class="op">?</span> lat <span class="op">:</span> <span class="kw">null</span>]<span class="op">,</span></span>
<span id="cb5-1521"><a href="#cb5-1521" aria-hidden="true" tabindex="-1"></a>    <span class="dt">form</span><span class="op">:</span> formEl</span>
<span id="cb5-1522"><a href="#cb5-1522" aria-hidden="true" tabindex="-1"></a>  })<span class="op">;</span></span>
<span id="cb5-1523"><a href="#cb5-1523" aria-hidden="true" tabindex="-1"></a>  <span class="cf">return</span> form<span class="op">;</span></span>
<span id="cb5-1524"><a href="#cb5-1524" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb5-1525"><a href="#cb5-1525" aria-hidden="true" tabindex="-1"></a>sun <span class="op">=</span> {</span>
<span id="cb5-1526"><a href="#cb5-1526" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> now <span class="op">=</span> <span class="kw">new</span> <span class="bu">Date</span><span class="op">;</span></span>
<span id="cb5-1527"><a href="#cb5-1527" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> day <span class="op">=</span> <span class="kw">new</span> <span class="bu">Date</span>(<span class="op">+</span>now)<span class="op">.</span><span class="fu">setUTCHours</span>(<span class="dv">0</span><span class="op">,</span> <span class="dv">0</span><span class="op">,</span> <span class="dv">0</span><span class="op">,</span> <span class="dv">0</span>)<span class="op">;</span></span>
<span id="cb5-1528"><a href="#cb5-1528" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> t <span class="op">=</span> solar<span class="op">.</span><span class="fu">century</span>(now)<span class="op">;</span></span>
<span id="cb5-1529"><a href="#cb5-1529" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> longitude <span class="op">=</span> (day <span class="op">-</span> now) <span class="op">/</span> <span class="fl">864e5</span> <span class="op">*</span> <span class="dv">360</span> <span class="op">-</span> <span class="dv">180</span><span class="op">;</span></span>
<span id="cb5-1530"><a href="#cb5-1530" aria-hidden="true" tabindex="-1"></a>  <span class="cf">return</span> [longitude <span class="op">-</span> solar<span class="op">.</span><span class="fu">equationOfTime</span>(t) <span class="op">/</span> <span class="dv">4</span><span class="op">,</span> solar<span class="op">.</span><span class="fu">declination</span>(t)]<span class="op">;</span></span>
<span id="cb5-1531"><a href="#cb5-1531" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb5-1532"><a href="#cb5-1532" aria-hidden="true" tabindex="-1"></a>night <span class="op">=</span> d3<span class="op">.</span><span class="fu">geoCircle</span>()</span>
<span id="cb5-1533"><a href="#cb5-1533" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">radius</span>(<span class="dv">90</span>)</span>
<span id="cb5-1534"><a href="#cb5-1534" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">center</span>(<span class="fu">antipode</span>(sun))</span>
<span id="cb5-1535"><a href="#cb5-1535" aria-hidden="true" tabindex="-1"></a>  ()</span>
<span id="cb5-1536"><a href="#cb5-1536" aria-hidden="true" tabindex="-1"></a>antipode <span class="op">=</span> ([longitude<span class="op">,</span> latitude]) <span class="kw">=&gt;</span> [longitude <span class="op">+</span> <span class="dv">180</span><span class="op">,</span> <span class="op">-</span>latitude]</span>
<span id="cb5-1537"><a href="#cb5-1537" aria-hidden="true" tabindex="-1"></a>solar <span class="op">=</span> <span class="pp">require</span>(<span class="st">"solar-calculator@0.3/dist/solar-calculator.min.js"</span>)</span>
<span id="cb5-1538"><a href="#cb5-1538" aria-hidden="true" tabindex="-1"></a>viewof fancySecondsOFF <span class="op">=</span> Inputs<span class="op">.</span><span class="fu">toggle</span>({</span>
<span id="cb5-1539"><a href="#cb5-1539" aria-hidden="true" tabindex="-1"></a>  <span class="dt">label</span><span class="op">:</span> <span class="st">"Ticking clock"</span><span class="op">,</span></span>
<span id="cb5-1540"><a href="#cb5-1540" aria-hidden="true" tabindex="-1"></a>  <span class="dt">value</span><span class="op">:</span> <span class="kw">true</span><span class="op">,</span></span>
<span id="cb5-1541"><a href="#cb5-1541" aria-hidden="true" tabindex="-1"></a>})</span>
<span id="cb5-1542"><a href="#cb5-1542" aria-hidden="true" tabindex="-1"></a><span class="kw">function</span> <span class="fu">setStyle</span>(content<span class="op">,</span> style <span class="op">=</span> {}) {</span>
<span id="cb5-1543"><a href="#cb5-1543" aria-hidden="true" tabindex="-1"></a>  <span class="kw">function</span> <span class="fu">yiq</span>(color) {</span>
<span id="cb5-1544"><a href="#cb5-1544" aria-hidden="true" tabindex="-1"></a>    <span class="kw">const</span> {r<span class="op">,</span> g<span class="op">,</span> b} <span class="op">=</span> d3<span class="op">.</span><span class="fu">rgb</span>(color)<span class="op">;</span></span>
<span id="cb5-1545"><a href="#cb5-1545" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> (r <span class="op">*</span> <span class="dv">299</span> <span class="op">+</span> g <span class="op">*</span> <span class="dv">587</span> <span class="op">+</span> b <span class="op">*</span> <span class="dv">114</span>) <span class="op">/</span> <span class="dv">1000</span> <span class="op">/</span> <span class="dv">255</span><span class="op">;</span> <span class="co">// returns values between 0 and 1</span></span>
<span id="cb5-1546"><a href="#cb5-1546" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb5-1547"><a href="#cb5-1547" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> {</span>
<span id="cb5-1548"><a href="#cb5-1548" aria-hidden="true" tabindex="-1"></a>    background<span class="op">,</span></span>
<span id="cb5-1549"><a href="#cb5-1549" aria-hidden="true" tabindex="-1"></a>    color <span class="op">=</span> <span class="fu">yiq</span>(background) <span class="op">&gt;=</span> <span class="fl">0.6</span> <span class="op">?</span> <span class="st">"#111"</span> <span class="op">:</span> <span class="st">"white"</span><span class="op">,</span></span>
<span id="cb5-1550"><a href="#cb5-1550" aria-hidden="true" tabindex="-1"></a>    padding <span class="op">=</span> <span class="st">"0 1px"</span><span class="op">,</span></span>
<span id="cb5-1551"><a href="#cb5-1551" aria-hidden="true" tabindex="-1"></a>    borderRadius <span class="op">=</span> <span class="st">"4px"</span><span class="op">,</span></span>
<span id="cb5-1552"><a href="#cb5-1552" aria-hidden="true" tabindex="-1"></a>    fontWeight <span class="op">=</span> <span class="dv">900</span><span class="op">,</span></span>
<span id="cb5-1553"><a href="#cb5-1553" aria-hidden="true" tabindex="-1"></a>    fontSize <span class="op">=</span> <span class="st">"1em"</span><span class="op">,</span></span>
<span id="cb5-1554"><a href="#cb5-1554" aria-hidden="true" tabindex="-1"></a>    <span class="op">...</span>rest</span>
<span id="cb5-1555"><a href="#cb5-1555" aria-hidden="true" tabindex="-1"></a>  } <span class="op">=</span> <span class="kw">typeof</span> style <span class="op">===</span> <span class="st">"string"</span> <span class="op">?</span> {<span class="dt">background</span><span class="op">:</span> style} <span class="op">:</span> style<span class="op">;</span></span>
<span id="cb5-1556"><a href="#cb5-1556" aria-hidden="true" tabindex="-1"></a>  <span class="cf">return</span> htl<span class="op">.</span><span class="fu">html</span><span class="vs">`&lt;span style=</span><span class="sc">${</span>{</span>
<span id="cb5-1557"><a href="#cb5-1557" aria-hidden="true" tabindex="-1"></a>    background<span class="op">,</span></span>
<span id="cb5-1558"><a href="#cb5-1558" aria-hidden="true" tabindex="-1"></a>    color<span class="op">,</span></span>
<span id="cb5-1559"><a href="#cb5-1559" aria-hidden="true" tabindex="-1"></a>    padding<span class="op">,</span></span>
<span id="cb5-1560"><a href="#cb5-1560" aria-hidden="true" tabindex="-1"></a>    borderRadius<span class="op">,</span></span>
<span id="cb5-1561"><a href="#cb5-1561" aria-hidden="true" tabindex="-1"></a>    fontWeight<span class="op">,</span></span>
<span id="cb5-1562"><a href="#cb5-1562" aria-hidden="true" tabindex="-1"></a>    <span class="op">...</span>rest</span>
<span id="cb5-1563"><a href="#cb5-1563" aria-hidden="true" tabindex="-1"></a>  }<span class="sc">}</span><span class="vs">&gt;</span><span class="sc">${</span>content<span class="sc">}</span><span class="vs">&lt;/span&gt;`</span><span class="op">;</span></span>
<span id="cb5-1564"><a href="#cb5-1564" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb5-1565"><a href="#cb5-1565" aria-hidden="true" tabindex="-1"></a><span class="kw">function</span> <span class="fu">yiq</span>(color) {</span>
<span id="cb5-1566"><a href="#cb5-1566" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> {r<span class="op">,</span> g<span class="op">,</span> b} <span class="op">=</span> d3<span class="op">.</span><span class="fu">rgb</span>(color)<span class="op">;</span></span>
<span id="cb5-1567"><a href="#cb5-1567" aria-hidden="true" tabindex="-1"></a>  <span class="cf">return</span> (r <span class="op">*</span> <span class="dv">299</span> <span class="op">+</span> g <span class="op">*</span> <span class="dv">587</span> <span class="op">+</span> b <span class="op">*</span> <span class="dv">114</span>) <span class="op">/</span> <span class="dv">1000</span> <span class="op">/</span> <span class="dv">255</span><span class="op">;</span> <span class="co">// returns values between 0 and 1</span></span>
<span id="cb5-1568"><a href="#cb5-1568" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb5-1569"><a href="#cb5-1569" aria-hidden="true" tabindex="-1"></a><span class="kw">function</span> <span class="fu">textcolor</span>(content<span class="op">,</span> style <span class="op">=</span> {}) {</span>
<span id="cb5-1570"><a href="#cb5-1570" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> {</span>
<span id="cb5-1571"><a href="#cb5-1571" aria-hidden="true" tabindex="-1"></a>    background<span class="op">,</span></span>
<span id="cb5-1572"><a href="#cb5-1572" aria-hidden="true" tabindex="-1"></a>    color <span class="op">=</span> <span class="fu">yiq</span>(background) <span class="op">&gt;</span> <span class="fl">0.51</span> <span class="op">?</span> <span class="st">"#000"</span> <span class="op">:</span> <span class="st">"white"</span><span class="op">,</span></span>
<span id="cb5-1573"><a href="#cb5-1573" aria-hidden="true" tabindex="-1"></a>    padding <span class="op">=</span> <span class="st">"0 5px"</span><span class="op">,</span></span>
<span id="cb5-1574"><a href="#cb5-1574" aria-hidden="true" tabindex="-1"></a>    borderRadius <span class="op">=</span> <span class="st">"4px"</span><span class="op">,</span></span>
<span id="cb5-1575"><a href="#cb5-1575" aria-hidden="true" tabindex="-1"></a>    fontWeight <span class="op">=</span> <span class="dv">400</span><span class="op">,</span></span>
<span id="cb5-1576"><a href="#cb5-1576" aria-hidden="true" tabindex="-1"></a>    fontFamily <span class="op">=</span> <span class="st">"monospace"</span><span class="op">,</span></span>
<span id="cb5-1577"><a href="#cb5-1577" aria-hidden="true" tabindex="-1"></a>    <span class="op">...</span>rest</span>
<span id="cb5-1578"><a href="#cb5-1578" aria-hidden="true" tabindex="-1"></a>  } <span class="op">=</span> <span class="kw">typeof</span> style <span class="op">===</span> <span class="st">"string"</span> <span class="op">?</span> {<span class="dt">background</span><span class="op">:</span> style} <span class="op">:</span> style<span class="op">;</span></span>
<span id="cb5-1579"><a href="#cb5-1579" aria-hidden="true" tabindex="-1"></a>  <span class="cf">return</span> htl<span class="op">.</span><span class="fu">html</span><span class="vs">`&lt;span style=</span><span class="sc">${</span>{</span>
<span id="cb5-1580"><a href="#cb5-1580" aria-hidden="true" tabindex="-1"></a>    background<span class="op">,</span></span>
<span id="cb5-1581"><a href="#cb5-1581" aria-hidden="true" tabindex="-1"></a>    color<span class="op">,</span></span>
<span id="cb5-1582"><a href="#cb5-1582" aria-hidden="true" tabindex="-1"></a>    padding<span class="op">,</span></span>
<span id="cb5-1583"><a href="#cb5-1583" aria-hidden="true" tabindex="-1"></a>    borderRadius<span class="op">,</span></span>
<span id="cb5-1584"><a href="#cb5-1584" aria-hidden="true" tabindex="-1"></a>    fontWeight<span class="op">,</span></span>
<span id="cb5-1585"><a href="#cb5-1585" aria-hidden="true" tabindex="-1"></a>    fontFamily<span class="op">,</span></span>
<span id="cb5-1586"><a href="#cb5-1586" aria-hidden="true" tabindex="-1"></a>    <span class="op">...</span>rest</span>
<span id="cb5-1587"><a href="#cb5-1587" aria-hidden="true" tabindex="-1"></a>  }<span class="sc">}</span><span class="vs">&gt;</span><span class="sc">${</span>content<span class="sc">}</span><span class="vs">&lt;/span&gt;`</span><span class="op">;</span></span>
<span id="cb5-1588"><a href="#cb5-1588" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb5-1589"><a href="#cb5-1589" aria-hidden="true" tabindex="-1"></a>elapsed <span class="op">=</span> {</span>
<span id="cb5-1590"><a href="#cb5-1590" aria-hidden="true" tabindex="-1"></a>  <span class="kw">let</span> i <span class="op">=</span> <span class="dv">0</span><span class="op">;</span></span>
<span id="cb5-1591"><a href="#cb5-1591" aria-hidden="true" tabindex="-1"></a>  <span class="cf">while</span> (<span class="kw">true</span>) {</span>
<span id="cb5-1592"><a href="#cb5-1592" aria-hidden="true" tabindex="-1"></a>    <span class="kw">yield</span> Promises<span class="op">.</span><span class="fu">tick</span>(<span class="dv">864</span><span class="op">,</span> <span class="op">++</span>i)<span class="op">;</span></span>
<span id="cb5-1593"><a href="#cb5-1593" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb5-1594"><a href="#cb5-1594" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb5-1595"><a href="#cb5-1595" aria-hidden="true" tabindex="-1"></a>piecewiseColor <span class="op">=</span> d3<span class="op">.</span><span class="fu">piecewise</span>(d3<span class="op">.</span><span class="at">interpolateRgb</span><span class="op">,</span> [</span>
<span id="cb5-1596"><a href="#cb5-1596" aria-hidden="true" tabindex="-1"></a>  <span class="st">"#f00"</span><span class="op">,</span> <span class="co">// red</span></span>
<span id="cb5-1597"><a href="#cb5-1597" aria-hidden="true" tabindex="-1"></a>  <span class="st">"#f0f"</span><span class="op">,</span> <span class="co">// magenta</span></span>
<span id="cb5-1598"><a href="#cb5-1598" aria-hidden="true" tabindex="-1"></a>  <span class="st">"#a0f"</span><span class="op">,</span> <span class="co">// violet</span></span>
<span id="cb5-1599"><a href="#cb5-1599" aria-hidden="true" tabindex="-1"></a>  <span class="st">"#00f"</span><span class="op">,</span> <span class="co">// blue</span></span>
<span id="cb5-1600"><a href="#cb5-1600" aria-hidden="true" tabindex="-1"></a>  <span class="st">"#0af"</span><span class="op">,</span> <span class="co">// azure</span></span>
<span id="cb5-1601"><a href="#cb5-1601" aria-hidden="true" tabindex="-1"></a>  <span class="st">"#0ff"</span><span class="op">,</span> <span class="co">// cyan</span></span>
<span id="cb5-1602"><a href="#cb5-1602" aria-hidden="true" tabindex="-1"></a>  <span class="st">"#0f0"</span><span class="op">,</span> <span class="co">// green</span></span>
<span id="cb5-1603"><a href="#cb5-1603" aria-hidden="true" tabindex="-1"></a>  <span class="st">"#af0"</span><span class="op">,</span> <span class="co">// lime</span></span>
<span id="cb5-1604"><a href="#cb5-1604" aria-hidden="true" tabindex="-1"></a>  <span class="st">"#ff0"</span><span class="op">,</span> <span class="co">// yellow</span></span>
<span id="cb5-1605"><a href="#cb5-1605" aria-hidden="true" tabindex="-1"></a>  <span class="st">"#fa0"</span><span class="op">,</span> <span class="co">// orange</span></span>
<span id="cb5-1606"><a href="#cb5-1606" aria-hidden="true" tabindex="-1"></a>  <span class="st">"#f00"</span><span class="op">,</span> <span class="co">// red</span></span>
<span id="cb5-1607"><a href="#cb5-1607" aria-hidden="true" tabindex="-1"></a>])</span>
<span id="cb5-1608"><a href="#cb5-1608" aria-hidden="true" tabindex="-1"></a>slStr <span class="op">=</span> <span class="vs">`, 100%, 50%)`</span></span>
<span id="cb5-1609"><a href="#cb5-1609" aria-hidden="true" tabindex="-1"></a>elaTime <span class="op">=</span> elapsed <span class="op">%</span> <span class="fl">1e5</span></span>
<span id="cb5-1610"><a href="#cb5-1610" aria-hidden="true" tabindex="-1"></a>elaTimeHsl <span class="op">=</span> <span class="fu">textcolor</span>(elaTime<span class="op">,</span> <span class="vs">`hsl(</span><span class="sc">${</span>d3<span class="op">.</span><span class="fu">hsl</span>(<span class="fu">piecewiseColor</span>(elaTime <span class="op">%</span> <span class="dv">1000</span> <span class="op">/</span> <span class="dv">1000</span>))<span class="op">.</span><span class="at">h</span><span class="sc">}</span><span class="vs">`</span> <span class="op">+</span> slStr)</span>
<span id="cb5-1611"><a href="#cb5-1611" aria-hidden="true" tabindex="-1"></a>decMoty <span class="op">=</span> <span class="bu">Math</span><span class="op">.</span><span class="fu">floor</span>((<span class="dv">5</span> <span class="op">*</span> decDate <span class="op">+</span> <span class="dv">2</span>) <span class="op">/</span> <span class="dv">153</span>)</span>
<span id="cb5-1612"><a href="#cb5-1612" aria-hidden="true" tabindex="-1"></a>isoYear <span class="op">=</span> decYear <span class="op">+</span> (decMoty <span class="op">&gt;</span> <span class="dv">9</span>)</span>
<span id="cb5-1613"><a href="#cb5-1613" aria-hidden="true" tabindex="-1"></a>month <span class="op">=</span> decMoty <span class="op">&lt;</span> <span class="dv">10</span> <span class="op">?</span> decMoty <span class="op">+</span> <span class="dv">3</span> <span class="op">:</span> decMoty <span class="op">-</span> <span class="dv">9</span></span>
<span id="cb5-1614"><a href="#cb5-1614" aria-hidden="true" tabindex="-1"></a>decHour <span class="op">=</span> decTime <span class="op">*</span> <span class="dv">24</span></span>
<span id="cb5-1615"><a href="#cb5-1615" aria-hidden="true" tabindex="-1"></a>decMinute <span class="op">=</span> (decHour <span class="op">%</span> <span class="dv">1</span>) <span class="op">*</span> <span class="dv">60</span></span>
<span id="cb5-1616"><a href="#cb5-1616" aria-hidden="true" tabindex="-1"></a>decSecond <span class="op">=</span> (decMinute <span class="op">%</span> <span class="dv">1</span>) <span class="op">*</span> <span class="dv">60</span></span>
<span id="cb5-1617"><a href="#cb5-1617" aria-hidden="true" tabindex="-1"></a>isoHour <span class="op">=</span> <span class="bu">Math</span><span class="op">.</span><span class="fu">floor</span>(decHour)</span>
<span id="cb5-1618"><a href="#cb5-1618" aria-hidden="true" tabindex="-1"></a>isoMinute <span class="op">=</span> <span class="bu">Math</span><span class="op">.</span><span class="fu">floor</span>(decMinute)</span>
<span id="cb5-1619"><a href="#cb5-1619" aria-hidden="true" tabindex="-1"></a>isoSecond <span class="op">=</span> <span class="bu">Math</span><span class="op">.</span><span class="fu">floor</span>(decSecond)</span>
<span id="cb5-1620"><a href="#cb5-1620" aria-hidden="true" tabindex="-1"></a>decDek <span class="op">=</span> <span class="bu">Math</span><span class="op">.</span><span class="fu">floor</span>(decDate <span class="op">/</span> <span class="dv">10</span>)</span>
<span id="cb5-1621"><a href="#cb5-1621" aria-hidden="true" tabindex="-1"></a>decDod <span class="op">=</span> decDate <span class="op">%</span> <span class="dv">10</span></span>
<span id="cb5-1622"><a href="#cb5-1622" aria-hidden="true" tabindex="-1"></a>decDotm <span class="op">=</span> <span class="bu">Math</span><span class="op">.</span><span class="fu">floor</span>(decDate <span class="op">-</span> (<span class="dv">153</span> <span class="op">*</span> decMoty <span class="op">+</span> <span class="dv">2</span>) <span class="op">/</span> <span class="dv">5</span> <span class="op">+</span> <span class="dv">1</span>)</span>
<span id="cb5-1623"><a href="#cb5-1623" aria-hidden="true" tabindex="-1"></a>decDoty <span class="op">=</span> decDate<span class="op">.</span><span class="fu">toString</span>()<span class="op">.</span><span class="fu">padStart</span>(<span class="dv">3</span><span class="op">,</span> <span class="st">"0"</span>)</span>
<span id="cb5-1624"><a href="#cb5-1624" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb5-1625"><a href="#cb5-1625" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-1628"><a href="#cb5-1628" aria-hidden="true" tabindex="-1"></a><span class="in">```{ojs}</span></span>
<span id="cb5-1629"><a href="#cb5-1629" aria-hidden="true" tabindex="-1"></a><span class="co">//| echo: false</span></span>
<span id="cb5-1630"><a href="#cb5-1630" aria-hidden="true" tabindex="-1"></a><span class="co">//| output: false</span></span>
<span id="cb5-1631"><a href="#cb5-1631" aria-hidden="true" tabindex="-1"></a><span class="fu">html</span><span class="vs">`</span></span>
<span id="cb5-1632"><a href="#cb5-1632" aria-hidden="true" tabindex="-1"></a><span class="vs">&lt;style&gt;</span></span>
<span id="cb5-1633"><a href="#cb5-1633" aria-hidden="true" tabindex="-1"></a><span class="vs">.color0 {</span></span>
<span id="cb5-1634"><a href="#cb5-1634" aria-hidden="true" tabindex="-1"></a><span class="vs">  background: hsl(0 100% 50%);</span></span>
<span id="cb5-1635"><a href="#cb5-1635" aria-hidden="true" tabindex="-1"></a><span class="vs">  color: </span><span class="sc">${</span><span class="fu">yiq</span>(<span class="vs">`hsl(0, 100%, 50%)`</span>) <span class="op">&gt;</span> <span class="fl">0.51</span> <span class="op">?</span> <span class="st">"black"</span> <span class="op">:</span> <span class="st">"white"</span><span class="sc">}</span><span class="vs">;</span></span>
<span id="cb5-1636"><a href="#cb5-1636" aria-hidden="true" tabindex="-1"></a><span class="vs">  padding: 0px 5px;</span></span>
<span id="cb5-1637"><a href="#cb5-1637" aria-hidden="true" tabindex="-1"></a><span class="vs">  border-radius: 4px;</span></span>
<span id="cb5-1638"><a href="#cb5-1638" aria-hidden="true" tabindex="-1"></a><span class="vs">  font-weight: 400;</span></span>
<span id="cb5-1639"><a href="#cb5-1639" aria-hidden="true" tabindex="-1"></a><span class="vs">  font-family: monospace;</span></span>
<span id="cb5-1640"><a href="#cb5-1640" aria-hidden="true" tabindex="-1"></a><span class="vs">}</span></span>
<span id="cb5-1641"><a href="#cb5-1641" aria-hidden="true" tabindex="-1"></a><span class="vs">.color1 {</span></span>
<span id="cb5-1642"><a href="#cb5-1642" aria-hidden="true" tabindex="-1"></a><span class="vs">  background: hsl(300 100% 50%);</span></span>
<span id="cb5-1643"><a href="#cb5-1643" aria-hidden="true" tabindex="-1"></a><span class="vs">  color: </span><span class="sc">${</span><span class="fu">yiq</span>(<span class="vs">`hsl(300, 100%, 50%)`</span>) <span class="op">&gt;</span> <span class="fl">0.51</span> <span class="op">?</span> <span class="st">"black"</span> <span class="op">:</span> <span class="st">"white"</span><span class="sc">}</span><span class="vs">;</span></span>
<span id="cb5-1644"><a href="#cb5-1644" aria-hidden="true" tabindex="-1"></a><span class="vs">  padding: 0px 5px;</span></span>
<span id="cb5-1645"><a href="#cb5-1645" aria-hidden="true" tabindex="-1"></a><span class="vs">  border-radius: 4px;</span></span>
<span id="cb5-1646"><a href="#cb5-1646" aria-hidden="true" tabindex="-1"></a><span class="vs">  font-weight: 400;</span></span>
<span id="cb5-1647"><a href="#cb5-1647" aria-hidden="true" tabindex="-1"></a><span class="vs">  font-family: monospace;</span></span>
<span id="cb5-1648"><a href="#cb5-1648" aria-hidden="true" tabindex="-1"></a><span class="vs">}</span></span>
<span id="cb5-1649"><a href="#cb5-1649" aria-hidden="true" tabindex="-1"></a><span class="vs">.color2 {</span></span>
<span id="cb5-1650"><a href="#cb5-1650" aria-hidden="true" tabindex="-1"></a><span class="vs">  background: hsl(280 100% 50%);</span></span>
<span id="cb5-1651"><a href="#cb5-1651" aria-hidden="true" tabindex="-1"></a><span class="vs">  color: </span><span class="sc">${</span><span class="fu">yiq</span>(<span class="vs">`hsl(280, 100%, 50%)`</span>) <span class="op">&gt;</span> <span class="fl">0.51</span> <span class="op">?</span> <span class="st">"black"</span> <span class="op">:</span> <span class="st">"white"</span><span class="sc">}</span><span class="vs">;</span></span>
<span id="cb5-1652"><a href="#cb5-1652" aria-hidden="true" tabindex="-1"></a><span class="vs">  padding: 0px 5px;</span></span>
<span id="cb5-1653"><a href="#cb5-1653" aria-hidden="true" tabindex="-1"></a><span class="vs">  border-radius: 4px;</span></span>
<span id="cb5-1654"><a href="#cb5-1654" aria-hidden="true" tabindex="-1"></a><span class="vs">  font-weight: 400;</span></span>
<span id="cb5-1655"><a href="#cb5-1655" aria-hidden="true" tabindex="-1"></a><span class="vs">  font-family: monospace;</span></span>
<span id="cb5-1656"><a href="#cb5-1656" aria-hidden="true" tabindex="-1"></a><span class="vs">}</span></span>
<span id="cb5-1657"><a href="#cb5-1657" aria-hidden="true" tabindex="-1"></a><span class="vs">.color3 {</span></span>
<span id="cb5-1658"><a href="#cb5-1658" aria-hidden="true" tabindex="-1"></a><span class="vs">  background: hsl(240 100% 50%);</span></span>
<span id="cb5-1659"><a href="#cb5-1659" aria-hidden="true" tabindex="-1"></a><span class="vs">  color: </span><span class="sc">${</span><span class="fu">yiq</span>(<span class="vs">`hsl(240, 100%, 50%)`</span>) <span class="op">&gt;</span> <span class="fl">0.51</span> <span class="op">?</span> <span class="st">"black"</span> <span class="op">:</span> <span class="st">"white"</span><span class="sc">}</span><span class="vs">;</span></span>
<span id="cb5-1660"><a href="#cb5-1660" aria-hidden="true" tabindex="-1"></a><span class="vs">  padding: 0px 5px;</span></span>
<span id="cb5-1661"><a href="#cb5-1661" aria-hidden="true" tabindex="-1"></a><span class="vs">  border-radius: 4px;</span></span>
<span id="cb5-1662"><a href="#cb5-1662" aria-hidden="true" tabindex="-1"></a><span class="vs">  font-weight: 400;</span></span>
<span id="cb5-1663"><a href="#cb5-1663" aria-hidden="true" tabindex="-1"></a><span class="vs">  font-family: monospace;</span></span>
<span id="cb5-1664"><a href="#cb5-1664" aria-hidden="true" tabindex="-1"></a><span class="vs">}</span></span>
<span id="cb5-1665"><a href="#cb5-1665" aria-hidden="true" tabindex="-1"></a><span class="vs">.color4 {</span></span>
<span id="cb5-1666"><a href="#cb5-1666" aria-hidden="true" tabindex="-1"></a><span class="vs">  background: hsl(200 100% 50%);</span></span>
<span id="cb5-1667"><a href="#cb5-1667" aria-hidden="true" tabindex="-1"></a><span class="vs">  color: </span><span class="sc">${</span><span class="fu">yiq</span>(<span class="vs">`hsl(200, 100%, 50%)`</span>) <span class="op">&gt;</span> <span class="fl">0.51</span> <span class="op">?</span> <span class="st">"black"</span> <span class="op">:</span> <span class="st">"white"</span><span class="sc">}</span><span class="vs">;</span></span>
<span id="cb5-1668"><a href="#cb5-1668" aria-hidden="true" tabindex="-1"></a><span class="vs">  padding: 0px 5px;</span></span>
<span id="cb5-1669"><a href="#cb5-1669" aria-hidden="true" tabindex="-1"></a><span class="vs">  border-radius: 4px;</span></span>
<span id="cb5-1670"><a href="#cb5-1670" aria-hidden="true" tabindex="-1"></a><span class="vs">  font-weight: 400;</span></span>
<span id="cb5-1671"><a href="#cb5-1671" aria-hidden="true" tabindex="-1"></a><span class="vs">  font-family: monospace;</span></span>
<span id="cb5-1672"><a href="#cb5-1672" aria-hidden="true" tabindex="-1"></a><span class="vs">}</span></span>
<span id="cb5-1673"><a href="#cb5-1673" aria-hidden="true" tabindex="-1"></a><span class="vs">.color5 {</span></span>
<span id="cb5-1674"><a href="#cb5-1674" aria-hidden="true" tabindex="-1"></a><span class="vs">  background: hsl(180 100% 50%);</span></span>
<span id="cb5-1675"><a href="#cb5-1675" aria-hidden="true" tabindex="-1"></a><span class="vs">  color: </span><span class="sc">${</span><span class="fu">yiq</span>(<span class="vs">`hsl(180, 100%, 50%)`</span>) <span class="op">&gt;</span> <span class="fl">0.51</span> <span class="op">?</span> <span class="st">"black"</span> <span class="op">:</span> <span class="st">"white"</span><span class="sc">}</span><span class="vs">;</span></span>
<span id="cb5-1676"><a href="#cb5-1676" aria-hidden="true" tabindex="-1"></a><span class="vs">  padding: 0px 5px;</span></span>
<span id="cb5-1677"><a href="#cb5-1677" aria-hidden="true" tabindex="-1"></a><span class="vs">  border-radius: 4px;</span></span>
<span id="cb5-1678"><a href="#cb5-1678" aria-hidden="true" tabindex="-1"></a><span class="vs">  font-weight: 400;</span></span>
<span id="cb5-1679"><a href="#cb5-1679" aria-hidden="true" tabindex="-1"></a><span class="vs">  font-family: monospace;</span></span>
<span id="cb5-1680"><a href="#cb5-1680" aria-hidden="true" tabindex="-1"></a><span class="vs">}</span></span>
<span id="cb5-1681"><a href="#cb5-1681" aria-hidden="true" tabindex="-1"></a><span class="vs">.color6 {</span></span>
<span id="cb5-1682"><a href="#cb5-1682" aria-hidden="true" tabindex="-1"></a><span class="vs">  background: hsl(120 100% 50%);</span></span>
<span id="cb5-1683"><a href="#cb5-1683" aria-hidden="true" tabindex="-1"></a><span class="vs">  color: </span><span class="sc">${</span><span class="fu">yiq</span>(<span class="vs">`hsl(120, 100%, 50%)`</span>) <span class="op">&gt;</span> <span class="fl">0.51</span> <span class="op">?</span> <span class="st">"black"</span> <span class="op">:</span> <span class="st">"white"</span><span class="sc">}</span><span class="vs">;</span></span>
<span id="cb5-1684"><a href="#cb5-1684" aria-hidden="true" tabindex="-1"></a><span class="vs">  padding: 0px 5px;</span></span>
<span id="cb5-1685"><a href="#cb5-1685" aria-hidden="true" tabindex="-1"></a><span class="vs">  border-radius: 4px;</span></span>
<span id="cb5-1686"><a href="#cb5-1686" aria-hidden="true" tabindex="-1"></a><span class="vs">  font-weight: 400;</span></span>
<span id="cb5-1687"><a href="#cb5-1687" aria-hidden="true" tabindex="-1"></a><span class="vs">  font-family: monospace;</span></span>
<span id="cb5-1688"><a href="#cb5-1688" aria-hidden="true" tabindex="-1"></a><span class="vs">}</span></span>
<span id="cb5-1689"><a href="#cb5-1689" aria-hidden="true" tabindex="-1"></a><span class="vs">.color7 {</span></span>
<span id="cb5-1690"><a href="#cb5-1690" aria-hidden="true" tabindex="-1"></a><span class="vs">  background: hsl(80 100% 50%);</span></span>
<span id="cb5-1691"><a href="#cb5-1691" aria-hidden="true" tabindex="-1"></a><span class="vs">  color: </span><span class="sc">${</span><span class="fu">yiq</span>(<span class="vs">`hsl(80, 100%, 50%)`</span>) <span class="op">&gt;</span> <span class="fl">0.51</span> <span class="op">?</span> <span class="st">"black"</span> <span class="op">:</span> <span class="st">"white"</span><span class="sc">}</span><span class="vs">;</span></span>
<span id="cb5-1692"><a href="#cb5-1692" aria-hidden="true" tabindex="-1"></a><span class="vs">  padding: 0px 5px;</span></span>
<span id="cb5-1693"><a href="#cb5-1693" aria-hidden="true" tabindex="-1"></a><span class="vs">  border-radius: 4px;</span></span>
<span id="cb5-1694"><a href="#cb5-1694" aria-hidden="true" tabindex="-1"></a><span class="vs">  font-weight: 400;</span></span>
<span id="cb5-1695"><a href="#cb5-1695" aria-hidden="true" tabindex="-1"></a><span class="vs">  font-family: monospace;</span></span>
<span id="cb5-1696"><a href="#cb5-1696" aria-hidden="true" tabindex="-1"></a><span class="vs">}</span></span>
<span id="cb5-1697"><a href="#cb5-1697" aria-hidden="true" tabindex="-1"></a><span class="vs">.color8 {</span></span>
<span id="cb5-1698"><a href="#cb5-1698" aria-hidden="true" tabindex="-1"></a><span class="vs">  background: hsl(60 100% 50%);</span></span>
<span id="cb5-1699"><a href="#cb5-1699" aria-hidden="true" tabindex="-1"></a><span class="vs">  color: </span><span class="sc">${</span><span class="fu">yiq</span>(<span class="vs">`hsl(60, 100%, 50%)`</span>) <span class="op">&gt;</span> <span class="fl">0.51</span> <span class="op">?</span> <span class="st">"black"</span> <span class="op">:</span> <span class="st">"white"</span><span class="sc">}</span><span class="vs">;</span></span>
<span id="cb5-1700"><a href="#cb5-1700" aria-hidden="true" tabindex="-1"></a><span class="vs">  padding: 0px 5px;</span></span>
<span id="cb5-1701"><a href="#cb5-1701" aria-hidden="true" tabindex="-1"></a><span class="vs">  border-radius: 4px;</span></span>
<span id="cb5-1702"><a href="#cb5-1702" aria-hidden="true" tabindex="-1"></a><span class="vs">  font-weight: 400;</span></span>
<span id="cb5-1703"><a href="#cb5-1703" aria-hidden="true" tabindex="-1"></a><span class="vs">  font-family: monospace;</span></span>
<span id="cb5-1704"><a href="#cb5-1704" aria-hidden="true" tabindex="-1"></a><span class="vs">}</span></span>
<span id="cb5-1705"><a href="#cb5-1705" aria-hidden="true" tabindex="-1"></a><span class="vs">.color9 {</span></span>
<span id="cb5-1706"><a href="#cb5-1706" aria-hidden="true" tabindex="-1"></a><span class="vs">  background: hsl(40 100% 50%);</span></span>
<span id="cb5-1707"><a href="#cb5-1707" aria-hidden="true" tabindex="-1"></a><span class="vs">  color: </span><span class="sc">${</span><span class="fu">yiq</span>(<span class="vs">`hsl(40, 100%, 50%)`</span>) <span class="op">&gt;</span> <span class="fl">0.51</span> <span class="op">?</span> <span class="st">"black"</span> <span class="op">:</span> <span class="st">"white"</span><span class="sc">}</span><span class="vs">;</span></span>
<span id="cb5-1708"><a href="#cb5-1708" aria-hidden="true" tabindex="-1"></a><span class="vs">  padding: 0px 5px;</span></span>
<span id="cb5-1709"><a href="#cb5-1709" aria-hidden="true" tabindex="-1"></a><span class="vs">  border-radius: 4px;</span></span>
<span id="cb5-1710"><a href="#cb5-1710" aria-hidden="true" tabindex="-1"></a><span class="vs">  font-weight: 400;</span></span>
<span id="cb5-1711"><a href="#cb5-1711" aria-hidden="true" tabindex="-1"></a><span class="vs">  font-family: monospace;</span></span>
<span id="cb5-1712"><a href="#cb5-1712" aria-hidden="true" tabindex="-1"></a><span class="vs">}</span></span>
<span id="cb5-1713"><a href="#cb5-1713" aria-hidden="true" tabindex="-1"></a><span class="vs">&lt;/style&gt;</span></span>
<span id="cb5-1714"><a href="#cb5-1714" aria-hidden="true" tabindex="-1"></a><span class="vs">`</span></span>
<span id="cb5-1715"><a href="#cb5-1715" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb5-1716"><a href="#cb5-1716" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-1717"><a href="#cb5-1717" aria-hidden="true" tabindex="-1"></a><span class="in">```{=html}</span></span>
<span id="cb5-1718"><a href="#cb5-1718" aria-hidden="true" tabindex="-1"></a><span class="in">&lt;style&gt;</span></span>
<span id="cb5-1719"><a href="#cb5-1719" aria-hidden="true" tabindex="-1"></a><span class="in">#barClock {</span></span>
<span id="cb5-1720"><a href="#cb5-1720" aria-hidden="true" tabindex="-1"></a><span class="in">  width: 98%;</span></span>
<span id="cb5-1721"><a href="#cb5-1721" aria-hidden="true" tabindex="-1"></a><span class="in">  overflow: visible;</span></span>
<span id="cb5-1722"><a href="#cb5-1722" aria-hidden="true" tabindex="-1"></a><span class="in">}</span></span>
<span id="cb5-1723"><a href="#cb5-1723" aria-hidden="true" tabindex="-1"></a><span class="in">.tickLabel, .tickLabel1, .tickLabel2, .timeLabel {</span></span>
<span id="cb5-1724"><a href="#cb5-1724" aria-hidden="true" tabindex="-1"></a><span class="in">  fill: #000;</span></span>
<span id="cb5-1725"><a href="#cb5-1725" aria-hidden="true" tabindex="-1"></a><span class="in">  font-family: monospace;</span></span>
<span id="cb5-1726"><a href="#cb5-1726" aria-hidden="true" tabindex="-1"></a><span class="in">  text-anchor: middle;</span></span>
<span id="cb5-1727"><a href="#cb5-1727" aria-hidden="true" tabindex="-1"></a><span class="in">}</span></span>
<span id="cb5-1728"><a href="#cb5-1728" aria-hidden="true" tabindex="-1"></a><span class="in">.timeLabel {</span></span>
<span id="cb5-1729"><a href="#cb5-1729" aria-hidden="true" tabindex="-1"></a><span class="in">  text-anchor: start;</span></span>
<span id="cb5-1730"><a href="#cb5-1730" aria-hidden="true" tabindex="-1"></a><span class="in">}</span></span>
<span id="cb5-1731"><a href="#cb5-1731" aria-hidden="true" tabindex="-1"></a><span class="in">.timeBar, .timeBarFull, .timeBarFullN {</span></span>
<span id="cb5-1732"><a href="#cb5-1732" aria-hidden="true" tabindex="-1"></a><span class="in">  x: 1px;</span></span>
<span id="cb5-1733"><a href="#cb5-1733" aria-hidden="true" tabindex="-1"></a><span class="in">  height: 25px;</span></span>
<span id="cb5-1734"><a href="#cb5-1734" aria-hidden="true" tabindex="-1"></a><span class="in">  rx: 5px;</span></span>
<span id="cb5-1735"><a href="#cb5-1735" aria-hidden="true" tabindex="-1"></a><span class="in">  stroke: #aaa;</span></span>
<span id="cb5-1736"><a href="#cb5-1736" aria-hidden="true" tabindex="-1"></a><span class="in">}</span></span>
<span id="cb5-1737"><a href="#cb5-1737" aria-hidden="true" tabindex="-1"></a><span class="in">.timeBar {</span></span>
<span id="cb5-1738"><a href="#cb5-1738" aria-hidden="true" tabindex="-1"></a><span class="in">  fill: #e8e8e8;</span></span>
<span id="cb5-1739"><a href="#cb5-1739" aria-hidden="true" tabindex="-1"></a><span class="in">}</span></span>
<span id="cb5-1740"><a href="#cb5-1740" aria-hidden="true" tabindex="-1"></a><span class="in">.timeBarFull {</span></span>
<span id="cb5-1741"><a href="#cb5-1741" aria-hidden="true" tabindex="-1"></a><span class="in">  fill: #ccffff;</span></span>
<span id="cb5-1742"><a href="#cb5-1742" aria-hidden="true" tabindex="-1"></a><span class="in">}</span></span>
<span id="cb5-1743"><a href="#cb5-1743" aria-hidden="true" tabindex="-1"></a><span class="in">.timeBarFullN {</span></span>
<span id="cb5-1744"><a href="#cb5-1744" aria-hidden="true" tabindex="-1"></a><span class="in">  fill: #ffcccc;</span></span>
<span id="cb5-1745"><a href="#cb5-1745" aria-hidden="true" tabindex="-1"></a><span class="in">}</span></span>
<span id="cb5-1746"><a href="#cb5-1746" aria-hidden="true" tabindex="-1"></a><span class="in">.background {</span></span>
<span id="cb5-1747"><a href="#cb5-1747" aria-hidden="true" tabindex="-1"></a><span class="in">  fill: white;</span></span>
<span id="cb5-1748"><a href="#cb5-1748" aria-hidden="true" tabindex="-1"></a><span class="in">}</span></span>
<span id="cb5-1749"><a href="#cb5-1749" aria-hidden="true" tabindex="-1"></a><span class="in">.tickDek, .tickDotd, .tickDotd1, .tickC, .tickC1, .tickM, .tickM1, .tickB, .tickB1 {</span></span>
<span id="cb5-1750"><a href="#cb5-1750" aria-hidden="true" tabindex="-1"></a><span class="in">  stroke: none;</span></span>
<span id="cb5-1751"><a href="#cb5-1751" aria-hidden="true" tabindex="-1"></a><span class="in">  fill: #666;</span></span>
<span id="cb5-1752"><a href="#cb5-1752" aria-hidden="true" tabindex="-1"></a><span class="in">  width: 1px;</span></span>
<span id="cb5-1753"><a href="#cb5-1753" aria-hidden="true" tabindex="-1"></a><span class="in">}</span></span>
<span id="cb5-1754"><a href="#cb5-1754" aria-hidden="true" tabindex="-1"></a><span class="in">#clock {</span></span>
<span id="cb5-1755"><a href="#cb5-1755" aria-hidden="true" tabindex="-1"></a><span class="in">  stroke: #000;</span></span>
<span id="cb5-1756"><a href="#cb5-1756" aria-hidden="true" tabindex="-1"></a><span class="in">  font-family: "HelveticaNeue-Light", "Helvetica Neue Light", "Helvetica Neue", Helvetica, Arial, "Lucida Grande", sans-serif;</span></span>
<span id="cb5-1757"><a href="#cb5-1757" aria-hidden="true" tabindex="-1"></a><span class="in">}</span></span>
<span id="cb5-1758"><a href="#cb5-1758" aria-hidden="true" tabindex="-1"></a><span class="in">#clock #rim {</span></span>
<span id="cb5-1759"><a href="#cb5-1759" aria-hidden="true" tabindex="-1"></a><span class="in">  fill: none;</span></span>
<span id="cb5-1760"><a href="#cb5-1760" aria-hidden="true" tabindex="-1"></a><span class="in">  stroke: #999;</span></span>
<span id="cb5-1761"><a href="#cb5-1761" aria-hidden="true" tabindex="-1"></a><span class="in">  stroke-width: 3px;</span></span>
<span id="cb5-1762"><a href="#cb5-1762" aria-hidden="true" tabindex="-1"></a><span class="in">}</span></span>
<span id="cb5-1763"><a href="#cb5-1763" aria-hidden="true" tabindex="-1"></a><span class="in">#clock .second-hand {</span></span>
<span id="cb5-1764"><a href="#cb5-1764" aria-hidden="true" tabindex="-1"></a><span class="in">  stroke-width: 3;</span></span>
<span id="cb5-1765"><a href="#cb5-1765" aria-hidden="true" tabindex="-1"></a><span class="in">}</span></span>
<span id="cb5-1766"><a href="#cb5-1766" aria-hidden="true" tabindex="-1"></a><span class="in">#clock .minute-hand {</span></span>
<span id="cb5-1767"><a href="#cb5-1767" aria-hidden="true" tabindex="-1"></a><span class="in">  stroke-width: 8;</span></span>
<span id="cb5-1768"><a href="#cb5-1768" aria-hidden="true" tabindex="-1"></a><span class="in">  stroke-linecap: round;</span></span>
<span id="cb5-1769"><a href="#cb5-1769" aria-hidden="true" tabindex="-1"></a><span class="in">}</span></span>
<span id="cb5-1770"><a href="#cb5-1770" aria-hidden="true" tabindex="-1"></a><span class="in">#clock .hour-hand {</span></span>
<span id="cb5-1771"><a href="#cb5-1771" aria-hidden="true" tabindex="-1"></a><span class="in">  stroke-width: 12;</span></span>
<span id="cb5-1772"><a href="#cb5-1772" aria-hidden="true" tabindex="-1"></a><span class="in">  stroke-linecap: round;</span></span>
<span id="cb5-1773"><a href="#cb5-1773" aria-hidden="true" tabindex="-1"></a><span class="in">}</span></span>
<span id="cb5-1774"><a href="#cb5-1774" aria-hidden="true" tabindex="-1"></a><span class="in">#clock .hands-cover {</span></span>
<span id="cb5-1775"><a href="#cb5-1775" aria-hidden="true" tabindex="-1"></a><span class="in">  stroke-width: 3;</span></span>
<span id="cb5-1776"><a href="#cb5-1776" aria-hidden="true" tabindex="-1"></a><span class="in">  fill: #fff;</span></span>
<span id="cb5-1777"><a href="#cb5-1777" aria-hidden="true" tabindex="-1"></a><span class="in">}</span></span>
<span id="cb5-1778"><a href="#cb5-1778" aria-hidden="true" tabindex="-1"></a><span class="in">#clock .second-tick {</span></span>
<span id="cb5-1779"><a href="#cb5-1779" aria-hidden="true" tabindex="-1"></a><span class="in">  stroke-width: 3;</span></span>
<span id="cb5-1780"><a href="#cb5-1780" aria-hidden="true" tabindex="-1"></a><span class="in">  fill: #000;</span></span>
<span id="cb5-1781"><a href="#cb5-1781" aria-hidden="true" tabindex="-1"></a><span class="in">}</span></span>
<span id="cb5-1782"><a href="#cb5-1782" aria-hidden="true" tabindex="-1"></a><span class="in">#clock .hour-tick {</span></span>
<span id="cb5-1783"><a href="#cb5-1783" aria-hidden="true" tabindex="-1"></a><span class="in">  stroke-width: 8; // same as the minute hand</span></span>
<span id="cb5-1784"><a href="#cb5-1784" aria-hidden="true" tabindex="-1"></a><span class="in">}</span></span>
<span id="cb5-1785"><a href="#cb5-1785" aria-hidden="true" tabindex="-1"></a><span class="in">#clock .second-label {</span></span>
<span id="cb5-1786"><a href="#cb5-1786" aria-hidden="true" tabindex="-1"></a><span class="in">  font-size: 18px;</span></span>
<span id="cb5-1787"><a href="#cb5-1787" aria-hidden="true" tabindex="-1"></a><span class="in">}</span></span>
<span id="cb5-1788"><a href="#cb5-1788" aria-hidden="true" tabindex="-1"></a><span class="in">#clock .hour-label {</span></span>
<span id="cb5-1789"><a href="#cb5-1789" aria-hidden="true" tabindex="-1"></a><span class="in">  font-size: 32px</span></span>
<span id="cb5-1790"><a href="#cb5-1790" aria-hidden="true" tabindex="-1"></a><span class="in">}</span></span>
<span id="cb5-1791"><a href="#cb5-1791" aria-hidden="true" tabindex="-1"></a><span class="in">.clocks * {</span></span>
<span id="cb5-1792"><a href="#cb5-1792" aria-hidden="true" tabindex="-1"></a><span class="in">  margin: -10px 0px 10px 0px;</span></span>
<span id="cb5-1793"><a href="#cb5-1793" aria-hidden="true" tabindex="-1"></a><span class="in">  padding: 0px;</span></span>
<span id="cb5-1794"><a href="#cb5-1794" aria-hidden="true" tabindex="-1"></a><span class="in">}</span></span>
<span id="cb5-1795"><a href="#cb5-1795" aria-hidden="true" tabindex="-1"></a><span class="in">#title-block-header &gt; div:nth-child(2) {</span></span>
<span id="cb5-1796"><a href="#cb5-1796" aria-hidden="true" tabindex="-1"></a><span class="in">  display: none;</span></span>
<span id="cb5-1797"><a href="#cb5-1797" aria-hidden="true" tabindex="-1"></a><span class="in">}</span></span>
<span id="cb5-1798"><a href="#cb5-1798" aria-hidden="true" tabindex="-1"></a><span class="in">h4.hiddenheading, h5.hiddenheading {</span></span>
<span id="cb5-1799"><a href="#cb5-1799" aria-hidden="true" tabindex="-1"></a><span class="in">  display: none;</span></span>
<span id="cb5-1800"><a href="#cb5-1800" aria-hidden="true" tabindex="-1"></a><span class="in">}</span></span>
<span id="cb5-1801"><a href="#cb5-1801" aria-hidden="true" tabindex="-1"></a><span class="in">&lt;/style&gt;</span></span>
<span id="cb5-1802"><a href="#cb5-1802" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
</code><button title="Copy to Clipboard" class="code-copy-button" data-in-quarto-modal=""><i class="bi"></i></button></pre></div>
</div></div></div></div></div>
</div> <!-- /content -->
<footer class="footer">
  <div class="nav-footer">
    <div class="nav-footer-left">
<p>© Copyright 2025, Martin Laptev</p>
</div>   
    <div class="nav-footer-center">
      &nbsp;
    <div class="toc-actions d-sm-block d-md-none"><ul><li><a href="https://github.com/maptv/maptv.github.io/blob/main/dec/time/index.qmd" class="toc-action"><i class="bi bi-github"></i>View source</a></li></ul></div></div>
    <div class="nav-footer-right">
      <ul class="footer-items list-unstyled">
    <li class="nav-item compact">
    <a class="nav-link" href="https://github.com/maptv" target="_blank">
      <i class="bi bi-github" role="img">
</i> 
    </a>
  </li>  
    <li class="nav-item compact">
    <a class="nav-link" href="https://linkedin.com/in/maptv" target="_blank">
      <i class="bi bi-linkedin" role="img">
</i> 
    </a>
  </li>  
    <li class="nav-item compact">
    <a class="nav-link active" href="mailto:maptv@ireni.co" aria-current="page">
      <i class="bi bi-envelope-at" role="img">
</i> 
    </a>
  </li>  
</ul>
    </div>
  </div>
</footer>




</body></html>