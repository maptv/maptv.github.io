<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.6.39">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">

<meta name="author" content="Martin Laptev">
<meta name="description" content="Introducing Declock, a timekeeping system that displays time in decimal days using math notation without the need for hours, minutes, or seconds.">

<title>Martin Laptev</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { display: inline-block; text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="../../site_libs/quarto-nav/quarto-nav.js"></script>
<script src="../../site_libs/quarto-nav/headroom.min.js"></script>
<script src="../../site_libs/clipboard/clipboard.min.js"></script>
<script src="../../site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="../../site_libs/quarto-search/fuse.min.js"></script>
<script src="../../site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="../../">
<link href="../../dec/iso/index.html" rel="next">
<link href="../../dec/date/index.html" rel="prev">
<link href="../../asset/deidek.svg" rel="icon" type="image/svg+xml">
<script src="../../site_libs/quarto-html/quarto.js"></script>
<script src="../../site_libs/quarto-html/popper.min.js"></script>
<script src="../../site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="../../site_libs/quarto-html/anchor.min.js"></script>
<link href="../../site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="../../site_libs/quarto-html/quarto-syntax-highlighting-20779428d464842b64dc11664170543a.css" rel="stylesheet" class="quarto-color-scheme" id="quarto-text-highlighting-styles">
<link href="../../site_libs/quarto-html/quarto-syntax-highlighting-dark-e17136ee4fef986afe6fcd47ea206205.css" rel="prefetch" class="quarto-color-scheme quarto-color-alternate" id="quarto-text-highlighting-styles">
<script src="../../site_libs/bootstrap/bootstrap.min.js"></script>
<link href="../../site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="../../site_libs/bootstrap/bootstrap-8316c49fe2a81c99529bf8d9d7d04741.min.css" rel="stylesheet" append-hash="true" class="quarto-color-scheme" id="quarto-bootstrap" data-mode="light">
<link href="../../site_libs/bootstrap/bootstrap-dark-e0e7980872e598fc7b43390909962808.min.css" rel="prefetch" append-hash="true" class="quarto-color-scheme quarto-color-alternate" id="quarto-bootstrap" data-mode="dark">
<script id="quarto-search-options" type="application/json">{
  "location": "sidebar",
  "copy-button": true,
  "collapse-after": 3,
  "panel-placement": "start",
  "type": "overlay",
  "limit": 50,
  "keyboard-shortcut": [
    "/",
    "?",
    "h",
    "f",
    "s"
  ],
  "show-item-context": true,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-text-placeholder": "",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>
<script type="module" src="../../site_libs/quarto-ojs/quarto-ojs-runtime.js"></script>
<link href="../../site_libs/quarto-ojs/quarto-ojs.css" rel="stylesheet">
<meta name="mermaid-theme" content="default">
<script src="../../site_libs/quarto-diagram/mermaid.min.js"></script>
<script src="../../site_libs/quarto-diagram/mermaid-init.js"></script>
<link href="../../site_libs/quarto-diagram/mermaid.css" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/polyfill/v3/polyfill.min.js?features=es6"></script>
  <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml-full.js" type="text/javascript"></script>

<script type="text/javascript">
const typesetMath = (el) => {
  if (window.MathJax) {
    // MathJax Typeset
    window.MathJax.typeset([el]);
  } else if (window.katex) {
    // KaTeX Render
    var mathElements = el.getElementsByClassName("math");
    var macros = [];
    for (var i = 0; i < mathElements.length; i++) {
      var texText = mathElements[i].firstChild;
      if (mathElements[i].tagName == "SPAN") {
        window.katex.render(texText.data, mathElements[i], {
          displayMode: mathElements[i].classList.contains('display'),
          throwOnError: false,
          macros: macros,
          fleqn: false
        });
      }
    }
  }
}
window.Quarto = {
  typesetMath
};
</script>

<link rel="stylesheet" href="../../asset/style.css">
<meta name="twitter:title" content="Martin Laptev">
<meta name="twitter:description" content="Introducing Declock, a timekeeping system that displays time in decimal days using math notation without the need for hours, minutes, or seconds.">
<meta name="twitter:image" content="https://maptv.github.io/asset/daywide.svg">
<meta name="twitter:card" content="summary_large_image">
</head>

<body class="nav-sidebar floating nav-fixed">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
    <nav class="navbar navbar-expand-lg " data-bs-theme="dark">
      <div class="navbar-container container-fluid">
      <div class="navbar-brand-container mx-auto">
    <a href="../../index.html" class="navbar-brand navbar-brand-logo">
    <img src="../../asset/deidek.svg" alt="" class="navbar-logo">
    </a>
    <a class="navbar-brand" href="../../index.html">
    <span class="navbar-title">Martin Laptev</span>
    </a>
  </div>
        <div class="quarto-navbar-tools tools-end">
  <a href="" class="quarto-color-scheme-toggle quarto-navigation-tool  px-1" onclick="window.quartoToggleColorScheme(); return false;" title="Toggle dark mode"><i class="bi"></i></a>
  <a href="" class="quarto-reader-toggle quarto-navigation-tool px-1" onclick="window.quartoToggleReader(); return false;" title="Toggle reader mode">
  <div class="quarto-reader-toggle-btn">
  <i class="bi"></i>
  </div>
</a>
</div>
      </div> <!-- /container-fluid -->
    </nav>
  <nav class="quarto-secondary-nav">
    <div class="container-fluid d-flex">
      <button type="button" class="quarto-btn-toggle btn" data-bs-toggle="collapse" role="button" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
        <i class="bi bi-layout-text-sidebar-reverse"></i>
      </button>
        <nav class="quarto-page-breadcrumbs" aria-label="breadcrumb"><ol class="breadcrumb"><li class="breadcrumb-item"><a href="../../dec/index.html">Dec</a></li><li class="breadcrumb-item"><a href="../../dec/time/index.html">Time</a></li></ol></nav>
        <a class="flex-grow-1" role="navigation" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">      
        </a>
      <button type="button" class="btn quarto-search-button" aria-label="Search" onclick="window.quartoOpenSearch();">
        <i class="bi bi-search"></i>
      </button>
    </div>
  </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-full page-navbar">
<!-- sidebar -->
  <nav id="quarto-sidebar" class="sidebar collapse collapse-horizontal quarto-sidebar-collapse-item sidebar-navigation floating overflow-auto">
        <div class="sidebar-tools-main tools-wide">
    <a href="https://www.github.com/maptv" title="" class="quarto-navigation-tool px-1" aria-label="" target="_blank"><i class="bi bi-github"></i></a>
    <a href="https://www.linkedin.com/in/maptv" title="" class="quarto-navigation-tool px-1" aria-label="" target="_blank"><i class="bi bi-linkedin"></i></a>
    <a href="mailto:maptv@engineer.com" title="" class="quarto-navigation-tool px-1" aria-label=""><i class="bi bi-envelope-at"></i></a>
    <div id="quarto-search" class="quarto-navigation-tool px-1" title="Search"></div>
</div>
    <div class="sidebar-menu-container"> 
    <ul class="list-unstyled mt-1">
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../index.html" class="sidebar-item-text sidebar-link"><i class="bi bi-house-door" role="img">
</i> 
 <span class="menu-text">Home</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../about/index.html" class="sidebar-item-text sidebar-link"><i class="bi bi-info-circle" role="img">
</i> 
 <span class="menu-text">About</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../cv/index.html" class="sidebar-item-text sidebar-link"><i class="bi bi-file-earmark-person" role="img">
</i> 
 <span class="menu-text">CV/R√©sum√©</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../list/index.html" class="sidebar-item-text sidebar-link"><i class="bi bi-grid-3x3-gap" role="img">
</i> 
 <span class="menu-text">Article List</span></a>
  </div>
</li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a href="../../dec/index.html" class="sidebar-item-text sidebar-link"><i class="bi bi-arrow-repeat" role="img">
</i> 
 <span class="menu-text">Dec</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-1" role="navigation" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-1" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../dec/date/index.html" class="sidebar-item-text sidebar-link"><i class="bi bi-calendar-date" role="img">
</i> 
 <span class="menu-text">Date</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../dec/time/index.html" class="sidebar-item-text sidebar-link active"><i class="bi bi-clock" role="img">
</i> 
 <span class="menu-text">Time</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../dec/iso/index.html" class="sidebar-item-text sidebar-link"><i class="bi bi-globe" role="img">
</i> 
 <span class="menu-text">ISO 8601</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../dec/snap/index.html" class="sidebar-item-text sidebar-link"><i class="bi bi-postage" role="img">
</i> 
 <span class="menu-text">Snap</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../dec/span/index.html" class="sidebar-item-text sidebar-link"><i class="bi bi-calendar-range" role="img">
</i> 
 <span class="menu-text">Span</span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-2" role="navigation" aria-expanded="true"><i class="bi bi-hourglass-split" role="img">
</i> 
 <span class="menu-text">History</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-2" role="navigation" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-2" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../history/ww2/index.html" class="sidebar-item-text sidebar-link"><i class="bi bi-2-square" role="img">
</i> 
 <span class="menu-text">World War 2</span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-3" role="navigation" aria-expanded="true"><i class="bi bi-robot" role="img">
</i> 
 <span class="menu-text">Machine Learning</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-3" role="navigation" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-3" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../ml/prob/index.html" class="sidebar-item-text sidebar-link"><i class="bi bi-dice-5" role="img">
</i> 
 <span class="menu-text">Probablity</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../ml/llm/index.html" class="sidebar-item-text sidebar-link"><i class="bi bi-translate" role="img">
</i> 
 <span class="menu-text">Language Models</span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-4" role="navigation" aria-expanded="true"><i class="bi bi-laptop" role="img">
</i> 
 <span class="menu-text">Software</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-4" role="navigation" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-4" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../software/git/index.html" class="sidebar-item-text sidebar-link"><i class="bi bi-git" role="img">
</i> 
 <span class="menu-text">Git</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../software/positron/index.html" class="sidebar-item-text sidebar-link"><i class="bi bi-p-square" role="img">
</i> 
 <span class="menu-text">Positron</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../software/jupyter/index.html" class="sidebar-item-text sidebar-link"><i class="bi bi-journal-richtext" role="img">
</i> 
 <span class="menu-text">Jupyter</span></a>
  </div>
</li>
          <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a href="../../quarto/index.html" class="sidebar-item-text sidebar-link"><i class="bi bi-markdown" role="img">
</i> 
 <span class="menu-text">Quarto</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-5" role="navigation" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-5" class="collapse list-unstyled sidebar-section depth2 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../quarto/filter/index.html" class="sidebar-item-text sidebar-link"><i class="bi bi-funnel" role="img">
</i> 
 <span class="menu-text">Filter</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../quarto/script/index.html" class="sidebar-item-text sidebar-link"><i class="bi bi-file-code" role="img">
</i> 
 <span class="menu-text">Script</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../quarto/include/index.html" class="sidebar-item-text sidebar-link"><i class="bi bi-file-earmark-plus" role="img">
</i> 
 <span class="menu-text">Include</span></a>
  </div>
</li>
      </ul>
  </li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../software/observable/index.html" class="sidebar-item-text sidebar-link"><i class="bi bi-0-circle" role="img">
</i> 
 <span class="menu-text">Observable</span></a>
  </div>
</li>
      </ul>
  </li>
    </ul>
    </div>
</nav>
<div id="quarto-sidebar-glass" class="quarto-sidebar-collapse-item" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item"></div>
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">On this page</h2>
   
  <ul>
  <li><a href="#time" id="toc-time" class="nav-link active" data-scroll-target="#time">Time</a></li>
  <li><a href="#zone" id="toc-zone" class="nav-link" data-scroll-target="#zone">Zone</a></li>
  <li><a href="#unit" id="toc-unit" class="nav-link" data-scroll-target="#unit">Unit</a></li>
  <li><a href="#next" id="toc-next" class="nav-link" data-scroll-target="#next">Next</a></li>
  <li><a href="#cite" id="toc-cite" class="nav-link" data-scroll-target="#cite">Cite</a></li>
  </ul>
<div class="toc-actions"><ul><li><a href="https://github.com/maptv/maptv.github.io/blob/main/dec/time/index.qmd" class="toc-action"><i class="bi bi-github"></i>View source</a></li></ul></div><div class="quarto-alternate-formats"><h2>Other Formats</h2><ul><li><a href="index.md"><i class="bi bi-file-code"></i>CommonMark</a></li></ul></div></nav>
    </div>
<!-- main -->
<main class="content column-body" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default"><nav class="quarto-page-breadcrumbs quarto-title-breadcrumbs d-none d-lg-block" aria-label="breadcrumb"><ol class="breadcrumb"><li class="breadcrumb-item"><a href="../../dec/index.html">Dec</a></li><li class="breadcrumb-item"><a href="../../dec/time/index.html">Time</a></li></ol></nav>
<div class="quarto-title">
<div class="quarto-title-block"><div><h1 class="title">Dec Time</h1><button type="button" class="btn code-tools-button" id="quarto-code-tools-source"><i class="bi"></i> Code</button></div></div>
</div>

<div>
  <div class="description">
    <p>Introducing Declock, a timekeeping system that displays time in decimal days using math notation without the need for hours, minutes, or seconds.</p>
  </div>
</div>


<div class="quarto-title-meta column-body">

    <div>
    <div class="quarto-title-meta-heading">Author</div>
    <div class="quarto-title-meta-contents">
             <p><a href="https://maptv.github.io">Martin Laptev</a> </p>
          </div>
  </div>
    
    <div>
    <div class="quarto-title-meta-heading">Published</div>
    <div class="quarto-title-meta-contents">
      <p class="date">2024+285</p>
    </div>
  </div>
  
    
  </div>
  


</header>


<section id="time" class="level4 hiddenheading">
<h4 class="hiddenheading anchored" data-anchor-id="time">Time</h4>
<p>My website provides many examples of the <a href="https://quarto.org">Quarto</a> publishing and the <a href="../../dec">Dec</a> measurement systems in action. I leverage Quarto support for the <a href="https://observablehq.com/">Observable</a> data analysis and visualization system to create animated and interactive graphics like the clocksüïìand barüìächarts below, which display a Dec time like the one on the left side of the <a href="https://en.wikipedia.org/wiki/Navigation_bar#:~:text=a%20section%20of%20a%20graphical%20user%20interface%20intended%20to%20aid%20visitors%20in%20accessing%20information">navigation bar</a> (navbar) above.</p>
<p>Dec times are measured in <a href="https://en.wikipedia.org/wiki/Decimal_time#Fractional_days:~:text=a%20decimal%20fraction%20of%20a%20day">fractional days</a>. The shortest, longest, and thinnest clocküïìhands and the top, middle, and bottom barsüìäindicate the <a href="https://en.wikipedia.org/wiki/Decimal_time#:~:text=dividing%20the%20day%20into%2010%20decidays" class="under tool" data-bs-toggle="tooltip" data-bs-title="tenths of a day">decidays</a>, <span class="under tool" data-bs-toggle="tooltip" data-bs-title="thousandths of a day">millidays</span>, and <span class="under tool" data-bs-toggle="tooltip" data-bs-title="hundred thousandths of a day">centimillidays</span>, respectively, of the time since the start, <span class="cyan"><span>+<span id="ojs-element-id-1"></span></span></span>, or until the end, <span class="pink"><span>-<span id="ojs-element-id-2"></span></span></span>, of the day in the Dec time zone, <span class="lime"><span><span id="ojs-element-id-3"></span></span></span>, selected by the red‚≠ïÔ∏ècircle on the <a href="https://en.wikipedia.org/wiki/Terminator_%28solar%29#:~:text=a%20moving%20line%20that%20divides%20the%20daylit%20side%20and%20the%20dark%20night%20side%20of%20a%20planetary%20body">solar‚òÄÔ∏èterminator</a> mapüó∫Ô∏èbeneath the barsüìä.</p>
<div class="clocks">
<p><span><span id="ojs-element-id-4"></span></span></p>
</div>
<div class="cell">
<div class="sourceCode cell-code hidden" id="cb1" data-startfrom="42" data-source-offset="-51"><pre class="sourceCode js code-with-copy"><code class="sourceCode javascript" style="counter-reset: source-line 41;"><span id="cb1-42"><a href="#cb1-42" aria-hidden="true" tabindex="-1"></a>barChart <span class="op">=</span> {</span>
<span id="cb1-43"><a href="#cb1-43" aria-hidden="true" tabindex="-1"></a><span class="kw">const</span> W <span class="op">=</span> width<span class="op">;</span></span>
<span id="cb1-44"><a href="#cb1-44" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> H <span class="op">=</span> <span class="dv">88</span><span class="op">;</span></span>
<span id="cb1-45"><a href="#cb1-45" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> barX <span class="op">=</span> <span class="dv">1</span><span class="op">;</span></span>
<span id="cb1-46"><a href="#cb1-46" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> firstBarY <span class="op">=</span> <span class="dv">1</span><span class="op">;</span></span>
<span id="cb1-47"><a href="#cb1-47" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> svg <span class="op">=</span> d3</span>
<span id="cb1-48"><a href="#cb1-48" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">create</span>(<span class="st">"svg"</span>)</span>
<span id="cb1-49"><a href="#cb1-49" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">"width"</span><span class="op">,</span> W)</span>
<span id="cb1-50"><a href="#cb1-50" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">"viewBox"</span><span class="op">,</span> [<span class="dv">0</span><span class="op">,</span> <span class="dv">0</span><span class="op">,</span> W <span class="op">*</span> (W <span class="op">&lt;</span> <span class="dv">370</span> <span class="op">?</span> <span class="op">.</span><span class="dv">73</span> <span class="op">:</span> W <span class="op">&lt;</span> <span class="dv">420</span> <span class="op">?</span> <span class="op">.</span><span class="dv">76</span> <span class="op">:</span> W <span class="op">&lt;</span> <span class="dv">470</span> <span class="op">?</span> <span class="op">.</span><span class="dv">79</span> <span class="op">:</span> W <span class="op">&lt;</span> <span class="dv">520</span> <span class="op">?</span> <span class="op">.</span><span class="dv">81</span> <span class="op">:</span> W <span class="op">&lt;</span> <span class="dv">570</span> <span class="op">?</span> <span class="op">.</span><span class="dv">83</span> <span class="op">:</span> W <span class="op">&lt;</span> <span class="dv">620</span> <span class="op">?</span> <span class="op">.</span><span class="dv">84</span> <span class="op">:</span> W <span class="op">&lt;</span> <span class="dv">670</span> <span class="op">?</span> <span class="op">.</span><span class="dv">85</span> <span class="op">:</span> W <span class="op">&lt;</span> <span class="dv">720</span> <span class="op">?</span> <span class="op">.</span><span class="dv">86</span> <span class="op">:</span> <span class="op">.</span><span class="dv">87</span>)<span class="op">,</span> H])<span class="op">;</span></span>
<span id="cb1-51"><a href="#cb1-51" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> xRange <span class="op">=</span> [<span class="dv">0</span><span class="op">,</span> W <span class="op">-</span> <span class="dv">100</span>]<span class="op">;</span></span>
<span id="cb1-52"><a href="#cb1-52" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> scaleDD <span class="op">=</span> d3<span class="op">.</span><span class="fu">scaleLinear</span>()</span>
<span id="cb1-53"><a href="#cb1-53" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">domain</span>([<span class="dv">0</span><span class="op">,</span> <span class="dv">10</span>])</span>
<span id="cb1-54"><a href="#cb1-54" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">range</span>(xRange)<span class="op">;</span></span>
<span id="cb1-55"><a href="#cb1-55" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> scaleMandB <span class="op">=</span> d3<span class="op">.</span><span class="fu">scaleLinear</span>()</span>
<span id="cb1-56"><a href="#cb1-56" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">domain</span>([<span class="dv">0</span><span class="op">,</span> <span class="dv">100</span>])</span>
<span id="cb1-57"><a href="#cb1-57" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">range</span>(xRange)<span class="op">;</span></span>
<span id="cb1-58"><a href="#cb1-58" aria-hidden="true" tabindex="-1"></a>  <span class="co">// Background bars to show where 100% lies</span></span>
<span id="cb1-59"><a href="#cb1-59" aria-hidden="true" tabindex="-1"></a>  svg<span class="op">.</span><span class="fu">selectAll</span>(<span class="st">'.background'</span>)</span>
<span id="cb1-60"><a href="#cb1-60" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">data</span>([</span>
<span id="cb1-61"><a href="#cb1-61" aria-hidden="true" tabindex="-1"></a>      <span class="st">'dd'</span><span class="op">,</span> <span class="st">"mils"</span><span class="op">,</span> <span class="st">'beats'</span>])</span>
<span id="cb1-62"><a href="#cb1-62" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">enter</span>()</span>
<span id="cb1-63"><a href="#cb1-63" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">append</span>(<span class="st">'rect'</span>)</span>
<span id="cb1-64"><a href="#cb1-64" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">'class'</span><span class="op">,</span> <span class="st">'background timeBar'</span>)</span>
<span id="cb1-65"><a href="#cb1-65" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">'width'</span><span class="op">,</span> W<span class="op">-</span><span class="dv">100</span>)</span>
<span id="cb1-66"><a href="#cb1-66" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">'y'</span><span class="op">,</span> (d<span class="op">,</span>i)<span class="kw">=&gt;</span>i<span class="op">*</span><span class="dv">30</span><span class="op">+</span>firstBarY)</span>
<span id="cb1-67"><a href="#cb1-67" aria-hidden="true" tabindex="-1"></a>  <span class="co">// Beats</span></span>
<span id="cb1-68"><a href="#cb1-68" aria-hidden="true" tabindex="-1"></a>  svg</span>
<span id="cb1-69"><a href="#cb1-69" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">append</span>(<span class="st">'rect'</span>)</span>
<span id="cb1-70"><a href="#cb1-70" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">'class'</span><span class="op">,</span> <span class="st">'timeBar'</span>)</span>
<span id="cb1-71"><a href="#cb1-71" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">'y'</span><span class="op">,</span> firstBarY<span class="op">+</span><span class="dv">60</span>)</span>
<span id="cb1-72"><a href="#cb1-72" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">'width'</span><span class="op">,</span> d <span class="kw">=&gt;</span> <span class="fu">scaleMandB</span>(<span class="bu">Number</span>(barBeats)))</span>
<span id="cb1-73"><a href="#cb1-73" aria-hidden="true" tabindex="-1"></a>  svg</span>
<span id="cb1-74"><a href="#cb1-74" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">append</span>(<span class="st">'rect'</span>)</span>
<span id="cb1-75"><a href="#cb1-75" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">'class'</span><span class="op">,</span> <span class="st">'timeBarFull'</span>)</span>
<span id="cb1-76"><a href="#cb1-76" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">'y'</span><span class="op">,</span> firstBarY<span class="op">+</span><span class="dv">60</span>)</span>
<span id="cb1-77"><a href="#cb1-77" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">'width'</span><span class="op">,</span> d <span class="kw">=&gt;</span> <span class="fu">scaleMandB</span>(barBeats))</span>
<span id="cb1-78"><a href="#cb1-78" aria-hidden="true" tabindex="-1"></a>  <span class="co">// Cents/Mils</span></span>
<span id="cb1-79"><a href="#cb1-79" aria-hidden="true" tabindex="-1"></a>  svg</span>
<span id="cb1-80"><a href="#cb1-80" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">append</span>(<span class="st">'rect'</span>)</span>
<span id="cb1-81"><a href="#cb1-81" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">'class'</span><span class="op">,</span> <span class="st">'timeBar'</span>)</span>
<span id="cb1-82"><a href="#cb1-82" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">'y'</span><span class="op">,</span> firstBarY)</span>
<span id="cb1-83"><a href="#cb1-83" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">'width'</span><span class="op">,</span> d <span class="kw">=&gt;</span> <span class="fu">scaleDD</span>(<span class="bu">Number</span>(barDD)<span class="op">+</span><span class="bu">Number</span>(barMils)<span class="op">/</span><span class="dv">100</span><span class="op">+</span><span class="bu">Number</span>(barBeats)<span class="op">/</span><span class="dv">10000</span>))</span>
<span id="cb1-84"><a href="#cb1-84" aria-hidden="true" tabindex="-1"></a>  svg</span>
<span id="cb1-85"><a href="#cb1-85" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">append</span>(<span class="st">'rect'</span>)</span>
<span id="cb1-86"><a href="#cb1-86" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">'class'</span><span class="op">,</span> <span class="st">'timeBarFull'</span>)</span>
<span id="cb1-87"><a href="#cb1-87" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">'y'</span><span class="op">,</span> firstBarY)</span>
<span id="cb1-88"><a href="#cb1-88" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">'width'</span><span class="op">,</span> d <span class="kw">=&gt;</span> <span class="fu">scaleDD</span>(barDD))</span>
<span id="cb1-89"><a href="#cb1-89" aria-hidden="true" tabindex="-1"></a>  svg</span>
<span id="cb1-90"><a href="#cb1-90" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">append</span>(<span class="st">'rect'</span>)</span>
<span id="cb1-91"><a href="#cb1-91" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">'class'</span><span class="op">,</span> <span class="st">'timeBar'</span>)</span>
<span id="cb1-92"><a href="#cb1-92" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">'y'</span><span class="op">,</span> firstBarY<span class="op">+</span><span class="dv">30</span>)</span>
<span id="cb1-93"><a href="#cb1-93" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">'width'</span><span class="op">,</span> d <span class="kw">=&gt;</span> <span class="fu">scaleMandB</span>(<span class="bu">Number</span>(barMils)<span class="op">+</span><span class="bu">Number</span>(barBeats)<span class="op">/</span><span class="dv">100</span>))</span>
<span id="cb1-94"><a href="#cb1-94" aria-hidden="true" tabindex="-1"></a>  svg</span>
<span id="cb1-95"><a href="#cb1-95" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">append</span>(<span class="st">'rect'</span>)</span>
<span id="cb1-96"><a href="#cb1-96" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">'class'</span><span class="op">,</span> <span class="st">'timeBarFull'</span>)</span>
<span id="cb1-97"><a href="#cb1-97" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">'y'</span><span class="op">,</span> firstBarY<span class="op">+</span><span class="dv">30</span>)</span>
<span id="cb1-98"><a href="#cb1-98" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">'width'</span><span class="op">,</span> d <span class="kw">=&gt;</span> <span class="fu">scaleMandB</span>(barMils))</span>
<span id="cb1-99"><a href="#cb1-99" aria-hidden="true" tabindex="-1"></a>  <span class="co">// Cent ticks</span></span>
<span id="cb1-100"><a href="#cb1-100" aria-hidden="true" tabindex="-1"></a>  svg<span class="op">.</span><span class="fu">selectAll</span>(<span class="st">'.tickC'</span>)</span>
<span id="cb1-101"><a href="#cb1-101" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">data</span>(d3<span class="op">.</span><span class="fu">range</span>(width <span class="op">&gt;</span> <span class="dv">500</span> <span class="op">?</span> <span class="dv">10</span> <span class="op">:</span> <span class="dv">10</span><span class="op">,</span> <span class="dv">100</span>))</span>
<span id="cb1-102"><a href="#cb1-102" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">enter</span>()</span>
<span id="cb1-103"><a href="#cb1-103" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">append</span>(<span class="st">'rect'</span>)</span>
<span id="cb1-104"><a href="#cb1-104" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">'class'</span><span class="op">,</span> <span class="st">'tickC'</span>)</span>
<span id="cb1-105"><a href="#cb1-105" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">'x'</span><span class="op">,</span> d<span class="kw">=&gt;</span><span class="fu">scaleDD</span>(d<span class="op">/</span><span class="dv">10</span>)<span class="op">+</span>barX)</span>
<span id="cb1-106"><a href="#cb1-106" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">'y'</span><span class="op">,</span> firstBarY<span class="op">+</span><span class="dv">30</span>)</span>
<span id="cb1-107"><a href="#cb1-107" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">'height'</span><span class="op">,</span> d<span class="kw">=&gt;</span>d<span class="op">%</span><span class="dv">2</span><span class="op">===</span><span class="dv">0</span><span class="op">?</span> <span class="dv">8</span><span class="op">:</span><span class="dv">5</span>)</span>
<span id="cb1-108"><a href="#cb1-108" aria-hidden="true" tabindex="-1"></a>  svg<span class="op">.</span><span class="fu">selectAll</span>(<span class="st">'.tickB1'</span>)</span>
<span id="cb1-109"><a href="#cb1-109" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">data</span>(d3<span class="op">.</span><span class="fu">range</span>(width <span class="op">&gt;</span> <span class="dv">500</span> <span class="op">?</span> <span class="dv">10</span> <span class="op">:</span> <span class="dv">10</span><span class="op">,</span> <span class="dv">100</span>))</span>
<span id="cb1-110"><a href="#cb1-110" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">enter</span>()</span>
<span id="cb1-111"><a href="#cb1-111" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">append</span>(<span class="st">'rect'</span>)</span>
<span id="cb1-112"><a href="#cb1-112" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">'class'</span><span class="op">,</span> <span class="st">'tickB1'</span>)</span>
<span id="cb1-113"><a href="#cb1-113" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">'x'</span><span class="op">,</span> d<span class="kw">=&gt;</span><span class="fu">scaleDD</span>(d<span class="op">/</span><span class="dv">10</span>)<span class="op">+</span>barX)</span>
<span id="cb1-114"><a href="#cb1-114" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">'y'</span><span class="op">,</span> d<span class="kw">=&gt;</span>d<span class="op">%</span><span class="dv">2</span><span class="op">===</span><span class="dv">0</span><span class="op">?</span> firstBarY<span class="op">+</span><span class="dv">77</span><span class="op">:</span>firstBarY<span class="op">+</span><span class="dv">80</span>)</span>
<span id="cb1-115"><a href="#cb1-115" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">'height'</span><span class="op">,</span> d<span class="kw">=&gt;</span>d<span class="op">%</span><span class="dv">2</span><span class="op">===</span><span class="dv">0</span><span class="op">?</span> <span class="dv">8</span><span class="op">:</span><span class="dv">5</span>)</span>
<span id="cb1-116"><a href="#cb1-116" aria-hidden="true" tabindex="-1"></a>  svg<span class="op">.</span><span class="fu">selectAll</span>(<span class="st">'.tickC1'</span>)</span>
<span id="cb1-117"><a href="#cb1-117" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">data</span>(d3<span class="op">.</span><span class="fu">range</span>(width <span class="op">&gt;</span> <span class="dv">500</span> <span class="op">?</span> <span class="dv">10</span> <span class="op">:</span> <span class="dv">10</span><span class="op">,</span> <span class="dv">100</span>))</span>
<span id="cb1-118"><a href="#cb1-118" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">enter</span>()</span>
<span id="cb1-119"><a href="#cb1-119" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">append</span>(<span class="st">'rect'</span>)</span>
<span id="cb1-120"><a href="#cb1-120" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">'class'</span><span class="op">,</span> <span class="st">'tickC1'</span>)</span>
<span id="cb1-121"><a href="#cb1-121" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">'x'</span><span class="op">,</span> d<span class="kw">=&gt;</span><span class="fu">scaleDD</span>(d<span class="op">/</span><span class="dv">10</span>)<span class="op">+</span>barX)</span>
<span id="cb1-122"><a href="#cb1-122" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">'y'</span><span class="op">,</span> d<span class="kw">=&gt;</span>d<span class="op">%</span><span class="dv">2</span><span class="op">===</span><span class="dv">0</span><span class="op">?</span> firstBarY<span class="op">+</span><span class="dv">47</span><span class="op">:</span>firstBarY<span class="op">+</span><span class="dv">50</span>)</span>
<span id="cb1-123"><a href="#cb1-123" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">'height'</span><span class="op">,</span> d<span class="kw">=&gt;</span>d<span class="op">%</span><span class="dv">2</span><span class="op">===</span><span class="dv">0</span><span class="op">?</span> <span class="dv">8</span><span class="op">:</span><span class="dv">5</span>)</span>
<span id="cb1-124"><a href="#cb1-124" aria-hidden="true" tabindex="-1"></a>  <span class="co">// Mil ticks</span></span>
<span id="cb1-125"><a href="#cb1-125" aria-hidden="true" tabindex="-1"></a>  svg<span class="op">.</span><span class="fu">selectAll</span>(<span class="st">'.tickM'</span>)</span>
<span id="cb1-126"><a href="#cb1-126" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">data</span>(d3<span class="op">.</span><span class="fu">range</span>(width <span class="op">&gt;</span> <span class="dv">500</span> <span class="op">?</span> <span class="dv">1</span> <span class="op">:</span> <span class="dv">1</span><span class="op">,</span> <span class="dv">10</span>))</span>
<span id="cb1-127"><a href="#cb1-127" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">enter</span>()</span>
<span id="cb1-128"><a href="#cb1-128" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">append</span>(<span class="st">'rect'</span>)</span>
<span id="cb1-129"><a href="#cb1-129" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">'class'</span><span class="op">,</span> <span class="st">'tickM'</span>)</span>
<span id="cb1-130"><a href="#cb1-130" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">'x'</span><span class="op">,</span> d<span class="kw">=&gt;</span><span class="fu">scaleDD</span>(d)<span class="op">+</span>barX)</span>
<span id="cb1-131"><a href="#cb1-131" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">'y'</span><span class="op">,</span> firstBarY<span class="op">+</span><span class="dv">20</span>)</span>
<span id="cb1-132"><a href="#cb1-132" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">'height'</span><span class="op">,</span> <span class="dv">6</span>)</span>
<span id="cb1-133"><a href="#cb1-133" aria-hidden="true" tabindex="-1"></a>  svg<span class="op">.</span><span class="fu">selectAll</span>(<span class="st">'.tickLabel1'</span>)</span>
<span id="cb1-134"><a href="#cb1-134" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">data</span>(d3<span class="op">.</span><span class="fu">range</span>(width <span class="op">&gt;</span> <span class="dv">500</span> <span class="op">?</span> <span class="dv">1</span> <span class="op">:</span> <span class="dv">1</span><span class="op">,</span> <span class="dv">10</span>))</span>
<span id="cb1-135"><a href="#cb1-135" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">enter</span>()</span>
<span id="cb1-136"><a href="#cb1-136" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">append</span>(<span class="st">'text'</span>)</span>
<span id="cb1-137"><a href="#cb1-137" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">'class'</span><span class="op">,</span> <span class="st">'tickLabel1'</span>)</span>
<span id="cb1-138"><a href="#cb1-138" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">'x'</span><span class="op">,</span> d<span class="kw">=&gt;</span><span class="fu">scaleDD</span>(d)<span class="op">+</span>barX<span class="op">+.</span><span class="dv">5</span>)</span>
<span id="cb1-139"><a href="#cb1-139" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">'y'</span><span class="op">,</span> firstBarY<span class="op">+</span><span class="dv">18</span>)</span>
<span id="cb1-140"><a href="#cb1-140" aria-hidden="true" tabindex="-1"></a>    <span class="co">//.style("font-size", `{W &lt; 550 ? 12 : W &lt; 650 ? 14 : W &lt; 750 ? 16 : W &lt; 850 ? 18 : 20}px`)</span></span>
<span id="cb1-141"><a href="#cb1-141" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">text</span>(d<span class="kw">=&gt;</span>d)</span>
<span id="cb1-142"><a href="#cb1-142" aria-hidden="true" tabindex="-1"></a>  <span class="co">// Cent ticks</span></span>
<span id="cb1-143"><a href="#cb1-143" aria-hidden="true" tabindex="-1"></a>  svg<span class="op">.</span><span class="fu">selectAll</span>(<span class="st">'.tickC2'</span>)</span>
<span id="cb1-144"><a href="#cb1-144" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">data</span>(d3<span class="op">.</span><span class="fu">range</span>(width <span class="op">&gt;</span> <span class="dv">500</span> <span class="op">?</span> <span class="dv">10</span> <span class="op">:</span> <span class="dv">10</span><span class="op">,</span> <span class="dv">100</span>))</span>
<span id="cb1-145"><a href="#cb1-145" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">enter</span>()</span>
<span id="cb1-146"><a href="#cb1-146" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">append</span>(<span class="st">'rect'</span>)</span>
<span id="cb1-147"><a href="#cb1-147" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">'class'</span><span class="op">,</span> <span class="st">'tickC2'</span>)</span>
<span id="cb1-148"><a href="#cb1-148" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">'x'</span><span class="op">,</span> d<span class="kw">=&gt;</span><span class="fu">scaleDD</span>(d<span class="op">/</span><span class="dv">10</span>)<span class="op">+</span>barX)</span>
<span id="cb1-149"><a href="#cb1-149" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">'y'</span><span class="op">,</span> firstBarY<span class="op">+</span><span class="dv">10</span>)</span>
<span id="cb1-150"><a href="#cb1-150" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">'height'</span><span class="op">,</span> d<span class="kw">=&gt;</span>d<span class="op">%</span><span class="dv">2</span><span class="op">===</span><span class="dv">0</span><span class="op">?</span> <span class="dv">9</span><span class="op">:</span><span class="dv">6</span>)</span>
<span id="cb1-151"><a href="#cb1-151" aria-hidden="true" tabindex="-1"></a>  <span class="co">// Beat ticks</span></span>
<span id="cb1-152"><a href="#cb1-152" aria-hidden="true" tabindex="-1"></a>  svg<span class="op">.</span><span class="fu">selectAll</span>(<span class="st">'.tickB'</span>)</span>
<span id="cb1-153"><a href="#cb1-153" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">data</span>(d3<span class="op">.</span><span class="fu">range</span>(width <span class="op">&gt;</span> <span class="dv">500</span> <span class="op">?</span> <span class="dv">10</span> <span class="op">:</span> <span class="dv">10</span><span class="op">,</span> <span class="dv">100</span>))</span>
<span id="cb1-154"><a href="#cb1-154" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">enter</span>()</span>
<span id="cb1-155"><a href="#cb1-155" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">append</span>(<span class="st">'rect'</span>)</span>
<span id="cb1-156"><a href="#cb1-156" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">'class'</span><span class="op">,</span> <span class="st">'tickB'</span>)</span>
<span id="cb1-157"><a href="#cb1-157" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">'x'</span><span class="op">,</span> d<span class="kw">=&gt;</span><span class="fu">scaleDD</span>(d<span class="op">/</span><span class="dv">10</span>)<span class="op">+</span>barX)</span>
<span id="cb1-158"><a href="#cb1-158" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">'y'</span><span class="op">,</span> firstBarY<span class="op">+</span><span class="dv">60</span>)</span>
<span id="cb1-159"><a href="#cb1-159" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">'height'</span><span class="op">,</span> d<span class="kw">=&gt;</span>d<span class="op">%</span><span class="dv">2</span><span class="op">===</span><span class="dv">0</span><span class="op">?</span> <span class="dv">9</span><span class="op">:</span><span class="dv">6</span>)</span>
<span id="cb1-160"><a href="#cb1-160" aria-hidden="true" tabindex="-1"></a>  <span class="co">// Labels</span></span>
<span id="cb1-161"><a href="#cb1-161" aria-hidden="true" tabindex="-1"></a>  svg<span class="op">.</span><span class="fu">selectAll</span>(<span class="st">'.timeLabel'</span>)</span>
<span id="cb1-162"><a href="#cb1-162" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">data</span>([<span class="vs">`+</span><span class="sc">${</span>barDD<span class="sc">}</span><span class="vs">`</span><span class="op">,</span> <span class="vs">`</span><span class="sc">${</span>barMils<span class="sc">}</span><span class="vs">`</span><span class="op">,</span> <span class="vs">`</span><span class="sc">${</span>barBeats<span class="sc">}</span><span class="vs">`</span>])</span>
<span id="cb1-163"><a href="#cb1-163" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">enter</span>()</span>
<span id="cb1-164"><a href="#cb1-164" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">append</span>(<span class="st">'text'</span>)</span>
<span id="cb1-165"><a href="#cb1-165" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">'class'</span><span class="op">,</span> <span class="st">'timeLabel'</span>)</span>
<span id="cb1-166"><a href="#cb1-166" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">'x'</span><span class="op">,</span> barX<span class="op">+</span><span class="dv">2</span>)</span>
<span id="cb1-167"><a href="#cb1-167" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">'y'</span><span class="op">,</span> (d<span class="op">,</span>i)<span class="kw">=&gt;</span>i<span class="op">*</span><span class="dv">30</span><span class="op">+</span>firstBarY<span class="op">+</span><span class="dv">20</span>)</span>
<span id="cb1-168"><a href="#cb1-168" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">style</span>(<span class="st">"font-size"</span><span class="op">,</span> <span class="vs">`</span><span class="sc">${</span>W <span class="op">&lt;</span> <span class="dv">300</span> <span class="op">?</span> <span class="dv">14</span> <span class="op">:</span> W <span class="op">&lt;</span> <span class="dv">400</span> <span class="op">?</span> <span class="dv">16</span> <span class="op">:</span> W <span class="op">&lt;</span> <span class="dv">500</span> <span class="op">?</span> <span class="dv">18</span> <span class="op">:</span> W <span class="op">&lt;</span> <span class="dv">600</span> <span class="op">?</span> <span class="dv">20</span> <span class="op">:</span> <span class="dv">22</span><span class="sc">}</span><span class="vs">px`</span>)</span>
<span id="cb1-169"><a href="#cb1-169" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">text</span>(d<span class="kw">=&gt;</span>d)<span class="op">;</span></span>
<span id="cb1-170"><a href="#cb1-170" aria-hidden="true" tabindex="-1"></a>  svg<span class="op">.</span><span class="fu">attr</span>(<span class="st">"id"</span><span class="op">,</span> <span class="st">"barClock"</span>)<span class="op">;</span></span>
<span id="cb1-171"><a href="#cb1-171" aria-hidden="true" tabindex="-1"></a>  <span class="cf">return</span> svg<span class="op">.</span><span class="fu">node</span>()<span class="op">;</span></span>
<span id="cb1-172"><a href="#cb1-172" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb1-173"><a href="#cb1-173" aria-hidden="true" tabindex="-1"></a>barChart1 <span class="op">=</span> {</span>
<span id="cb1-174"><a href="#cb1-174" aria-hidden="true" tabindex="-1"></a><span class="kw">const</span> W <span class="op">=</span> width<span class="op">;</span></span>
<span id="cb1-175"><a href="#cb1-175" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> H <span class="op">=</span> <span class="dv">88</span><span class="op">;</span></span>
<span id="cb1-176"><a href="#cb1-176" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> barX <span class="op">=</span> <span class="dv">1</span><span class="op">;</span></span>
<span id="cb1-177"><a href="#cb1-177" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> firstBarY <span class="op">=</span> <span class="dv">1</span><span class="op">;</span></span>
<span id="cb1-178"><a href="#cb1-178" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> svg <span class="op">=</span> d3</span>
<span id="cb1-179"><a href="#cb1-179" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">create</span>(<span class="st">"svg"</span>)</span>
<span id="cb1-180"><a href="#cb1-180" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">"width"</span><span class="op">,</span> W)</span>
<span id="cb1-181"><a href="#cb1-181" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">"viewBox"</span><span class="op">,</span> [<span class="dv">0</span><span class="op">,</span> <span class="dv">0</span><span class="op">,</span> W <span class="op">*</span> (W <span class="op">&lt;</span> <span class="dv">370</span> <span class="op">?</span> <span class="op">.</span><span class="dv">73</span> <span class="op">:</span> W <span class="op">&lt;</span> <span class="dv">420</span> <span class="op">?</span> <span class="op">.</span><span class="dv">76</span> <span class="op">:</span> W <span class="op">&lt;</span> <span class="dv">470</span> <span class="op">?</span> <span class="op">.</span><span class="dv">79</span> <span class="op">:</span> W <span class="op">&lt;</span> <span class="dv">520</span> <span class="op">?</span> <span class="op">.</span><span class="dv">81</span> <span class="op">:</span> W <span class="op">&lt;</span> <span class="dv">570</span> <span class="op">?</span> <span class="op">.</span><span class="dv">83</span> <span class="op">:</span> W <span class="op">&lt;</span> <span class="dv">620</span> <span class="op">?</span> <span class="op">.</span><span class="dv">84</span> <span class="op">:</span> W <span class="op">&lt;</span> <span class="dv">670</span> <span class="op">?</span> <span class="op">.</span><span class="dv">85</span> <span class="op">:</span> W <span class="op">&lt;</span> <span class="dv">720</span> <span class="op">?</span> <span class="op">.</span><span class="dv">86</span> <span class="op">:</span> <span class="op">.</span><span class="dv">87</span>)<span class="op">,</span> H])<span class="op">;</span></span>
<span id="cb1-182"><a href="#cb1-182" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> xRange <span class="op">=</span> [<span class="dv">0</span><span class="op">,</span> W <span class="op">-</span> <span class="dv">100</span>]<span class="op">;</span></span>
<span id="cb1-183"><a href="#cb1-183" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> scaleDD <span class="op">=</span> d3<span class="op">.</span><span class="fu">scaleLinear</span>()</span>
<span id="cb1-184"><a href="#cb1-184" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">domain</span>([<span class="dv">0</span><span class="op">,</span> <span class="dv">10</span>])</span>
<span id="cb1-185"><a href="#cb1-185" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">range</span>(xRange)<span class="op">;</span></span>
<span id="cb1-186"><a href="#cb1-186" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> scaleMandB <span class="op">=</span> d3<span class="op">.</span><span class="fu">scaleLinear</span>()</span>
<span id="cb1-187"><a href="#cb1-187" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">domain</span>([<span class="dv">0</span><span class="op">,</span> <span class="dv">100</span>])</span>
<span id="cb1-188"><a href="#cb1-188" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">range</span>(xRange)<span class="op">;</span></span>
<span id="cb1-189"><a href="#cb1-189" aria-hidden="true" tabindex="-1"></a>  <span class="co">// const scaleDek = d3.scaleLinear()</span></span>
<span id="cb1-190"><a href="#cb1-190" aria-hidden="true" tabindex="-1"></a>  <span class="co">//  .domain([0, 37])</span></span>
<span id="cb1-191"><a href="#cb1-191" aria-hidden="true" tabindex="-1"></a>  <span class="co">//  .range(xRange);</span></span>
<span id="cb1-192"><a href="#cb1-192" aria-hidden="true" tabindex="-1"></a>  <span class="co">// Background bars to show where 100% lies</span></span>
<span id="cb1-193"><a href="#cb1-193" aria-hidden="true" tabindex="-1"></a>  svg<span class="op">.</span><span class="fu">selectAll</span>(<span class="st">'.background'</span>)</span>
<span id="cb1-194"><a href="#cb1-194" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">data</span>([</span>
<span id="cb1-195"><a href="#cb1-195" aria-hidden="true" tabindex="-1"></a>      <span class="co">// 'dek', 'dotd',</span></span>
<span id="cb1-196"><a href="#cb1-196" aria-hidden="true" tabindex="-1"></a>      <span class="st">'dd'</span><span class="op">,</span> <span class="st">"mils"</span><span class="op">,</span> <span class="st">'beats'</span>])</span>
<span id="cb1-197"><a href="#cb1-197" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">enter</span>()</span>
<span id="cb1-198"><a href="#cb1-198" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">append</span>(<span class="st">'rect'</span>)</span>
<span id="cb1-199"><a href="#cb1-199" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">'class'</span><span class="op">,</span> <span class="st">'background timeBar'</span>)</span>
<span id="cb1-200"><a href="#cb1-200" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">'width'</span><span class="op">,</span> W<span class="op">-</span><span class="dv">100</span>)</span>
<span id="cb1-201"><a href="#cb1-201" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">'y'</span><span class="op">,</span> (d<span class="op">,</span>i)<span class="kw">=&gt;</span>i<span class="op">*</span><span class="dv">30</span><span class="op">+</span>firstBarY)</span>
<span id="cb1-202"><a href="#cb1-202" aria-hidden="true" tabindex="-1"></a>  <span class="co">// Beats</span></span>
<span id="cb1-203"><a href="#cb1-203" aria-hidden="true" tabindex="-1"></a>  svg</span>
<span id="cb1-204"><a href="#cb1-204" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">append</span>(<span class="st">'rect'</span>)</span>
<span id="cb1-205"><a href="#cb1-205" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">'class'</span><span class="op">,</span> <span class="st">'timeBar'</span>)</span>
<span id="cb1-206"><a href="#cb1-206" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">'y'</span><span class="op">,</span> firstBarY<span class="op">+</span><span class="dv">60</span>)</span>
<span id="cb1-207"><a href="#cb1-207" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">'width'</span><span class="op">,</span> d <span class="kw">=&gt;</span> <span class="fu">scaleMandB</span>(<span class="bu">Number</span>(barBeatsN)))</span>
<span id="cb1-208"><a href="#cb1-208" aria-hidden="true" tabindex="-1"></a>  svg</span>
<span id="cb1-209"><a href="#cb1-209" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">append</span>(<span class="st">'rect'</span>)</span>
<span id="cb1-210"><a href="#cb1-210" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">'class'</span><span class="op">,</span> <span class="st">'timeBarFullN'</span>)</span>
<span id="cb1-211"><a href="#cb1-211" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">'y'</span><span class="op">,</span> firstBarY<span class="op">+</span><span class="dv">60</span>)</span>
<span id="cb1-212"><a href="#cb1-212" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">'width'</span><span class="op">,</span> d <span class="kw">=&gt;</span> <span class="fu">scaleMandB</span>(barBeatsN))</span>
<span id="cb1-213"><a href="#cb1-213" aria-hidden="true" tabindex="-1"></a>  <span class="co">// Cents/Mils</span></span>
<span id="cb1-214"><a href="#cb1-214" aria-hidden="true" tabindex="-1"></a>  svg</span>
<span id="cb1-215"><a href="#cb1-215" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">append</span>(<span class="st">'rect'</span>)</span>
<span id="cb1-216"><a href="#cb1-216" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">'class'</span><span class="op">,</span> <span class="st">'timeBar'</span>)</span>
<span id="cb1-217"><a href="#cb1-217" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">'y'</span><span class="op">,</span> firstBarY)</span>
<span id="cb1-218"><a href="#cb1-218" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">'width'</span><span class="op">,</span> d <span class="kw">=&gt;</span> <span class="fu">scaleDD</span>(<span class="bu">Number</span>(barDDN)<span class="op">+</span><span class="bu">Number</span>(barMilsN)<span class="op">/</span><span class="dv">100</span><span class="op">+</span><span class="bu">Number</span>(barBeatsN)<span class="op">/</span><span class="dv">10000</span>))</span>
<span id="cb1-219"><a href="#cb1-219" aria-hidden="true" tabindex="-1"></a>  svg</span>
<span id="cb1-220"><a href="#cb1-220" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">append</span>(<span class="st">'rect'</span>)</span>
<span id="cb1-221"><a href="#cb1-221" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">'class'</span><span class="op">,</span> <span class="st">'timeBarFullN'</span>)</span>
<span id="cb1-222"><a href="#cb1-222" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">'y'</span><span class="op">,</span> firstBarY)</span>
<span id="cb1-223"><a href="#cb1-223" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">'width'</span><span class="op">,</span> d <span class="kw">=&gt;</span> <span class="fu">scaleDD</span>(barDDN))</span>
<span id="cb1-224"><a href="#cb1-224" aria-hidden="true" tabindex="-1"></a>  svg</span>
<span id="cb1-225"><a href="#cb1-225" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">append</span>(<span class="st">'rect'</span>)</span>
<span id="cb1-226"><a href="#cb1-226" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">'class'</span><span class="op">,</span> <span class="st">'timeBar'</span>)</span>
<span id="cb1-227"><a href="#cb1-227" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">'y'</span><span class="op">,</span> firstBarY<span class="op">+</span><span class="dv">30</span>)</span>
<span id="cb1-228"><a href="#cb1-228" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">'width'</span><span class="op">,</span> d <span class="kw">=&gt;</span> <span class="fu">scaleMandB</span>(<span class="bu">Number</span>(barMilsN)<span class="op">+</span><span class="bu">Number</span>(barBeatsN)<span class="op">/</span><span class="dv">100</span>))</span>
<span id="cb1-229"><a href="#cb1-229" aria-hidden="true" tabindex="-1"></a>  svg</span>
<span id="cb1-230"><a href="#cb1-230" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">append</span>(<span class="st">'rect'</span>)</span>
<span id="cb1-231"><a href="#cb1-231" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">'class'</span><span class="op">,</span> <span class="st">'timeBarFullN'</span>)</span>
<span id="cb1-232"><a href="#cb1-232" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">'y'</span><span class="op">,</span> firstBarY<span class="op">+</span><span class="dv">30</span>)</span>
<span id="cb1-233"><a href="#cb1-233" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">'width'</span><span class="op">,</span> d <span class="kw">=&gt;</span> <span class="fu">scaleMandB</span>(barMilsN))</span>
<span id="cb1-234"><a href="#cb1-234" aria-hidden="true" tabindex="-1"></a>  <span class="co">// Cent ticks</span></span>
<span id="cb1-235"><a href="#cb1-235" aria-hidden="true" tabindex="-1"></a>  svg<span class="op">.</span><span class="fu">selectAll</span>(<span class="st">'.tickC'</span>)</span>
<span id="cb1-236"><a href="#cb1-236" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">data</span>(d3<span class="op">.</span><span class="fu">range</span>(width <span class="op">&gt;</span> <span class="dv">500</span> <span class="op">?</span> <span class="dv">10</span> <span class="op">:</span> <span class="dv">10</span><span class="op">,</span> <span class="dv">100</span>))</span>
<span id="cb1-237"><a href="#cb1-237" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">enter</span>()</span>
<span id="cb1-238"><a href="#cb1-238" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">append</span>(<span class="st">'rect'</span>)</span>
<span id="cb1-239"><a href="#cb1-239" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">'class'</span><span class="op">,</span> <span class="st">'tickC'</span>)</span>
<span id="cb1-240"><a href="#cb1-240" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">'x'</span><span class="op">,</span> d<span class="kw">=&gt;</span><span class="fu">scaleDD</span>(d<span class="op">/</span><span class="dv">10</span>)<span class="op">+</span>barX)</span>
<span id="cb1-241"><a href="#cb1-241" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">'y'</span><span class="op">,</span> firstBarY<span class="op">+</span><span class="dv">30</span>)</span>
<span id="cb1-242"><a href="#cb1-242" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">'height'</span><span class="op">,</span> d<span class="kw">=&gt;</span>d<span class="op">%</span><span class="dv">2</span><span class="op">===</span><span class="dv">0</span><span class="op">?</span> <span class="dv">8</span><span class="op">:</span><span class="dv">5</span>)</span>
<span id="cb1-243"><a href="#cb1-243" aria-hidden="true" tabindex="-1"></a>  svg<span class="op">.</span><span class="fu">selectAll</span>(<span class="st">'.tickB1'</span>)</span>
<span id="cb1-244"><a href="#cb1-244" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">data</span>(d3<span class="op">.</span><span class="fu">range</span>(width <span class="op">&gt;</span> <span class="dv">500</span> <span class="op">?</span> <span class="dv">10</span> <span class="op">:</span> <span class="dv">10</span><span class="op">,</span> <span class="dv">100</span>))</span>
<span id="cb1-245"><a href="#cb1-245" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">enter</span>()</span>
<span id="cb1-246"><a href="#cb1-246" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">append</span>(<span class="st">'rect'</span>)</span>
<span id="cb1-247"><a href="#cb1-247" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">'class'</span><span class="op">,</span> <span class="st">'tickB1'</span>)</span>
<span id="cb1-248"><a href="#cb1-248" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">'x'</span><span class="op">,</span> d<span class="kw">=&gt;</span><span class="fu">scaleDD</span>(d<span class="op">/</span><span class="dv">10</span>)<span class="op">+</span>barX)</span>
<span id="cb1-249"><a href="#cb1-249" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">'y'</span><span class="op">,</span> d<span class="kw">=&gt;</span>d<span class="op">%</span><span class="dv">2</span><span class="op">===</span><span class="dv">0</span><span class="op">?</span> firstBarY<span class="op">+</span><span class="dv">77</span><span class="op">:</span>firstBarY<span class="op">+</span><span class="dv">80</span>)</span>
<span id="cb1-250"><a href="#cb1-250" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">'height'</span><span class="op">,</span> d<span class="kw">=&gt;</span>d<span class="op">%</span><span class="dv">2</span><span class="op">===</span><span class="dv">0</span><span class="op">?</span> <span class="dv">8</span><span class="op">:</span><span class="dv">5</span>)</span>
<span id="cb1-251"><a href="#cb1-251" aria-hidden="true" tabindex="-1"></a>  svg<span class="op">.</span><span class="fu">selectAll</span>(<span class="st">'.tickC1'</span>)</span>
<span id="cb1-252"><a href="#cb1-252" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">data</span>(d3<span class="op">.</span><span class="fu">range</span>(width <span class="op">&gt;</span> <span class="dv">500</span> <span class="op">?</span> <span class="dv">10</span> <span class="op">:</span> <span class="dv">10</span><span class="op">,</span> <span class="dv">100</span>))</span>
<span id="cb1-253"><a href="#cb1-253" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">enter</span>()</span>
<span id="cb1-254"><a href="#cb1-254" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">append</span>(<span class="st">'rect'</span>)</span>
<span id="cb1-255"><a href="#cb1-255" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">'class'</span><span class="op">,</span> <span class="st">'tickC1'</span>)</span>
<span id="cb1-256"><a href="#cb1-256" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">'x'</span><span class="op">,</span> d<span class="kw">=&gt;</span><span class="fu">scaleDD</span>(d<span class="op">/</span><span class="dv">10</span>)<span class="op">+</span>barX)</span>
<span id="cb1-257"><a href="#cb1-257" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">'y'</span><span class="op">,</span> d<span class="kw">=&gt;</span>d<span class="op">%</span><span class="dv">2</span><span class="op">===</span><span class="dv">0</span><span class="op">?</span> firstBarY<span class="op">+</span><span class="dv">47</span><span class="op">:</span>firstBarY<span class="op">+</span><span class="dv">50</span>)</span>
<span id="cb1-258"><a href="#cb1-258" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">'height'</span><span class="op">,</span> d<span class="kw">=&gt;</span>d<span class="op">%</span><span class="dv">2</span><span class="op">===</span><span class="dv">0</span><span class="op">?</span> <span class="dv">8</span><span class="op">:</span><span class="dv">5</span>)</span>
<span id="cb1-259"><a href="#cb1-259" aria-hidden="true" tabindex="-1"></a>  <span class="co">// Mil ticks</span></span>
<span id="cb1-260"><a href="#cb1-260" aria-hidden="true" tabindex="-1"></a>  svg<span class="op">.</span><span class="fu">selectAll</span>(<span class="st">'.tickM'</span>)</span>
<span id="cb1-261"><a href="#cb1-261" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">data</span>(d3<span class="op">.</span><span class="fu">range</span>(width <span class="op">&gt;</span> <span class="dv">500</span> <span class="op">?</span> <span class="dv">1</span> <span class="op">:</span> <span class="dv">1</span><span class="op">,</span> <span class="dv">10</span>))</span>
<span id="cb1-262"><a href="#cb1-262" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">enter</span>()</span>
<span id="cb1-263"><a href="#cb1-263" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">append</span>(<span class="st">'rect'</span>)</span>
<span id="cb1-264"><a href="#cb1-264" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">'class'</span><span class="op">,</span> <span class="st">'tickM'</span>)</span>
<span id="cb1-265"><a href="#cb1-265" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">'x'</span><span class="op">,</span> d<span class="kw">=&gt;</span><span class="fu">scaleDD</span>(d)<span class="op">+</span>barX)</span>
<span id="cb1-266"><a href="#cb1-266" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">'y'</span><span class="op">,</span> firstBarY<span class="op">+</span><span class="dv">20</span>)</span>
<span id="cb1-267"><a href="#cb1-267" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">'height'</span><span class="op">,</span> <span class="dv">6</span>)</span>
<span id="cb1-268"><a href="#cb1-268" aria-hidden="true" tabindex="-1"></a>  svg<span class="op">.</span><span class="fu">selectAll</span>(<span class="st">'.tickLabel1'</span>)</span>
<span id="cb1-269"><a href="#cb1-269" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">data</span>(d3<span class="op">.</span><span class="fu">range</span>(width <span class="op">&gt;</span> <span class="dv">500</span> <span class="op">?</span> <span class="dv">1</span> <span class="op">:</span> <span class="dv">1</span><span class="op">,</span> <span class="dv">10</span>))</span>
<span id="cb1-270"><a href="#cb1-270" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">enter</span>()</span>
<span id="cb1-271"><a href="#cb1-271" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">append</span>(<span class="st">'text'</span>)</span>
<span id="cb1-272"><a href="#cb1-272" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">'class'</span><span class="op">,</span> <span class="st">'tickLabel1'</span>)</span>
<span id="cb1-273"><a href="#cb1-273" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">'x'</span><span class="op">,</span> d<span class="kw">=&gt;</span><span class="fu">scaleDD</span>(d)<span class="op">+</span>barX<span class="op">+.</span><span class="dv">5</span>)</span>
<span id="cb1-274"><a href="#cb1-274" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">'y'</span><span class="op">,</span> firstBarY<span class="op">+</span><span class="dv">18</span>)</span>
<span id="cb1-275"><a href="#cb1-275" aria-hidden="true" tabindex="-1"></a>    <span class="co">//.style("font-size", `{W &lt; 350 ? 12 : W &lt; 450 ? 14 : W &lt; 550 ? 16 : W &lt; 650 ? 18 : 20}px`)</span></span>
<span id="cb1-276"><a href="#cb1-276" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">text</span>(d<span class="kw">=&gt;</span>d)</span>
<span id="cb1-277"><a href="#cb1-277" aria-hidden="true" tabindex="-1"></a>  <span class="co">// Cent ticks</span></span>
<span id="cb1-278"><a href="#cb1-278" aria-hidden="true" tabindex="-1"></a>  svg<span class="op">.</span><span class="fu">selectAll</span>(<span class="st">'.tickC2'</span>)</span>
<span id="cb1-279"><a href="#cb1-279" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">data</span>(d3<span class="op">.</span><span class="fu">range</span>(width <span class="op">&gt;</span> <span class="dv">500</span> <span class="op">?</span> <span class="dv">10</span> <span class="op">:</span> <span class="dv">10</span><span class="op">,</span> <span class="dv">100</span>))</span>
<span id="cb1-280"><a href="#cb1-280" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">enter</span>()</span>
<span id="cb1-281"><a href="#cb1-281" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">append</span>(<span class="st">'rect'</span>)</span>
<span id="cb1-282"><a href="#cb1-282" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">'class'</span><span class="op">,</span> <span class="st">'tickC2'</span>)</span>
<span id="cb1-283"><a href="#cb1-283" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">'x'</span><span class="op">,</span> d<span class="kw">=&gt;</span><span class="fu">scaleDD</span>(d<span class="op">/</span><span class="dv">10</span>)<span class="op">+</span>barX)</span>
<span id="cb1-284"><a href="#cb1-284" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">'y'</span><span class="op">,</span> firstBarY<span class="op">+</span><span class="dv">10</span>)</span>
<span id="cb1-285"><a href="#cb1-285" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">'height'</span><span class="op">,</span> d<span class="kw">=&gt;</span>d<span class="op">%</span><span class="dv">2</span><span class="op">===</span><span class="dv">0</span><span class="op">?</span> <span class="dv">9</span><span class="op">:</span><span class="dv">6</span>)</span>
<span id="cb1-286"><a href="#cb1-286" aria-hidden="true" tabindex="-1"></a>  <span class="co">// Beat ticks</span></span>
<span id="cb1-287"><a href="#cb1-287" aria-hidden="true" tabindex="-1"></a>  svg<span class="op">.</span><span class="fu">selectAll</span>(<span class="st">'.tickB'</span>)</span>
<span id="cb1-288"><a href="#cb1-288" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">data</span>(d3<span class="op">.</span><span class="fu">range</span>(width <span class="op">&gt;</span> <span class="dv">500</span> <span class="op">?</span> <span class="dv">10</span> <span class="op">:</span> <span class="dv">10</span><span class="op">,</span> <span class="dv">100</span>))</span>
<span id="cb1-289"><a href="#cb1-289" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">enter</span>()</span>
<span id="cb1-290"><a href="#cb1-290" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">append</span>(<span class="st">'rect'</span>)</span>
<span id="cb1-291"><a href="#cb1-291" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">'class'</span><span class="op">,</span> <span class="st">'tickB'</span>)</span>
<span id="cb1-292"><a href="#cb1-292" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">'x'</span><span class="op">,</span> d<span class="kw">=&gt;</span><span class="fu">scaleDD</span>(d<span class="op">/</span><span class="dv">10</span>)<span class="op">+</span>barX)</span>
<span id="cb1-293"><a href="#cb1-293" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">'y'</span><span class="op">,</span> firstBarY<span class="op">+</span><span class="dv">60</span>)</span>
<span id="cb1-294"><a href="#cb1-294" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">'height'</span><span class="op">,</span> d<span class="kw">=&gt;</span>d<span class="op">%</span><span class="dv">2</span><span class="op">===</span><span class="dv">0</span><span class="op">?</span> <span class="dv">9</span><span class="op">:</span><span class="dv">6</span>)</span>
<span id="cb1-295"><a href="#cb1-295" aria-hidden="true" tabindex="-1"></a>  <span class="co">// Labels</span></span>
<span id="cb1-296"><a href="#cb1-296" aria-hidden="true" tabindex="-1"></a>  svg<span class="op">.</span><span class="fu">selectAll</span>(<span class="st">'.timeLabel'</span>)</span>
<span id="cb1-297"><a href="#cb1-297" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">data</span>([<span class="vs">`-</span><span class="sc">${</span>barDDN<span class="sc">}</span><span class="vs">`</span><span class="op">,</span> <span class="vs">`</span><span class="sc">${</span>barMilsN<span class="sc">}</span><span class="vs">`</span><span class="op">,</span> <span class="vs">`</span><span class="sc">${</span>barBeatsN<span class="sc">}</span><span class="vs">`</span>])</span>
<span id="cb1-298"><a href="#cb1-298" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">enter</span>()</span>
<span id="cb1-299"><a href="#cb1-299" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">append</span>(<span class="st">'text'</span>)</span>
<span id="cb1-300"><a href="#cb1-300" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">'class'</span><span class="op">,</span> <span class="st">'timeLabel'</span>)</span>
<span id="cb1-301"><a href="#cb1-301" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">'x'</span><span class="op">,</span> barX<span class="op">+</span><span class="dv">2</span>)</span>
<span id="cb1-302"><a href="#cb1-302" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">'y'</span><span class="op">,</span> (d<span class="op">,</span>i)<span class="kw">=&gt;</span>i<span class="op">*</span><span class="dv">30</span><span class="op">+</span>firstBarY<span class="op">+</span><span class="dv">20</span>)</span>
<span id="cb1-303"><a href="#cb1-303" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">style</span>(<span class="st">"font-size"</span><span class="op">,</span> <span class="vs">`</span><span class="sc">${</span>W <span class="op">&lt;</span> <span class="dv">300</span> <span class="op">?</span> <span class="dv">14</span> <span class="op">:</span> W <span class="op">&lt;</span> <span class="dv">400</span> <span class="op">?</span> <span class="dv">16</span> <span class="op">:</span> W <span class="op">&lt;</span> <span class="dv">500</span> <span class="op">?</span> <span class="dv">18</span> <span class="op">:</span> W <span class="op">&lt;</span> <span class="dv">600</span> <span class="op">?</span> <span class="dv">20</span> <span class="op">:</span> <span class="dv">22</span><span class="sc">}</span><span class="vs">px`</span>)</span>
<span id="cb1-304"><a href="#cb1-304" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">text</span>(d<span class="kw">=&gt;</span>d)<span class="op">;</span></span>
<span id="cb1-305"><a href="#cb1-305" aria-hidden="true" tabindex="-1"></a>  svg<span class="op">.</span><span class="fu">attr</span>(<span class="st">"id"</span><span class="op">,</span> <span class="st">"barClock"</span>)<span class="op">;</span></span>
<span id="cb1-306"><a href="#cb1-306" aria-hidden="true" tabindex="-1"></a>  <span class="cf">return</span> svg<span class="op">.</span><span class="fu">node</span>()<span class="op">;</span></span>
<span id="cb1-307"><a href="#cb1-307" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb1-308"><a href="#cb1-308" aria-hidden="true" tabindex="-1"></a>viewof location <span class="op">=</span> <span class="fu">worldMapCoordinates</span>([<span class="dv">162</span><span class="op">,</span> <span class="dv">0</span>]<span class="op">,</span> [width <span class="op">*</span> <span class="op">.</span><span class="dv">998</span><span class="op">,</span> <span class="bu">Math</span><span class="op">.</span><span class="fu">round</span>((<span class="dv">21</span> <span class="op">/</span> <span class="dv">40</span>) <span class="op">*</span> width)])</span>
<span id="cb1-309"><a href="#cb1-309" aria-hidden="true" tabindex="-1"></a><span class="co">// https://observablehq.com/@dbridges/visualizing-seasonal-daylight</span></span>
<span id="cb1-310"><a href="#cb1-310" aria-hidden="true" tabindex="-1"></a>app <span class="op">=</span> {</span>
<span id="cb1-311"><a href="#cb1-311" aria-hidden="true" tabindex="-1"></a><span class="kw">const</span> svg <span class="op">=</span> d3<span class="op">.</span><span class="fu">select</span>(DOM<span class="op">.</span><span class="fu">svg</span>(width<span class="op">,</span> height <span class="op">-</span> (width <span class="op">&lt;</span> <span class="dv">400</span> <span class="op">?</span> <span class="dv">10</span> <span class="op">:</span> width <span class="op">&lt;</span> <span class="dv">600</span> <span class="op">?</span> <span class="dv">15</span> <span class="op">:</span> width <span class="op">&lt;</span> <span class="dv">700</span> <span class="op">?</span> <span class="dv">30</span> <span class="op">:</span> <span class="dv">40</span>)))<span class="op">;</span></span>
<span id="cb1-312"><a href="#cb1-312" aria-hidden="true" tabindex="-1"></a>  svg<span class="op">.</span><span class="fu">style</span>(<span class="st">"user-select"</span><span class="op">,</span> <span class="st">"none"</span>)</span>
<span id="cb1-313"><a href="#cb1-313" aria-hidden="true" tabindex="-1"></a>     <span class="op">.</span><span class="fu">style</span>(<span class="st">"-webkit-user-select"</span><span class="op">,</span> <span class="st">"none"</span>)<span class="op">;</span></span>
<span id="cb1-314"><a href="#cb1-314" aria-hidden="true" tabindex="-1"></a>  svg<span class="op">.</span><span class="fu">attr</span>(<span class="st">"id"</span><span class="op">,</span> <span class="st">"daylightapp"</span>)</span>
<span id="cb1-315"><a href="#cb1-315" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> margin <span class="op">=</span> {<span class="dt">top</span><span class="op">:</span> <span class="dv">0</span><span class="op">,</span> <span class="dt">left</span><span class="op">:</span> <span class="dv">10</span><span class="op">,</span> <span class="dt">right</span><span class="op">:</span> <span class="dv">10</span><span class="op">,</span> <span class="dt">bottom</span><span class="op">:</span> <span class="dv">0</span><span class="op">,</span> <span class="dt">inner</span><span class="op">:</span> <span class="dv">3</span>}<span class="op">;</span></span>
<span id="cb1-316"><a href="#cb1-316" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> contentWidth <span class="op">=</span> width <span class="op">-</span> margin<span class="op">.</span><span class="at">left</span> <span class="op">-</span> margin<span class="op">.</span><span class="at">right</span> <span class="op">-</span> margin<span class="op">.</span><span class="at">inner</span><span class="op">;</span></span>
<span id="cb1-317"><a href="#cb1-317" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> columnWidth <span class="op">=</span> contentWidth <span class="op">/</span> <span class="dv">2</span><span class="op">;</span></span>
<span id="cb1-318"><a href="#cb1-318" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> date2022 <span class="op">=</span> <span class="kw">new</span> <span class="bu">Date</span>(<span class="dv">2022</span><span class="op">,</span> <span class="kw">new</span> <span class="bu">Date</span>()<span class="op">.</span><span class="fu">getMonth</span>()<span class="op">,</span> <span class="kw">new</span> <span class="bu">Date</span>()<span class="op">.</span><span class="fu">getDate</span>()<span class="op">,</span> <span class="kw">new</span> <span class="bu">Date</span>()<span class="op">.</span><span class="fu">getHours</span>())</span>
<span id="cb1-319"><a href="#cb1-319" aria-hidden="true" tabindex="-1"></a>  <span class="kw">let</span> selection <span class="op">=</span> {</span>
<span id="cb1-320"><a href="#cb1-320" aria-hidden="true" tabindex="-1"></a>    <span class="dt">date</span><span class="op">:</span> date2022<span class="op">,</span></span>
<span id="cb1-321"><a href="#cb1-321" aria-hidden="true" tabindex="-1"></a>    <span class="dt">hour</span><span class="op">:</span> date2022<span class="op">.</span><span class="fu">getHours</span>()</span>
<span id="cb1-322"><a href="#cb1-322" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb1-323"><a href="#cb1-323" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> renderPlot <span class="op">=</span> () <span class="kw">=&gt;</span> {</span>
<span id="cb1-324"><a href="#cb1-324" aria-hidden="true" tabindex="-1"></a>    svg<span class="op">.</span><span class="fu">selectAll</span>(<span class="st">"#daylightplot *"</span>)<span class="op">.</span><span class="fu">remove</span>()<span class="op">;</span></span>
<span id="cb1-325"><a href="#cb1-325" aria-hidden="true" tabindex="-1"></a>    svg<span class="op">.</span><span class="fu">select</span>(<span class="st">"#daylightplot"</span>)<span class="op">.</span><span class="fu">call</span>(daylightPlot<span class="op">,</span> {</span>
<span id="cb1-326"><a href="#cb1-326" aria-hidden="true" tabindex="-1"></a>      <span class="dt">width</span><span class="op">:</span> columnWidth <span class="op">/</span> <span class="fl">1.26</span><span class="op">,</span></span>
<span id="cb1-327"><a href="#cb1-327" aria-hidden="true" tabindex="-1"></a>      <span class="dt">height</span><span class="op">:</span> height <span class="op">/</span> <span class="fl">1.51</span> <span class="op">-</span> margin<span class="op">.</span><span class="at">top</span> <span class="op">-</span> margin<span class="op">.</span><span class="at">bottom</span><span class="op">,</span></span>
<span id="cb1-328"><a href="#cb1-328" aria-hidden="true" tabindex="-1"></a>      <span class="dt">year</span><span class="op">:</span> date2022<span class="op">.</span><span class="fu">getFullYear</span>()<span class="op">,</span></span>
<span id="cb1-329"><a href="#cb1-329" aria-hidden="true" tabindex="-1"></a>      <span class="dt">latitude</span><span class="op">:</span> location[<span class="dv">1</span>]<span class="op">,</span></span>
<span id="cb1-330"><a href="#cb1-330" aria-hidden="true" tabindex="-1"></a>      <span class="dt">defaultDate</span><span class="op">:</span> selection<span class="op">.</span><span class="at">date</span><span class="op">,</span></span>
<span id="cb1-331"><a href="#cb1-331" aria-hidden="true" tabindex="-1"></a>      <span class="dt">defaultHour</span><span class="op">:</span> selection<span class="op">.</span><span class="at">hour</span></span>
<span id="cb1-332"><a href="#cb1-332" aria-hidden="true" tabindex="-1"></a>    })</span>
<span id="cb1-333"><a href="#cb1-333" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb1-334"><a href="#cb1-334" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> renderGlobe <span class="op">=</span> () <span class="kw">=&gt;</span> {</span>
<span id="cb1-335"><a href="#cb1-335" aria-hidden="true" tabindex="-1"></a>    svg<span class="op">.</span><span class="fu">selectAll</span>(<span class="st">"#globe *"</span>)<span class="op">.</span><span class="fu">remove</span>()<span class="op">;</span></span>
<span id="cb1-336"><a href="#cb1-336" aria-hidden="true" tabindex="-1"></a>    svg<span class="op">.</span><span class="fu">selectAll</span>(<span class="st">"#globe"</span>)<span class="op">.</span><span class="fu">call</span>(globe<span class="op">,</span> { <span class="dt">width</span><span class="op">:</span> columnWidth <span class="op">*</span> <span class="fl">1.2</span><span class="op">,</span> location<span class="op">,</span> <span class="op">...</span>selection })<span class="op">;</span></span>
<span id="cb1-337"><a href="#cb1-337" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb1-338"><a href="#cb1-338" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> renderSolarSystem <span class="op">=</span> () <span class="kw">=&gt;</span> {</span>
<span id="cb1-339"><a href="#cb1-339" aria-hidden="true" tabindex="-1"></a>    svg<span class="op">.</span><span class="fu">selectAll</span>(<span class="st">"#solar-system *"</span>)<span class="op">.</span><span class="fu">remove</span>()<span class="op">;</span></span>
<span id="cb1-340"><a href="#cb1-340" aria-hidden="true" tabindex="-1"></a>    svg<span class="op">.</span><span class="fu">selectAll</span>(<span class="st">"#solar-system"</span>)<span class="op">.</span><span class="fu">call</span>(solarSystem<span class="op">,</span></span>
<span id="cb1-341"><a href="#cb1-341" aria-hidden="true" tabindex="-1"></a>                                        columnWidth <span class="op">/</span> <span class="fl">1.1</span><span class="op">,</span></span>
<span id="cb1-342"><a href="#cb1-342" aria-hidden="true" tabindex="-1"></a>                                        location<span class="op">,</span></span>
<span id="cb1-343"><a href="#cb1-343" aria-hidden="true" tabindex="-1"></a>                                        selection<span class="op">.</span><span class="at">date</span><span class="op">,</span></span>
<span id="cb1-344"><a href="#cb1-344" aria-hidden="true" tabindex="-1"></a>                                        selection<span class="op">.</span><span class="at">hour</span>)<span class="op">;</span></span>
<span id="cb1-345"><a href="#cb1-345" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb1-346"><a href="#cb1-346" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> setSelection <span class="op">=</span> (newSelection<span class="op">,</span> forceRender <span class="op">=</span> <span class="kw">false</span>) <span class="kw">=&gt;</span> {</span>
<span id="cb1-347"><a href="#cb1-347" aria-hidden="true" tabindex="-1"></a>    <span class="kw">const</span> prev <span class="op">=</span> {<span class="op">...</span>selection}<span class="op">;</span></span>
<span id="cb1-348"><a href="#cb1-348" aria-hidden="true" tabindex="-1"></a>    selection <span class="op">=</span> newSelection<span class="op">;</span></span>
<span id="cb1-349"><a href="#cb1-349" aria-hidden="true" tabindex="-1"></a>    svg<span class="op">.</span><span class="fu">node</span>()<span class="op">.</span><span class="at">value</span> <span class="op">=</span> selection<span class="op">;</span></span>
<span id="cb1-350"><a href="#cb1-350" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> (forceRender) {</span>
<span id="cb1-351"><a href="#cb1-351" aria-hidden="true" tabindex="-1"></a>      <span class="fu">renderPlot</span>()<span class="op">;</span></span>
<span id="cb1-352"><a href="#cb1-352" aria-hidden="true" tabindex="-1"></a>      <span class="fu">renderSolarSystem</span>()<span class="op">;</span></span>
<span id="cb1-353"><a href="#cb1-353" aria-hidden="true" tabindex="-1"></a>      <span class="fu">renderGlobe</span>()<span class="op">;</span></span>
<span id="cb1-354"><a href="#cb1-354" aria-hidden="true" tabindex="-1"></a>    } <span class="cf">else</span> <span class="cf">if</span> (prev<span class="op">.</span><span class="at">hour</span> <span class="op">!==</span> selection<span class="op">.</span><span class="at">hour</span> <span class="op">||</span> prev<span class="op">.</span><span class="at">date</span> <span class="op">!==</span> selection<span class="op">.</span><span class="at">date</span>) {</span>
<span id="cb1-355"><a href="#cb1-355" aria-hidden="true" tabindex="-1"></a>      <span class="fu">renderSolarSystem</span>()<span class="op">;</span></span>
<span id="cb1-356"><a href="#cb1-356" aria-hidden="true" tabindex="-1"></a>      <span class="fu">renderGlobe</span>()<span class="op">;</span></span>
<span id="cb1-357"><a href="#cb1-357" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb1-358"><a href="#cb1-358" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb1-359"><a href="#cb1-359" aria-hidden="true" tabindex="-1"></a>  svg<span class="op">.</span><span class="fu">append</span>(<span class="st">"g"</span>)</span>
<span id="cb1-360"><a href="#cb1-360" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">"id"</span><span class="op">,</span> <span class="st">"solar-system"</span>)</span>
<span id="cb1-361"><a href="#cb1-361" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">"transform"</span><span class="op">,</span> <span class="vs">`translate(</span><span class="sc">${</span>margin<span class="op">.</span><span class="at">left</span> <span class="op">+</span> <span class="dv">2</span><span class="sc">}</span><span class="vs">, </span><span class="sc">${</span>margin<span class="op">.</span><span class="at">top</span> <span class="op">+</span> height <span class="op">/</span> <span class="fl">7.5</span><span class="sc">}</span><span class="vs">)`</span>)<span class="op">;</span></span>
<span id="cb1-362"><a href="#cb1-362" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> plot <span class="op">=</span> svg<span class="op">.</span><span class="fu">append</span>(<span class="st">"g"</span>)</span>
<span id="cb1-363"><a href="#cb1-363" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">"id"</span><span class="op">,</span> <span class="st">"daylightplot"</span>)</span>
<span id="cb1-364"><a href="#cb1-364" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">"transform"</span><span class="op">,</span> <span class="vs">`translate(</span><span class="sc">${</span>margin<span class="op">.</span><span class="at">left</span><span class="sc">}</span><span class="vs">, </span><span class="sc">${</span>margin<span class="op">.</span><span class="at">top</span> <span class="op">+</span> height <span class="op">/</span> <span class="dv">4</span><span class="sc">}</span><span class="vs">)`</span>)<span class="op">;</span></span>
<span id="cb1-365"><a href="#cb1-365" aria-hidden="true" tabindex="-1"></a>  svg<span class="op">.</span><span class="fu">append</span>(<span class="st">"g"</span>)</span>
<span id="cb1-366"><a href="#cb1-366" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">"id"</span><span class="op">,</span> <span class="st">"globe"</span>)</span>
<span id="cb1-367"><a href="#cb1-367" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">"transform"</span><span class="op">,</span> <span class="vs">`translate(</span><span class="sc">${</span>margin<span class="op">.</span><span class="at">left</span> <span class="op">+</span> margin<span class="op">.</span><span class="at">inner</span> <span class="op">+</span> columnWidth <span class="op">/</span> <span class="fl">1.25</span><span class="sc">}</span><span class="vs">, </span><span class="sc">${</span>margin<span class="op">.</span><span class="at">top</span> <span class="op">+</span> <span class="bu">Number</span>(columnWidth <span class="op">&lt;</span> <span class="dv">300</span>) <span class="op">*</span> <span class="dv">12</span><span class="sc">}</span><span class="vs">)`</span>)<span class="op">;</span></span>
<span id="cb1-368"><a href="#cb1-368" aria-hidden="true" tabindex="-1"></a>  <span class="fu">setSelection</span>(selection<span class="op">,</span> <span class="kw">true</span>)<span class="op">;</span></span>
<span id="cb1-369"><a href="#cb1-369" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> handleDateHourChange <span class="op">=</span> ({ target<span class="op">,</span> <span class="dt">detail</span><span class="op">:</span> { date<span class="op">,</span> hour }}) <span class="kw">=&gt;</span> {</span>
<span id="cb1-370"><a href="#cb1-370" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> (date <span class="op">!=</span> <span class="kw">null</span> <span class="op">&amp;&amp;</span> hour <span class="op">!=</span> <span class="kw">null</span>) <span class="fu">setSelection</span>({<span class="op">...</span>selection<span class="op">,</span> date<span class="op">,</span> hour})<span class="op">;</span></span>
<span id="cb1-371"><a href="#cb1-371" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb1-372"><a href="#cb1-372" aria-hidden="true" tabindex="-1"></a>  svg<span class="op">.</span><span class="fu">node</span>()<span class="op">.</span><span class="fu">addEventListener</span>(EventType<span class="op">.</span><span class="at">DateHourChange</span><span class="op">,</span> handleDateHourChange<span class="op">,</span> <span class="kw">false</span>)<span class="op">;</span></span>
<span id="cb1-373"><a href="#cb1-373" aria-hidden="true" tabindex="-1"></a>  <span class="cf">return</span> svg<span class="op">.</span><span class="fu">node</span>()<span class="op">;</span></span>
<span id="cb1-374"><a href="#cb1-374" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb1-375"><a href="#cb1-375" aria-hidden="true" tabindex="-1"></a><span class="co">// https://observablehq.com/@d3/simple-clock</span></span>
<span id="cb1-376"><a href="#cb1-376" aria-hidden="true" tabindex="-1"></a><span class="co">// https://observablehq.com/@drio/lets-build-an-analog-clock</span></span>
<span id="cb1-377"><a href="#cb1-377" aria-hidden="true" tabindex="-1"></a>clock <span class="op">=</span> {</span>
<span id="cb1-378"><a href="#cb1-378" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> clockRadius <span class="op">=</span> <span class="dv">200</span><span class="op">,</span></span>
<span id="cb1-379"><a href="#cb1-379" aria-hidden="true" tabindex="-1"></a>    margin <span class="op">=</span> <span class="dv">50</span><span class="op">,</span></span>
<span id="cb1-380"><a href="#cb1-380" aria-hidden="true" tabindex="-1"></a>    w <span class="op">=</span> (clockRadius <span class="op">+</span> margin) <span class="op">*</span> <span class="dv">2</span><span class="op">,</span></span>
<span id="cb1-381"><a href="#cb1-381" aria-hidden="true" tabindex="-1"></a>    h <span class="op">=</span> (clockRadius <span class="op">+</span> margin) <span class="op">*</span> <span class="dv">2</span><span class="op">,</span></span>
<span id="cb1-382"><a href="#cb1-382" aria-hidden="true" tabindex="-1"></a>    hourHandLength <span class="op">=</span> (<span class="dv">2</span> <span class="op">*</span> clockRadius) <span class="op">/</span> <span class="dv">3</span><span class="op">,</span></span>
<span id="cb1-383"><a href="#cb1-383" aria-hidden="true" tabindex="-1"></a>    minuteHandLength <span class="op">=</span> clockRadius<span class="op">,</span></span>
<span id="cb1-384"><a href="#cb1-384" aria-hidden="true" tabindex="-1"></a>    secondHandLength <span class="op">=</span> clockRadius <span class="op">-</span> <span class="dv">12</span><span class="op">,</span></span>
<span id="cb1-385"><a href="#cb1-385" aria-hidden="true" tabindex="-1"></a>    secondHandBalance <span class="op">=</span> <span class="dv">30</span><span class="op">,</span></span>
<span id="cb1-386"><a href="#cb1-386" aria-hidden="true" tabindex="-1"></a>    secondTickStart <span class="op">=</span> clockRadius<span class="op">,</span></span>
<span id="cb1-387"><a href="#cb1-387" aria-hidden="true" tabindex="-1"></a>    secondTickLength <span class="op">=</span> <span class="op">-</span><span class="dv">10</span><span class="op">,</span></span>
<span id="cb1-388"><a href="#cb1-388" aria-hidden="true" tabindex="-1"></a>    hourTickStart <span class="op">=</span> clockRadius<span class="op">,</span></span>
<span id="cb1-389"><a href="#cb1-389" aria-hidden="true" tabindex="-1"></a>    hourTickLength <span class="op">=</span> <span class="op">-</span><span class="dv">18</span><span class="op">,</span></span>
<span id="cb1-390"><a href="#cb1-390" aria-hidden="true" tabindex="-1"></a>    secondLabelRadius <span class="op">=</span> clockRadius <span class="op">+</span> <span class="dv">16</span><span class="op">,</span></span>
<span id="cb1-391"><a href="#cb1-391" aria-hidden="true" tabindex="-1"></a>    secondLabelYOffset <span class="op">=</span> <span class="dv">5</span><span class="op">,</span></span>
<span id="cb1-392"><a href="#cb1-392" aria-hidden="true" tabindex="-1"></a>    hourLabelRadius <span class="op">=</span> clockRadius <span class="op">-</span> <span class="dv">40</span><span class="op">,</span></span>
<span id="cb1-393"><a href="#cb1-393" aria-hidden="true" tabindex="-1"></a>    hourLabelYOffset <span class="op">=</span> <span class="dv">7</span><span class="op">,</span></span>
<span id="cb1-394"><a href="#cb1-394" aria-hidden="true" tabindex="-1"></a>    radians <span class="op">=</span> <span class="bu">Math</span><span class="op">.</span><span class="cn">PI</span> <span class="op">/</span> <span class="dv">180</span><span class="op">;</span></span>
<span id="cb1-395"><a href="#cb1-395" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> ten <span class="op">=</span> d3</span>
<span id="cb1-396"><a href="#cb1-396" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">scaleLinear</span>()</span>
<span id="cb1-397"><a href="#cb1-397" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">range</span>([<span class="dv">0</span><span class="op">,</span> <span class="dv">360</span>])</span>
<span id="cb1-398"><a href="#cb1-398" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">domain</span>([<span class="dv">0</span><span class="op">,</span> <span class="dv">10</span>])<span class="op">;</span></span>
<span id="cb1-399"><a href="#cb1-399" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> sto <span class="op">=</span> d3</span>
<span id="cb1-400"><a href="#cb1-400" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">scaleLinear</span>()</span>
<span id="cb1-401"><a href="#cb1-401" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">range</span>([<span class="dv">0</span><span class="op">,</span> <span class="dv">360</span>])</span>
<span id="cb1-402"><a href="#cb1-402" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">domain</span>([<span class="dv">0</span><span class="op">,</span> <span class="dv">100</span>])<span class="op">;</span></span>
<span id="cb1-403"><a href="#cb1-403" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> handData <span class="op">=</span> [</span>
<span id="cb1-404"><a href="#cb1-404" aria-hidden="true" tabindex="-1"></a>    {</span>
<span id="cb1-405"><a href="#cb1-405" aria-hidden="true" tabindex="-1"></a>      <span class="dt">type</span><span class="op">:</span> <span class="st">"hour"</span><span class="op">,</span></span>
<span id="cb1-406"><a href="#cb1-406" aria-hidden="true" tabindex="-1"></a>      <span class="dt">value</span><span class="op">:</span> <span class="dv">0</span><span class="op">,</span></span>
<span id="cb1-407"><a href="#cb1-407" aria-hidden="true" tabindex="-1"></a>      <span class="dt">length</span><span class="op">:</span> <span class="op">-</span>hourHandLength<span class="op">,</span></span>
<span id="cb1-408"><a href="#cb1-408" aria-hidden="true" tabindex="-1"></a>      <span class="dt">scale</span><span class="op">:</span> ten</span>
<span id="cb1-409"><a href="#cb1-409" aria-hidden="true" tabindex="-1"></a>    }<span class="op">,</span></span>
<span id="cb1-410"><a href="#cb1-410" aria-hidden="true" tabindex="-1"></a>    {</span>
<span id="cb1-411"><a href="#cb1-411" aria-hidden="true" tabindex="-1"></a>      <span class="dt">type</span><span class="op">:</span> <span class="st">"minute"</span><span class="op">,</span></span>
<span id="cb1-412"><a href="#cb1-412" aria-hidden="true" tabindex="-1"></a>      <span class="dt">value</span><span class="op">:</span> <span class="dv">0</span><span class="op">,</span></span>
<span id="cb1-413"><a href="#cb1-413" aria-hidden="true" tabindex="-1"></a>      <span class="dt">length</span><span class="op">:</span> <span class="op">-</span>minuteHandLength<span class="op">,</span></span>
<span id="cb1-414"><a href="#cb1-414" aria-hidden="true" tabindex="-1"></a>      <span class="dt">scale</span><span class="op">:</span> sto</span>
<span id="cb1-415"><a href="#cb1-415" aria-hidden="true" tabindex="-1"></a>    }<span class="op">,</span></span>
<span id="cb1-416"><a href="#cb1-416" aria-hidden="true" tabindex="-1"></a>    {</span>
<span id="cb1-417"><a href="#cb1-417" aria-hidden="true" tabindex="-1"></a>      <span class="dt">type</span><span class="op">:</span> <span class="st">"second"</span><span class="op">,</span></span>
<span id="cb1-418"><a href="#cb1-418" aria-hidden="true" tabindex="-1"></a>      <span class="dt">value</span><span class="op">:</span> <span class="dv">0</span><span class="op">,</span></span>
<span id="cb1-419"><a href="#cb1-419" aria-hidden="true" tabindex="-1"></a>      <span class="dt">length</span><span class="op">:</span> <span class="op">-</span>secondHandLength<span class="op">,</span></span>
<span id="cb1-420"><a href="#cb1-420" aria-hidden="true" tabindex="-1"></a>      <span class="dt">scale</span><span class="op">:</span> sto<span class="op">,</span></span>
<span id="cb1-421"><a href="#cb1-421" aria-hidden="true" tabindex="-1"></a>      <span class="dt">balance</span><span class="op">:</span> secondHandBalance</span>
<span id="cb1-422"><a href="#cb1-422" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb1-423"><a href="#cb1-423" aria-hidden="true" tabindex="-1"></a>  ]<span class="op">;</span></span>
<span id="cb1-424"><a href="#cb1-424" aria-hidden="true" tabindex="-1"></a>  <span class="kw">function</span> <span class="fu">drawClock</span>() {</span>
<span id="cb1-425"><a href="#cb1-425" aria-hidden="true" tabindex="-1"></a>    <span class="co">// create all the clock elements</span></span>
<span id="cb1-426"><a href="#cb1-426" aria-hidden="true" tabindex="-1"></a>    <span class="fu">updateData</span>()<span class="op">;</span> <span class="co">//draw them in the correct starting position</span></span>
<span id="cb1-427"><a href="#cb1-427" aria-hidden="true" tabindex="-1"></a>    <span class="kw">const</span> face <span class="op">=</span> svg</span>
<span id="cb1-428"><a href="#cb1-428" aria-hidden="true" tabindex="-1"></a>      <span class="op">.</span><span class="fu">append</span>(<span class="st">"g"</span>)</span>
<span id="cb1-429"><a href="#cb1-429" aria-hidden="true" tabindex="-1"></a>      <span class="op">.</span><span class="fu">attr</span>(<span class="st">"id"</span><span class="op">,</span> <span class="st">"clock-face"</span>)</span>
<span id="cb1-430"><a href="#cb1-430" aria-hidden="true" tabindex="-1"></a>      <span class="op">.</span><span class="fu">attr</span>(<span class="st">"transform"</span><span class="op">,</span> <span class="vs">`translate(</span><span class="sc">${</span>[w <span class="op">/</span> <span class="dv">2</span><span class="op">,</span> h <span class="op">/</span> <span class="dv">2</span>]<span class="sc">}</span><span class="vs">)`</span>)<span class="op">;</span></span>
<span id="cb1-431"><a href="#cb1-431" aria-hidden="true" tabindex="-1"></a>    <span class="co">// add marks for seconds</span></span>
<span id="cb1-432"><a href="#cb1-432" aria-hidden="true" tabindex="-1"></a>    face</span>
<span id="cb1-433"><a href="#cb1-433" aria-hidden="true" tabindex="-1"></a>      <span class="op">.</span><span class="fu">selectAll</span>(<span class="st">".second-tick"</span>)</span>
<span id="cb1-434"><a href="#cb1-434" aria-hidden="true" tabindex="-1"></a>      <span class="op">.</span><span class="fu">data</span>(d3<span class="op">.</span><span class="fu">range</span>(<span class="dv">0</span><span class="op">,</span> <span class="dv">100</span>))</span>
<span id="cb1-435"><a href="#cb1-435" aria-hidden="true" tabindex="-1"></a>      <span class="op">.</span><span class="fu">enter</span>()</span>
<span id="cb1-436"><a href="#cb1-436" aria-hidden="true" tabindex="-1"></a>      <span class="op">.</span><span class="fu">append</span>(<span class="st">"line"</span>)</span>
<span id="cb1-437"><a href="#cb1-437" aria-hidden="true" tabindex="-1"></a>      <span class="op">.</span><span class="fu">attr</span>(<span class="st">"class"</span><span class="op">,</span> <span class="st">"second-tick"</span>)</span>
<span id="cb1-438"><a href="#cb1-438" aria-hidden="true" tabindex="-1"></a>      <span class="op">.</span><span class="fu">attr</span>(<span class="st">"x1"</span><span class="op">,</span> <span class="dv">0</span>)</span>
<span id="cb1-439"><a href="#cb1-439" aria-hidden="true" tabindex="-1"></a>      <span class="op">.</span><span class="fu">attr</span>(<span class="st">"x2"</span><span class="op">,</span> <span class="dv">0</span>)</span>
<span id="cb1-440"><a href="#cb1-440" aria-hidden="true" tabindex="-1"></a>      <span class="op">.</span><span class="fu">attr</span>(<span class="st">"y1"</span><span class="op">,</span> secondTickStart)</span>
<span id="cb1-441"><a href="#cb1-441" aria-hidden="true" tabindex="-1"></a>      <span class="op">.</span><span class="fu">attr</span>(<span class="st">"y2"</span><span class="op">,</span> secondTickStart <span class="op">+</span> secondTickLength)</span>
<span id="cb1-442"><a href="#cb1-442" aria-hidden="true" tabindex="-1"></a>      <span class="op">.</span><span class="fu">attr</span>(<span class="st">"transform"</span><span class="op">,</span> d <span class="kw">=&gt;</span> <span class="vs">`rotate(</span><span class="sc">${</span><span class="fu">sto</span>(d)<span class="sc">}</span><span class="vs">)`</span>)<span class="op">;</span></span>
<span id="cb1-443"><a href="#cb1-443" aria-hidden="true" tabindex="-1"></a>    <span class="co">// and labels...</span></span>
<span id="cb1-444"><a href="#cb1-444" aria-hidden="true" tabindex="-1"></a>    face</span>
<span id="cb1-445"><a href="#cb1-445" aria-hidden="true" tabindex="-1"></a>      <span class="op">.</span><span class="fu">selectAll</span>(<span class="st">".second-label"</span>)</span>
<span id="cb1-446"><a href="#cb1-446" aria-hidden="true" tabindex="-1"></a>      <span class="op">.</span><span class="fu">data</span>(d3<span class="op">.</span><span class="fu">range</span>(<span class="dv">0</span><span class="op">,</span> <span class="dv">100</span><span class="op">,</span> <span class="dv">5</span>))</span>
<span id="cb1-447"><a href="#cb1-447" aria-hidden="true" tabindex="-1"></a>      <span class="op">.</span><span class="fu">enter</span>()</span>
<span id="cb1-448"><a href="#cb1-448" aria-hidden="true" tabindex="-1"></a>      <span class="op">.</span><span class="fu">append</span>(<span class="st">"text"</span>)</span>
<span id="cb1-449"><a href="#cb1-449" aria-hidden="true" tabindex="-1"></a>      <span class="op">.</span><span class="fu">attr</span>(<span class="st">"class"</span><span class="op">,</span> <span class="st">"second-label"</span>)</span>
<span id="cb1-450"><a href="#cb1-450" aria-hidden="true" tabindex="-1"></a>      <span class="op">.</span><span class="fu">attr</span>(<span class="st">"text-anchor"</span><span class="op">,</span> <span class="st">"middle"</span>)</span>
<span id="cb1-451"><a href="#cb1-451" aria-hidden="true" tabindex="-1"></a>      <span class="op">.</span><span class="fu">attr</span>(<span class="st">"x"</span><span class="op">,</span> d <span class="kw">=&gt;</span> secondLabelRadius <span class="op">*</span> <span class="bu">Math</span><span class="op">.</span><span class="fu">sin</span>(<span class="fu">sto</span>(d) <span class="op">*</span> radians))</span>
<span id="cb1-452"><a href="#cb1-452" aria-hidden="true" tabindex="-1"></a>      <span class="op">.</span><span class="fu">attr</span>(</span>
<span id="cb1-453"><a href="#cb1-453" aria-hidden="true" tabindex="-1"></a>        <span class="st">"y"</span><span class="op">,</span></span>
<span id="cb1-454"><a href="#cb1-454" aria-hidden="true" tabindex="-1"></a>        d <span class="kw">=&gt;</span></span>
<span id="cb1-455"><a href="#cb1-455" aria-hidden="true" tabindex="-1"></a>          <span class="op">-</span>secondLabelRadius <span class="op">*</span> <span class="bu">Math</span><span class="op">.</span><span class="fu">cos</span>(<span class="fu">sto</span>(d) <span class="op">*</span> radians) <span class="op">+</span> secondLabelYOffset</span>
<span id="cb1-456"><a href="#cb1-456" aria-hidden="true" tabindex="-1"></a>      )</span>
<span id="cb1-457"><a href="#cb1-457" aria-hidden="true" tabindex="-1"></a>      <span class="op">.</span><span class="fu">text</span>(d <span class="kw">=&gt;</span> d)<span class="op">;</span></span>
<span id="cb1-458"><a href="#cb1-458" aria-hidden="true" tabindex="-1"></a>    <span class="co">// ... and hours</span></span>
<span id="cb1-459"><a href="#cb1-459" aria-hidden="true" tabindex="-1"></a>    face</span>
<span id="cb1-460"><a href="#cb1-460" aria-hidden="true" tabindex="-1"></a>      <span class="op">.</span><span class="fu">selectAll</span>(<span class="st">".hour-tick"</span>)</span>
<span id="cb1-461"><a href="#cb1-461" aria-hidden="true" tabindex="-1"></a>      <span class="op">.</span><span class="fu">data</span>(d3<span class="op">.</span><span class="fu">range</span>(<span class="dv">0</span><span class="op">,</span> <span class="dv">10</span><span class="op">,</span> <span class="dv">1</span>))</span>
<span id="cb1-462"><a href="#cb1-462" aria-hidden="true" tabindex="-1"></a>      <span class="op">.</span><span class="fu">enter</span>()</span>
<span id="cb1-463"><a href="#cb1-463" aria-hidden="true" tabindex="-1"></a>      <span class="op">.</span><span class="fu">append</span>(<span class="st">"line"</span>)</span>
<span id="cb1-464"><a href="#cb1-464" aria-hidden="true" tabindex="-1"></a>      <span class="op">.</span><span class="fu">attr</span>(<span class="st">"class"</span><span class="op">,</span> <span class="st">"hour-tick"</span>)</span>
<span id="cb1-465"><a href="#cb1-465" aria-hidden="true" tabindex="-1"></a>      <span class="op">.</span><span class="fu">attr</span>(<span class="st">"x1"</span><span class="op">,</span> <span class="dv">0</span>)</span>
<span id="cb1-466"><a href="#cb1-466" aria-hidden="true" tabindex="-1"></a>      <span class="op">.</span><span class="fu">attr</span>(<span class="st">"x2"</span><span class="op">,</span> <span class="dv">0</span>)</span>
<span id="cb1-467"><a href="#cb1-467" aria-hidden="true" tabindex="-1"></a>      <span class="op">.</span><span class="fu">attr</span>(<span class="st">"y1"</span><span class="op">,</span> hourTickStart)</span>
<span id="cb1-468"><a href="#cb1-468" aria-hidden="true" tabindex="-1"></a>      <span class="op">.</span><span class="fu">attr</span>(<span class="st">"y2"</span><span class="op">,</span> hourTickStart <span class="op">+</span> hourTickLength)</span>
<span id="cb1-469"><a href="#cb1-469" aria-hidden="true" tabindex="-1"></a>      <span class="op">.</span><span class="fu">attr</span>(<span class="st">"transform"</span><span class="op">,</span> d <span class="kw">=&gt;</span> <span class="vs">`rotate(</span><span class="sc">${</span><span class="fu">ten</span>(d)<span class="sc">}</span><span class="vs">)`</span>)<span class="op">;</span></span>
<span id="cb1-470"><a href="#cb1-470" aria-hidden="true" tabindex="-1"></a>    face</span>
<span id="cb1-471"><a href="#cb1-471" aria-hidden="true" tabindex="-1"></a>      <span class="op">.</span><span class="fu">selectAll</span>(<span class="st">".hour-label"</span>)</span>
<span id="cb1-472"><a href="#cb1-472" aria-hidden="true" tabindex="-1"></a>      <span class="op">.</span><span class="fu">data</span>(d3<span class="op">.</span><span class="fu">range</span>(<span class="dv">0</span><span class="op">,</span> <span class="dv">10</span><span class="op">,</span> <span class="dv">1</span>))</span>
<span id="cb1-473"><a href="#cb1-473" aria-hidden="true" tabindex="-1"></a>      <span class="op">.</span><span class="fu">enter</span>()</span>
<span id="cb1-474"><a href="#cb1-474" aria-hidden="true" tabindex="-1"></a>      <span class="op">.</span><span class="fu">append</span>(<span class="st">"text"</span>)</span>
<span id="cb1-475"><a href="#cb1-475" aria-hidden="true" tabindex="-1"></a>      <span class="op">.</span><span class="fu">attr</span>(<span class="st">"class"</span><span class="op">,</span> <span class="st">"hour-label"</span>)</span>
<span id="cb1-476"><a href="#cb1-476" aria-hidden="true" tabindex="-1"></a>      <span class="op">.</span><span class="fu">attr</span>(<span class="st">"text-anchor"</span><span class="op">,</span> <span class="st">"middle"</span>)</span>
<span id="cb1-477"><a href="#cb1-477" aria-hidden="true" tabindex="-1"></a>      <span class="op">.</span><span class="fu">attr</span>(<span class="st">"x"</span><span class="op">,</span> d <span class="kw">=&gt;</span> hourLabelRadius <span class="op">*</span> <span class="bu">Math</span><span class="op">.</span><span class="fu">sin</span>(<span class="fu">ten</span>(d) <span class="op">*</span> radians))</span>
<span id="cb1-478"><a href="#cb1-478" aria-hidden="true" tabindex="-1"></a>      <span class="op">.</span><span class="fu">attr</span>(</span>
<span id="cb1-479"><a href="#cb1-479" aria-hidden="true" tabindex="-1"></a>        <span class="st">"y"</span><span class="op">,</span></span>
<span id="cb1-480"><a href="#cb1-480" aria-hidden="true" tabindex="-1"></a>        d <span class="kw">=&gt;</span> <span class="op">-</span>hourLabelRadius <span class="op">*</span> <span class="bu">Math</span><span class="op">.</span><span class="fu">cos</span>(<span class="fu">ten</span>(d) <span class="op">*</span> radians) <span class="op">+</span> hourLabelYOffset</span>
<span id="cb1-481"><a href="#cb1-481" aria-hidden="true" tabindex="-1"></a>      )</span>
<span id="cb1-482"><a href="#cb1-482" aria-hidden="true" tabindex="-1"></a>      <span class="op">.</span><span class="fu">text</span>(d <span class="kw">=&gt;</span> d)<span class="op">;</span></span>
<span id="cb1-483"><a href="#cb1-483" aria-hidden="true" tabindex="-1"></a>    <span class="kw">const</span> hands <span class="op">=</span> face<span class="op">.</span><span class="fu">append</span>(<span class="st">"g"</span>)<span class="op">.</span><span class="fu">attr</span>(<span class="st">"id"</span><span class="op">,</span> <span class="st">"clock-hands"</span>)<span class="op">;</span></span>
<span id="cb1-484"><a href="#cb1-484" aria-hidden="true" tabindex="-1"></a>    hands</span>
<span id="cb1-485"><a href="#cb1-485" aria-hidden="true" tabindex="-1"></a>      <span class="op">.</span><span class="fu">selectAll</span>(<span class="st">"line"</span>)</span>
<span id="cb1-486"><a href="#cb1-486" aria-hidden="true" tabindex="-1"></a>      <span class="op">.</span><span class="fu">data</span>(handData)</span>
<span id="cb1-487"><a href="#cb1-487" aria-hidden="true" tabindex="-1"></a>      <span class="op">.</span><span class="fu">enter</span>()</span>
<span id="cb1-488"><a href="#cb1-488" aria-hidden="true" tabindex="-1"></a>      <span class="op">.</span><span class="fu">append</span>(<span class="st">"line"</span>)</span>
<span id="cb1-489"><a href="#cb1-489" aria-hidden="true" tabindex="-1"></a>      <span class="op">.</span><span class="fu">attr</span>(<span class="st">"class"</span><span class="op">,</span> d <span class="kw">=&gt;</span> d<span class="op">.</span><span class="at">type</span> <span class="op">+</span> <span class="st">"-hand"</span>)</span>
<span id="cb1-490"><a href="#cb1-490" aria-hidden="true" tabindex="-1"></a>      <span class="op">.</span><span class="fu">attr</span>(<span class="st">"x1"</span><span class="op">,</span> <span class="dv">0</span>)</span>
<span id="cb1-491"><a href="#cb1-491" aria-hidden="true" tabindex="-1"></a>      <span class="op">.</span><span class="fu">attr</span>(<span class="st">"y1"</span><span class="op">,</span> d <span class="kw">=&gt;</span> d<span class="op">.</span><span class="at">balance</span> <span class="op">||</span> <span class="dv">0</span>)</span>
<span id="cb1-492"><a href="#cb1-492" aria-hidden="true" tabindex="-1"></a>      <span class="op">.</span><span class="fu">attr</span>(<span class="st">"x2"</span><span class="op">,</span> <span class="dv">0</span>)</span>
<span id="cb1-493"><a href="#cb1-493" aria-hidden="true" tabindex="-1"></a>      <span class="op">.</span><span class="fu">attr</span>(<span class="st">"y2"</span><span class="op">,</span> d <span class="kw">=&gt;</span> d<span class="op">.</span><span class="at">length</span>)</span>
<span id="cb1-494"><a href="#cb1-494" aria-hidden="true" tabindex="-1"></a>      <span class="op">.</span><span class="fu">attr</span>(<span class="st">"transform"</span><span class="op">,</span> d <span class="kw">=&gt;</span> <span class="vs">`rotate(</span><span class="sc">${</span>d<span class="op">.</span><span class="fu">scale</span>(d<span class="op">.</span><span class="at">value</span>)<span class="sc">}</span><span class="vs">)`</span>)<span class="op">;</span></span>
<span id="cb1-495"><a href="#cb1-495" aria-hidden="true" tabindex="-1"></a>    face</span>
<span id="cb1-496"><a href="#cb1-496" aria-hidden="true" tabindex="-1"></a>      <span class="op">.</span><span class="fu">append</span>(<span class="st">"g"</span>)</span>
<span id="cb1-497"><a href="#cb1-497" aria-hidden="true" tabindex="-1"></a>      <span class="op">.</span><span class="fu">attr</span>(<span class="st">"id"</span><span class="op">,</span> <span class="st">"face-overlay"</span>)</span>
<span id="cb1-498"><a href="#cb1-498" aria-hidden="true" tabindex="-1"></a>      <span class="op">.</span><span class="fu">append</span>(<span class="st">"circle"</span>)</span>
<span id="cb1-499"><a href="#cb1-499" aria-hidden="true" tabindex="-1"></a>      <span class="op">.</span><span class="fu">attr</span>(<span class="st">"class"</span><span class="op">,</span> <span class="st">"hands-cover"</span>)</span>
<span id="cb1-500"><a href="#cb1-500" aria-hidden="true" tabindex="-1"></a>      <span class="op">.</span><span class="fu">attr</span>(<span class="st">"x"</span><span class="op">,</span> <span class="dv">0</span>)</span>
<span id="cb1-501"><a href="#cb1-501" aria-hidden="true" tabindex="-1"></a>      <span class="op">.</span><span class="fu">attr</span>(<span class="st">"y"</span><span class="op">,</span> <span class="dv">0</span>)</span>
<span id="cb1-502"><a href="#cb1-502" aria-hidden="true" tabindex="-1"></a>      <span class="op">.</span><span class="fu">attr</span>(<span class="st">"r"</span><span class="op">,</span> clockRadius <span class="op">/</span> <span class="dv">20</span>)<span class="op">;</span></span>
<span id="cb1-503"><a href="#cb1-503" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb1-504"><a href="#cb1-504" aria-hidden="true" tabindex="-1"></a>  <span class="kw">function</span> <span class="fu">moveHands</span>() {</span>
<span id="cb1-505"><a href="#cb1-505" aria-hidden="true" tabindex="-1"></a>    <span class="kw">const</span> sel <span class="op">=</span> d3</span>
<span id="cb1-506"><a href="#cb1-506" aria-hidden="true" tabindex="-1"></a>      <span class="op">.</span><span class="fu">select</span>(<span class="st">"#clock-hands-final"</span>)</span>
<span id="cb1-507"><a href="#cb1-507" aria-hidden="true" tabindex="-1"></a>      <span class="op">.</span><span class="fu">selectAll</span>(<span class="st">"line"</span>)</span>
<span id="cb1-508"><a href="#cb1-508" aria-hidden="true" tabindex="-1"></a>      <span class="op">.</span><span class="fu">data</span>(handData)</span>
<span id="cb1-509"><a href="#cb1-509" aria-hidden="true" tabindex="-1"></a>      <span class="op">.</span><span class="fu">transition</span>()<span class="op">;</span></span>
<span id="cb1-510"><a href="#cb1-510" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> (fancySecondsOFF) sel<span class="op">.</span><span class="fu">ease</span>(d3<span class="op">.</span><span class="at">easeElastic</span><span class="op">.</span><span class="fu">period</span>(<span class="fl">0.5</span>))<span class="op">;</span></span>
<span id="cb1-511"><a href="#cb1-511" aria-hidden="true" tabindex="-1"></a>    sel<span class="op">.</span><span class="fu">attr</span>(<span class="st">"transform"</span><span class="op">,</span> d <span class="kw">=&gt;</span> <span class="vs">`rotate(</span><span class="sc">${</span>d<span class="op">.</span><span class="fu">scale</span>(d<span class="op">.</span><span class="at">value</span>)<span class="sc">}</span><span class="vs">)`</span>)<span class="op">;</span></span>
<span id="cb1-512"><a href="#cb1-512" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb1-513"><a href="#cb1-513" aria-hidden="true" tabindex="-1"></a>  <span class="kw">function</span> <span class="fu">updateData</span>() {</span>
<span id="cb1-514"><a href="#cb1-514" aria-hidden="true" tabindex="-1"></a>    handData[<span class="dv">0</span>]<span class="op">.</span><span class="at">value</span> <span class="op">=</span> <span class="op">!</span>fancySecondsOFF <span class="op">?</span> <span class="bu">Math</span><span class="op">.</span><span class="fu">floor</span>(selectedExact <span class="op">*</span> <span class="dv">10</span>) <span class="op">:</span> decTime[<span class="dv">0</span>]<span class="op">;</span></span>
<span id="cb1-515"><a href="#cb1-515" aria-hidden="true" tabindex="-1"></a>    handData[<span class="dv">1</span>]<span class="op">.</span><span class="at">value</span> <span class="op">=</span> <span class="op">!</span>fancySecondsOFF <span class="op">?</span> <span class="bu">Math</span><span class="op">.</span><span class="fu">floor</span>(selectedExact <span class="op">*</span> <span class="dv">10</span> <span class="op">%</span> <span class="dv">1</span> <span class="op">*</span> <span class="dv">100</span>) <span class="op">:</span> decTime<span class="op">.</span><span class="fu">slice</span>(<span class="dv">2</span><span class="op">,</span> <span class="dv">4</span>)<span class="op">;</span></span>
<span id="cb1-516"><a href="#cb1-516" aria-hidden="true" tabindex="-1"></a>    handData[<span class="dv">2</span>]<span class="op">.</span><span class="at">value</span> <span class="op">=</span> <span class="op">!</span>fancySecondsOFF <span class="op">?</span> selectedExact <span class="op">*</span> <span class="dv">10</span> <span class="op">%</span> <span class="dv">1</span> <span class="op">*</span> <span class="dv">100</span> <span class="op">%</span> <span class="dv">1</span> <span class="op">*</span> <span class="dv">100</span> <span class="op">:</span> decTime<span class="op">.</span><span class="fu">slice</span>(<span class="dv">4</span><span class="op">,</span> <span class="dv">6</span>)<span class="op">;</span></span>
<span id="cb1-517"><a href="#cb1-517" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb1-518"><a href="#cb1-518" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> svg <span class="op">=</span> d3</span>
<span id="cb1-519"><a href="#cb1-519" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">create</span>(<span class="st">"svg"</span>)</span>
<span id="cb1-520"><a href="#cb1-520" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">"viewBox"</span><span class="op">,</span> [<span class="dv">0</span><span class="op">,</span> <span class="dv">0</span><span class="op">,</span> w<span class="op">,</span> h])</span>
<span id="cb1-521"><a href="#cb1-521" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">style</span>(<span class="st">"max-width"</span><span class="op">,</span> <span class="vs">`</span><span class="sc">${</span>width <span class="op">/</span> <span class="fl">2.1</span><span class="sc">}</span><span class="vs">px`</span>)</span>
<span id="cb1-522"><a href="#cb1-522" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">"class"</span><span class="op">,</span> <span class="st">"clock-top"</span>)</span>
<span id="cb1-523"><a href="#cb1-523" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">"id"</span><span class="op">,</span> <span class="st">"clock"</span>)<span class="op">;</span></span>
<span id="cb1-524"><a href="#cb1-524" aria-hidden="true" tabindex="-1"></a>  svg</span>
<span id="cb1-525"><a href="#cb1-525" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">append</span>(<span class="st">"text"</span>)</span>
<span id="cb1-526"><a href="#cb1-526" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">text</span>(<span class="vs">`+</span><span class="sc">${</span>decTime<span class="sc">}</span><span class="vs">-</span><span class="sc">${</span>selectedZone<span class="sc">}</span><span class="vs">`</span>)</span>
<span id="cb1-527"><a href="#cb1-527" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">"x"</span><span class="op">,</span> clockRadius <span class="op">+</span> margin)</span>
<span id="cb1-528"><a href="#cb1-528" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">"y"</span><span class="op">,</span> clockRadius <span class="op">*</span> <span class="dv">2</span> <span class="op">+</span> margin <span class="op">*</span> <span class="fl">1.975</span>)</span>
<span id="cb1-529"><a href="#cb1-529" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">"text-anchor"</span><span class="op">,</span> <span class="st">"middle"</span>)</span>
<span id="cb1-530"><a href="#cb1-530" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">"font-size"</span><span class="op">,</span> <span class="dv">32</span>)</span>
<span id="cb1-531"><a href="#cb1-531" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">"font-family"</span><span class="op">,</span> <span class="st">"monospace"</span>)<span class="op">;</span></span>
<span id="cb1-532"><a href="#cb1-532" aria-hidden="true" tabindex="-1"></a>  <span class="fu">drawClock</span>()<span class="op">;</span></span>
<span id="cb1-533"><a href="#cb1-533" aria-hidden="true" tabindex="-1"></a>  <span class="co">// Animation</span></span>
<span id="cb1-534"><a href="#cb1-534" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> interval <span class="op">=</span> <span class="pp">setInterval</span>(</span>
<span id="cb1-535"><a href="#cb1-535" aria-hidden="true" tabindex="-1"></a>    () <span class="kw">=&gt;</span> {</span>
<span id="cb1-536"><a href="#cb1-536" aria-hidden="true" tabindex="-1"></a>      <span class="fu">updateData</span>()<span class="op">;</span></span>
<span id="cb1-537"><a href="#cb1-537" aria-hidden="true" tabindex="-1"></a>      <span class="fu">moveHands</span>()<span class="op">;</span></span>
<span id="cb1-538"><a href="#cb1-538" aria-hidden="true" tabindex="-1"></a>    }<span class="op">,</span></span>
<span id="cb1-539"><a href="#cb1-539" aria-hidden="true" tabindex="-1"></a>    <span class="op">!</span>fancySecondsOFF <span class="op">?</span> <span class="dv">10</span> <span class="op">:</span> <span class="dv">864</span></span>
<span id="cb1-540"><a href="#cb1-540" aria-hidden="true" tabindex="-1"></a>  )<span class="op">;</span></span>
<span id="cb1-541"><a href="#cb1-541" aria-hidden="true" tabindex="-1"></a>  invalidation<span class="op">.</span><span class="fu">then</span>(() <span class="kw">=&gt;</span> <span class="pp">clearInterval</span>(interval))<span class="op">;</span></span>
<span id="cb1-542"><a href="#cb1-542" aria-hidden="true" tabindex="-1"></a>  <span class="cf">return</span> svg<span class="op">.</span><span class="fu">node</span>()<span class="op">;</span></span>
<span id="cb1-543"><a href="#cb1-543" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb1-544"><a href="#cb1-544" aria-hidden="true" tabindex="-1"></a>clock1 <span class="op">=</span> {</span>
<span id="cb1-545"><a href="#cb1-545" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> clockRadius <span class="op">=</span> <span class="dv">200</span><span class="op">,</span></span>
<span id="cb1-546"><a href="#cb1-546" aria-hidden="true" tabindex="-1"></a>    margin <span class="op">=</span> <span class="dv">50</span><span class="op">,</span></span>
<span id="cb1-547"><a href="#cb1-547" aria-hidden="true" tabindex="-1"></a>    w <span class="op">=</span> (clockRadius <span class="op">+</span> margin) <span class="op">*</span> <span class="dv">2</span><span class="op">,</span></span>
<span id="cb1-548"><a href="#cb1-548" aria-hidden="true" tabindex="-1"></a>    h <span class="op">=</span> (clockRadius <span class="op">+</span> margin) <span class="op">*</span> <span class="dv">2</span><span class="op">,</span></span>
<span id="cb1-549"><a href="#cb1-549" aria-hidden="true" tabindex="-1"></a>    hourHandLength <span class="op">=</span> (<span class="dv">2</span> <span class="op">*</span> clockRadius) <span class="op">/</span> <span class="dv">3</span><span class="op">,</span></span>
<span id="cb1-550"><a href="#cb1-550" aria-hidden="true" tabindex="-1"></a>    minuteHandLength <span class="op">=</span> clockRadius<span class="op">,</span></span>
<span id="cb1-551"><a href="#cb1-551" aria-hidden="true" tabindex="-1"></a>    secondHandLength <span class="op">=</span> clockRadius <span class="op">-</span> <span class="dv">12</span><span class="op">,</span></span>
<span id="cb1-552"><a href="#cb1-552" aria-hidden="true" tabindex="-1"></a>    secondHandBalance <span class="op">=</span> <span class="dv">30</span><span class="op">,</span></span>
<span id="cb1-553"><a href="#cb1-553" aria-hidden="true" tabindex="-1"></a>    secondTickStart <span class="op">=</span> clockRadius<span class="op">,</span></span>
<span id="cb1-554"><a href="#cb1-554" aria-hidden="true" tabindex="-1"></a>    secondTickLength <span class="op">=</span> <span class="op">-</span><span class="dv">10</span><span class="op">,</span></span>
<span id="cb1-555"><a href="#cb1-555" aria-hidden="true" tabindex="-1"></a>    hourTickStart <span class="op">=</span> clockRadius<span class="op">,</span></span>
<span id="cb1-556"><a href="#cb1-556" aria-hidden="true" tabindex="-1"></a>    hourTickLength <span class="op">=</span> <span class="op">-</span><span class="dv">18</span><span class="op">,</span></span>
<span id="cb1-557"><a href="#cb1-557" aria-hidden="true" tabindex="-1"></a>    secondLabelRadius <span class="op">=</span> clockRadius <span class="op">+</span> <span class="dv">16</span><span class="op">,</span></span>
<span id="cb1-558"><a href="#cb1-558" aria-hidden="true" tabindex="-1"></a>    secondLabelYOffset <span class="op">=</span> <span class="dv">5</span><span class="op">,</span></span>
<span id="cb1-559"><a href="#cb1-559" aria-hidden="true" tabindex="-1"></a>    hourLabelRadius <span class="op">=</span> clockRadius <span class="op">-</span> <span class="dv">40</span><span class="op">,</span></span>
<span id="cb1-560"><a href="#cb1-560" aria-hidden="true" tabindex="-1"></a>    hourLabelYOffset <span class="op">=</span> <span class="dv">7</span><span class="op">,</span></span>
<span id="cb1-561"><a href="#cb1-561" aria-hidden="true" tabindex="-1"></a>    radians <span class="op">=</span> <span class="bu">Math</span><span class="op">.</span><span class="cn">PI</span> <span class="op">/</span> <span class="dv">180</span><span class="op">;</span></span>
<span id="cb1-562"><a href="#cb1-562" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> ten <span class="op">=</span> d3</span>
<span id="cb1-563"><a href="#cb1-563" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">scaleLinear</span>()</span>
<span id="cb1-564"><a href="#cb1-564" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">range</span>([<span class="dv">0</span><span class="op">,</span> <span class="dv">360</span>])</span>
<span id="cb1-565"><a href="#cb1-565" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">domain</span>([<span class="dv">0</span><span class="op">,</span> <span class="dv">10</span>])<span class="op">;</span></span>
<span id="cb1-566"><a href="#cb1-566" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> sto <span class="op">=</span> d3</span>
<span id="cb1-567"><a href="#cb1-567" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">scaleLinear</span>()</span>
<span id="cb1-568"><a href="#cb1-568" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">range</span>([<span class="dv">0</span><span class="op">,</span> <span class="dv">360</span>])</span>
<span id="cb1-569"><a href="#cb1-569" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">domain</span>([<span class="dv">0</span><span class="op">,</span> <span class="dv">100</span>])<span class="op">;</span></span>
<span id="cb1-570"><a href="#cb1-570" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> handData <span class="op">=</span> [</span>
<span id="cb1-571"><a href="#cb1-571" aria-hidden="true" tabindex="-1"></a>    {</span>
<span id="cb1-572"><a href="#cb1-572" aria-hidden="true" tabindex="-1"></a>      <span class="dt">type</span><span class="op">:</span> <span class="st">"hour"</span><span class="op">,</span></span>
<span id="cb1-573"><a href="#cb1-573" aria-hidden="true" tabindex="-1"></a>      <span class="dt">value</span><span class="op">:</span> <span class="dv">0</span><span class="op">,</span></span>
<span id="cb1-574"><a href="#cb1-574" aria-hidden="true" tabindex="-1"></a>      <span class="dt">length</span><span class="op">:</span> <span class="op">-</span>hourHandLength<span class="op">,</span></span>
<span id="cb1-575"><a href="#cb1-575" aria-hidden="true" tabindex="-1"></a>      <span class="dt">scale</span><span class="op">:</span> ten</span>
<span id="cb1-576"><a href="#cb1-576" aria-hidden="true" tabindex="-1"></a>    }<span class="op">,</span></span>
<span id="cb1-577"><a href="#cb1-577" aria-hidden="true" tabindex="-1"></a>    {</span>
<span id="cb1-578"><a href="#cb1-578" aria-hidden="true" tabindex="-1"></a>      <span class="dt">type</span><span class="op">:</span> <span class="st">"minute"</span><span class="op">,</span></span>
<span id="cb1-579"><a href="#cb1-579" aria-hidden="true" tabindex="-1"></a>      <span class="dt">value</span><span class="op">:</span> <span class="dv">0</span><span class="op">,</span></span>
<span id="cb1-580"><a href="#cb1-580" aria-hidden="true" tabindex="-1"></a>      <span class="dt">length</span><span class="op">:</span> <span class="op">-</span>minuteHandLength<span class="op">,</span></span>
<span id="cb1-581"><a href="#cb1-581" aria-hidden="true" tabindex="-1"></a>      <span class="dt">scale</span><span class="op">:</span> sto</span>
<span id="cb1-582"><a href="#cb1-582" aria-hidden="true" tabindex="-1"></a>    }<span class="op">,</span></span>
<span id="cb1-583"><a href="#cb1-583" aria-hidden="true" tabindex="-1"></a>    {</span>
<span id="cb1-584"><a href="#cb1-584" aria-hidden="true" tabindex="-1"></a>      <span class="dt">type</span><span class="op">:</span> <span class="st">"second"</span><span class="op">,</span></span>
<span id="cb1-585"><a href="#cb1-585" aria-hidden="true" tabindex="-1"></a>      <span class="dt">value</span><span class="op">:</span> <span class="dv">0</span><span class="op">,</span></span>
<span id="cb1-586"><a href="#cb1-586" aria-hidden="true" tabindex="-1"></a>      <span class="dt">length</span><span class="op">:</span> <span class="op">-</span>secondHandLength<span class="op">,</span></span>
<span id="cb1-587"><a href="#cb1-587" aria-hidden="true" tabindex="-1"></a>      <span class="dt">scale</span><span class="op">:</span> sto<span class="op">,</span></span>
<span id="cb1-588"><a href="#cb1-588" aria-hidden="true" tabindex="-1"></a>      <span class="dt">balance</span><span class="op">:</span> secondHandBalance</span>
<span id="cb1-589"><a href="#cb1-589" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb1-590"><a href="#cb1-590" aria-hidden="true" tabindex="-1"></a>  ]<span class="op">;</span></span>
<span id="cb1-591"><a href="#cb1-591" aria-hidden="true" tabindex="-1"></a>  <span class="kw">function</span> <span class="fu">drawClock</span>() {</span>
<span id="cb1-592"><a href="#cb1-592" aria-hidden="true" tabindex="-1"></a>    <span class="co">// create all the clock elements</span></span>
<span id="cb1-593"><a href="#cb1-593" aria-hidden="true" tabindex="-1"></a>    <span class="fu">updateData</span>()<span class="op">;</span> <span class="co">//draw them in the correct starting position</span></span>
<span id="cb1-594"><a href="#cb1-594" aria-hidden="true" tabindex="-1"></a>    <span class="kw">const</span> face <span class="op">=</span> svg</span>
<span id="cb1-595"><a href="#cb1-595" aria-hidden="true" tabindex="-1"></a>      <span class="op">.</span><span class="fu">append</span>(<span class="st">"g"</span>)</span>
<span id="cb1-596"><a href="#cb1-596" aria-hidden="true" tabindex="-1"></a>      <span class="op">.</span><span class="fu">attr</span>(<span class="st">"id"</span><span class="op">,</span> <span class="st">"clock-face"</span>)</span>
<span id="cb1-597"><a href="#cb1-597" aria-hidden="true" tabindex="-1"></a>      <span class="op">.</span><span class="fu">attr</span>(<span class="st">"transform"</span><span class="op">,</span> <span class="vs">`translate(</span><span class="sc">${</span>[w <span class="op">/</span> <span class="dv">2</span><span class="op">,</span> h <span class="op">/</span> <span class="dv">2</span>]<span class="sc">}</span><span class="vs">)`</span>)<span class="op">;</span></span>
<span id="cb1-598"><a href="#cb1-598" aria-hidden="true" tabindex="-1"></a>    <span class="co">// add marks for seconds</span></span>
<span id="cb1-599"><a href="#cb1-599" aria-hidden="true" tabindex="-1"></a>    face</span>
<span id="cb1-600"><a href="#cb1-600" aria-hidden="true" tabindex="-1"></a>      <span class="op">.</span><span class="fu">selectAll</span>(<span class="st">".second-tick"</span>)</span>
<span id="cb1-601"><a href="#cb1-601" aria-hidden="true" tabindex="-1"></a>      <span class="op">.</span><span class="fu">data</span>(d3<span class="op">.</span><span class="fu">range</span>(<span class="dv">0</span><span class="op">,</span> <span class="dv">100</span>))</span>
<span id="cb1-602"><a href="#cb1-602" aria-hidden="true" tabindex="-1"></a>      <span class="op">.</span><span class="fu">enter</span>()</span>
<span id="cb1-603"><a href="#cb1-603" aria-hidden="true" tabindex="-1"></a>      <span class="op">.</span><span class="fu">append</span>(<span class="st">"line"</span>)</span>
<span id="cb1-604"><a href="#cb1-604" aria-hidden="true" tabindex="-1"></a>      <span class="op">.</span><span class="fu">attr</span>(<span class="st">"class"</span><span class="op">,</span> <span class="st">"second-tick"</span>)</span>
<span id="cb1-605"><a href="#cb1-605" aria-hidden="true" tabindex="-1"></a>      <span class="op">.</span><span class="fu">attr</span>(<span class="st">"x1"</span><span class="op">,</span> <span class="dv">0</span>)</span>
<span id="cb1-606"><a href="#cb1-606" aria-hidden="true" tabindex="-1"></a>      <span class="op">.</span><span class="fu">attr</span>(<span class="st">"x2"</span><span class="op">,</span> <span class="dv">0</span>)</span>
<span id="cb1-607"><a href="#cb1-607" aria-hidden="true" tabindex="-1"></a>      <span class="op">.</span><span class="fu">attr</span>(<span class="st">"y1"</span><span class="op">,</span> secondTickStart)</span>
<span id="cb1-608"><a href="#cb1-608" aria-hidden="true" tabindex="-1"></a>      <span class="op">.</span><span class="fu">attr</span>(<span class="st">"y2"</span><span class="op">,</span> secondTickStart <span class="op">+</span> secondTickLength)</span>
<span id="cb1-609"><a href="#cb1-609" aria-hidden="true" tabindex="-1"></a>      <span class="op">.</span><span class="fu">attr</span>(<span class="st">"transform"</span><span class="op">,</span> d <span class="kw">=&gt;</span> <span class="vs">`rotate(</span><span class="sc">${</span><span class="fu">sto</span>(d)<span class="sc">}</span><span class="vs">)`</span>)<span class="op">;</span></span>
<span id="cb1-610"><a href="#cb1-610" aria-hidden="true" tabindex="-1"></a>    <span class="co">// and labels...</span></span>
<span id="cb1-611"><a href="#cb1-611" aria-hidden="true" tabindex="-1"></a>    face</span>
<span id="cb1-612"><a href="#cb1-612" aria-hidden="true" tabindex="-1"></a>      <span class="op">.</span><span class="fu">selectAll</span>(<span class="st">".second-label"</span>)</span>
<span id="cb1-613"><a href="#cb1-613" aria-hidden="true" tabindex="-1"></a>      <span class="op">.</span><span class="fu">data</span>(d3<span class="op">.</span><span class="fu">range</span>(<span class="dv">0</span><span class="op">,</span> <span class="dv">100</span><span class="op">,</span> <span class="dv">5</span>))</span>
<span id="cb1-614"><a href="#cb1-614" aria-hidden="true" tabindex="-1"></a>      <span class="op">.</span><span class="fu">enter</span>()</span>
<span id="cb1-615"><a href="#cb1-615" aria-hidden="true" tabindex="-1"></a>      <span class="op">.</span><span class="fu">append</span>(<span class="st">"text"</span>)</span>
<span id="cb1-616"><a href="#cb1-616" aria-hidden="true" tabindex="-1"></a>      <span class="op">.</span><span class="fu">attr</span>(<span class="st">"class"</span><span class="op">,</span> <span class="st">"second-label"</span>)</span>
<span id="cb1-617"><a href="#cb1-617" aria-hidden="true" tabindex="-1"></a>      <span class="op">.</span><span class="fu">attr</span>(<span class="st">"text-anchor"</span><span class="op">,</span> <span class="st">"middle"</span>)</span>
<span id="cb1-618"><a href="#cb1-618" aria-hidden="true" tabindex="-1"></a>      <span class="op">.</span><span class="fu">attr</span>(<span class="st">"x"</span><span class="op">,</span> d <span class="kw">=&gt;</span> secondLabelRadius <span class="op">*</span> <span class="bu">Math</span><span class="op">.</span><span class="fu">sin</span>(<span class="fu">sto</span>(d) <span class="op">*</span> radians))</span>
<span id="cb1-619"><a href="#cb1-619" aria-hidden="true" tabindex="-1"></a>      <span class="op">.</span><span class="fu">attr</span>(</span>
<span id="cb1-620"><a href="#cb1-620" aria-hidden="true" tabindex="-1"></a>        <span class="st">"y"</span><span class="op">,</span></span>
<span id="cb1-621"><a href="#cb1-621" aria-hidden="true" tabindex="-1"></a>        d <span class="kw">=&gt;</span></span>
<span id="cb1-622"><a href="#cb1-622" aria-hidden="true" tabindex="-1"></a>          <span class="op">-</span>secondLabelRadius <span class="op">*</span> <span class="bu">Math</span><span class="op">.</span><span class="fu">cos</span>(<span class="fu">sto</span>(d) <span class="op">*</span> radians) <span class="op">+</span> secondLabelYOffset</span>
<span id="cb1-623"><a href="#cb1-623" aria-hidden="true" tabindex="-1"></a>      )</span>
<span id="cb1-624"><a href="#cb1-624" aria-hidden="true" tabindex="-1"></a>      <span class="op">.</span><span class="fu">text</span>(d <span class="kw">=&gt;</span> d)<span class="op">;</span></span>
<span id="cb1-625"><a href="#cb1-625" aria-hidden="true" tabindex="-1"></a>    <span class="co">// ... and hours</span></span>
<span id="cb1-626"><a href="#cb1-626" aria-hidden="true" tabindex="-1"></a>    face</span>
<span id="cb1-627"><a href="#cb1-627" aria-hidden="true" tabindex="-1"></a>      <span class="op">.</span><span class="fu">selectAll</span>(<span class="st">".hour-tick"</span>)</span>
<span id="cb1-628"><a href="#cb1-628" aria-hidden="true" tabindex="-1"></a>      <span class="op">.</span><span class="fu">data</span>(d3<span class="op">.</span><span class="fu">range</span>(<span class="dv">0</span><span class="op">,</span> <span class="dv">10</span><span class="op">,</span> <span class="dv">1</span>))</span>
<span id="cb1-629"><a href="#cb1-629" aria-hidden="true" tabindex="-1"></a>      <span class="op">.</span><span class="fu">enter</span>()</span>
<span id="cb1-630"><a href="#cb1-630" aria-hidden="true" tabindex="-1"></a>      <span class="op">.</span><span class="fu">append</span>(<span class="st">"line"</span>)</span>
<span id="cb1-631"><a href="#cb1-631" aria-hidden="true" tabindex="-1"></a>      <span class="op">.</span><span class="fu">attr</span>(<span class="st">"class"</span><span class="op">,</span> <span class="st">"hour-tick"</span>)</span>
<span id="cb1-632"><a href="#cb1-632" aria-hidden="true" tabindex="-1"></a>      <span class="op">.</span><span class="fu">attr</span>(<span class="st">"x1"</span><span class="op">,</span> <span class="dv">0</span>)</span>
<span id="cb1-633"><a href="#cb1-633" aria-hidden="true" tabindex="-1"></a>      <span class="op">.</span><span class="fu">attr</span>(<span class="st">"x2"</span><span class="op">,</span> <span class="dv">0</span>)</span>
<span id="cb1-634"><a href="#cb1-634" aria-hidden="true" tabindex="-1"></a>      <span class="op">.</span><span class="fu">attr</span>(<span class="st">"y1"</span><span class="op">,</span> hourTickStart)</span>
<span id="cb1-635"><a href="#cb1-635" aria-hidden="true" tabindex="-1"></a>      <span class="op">.</span><span class="fu">attr</span>(<span class="st">"y2"</span><span class="op">,</span> hourTickStart <span class="op">+</span> hourTickLength)</span>
<span id="cb1-636"><a href="#cb1-636" aria-hidden="true" tabindex="-1"></a>      <span class="op">.</span><span class="fu">attr</span>(<span class="st">"transform"</span><span class="op">,</span> d <span class="kw">=&gt;</span> <span class="vs">`rotate(</span><span class="sc">${</span><span class="fu">ten</span>(d)<span class="sc">}</span><span class="vs">)`</span>)<span class="op">;</span></span>
<span id="cb1-637"><a href="#cb1-637" aria-hidden="true" tabindex="-1"></a>    face</span>
<span id="cb1-638"><a href="#cb1-638" aria-hidden="true" tabindex="-1"></a>      <span class="op">.</span><span class="fu">selectAll</span>(<span class="st">".hour-label"</span>)</span>
<span id="cb1-639"><a href="#cb1-639" aria-hidden="true" tabindex="-1"></a>      <span class="op">.</span><span class="fu">data</span>(d3<span class="op">.</span><span class="fu">range</span>(<span class="dv">0</span><span class="op">,</span> <span class="dv">10</span><span class="op">,</span> <span class="dv">1</span>))</span>
<span id="cb1-640"><a href="#cb1-640" aria-hidden="true" tabindex="-1"></a>      <span class="op">.</span><span class="fu">enter</span>()</span>
<span id="cb1-641"><a href="#cb1-641" aria-hidden="true" tabindex="-1"></a>      <span class="op">.</span><span class="fu">append</span>(<span class="st">"text"</span>)</span>
<span id="cb1-642"><a href="#cb1-642" aria-hidden="true" tabindex="-1"></a>      <span class="op">.</span><span class="fu">attr</span>(<span class="st">"class"</span><span class="op">,</span> <span class="st">"hour-label"</span>)</span>
<span id="cb1-643"><a href="#cb1-643" aria-hidden="true" tabindex="-1"></a>      <span class="op">.</span><span class="fu">attr</span>(<span class="st">"text-anchor"</span><span class="op">,</span> <span class="st">"middle"</span>)</span>
<span id="cb1-644"><a href="#cb1-644" aria-hidden="true" tabindex="-1"></a>      <span class="op">.</span><span class="fu">attr</span>(<span class="st">"x"</span><span class="op">,</span> d <span class="kw">=&gt;</span> hourLabelRadius <span class="op">*</span> <span class="bu">Math</span><span class="op">.</span><span class="fu">sin</span>(<span class="fu">ten</span>(d) <span class="op">*</span> radians))</span>
<span id="cb1-645"><a href="#cb1-645" aria-hidden="true" tabindex="-1"></a>      <span class="op">.</span><span class="fu">attr</span>(</span>
<span id="cb1-646"><a href="#cb1-646" aria-hidden="true" tabindex="-1"></a>        <span class="st">"y"</span><span class="op">,</span></span>
<span id="cb1-647"><a href="#cb1-647" aria-hidden="true" tabindex="-1"></a>        d <span class="kw">=&gt;</span> <span class="op">-</span>hourLabelRadius <span class="op">*</span> <span class="bu">Math</span><span class="op">.</span><span class="fu">cos</span>(<span class="fu">ten</span>(d) <span class="op">*</span> radians) <span class="op">+</span> hourLabelYOffset</span>
<span id="cb1-648"><a href="#cb1-648" aria-hidden="true" tabindex="-1"></a>      )</span>
<span id="cb1-649"><a href="#cb1-649" aria-hidden="true" tabindex="-1"></a>      <span class="op">.</span><span class="fu">text</span>(d <span class="kw">=&gt;</span> d)<span class="op">;</span></span>
<span id="cb1-650"><a href="#cb1-650" aria-hidden="true" tabindex="-1"></a>    <span class="kw">const</span> hands <span class="op">=</span> face<span class="op">.</span><span class="fu">append</span>(<span class="st">"g"</span>)<span class="op">.</span><span class="fu">attr</span>(<span class="st">"id"</span><span class="op">,</span> <span class="st">"clock-hands"</span>)<span class="op">;</span></span>
<span id="cb1-651"><a href="#cb1-651" aria-hidden="true" tabindex="-1"></a>    hands</span>
<span id="cb1-652"><a href="#cb1-652" aria-hidden="true" tabindex="-1"></a>      <span class="op">.</span><span class="fu">selectAll</span>(<span class="st">"line"</span>)</span>
<span id="cb1-653"><a href="#cb1-653" aria-hidden="true" tabindex="-1"></a>      <span class="op">.</span><span class="fu">data</span>(handData)</span>
<span id="cb1-654"><a href="#cb1-654" aria-hidden="true" tabindex="-1"></a>      <span class="op">.</span><span class="fu">enter</span>()</span>
<span id="cb1-655"><a href="#cb1-655" aria-hidden="true" tabindex="-1"></a>      <span class="op">.</span><span class="fu">append</span>(<span class="st">"line"</span>)</span>
<span id="cb1-656"><a href="#cb1-656" aria-hidden="true" tabindex="-1"></a>      <span class="op">.</span><span class="fu">attr</span>(<span class="st">"class"</span><span class="op">,</span> d <span class="kw">=&gt;</span> d<span class="op">.</span><span class="at">type</span> <span class="op">+</span> <span class="st">"-hand"</span>)</span>
<span id="cb1-657"><a href="#cb1-657" aria-hidden="true" tabindex="-1"></a>      <span class="op">.</span><span class="fu">attr</span>(<span class="st">"x1"</span><span class="op">,</span> <span class="dv">0</span>)</span>
<span id="cb1-658"><a href="#cb1-658" aria-hidden="true" tabindex="-1"></a>      <span class="op">.</span><span class="fu">attr</span>(<span class="st">"y1"</span><span class="op">,</span> d <span class="kw">=&gt;</span> d<span class="op">.</span><span class="at">balance</span> <span class="op">||</span> <span class="dv">0</span>)</span>
<span id="cb1-659"><a href="#cb1-659" aria-hidden="true" tabindex="-1"></a>      <span class="op">.</span><span class="fu">attr</span>(<span class="st">"x2"</span><span class="op">,</span> <span class="dv">0</span>)</span>
<span id="cb1-660"><a href="#cb1-660" aria-hidden="true" tabindex="-1"></a>      <span class="op">.</span><span class="fu">attr</span>(<span class="st">"y2"</span><span class="op">,</span> d <span class="kw">=&gt;</span> d<span class="op">.</span><span class="at">length</span>)</span>
<span id="cb1-661"><a href="#cb1-661" aria-hidden="true" tabindex="-1"></a>      <span class="op">.</span><span class="fu">attr</span>(<span class="st">"transform"</span><span class="op">,</span> d <span class="kw">=&gt;</span> <span class="vs">`rotate(</span><span class="sc">${</span>d<span class="op">.</span><span class="fu">scale</span>(d<span class="op">.</span><span class="at">value</span>)<span class="sc">}</span><span class="vs">)`</span>)<span class="op">;</span></span>
<span id="cb1-662"><a href="#cb1-662" aria-hidden="true" tabindex="-1"></a>    face</span>
<span id="cb1-663"><a href="#cb1-663" aria-hidden="true" tabindex="-1"></a>      <span class="op">.</span><span class="fu">append</span>(<span class="st">"g"</span>)</span>
<span id="cb1-664"><a href="#cb1-664" aria-hidden="true" tabindex="-1"></a>      <span class="op">.</span><span class="fu">attr</span>(<span class="st">"id"</span><span class="op">,</span> <span class="st">"face-overlay"</span>)</span>
<span id="cb1-665"><a href="#cb1-665" aria-hidden="true" tabindex="-1"></a>      <span class="op">.</span><span class="fu">append</span>(<span class="st">"circle"</span>)</span>
<span id="cb1-666"><a href="#cb1-666" aria-hidden="true" tabindex="-1"></a>      <span class="op">.</span><span class="fu">attr</span>(<span class="st">"class"</span><span class="op">,</span> <span class="st">"hands-cover"</span>)</span>
<span id="cb1-667"><a href="#cb1-667" aria-hidden="true" tabindex="-1"></a>      <span class="op">.</span><span class="fu">attr</span>(<span class="st">"x"</span><span class="op">,</span> <span class="dv">0</span>)</span>
<span id="cb1-668"><a href="#cb1-668" aria-hidden="true" tabindex="-1"></a>      <span class="op">.</span><span class="fu">attr</span>(<span class="st">"y"</span><span class="op">,</span> <span class="dv">0</span>)</span>
<span id="cb1-669"><a href="#cb1-669" aria-hidden="true" tabindex="-1"></a>      <span class="op">.</span><span class="fu">attr</span>(<span class="st">"r"</span><span class="op">,</span> clockRadius <span class="op">/</span> <span class="dv">20</span>)<span class="op">;</span></span>
<span id="cb1-670"><a href="#cb1-670" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb1-671"><a href="#cb1-671" aria-hidden="true" tabindex="-1"></a>  <span class="kw">function</span> <span class="fu">moveHands</span>() {</span>
<span id="cb1-672"><a href="#cb1-672" aria-hidden="true" tabindex="-1"></a>    <span class="kw">const</span> sel <span class="op">=</span> d3</span>
<span id="cb1-673"><a href="#cb1-673" aria-hidden="true" tabindex="-1"></a>      <span class="op">.</span><span class="fu">select</span>(<span class="st">"#clock-hands-final"</span>)</span>
<span id="cb1-674"><a href="#cb1-674" aria-hidden="true" tabindex="-1"></a>      <span class="op">.</span><span class="fu">selectAll</span>(<span class="st">"line"</span>)</span>
<span id="cb1-675"><a href="#cb1-675" aria-hidden="true" tabindex="-1"></a>      <span class="op">.</span><span class="fu">data</span>(handData)</span>
<span id="cb1-676"><a href="#cb1-676" aria-hidden="true" tabindex="-1"></a>      <span class="op">.</span><span class="fu">transition</span>()<span class="op">;</span></span>
<span id="cb1-677"><a href="#cb1-677" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> (fancySecondsOFF) sel<span class="op">.</span><span class="fu">ease</span>(d3<span class="op">.</span><span class="at">easeElastic</span><span class="op">.</span><span class="fu">period</span>(<span class="fl">0.5</span>))<span class="op">;</span></span>
<span id="cb1-678"><a href="#cb1-678" aria-hidden="true" tabindex="-1"></a>    sel<span class="op">.</span><span class="fu">attr</span>(<span class="st">"transform"</span><span class="op">,</span> d <span class="kw">=&gt;</span> <span class="vs">`rotate(</span><span class="sc">${</span>d<span class="op">.</span><span class="fu">scale</span>(d<span class="op">.</span><span class="at">value</span>)<span class="sc">}</span><span class="vs">)`</span>)<span class="op">;</span></span>
<span id="cb1-679"><a href="#cb1-679" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb1-680"><a href="#cb1-680" aria-hidden="true" tabindex="-1"></a>  <span class="kw">function</span> <span class="fu">updateData</span>() {</span>
<span id="cb1-681"><a href="#cb1-681" aria-hidden="true" tabindex="-1"></a>    handData[<span class="dv">0</span>]<span class="op">.</span><span class="at">value</span> <span class="op">=</span> <span class="op">!</span>fancySecondsOFF <span class="op">?</span> <span class="bu">Math</span><span class="op">.</span><span class="fu">floor</span>(selectedExactN <span class="op">*</span> <span class="dv">10</span>) <span class="op">:</span> decTimeN[<span class="dv">0</span>]<span class="op">;</span></span>
<span id="cb1-682"><a href="#cb1-682" aria-hidden="true" tabindex="-1"></a>    handData[<span class="dv">1</span>]<span class="op">.</span><span class="at">value</span> <span class="op">=</span> <span class="op">!</span>fancySecondsOFF <span class="op">?</span> <span class="bu">Math</span><span class="op">.</span><span class="fu">floor</span>(selectedExactN <span class="op">*</span> <span class="dv">10</span> <span class="op">%</span> <span class="dv">1</span> <span class="op">*</span> <span class="dv">100</span>) <span class="op">:</span> decTimeN<span class="op">.</span><span class="fu">slice</span>(<span class="dv">2</span><span class="op">,</span> <span class="dv">4</span>)<span class="op">;</span></span>
<span id="cb1-683"><a href="#cb1-683" aria-hidden="true" tabindex="-1"></a>    handData[<span class="dv">2</span>]<span class="op">.</span><span class="at">value</span> <span class="op">=</span> <span class="op">!</span>fancySecondsOFF <span class="op">?</span> selectedExactN <span class="op">*</span> <span class="dv">10</span> <span class="op">%</span> <span class="dv">1</span> <span class="op">*</span> <span class="dv">100</span> <span class="op">%</span> <span class="dv">1</span> <span class="op">*</span> <span class="dv">100</span> <span class="op">:</span> decTimeN<span class="op">.</span><span class="fu">slice</span>(<span class="dv">4</span><span class="op">,</span> <span class="dv">6</span>)<span class="op">;</span></span>
<span id="cb1-684"><a href="#cb1-684" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb1-685"><a href="#cb1-685" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> svg <span class="op">=</span> d3</span>
<span id="cb1-686"><a href="#cb1-686" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">create</span>(<span class="st">"svg"</span>)</span>
<span id="cb1-687"><a href="#cb1-687" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">"viewBox"</span><span class="op">,</span> [<span class="dv">0</span><span class="op">,</span> <span class="dv">0</span><span class="op">,</span> w<span class="op">,</span> h])</span>
<span id="cb1-688"><a href="#cb1-688" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">style</span>(<span class="st">"max-width"</span><span class="op">,</span> <span class="vs">`</span><span class="sc">${</span>width <span class="op">/</span> <span class="fl">2.1</span><span class="sc">}</span><span class="vs">px`</span>)</span>
<span id="cb1-689"><a href="#cb1-689" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">"class"</span><span class="op">,</span> <span class="st">"clock-btm"</span>)</span>
<span id="cb1-690"><a href="#cb1-690" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">"id"</span><span class="op">,</span> <span class="st">"clock"</span>)<span class="op">;</span></span>
<span id="cb1-691"><a href="#cb1-691" aria-hidden="true" tabindex="-1"></a>  svg</span>
<span id="cb1-692"><a href="#cb1-692" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">append</span>(<span class="st">"text"</span>)</span>
<span id="cb1-693"><a href="#cb1-693" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">text</span>(<span class="vs">`-</span><span class="sc">${</span>decTimeN<span class="sc">}</span><span class="vs">-</span><span class="sc">${</span>selectedZone<span class="sc">}</span><span class="vs">`</span>)</span>
<span id="cb1-694"><a href="#cb1-694" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">"x"</span><span class="op">,</span> clockRadius <span class="op">+</span> margin)</span>
<span id="cb1-695"><a href="#cb1-695" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">"y"</span><span class="op">,</span> clockRadius <span class="op">*</span> <span class="dv">2</span> <span class="op">+</span> margin <span class="op">*</span> <span class="fl">1.975</span>)</span>
<span id="cb1-696"><a href="#cb1-696" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">"text-anchor"</span><span class="op">,</span> <span class="st">"middle"</span>)</span>
<span id="cb1-697"><a href="#cb1-697" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">"font-size"</span><span class="op">,</span> <span class="dv">32</span>)</span>
<span id="cb1-698"><a href="#cb1-698" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">"font-family"</span><span class="op">,</span> <span class="st">"monospace"</span>)<span class="op">;</span></span>
<span id="cb1-699"><a href="#cb1-699" aria-hidden="true" tabindex="-1"></a>  <span class="fu">drawClock</span>()<span class="op">;</span></span>
<span id="cb1-700"><a href="#cb1-700" aria-hidden="true" tabindex="-1"></a>  <span class="co">// Animation</span></span>
<span id="cb1-701"><a href="#cb1-701" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> interval <span class="op">=</span> <span class="pp">setInterval</span>(</span>
<span id="cb1-702"><a href="#cb1-702" aria-hidden="true" tabindex="-1"></a>    () <span class="kw">=&gt;</span> {</span>
<span id="cb1-703"><a href="#cb1-703" aria-hidden="true" tabindex="-1"></a>      <span class="fu">updateData</span>()<span class="op">;</span></span>
<span id="cb1-704"><a href="#cb1-704" aria-hidden="true" tabindex="-1"></a>      <span class="fu">moveHands</span>()<span class="op">;</span></span>
<span id="cb1-705"><a href="#cb1-705" aria-hidden="true" tabindex="-1"></a>    }<span class="op">,</span></span>
<span id="cb1-706"><a href="#cb1-706" aria-hidden="true" tabindex="-1"></a>    <span class="op">!</span>fancySecondsOFF <span class="op">?</span> <span class="dv">10</span> <span class="op">:</span> <span class="dv">864</span></span>
<span id="cb1-707"><a href="#cb1-707" aria-hidden="true" tabindex="-1"></a>  )<span class="op">;</span></span>
<span id="cb1-708"><a href="#cb1-708" aria-hidden="true" tabindex="-1"></a>  invalidation<span class="op">.</span><span class="fu">then</span>(() <span class="kw">=&gt;</span> <span class="pp">clearInterval</span>(interval))<span class="op">;</span></span>
<span id="cb1-709"><a href="#cb1-709" aria-hidden="true" tabindex="-1"></a>  <span class="cf">return</span> svg<span class="op">.</span><span class="fu">node</span>()<span class="op">;</span></span>
<span id="cb1-710"><a href="#cb1-710" aria-hidden="true" tabindex="-1"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<div>
<div id="ojs-cell-1-1" data-nodetype="declaration">

</div>
</div>
</div>
<div class="cell-output cell-output-display">
<div>
<div id="ojs-cell-1-2" data-nodetype="declaration">

</div>
</div>
</div>
<div class="cell-output cell-output-display">
<div>
<div id="ojs-cell-1-3" data-nodetype="declaration">

</div>
</div>
</div>
<div class="cell-output cell-output-display">
<div>
<div id="ojs-cell-1-4" data-nodetype="declaration">

</div>
</div>
</div>
<div class="cell-output cell-output-display">
<div>
<div id="ojs-cell-1-5" data-nodetype="declaration">

</div>
</div>
</div>
<div class="cell-output cell-output-display">
<div>
<div id="ojs-cell-1-6" data-nodetype="declaration">

</div>
</div>
</div>
</div>
<p>The plot to the lower left of the mapüó∫Ô∏èvisualizes the night (blue) and day (yellow) time of day (x-axis) throughout every day of the year (y-axis) at the latitude of the red‚≠ïÔ∏ècircle on the mapüó∫Ô∏è. The vertical‚Üïposition of the red<font color="red">‚Äî</font>line (time of day) and the‚ÜîÔ∏éÔ∏èhorizontal position of the redüî¥dot (day of the year) on the plot control theüåêglobes above and to the right of the plot.</p>
</section>
<section id="zone" class="level4">
<h4 class="anchored" data-anchor-id="zone">Zone</h4>
<p>Drag the red‚≠ïÔ∏ècircle across the <a href="https://en.wikipedia.org/wiki/Meridian_%28geography%29#:~:text=words%2C%20it%20is-,a%20line%20of%20longitude,-.%20The%20position%20of">meridians</a> (vertical‚Üïgray lines) on the mapüó∫Ô∏èto see how changing time zones affects the time. Only the first digit of the Dec times shown above, the <span class="under tool" data-bs-toggle="tooltip" data-bs-title="a tenth of a day">deciday</span>, varies across time zones, because the 10 Dec time zones, numbered 0 through 9 on the mapüó∫Ô∏è, are each 1 <span class="under tool" data-bs-toggle="tooltip" data-bs-title="a tenth of a turn">deci<a href="https://en.wikipedia.org/wiki/Turn_%28angle%29#:~:text=a%20unit%20of%20plane%20angle%20measurement%20equal%20to%202%CF%80%C2%A0radians%2C%20360%C2%A0degrees">turn</a></span> (d<a href="https://en.wikipedia.org/wiki/Turn_%28angle%29#:~:text=the%20Greek%20letter,to%20one%20turn"><span class="math inline">\(\tau\)</span></a>) wide. Simply put, a <span class="under tool" data-bs-toggle="tooltip" data-bs-title="a tenth of a turn">deciturn</span> of longitude translates into a <span class="under tool" data-bs-toggle="tooltip" data-bs-title="a tenth of a day">deciday</span> of time.</p>
<p>The leftmost vertical‚Üïline on the mapüó∫Ô∏èis <a href="https://en.wikipedia.org/wiki/18th_meridian_west#:~:text=a%20line%20of%20longitude%20that%20extends%20from%20the%20North%20Pole%20across%20the%20Arctic%20Ocean%2C%20Greenland%2C%20Iceland%2C%20the%20Atlantic%20Ocean%2C%20the%20Canary%20Islands%2C%20the%20Southern%20Ocean%2C%20and%20Antarctica%20to%20the%20South%20Pole">Meridian 0</a>, the Dec <a href="https://en.wikipedia.org/wiki/International_Date_Line#:~:text=the%20line%20between%20the%20South%20and%20North%20Poles%20that%20is%20the%20boundary%20between%20one%20calendar%20day%20and%20the%20next">International Date Line</a> and <a href="https://en.wikipedia.org/wiki/Prime_meridian#:~:text=an%20arbitrarily%2Dchosen%20meridian%20%28a%20line%20of%20longitude%29%20in%20a%20geographic%20coordinate%20system%20at%20which%20longitude%20is%20defined%20to%20be%200%C2%B0">prime meridian</a>, which cuts across the Atlantic Ocean through IcelandüáÆüá∏just West of Africaüåçand is the boundary between Zone 9 and Zone 0, the rightmost and leftmost Dec time zones on the mapüó∫Ô∏è, respectively. Arranging Dec time zones from 0 to 9 yields a <a href="https://en.wikipedia.org/wiki/World_map#:~:text=south%2Dup%20map-,Pacific%2Dcentric%20map,-(more%20commonly%20used)">Pacific-centric</a> mapüó∫Ô∏è.</p>
<p>While only positive Dec time zones are shown on the mapüó∫Ô∏è, every Dec time zone can also be expressed as a negative number. Each pair of time zone numbers produces the same Dec time, but result in <a href="../../dec/date">Dec dates</a>üóìÔ∏èthat are 1 day apart. Negative time zone numbers can be useful for getting <a href="../../dec/date">Dec dates</a>üóìÔ∏èto match <a href="https://en.wikipedia.org/wiki/Gregorian_calendar#:~:text=the%20calendar%20used%20in%20most%20parts%20of%20the%20world">Gregorian calendar</a> datesüóìÔ∏èwith negative <a href="https://en.wikipedia.org/wiki/UTC_offset#:~:text=the%20difference%20in%20hours%20and%20minutes%20between%20Coordinated%20Universal%20Time%20(UTC)%20and%20the%20standard%20time%20at%20a%20particular%20place">UTC offsets</a>.</p>
<p>There are <a href="https://en.wikipedia.org/wiki/List_of_UTC_offsets">37 UTC offsets</a>, but only 10 Dec time zones. Conversion between Dec time zones and UTC offsets is inexact, because UTC offsets depend on geographic and political boundaries, whereas Dec time zones are determined solely by longitude. If you know your longitude in degrees (¬∞) or <span class="under tool" data-bs-toggle="tooltip" data-bs-title="hundredths of a turn">centi<a href="https://en.wikipedia.org/wiki/Turn_%28angle%29#:~:text=a%20unit%20of%20plane%20angle%20measurement%20equal%20to%202%CF%80%C2%A0radians%2C%20360%C2%A0degrees">turns</a></span> (<a href="https://en.wikipedia.org/wiki/Turn_%28angle%29#:~:text=the%20Greek%20letter,to%20one%20turn"><span class="math inline">\(c\tau\)</span></a>), you can look up your Dec time zone (TZ) in the table below.</p>
<table class="table">
<colgroup>
<col style="width: 12%">
<col style="width: 12%">
<col style="width: 12%">
<col style="width: 12%">
<col style="width: 12%">
<col style="width: 12%">
<col style="width: 12%">
<col style="width: 12%">
</colgroup>
<thead>
<tr class="header">
<th style="text-align: center;">TZ<br>+</th>
<th style="text-align: center;">TZ<br>-</th>
<th style="text-align: center;">Start<br>¬∞</th>
<th style="text-align: center;">Mid<br>¬∞</th>
<th style="text-align: center;">End<br>¬∞</th>
<th style="text-align: center;">Start<br><span class="math inline">\(c\tau\)</span></th>
<th style="text-align: center;">Mid<br><span class="math inline">\(c\tau\)</span></th>
<th style="text-align: center;">End<br><span class="math inline">\(c\tau\)</span></th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: center;">9</td>
<td style="text-align: center;">-1</td>
<td style="text-align: center;">-54</td>
<td style="text-align: center;">-36</td>
<td style="text-align: center;">-18</td>
<td style="text-align: center;">90</td>
<td style="text-align: center;">95</td>
<td style="text-align: center;">100</td>
</tr>
<tr class="even">
<td style="text-align: center;">8</td>
<td style="text-align: center;">-2</td>
<td style="text-align: center;">-90</td>
<td style="text-align: center;">-72</td>
<td style="text-align: center;">-54</td>
<td style="text-align: center;">80</td>
<td style="text-align: center;">85</td>
<td style="text-align: center;">90</td>
</tr>
<tr class="odd">
<td style="text-align: center;">7</td>
<td style="text-align: center;">-3</td>
<td style="text-align: center;">-126</td>
<td style="text-align: center;">-108</td>
<td style="text-align: center;">-90</td>
<td style="text-align: center;">70</td>
<td style="text-align: center;">75</td>
<td style="text-align: center;">80</td>
</tr>
<tr class="even">
<td style="text-align: center;">6</td>
<td style="text-align: center;">-4</td>
<td style="text-align: center;">-162</td>
<td style="text-align: center;">-144</td>
<td style="text-align: center;">-126</td>
<td style="text-align: center;">60</td>
<td style="text-align: center;">65</td>
<td style="text-align: center;">70</td>
</tr>
<tr class="odd">
<td style="text-align: center;">5</td>
<td style="text-align: center;">-5</td>
<td style="text-align: center;">162</td>
<td style="text-align: center;">180</td>
<td style="text-align: center;">-162</td>
<td style="text-align: center;">50</td>
<td style="text-align: center;">55</td>
<td style="text-align: center;">60</td>
</tr>
<tr class="even">
<td style="text-align: center;">4</td>
<td style="text-align: center;">-6</td>
<td style="text-align: center;">126</td>
<td style="text-align: center;">144</td>
<td style="text-align: center;">162</td>
<td style="text-align: center;">40</td>
<td style="text-align: center;">45</td>
<td style="text-align: center;">50</td>
</tr>
<tr class="odd">
<td style="text-align: center;">3</td>
<td style="text-align: center;">-7</td>
<td style="text-align: center;">90</td>
<td style="text-align: center;">108</td>
<td style="text-align: center;">126</td>
<td style="text-align: center;">30</td>
<td style="text-align: center;">35</td>
<td style="text-align: center;">40</td>
</tr>
<tr class="even">
<td style="text-align: center;">2</td>
<td style="text-align: center;">-8</td>
<td style="text-align: center;">54</td>
<td style="text-align: center;">72</td>
<td style="text-align: center;">90</td>
<td style="text-align: center;">20</td>
<td style="text-align: center;">25</td>
<td style="text-align: center;">30</td>
</tr>
<tr class="odd">
<td style="text-align: center;">1</td>
<td style="text-align: center;">-9</td>
<td style="text-align: center;">18</td>
<td style="text-align: center;">36</td>
<td style="text-align: center;">54</td>
<td style="text-align: center;">10</td>
<td style="text-align: center;">15</td>
<td style="text-align: center;">20</td>
</tr>
<tr class="even">
<td style="text-align: center;">0</td>
<td style="text-align: center;">-10</td>
<td style="text-align: center;">-18</td>
<td style="text-align: center;">0</td>
<td style="text-align: center;">18</td>
<td style="text-align: center;">0</td>
<td style="text-align: center;">5</td>
<td style="text-align: center;">10</td>
</tr>
</tbody>
</table>
<p>Dec times in Zone 0 and 5 can be directly converted to and from UTC times with an offset of 0 and 12 hours, respectively. The other Dec time zones will differ from the closest UTC time by 8.<span class="over">3</span>, 16.<span class="over">6</span>, 25, 33.<span class="over">3</span>, 41.<span class="over">6</span> or 50 <span class="under tool" data-bs-toggle="tooltip" data-bs-title="thousands of a day">millidays</span>. To find the difference Œ¥, convert the UTC offset hours <span class="cyan">o<sub>H</sub></span> and minutes <span class="cyan">o<sub>M</sub></span> into <span class="under tool" data-bs-toggle="tooltip" data-bs-title="tenths of a turn">deci<a href="https://en.wikipedia.org/wiki/Turn_%28angle%29#:~:text=a%20unit%20of%20plane%20angle%20measurement%20equal%20to%202%CF%80%C2%A0radians%2C%20360%C2%A0degrees">turns</a></span> of the longitude Œª and then subtract the Dec zone number <span class="lime">z</span>:</p>
<p><span class="math display">\[\lambda = o_H \div 2.4 + o_M \div 144\]</span></p>
<p><span class="math display">\[z = \lfloor\lambda + 1 \div 2\rfloor\]</span></p>
<p><span class="math display">\[\delta = \lambda - z\]</span></p>
<p>We can avoid dealing with the time zone difference by shifting the time zone so that we always convert between Zone 0 and <a href="https://en.wikipedia.org/wiki/List_of_UTC_offsets#UTC+00:00,_Z">UTC+00:00</a> or Zone 5 and <a href="https://en.wikipedia.org/wiki/List_of_UTC_offsets#UTC+12:00,_M">UTC+12:00</a>. To obtain the Zone 0 time, we evaluate a Dec time as a math expression, add 10, and get the remainder after dividing by 10 to make sure the result is less than 10 <a href="https://en.wikipedia.org/wiki/Decimal_time#:~:text=dividing%20the%20day%20into%2010%20decidays" class="under tool" data-bs-toggle="tooltip" data-bs-title="tenths of a day">decidays</a>: (<span class="cyan"><span><span id="ojs-element-id-5"></span></span></span> <span><span id="ojs-element-id-6"></span></span> <span class="lime"><span><span id="ojs-element-id-7"></span></span></span> + 10) <a href="https://en.wikipedia.org/wiki/Modulo#:~:text=returns%20the%20remainder">mod</a> 10 = <span class="cyan"><span><span id="ojs-element-id-8"></span></span></span>.</p>
<div class="callout callout-style-default callout-warning callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Bad Pun Alert
</div>
</div>
<div class="callout-body-container callout-body">
<p>Sorry if reading this takes a long <span class="cyan">time</span>; I hope you don‚Äôt <span class="lime">zone</span> out!</p>
</div>
</div>
</section>
<section id="unit" class="level4">
<h4 class="anchored" data-anchor-id="unit">Unit</h4>
<p>Dec uses <a href="https://en.wikipedia.org/wiki/Metric_prefix#:~:text=a%20unit%20prefix%20that%20precedes%20a%20basic%20unit%20of%20measure%20to%20indicate%20a%20multiple%20or%20submultiple%20of%20the%20unit">metric prefixes</a> to create <a href="https://en.wikipedia.org/wiki/Multiple_%28mathematics%29#Submultiple:~:text=of%20%22a%20being-,a%20unit%20fraction,-of%20b%22%20">submultiples</a> of a day that can naturally be combined together into a single <a href="https://en.wikipedia.org/wiki/Decimal#:~:text=system%20for%20denoting%20integer%20and%20non%2Dinteger%20numbers">decimal</a> number. Conversion between decimal units is as simple as moving‚ÜîÔ∏éÔ∏èor removing‚ùåthe <a href="https://en.wikipedia.org/wiki/Decimal_separator#:~:text=a%20symbol%20that%20separates%20the%20integer%20part%20from%20the%20fractional%20part%20of%20a%20number">decimal separator</a>. In contrast, an <code>hh:mm:ss</code> time is a <a href="https://en.wikipedia.org/wiki/Mixed_radix#:~:text=non%2Dstandard%20positional%20numeral%20systems%20in%20which%20the%20numerical%20base%20varies%20from%20position%20to%20position">mixed-radix</a> number, where <code>hh</code> is the <a href="https://en.wikipedia.org/wiki/List_of_numeral_systems#:~:text=12-,Duodecimal,-%2C%20dozenal">base-12</a> or <a href="https://en.wikipedia.org/wiki/List_of_numeral_systems#:~:text=24-,Quadravigesimal,-%5B48%5D">base-24</a> hour, <code>mm</code> is the <a href="https://en.wikipedia.org/wiki/List_of_numeral_systems#:~:text=60-,Sexagesimal,-Babylonian%20numerals%20and">base-60</a> minute, and <code>ss</code> is the base-60 second.</p>
<table class="table">
<thead>
<tr class="header">
<th>Prefix</th>
<th>Power</th>
<th>Day</th>
<th>hh:mm:ss.sss</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td></td>
<td>0</td>
<td>1</td>
<td>24:00:00.000</td>
</tr>
<tr class="even">
<td>deci</td>
<td>-1</td>
<td>.1</td>
<td>02:24:00.000</td>
</tr>
<tr class="odd">
<td>centi</td>
<td>-2</td>
<td>.01</td>
<td>00:14:24.000</td>
</tr>
<tr class="even">
<td>milli</td>
<td>-3</td>
<td>.001</td>
<td>00:01:26.400</td>
</tr>
<tr class="odd">
<td>decimilli</td>
<td>-4</td>
<td>.0001</td>
<td>00:00:08.640</td>
</tr>
<tr class="even">
<td>centimilli</td>
<td>-5</td>
<td>.00001</td>
<td>00:00:00.864</td>
</tr>
</tbody>
</table>
<p>To convert the hour <span class="orchid">h</span>, minute <span class="maroon">m</span>, and second <span class="seagreen">s</span> into the <a href="https://en.wikipedia.org/wiki/Decimal_time#:~:text=dividing%20the%20day%20into%2010%20decidays" class="under tool" data-bs-toggle="tooltip" data-bs-title="a tenth of a day">deciday</a> <span class="cyan">d</span>, Dec uses the following equation: <span class="cyan">d</span> = <span class="orchid">h</span> √∑ 2.4 + <span class="maroon">m</span> √∑ 144 + <span class="seagreen">s</span> √∑ 8640. The current equation values in Zone <span class="lime"><span><span id="ojs-element-id-9"></span></span></span> are: <span class="cyan"><span><span id="ojs-element-id-10"></span></span></span> = <span class="orchid"><span><span id="ojs-element-id-22"></span></span></span> √∑ 2.4 + <span class="maroon"><span><span id="ojs-element-id-23"></span></span></span> √∑ 144 + <span class="seagreen"><span><span id="ojs-element-id-24"></span></span></span> √∑ 8640. Inversely, we can convert <a href="https://en.wikipedia.org/wiki/Decimal_time#:~:text=dividing%20the%20day%20into%2010%20decidays" class="under tool" data-bs-toggle="tooltip" data-bs-title="tenths of a day">decidays</a> into hours: <span class="orchid">h</span> = <span class="cyan">d</span> √ó 2.4, minutes: <span class="maroon">m</span> = <span class="orchid">h</span> <a href="https://en.wikipedia.org/wiki/Modulo#:~:text=returns%20the%20remainder">mod</a> 1 √ó 60, and seconds: <span class="seagreen">s</span> = <span class="maroon">m</span> <a href="https://en.wikipedia.org/wiki/Modulo#:~:text=returns%20the%20remainder">mod</a> 1 √ó 60.</p>
<p>Instead of dealing with hours, minutes, and seconds, we can convert the <a href="https://en.wikipedia.org/wiki/Unix_time#:~:text=the%20number%20of%20non%2Dleap%20seconds%20that%20have%20elapsed%20since%2000%3A00%3A00%20UTC%20on%201%C2%A0January%201970">UNIX timestamp</a> <span class="azul">u</span> into the Dec time <span class="cyan">d</span>+<span class="lime">0</span>. First, we divide <span class="azul">u</span> by 86400 to convert seconds to days, then isolate the <a href="https://en.wikipedia.org/wiki/Fractional_part#:~:text=the%20excess%20beyond%20that%20number%27s%20integer%20part">decimal part</a> of the <a href="https://en.wikipedia.org/wiki/Quotient#:~:text=a%20quantity%20produced%20by%20the%20division%20of%20two%20numbers">quotient</a>, and finally multiply by 10: <span class="cyan">d</span> + <span class="lime">0</span> = <span class="azul">u</span> √∑ 86400 <a href="https://en.wikipedia.org/wiki/Modulo#:~:text=returns%20the%20remainder">mod</a> 1 √ó 10. The current values in this equation are <span class="cyan"><span><span id="ojs-element-id-11"></span></span></span> + <span class="lime">0</span> = <span class="azul"><span><span id="ojs-element-id-25"></span></span></span> √∑ 86400 <a href="https://en.wikipedia.org/wiki/Modulo#:~:text=returns%20the%20remainder">mod</a> 1 √ó 10.</p>
<p>The concept of measuring time in decimal days is not novel. In the late 1700s, the <a href="https://en.wikipedia.org/wiki/French_Republican_calendar#:~:text=a%20calendar%20created%20and%20implemented%20during%20the%20French%20Revolution">French Republican calendar</a> time system referred to <a href="https://en.wikipedia.org/wiki/Decimal_time#:~:text=dividing%20the%20day%20into%2010%20decidays" class="under tool" data-bs-toggle="tooltip" data-bs-title="tenths of a day">decidays</a> as decimal hours, <span class="under tool" data-bs-toggle="tooltip" data-bs-title="hundredths of a day">centidays</span> as <a href="https://en.wikipedia.org/wiki/Decimal_time#:~:text=into%20tenths%2C%20or-,d%C3%A9cimes,-%2C%20instead%20of%20minutes">d√©cimes</a>, <span class="under tool" data-bs-toggle="tooltip" data-bs-title="thousandths of a day">millidays</span> as decimal minutes, and <span class="under tool" data-bs-toggle="tooltip" data-bs-title="hundred thousandths of a day">centimillidays</span> as decimal seconds. Similarly, <a href="https://en.wikipedia.org/wiki/Swatch_Internet_Time#:~:text=a%20decimal%20time%20system%20introduced%20in%201998%20by%20the%20Swatch%20corporation">Swatch Internet Time</a>, a <a href="https://en.wikipedia.org/wiki/Decimal_time#:~:text=the%20representation%20of%20the%20time%20of%20day%20using%20units%20which%20are%20decimally%20related">decimal time</a> system introduced in 1998, uses the term ‚Äú.beats‚Äù for <span class="under tool" data-bs-toggle="tooltip" data-bs-title="thousandths of a day">millidays</span>.</p>
<p>Swatch Internet Time differs from Dec in that it <a href="https://en.wikipedia.org/wiki/Swatch_Internet_Time#Calculation_from_UTC+1:~:text=There%20are%20no%20time%20zones%20in%20Swatch%20Internet%20Time">has no time zones</a> and is obtained from the <a href="https://en.wikipedia.org/wiki/Swatch_Internet_Time#Calculation_from_UTC+1:~:text=The%20formula%20for%20calculating%20the%20time%20in%20.beats%20from%20UTC%2B1">hours, minutes, and seconds</a> of <a href="https://en.wikipedia.org/wiki/UTC%2B01:00#:~:text=a%20time%20offset%20from%20UTC%20of%20%2B01%3A00">UTC+01:00</a>. In contrast, the major innovations described in this article are the Dec time zone system and the simple equation for obtaining the Dec time in Zone 0 from a UNIX timestamp, but Dec has much more to offer than <a href="https://en.wikipedia.org/wiki/Decimal_time#:~:text=dividing%20the%20day%20into%2010%20decidays" class="under tool" data-bs-toggle="tooltip" data-bs-title="a tenth of a day">deciday</a> times and zones.</p>
</section>
<section id="next" class="level4">
<h4 class="anchored" data-anchor-id="next">Next</h4>
<p>The next article in the <a href="../../dec">Dec section</a> of my site compares Dec to the <a href="https://en.wikipedia.org/wiki/ISO_8601#:~:text=an%20international%20standard%20covering%20the%20worldwide%20exchange%20and%20communication%20of%20date%20and%20time%2Drelated%20data">ISO 8601</a> international standard for dates and times. Like ISO 8601, Dec allows for <a href="https://en.wikipedia.org/wiki/ISO_8601#Combined_date_and_time_representations">combined date and time representations</a> that can be paired up to express <a href="https://en.wikipedia.org/wiki/ISO_8601#Time_intervals:~:text=the%20intervening%20time%20between%20two%20time%20points">time intervals</a>. In Dec, the combination of a date and time is called a snapü´∞and a time interval expressed as a pair of snaps is called a spanüåà.</p>
<p>My <a href="../../dec/iso">ISO 8601 article</a> is unique because it avoids the use of Observable in favor of leveraging <a href="https://jupyter.org">Jupyter</a> support in Quarto to make the code underlying Dec available in multiple programming languages. Observable is a great visualization tool but does not translate well into Jupyter notebooks. After the next article, I return to the use of Observable in my Dec <a href="../../dec/span">snap</a>ü´∞and <a href="../../dec/span">span</a>üåàarticles.</p>
<div class="cell" data-layout-align="default">
<div class="cell-output-display">
<div id="navchart">
<div>
<pre class="mermaid mermaid-js" data-label="navchart">flowchart LR
   B[date]--&gt;C[time]--&gt;D[iso]--&gt;E[snap]--&gt;F[span]
   click B "/dec/date"
   click C "/dec/time"
   click D "/dec/iso"
   click E "/dec/snap"
   click F "/dec/span"
   style C stroke:#99f,stroke-width:5px
</pre>
</div>
</div>
</div>
</div>
</section>
<section id="cite" class="level4">
<h4 class="anchored" data-anchor-id="cite">Cite</h4>
<p>Please spread the good word about Dec using the citation information at the bottom of this article. You may also want to cite the Observable notebooks that I adapted into the clocküïì, barüìächart, mapüó∫Ô∏è, and daylight‚òÄÔ∏èplot visualizations in this article or the 2014 blog post which proposed a system of 20 decimal time zones, each 5 <span class="under tool" data-bs-toggle="tooltip" data-bs-title="hundredths of a day">centidays</span> wide, based on the <a href="https://en.wikipedia.org/wiki/Prime_meridian_(Greenwich)#:~:text=a%20geographical%20reference%20line%20that%20passes%20through%20the%20Royal%20Observatory%2C%20Greenwich%2C%20in%20London%2C%20England">Greenwich Meridian</a>:</p>
<ul>
<li><a href="https://www.2x2.graphics">Pearson, Tom</a>. <span class="tool" data-bs-toggle="tooltip" data-bs-title="2013-07-03"><u><span class="yellow">2013</span>+<span class="cyan">124</span></u></span>. ‚ÄúSimple D3 clock.‚Äù <span class="yellow"><span><span id="ojs-element-id-12"></span></span></span>+<span class="cyan"><span><span id="ojs-element-id-13"></span></span></span>. <a href="https://observablehq.com/@d3/simple-clock" class="uri">https://observablehq.com/@d3/simple-clock</a>.</li>
<li><a href="https://fheyen.github.io">Heyen, Frank</a>. <span class="tool" data-bs-toggle="tooltip" data-bs-title="2021-11-02"><u><span class="yellow">2021</span>+<span class="cyan">246</span></u></span>. ‚ÄúBarChart Clock.‚Äù <span class="yellow"><span><span id="ojs-element-id-14"></span></span></span>+<span class="cyan"><span><span id="ojs-element-id-15"></span></span></span>. <a href="https://observablehq.com/@fheyen/barchart-clock" class="uri">https://observablehq.com/@fheyen/barchart-clock</a>.</li>
<li><a href="https://enjalot.github.io">Johnson, Ian</a>. <span class="tool" data-bs-toggle="tooltip" data-bs-title="2021-05-30"><u><span class="yellow">2021</span>+<span class="cyan">090</span></u></span>. ‚ÄúDraggable World Map Coordinates Input.‚Äù <span class="yellow"><span><span id="ojs-element-id-16"></span></span></span>+<span class="cyan"><span><span id="ojs-element-id-17"></span></span></span>. <a href="https://observablehq.com/@enjalot/draggable-world-map-coordinates-input" class="uri">https://observablehq.com/@enjalot/draggable-world-map-coordinates-input</a>.</li>
<li><a href="https://www.danbridges.org">Bridges, Dan</a>. <span class="tool" data-bs-toggle="tooltip" data-bs-title="2022-01-06"><u><span class="yellow">2021</span>+<span class="cyan">311</span></u></span>. ‚ÄúVisualizing Seasonal Daylight.‚Äù <span class="yellow"><span><span id="ojs-element-id-18"></span></span></span>+<span class="cyan"><span><span id="ojs-element-id-19"></span></span></span>. <a href="https://observablehq.com/@dbridges/visualizing-seasonal-daylight" class="uri">https://observablehq.com/@dbridges/visualizing-seasonal-daylight</a>.</li>
<li><a href="https://www.brinckerhoff.org">Clements, John</a>. <span class="tool" data-bs-toggle="tooltip" data-bs-title="2021-05-31"><u><span class="yellow">2014</span>+<span class="cyan">091</span></u></span>, ‚ÄúDecimal Time Zones.‚Äù <span class="yellow"><span><span id="ojs-element-id-20"></span></span></span>+<span class="cyan"><span><span id="ojs-element-id-21"></span></span></span>. <a href="https://www.brinckerhoff.org/blog/2014/05/31/decimal-time-zones" class="uri">https://www.brinckerhoff.org/blog/2014/05/31/decimal-time-zones</a>.</li>
</ul>
<div class="cell hidden">
<div class="sourceCode cell-code hidden" id="cb2" data-startfrom="806" data-source-offset="-0"><pre class="sourceCode js code-with-copy"><code class="sourceCode javascript" style="counter-reset: source-line 805;"><span id="cb2-806"><a href="#cb2-806" aria-hidden="true" tabindex="-1"></a>unix <span class="op">=</span> {</span>
<span id="cb2-807"><a href="#cb2-807" aria-hidden="true" tabindex="-1"></a>  <span class="cf">while</span>(<span class="kw">true</span>) {</span>
<span id="cb2-808"><a href="#cb2-808" aria-hidden="true" tabindex="-1"></a>    <span class="kw">yield</span> <span class="bu">Date</span><span class="op">.</span><span class="fu">now</span>()<span class="op">;</span></span>
<span id="cb2-809"><a href="#cb2-809" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb2-810"><a href="#cb2-810" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb2-811"><a href="#cb2-811" aria-hidden="true" tabindex="-1"></a><span class="kw">function</span> <span class="fu">unix2dote</span>(unix<span class="op">,</span> zone<span class="op">,</span> offset <span class="op">=</span> <span class="dv">719468</span>) {</span>
<span id="cb2-812"><a href="#cb2-812" aria-hidden="true" tabindex="-1"></a>  <span class="cf">return</span> [(unix <span class="op">??</span> <span class="bu">Date</span><span class="op">.</span><span class="fu">now</span>()) <span class="op">/</span> <span class="dv">86400000</span> <span class="op">+</span> (</span>
<span id="cb2-813"><a href="#cb2-813" aria-hidden="true" tabindex="-1"></a>    zone <span class="op">=</span> zone <span class="op">??</span> <span class="op">-</span><span class="bu">Math</span><span class="op">.</span><span class="fu">round</span>(</span>
<span id="cb2-814"><a href="#cb2-814" aria-hidden="true" tabindex="-1"></a>      (<span class="kw">new</span> <span class="bu">Date</span>)<span class="op">.</span><span class="fu">getTimezoneOffset</span>() <span class="op">/</span> <span class="dv">144</span>)</span>
<span id="cb2-815"><a href="#cb2-815" aria-hidden="true" tabindex="-1"></a>    ) <span class="op">/</span> <span class="dv">10</span> <span class="op">+</span> offset<span class="op">,</span> zone]</span>
<span id="cb2-816"><a href="#cb2-816" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb2-817"><a href="#cb2-817" aria-hidden="true" tabindex="-1"></a><span class="kw">function</span> <span class="fu">unix2dote1</span>(unix<span class="op">,</span> zone<span class="op">,</span> offset <span class="op">=</span> <span class="dv">719468</span>) {</span>
<span id="cb2-818"><a href="#cb2-818" aria-hidden="true" tabindex="-1"></a>  <span class="cf">return</span> [</span>
<span id="cb2-819"><a href="#cb2-819" aria-hidden="true" tabindex="-1"></a>    (unix <span class="op">??</span> <span class="bu">Date</span><span class="op">.</span><span class="fu">now</span>()) <span class="op">/</span> <span class="dv">86400000</span></span>
<span id="cb2-820"><a href="#cb2-820" aria-hidden="true" tabindex="-1"></a>    <span class="op">+</span> (zone <span class="op">=</span> zone <span class="op">??</span> (<span class="dv">10</span> <span class="op">-</span> <span class="bu">Math</span><span class="op">.</span><span class="fu">round</span>(</span>
<span id="cb2-821"><a href="#cb2-821" aria-hidden="true" tabindex="-1"></a>        (<span class="kw">new</span> <span class="bu">Date</span>)<span class="op">.</span><span class="fu">getTimezoneOffset</span>() <span class="op">/</span> <span class="dv">144</span>)) <span class="op">%</span> <span class="dv">10</span></span>
<span id="cb2-822"><a href="#cb2-822" aria-hidden="true" tabindex="-1"></a>      ) <span class="op">/</span> <span class="dv">10</span> <span class="op">+</span> offset<span class="op">,</span> zone]</span>
<span id="cb2-823"><a href="#cb2-823" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb2-824"><a href="#cb2-824" aria-hidden="true" tabindex="-1"></a><span class="kw">function</span> <span class="fu">dote2date</span>(dote<span class="op">,</span> zone <span class="op">=</span> <span class="dv">0</span>) {</span>
<span id="cb2-825"><a href="#cb2-825" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> cote <span class="op">=</span> <span class="bu">Math</span><span class="op">.</span><span class="fu">floor</span>((</span>
<span id="cb2-826"><a href="#cb2-826" aria-hidden="true" tabindex="-1"></a>      dote <span class="op">&gt;=</span> <span class="dv">0</span> <span class="op">?</span> dote</span>
<span id="cb2-827"><a href="#cb2-827" aria-hidden="true" tabindex="-1"></a>      <span class="op">:</span> dote <span class="op">-</span> <span class="dv">146096</span></span>
<span id="cb2-828"><a href="#cb2-828" aria-hidden="true" tabindex="-1"></a>    ) <span class="op">/</span> <span class="dv">146097</span>)<span class="op">,</span></span>
<span id="cb2-829"><a href="#cb2-829" aria-hidden="true" tabindex="-1"></a>  dotc <span class="op">=</span> dote <span class="op">-</span> cote <span class="op">*</span> <span class="dv">146097</span><span class="op">,</span></span>
<span id="cb2-830"><a href="#cb2-830" aria-hidden="true" tabindex="-1"></a>  yotc <span class="op">=</span> <span class="bu">Math</span><span class="op">.</span><span class="fu">floor</span>((dotc</span>
<span id="cb2-831"><a href="#cb2-831" aria-hidden="true" tabindex="-1"></a>    <span class="op">-</span> <span class="bu">Math</span><span class="op">.</span><span class="fu">floor</span>(dotc <span class="op">/</span> <span class="dv">1460</span>)</span>
<span id="cb2-832"><a href="#cb2-832" aria-hidden="true" tabindex="-1"></a>    <span class="op">+</span> <span class="bu">Math</span><span class="op">.</span><span class="fu">floor</span>(dotc <span class="op">/</span> <span class="dv">36524</span>)</span>
<span id="cb2-833"><a href="#cb2-833" aria-hidden="true" tabindex="-1"></a>    <span class="op">-</span> <span class="bu">Math</span><span class="op">.</span><span class="fu">floor</span>(dotc <span class="op">/</span> <span class="dv">146096</span>)</span>
<span id="cb2-834"><a href="#cb2-834" aria-hidden="true" tabindex="-1"></a>  ) <span class="op">/</span> <span class="dv">365</span>)<span class="op">;</span></span>
<span id="cb2-835"><a href="#cb2-835" aria-hidden="true" tabindex="-1"></a>  <span class="cf">return</span> [</span>
<span id="cb2-836"><a href="#cb2-836" aria-hidden="true" tabindex="-1"></a>    yotc <span class="op">+</span> cote <span class="op">*</span> <span class="dv">400</span><span class="op">,</span></span>
<span id="cb2-837"><a href="#cb2-837" aria-hidden="true" tabindex="-1"></a>    dotc <span class="op">-</span> (yotc <span class="op">*</span> <span class="dv">365</span></span>
<span id="cb2-838"><a href="#cb2-838" aria-hidden="true" tabindex="-1"></a>      <span class="op">+</span> <span class="bu">Math</span><span class="op">.</span><span class="fu">floor</span>(yotc <span class="op">/</span> <span class="dv">4</span>)</span>
<span id="cb2-839"><a href="#cb2-839" aria-hidden="true" tabindex="-1"></a>      <span class="op">-</span> <span class="bu">Math</span><span class="op">.</span><span class="fu">floor</span>(yotc <span class="op">/</span> <span class="dv">100</span>)</span>
<span id="cb2-840"><a href="#cb2-840" aria-hidden="true" tabindex="-1"></a>  )<span class="op">,</span> zone]}</span>
<span id="cb2-841"><a href="#cb2-841" aria-hidden="true" tabindex="-1"></a>dz <span class="op">=</span> <span class="fu">unix2dote</span>(unix)</span>
<span id="cb2-842"><a href="#cb2-842" aria-hidden="true" tabindex="-1"></a>ydz <span class="op">=</span> <span class="fu">dote2date</span>(<span class="op">...</span>dz)</span>
<span id="cb2-843"><a href="#cb2-843" aria-hidden="true" tabindex="-1"></a>decYear <span class="op">=</span> ydz[<span class="dv">0</span>]<span class="op">.</span><span class="fu">toString</span>()<span class="op">.</span><span class="fu">padStart</span>(<span class="dv">4</span><span class="op">,</span> <span class="st">"0"</span>)</span>
<span id="cb2-844"><a href="#cb2-844" aria-hidden="true" tabindex="-1"></a>decDate <span class="op">=</span> <span class="bu">Math</span><span class="op">.</span><span class="fu">floor</span>(ydz[<span class="dv">1</span>])<span class="op">.</span><span class="fu">toString</span>()<span class="op">.</span><span class="fu">padStart</span>(<span class="dv">3</span><span class="op">,</span> <span class="st">"0"</span>)</span>
<span id="cb2-845"><a href="#cb2-845" aria-hidden="true" tabindex="-1"></a>browserDote <span class="op">=</span> <span class="fu">unix2dote</span>(unix)</span>
<span id="cb2-846"><a href="#cb2-846" aria-hidden="true" tabindex="-1"></a>browserTime <span class="op">=</span> browserDote[<span class="dv">0</span>] <span class="op">%</span> <span class="dv">1</span> <span class="op">*</span> <span class="dv">10</span></span>
<span id="cb2-847"><a href="#cb2-847" aria-hidden="true" tabindex="-1"></a>browserZone <span class="op">=</span> browserDote[<span class="dv">1</span>]</span>
<span id="cb2-848"><a href="#cb2-848" aria-hidden="true" tabindex="-1"></a>browserSign <span class="op">=</span> browserZone <span class="op">&gt;</span> <span class="dv">0</span> <span class="op">?</span> <span class="st">"-"</span> <span class="op">:</span> <span class="st">"+"</span></span>
<span id="cb2-849"><a href="#cb2-849" aria-hidden="true" tabindex="-1"></a>zone0time <span class="op">=</span> (browserTime <span class="op">-</span> browserZone <span class="op">+</span> <span class="dv">10</span>) <span class="op">%</span> <span class="dv">10</span></span>
<span id="cb2-850"><a href="#cb2-850" aria-hidden="true" tabindex="-1"></a>hours <span class="op">=</span> browserTime <span class="op">*</span> <span class="fl">2.4</span></span>
<span id="cb2-851"><a href="#cb2-851" aria-hidden="true" tabindex="-1"></a>minutes <span class="op">=</span> hours <span class="op">%</span> <span class="dv">1</span> <span class="op">*</span> <span class="dv">60</span></span>
<span id="cb2-852"><a href="#cb2-852" aria-hidden="true" tabindex="-1"></a>seconds <span class="op">=</span> minutes <span class="op">%</span> <span class="dv">1</span> <span class="op">*</span> <span class="dv">60</span></span>
<span id="cb2-853"><a href="#cb2-853" aria-hidden="true" tabindex="-1"></a>selectedDote <span class="op">=</span> <span class="fu">unix2dote</span>(unix<span class="op">,</span> <span class="fu">long2zone</span>(location[<span class="dv">0</span>]))</span>
<span id="cb2-854"><a href="#cb2-854" aria-hidden="true" tabindex="-1"></a>selectedExact <span class="op">=</span> selectedDote[<span class="dv">0</span>] <span class="op">%</span> <span class="dv">1</span></span>
<span id="cb2-855"><a href="#cb2-855" aria-hidden="true" tabindex="-1"></a>selectedExactN <span class="op">=</span> (<span class="dv">1</span> <span class="op">-</span> selectedExact) <span class="op">%</span> <span class="dv">1</span></span>
<span id="cb2-856"><a href="#cb2-856" aria-hidden="true" tabindex="-1"></a>selectedZone <span class="op">=</span> selectedDote[<span class="dv">1</span>]</span>
<span id="cb2-857"><a href="#cb2-857" aria-hidden="true" tabindex="-1"></a>decTime <span class="op">=</span> (selectedExact <span class="op">*</span> <span class="dv">10</span>)<span class="op">.</span><span class="fu">toFixed</span>(<span class="dv">4</span>)</span>
<span id="cb2-858"><a href="#cb2-858" aria-hidden="true" tabindex="-1"></a>decTimeN <span class="op">=</span> (selectedExactN <span class="op">*</span> <span class="dv">10</span>)<span class="op">.</span><span class="fu">toFixed</span>(<span class="dv">4</span>)</span>
<span id="cb2-859"><a href="#cb2-859" aria-hidden="true" tabindex="-1"></a>barDD <span class="op">=</span> decTime[<span class="dv">0</span>]</span>
<span id="cb2-860"><a href="#cb2-860" aria-hidden="true" tabindex="-1"></a>barDDN <span class="op">=</span> decTimeN[<span class="dv">0</span>]</span>
<span id="cb2-861"><a href="#cb2-861" aria-hidden="true" tabindex="-1"></a>barMils <span class="op">=</span> decTime<span class="op">.</span><span class="fu">slice</span>(<span class="dv">2</span><span class="op">,</span> <span class="dv">4</span>)</span>
<span id="cb2-862"><a href="#cb2-862" aria-hidden="true" tabindex="-1"></a>barMilsN <span class="op">=</span> decTimeN<span class="op">.</span><span class="fu">slice</span>(<span class="dv">2</span><span class="op">,</span> <span class="dv">4</span>)</span>
<span id="cb2-863"><a href="#cb2-863" aria-hidden="true" tabindex="-1"></a>barBeats <span class="op">=</span> decTime<span class="op">.</span><span class="fu">slice</span>(<span class="dv">4</span><span class="op">,</span> <span class="dv">6</span>)</span>
<span id="cb2-864"><a href="#cb2-864" aria-hidden="true" tabindex="-1"></a>barBeatsN <span class="op">=</span> decTimeN<span class="op">.</span><span class="fu">slice</span>(<span class="dv">4</span><span class="op">,</span> <span class="dv">6</span>)</span>
<span id="cb2-865"><a href="#cb2-865" aria-hidden="true" tabindex="-1"></a><span class="kw">function</span> <span class="fu">lati2turn1</span>(degrees <span class="op">=</span> <span class="op">-</span><span class="dv">180</span><span class="op">,</span> e <span class="op">=</span> <span class="dv">3</span>) {</span>
<span id="cb2-866"><a href="#cb2-866" aria-hidden="true" tabindex="-1"></a>  <span class="co">// turns: e=0, deciturns: e=1, etc.</span></span>
<span id="cb2-867"><a href="#cb2-867" aria-hidden="true" tabindex="-1"></a>  <span class="cf">return</span> (degrees <span class="op">%=</span> <span class="dv">360</span>) <span class="op">/</span> (<span class="dv">360</span> <span class="op">/</span> <span class="dv">10</span><span class="op">**</span>e) <span class="op">%</span> <span class="dv">10</span><span class="op">**</span>e<span class="op">;</span></span>
<span id="cb2-868"><a href="#cb2-868" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb2-869"><a href="#cb2-869" aria-hidden="true" tabindex="-1"></a>graticule <span class="op">=</span> d3<span class="op">.</span><span class="fu">geoGraticule</span>()<span class="op">.</span><span class="fu">stepMinor</span>([<span class="dv">36</span><span class="op">,</span><span class="dv">36</span>])<span class="op">.</span><span class="fu">stepMajor</span>([<span class="dv">36</span><span class="op">,</span><span class="dv">36</span>])()</span>
<span id="cb2-870"><a href="#cb2-870" aria-hidden="true" tabindex="-1"></a>graticule<span class="op">.</span><span class="at">coordinates</span> <span class="op">=</span> graticule<span class="op">.</span><span class="at">coordinates</span><span class="op">.</span><span class="fu">map</span>(</span>
<span id="cb2-871"><a href="#cb2-871" aria-hidden="true" tabindex="-1"></a>  i <span class="kw">=&gt;</span> i<span class="op">.</span><span class="fu">map</span>(j <span class="kw">=&gt;</span> j<span class="op">.</span><span class="fu">map</span>((k<span class="op">,</span> index<span class="op">,</span> arr) <span class="kw">=&gt;</span> i<span class="op">.</span><span class="at">length</span> <span class="op">===</span> <span class="dv">3</span> <span class="op">&amp;&amp;</span> index <span class="op">===</span> <span class="dv">0</span> <span class="op">?</span> k <span class="op">-</span> <span class="dv">18</span> <span class="op">:</span> k))</span>
<span id="cb2-872"><a href="#cb2-872" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display hidden">
<div>
<div id="ojs-cell-2-1" data-nodetype="declaration">

</div>
</div>
</div>
<div class="cell-output cell-output-display hidden">
<div>
<div id="ojs-cell-2-2" data-nodetype="declaration">

</div>
</div>
</div>
<div class="cell-output cell-output-display hidden">
<div>
<div id="ojs-cell-2-3" data-nodetype="declaration">

</div>
</div>
</div>
<div class="cell-output cell-output-display hidden">
<div>
<div id="ojs-cell-2-4" data-nodetype="declaration">

</div>
</div>
</div>
<div class="cell-output cell-output-display hidden">
<div>
<div id="ojs-cell-2-5" data-nodetype="declaration">

</div>
</div>
</div>
<div class="cell-output cell-output-display hidden">
<div>
<div id="ojs-cell-2-6" data-nodetype="declaration">

</div>
</div>
</div>
<div class="cell-output cell-output-display hidden">
<div>
<div id="ojs-cell-2-7" data-nodetype="declaration">

</div>
</div>
</div>
<div class="cell-output cell-output-display hidden">
<div>
<div id="ojs-cell-2-8" data-nodetype="declaration">

</div>
</div>
</div>
<div class="cell-output cell-output-display hidden">
<div>
<div id="ojs-cell-2-9" data-nodetype="declaration">

</div>
</div>
</div>
<div class="cell-output cell-output-display hidden">
<div>
<div id="ojs-cell-2-10" data-nodetype="declaration">

</div>
</div>
</div>
<div class="cell-output cell-output-display hidden">
<div>
<div id="ojs-cell-2-11" data-nodetype="declaration">

</div>
</div>
</div>
<div class="cell-output cell-output-display hidden">
<div>
<div id="ojs-cell-2-12" data-nodetype="declaration">

</div>
</div>
</div>
<div class="cell-output cell-output-display hidden">
<div>
<div id="ojs-cell-2-13" data-nodetype="declaration">

</div>
</div>
</div>
<div class="cell-output cell-output-display hidden">
<div>
<div id="ojs-cell-2-14" data-nodetype="declaration">

</div>
</div>
</div>
<div class="cell-output cell-output-display hidden">
<div>
<div id="ojs-cell-2-15" data-nodetype="declaration">

</div>
</div>
</div>
<div class="cell-output cell-output-display hidden">
<div>
<div id="ojs-cell-2-16" data-nodetype="declaration">

</div>
</div>
</div>
<div class="cell-output cell-output-display hidden">
<div>
<div id="ojs-cell-2-17" data-nodetype="declaration">

</div>
</div>
</div>
<div class="cell-output cell-output-display hidden">
<div>
<div id="ojs-cell-2-18" data-nodetype="declaration">

</div>
</div>
</div>
<div class="cell-output cell-output-display hidden">
<div>
<div id="ojs-cell-2-19" data-nodetype="declaration">

</div>
</div>
</div>
<div class="cell-output cell-output-display hidden">
<div>
<div id="ojs-cell-2-20" data-nodetype="declaration">

</div>
</div>
</div>
<div class="cell-output cell-output-display hidden">
<div>
<div id="ojs-cell-2-21" data-nodetype="declaration">

</div>
</div>
</div>
<div class="cell-output cell-output-display hidden">
<div>
<div id="ojs-cell-2-22" data-nodetype="declaration">

</div>
</div>
</div>
<div class="cell-output cell-output-display hidden">
<div>
<div id="ojs-cell-2-23" data-nodetype="declaration">

</div>
</div>
</div>
<div class="cell-output cell-output-display hidden">
<div>
<div id="ojs-cell-2-24" data-nodetype="declaration">

</div>
</div>
</div>
<div class="cell-output cell-output-display hidden">
<div>
<div id="ojs-cell-2-25" data-nodetype="declaration">

</div>
</div>
</div>
<div class="cell-output cell-output-display hidden">
<div>
<div id="ojs-cell-2-26" data-nodetype="declaration">

</div>
</div>
</div>
<div class="cell-output cell-output-display hidden">
<div>
<div id="ojs-cell-2-27" data-nodetype="declaration">

</div>
</div>
</div>
<div class="cell-output cell-output-display hidden">
<div>
<div id="ojs-cell-2-28" data-nodetype="declaration">

</div>
</div>
</div>
<div class="cell-output cell-output-display hidden">
<div>
<div id="ojs-cell-2-29" data-nodetype="declaration">

</div>
</div>
</div>
<div class="cell-output cell-output-display hidden">
<div>
<div id="ojs-cell-2-30" data-nodetype="declaration">

</div>
</div>
</div>
<div class="cell-output cell-output-display hidden">
<div>
<div id="ojs-cell-2-31" data-nodetype="expression">

</div>
</div>
</div>
<div class="sourceCode cell-code hidden" id="cb3" data-startfrom="873" data-source-offset="-2068"><pre class="sourceCode js code-with-copy"><code class="sourceCode javascript" style="counter-reset: source-line 872;"><span id="cb3-873"><a href="#cb3-873" aria-hidden="true" tabindex="-1"></a><span class="kw">function</span> <span class="fu">long2turn</span>(degrees <span class="op">=</span> <span class="op">-</span><span class="dv">180</span><span class="op">,</span> e <span class="op">=</span> <span class="dv">3</span>) {</span>
<span id="cb3-874"><a href="#cb3-874" aria-hidden="true" tabindex="-1"></a>  <span class="co">// turns: e=0, deciturns: e=1, etc.</span></span>
<span id="cb3-875"><a href="#cb3-875" aria-hidden="true" tabindex="-1"></a>  <span class="cf">return</span> (((degrees <span class="op">%=</span> <span class="dv">360</span>) <span class="op">&lt;</span> <span class="dv">0</span> <span class="op">?</span> degrees <span class="op">+</span> <span class="dv">360</span> <span class="op">:</span> degrees) <span class="op">+</span> <span class="dv">18</span>) <span class="op">/</span> (<span class="dv">360</span> <span class="op">/</span> <span class="dv">10</span><span class="op">**</span>e) <span class="op">%</span> <span class="dv">10</span><span class="op">**</span>e<span class="op">;</span></span>
<span id="cb3-876"><a href="#cb3-876" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb3-877"><a href="#cb3-877" aria-hidden="true" tabindex="-1"></a><span class="co">// https://github.com/topojson/world-atlas</span></span>
<span id="cb3-878"><a href="#cb3-878" aria-hidden="true" tabindex="-1"></a>world <span class="op">=</span> d3<span class="op">.</span><span class="fu">json</span>(<span class="st">"https://cdn.jsdelivr.net/npm/world-atlas@2/countries-110m.json"</span>)</span>
<span id="cb3-879"><a href="#cb3-879" aria-hidden="true" tabindex="-1"></a>countries <span class="op">=</span> topojson<span class="op">.</span><span class="fu">feature</span>(world<span class="op">,</span> world<span class="op">.</span><span class="at">objects</span><span class="op">.</span><span class="at">countries</span>)</span>
<span id="cb3-880"><a href="#cb3-880" aria-hidden="true" tabindex="-1"></a>topojson <span class="op">=</span> <span class="pp">require</span>(<span class="st">"topojson-client@3"</span>)</span>
<span id="cb3-881"><a href="#cb3-881" aria-hidden="true" tabindex="-1"></a><span class="kw">function</span> <span class="fu">long2zone</span>(degrees <span class="op">=</span> <span class="op">-</span><span class="dv">180</span>) {</span>
<span id="cb3-882"><a href="#cb3-882" aria-hidden="true" tabindex="-1"></a>  <span class="cf">return</span> <span class="bu">Math</span><span class="op">.</span><span class="fu">floor</span>(<span class="fu">long2turn</span>(degrees<span class="op">,</span> <span class="dv">1</span>))<span class="op">;</span></span>
<span id="cb3-883"><a href="#cb3-883" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb3-884"><a href="#cb3-884" aria-hidden="true" tabindex="-1"></a><span class="kw">function</span> <span class="fu">year2leap</span>(year <span class="op">=</span> <span class="dv">1970</span>) {</span>
<span id="cb3-885"><a href="#cb3-885" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> year <span class="op">%</span> <span class="dv">4</span> <span class="op">==</span> <span class="dv">0</span> <span class="op">&amp;&amp;</span> year <span class="op">%</span> <span class="dv">100</span> <span class="op">!=</span> <span class="dv">0</span> <span class="op">||</span> year <span class="op">%</span> <span class="dv">400</span> <span class="op">==</span> <span class="dv">0</span><span class="op">;</span></span>
<span id="cb3-886"><a href="#cb3-886" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb3-887"><a href="#cb3-887" aria-hidden="true" tabindex="-1"></a><span class="co">// https://observablehq.com/@dbridges/visualizing-seasonal-daylight</span></span>
<span id="cb3-888"><a href="#cb3-888" aria-hidden="true" tabindex="-1"></a>solarSystem <span class="op">=</span> (<span class="bu">root</span><span class="op">,</span> width<span class="op">,</span> location<span class="op">,</span> date<span class="op">,</span> hour) <span class="kw">=&gt;</span> {</span>
<span id="cb3-889"><a href="#cb3-889" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> earthRadius <span class="op">=</span> <span class="fl">0.04</span> <span class="op">*</span> width<span class="op">;</span></span>
<span id="cb3-890"><a href="#cb3-890" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> sunRadius <span class="op">=</span> <span class="fl">0.08</span> <span class="op">*</span> width<span class="op">;</span></span>
<span id="cb3-891"><a href="#cb3-891" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> solarSystemRadius <span class="op">=</span> width <span class="op">/</span> <span class="dv">2</span> <span class="op">-</span> <span class="dv">20</span><span class="op">;</span></span>
<span id="cb3-892"><a href="#cb3-892" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> stretch <span class="op">=</span> <span class="fl">0.3</span><span class="op">;</span></span>
<span id="cb3-893"><a href="#cb3-893" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> solarAngle <span class="op">=</span> <span class="fu">getSolarAngle</span>(date)<span class="op">;</span></span>
<span id="cb3-894"><a href="#cb3-894" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> solarAngleDeg <span class="op">=</span> (solarAngle <span class="op">*</span> <span class="dv">180</span>) <span class="op">/</span> <span class="bu">Math</span><span class="op">.</span><span class="cn">PI</span><span class="op">;</span></span>
<span id="cb3-895"><a href="#cb3-895" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> x <span class="op">=</span> solarSystemRadius <span class="op">*</span> <span class="bu">Math</span><span class="op">.</span><span class="fu">sin</span>(solarAngle)<span class="op">;</span></span>
<span id="cb3-896"><a href="#cb3-896" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> y <span class="op">=</span> stretch <span class="op">*</span> solarSystemRadius <span class="op">*</span> <span class="bu">Math</span><span class="op">.</span><span class="fu">cos</span>(solarAngle)<span class="op">;</span></span>
<span id="cb3-897"><a href="#cb3-897" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> spin <span class="op">=</span> <span class="dv">180</span> <span class="op">+</span> <span class="op">-</span>location[<span class="dv">0</span>] <span class="op">+</span> solarAngleDeg <span class="op">+</span> <span class="dv">360</span> <span class="op">*</span> ((hour <span class="op">+</span> <span class="dv">12</span>) <span class="op">/</span> <span class="dv">24</span>)<span class="op">;</span></span>
<span id="cb3-898"><a href="#cb3-898" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> earthGeo <span class="op">=</span> { <span class="dt">type</span><span class="op">:</span> <span class="st">"Sphere"</span> }<span class="op">;</span></span>
<span id="cb3-899"><a href="#cb3-899" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> projection <span class="op">=</span> d3</span>
<span id="cb3-900"><a href="#cb3-900" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">geoOrthographic</span>()</span>
<span id="cb3-901"><a href="#cb3-901" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">fitWidth</span>(earthRadius <span class="op">*</span> <span class="dv">2</span><span class="op">,</span> earthGeo)</span>
<span id="cb3-902"><a href="#cb3-902" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">rotate</span>([spin<span class="op">,</span> <span class="dv">0</span><span class="op">,</span> <span class="fl">23.5</span>])</span>
<span id="cb3-903"><a href="#cb3-903" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">translate</span>([<span class="dv">0</span><span class="op">,</span> <span class="dv">0</span>])<span class="op">;</span></span>
<span id="cb3-904"><a href="#cb3-904" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> staticProjection <span class="op">=</span> d3</span>
<span id="cb3-905"><a href="#cb3-905" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">geoOrthographic</span>()</span>
<span id="cb3-906"><a href="#cb3-906" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">fitWidth</span>(earthRadius <span class="op">*</span> <span class="dv">2</span><span class="op">,</span> earthGeo)</span>
<span id="cb3-907"><a href="#cb3-907" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">rotate</span>([solarAngleDeg <span class="op">-</span> <span class="dv">90</span><span class="op">,</span> <span class="dv">0</span>])</span>
<span id="cb3-908"><a href="#cb3-908" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">translate</span>([<span class="dv">0</span><span class="op">,</span> <span class="dv">0</span>])<span class="op">;</span></span>
<span id="cb3-909"><a href="#cb3-909" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> path <span class="op">=</span> d3<span class="op">.</span><span class="fu">geoPath</span>(projection)<span class="op">.</span><span class="fu">pointRadius</span>(<span class="fl">1.5</span>)<span class="op">;</span></span>
<span id="cb3-910"><a href="#cb3-910" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> staticPath <span class="op">=</span> d3<span class="op">.</span><span class="fu">geoPath</span>(staticProjection)<span class="op">;</span></span>
<span id="cb3-911"><a href="#cb3-911" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> solarSystem <span class="op">=</span> <span class="bu">root</span></span>
<span id="cb3-912"><a href="#cb3-912" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">append</span>(<span class="st">"g"</span>)</span>
<span id="cb3-913"><a href="#cb3-913" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">"transform"</span><span class="op">,</span> <span class="vs">`translate(</span><span class="sc">${</span>width <span class="op">/</span> <span class="dv">2</span><span class="sc">}</span><span class="vs">)`</span>)<span class="op">;</span></span>
<span id="cb3-914"><a href="#cb3-914" aria-hidden="true" tabindex="-1"></a>  solarSystem<span class="op">.</span><span class="fu">append</span>(<span class="st">"circle"</span>)<span class="op">.</span><span class="fu">attr</span>(<span class="st">"r"</span><span class="op">,</span> sunRadius)<span class="op">.</span><span class="fu">attr</span>(<span class="st">"fill"</span><span class="op">,</span> colors<span class="op">.</span><span class="at">sun</span>)<span class="op">;</span></span>
<span id="cb3-915"><a href="#cb3-915" aria-hidden="true" tabindex="-1"></a>  <span class="co">/* Draw orbit */</span></span>
<span id="cb3-916"><a href="#cb3-916" aria-hidden="true" tabindex="-1"></a>  solarSystem</span>
<span id="cb3-917"><a href="#cb3-917" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">append</span>(<span class="st">"ellipse"</span>)</span>
<span id="cb3-918"><a href="#cb3-918" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">"rx"</span><span class="op">,</span> solarSystemRadius)</span>
<span id="cb3-919"><a href="#cb3-919" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">"ry"</span><span class="op">,</span> stretch <span class="op">*</span> solarSystemRadius)</span>
<span id="cb3-920"><a href="#cb3-920" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">"fill"</span><span class="op">,</span> <span class="st">"none"</span>)</span>
<span id="cb3-921"><a href="#cb3-921" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">"stroke"</span><span class="op">,</span> <span class="st">"black"</span>)<span class="op">;</span></span>
<span id="cb3-922"><a href="#cb3-922" aria-hidden="true" tabindex="-1"></a>  <span class="co">/* Draw month ticks */</span></span>
<span id="cb3-923"><a href="#cb3-923" aria-hidden="true" tabindex="-1"></a>  d3<span class="op">.</span><span class="fu">range</span>(<span class="dv">12</span>)<span class="op">.</span><span class="fu">map</span>((m) <span class="kw">=&gt;</span> {</span>
<span id="cb3-924"><a href="#cb3-924" aria-hidden="true" tabindex="-1"></a>    <span class="kw">const</span> d <span class="op">=</span> <span class="kw">new</span> <span class="bu">Date</span>(date<span class="op">.</span><span class="fu">getFullYear</span>()<span class="op">,</span> m<span class="op">,</span> <span class="dv">1</span>)<span class="op">;</span></span>
<span id="cb3-925"><a href="#cb3-925" aria-hidden="true" tabindex="-1"></a>    <span class="kw">const</span> angle <span class="op">=</span> <span class="fu">getSolarAngle</span>(d)<span class="op">;</span></span>
<span id="cb3-926"><a href="#cb3-926" aria-hidden="true" tabindex="-1"></a>    solarSystem</span>
<span id="cb3-927"><a href="#cb3-927" aria-hidden="true" tabindex="-1"></a>      <span class="op">.</span><span class="fu">append</span>(<span class="st">"line"</span>)</span>
<span id="cb3-928"><a href="#cb3-928" aria-hidden="true" tabindex="-1"></a>      <span class="op">.</span><span class="fu">attr</span>(<span class="st">"x1"</span><span class="op">,</span> (solarSystemRadius <span class="op">+</span> <span class="dv">6</span>) <span class="op">*</span> <span class="bu">Math</span><span class="op">.</span><span class="fu">sin</span>(angle))</span>
<span id="cb3-929"><a href="#cb3-929" aria-hidden="true" tabindex="-1"></a>      <span class="op">.</span><span class="fu">attr</span>(<span class="st">"y1"</span><span class="op">,</span> (solarSystemRadius <span class="op">+</span> <span class="dv">6</span>) <span class="op">*</span> stretch <span class="op">*</span> <span class="bu">Math</span><span class="op">.</span><span class="fu">cos</span>(angle))</span>
<span id="cb3-930"><a href="#cb3-930" aria-hidden="true" tabindex="-1"></a>      <span class="op">.</span><span class="fu">attr</span>(<span class="st">"x2"</span><span class="op">,</span> (solarSystemRadius <span class="op">-</span> <span class="dv">6</span>) <span class="op">*</span> <span class="bu">Math</span><span class="op">.</span><span class="fu">sin</span>(angle))</span>
<span id="cb3-931"><a href="#cb3-931" aria-hidden="true" tabindex="-1"></a>      <span class="op">.</span><span class="fu">attr</span>(<span class="st">"y2"</span><span class="op">,</span> (solarSystemRadius <span class="op">-</span> <span class="dv">6</span>) <span class="op">*</span> stretch <span class="op">*</span> <span class="bu">Math</span><span class="op">.</span><span class="fu">cos</span>(angle))</span>
<span id="cb3-932"><a href="#cb3-932" aria-hidden="true" tabindex="-1"></a>      <span class="op">.</span><span class="fu">attr</span>(<span class="st">"stroke"</span><span class="op">,</span> <span class="st">"black"</span>)<span class="op">;</span></span>
<span id="cb3-933"><a href="#cb3-933" aria-hidden="true" tabindex="-1"></a>    <span class="kw">const</span> startMonthAngle <span class="op">=</span> <span class="fu">getSolarAngle</span>(<span class="kw">new</span> <span class="bu">Date</span>(date<span class="op">.</span><span class="fu">getFullYear</span>()<span class="op">,</span> m<span class="op">,</span> <span class="dv">1</span>))<span class="op">;</span></span>
<span id="cb3-934"><a href="#cb3-934" aria-hidden="true" tabindex="-1"></a>    solarSystem</span>
<span id="cb3-935"><a href="#cb3-935" aria-hidden="true" tabindex="-1"></a>      <span class="op">.</span><span class="fu">append</span>(<span class="st">"text"</span>)</span>
<span id="cb3-936"><a href="#cb3-936" aria-hidden="true" tabindex="-1"></a>      <span class="op">.</span><span class="fu">text</span>(<span class="fu">date2doty</span>(d))</span>
<span id="cb3-937"><a href="#cb3-937" aria-hidden="true" tabindex="-1"></a>      <span class="op">.</span><span class="fu">attr</span>(<span class="st">"x"</span><span class="op">,</span> (solarSystemRadius <span class="op">+</span> <span class="dv">18</span>) <span class="op">*</span> <span class="bu">Math</span><span class="op">.</span><span class="fu">sin</span>(startMonthAngle))</span>
<span id="cb3-938"><a href="#cb3-938" aria-hidden="true" tabindex="-1"></a>      <span class="op">.</span><span class="fu">attr</span>(</span>
<span id="cb3-939"><a href="#cb3-939" aria-hidden="true" tabindex="-1"></a>        <span class="st">"y"</span><span class="op">,</span></span>
<span id="cb3-940"><a href="#cb3-940" aria-hidden="true" tabindex="-1"></a>        (solarSystemRadius <span class="op">+</span> <span class="dv">18</span>) <span class="op">*</span> <span class="fl">1.18</span> <span class="op">*</span> stretch <span class="op">*</span> <span class="bu">Math</span><span class="op">.</span><span class="fu">cos</span>(startMonthAngle)</span>
<span id="cb3-941"><a href="#cb3-941" aria-hidden="true" tabindex="-1"></a>      )</span>
<span id="cb3-942"><a href="#cb3-942" aria-hidden="true" tabindex="-1"></a>      <span class="op">.</span><span class="fu">attr</span>(<span class="st">"text-anchor"</span><span class="op">,</span> <span class="st">"middle"</span>)</span>
<span id="cb3-943"><a href="#cb3-943" aria-hidden="true" tabindex="-1"></a>      <span class="op">.</span><span class="fu">attr</span>(<span class="st">"font-size"</span><span class="op">,</span> fontSize <span class="op">*</span> (width <span class="op">&lt;</span> <span class="dv">165</span> <span class="op">?</span> <span class="op">.</span><span class="dv">9</span> <span class="op">:</span> width <span class="op">&lt;</span> <span class="dv">265</span> <span class="op">?</span> <span class="dv">1</span> <span class="op">:</span> width <span class="op">&lt;</span> <span class="dv">365</span> <span class="op">?</span> <span class="fl">1.1</span> <span class="op">:</span> <span class="fl">1.2</span>))</span>
<span id="cb3-944"><a href="#cb3-944" aria-hidden="true" tabindex="-1"></a>      <span class="op">.</span><span class="fu">attr</span>(<span class="st">"dominant-baseline"</span><span class="op">,</span> <span class="st">"middle"</span>)</span>
<span id="cb3-945"><a href="#cb3-945" aria-hidden="true" tabindex="-1"></a>      <span class="op">.</span><span class="fu">attr</span>(<span class="st">"font-size"</span><span class="op">,</span> fontSize <span class="op">*</span> (width <span class="op">&lt;</span> <span class="dv">165</span> <span class="op">?</span> <span class="op">.</span><span class="dv">9</span> <span class="op">:</span> width <span class="op">&lt;</span> <span class="dv">265</span> <span class="op">?</span> <span class="dv">1</span> <span class="op">:</span> width <span class="op">&lt;</span> <span class="dv">365</span> <span class="op">?</span> <span class="fl">1.1</span> <span class="op">:</span> <span class="fl">1.2</span>))</span>
<span id="cb3-946"><a href="#cb3-946" aria-hidden="true" tabindex="-1"></a>      <span class="op">.</span><span class="fu">attr</span>(<span class="st">"font-family"</span><span class="op">,</span> <span class="st">"sans-serif"</span>)</span>
<span id="cb3-947"><a href="#cb3-947" aria-hidden="true" tabindex="-1"></a>      <span class="op">.</span><span class="fu">attr</span>(<span class="st">"fill"</span><span class="op">,</span> <span class="st">"black"</span>)<span class="op">;</span></span>
<span id="cb3-948"><a href="#cb3-948" aria-hidden="true" tabindex="-1"></a>  })<span class="op">;</span></span>
<span id="cb3-949"><a href="#cb3-949" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> earth <span class="op">=</span> solarSystem</span>
<span id="cb3-950"><a href="#cb3-950" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">append</span>(<span class="st">"g"</span>)</span>
<span id="cb3-951"><a href="#cb3-951" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">"transform"</span><span class="op">,</span> <span class="vs">`translate(</span><span class="sc">${</span>x<span class="sc">}</span><span class="vs">, </span><span class="sc">${</span>y<span class="sc">}</span><span class="vs">)`</span>)<span class="op">;</span></span>
<span id="cb3-952"><a href="#cb3-952" aria-hidden="true" tabindex="-1"></a>  earth</span>
<span id="cb3-953"><a href="#cb3-953" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">append</span>(<span class="st">"line"</span>)</span>
<span id="cb3-954"><a href="#cb3-954" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">"y1"</span><span class="op">,</span> <span class="op">-</span><span class="fl">1.5</span> <span class="op">*</span> earthRadius)</span>
<span id="cb3-955"><a href="#cb3-955" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">"y2"</span><span class="op">,</span> <span class="fl">1.5</span> <span class="op">*</span> earthRadius)</span>
<span id="cb3-956"><a href="#cb3-956" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">"stroke"</span><span class="op">,</span> <span class="st">"blue"</span>)</span>
<span id="cb3-957"><a href="#cb3-957" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">"transform"</span><span class="op">,</span> <span class="vs">`rotate(-23.5)`</span>)<span class="op">;</span></span>
<span id="cb3-958"><a href="#cb3-958" aria-hidden="true" tabindex="-1"></a>  earth<span class="op">.</span><span class="fu">append</span>(<span class="st">"path"</span>)<span class="op">.</span><span class="fu">attr</span>(<span class="st">"d"</span><span class="op">,</span> <span class="fu">path</span>(earthGeo))<span class="op">.</span><span class="fu">attr</span>(<span class="st">"fill"</span><span class="op">,</span> colors<span class="op">.</span><span class="at">ocean</span>)<span class="op">;</span></span>
<span id="cb3-959"><a href="#cb3-959" aria-hidden="true" tabindex="-1"></a>  earth<span class="op">.</span><span class="fu">append</span>(<span class="st">"path"</span>)<span class="op">.</span><span class="fu">attr</span>(<span class="st">"d"</span><span class="op">,</span> <span class="fu">path</span>(land))<span class="op">.</span><span class="fu">attr</span>(<span class="st">"fill"</span><span class="op">,</span> colors<span class="op">.</span><span class="at">land</span>)<span class="op">;</span></span>
<span id="cb3-960"><a href="#cb3-960" aria-hidden="true" tabindex="-1"></a>  earth<span class="op">.</span><span class="fu">append</span>(<span class="st">"path"</span>)</span>
<span id="cb3-961"><a href="#cb3-961" aria-hidden="true" tabindex="-1"></a>  <span class="op">.</span><span class="fu">attr</span>(<span class="st">"d"</span><span class="op">,</span> <span class="fu">path</span>(countries))</span>
<span id="cb3-962"><a href="#cb3-962" aria-hidden="true" tabindex="-1"></a>  <span class="op">.</span><span class="fu">attr</span>(<span class="st">"stroke-width"</span><span class="op">,</span> <span class="st">".075"</span>)</span>
<span id="cb3-963"><a href="#cb3-963" aria-hidden="true" tabindex="-1"></a>  <span class="op">.</span><span class="fu">attr</span>(<span class="st">"fill"</span><span class="op">,</span> <span class="st">"none"</span>)</span>
<span id="cb3-964"><a href="#cb3-964" aria-hidden="true" tabindex="-1"></a>  <span class="op">.</span><span class="fu">attr</span>(<span class="st">"stroke"</span><span class="op">,</span> <span class="st">"#555"</span>)<span class="op">;</span></span>
<span id="cb3-965"><a href="#cb3-965" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> shadowPolygon <span class="op">=</span> [</span>
<span id="cb3-966"><a href="#cb3-966" aria-hidden="true" tabindex="-1"></a>    [<span class="dv">0</span><span class="op">,</span> <span class="op">-</span><span class="dv">90</span>]<span class="op">,</span></span>
<span id="cb3-967"><a href="#cb3-967" aria-hidden="true" tabindex="-1"></a>    [<span class="dv">0</span><span class="op">,</span> <span class="dv">0</span>]<span class="op">,</span></span>
<span id="cb3-968"><a href="#cb3-968" aria-hidden="true" tabindex="-1"></a>    [<span class="dv">0</span><span class="op">,</span> <span class="dv">90</span>]<span class="op">,</span></span>
<span id="cb3-969"><a href="#cb3-969" aria-hidden="true" tabindex="-1"></a>    [<span class="dv">180</span><span class="op">,</span> <span class="dv">0</span>]<span class="op">,</span></span>
<span id="cb3-970"><a href="#cb3-970" aria-hidden="true" tabindex="-1"></a>    [<span class="dv">0</span><span class="op">,</span> <span class="op">-</span><span class="dv">90</span>]</span>
<span id="cb3-971"><a href="#cb3-971" aria-hidden="true" tabindex="-1"></a>  ]<span class="op">;</span></span>
<span id="cb3-972"><a href="#cb3-972" aria-hidden="true" tabindex="-1"></a>  earth</span>
<span id="cb3-973"><a href="#cb3-973" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">append</span>(<span class="st">"path"</span>)</span>
<span id="cb3-974"><a href="#cb3-974" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">"d"</span><span class="op">,</span> <span class="fu">staticPath</span>({ <span class="dt">type</span><span class="op">:</span> <span class="st">"Polygon"</span><span class="op">,</span> <span class="dt">coordinates</span><span class="op">:</span> [shadowPolygon] }))</span>
<span id="cb3-975"><a href="#cb3-975" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">"fill"</span><span class="op">,</span> <span class="st">"rgba(0, 0, 0, 0.5)"</span>)<span class="op">;</span></span>
<span id="cb3-976"><a href="#cb3-976" aria-hidden="true" tabindex="-1"></a>  earth</span>
<span id="cb3-977"><a href="#cb3-977" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">append</span>(<span class="st">"path"</span>)</span>
<span id="cb3-978"><a href="#cb3-978" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">"d"</span><span class="op">,</span> <span class="fu">path</span>({ <span class="dt">type</span><span class="op">:</span> <span class="st">"Point"</span><span class="op">,</span> <span class="dt">coordinates</span><span class="op">:</span> location }))</span>
<span id="cb3-979"><a href="#cb3-979" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">"r"</span><span class="op">,</span> <span class="dv">18</span>)</span>
<span id="cb3-980"><a href="#cb3-980" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">"stroke-width"</span><span class="op">,</span> <span class="op">.</span><span class="dv">3</span>)</span>
<span id="cb3-981"><a href="#cb3-981" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">"stroke"</span><span class="op">,</span> <span class="st">"black"</span>)</span>
<span id="cb3-982"><a href="#cb3-982" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">"fill"</span><span class="op">,</span> <span class="st">"red"</span>)<span class="op">;</span></span>
<span id="cb3-983"><a href="#cb3-983" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb3-984"><a href="#cb3-984" aria-hidden="true" tabindex="-1"></a><span class="kw">function</span> <span class="fu">greg2doty</span>(month <span class="op">=</span> <span class="dv">1</span><span class="op">,</span> day <span class="op">=</span> <span class="dv">1</span>) {</span>
<span id="cb3-985"><a href="#cb3-985" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> <span class="bu">Math</span><span class="op">.</span><span class="fu">floor</span>(</span>
<span id="cb3-986"><a href="#cb3-986" aria-hidden="true" tabindex="-1"></a>        (<span class="dv">153</span> <span class="op">*</span> (month <span class="op">&gt;</span> <span class="dv">2</span> <span class="op">?</span> month <span class="op">-</span> <span class="dv">3</span> <span class="op">:</span> month <span class="op">+</span> <span class="dv">9</span>) <span class="op">+</span> <span class="dv">2</span>) <span class="op">/</span> <span class="dv">5</span> <span class="op">+</span> day <span class="op">-</span> <span class="dv">1</span></span>
<span id="cb3-987"><a href="#cb3-987" aria-hidden="true" tabindex="-1"></a>)}</span>
<span id="cb3-988"><a href="#cb3-988" aria-hidden="true" tabindex="-1"></a><span class="kw">function</span> <span class="fu">date2doty</span>(date) {</span>
<span id="cb3-989"><a href="#cb3-989" aria-hidden="true" tabindex="-1"></a>  <span class="cf">return</span> <span class="fu">greg2doty</span>(date<span class="op">.</span><span class="fu">getMonth</span>() <span class="op">+</span> <span class="dv">1</span><span class="op">,</span> date<span class="op">.</span><span class="fu">getDate</span>())</span>
<span id="cb3-990"><a href="#cb3-990" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb3-991"><a href="#cb3-991" aria-hidden="true" tabindex="-1"></a><span class="kw">function</span> <span class="fu">date2doty1</span>(date) {</span>
<span id="cb3-992"><a href="#cb3-992" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> doty <span class="op">=</span> <span class="fu">greg2doty</span>(date<span class="op">.</span><span class="fu">getMonth</span>() <span class="op">+</span> <span class="dv">1</span><span class="op">,</span> date<span class="op">.</span><span class="fu">getDate</span>())</span>
<span id="cb3-993"><a href="#cb3-993" aria-hidden="true" tabindex="-1"></a>  <span class="cf">return</span> doty <span class="op">===</span> <span class="dv">31</span> <span class="op">?</span> <span class="st">"Day "</span> <span class="op">+</span> <span class="bu">String</span>(doty) <span class="op">:</span> doty</span>
<span id="cb3-994"><a href="#cb3-994" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb3-995"><a href="#cb3-995" aria-hidden="true" tabindex="-1"></a><span class="co">// https://observablehq.com/@dbridges/visualizing-seasonal-daylight</span></span>
<span id="cb3-996"><a href="#cb3-996" aria-hidden="true" tabindex="-1"></a>globe <span class="op">=</span> (<span class="bu">root</span><span class="op">,</span> { width<span class="op">,</span> location<span class="op">,</span> date<span class="op">,</span> hour }) <span class="kw">=&gt;</span> {</span>
<span id="cb3-997"><a href="#cb3-997" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> solarAngle <span class="op">=</span> <span class="fu">getSolarAngle</span>(date)<span class="op">;</span></span>
<span id="cb3-998"><a href="#cb3-998" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> solarAngleDeg <span class="op">=</span> <span class="fu">toDegrees</span>(solarAngle)<span class="op">;</span></span>
<span id="cb3-999"><a href="#cb3-999" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> hourSpin <span class="op">=</span> <span class="dv">360</span> <span class="op">*</span> ((hour <span class="op">+</span> <span class="dv">12</span>) <span class="op">/</span> <span class="dv">24</span>)<span class="op">;</span></span>
<span id="cb3-1000"><a href="#cb3-1000" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> spin <span class="op">=</span> (<span class="dv">180</span> <span class="op">+</span> <span class="op">-</span>location[<span class="dv">0</span>] <span class="op">+</span> solarAngleDeg <span class="op">+</span> hourSpin)<span class="op">;</span></span>
<span id="cb3-1001"><a href="#cb3-1001" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> tilt <span class="op">=</span> <span class="op">-</span><span class="dv">15</span><span class="op">;</span></span>
<span id="cb3-1002"><a href="#cb3-1002" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> projection <span class="op">=</span> d3<span class="op">.</span><span class="fu">geoOrthographic</span>()</span>
<span id="cb3-1003"><a href="#cb3-1003" aria-hidden="true" tabindex="-1"></a>                       <span class="op">.</span><span class="fu">fitWidth</span>(width<span class="op">,</span> graticule)</span>
<span id="cb3-1004"><a href="#cb3-1004" aria-hidden="true" tabindex="-1"></a>                       <span class="op">.</span><span class="fu">rotate</span>([spin<span class="op">,</span> tilt<span class="op">,</span> <span class="fl">23.5</span>])<span class="op">;</span></span>
<span id="cb3-1005"><a href="#cb3-1005" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> path <span class="op">=</span> d3<span class="op">.</span><span class="fu">geoPath</span>(projection)<span class="op">;</span></span>
<span id="cb3-1006"><a href="#cb3-1006" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> unClippedProjection <span class="op">=</span> d3<span class="op">.</span><span class="fu">geoOrthographic</span>()</span>
<span id="cb3-1007"><a href="#cb3-1007" aria-hidden="true" tabindex="-1"></a>                                <span class="op">.</span><span class="fu">clipAngle</span>(<span class="kw">null</span>)</span>
<span id="cb3-1008"><a href="#cb3-1008" aria-hidden="true" tabindex="-1"></a>                                <span class="op">.</span><span class="fu">fitWidth</span>(width<span class="op">,</span> graticule)</span>
<span id="cb3-1009"><a href="#cb3-1009" aria-hidden="true" tabindex="-1"></a>                                <span class="op">.</span><span class="fu">rotate</span>([spin<span class="op">,</span> tilt<span class="op">,</span> <span class="fl">23.5</span>])<span class="op">;</span></span>
<span id="cb3-1010"><a href="#cb3-1010" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> unClippedPath <span class="op">=</span> d3<span class="op">.</span><span class="fu">geoPath</span>(unClippedProjection)<span class="op">;</span></span>
<span id="cb3-1011"><a href="#cb3-1011" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> staticProjection <span class="op">=</span> d3<span class="op">.</span><span class="fu">geoOrthographic</span>()</span>
<span id="cb3-1012"><a href="#cb3-1012" aria-hidden="true" tabindex="-1"></a>                             <span class="op">.</span><span class="fu">fitWidth</span>(width<span class="op">,</span> graticule)</span>
<span id="cb3-1013"><a href="#cb3-1013" aria-hidden="true" tabindex="-1"></a>                             <span class="op">.</span><span class="fu">rotate</span>([solarAngleDeg <span class="op">-</span> <span class="dv">90</span><span class="op">,</span> tilt])<span class="op">;</span></span>
<span id="cb3-1014"><a href="#cb3-1014" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> staticPath <span class="op">=</span> d3<span class="op">.</span><span class="fu">geoPath</span>(staticProjection)<span class="op">;</span></span>
<span id="cb3-1015"><a href="#cb3-1015" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> background <span class="op">=</span> <span class="bu">root</span><span class="op">.</span><span class="fu">append</span>(<span class="st">"g"</span>)<span class="op">;</span></span>
<span id="cb3-1016"><a href="#cb3-1016" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> earth <span class="op">=</span> <span class="bu">root</span><span class="op">.</span><span class="fu">append</span>(<span class="st">"g"</span>)<span class="op">.</span><span class="fu">style</span>(<span class="st">"opacity"</span><span class="op">,</span> <span class="fl">0.75</span>)<span class="op">;</span></span>
<span id="cb3-1017"><a href="#cb3-1017" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> foreground <span class="op">=</span> <span class="bu">root</span><span class="op">.</span><span class="fu">append</span>(<span class="st">"g"</span>)<span class="op">;</span></span>
<span id="cb3-1018"><a href="#cb3-1018" aria-hidden="true" tabindex="-1"></a>  earth<span class="op">.</span><span class="fu">append</span>(<span class="st">"path"</span>)</span>
<span id="cb3-1019"><a href="#cb3-1019" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">"d"</span><span class="op">,</span> <span class="fu">path</span>({<span class="dt">type</span><span class="op">:</span> <span class="st">"Sphere"</span>}))</span>
<span id="cb3-1020"><a href="#cb3-1020" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">"fill"</span><span class="op">,</span> colors<span class="op">.</span><span class="at">ocean</span>)</span>
<span id="cb3-1021"><a href="#cb3-1021" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">"stroke"</span><span class="op">,</span> <span class="st">"#9ecbda"</span>)<span class="op">;</span></span>
<span id="cb3-1022"><a href="#cb3-1022" aria-hidden="true" tabindex="-1"></a>  earth<span class="op">.</span><span class="fu">append</span>(<span class="st">"path"</span>)</span>
<span id="cb3-1023"><a href="#cb3-1023" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">"d"</span><span class="op">,</span> <span class="fu">path</span>(graticule))</span>
<span id="cb3-1024"><a href="#cb3-1024" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">"stroke-width"</span><span class="op">,</span> <span class="st">"1"</span>)</span>
<span id="cb3-1025"><a href="#cb3-1025" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">"fill"</span><span class="op">,</span> <span class="st">"none"</span>)</span>
<span id="cb3-1026"><a href="#cb3-1026" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">"stroke"</span><span class="op">,</span> <span class="st">"#888"</span>)<span class="op">;</span></span>
<span id="cb3-1027"><a href="#cb3-1027" aria-hidden="true" tabindex="-1"></a>  earth<span class="op">.</span><span class="fu">append</span>(<span class="st">"path"</span>)</span>
<span id="cb3-1028"><a href="#cb3-1028" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">"d"</span><span class="op">,</span> <span class="fu">path</span>(land))</span>
<span id="cb3-1029"><a href="#cb3-1029" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">"fill"</span><span class="op">,</span> colors<span class="op">.</span><span class="at">land</span>)<span class="op">;</span></span>
<span id="cb3-1030"><a href="#cb3-1030" aria-hidden="true" tabindex="-1"></a>  earth<span class="op">.</span><span class="fu">append</span>(<span class="st">"path"</span>)</span>
<span id="cb3-1031"><a href="#cb3-1031" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">"d"</span><span class="op">,</span> <span class="fu">path</span>(countries))</span>
<span id="cb3-1032"><a href="#cb3-1032" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">"stroke-width"</span><span class="op">,</span> <span class="st">"1"</span>)</span>
<span id="cb3-1033"><a href="#cb3-1033" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">"fill"</span><span class="op">,</span> <span class="st">"none"</span>)</span>
<span id="cb3-1034"><a href="#cb3-1034" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">"stroke"</span><span class="op">,</span> <span class="st">"#000"</span>)<span class="op">;</span></span>
<span id="cb3-1035"><a href="#cb3-1035" aria-hidden="true" tabindex="-1"></a>  background<span class="op">.</span><span class="fu">append</span>(<span class="st">"path"</span>)</span>
<span id="cb3-1036"><a href="#cb3-1036" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">"d"</span><span class="op">,</span> <span class="fu">unClippedPath</span>({<span class="dt">type</span><span class="op">:</span> <span class="st">"Point"</span><span class="op">,</span> <span class="dt">coordinates</span><span class="op">:</span> location}))</span>
<span id="cb3-1037"><a href="#cb3-1037" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">"fill"</span><span class="op">,</span> <span class="st">"red"</span>)<span class="op">;</span></span>
<span id="cb3-1038"><a href="#cb3-1038" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> latitudeCoords <span class="op">=</span> (latitude<span class="op">,</span> start<span class="op">,</span> end) <span class="kw">=&gt;</span> {</span>
<span id="cb3-1039"><a href="#cb3-1039" aria-hidden="true" tabindex="-1"></a>    <span class="kw">const</span> longitudes <span class="op">=</span> d3<span class="op">.</span><span class="fu">range</span>(start<span class="op">,</span> end<span class="op">,</span> <span class="dv">2</span>)<span class="op">.</span><span class="fu">concat</span>(end)<span class="op">;</span></span>
<span id="cb3-1040"><a href="#cb3-1040" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> longitudes<span class="op">.</span><span class="fu">map</span>(d <span class="kw">=&gt;</span> [d<span class="op">,</span> latitude])<span class="op">;</span></span>
<span id="cb3-1041"><a href="#cb3-1041" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb3-1042"><a href="#cb3-1042" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> correctSpin <span class="op">=</span> d3<span class="op">.</span><span class="fu">geoRotation</span>([<span class="op">-</span>hourSpin<span class="op">,</span> <span class="dv">0</span>])<span class="op">;</span></span>
<span id="cb3-1043"><a href="#cb3-1043" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> correctTilt <span class="op">=</span> d3<span class="op">.</span><span class="fu">geoRotation</span>([<span class="dv">6</span><span class="op">,</span> <span class="dv">0</span><span class="op">,</span> <span class="dv">0</span>])<span class="op">;</span></span>
<span id="cb3-1044"><a href="#cb3-1044" aria-hidden="true" tabindex="-1"></a>  <span class="co">/* total angular extent of day/night */</span></span>
<span id="cb3-1045"><a href="#cb3-1045" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> dayExtent <span class="op">=</span> <span class="dv">360</span> <span class="op">*</span> <span class="fu">dayLength</span>(date<span class="op">,</span> location[<span class="dv">1</span>]) <span class="op">/</span> <span class="dv">24</span><span class="op">;</span></span>
<span id="cb3-1046"><a href="#cb3-1046" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> nightExtent <span class="op">=</span> <span class="dv">360</span> <span class="op">-</span> dayExtent<span class="op">;</span></span>
<span id="cb3-1047"><a href="#cb3-1047" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> dayLine <span class="op">=</span> {</span>
<span id="cb3-1048"><a href="#cb3-1048" aria-hidden="true" tabindex="-1"></a>    <span class="dt">type</span><span class="op">:</span> <span class="st">"LineString"</span><span class="op">,</span></span>
<span id="cb3-1049"><a href="#cb3-1049" aria-hidden="true" tabindex="-1"></a>    <span class="dt">coordinates</span><span class="op">:</span> <span class="fu">latitudeCoords</span>(location[<span class="dv">1</span>]<span class="op">,</span></span>
<span id="cb3-1050"><a href="#cb3-1050" aria-hidden="true" tabindex="-1"></a>                                location[<span class="dv">0</span>] <span class="op">-</span> dayExtent <span class="op">/</span> <span class="dv">2</span><span class="op">,</span></span>
<span id="cb3-1051"><a href="#cb3-1051" aria-hidden="true" tabindex="-1"></a>                                location[<span class="dv">0</span>] <span class="op">+</span> dayExtent <span class="op">/</span> <span class="dv">2</span>)<span class="op">.</span><span class="fu">map</span>(d <span class="kw">=&gt;</span> <span class="fu">correctSpin</span>(d))</span>
<span id="cb3-1052"><a href="#cb3-1052" aria-hidden="true" tabindex="-1"></a>  }<span class="op">;</span></span>
<span id="cb3-1053"><a href="#cb3-1053" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> nightLine <span class="op">=</span> {</span>
<span id="cb3-1054"><a href="#cb3-1054" aria-hidden="true" tabindex="-1"></a>    <span class="dt">type</span><span class="op">:</span> <span class="st">"LineString"</span><span class="op">,</span></span>
<span id="cb3-1055"><a href="#cb3-1055" aria-hidden="true" tabindex="-1"></a>    <span class="dt">coordinates</span><span class="op">:</span> <span class="fu">latitudeCoords</span>(location[<span class="dv">1</span>]<span class="op">,</span></span>
<span id="cb3-1056"><a href="#cb3-1056" aria-hidden="true" tabindex="-1"></a>                                location[<span class="dv">0</span>] <span class="op">-</span> dayExtent <span class="op">/</span> <span class="dv">2</span> <span class="op">-</span> nightExtent<span class="op">,</span></span>
<span id="cb3-1057"><a href="#cb3-1057" aria-hidden="true" tabindex="-1"></a>                                location[<span class="dv">0</span>] <span class="op">-</span> dayExtent <span class="op">/</span> <span class="dv">2</span>)<span class="op">.</span><span class="fu">map</span>(d <span class="kw">=&gt;</span> <span class="fu">correctSpin</span>(d))</span>
<span id="cb3-1058"><a href="#cb3-1058" aria-hidden="true" tabindex="-1"></a>  }<span class="op">;</span></span>
<span id="cb3-1059"><a href="#cb3-1059" aria-hidden="true" tabindex="-1"></a>  background<span class="op">.</span><span class="fu">append</span>(<span class="st">"path"</span>)</span>
<span id="cb3-1060"><a href="#cb3-1060" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">"d"</span><span class="op">,</span> <span class="fu">unClippedPath</span>(dayLine))</span>
<span id="cb3-1061"><a href="#cb3-1061" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">"fill"</span><span class="op">,</span> <span class="st">"none"</span>)</span>
<span id="cb3-1062"><a href="#cb3-1062" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">"stroke"</span><span class="op">,</span> colors<span class="op">.</span><span class="at">day</span>)</span>
<span id="cb3-1063"><a href="#cb3-1063" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">"stroke-width"</span><span class="op">,</span> <span class="dv">3</span>)<span class="op">;</span></span>
<span id="cb3-1064"><a href="#cb3-1064" aria-hidden="true" tabindex="-1"></a>  background<span class="op">.</span><span class="fu">append</span>(<span class="st">"path"</span>)</span>
<span id="cb3-1065"><a href="#cb3-1065" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">"d"</span><span class="op">,</span> <span class="fu">unClippedPath</span>(nightLine))</span>
<span id="cb3-1066"><a href="#cb3-1066" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">"fill"</span><span class="op">,</span> <span class="st">"none"</span>)</span>
<span id="cb3-1067"><a href="#cb3-1067" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">"stroke"</span><span class="op">,</span> colors<span class="op">.</span><span class="at">night</span>)</span>
<span id="cb3-1068"><a href="#cb3-1068" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">"stroke-width"</span><span class="op">,</span> <span class="dv">3</span>)<span class="op">;</span></span>
<span id="cb3-1069"><a href="#cb3-1069" aria-hidden="true" tabindex="-1"></a>  foreground<span class="op">.</span><span class="fu">append</span>(<span class="st">"path"</span>)</span>
<span id="cb3-1070"><a href="#cb3-1070" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">"d"</span><span class="op">,</span> <span class="fu">path</span>(dayLine))</span>
<span id="cb3-1071"><a href="#cb3-1071" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">"fill"</span><span class="op">,</span> <span class="st">"none"</span>)</span>
<span id="cb3-1072"><a href="#cb3-1072" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">"stroke"</span><span class="op">,</span> colors<span class="op">.</span><span class="at">day</span>)</span>
<span id="cb3-1073"><a href="#cb3-1073" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">"stroke-width"</span><span class="op">,</span> <span class="dv">3</span>)<span class="op">;</span></span>
<span id="cb3-1074"><a href="#cb3-1074" aria-hidden="true" tabindex="-1"></a>  foreground<span class="op">.</span><span class="fu">append</span>(<span class="st">"path"</span>)</span>
<span id="cb3-1075"><a href="#cb3-1075" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">"d"</span><span class="op">,</span> <span class="fu">path</span>(nightLine))</span>
<span id="cb3-1076"><a href="#cb3-1076" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">"fill"</span><span class="op">,</span> <span class="st">"none"</span>)</span>
<span id="cb3-1077"><a href="#cb3-1077" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">"stroke"</span><span class="op">,</span> colors<span class="op">.</span><span class="at">night</span>)</span>
<span id="cb3-1078"><a href="#cb3-1078" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">"stroke-width"</span><span class="op">,</span> <span class="dv">3</span>)<span class="op">;</span></span>
<span id="cb3-1079"><a href="#cb3-1079" aria-hidden="true" tabindex="-1"></a>  foreground<span class="op">.</span><span class="fu">append</span>(<span class="st">"path"</span>)</span>
<span id="cb3-1080"><a href="#cb3-1080" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">"d"</span><span class="op">,</span> <span class="fu">path</span>({<span class="dt">type</span><span class="op">:</span> <span class="st">"Point"</span><span class="op">,</span> <span class="dt">coordinates</span><span class="op">:</span> location}))</span>
<span id="cb3-1081"><a href="#cb3-1081" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">"stroke-width"</span><span class="op">,</span> <span class="op">.</span><span class="dv">5</span>)</span>
<span id="cb3-1082"><a href="#cb3-1082" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">"stroke"</span><span class="op">,</span> <span class="st">"black"</span>)</span>
<span id="cb3-1083"><a href="#cb3-1083" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">"fill"</span><span class="op">,</span> <span class="st">"red"</span>)<span class="op">;</span></span>
<span id="cb3-1084"><a href="#cb3-1084" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> shadowPolygon <span class="op">=</span> [[<span class="dv">0</span><span class="op">,</span> <span class="op">-</span><span class="dv">90</span>]<span class="op">,</span> [<span class="dv">0</span><span class="op">,</span> <span class="dv">0</span>]<span class="op">,</span> [<span class="dv">0</span><span class="op">,</span> <span class="dv">90</span>]<span class="op">,</span> [<span class="dv">180</span><span class="op">,</span> <span class="dv">0</span>]<span class="op">,</span> [<span class="dv">0</span><span class="op">,</span> <span class="op">-</span><span class="dv">90</span>]]<span class="op">.</span><span class="fu">map</span>(d <span class="kw">=&gt;</span> <span class="fu">correctTilt</span>(d))<span class="op">;</span></span>
<span id="cb3-1085"><a href="#cb3-1085" aria-hidden="true" tabindex="-1"></a>  foreground<span class="op">.</span><span class="fu">append</span>(<span class="st">"path"</span>)</span>
<span id="cb3-1086"><a href="#cb3-1086" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">"d"</span><span class="op">,</span> <span class="fu">staticPath</span>({<span class="dt">type</span><span class="op">:</span> <span class="st">"Polygon"</span><span class="op">,</span> <span class="dt">coordinates</span><span class="op">:</span> [shadowPolygon]}))</span>
<span id="cb3-1087"><a href="#cb3-1087" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">"fill"</span><span class="op">,</span> <span class="st">"rgba(0, 0, 0, 0.25)"</span>)<span class="op">;</span></span>
<span id="cb3-1088"><a href="#cb3-1088" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb3-1089"><a href="#cb3-1089" aria-hidden="true" tabindex="-1"></a>dayOfYear <span class="op">=</span> (date) <span class="kw">=&gt;</span> {</span>
<span id="cb3-1090"><a href="#cb3-1090" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> yearStart <span class="op">=</span> <span class="kw">new</span> <span class="bu">Date</span>(date<span class="op">.</span><span class="fu">getFullYear</span>()<span class="op">,</span> <span class="dv">0</span><span class="op">,</span> <span class="dv">1</span><span class="op">+</span><span class="dv">60</span>)<span class="op">;</span></span>
<span id="cb3-1091"><a href="#cb3-1091" aria-hidden="true" tabindex="-1"></a>  <span class="cf">return</span> <span class="bu">Math</span><span class="op">.</span><span class="fu">floor</span>((date<span class="op">.</span><span class="fu">getTime</span>() <span class="op">-</span> yearStart<span class="op">.</span><span class="fu">getTime</span>())<span class="op">/</span><span class="dv">86400000</span>) <span class="op">+</span> <span class="dv">1</span></span>
<span id="cb3-1092"><a href="#cb3-1092" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb3-1093"><a href="#cb3-1093" aria-hidden="true" tabindex="-1"></a><span class="co">// https://observablehq.com/@dbridges/visualizing-seasonal-daylight</span></span>
<span id="cb3-1094"><a href="#cb3-1094" aria-hidden="true" tabindex="-1"></a>daylightPlot <span class="op">=</span> (</span>
<span id="cb3-1095"><a href="#cb3-1095" aria-hidden="true" tabindex="-1"></a>  <span class="bu">root</span><span class="op">,</span></span>
<span id="cb3-1096"><a href="#cb3-1096" aria-hidden="true" tabindex="-1"></a>  { width<span class="op">,</span> height<span class="op">,</span> year<span class="op">,</span> latitude<span class="op">,</span> defaultDate<span class="op">,</span> defaultHour }</span>
<span id="cb3-1097"><a href="#cb3-1097" aria-hidden="true" tabindex="-1"></a>) <span class="kw">=&gt;</span> {</span>
<span id="cb3-1098"><a href="#cb3-1098" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> margin <span class="op">=</span> { <span class="dt">top</span><span class="op">:</span> <span class="dv">24</span><span class="op">,</span> <span class="dt">bottom</span><span class="op">:</span> <span class="dv">32</span><span class="op">,</span> <span class="dt">left</span><span class="op">:</span> <span class="dv">48</span><span class="op">,</span> <span class="dt">right</span><span class="op">:</span> <span class="dv">0</span> }<span class="op">;</span></span>
<span id="cb3-1099"><a href="#cb3-1099" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> chartWidth <span class="op">=</span> width <span class="op">-</span> margin<span class="op">.</span><span class="at">left</span> <span class="op">-</span> margin<span class="op">.</span><span class="at">right</span><span class="op">;</span></span>
<span id="cb3-1100"><a href="#cb3-1100" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> chartHeight <span class="op">=</span> height <span class="op">-</span> margin<span class="op">.</span><span class="at">top</span> <span class="op">-</span> margin<span class="op">.</span><span class="at">bottom</span><span class="op">;</span></span>
<span id="cb3-1101"><a href="#cb3-1101" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> xTickValues <span class="op">=</span></span>
<span id="cb3-1102"><a href="#cb3-1102" aria-hidden="true" tabindex="-1"></a>    width <span class="op">&gt;</span> <span class="dv">280</span> <span class="op">?</span> [<span class="dv">3</span><span class="op">,</span> <span class="dv">6</span><span class="op">,</span> <span class="dv">9</span><span class="op">,</span> <span class="dv">12</span><span class="op">,</span> <span class="dv">15</span><span class="op">,</span> <span class="dv">18</span><span class="op">,</span> <span class="dv">21</span>] <span class="op">:</span> width <span class="op">&gt;</span> <span class="dv">140</span> <span class="op">?</span> [<span class="dv">6</span><span class="op">,</span> <span class="dv">12</span><span class="op">,</span> <span class="dv">18</span>] <span class="op">:</span> [<span class="dv">12</span>]<span class="op">;</span></span>
<span id="cb3-1103"><a href="#cb3-1103" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> xScale <span class="op">=</span> d3</span>
<span id="cb3-1104"><a href="#cb3-1104" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">scaleLinear</span>()</span>
<span id="cb3-1105"><a href="#cb3-1105" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">domain</span>([<span class="dv">0</span><span class="op">,</span> <span class="dv">24</span>])</span>
<span id="cb3-1106"><a href="#cb3-1106" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">range</span>([margin<span class="op">.</span><span class="at">left</span><span class="op">,</span> margin<span class="op">.</span><span class="at">left</span> <span class="op">+</span> chartWidth])</span>
<span id="cb3-1107"><a href="#cb3-1107" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">clamp</span>(<span class="kw">true</span>)<span class="op">;</span></span>
<span id="cb3-1108"><a href="#cb3-1108" aria-hidden="true" tabindex="-1"></a>  <span class="co">// y-axis scale</span></span>
<span id="cb3-1109"><a href="#cb3-1109" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> yScale <span class="op">=</span> d3</span>
<span id="cb3-1110"><a href="#cb3-1110" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">scaleTime</span>()</span>
<span id="cb3-1111"><a href="#cb3-1111" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">domain</span>([<span class="kw">new</span> <span class="bu">Date</span>(year<span class="op">,</span> <span class="dv">0</span><span class="op">,</span> <span class="dv">1</span><span class="op">+</span><span class="dv">60</span>)<span class="op">,</span> <span class="kw">new</span> <span class="bu">Date</span>(year<span class="op">,</span> <span class="dv">11</span><span class="op">,</span> <span class="dv">31</span><span class="op">+</span><span class="dv">60</span>)])</span>
<span id="cb3-1112"><a href="#cb3-1112" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">range</span>([margin<span class="op">.</span><span class="at">top</span><span class="op">,</span> margin<span class="op">.</span><span class="at">top</span> <span class="op">+</span> chartHeight])</span>
<span id="cb3-1113"><a href="#cb3-1113" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">clamp</span>(<span class="kw">true</span>)<span class="op">;</span></span>
<span id="cb3-1114"><a href="#cb3-1114" aria-hidden="true" tabindex="-1"></a>  <span class="co">// y-axis labels</span></span>
<span id="cb3-1115"><a href="#cb3-1115" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> yAxis <span class="op">=</span> d3</span>
<span id="cb3-1116"><a href="#cb3-1116" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">axisLeft</span>(yScale)</span>
<span id="cb3-1117"><a href="#cb3-1117" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">tickValues</span>(d3<span class="op">.</span><span class="at">timeMonth</span><span class="op">.</span><span class="fu">range</span>(<span class="kw">new</span> <span class="bu">Date</span>(year<span class="op">,</span> <span class="dv">0</span><span class="op">,</span> <span class="dv">1</span><span class="op">+</span><span class="dv">60</span>)<span class="op">,</span> <span class="kw">new</span> <span class="bu">Date</span>(year<span class="op">,</span> <span class="dv">12</span><span class="op">,</span> <span class="dv">1</span><span class="op">+</span><span class="dv">57</span>)))</span>
<span id="cb3-1118"><a href="#cb3-1118" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">tickSize</span>(chartWidth)</span>
<span id="cb3-1119"><a href="#cb3-1119" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">tickFormat</span>(date2doty1)<span class="op">;</span></span>
<span id="cb3-1120"><a href="#cb3-1120" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> xAxis <span class="op">=</span> d3</span>
<span id="cb3-1121"><a href="#cb3-1121" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">axisBottom</span>(xScale)</span>
<span id="cb3-1122"><a href="#cb3-1122" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">tickValues</span>(xTickValues)</span>
<span id="cb3-1123"><a href="#cb3-1123" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">tickSize</span>(chartHeight)</span>
<span id="cb3-1124"><a href="#cb3-1124" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">tickFormat</span>((d) <span class="kw">=&gt;</span> {</span>
<span id="cb3-1125"><a href="#cb3-1125" aria-hidden="true" tabindex="-1"></a>      <span class="cf">return</span> <span class="vs">`</span><span class="sc">${</span>d <span class="op">/</span> <span class="op">.</span><span class="bn">024</span><span class="sc">}</span><span class="vs">`</span><span class="op">;</span></span>
<span id="cb3-1126"><a href="#cb3-1126" aria-hidden="true" tabindex="-1"></a>    })<span class="op">;</span></span>
<span id="cb3-1127"><a href="#cb3-1127" aria-hidden="true" tabindex="-1"></a>  <span class="kw">let</span> date <span class="op">=</span> defaultDate <span class="op">||</span> <span class="kw">new</span> <span class="bu">Date</span>()<span class="op">;</span></span>
<span id="cb3-1128"><a href="#cb3-1128" aria-hidden="true" tabindex="-1"></a>  <span class="kw">let</span> hour <span class="op">=</span> defaultHour <span class="op">!=</span> <span class="kw">null</span> <span class="op">?</span> defaultHour <span class="op">:</span> date<span class="op">.</span><span class="fu">getHours</span>()<span class="op">;</span></span>
<span id="cb3-1129"><a href="#cb3-1129" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> handleMouseMove <span class="op">=</span> (e) <span class="kw">=&gt;</span> {}<span class="op">;</span></span>
<span id="cb3-1130"><a href="#cb3-1130" aria-hidden="true" tabindex="-1"></a>  <span class="bu">root</span></span>
<span id="cb3-1131"><a href="#cb3-1131" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">append</span>(<span class="st">"rect"</span>)</span>
<span id="cb3-1132"><a href="#cb3-1132" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">"x"</span><span class="op">,</span> margin<span class="op">.</span><span class="at">left</span>)</span>
<span id="cb3-1133"><a href="#cb3-1133" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">"y"</span><span class="op">,</span> margin<span class="op">.</span><span class="at">top</span>)</span>
<span id="cb3-1134"><a href="#cb3-1134" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">"width"</span><span class="op">,</span> chartWidth)</span>
<span id="cb3-1135"><a href="#cb3-1135" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">"height"</span><span class="op">,</span> chartHeight)</span>
<span id="cb3-1136"><a href="#cb3-1136" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">"rx"</span><span class="op">,</span> <span class="fl">0.05</span> <span class="op">*</span> width)</span>
<span id="cb3-1137"><a href="#cb3-1137" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">"fill"</span><span class="op">,</span> colors<span class="op">.</span><span class="at">night</span>)<span class="op">;</span></span>
<span id="cb3-1138"><a href="#cb3-1138" aria-hidden="true" tabindex="-1"></a>  <span class="bu">root</span></span>
<span id="cb3-1139"><a href="#cb3-1139" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">append</span>(<span class="st">"g"</span>)</span>
<span id="cb3-1140"><a href="#cb3-1140" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">"transform"</span><span class="op">,</span> <span class="vs">`translate(</span><span class="sc">${</span>margin<span class="op">.</span><span class="at">left</span> <span class="op">+</span> chartWidth<span class="sc">}</span><span class="vs">, 0)`</span>)</span>
<span id="cb3-1141"><a href="#cb3-1141" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">call</span>(yAxis)</span>
<span id="cb3-1142"><a href="#cb3-1142" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">call</span>((g) <span class="kw">=&gt;</span> g<span class="op">.</span><span class="fu">select</span>(<span class="st">".domain"</span>)<span class="op">.</span><span class="fu">remove</span>())</span>
<span id="cb3-1143"><a href="#cb3-1143" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">call</span>((g) <span class="kw">=&gt;</span> g<span class="op">.</span><span class="fu">selectAll</span>(<span class="st">".tick"</span>)<span class="op">.</span><span class="fu">attr</span>(<span class="st">"color"</span><span class="op">,</span> colors<span class="op">.</span><span class="at">grid</span>))</span>
<span id="cb3-1144"><a href="#cb3-1144" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">call</span>((g) <span class="kw">=&gt;</span> g<span class="op">.</span><span class="fu">selectAll</span>(<span class="st">".tick text"</span>)<span class="op">.</span><span class="fu">attr</span>(<span class="st">"font-size"</span><span class="op">,</span> fontSize <span class="op">*</span> (width <span class="op">&lt;</span> <span class="dv">165</span> <span class="op">?</span> <span class="op">.</span><span class="dv">7</span> <span class="op">:</span> width <span class="op">&lt;</span> <span class="dv">265</span> <span class="op">?</span> <span class="op">.</span><span class="dv">9</span> <span class="op">:</span> width <span class="op">&lt;</span> <span class="dv">365</span> <span class="op">?</span> <span class="fl">1.3</span> <span class="op">:</span> <span class="fl">1.4</span>)))</span>
<span id="cb3-1145"><a href="#cb3-1145" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">call</span>((g) <span class="kw">=&gt;</span> g<span class="op">.</span><span class="fu">selectAll</span>(<span class="st">".tick text"</span>)<span class="op">.</span><span class="fu">attr</span>(<span class="st">"color"</span><span class="op">,</span> <span class="st">"black"</span>))</span>
<span id="cb3-1146"><a href="#cb3-1146" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">call</span>((g) <span class="kw">=&gt;</span> g<span class="op">.</span><span class="fu">selectAll</span>(<span class="st">".tick line"</span>)<span class="op">.</span><span class="fu">attr</span>(<span class="st">"stroke-dasharray"</span><span class="op">,</span> <span class="st">"5 3"</span>))<span class="op">;</span></span>
<span id="cb3-1147"><a href="#cb3-1147" aria-hidden="true" tabindex="-1"></a>  <span class="bu">root</span></span>
<span id="cb3-1148"><a href="#cb3-1148" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">append</span>(<span class="st">"g"</span>)</span>
<span id="cb3-1149"><a href="#cb3-1149" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">"transform"</span><span class="op">,</span> <span class="vs">`translate(0, </span><span class="sc">${</span>margin<span class="op">.</span><span class="at">top</span><span class="sc">}</span><span class="vs">)`</span>)</span>
<span id="cb3-1150"><a href="#cb3-1150" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">call</span>(xAxis)</span>
<span id="cb3-1151"><a href="#cb3-1151" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">call</span>((g) <span class="kw">=&gt;</span> g<span class="op">.</span><span class="fu">select</span>(<span class="st">".domain"</span>)<span class="op">.</span><span class="fu">remove</span>())</span>
<span id="cb3-1152"><a href="#cb3-1152" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">call</span>((g) <span class="kw">=&gt;</span> g<span class="op">.</span><span class="fu">selectAll</span>(<span class="st">".tick"</span>)<span class="op">.</span><span class="fu">attr</span>(<span class="st">"color"</span><span class="op">,</span> colors<span class="op">.</span><span class="at">grid</span>))</span>
<span id="cb3-1153"><a href="#cb3-1153" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">call</span>((g) <span class="kw">=&gt;</span> g<span class="op">.</span><span class="fu">selectAll</span>(<span class="st">".tick text"</span>)<span class="op">.</span><span class="fu">attr</span>(<span class="st">"font-size"</span><span class="op">,</span> fontSize <span class="op">*</span> (width <span class="op">&lt;</span> <span class="dv">165</span> <span class="op">?</span> <span class="op">.</span><span class="dv">9</span> <span class="op">:</span> width <span class="op">&lt;</span> <span class="dv">265</span> <span class="op">?</span> <span class="fl">1.1</span> <span class="op">:</span> width <span class="op">&lt;</span> <span class="dv">365</span> <span class="op">?</span> <span class="fl">1.2</span> <span class="op">:</span> <span class="fl">1.3</span>)))</span>
<span id="cb3-1154"><a href="#cb3-1154" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">call</span>((g) <span class="kw">=&gt;</span> g<span class="op">.</span><span class="fu">selectAll</span>(<span class="st">".tick text"</span>)<span class="op">.</span><span class="fu">attr</span>(<span class="st">"color"</span><span class="op">,</span> <span class="st">"black"</span>))</span>
<span id="cb3-1155"><a href="#cb3-1155" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">call</span>((g) <span class="kw">=&gt;</span> g<span class="op">.</span><span class="fu">selectAll</span>(<span class="st">".tick line"</span>)<span class="op">.</span><span class="fu">attr</span>(<span class="st">"stroke-dasharray"</span><span class="op">,</span> <span class="st">"5 3"</span>))<span class="op">;</span></span>
<span id="cb3-1156"><a href="#cb3-1156" aria-hidden="true" tabindex="-1"></a>  <span class="bu">root</span></span>
<span id="cb3-1157"><a href="#cb3-1157" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">append</span>(<span class="st">"text"</span>)</span>
<span id="cb3-1158"><a href="#cb3-1158" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">text</span>(<span class="st">"Time of day (millidays)"</span>)</span>
<span id="cb3-1159"><a href="#cb3-1159" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">"x"</span><span class="op">,</span> margin<span class="op">.</span><span class="at">left</span> <span class="op">+</span> chartWidth <span class="op">/</span> <span class="dv">2</span>)</span>
<span id="cb3-1160"><a href="#cb3-1160" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">"y"</span><span class="op">,</span> margin<span class="op">.</span><span class="at">top</span> <span class="op">+</span> chartHeight <span class="op">+</span> margin<span class="op">.</span><span class="at">bottom</span> <span class="op">-</span> (width <span class="op">&lt;</span> <span class="dv">165</span> <span class="op">?</span> <span class="dv">9</span> <span class="op">:</span> width <span class="op">&lt;</span> <span class="dv">265</span> <span class="op">?</span> <span class="dv">6</span> <span class="op">:</span> width <span class="op">&lt;</span> <span class="dv">365</span> <span class="op">?</span> <span class="dv">2</span> <span class="op">:</span> <span class="dv">0</span>))</span>
<span id="cb3-1161"><a href="#cb3-1161" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">"text-anchor"</span><span class="op">,</span> <span class="st">"middle"</span>)</span>
<span id="cb3-1162"><a href="#cb3-1162" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">"font-size"</span><span class="op">,</span> fontSize <span class="op">*</span> (width <span class="op">&lt;</span> <span class="dv">165</span> <span class="op">?</span> <span class="op">.</span><span class="dv">85</span> <span class="op">:</span> width <span class="op">&lt;</span> <span class="dv">265</span> <span class="op">?</span> <span class="fl">1.15</span> <span class="op">:</span> width <span class="op">&lt;</span> <span class="dv">365</span> <span class="op">?</span> <span class="fl">1.5</span> <span class="op">:</span> <span class="fl">1.6</span>))</span>
<span id="cb3-1163"><a href="#cb3-1163" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">"font-family"</span><span class="op">,</span> <span class="st">"sans-serif"</span>)</span>
<span id="cb3-1164"><a href="#cb3-1164" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">"fill"</span><span class="op">,</span> <span class="st">"black"</span>)<span class="op">;</span></span>
<span id="cb3-1165"><a href="#cb3-1165" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> data <span class="op">=</span> <span class="fu">yearDates</span>(year)</span>
<span id="cb3-1166"><a href="#cb3-1166" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">map</span>((d) <span class="kw">=&gt;</span> [d<span class="op">,</span> <span class="fu">dayLength</span>(d<span class="op">,</span> latitude)])</span>
<span id="cb3-1167"><a href="#cb3-1167" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">filter</span>(([_<span class="op">,</span> d]) <span class="kw">=&gt;</span> d <span class="op">&gt;</span> <span class="dv">0</span>)<span class="op">;</span></span>
<span id="cb3-1168"><a href="#cb3-1168" aria-hidden="true" tabindex="-1"></a>  <span class="co">/* Render separate polygons for each continuous sequence of</span></span>
<span id="cb3-1169"><a href="#cb3-1169" aria-hidden="true" tabindex="-1"></a><span class="co">   * days with more than 0 hours of day light</span></span>
<span id="cb3-1170"><a href="#cb3-1170" aria-hidden="true" tabindex="-1"></a><span class="co">   */</span></span>
<span id="cb3-1171"><a href="#cb3-1171" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> polys <span class="op">=</span> []<span class="op">;</span></span>
<span id="cb3-1172"><a href="#cb3-1172" aria-hidden="true" tabindex="-1"></a>  <span class="kw">let</span> currentPoly <span class="op">=</span> []<span class="op">;</span></span>
<span id="cb3-1173"><a href="#cb3-1173" aria-hidden="true" tabindex="-1"></a>  <span class="cf">for</span> (<span class="kw">let</span> i <span class="op">=</span> <span class="dv">0</span><span class="op">;</span> i <span class="op">&lt;</span> data<span class="op">.</span><span class="at">length</span><span class="op">;</span> i<span class="op">++</span>) {</span>
<span id="cb3-1174"><a href="#cb3-1174" aria-hidden="true" tabindex="-1"></a>    <span class="kw">const</span> currentDate <span class="op">=</span> data[i][<span class="dv">0</span>]<span class="op">;</span></span>
<span id="cb3-1175"><a href="#cb3-1175" aria-hidden="true" tabindex="-1"></a>    <span class="kw">const</span> prevDate <span class="op">=</span> (data[i <span class="op">-</span> <span class="dv">1</span>] <span class="op">||</span> [])[<span class="dv">0</span>]<span class="op">;</span></span>
<span id="cb3-1176"><a href="#cb3-1176" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> (</span>
<span id="cb3-1177"><a href="#cb3-1177" aria-hidden="true" tabindex="-1"></a>      i <span class="op">===</span> <span class="dv">0</span> <span class="op">||</span></span>
<span id="cb3-1178"><a href="#cb3-1178" aria-hidden="true" tabindex="-1"></a>      currentDate<span class="op">.</span><span class="fu">getTime</span>() <span class="op">-</span> prevDate<span class="op">.</span><span class="fu">getTime</span>() <span class="op">&lt;</span> <span class="dv">3600</span> <span class="op">*</span> <span class="dv">24</span> <span class="op">*</span> <span class="dv">1000</span> <span class="op">*</span> <span class="fl">1.5</span></span>
<span id="cb3-1179"><a href="#cb3-1179" aria-hidden="true" tabindex="-1"></a>    ) {</span>
<span id="cb3-1180"><a href="#cb3-1180" aria-hidden="true" tabindex="-1"></a>      currentPoly<span class="op">.</span><span class="fu">push</span>(data[i])<span class="op">;</span></span>
<span id="cb3-1181"><a href="#cb3-1181" aria-hidden="true" tabindex="-1"></a>    } <span class="cf">else</span> {</span>
<span id="cb3-1182"><a href="#cb3-1182" aria-hidden="true" tabindex="-1"></a>      polys<span class="op">.</span><span class="fu">push</span>(currentPoly)<span class="op">;</span></span>
<span id="cb3-1183"><a href="#cb3-1183" aria-hidden="true" tabindex="-1"></a>      currentPoly <span class="op">=</span> [data[i]]<span class="op">;</span></span>
<span id="cb3-1184"><a href="#cb3-1184" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb3-1185"><a href="#cb3-1185" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb3-1186"><a href="#cb3-1186" aria-hidden="true" tabindex="-1"></a>  polys<span class="op">.</span><span class="fu">push</span>(currentPoly)<span class="op">;</span></span>
<span id="cb3-1187"><a href="#cb3-1187" aria-hidden="true" tabindex="-1"></a>  polys<span class="op">.</span><span class="fu">forEach</span>((p) <span class="kw">=&gt;</span> {</span>
<span id="cb3-1188"><a href="#cb3-1188" aria-hidden="true" tabindex="-1"></a>    <span class="kw">const</span> points <span class="op">=</span> [</span>
<span id="cb3-1189"><a href="#cb3-1189" aria-hidden="true" tabindex="-1"></a>      <span class="op">...</span>p<span class="op">.</span><span class="fu">map</span>(([d<span class="op">,</span> l]) <span class="kw">=&gt;</span> <span class="vs">`</span><span class="sc">${</span><span class="fu">xScale</span>(<span class="dv">12</span> <span class="op">-</span> l <span class="op">/</span> <span class="dv">2</span>)<span class="sc">}</span><span class="vs">,</span><span class="sc">${</span><span class="fu">yScale</span>(d)<span class="sc">}</span><span class="vs">`</span>)<span class="op">,</span></span>
<span id="cb3-1190"><a href="#cb3-1190" aria-hidden="true" tabindex="-1"></a>      <span class="op">...</span>p<span class="op">.</span><span class="fu">reverse</span>()<span class="op">.</span><span class="fu">map</span>(([d<span class="op">,</span> l]) <span class="kw">=&gt;</span> <span class="vs">`</span><span class="sc">${</span><span class="fu">xScale</span>(<span class="dv">12</span> <span class="op">+</span> l <span class="op">/</span> <span class="dv">2</span>)<span class="sc">}</span><span class="vs">,</span><span class="sc">${</span><span class="fu">yScale</span>(d)<span class="sc">}</span><span class="vs">`</span>)</span>
<span id="cb3-1191"><a href="#cb3-1191" aria-hidden="true" tabindex="-1"></a>    ]<span class="op">.</span><span class="fu">join</span>(<span class="st">" "</span>)<span class="op">;</span></span>
<span id="cb3-1192"><a href="#cb3-1192" aria-hidden="true" tabindex="-1"></a>    <span class="bu">root</span><span class="op">.</span><span class="fu">append</span>(<span class="st">"polygon"</span>)<span class="op">.</span><span class="fu">attr</span>(<span class="st">"points"</span><span class="op">,</span> points)<span class="op">.</span><span class="fu">attr</span>(<span class="st">"fill"</span><span class="op">,</span> colors<span class="op">.</span><span class="at">day</span>)<span class="op">;</span></span>
<span id="cb3-1193"><a href="#cb3-1193" aria-hidden="true" tabindex="-1"></a>  })<span class="op">;</span></span>
<span id="cb3-1194"><a href="#cb3-1194" aria-hidden="true" tabindex="-1"></a>  <span class="co">/* Legend */</span></span>
<span id="cb3-1195"><a href="#cb3-1195" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> legend <span class="op">=</span> <span class="bu">root</span></span>
<span id="cb3-1196"><a href="#cb3-1196" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">append</span>(<span class="st">"g"</span>)</span>
<span id="cb3-1197"><a href="#cb3-1197" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">"transform"</span><span class="op">,</span> <span class="vs">`translate(</span><span class="sc">${</span>margin<span class="op">.</span><span class="at">left</span> <span class="op">+</span> chartWidth <span class="op">/</span> <span class="dv">2</span> <span class="op">-</span> <span class="dv">64</span><span class="sc">}</span><span class="vs">)`</span>)<span class="op">;</span></span>
<span id="cb3-1198"><a href="#cb3-1198" aria-hidden="true" tabindex="-1"></a>  legend</span>
<span id="cb3-1199"><a href="#cb3-1199" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">append</span>(<span class="st">"rect"</span>)</span>
<span id="cb3-1200"><a href="#cb3-1200" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">"rx"</span><span class="op">,</span> <span class="dv">5</span>)</span>
<span id="cb3-1201"><a href="#cb3-1201" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">"x"</span><span class="op">,</span> <span class="op">-</span><span class="dv">34</span> <span class="op">+</span> <span class="dv">4</span> <span class="op">*</span> (width <span class="op">&lt;</span> <span class="dv">165</span> <span class="op">?</span> <span class="fl">12.7</span> <span class="op">:</span> width <span class="op">&lt;</span> <span class="dv">265</span> <span class="op">?</span> <span class="fl">5.5</span> <span class="op">:</span> width <span class="op">&lt;</span> <span class="dv">365</span> <span class="op">?</span> <span class="dv">3</span> <span class="op">:</span> <span class="dv">0</span>))</span>
<span id="cb3-1202"><a href="#cb3-1202" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">"y"</span><span class="op">,</span> <span class="fl">4.5</span> <span class="op">*</span> (width <span class="op">&lt;</span> <span class="dv">165</span> <span class="op">?</span> <span class="fl">1.9</span> <span class="op">:</span> width <span class="op">&lt;</span> <span class="dv">265</span> <span class="op">?</span> <span class="fl">1.4</span> <span class="op">:</span> width <span class="op">&lt;</span> <span class="dv">365</span> <span class="op">?</span> <span class="op">.</span><span class="dv">9</span> <span class="op">:</span> <span class="op">.</span><span class="dv">8</span>))</span>
<span id="cb3-1203"><a href="#cb3-1203" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">"width"</span><span class="op">,</span> fontSize <span class="op">*</span> (width <span class="op">&lt;</span> <span class="dv">165</span> <span class="op">?</span> <span class="dv">1</span> <span class="op">:</span> width <span class="op">&lt;</span> <span class="dv">265</span> <span class="op">?</span> <span class="fl">1.2</span> <span class="op">:</span> width <span class="op">&lt;</span> <span class="dv">365</span> <span class="op">?</span> <span class="fl">1.4</span> <span class="op">:</span> <span class="fl">1.6</span>))</span>
<span id="cb3-1204"><a href="#cb3-1204" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">"height"</span><span class="op">,</span> fontSize <span class="op">*</span> (width <span class="op">&lt;</span> <span class="dv">165</span> <span class="op">?</span> <span class="dv">1</span> <span class="op">:</span> width <span class="op">&lt;</span> <span class="dv">265</span> <span class="op">?</span> <span class="fl">1.2</span> <span class="op">:</span> width <span class="op">&lt;</span> <span class="dv">365</span> <span class="op">?</span> <span class="fl">1.4</span> <span class="op">:</span> <span class="fl">1.6</span>))</span>
<span id="cb3-1205"><a href="#cb3-1205" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">"fill"</span><span class="op">,</span> colors<span class="op">.</span><span class="at">night</span>)<span class="op">;</span></span>
<span id="cb3-1206"><a href="#cb3-1206" aria-hidden="true" tabindex="-1"></a>  legend</span>
<span id="cb3-1207"><a href="#cb3-1207" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">append</span>(<span class="st">"text"</span>)</span>
<span id="cb3-1208"><a href="#cb3-1208" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">"x"</span><span class="op">,</span> <span class="op">-</span><span class="dv">16</span> <span class="op">+</span> <span class="dv">4</span> <span class="op">*</span> (width <span class="op">&lt;</span> <span class="dv">165</span> <span class="op">?</span> <span class="fl">11.8</span> <span class="op">:</span> width <span class="op">&lt;</span> <span class="dv">265</span> <span class="op">?</span> <span class="fl">4.9</span> <span class="op">:</span> width <span class="op">&lt;</span> <span class="dv">365</span> <span class="op">?</span> <span class="fl">2.8</span> <span class="op">:</span> <span class="dv">0</span>))</span>
<span id="cb3-1209"><a href="#cb3-1209" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">"y"</span><span class="op">,</span> <span class="dv">19</span>)</span>
<span id="cb3-1210"><a href="#cb3-1210" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">"font-size"</span><span class="op">,</span> fontSize <span class="op">*</span> (width <span class="op">&lt;</span> <span class="dv">165</span> <span class="op">?</span> <span class="dv">1</span> <span class="op">:</span> width <span class="op">&lt;</span> <span class="dv">265</span> <span class="op">?</span> <span class="fl">1.2</span> <span class="op">:</span> width <span class="op">&lt;</span> <span class="dv">365</span> <span class="op">?</span> <span class="fl">1.4</span> <span class="op">:</span> <span class="fl">1.6</span>))</span>
<span id="cb3-1211"><a href="#cb3-1211" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">"font-family"</span><span class="op">,</span> <span class="st">"sans-serif"</span>)</span>
<span id="cb3-1212"><a href="#cb3-1212" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">text</span>(<span class="st">"Night"</span>)<span class="op">;</span></span>
<span id="cb3-1213"><a href="#cb3-1213" aria-hidden="true" tabindex="-1"></a>  legend</span>
<span id="cb3-1214"><a href="#cb3-1214" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">append</span>(<span class="st">"rect"</span>)</span>
<span id="cb3-1215"><a href="#cb3-1215" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">"x"</span><span class="op">,</span> <span class="dv">34</span> <span class="op">+</span> <span class="dv">4</span> <span class="op">*</span> (width <span class="op">&lt;</span> <span class="dv">165</span> <span class="op">?</span> <span class="fl">7.8</span> <span class="op">:</span> width <span class="op">&lt;</span> <span class="dv">265</span> <span class="op">?</span> <span class="fl">8.2</span> <span class="op">:</span> width <span class="op">&lt;</span> <span class="dv">365</span> <span class="op">?</span> <span class="fl">6.9</span> <span class="op">:</span> <span class="fl">4.2</span>))</span>
<span id="cb3-1216"><a href="#cb3-1216" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">"rx"</span><span class="op">,</span> <span class="dv">5</span>)</span>
<span id="cb3-1217"><a href="#cb3-1217" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">"y"</span><span class="op">,</span> <span class="fl">4.5</span> <span class="op">*</span> (width <span class="op">&lt;</span> <span class="dv">165</span> <span class="op">?</span> <span class="fl">1.9</span> <span class="op">:</span> width <span class="op">&lt;</span> <span class="dv">265</span> <span class="op">?</span> <span class="fl">1.4</span> <span class="op">:</span> width <span class="op">&lt;</span> <span class="dv">365</span> <span class="op">?</span> <span class="op">.</span><span class="dv">9</span> <span class="op">:</span> <span class="op">.</span><span class="dv">8</span>))</span>
<span id="cb3-1218"><a href="#cb3-1218" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">"width"</span><span class="op">,</span> fontSize <span class="op">*</span> (width <span class="op">&lt;</span> <span class="dv">165</span> <span class="op">?</span> <span class="dv">1</span> <span class="op">:</span> width <span class="op">&lt;</span> <span class="dv">265</span> <span class="op">?</span> <span class="fl">1.2</span> <span class="op">:</span> width <span class="op">&lt;</span> <span class="dv">365</span> <span class="op">?</span> <span class="fl">1.4</span> <span class="op">:</span> <span class="fl">1.6</span>))</span>
<span id="cb3-1219"><a href="#cb3-1219" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">"height"</span><span class="op">,</span> fontSize <span class="op">*</span> (width <span class="op">&lt;</span> <span class="dv">165</span> <span class="op">?</span> <span class="dv">1</span> <span class="op">:</span> width <span class="op">&lt;</span> <span class="dv">265</span> <span class="op">?</span> <span class="fl">1.2</span> <span class="op">:</span> width <span class="op">&lt;</span> <span class="dv">365</span> <span class="op">?</span> <span class="fl">1.4</span> <span class="op">:</span> <span class="fl">1.6</span>))</span>
<span id="cb3-1220"><a href="#cb3-1220" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">"fill"</span><span class="op">,</span> colors<span class="op">.</span><span class="at">day</span>)<span class="op">;</span></span>
<span id="cb3-1221"><a href="#cb3-1221" aria-hidden="true" tabindex="-1"></a>  legend</span>
<span id="cb3-1222"><a href="#cb3-1222" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">append</span>(<span class="st">"text"</span>)</span>
<span id="cb3-1223"><a href="#cb3-1223" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">"x"</span><span class="op">,</span> <span class="dv">52</span> <span class="op">+</span> <span class="dv">4</span> <span class="op">*</span> (width <span class="op">&lt;</span> <span class="dv">165</span> <span class="op">?</span> <span class="fl">6.8</span> <span class="op">:</span> width <span class="op">&lt;</span> <span class="dv">265</span> <span class="op">?</span> <span class="fl">7.8</span> <span class="op">:</span> width <span class="op">&lt;</span> <span class="dv">365</span> <span class="op">?</span> <span class="fl">6.9</span> <span class="op">:</span> <span class="fl">4.2</span>))</span>
<span id="cb3-1224"><a href="#cb3-1224" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">"y"</span><span class="op">,</span> <span class="dv">19</span>)</span>
<span id="cb3-1225"><a href="#cb3-1225" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">"font-size"</span><span class="op">,</span> fontSize <span class="op">*</span> (width <span class="op">&lt;</span> <span class="dv">165</span> <span class="op">?</span> <span class="dv">1</span> <span class="op">:</span> width <span class="op">&lt;</span> <span class="dv">265</span> <span class="op">?</span> <span class="fl">1.2</span> <span class="op">:</span> width <span class="op">&lt;</span> <span class="dv">365</span> <span class="op">?</span> <span class="fl">1.4</span> <span class="op">:</span> <span class="fl">1.6</span>))</span>
<span id="cb3-1226"><a href="#cb3-1226" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">"font-family"</span><span class="op">,</span> <span class="st">"sans-serif"</span>)</span>
<span id="cb3-1227"><a href="#cb3-1227" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">text</span>(<span class="st">"Day"</span>)<span class="op">;</span></span>
<span id="cb3-1228"><a href="#cb3-1228" aria-hidden="true" tabindex="-1"></a>  <span class="co">/* Time and date controls */</span></span>
<span id="cb3-1229"><a href="#cb3-1229" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> dateLine <span class="op">=</span> <span class="bu">root</span><span class="op">.</span><span class="fu">append</span>(<span class="st">"g"</span>)<span class="op">;</span></span>
<span id="cb3-1230"><a href="#cb3-1230" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> updateControlPositions <span class="op">=</span> () <span class="kw">=&gt;</span> {</span>
<span id="cb3-1231"><a href="#cb3-1231" aria-hidden="true" tabindex="-1"></a>    dateLine</span>
<span id="cb3-1232"><a href="#cb3-1232" aria-hidden="true" tabindex="-1"></a>      <span class="op">.</span><span class="fu">select</span>(<span class="st">"line"</span>)</span>
<span id="cb3-1233"><a href="#cb3-1233" aria-hidden="true" tabindex="-1"></a>      <span class="op">.</span><span class="fu">attr</span>(<span class="st">"id"</span><span class="op">,</span> <span class="st">"dateline"</span>)</span>
<span id="cb3-1234"><a href="#cb3-1234" aria-hidden="true" tabindex="-1"></a>      <span class="op">.</span><span class="fu">attr</span>(<span class="st">"x1"</span><span class="op">,</span> <span class="fu">xScale</span>(<span class="dv">0</span>))</span>
<span id="cb3-1235"><a href="#cb3-1235" aria-hidden="true" tabindex="-1"></a>      <span class="op">.</span><span class="fu">attr</span>(<span class="st">"y1"</span><span class="op">,</span> <span class="fu">yScale</span>(date))</span>
<span id="cb3-1236"><a href="#cb3-1236" aria-hidden="true" tabindex="-1"></a>      <span class="op">.</span><span class="fu">attr</span>(<span class="st">"x2"</span><span class="op">,</span> <span class="fu">xScale</span>(<span class="dv">24</span>))</span>
<span id="cb3-1237"><a href="#cb3-1237" aria-hidden="true" tabindex="-1"></a>      <span class="op">.</span><span class="fu">attr</span>(<span class="st">"y2"</span><span class="op">,</span> <span class="fu">yScale</span>(date))<span class="op">;</span></span>
<span id="cb3-1238"><a href="#cb3-1238" aria-hidden="true" tabindex="-1"></a>    dateLine</span>
<span id="cb3-1239"><a href="#cb3-1239" aria-hidden="true" tabindex="-1"></a>      <span class="op">.</span><span class="fu">select</span>(<span class="st">"rect"</span>)</span>
<span id="cb3-1240"><a href="#cb3-1240" aria-hidden="true" tabindex="-1"></a>      <span class="op">.</span><span class="fu">attr</span>(<span class="st">"id"</span><span class="op">,</span> <span class="st">"daterect"</span>)</span>
<span id="cb3-1241"><a href="#cb3-1241" aria-hidden="true" tabindex="-1"></a>      <span class="op">.</span><span class="fu">attr</span>(<span class="st">"x"</span><span class="op">,</span> <span class="fu">xScale</span>(<span class="dv">0</span>))</span>
<span id="cb3-1242"><a href="#cb3-1242" aria-hidden="true" tabindex="-1"></a>      <span class="op">.</span><span class="fu">attr</span>(<span class="st">"y"</span><span class="op">,</span> <span class="fu">yScale</span>(date) <span class="op">-</span> <span class="dv">4</span>)<span class="op">;</span></span>
<span id="cb3-1243"><a href="#cb3-1243" aria-hidden="true" tabindex="-1"></a>    <span class="bu">root</span></span>
<span id="cb3-1244"><a href="#cb3-1244" aria-hidden="true" tabindex="-1"></a>      <span class="op">.</span><span class="fu">select</span>(<span class="st">"#time-control"</span>)</span>
<span id="cb3-1245"><a href="#cb3-1245" aria-hidden="true" tabindex="-1"></a>      <span class="op">.</span><span class="fu">attr</span>(<span class="st">"cx"</span><span class="op">,</span> <span class="fu">xScale</span>(hour))</span>
<span id="cb3-1246"><a href="#cb3-1246" aria-hidden="true" tabindex="-1"></a>      <span class="op">.</span><span class="fu">attr</span>(<span class="st">"cy"</span><span class="op">,</span> <span class="fu">yScale</span>(date))<span class="op">;</span></span>
<span id="cb3-1247"><a href="#cb3-1247" aria-hidden="true" tabindex="-1"></a>  }<span class="op">;</span></span>
<span id="cb3-1248"><a href="#cb3-1248" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> dispatchDateHourChange <span class="op">=</span> () <span class="kw">=&gt;</span> {</span>
<span id="cb3-1249"><a href="#cb3-1249" aria-hidden="true" tabindex="-1"></a>    <span class="kw">const</span> detail <span class="op">=</span> { date<span class="op">,</span> hour }<span class="op">;</span></span>
<span id="cb3-1250"><a href="#cb3-1250" aria-hidden="true" tabindex="-1"></a>    <span class="kw">const</span> changeEvent <span class="op">=</span> <span class="kw">new</span> <span class="bu">CustomEvent</span>(EventType<span class="op">.</span><span class="at">DateHourChange</span><span class="op">,</span> {</span>
<span id="cb3-1251"><a href="#cb3-1251" aria-hidden="true" tabindex="-1"></a>      detail<span class="op">,</span></span>
<span id="cb3-1252"><a href="#cb3-1252" aria-hidden="true" tabindex="-1"></a>      <span class="dt">bubbles</span><span class="op">:</span> <span class="kw">true</span></span>
<span id="cb3-1253"><a href="#cb3-1253" aria-hidden="true" tabindex="-1"></a>    })<span class="op">;</span></span>
<span id="cb3-1254"><a href="#cb3-1254" aria-hidden="true" tabindex="-1"></a>    <span class="bu">root</span><span class="op">.</span><span class="fu">node</span>()<span class="op">.</span><span class="fu">dispatchEvent</span>(changeEvent)<span class="op">;</span></span>
<span id="cb3-1255"><a href="#cb3-1255" aria-hidden="true" tabindex="-1"></a>  }<span class="op">;</span></span>
<span id="cb3-1256"><a href="#cb3-1256" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> handleDateLineDrag <span class="op">=</span> ({ y }) <span class="kw">=&gt;</span> {</span>
<span id="cb3-1257"><a href="#cb3-1257" aria-hidden="true" tabindex="-1"></a>    date <span class="op">=</span> yScale<span class="op">.</span><span class="fu">invert</span>(y)<span class="op">;</span></span>
<span id="cb3-1258"><a href="#cb3-1258" aria-hidden="true" tabindex="-1"></a>    <span class="fu">updateControlPositions</span>()<span class="op">;</span></span>
<span id="cb3-1259"><a href="#cb3-1259" aria-hidden="true" tabindex="-1"></a>    <span class="fu">dispatchDateHourChange</span>()<span class="op">;</span></span>
<span id="cb3-1260"><a href="#cb3-1260" aria-hidden="true" tabindex="-1"></a>  }<span class="op">;</span></span>
<span id="cb3-1261"><a href="#cb3-1261" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> handleTimeCircleDrag <span class="op">=</span> ({ x }) <span class="kw">=&gt;</span> {</span>
<span id="cb3-1262"><a href="#cb3-1262" aria-hidden="true" tabindex="-1"></a>    hour <span class="op">=</span> xScale<span class="op">.</span><span class="fu">invert</span>(x)<span class="op">;</span></span>
<span id="cb3-1263"><a href="#cb3-1263" aria-hidden="true" tabindex="-1"></a>    <span class="fu">updateControlPositions</span>()<span class="op">;</span></span>
<span id="cb3-1264"><a href="#cb3-1264" aria-hidden="true" tabindex="-1"></a>    <span class="fu">dispatchDateHourChange</span>()<span class="op">;</span></span>
<span id="cb3-1265"><a href="#cb3-1265" aria-hidden="true" tabindex="-1"></a>  }<span class="op">;</span></span>
<span id="cb3-1266"><a href="#cb3-1266" aria-hidden="true" tabindex="-1"></a>  dateLine<span class="op">.</span><span class="fu">append</span>(<span class="st">"line"</span>)<span class="op">.</span><span class="fu">attr</span>(<span class="st">"stroke-width"</span><span class="op">,</span> <span class="dv">4</span>)<span class="op">.</span><span class="fu">attr</span>(<span class="st">"stroke"</span><span class="op">,</span> <span class="st">"red"</span>)<span class="op">;</span></span>
<span id="cb3-1267"><a href="#cb3-1267" aria-hidden="true" tabindex="-1"></a>  dateLine</span>
<span id="cb3-1268"><a href="#cb3-1268" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">append</span>(<span class="st">"rect"</span>)</span>
<span id="cb3-1269"><a href="#cb3-1269" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">"width"</span><span class="op">,</span> chartWidth)</span>
<span id="cb3-1270"><a href="#cb3-1270" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">"height"</span><span class="op">,</span> <span class="dv">8</span>)</span>
<span id="cb3-1271"><a href="#cb3-1271" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">"fill"</span><span class="op">,</span> <span class="st">"rgba(0, 0, 0, 0)"</span>)</span>
<span id="cb3-1272"><a href="#cb3-1272" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">style</span>(<span class="st">"cursor"</span><span class="op">,</span> <span class="st">"row-resize"</span>)</span>
<span id="cb3-1273"><a href="#cb3-1273" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">call</span>(d3<span class="op">.</span><span class="fu">drag</span>()<span class="op">.</span><span class="fu">on</span>(<span class="st">"drag"</span><span class="op">,</span> handleDateLineDrag))<span class="op">;</span></span>
<span id="cb3-1274"><a href="#cb3-1274" aria-hidden="true" tabindex="-1"></a>  <span class="bu">root</span></span>
<span id="cb3-1275"><a href="#cb3-1275" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">append</span>(<span class="st">"circle"</span>)</span>
<span id="cb3-1276"><a href="#cb3-1276" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">"id"</span><span class="op">,</span> <span class="st">"time-control"</span>)</span>
<span id="cb3-1277"><a href="#cb3-1277" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">"r"</span><span class="op">,</span> <span class="dv">12</span>)</span>
<span id="cb3-1278"><a href="#cb3-1278" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">"fill"</span><span class="op">,</span> <span class="st">"red"</span>)</span>
<span id="cb3-1279"><a href="#cb3-1279" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">"stroke-width"</span><span class="op">,</span> <span class="op">.</span><span class="dv">6</span>)</span>
<span id="cb3-1280"><a href="#cb3-1280" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">"stroke"</span><span class="op">,</span> <span class="st">"black"</span>)</span>
<span id="cb3-1281"><a href="#cb3-1281" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">style</span>(<span class="st">"cursor"</span><span class="op">,</span> <span class="st">"pointer"</span>)</span>
<span id="cb3-1282"><a href="#cb3-1282" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">call</span>(d3<span class="op">.</span><span class="fu">drag</span>()<span class="op">.</span><span class="fu">on</span>(<span class="st">"drag"</span><span class="op">,</span> handleTimeCircleDrag))<span class="op">;</span></span>
<span id="cb3-1283"><a href="#cb3-1283" aria-hidden="true" tabindex="-1"></a>  <span class="fu">updateControlPositions</span>()<span class="op">;</span></span>
<span id="cb3-1284"><a href="#cb3-1284" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb3-1285"><a href="#cb3-1285" aria-hidden="true" tabindex="-1"></a>fontSize <span class="op">=</span> <span class="dv">12</span><span class="op">;</span></span>
<span id="cb3-1286"><a href="#cb3-1286" aria-hidden="true" tabindex="-1"></a>getSolarAngle <span class="op">=</span> (date) <span class="kw">=&gt;</span> (<span class="fu">dayOfYear</span>(date) <span class="op">+</span> <span class="dv">10</span>) <span class="op">/</span> <span class="dv">365</span> <span class="op">*</span> <span class="bu">Math</span><span class="op">.</span><span class="cn">PI</span> <span class="op">*</span> <span class="dv">2</span> <span class="op">-</span> <span class="bu">Math</span><span class="op">.</span><span class="cn">PI</span> <span class="op">/</span> <span class="dv">2</span><span class="op">;</span></span>
<span id="cb3-1287"><a href="#cb3-1287" aria-hidden="true" tabindex="-1"></a><span class="co">/*</span></span>
<span id="cb3-1288"><a href="#cb3-1288" aria-hidden="true" tabindex="-1"></a><span class="co"> * Formulas uses the CBM model as reviewed here:</span></span>
<span id="cb3-1289"><a href="#cb3-1289" aria-hidden="true" tabindex="-1"></a><span class="co"> * https://www.ikhebeenvraag.be/mediastorage/FSDocument/171/Forsythe+-+A+model+comparison+for+daylength+as+a+function+of+latitude+and+day+of+year+-+1995.pdf</span></span>
<span id="cb3-1290"><a href="#cb3-1290" aria-hidden="true" tabindex="-1"></a><span class="co"> */</span></span>
<span id="cb3-1291"><a href="#cb3-1291" aria-hidden="true" tabindex="-1"></a>dayLength <span class="op">=</span> (date<span class="op">,</span> latitude) <span class="kw">=&gt;</span> {</span>
<span id="cb3-1292"><a href="#cb3-1292" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> yearStart <span class="op">=</span> <span class="kw">new</span> <span class="bu">Date</span>(date<span class="op">.</span><span class="fu">getFullYear</span>()<span class="op">,</span> <span class="dv">0</span><span class="op">,</span> <span class="dv">1</span>)<span class="op">;</span></span>
<span id="cb3-1293"><a href="#cb3-1293" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> dayOfYear <span class="op">=</span> <span class="bu">Math</span><span class="op">.</span><span class="fu">floor</span>((date<span class="op">.</span><span class="fu">getTime</span>() <span class="op">-</span> yearStart<span class="op">.</span><span class="fu">getTime</span>())<span class="op">/</span><span class="dv">86400000</span>) <span class="op">+</span> <span class="dv">1</span><span class="op">;</span></span>
<span id="cb3-1294"><a href="#cb3-1294" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> revAngle <span class="op">=</span> <span class="fl">0.2163108</span> <span class="op">+</span> <span class="dv">2</span> <span class="op">*</span> <span class="bu">Math</span><span class="op">.</span><span class="fu">atan</span>(<span class="fl">0.9671396</span> <span class="op">*</span> <span class="bu">Math</span><span class="op">.</span><span class="fu">tan</span>(<span class="fl">0.00860</span> <span class="op">*</span> (dayOfYear <span class="op">-</span> <span class="dv">186</span>)))<span class="op">;</span></span>
<span id="cb3-1295"><a href="#cb3-1295" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> decAngle <span class="op">=</span> <span class="bu">Math</span><span class="op">.</span><span class="fu">asin</span>(<span class="fl">0.39795</span> <span class="op">*</span> <span class="bu">Math</span><span class="op">.</span><span class="fu">cos</span>(revAngle))<span class="op">;</span></span>
<span id="cb3-1296"><a href="#cb3-1296" aria-hidden="true" tabindex="-1"></a>  <span class="co">/* daylight coefficient selected for apparent sunrise/sunset */</span></span>
<span id="cb3-1297"><a href="#cb3-1297" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> p <span class="op">=</span> <span class="fl">0.8333</span></span>
<span id="cb3-1298"><a href="#cb3-1298" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> intResult <span class="op">=</span></span>
<span id="cb3-1299"><a href="#cb3-1299" aria-hidden="true" tabindex="-1"></a>    (<span class="bu">Math</span><span class="op">.</span><span class="fu">sin</span>((p <span class="op">*</span> <span class="bu">Math</span><span class="op">.</span><span class="cn">PI</span>) <span class="op">/</span> <span class="dv">180</span>) <span class="op">+</span></span>
<span id="cb3-1300"><a href="#cb3-1300" aria-hidden="true" tabindex="-1"></a>      <span class="bu">Math</span><span class="op">.</span><span class="fu">sin</span>((latitude <span class="op">*</span> <span class="bu">Math</span><span class="op">.</span><span class="cn">PI</span>) <span class="op">/</span> <span class="dv">180</span>) <span class="op">*</span> <span class="bu">Math</span><span class="op">.</span><span class="fu">sin</span>(decAngle)) <span class="op">/</span></span>
<span id="cb3-1301"><a href="#cb3-1301" aria-hidden="true" tabindex="-1"></a>    (<span class="bu">Math</span><span class="op">.</span><span class="fu">cos</span>((latitude <span class="op">*</span> <span class="bu">Math</span><span class="op">.</span><span class="cn">PI</span>) <span class="op">/</span> <span class="dv">180</span>) <span class="op">*</span> <span class="bu">Math</span><span class="op">.</span><span class="fu">cos</span>(decAngle))<span class="op">;</span></span>
<span id="cb3-1302"><a href="#cb3-1302" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (intResult <span class="op">&gt;=</span> <span class="dv">1</span>) <span class="cf">return</span> <span class="dv">24</span><span class="op">;</span></span>
<span id="cb3-1303"><a href="#cb3-1303" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (intResult <span class="op">&lt;=</span> <span class="op">-</span><span class="dv">1</span>) <span class="cf">return</span> <span class="dv">0</span><span class="op">;</span></span>
<span id="cb3-1304"><a href="#cb3-1304" aria-hidden="true" tabindex="-1"></a>  <span class="cf">return</span> <span class="dv">24</span> <span class="op">-</span> <span class="dv">24</span> <span class="op">*</span> <span class="bu">Math</span><span class="op">.</span><span class="fu">acos</span>(intResult) <span class="op">/</span> <span class="bu">Math</span><span class="op">.</span><span class="cn">PI</span><span class="op">;</span></span>
<span id="cb3-1305"><a href="#cb3-1305" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb3-1306"><a href="#cb3-1306" aria-hidden="true" tabindex="-1"></a>yearDates <span class="op">=</span> (year) <span class="kw">=&gt;</span> {</span>
<span id="cb3-1307"><a href="#cb3-1307" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> startDate <span class="op">=</span> <span class="kw">new</span> <span class="bu">Date</span>(year<span class="op">,</span> <span class="dv">0</span><span class="op">,</span> <span class="dv">1</span><span class="op">+</span><span class="dv">60</span>)<span class="op">;</span></span>
<span id="cb3-1308"><a href="#cb3-1308" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> endDate <span class="op">=</span> <span class="kw">new</span> <span class="bu">Date</span>(year <span class="op">+</span> <span class="dv">1</span><span class="op">,</span> <span class="dv">0</span><span class="op">,</span> <span class="dv">1</span><span class="op">+</span><span class="dv">60</span>)<span class="op">;</span></span>
<span id="cb3-1309"><a href="#cb3-1309" aria-hidden="true" tabindex="-1"></a>  <span class="cf">return</span> d3<span class="op">.</span><span class="at">timeDay</span><span class="op">.</span><span class="fu">range</span>(startDate<span class="op">,</span> endDate)<span class="op">;</span></span>
<span id="cb3-1310"><a href="#cb3-1310" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb3-1311"><a href="#cb3-1311" aria-hidden="true" tabindex="-1"></a>height <span class="op">=</span> <span class="fl">0.65</span> <span class="op">*</span> width<span class="op">;</span></span>
<span id="cb3-1312"><a href="#cb3-1312" aria-hidden="true" tabindex="-1"></a>EventType <span class="op">=</span> ({</span>
<span id="cb3-1313"><a href="#cb3-1313" aria-hidden="true" tabindex="-1"></a>  <span class="dt">LocationChange</span><span class="op">:</span> <span class="st">"LOCATION_CHANGE"</span><span class="op">,</span></span>
<span id="cb3-1314"><a href="#cb3-1314" aria-hidden="true" tabindex="-1"></a>  <span class="dt">DateHourChange</span><span class="op">:</span> <span class="st">"DATE_HOUR_CHANGE"</span></span>
<span id="cb3-1315"><a href="#cb3-1315" aria-hidden="true" tabindex="-1"></a>})</span>
<span id="cb3-1316"><a href="#cb3-1316" aria-hidden="true" tabindex="-1"></a>colors <span class="op">=</span> ({</span>
<span id="cb3-1317"><a href="#cb3-1317" aria-hidden="true" tabindex="-1"></a>  <span class="dt">night</span><span class="op">:</span> <span class="st">"#719fb6"</span><span class="op">,</span></span>
<span id="cb3-1318"><a href="#cb3-1318" aria-hidden="true" tabindex="-1"></a>  <span class="dt">day</span><span class="op">:</span> <span class="st">"#ffe438"</span><span class="op">,</span></span>
<span id="cb3-1319"><a href="#cb3-1319" aria-hidden="true" tabindex="-1"></a>  <span class="dt">grid</span><span class="op">:</span> <span class="st">"#4b6a79"</span><span class="op">,</span></span>
<span id="cb3-1320"><a href="#cb3-1320" aria-hidden="true" tabindex="-1"></a>  <span class="dt">ocean</span><span class="op">:</span> <span class="st">"#adeeff"</span><span class="op">,</span></span>
<span id="cb3-1321"><a href="#cb3-1321" aria-hidden="true" tabindex="-1"></a>  <span class="dt">land</span><span class="op">:</span> <span class="st">"#f5f1dc"</span><span class="op">,</span></span>
<span id="cb3-1322"><a href="#cb3-1322" aria-hidden="true" tabindex="-1"></a>  <span class="dt">sun</span><span class="op">:</span> <span class="st">"#ffe438"</span></span>
<span id="cb3-1323"><a href="#cb3-1323" aria-hidden="true" tabindex="-1"></a>})</span>
<span id="cb3-1324"><a href="#cb3-1324" aria-hidden="true" tabindex="-1"></a>toRadians <span class="op">=</span> (val) <span class="kw">=&gt;</span> val <span class="op">*</span> <span class="bu">Math</span><span class="op">.</span><span class="cn">PI</span> <span class="op">/</span> <span class="dv">180</span></span>
<span id="cb3-1325"><a href="#cb3-1325" aria-hidden="true" tabindex="-1"></a>toDegrees <span class="op">=</span> (val) <span class="kw">=&gt;</span> val <span class="op">*</span> <span class="dv">180</span> <span class="op">/</span> <span class="bu">Math</span><span class="op">.</span><span class="cn">PI</span><span class="op">;</span></span>
<span id="cb3-1326"><a href="#cb3-1326" aria-hidden="true" tabindex="-1"></a>land <span class="op">=</span> topojson<span class="op">.</span><span class="fu">feature</span>(world<span class="op">,</span> world<span class="op">.</span><span class="at">objects</span><span class="op">.</span><span class="at">land</span>)<span class="op">;</span></span>
<span id="cb3-1327"><a href="#cb3-1327" aria-hidden="true" tabindex="-1"></a>d3 <span class="op">=</span> <span class="pp">require</span>(<span class="st">"d3@7"</span><span class="op">,</span> <span class="st">"d3-geo-projection@3"</span>)</span>
<span id="cb3-1328"><a href="#cb3-1328" aria-hidden="true" tabindex="-1"></a><span class="kw">function</span> <span class="fu">input</span>(config) {</span>
<span id="cb3-1329"><a href="#cb3-1329" aria-hidden="true" tabindex="-1"></a>  <span class="kw">let</span> {</span>
<span id="cb3-1330"><a href="#cb3-1330" aria-hidden="true" tabindex="-1"></a>    form<span class="op">,</span></span>
<span id="cb3-1331"><a href="#cb3-1331" aria-hidden="true" tabindex="-1"></a>    type <span class="op">=</span> <span class="st">"text"</span><span class="op">,</span></span>
<span id="cb3-1332"><a href="#cb3-1332" aria-hidden="true" tabindex="-1"></a>    attributes <span class="op">=</span> {}<span class="op">,</span></span>
<span id="cb3-1333"><a href="#cb3-1333" aria-hidden="true" tabindex="-1"></a>    action<span class="op">,</span></span>
<span id="cb3-1334"><a href="#cb3-1334" aria-hidden="true" tabindex="-1"></a>    getValue<span class="op">,</span></span>
<span id="cb3-1335"><a href="#cb3-1335" aria-hidden="true" tabindex="-1"></a>    title<span class="op">,</span></span>
<span id="cb3-1336"><a href="#cb3-1336" aria-hidden="true" tabindex="-1"></a>    description<span class="op">,</span></span>
<span id="cb3-1337"><a href="#cb3-1337" aria-hidden="true" tabindex="-1"></a>    format<span class="op">,</span></span>
<span id="cb3-1338"><a href="#cb3-1338" aria-hidden="true" tabindex="-1"></a>    display<span class="op">,</span></span>
<span id="cb3-1339"><a href="#cb3-1339" aria-hidden="true" tabindex="-1"></a>    submit<span class="op">,</span></span>
<span id="cb3-1340"><a href="#cb3-1340" aria-hidden="true" tabindex="-1"></a>    options</span>
<span id="cb3-1341"><a href="#cb3-1341" aria-hidden="true" tabindex="-1"></a>  } <span class="op">=</span> config<span class="op">;</span></span>
<span id="cb3-1342"><a href="#cb3-1342" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> wrapper <span class="op">=</span> <span class="fu">html</span><span class="vs">`&lt;div&gt;&lt;/div&gt;`</span><span class="op">;</span></span>
<span id="cb3-1343"><a href="#cb3-1343" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (<span class="op">!</span>form)</span>
<span id="cb3-1344"><a href="#cb3-1344" aria-hidden="true" tabindex="-1"></a>    form <span class="op">=</span> <span class="fu">html</span><span class="vs">`&lt;form&gt;</span></span>
<span id="cb3-1345"><a href="#cb3-1345" aria-hidden="true" tabindex="-1"></a><span class="vs">    &lt;input name=input type=</span><span class="sc">${</span>type<span class="sc">}</span><span class="vs"> /&gt;</span></span>
<span id="cb3-1346"><a href="#cb3-1346" aria-hidden="true" tabindex="-1"></a><span class="vs">  &lt;/form&gt;`</span><span class="op">;</span></span>
<span id="cb3-1347"><a href="#cb3-1347" aria-hidden="true" tabindex="-1"></a>  <span class="bu">Object</span><span class="op">.</span><span class="fu">keys</span>(attributes)<span class="op">.</span><span class="fu">forEach</span>(key <span class="kw">=&gt;</span> {</span>
<span id="cb3-1348"><a href="#cb3-1348" aria-hidden="true" tabindex="-1"></a>    <span class="kw">const</span> val <span class="op">=</span> attributes[key]<span class="op">;</span></span>
<span id="cb3-1349"><a href="#cb3-1349" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> (val <span class="op">!=</span> <span class="kw">null</span>) form<span class="op">.</span><span class="at">input</span><span class="op">.</span><span class="fu">setAttribute</span>(key<span class="op">,</span> val)<span class="op">;</span></span>
<span id="cb3-1350"><a href="#cb3-1350" aria-hidden="true" tabindex="-1"></a>  })<span class="op">;</span></span>
<span id="cb3-1351"><a href="#cb3-1351" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (submit)</span>
<span id="cb3-1352"><a href="#cb3-1352" aria-hidden="true" tabindex="-1"></a>    form<span class="op">.</span><span class="fu">append</span>(</span>
<span id="cb3-1353"><a href="#cb3-1353" aria-hidden="true" tabindex="-1"></a>      <span class="fu">html</span><span class="vs">`&lt;input name=submit type=submit style="margin: 0 0.75em" value="</span><span class="sc">${</span></span>
<span id="cb3-1354"><a href="#cb3-1354" aria-hidden="true" tabindex="-1"></a>        <span class="kw">typeof</span> submit <span class="op">==</span> <span class="st">"string"</span> <span class="op">?</span> submit <span class="op">:</span> <span class="st">"Submit"</span></span>
<span id="cb3-1355"><a href="#cb3-1355" aria-hidden="true" tabindex="-1"></a>      <span class="sc">}</span><span class="vs">" /&gt;`</span></span>
<span id="cb3-1356"><a href="#cb3-1356" aria-hidden="true" tabindex="-1"></a>    )<span class="op">;</span></span>
<span id="cb3-1357"><a href="#cb3-1357" aria-hidden="true" tabindex="-1"></a>  form<span class="op">.</span><span class="fu">append</span>(</span>
<span id="cb3-1358"><a href="#cb3-1358" aria-hidden="true" tabindex="-1"></a>    <span class="fu">html</span><span class="vs">`&lt;output name=output style="font: 14px Menlo, Consolas, monospace; margin-left: 0.1em; text-align:center;"&gt;&lt;/output&gt;`</span></span>
<span id="cb3-1359"><a href="#cb3-1359" aria-hidden="true" tabindex="-1"></a>  )<span class="op">;</span></span>
<span id="cb3-1360"><a href="#cb3-1360" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (title)</span>
<span id="cb3-1361"><a href="#cb3-1361" aria-hidden="true" tabindex="-1"></a>    form<span class="op">.</span><span class="fu">prepend</span>(</span>
<span id="cb3-1362"><a href="#cb3-1362" aria-hidden="true" tabindex="-1"></a>      <span class="fu">html</span><span class="vs">`&lt;div style="font: 700 0.9rem sans-serif; margin-bottom: 3px;"&gt;</span><span class="sc">${</span>title<span class="sc">}</span><span class="vs">&lt;/div&gt;`</span></span>
<span id="cb3-1363"><a href="#cb3-1363" aria-hidden="true" tabindex="-1"></a>    )<span class="op">;</span></span>
<span id="cb3-1364"><a href="#cb3-1364" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (description)</span>
<span id="cb3-1365"><a href="#cb3-1365" aria-hidden="true" tabindex="-1"></a>    form<span class="op">.</span><span class="fu">append</span>(</span>
<span id="cb3-1366"><a href="#cb3-1366" aria-hidden="true" tabindex="-1"></a>      <span class="fu">html</span><span class="vs">`&lt;div style="font-size: 0.85rem; font-style: italic; margin-top: 3px;"&gt;</span><span class="sc">${</span>description<span class="sc">}</span><span class="vs">&lt;/div&gt;`</span></span>
<span id="cb3-1367"><a href="#cb3-1367" aria-hidden="true" tabindex="-1"></a>    )<span class="op">;</span></span>
<span id="cb3-1368"><a href="#cb3-1368" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (format)</span>
<span id="cb3-1369"><a href="#cb3-1369" aria-hidden="true" tabindex="-1"></a>    format <span class="op">=</span> <span class="kw">typeof</span> format <span class="op">===</span> <span class="st">"function"</span> <span class="op">?</span> format <span class="op">:</span> d3format<span class="op">.</span><span class="fu">format</span>(format)<span class="op">;</span></span>
<span id="cb3-1370"><a href="#cb3-1370" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (action) {</span>
<span id="cb3-1371"><a href="#cb3-1371" aria-hidden="true" tabindex="-1"></a>    <span class="fu">action</span>(form)<span class="op">;</span></span>
<span id="cb3-1372"><a href="#cb3-1372" aria-hidden="true" tabindex="-1"></a>  } <span class="cf">else</span> {</span>
<span id="cb3-1373"><a href="#cb3-1373" aria-hidden="true" tabindex="-1"></a>    <span class="kw">const</span> verb <span class="op">=</span> submit</span>
<span id="cb3-1374"><a href="#cb3-1374" aria-hidden="true" tabindex="-1"></a>      <span class="op">?</span> <span class="st">"onsubmit"</span></span>
<span id="cb3-1375"><a href="#cb3-1375" aria-hidden="true" tabindex="-1"></a>      <span class="op">:</span> type <span class="op">==</span> <span class="st">"button"</span></span>
<span id="cb3-1376"><a href="#cb3-1376" aria-hidden="true" tabindex="-1"></a>      <span class="op">?</span> <span class="st">"onclick"</span></span>
<span id="cb3-1377"><a href="#cb3-1377" aria-hidden="true" tabindex="-1"></a>      <span class="op">:</span> type <span class="op">==</span> <span class="st">"checkbox"</span> <span class="op">||</span> type <span class="op">==</span> <span class="st">"radio"</span></span>
<span id="cb3-1378"><a href="#cb3-1378" aria-hidden="true" tabindex="-1"></a>      <span class="op">?</span> <span class="st">"onchange"</span></span>
<span id="cb3-1379"><a href="#cb3-1379" aria-hidden="true" tabindex="-1"></a>      <span class="op">:</span> <span class="st">"oninput"</span><span class="op">;</span></span>
<span id="cb3-1380"><a href="#cb3-1380" aria-hidden="true" tabindex="-1"></a>    form[verb] <span class="op">=</span> e <span class="kw">=&gt;</span> {</span>
<span id="cb3-1381"><a href="#cb3-1381" aria-hidden="true" tabindex="-1"></a>      e <span class="op">&amp;&amp;</span> e<span class="op">.</span><span class="fu">preventDefault</span>()<span class="op">;</span></span>
<span id="cb3-1382"><a href="#cb3-1382" aria-hidden="true" tabindex="-1"></a>      <span class="kw">const</span> value <span class="op">=</span> getValue <span class="op">?</span> <span class="fu">getValue</span>(form<span class="op">.</span><span class="at">input</span>) <span class="op">:</span> form<span class="op">.</span><span class="at">input</span><span class="op">.</span><span class="at">value</span><span class="op">;</span></span>
<span id="cb3-1383"><a href="#cb3-1383" aria-hidden="true" tabindex="-1"></a>      <span class="cf">if</span> (form<span class="op">.</span><span class="at">output</span>) {</span>
<span id="cb3-1384"><a href="#cb3-1384" aria-hidden="true" tabindex="-1"></a>        <span class="kw">const</span> out <span class="op">=</span> display <span class="op">?</span> <span class="fu">display</span>(value) <span class="op">:</span> format <span class="op">?</span> <span class="fu">format</span>(value) <span class="op">:</span> value<span class="op">;</span></span>
<span id="cb3-1385"><a href="#cb3-1385" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> (out <span class="kw">instanceof</span> <span class="bu">window</span><span class="op">.</span><span class="at">Element</span>) {</span>
<span id="cb3-1386"><a href="#cb3-1386" aria-hidden="true" tabindex="-1"></a>          <span class="cf">while</span> (form<span class="op">.</span><span class="at">output</span><span class="op">.</span><span class="fu">hasChildNodes</span>()) {</span>
<span id="cb3-1387"><a href="#cb3-1387" aria-hidden="true" tabindex="-1"></a>            form<span class="op">.</span><span class="at">output</span><span class="op">.</span><span class="fu">removeChild</span>(form<span class="op">.</span><span class="at">output</span><span class="op">.</span><span class="at">lastChild</span>)<span class="op">;</span></span>
<span id="cb3-1388"><a href="#cb3-1388" aria-hidden="true" tabindex="-1"></a>          }</span>
<span id="cb3-1389"><a href="#cb3-1389" aria-hidden="true" tabindex="-1"></a>          form<span class="op">.</span><span class="at">output</span><span class="op">.</span><span class="fu">append</span>(out)<span class="op">;</span></span>
<span id="cb3-1390"><a href="#cb3-1390" aria-hidden="true" tabindex="-1"></a>        } <span class="cf">else</span> {</span>
<span id="cb3-1391"><a href="#cb3-1391" aria-hidden="true" tabindex="-1"></a>          form<span class="op">.</span><span class="at">output</span><span class="op">.</span><span class="at">value</span> <span class="op">=</span> out<span class="op">;</span></span>
<span id="cb3-1392"><a href="#cb3-1392" aria-hidden="true" tabindex="-1"></a>        }</span>
<span id="cb3-1393"><a href="#cb3-1393" aria-hidden="true" tabindex="-1"></a>      }</span>
<span id="cb3-1394"><a href="#cb3-1394" aria-hidden="true" tabindex="-1"></a>      form<span class="op">.</span><span class="at">value</span> <span class="op">=</span> value<span class="op">;</span></span>
<span id="cb3-1395"><a href="#cb3-1395" aria-hidden="true" tabindex="-1"></a>      <span class="cf">if</span> (verb <span class="op">!==</span> <span class="st">"oninput"</span>)</span>
<span id="cb3-1396"><a href="#cb3-1396" aria-hidden="true" tabindex="-1"></a>        form<span class="op">.</span><span class="fu">dispatchEvent</span>(<span class="kw">new</span> <span class="bu">CustomEvent</span>(<span class="st">"input"</span><span class="op">,</span> { <span class="dt">bubbles</span><span class="op">:</span> <span class="kw">true</span> }))<span class="op">;</span></span>
<span id="cb3-1397"><a href="#cb3-1397" aria-hidden="true" tabindex="-1"></a>    }<span class="op">;</span></span>
<span id="cb3-1398"><a href="#cb3-1398" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> (verb <span class="op">!==</span> <span class="st">"oninput"</span>)</span>
<span id="cb3-1399"><a href="#cb3-1399" aria-hidden="true" tabindex="-1"></a>      wrapper<span class="op">.</span><span class="at">oninput</span> <span class="op">=</span> e <span class="kw">=&gt;</span> e <span class="op">&amp;&amp;</span> e<span class="op">.</span><span class="fu">stopPropagation</span>() <span class="op">&amp;&amp;</span> e<span class="op">.</span><span class="fu">preventDefault</span>()<span class="op">;</span></span>
<span id="cb3-1400"><a href="#cb3-1400" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> (verb <span class="op">!==</span> <span class="st">"onsubmit"</span>) form<span class="op">.</span><span class="at">onsubmit</span> <span class="op">=</span> e <span class="kw">=&gt;</span> e <span class="op">&amp;&amp;</span> e<span class="op">.</span><span class="fu">preventDefault</span>()<span class="op">;</span></span>
<span id="cb3-1401"><a href="#cb3-1401" aria-hidden="true" tabindex="-1"></a>    form[verb]()<span class="op">;</span></span>
<span id="cb3-1402"><a href="#cb3-1402" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb3-1403"><a href="#cb3-1403" aria-hidden="true" tabindex="-1"></a>  <span class="cf">while</span> (form<span class="op">.</span><span class="at">childNodes</span><span class="op">.</span><span class="at">length</span>) {</span>
<span id="cb3-1404"><a href="#cb3-1404" aria-hidden="true" tabindex="-1"></a>    wrapper<span class="op">.</span><span class="fu">appendChild</span>(form<span class="op">.</span><span class="at">childNodes</span>[<span class="dv">0</span>])<span class="op">;</span></span>
<span id="cb3-1405"><a href="#cb3-1405" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb3-1406"><a href="#cb3-1406" aria-hidden="true" tabindex="-1"></a>  form<span class="op">.</span><span class="fu">append</span>(wrapper)<span class="op">;</span></span>
<span id="cb3-1407"><a href="#cb3-1407" aria-hidden="true" tabindex="-1"></a>  <span class="cf">return</span> form<span class="op">;</span></span>
<span id="cb3-1408"><a href="#cb3-1408" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb3-1409"><a href="#cb3-1409" aria-hidden="true" tabindex="-1"></a>d3format <span class="op">=</span> <span class="pp">require</span>(<span class="st">"d3-format@1"</span>)</span>
<span id="cb3-1410"><a href="#cb3-1410" aria-hidden="true" tabindex="-1"></a><span class="co">// https://observablehq.com/@enjalot/draggable-world-map-coordinates-input</span></span>
<span id="cb3-1411"><a href="#cb3-1411" aria-hidden="true" tabindex="-1"></a><span class="kw">function</span> <span class="fu">worldMapCoordinates</span>(config <span class="op">=</span> {}<span class="op">,</span> dimensions) {</span>
<span id="cb3-1412"><a href="#cb3-1412" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> {</span>
<span id="cb3-1413"><a href="#cb3-1413" aria-hidden="true" tabindex="-1"></a>    value <span class="op">=</span> []<span class="op">,</span> title<span class="op">,</span> description<span class="op">,</span> width <span class="op">=</span> dimensions[<span class="dv">0</span>]</span>
<span id="cb3-1414"><a href="#cb3-1414" aria-hidden="true" tabindex="-1"></a>  } <span class="op">=</span> <span class="bu">Array</span><span class="op">.</span><span class="fu">isArray</span>(config) <span class="op">?</span> {<span class="dt">value</span><span class="op">:</span> config} <span class="op">:</span> config<span class="op">;</span></span>
<span id="cb3-1415"><a href="#cb3-1415" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> height <span class="op">=</span> dimensions[<span class="dv">1</span>]<span class="op">;</span></span>
<span id="cb3-1416"><a href="#cb3-1416" aria-hidden="true" tabindex="-1"></a>  <span class="kw">let</span> [lon<span class="op">,</span> lat] <span class="op">=</span> value<span class="op">;</span></span>
<span id="cb3-1417"><a href="#cb3-1417" aria-hidden="true" tabindex="-1"></a>  lon <span class="op">=</span> lon <span class="op">!=</span> <span class="kw">null</span> <span class="op">?</span> lon <span class="op">:</span> <span class="kw">null</span><span class="op">;</span></span>
<span id="cb3-1418"><a href="#cb3-1418" aria-hidden="true" tabindex="-1"></a>  lat <span class="op">=</span> lat <span class="op">!=</span> <span class="kw">null</span> <span class="op">?</span> lat <span class="op">:</span> <span class="kw">null</span><span class="op">;</span></span>
<span id="cb3-1419"><a href="#cb3-1419" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> formEl <span class="op">=</span> <span class="fu">html</span><span class="vs">`&lt;form style="width: </span><span class="sc">${</span>width<span class="sc">}</span><span class="vs">px;"&gt;&lt;/form&gt;`</span><span class="op">;</span></span>
<span id="cb3-1420"><a href="#cb3-1420" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> context <span class="op">=</span> DOM<span class="op">.</span><span class="fu">context2d</span>(width<span class="op">,</span> height<span class="op">-</span>width<span class="op">/</span><span class="fl">13.2</span>)<span class="op">;</span></span>
<span id="cb3-1421"><a href="#cb3-1421" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> canvas <span class="op">=</span> context<span class="op">.</span><span class="at">canvas</span><span class="op">;</span></span>
<span id="cb3-1422"><a href="#cb3-1422" aria-hidden="true" tabindex="-1"></a>  canvas<span class="op">.</span><span class="at">style</span><span class="op">.</span><span class="at">margin</span> <span class="op">=</span> <span class="vs">`-10px 0px -26px 0px`</span><span class="op">;</span></span>
<span id="cb3-1423"><a href="#cb3-1423" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> projection <span class="op">=</span> d3</span>
<span id="cb3-1424"><a href="#cb3-1424" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">geoEquirectangular</span>()</span>
<span id="cb3-1425"><a href="#cb3-1425" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">precision</span>(<span class="fl">0.1</span>)</span>
<span id="cb3-1426"><a href="#cb3-1426" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">fitSize</span>([width<span class="op">,</span> height]<span class="op">,</span> { <span class="dt">type</span><span class="op">:</span> <span class="st">"Sphere"</span> })<span class="op">.</span><span class="fu">rotate</span>([<span class="op">-</span><span class="dv">153</span><span class="op">,</span> <span class="dv">0</span>])<span class="op">;</span></span>
<span id="cb3-1427"><a href="#cb3-1427" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> path <span class="op">=</span> d3<span class="op">.</span><span class="fu">geoPath</span>(projection<span class="op">,</span> context)<span class="op">.</span><span class="fu">pointRadius</span>(<span class="fl">2.5</span>)<span class="op">;</span></span>
<span id="cb3-1428"><a href="#cb3-1428" aria-hidden="true" tabindex="-1"></a>  formEl<span class="op">.</span><span class="fu">append</span>(canvas)<span class="op">;</span></span>
<span id="cb3-1429"><a href="#cb3-1429" aria-hidden="true" tabindex="-1"></a>  <span class="kw">function</span> <span class="fu">draw</span>() {</span>
<span id="cb3-1430"><a href="#cb3-1430" aria-hidden="true" tabindex="-1"></a>    context<span class="op">.</span><span class="at">fillStyle</span> <span class="op">=</span> <span class="st">"#fff"</span><span class="op">;</span></span>
<span id="cb3-1431"><a href="#cb3-1431" aria-hidden="true" tabindex="-1"></a>    context<span class="op">.</span><span class="fu">fillRect</span>(<span class="dv">0</span><span class="op">,</span> <span class="dv">0</span><span class="op">,</span> width<span class="op">,</span> height)<span class="op">;</span></span>
<span id="cb3-1432"><a href="#cb3-1432" aria-hidden="true" tabindex="-1"></a>    context<span class="op">.</span><span class="fu">beginPath</span>()<span class="op">;</span> <span class="fu">path</span>({<span class="dt">type</span><span class="op">:</span> <span class="st">"Sphere"</span>})<span class="op">;</span></span>
<span id="cb3-1433"><a href="#cb3-1433" aria-hidden="true" tabindex="-1"></a>    context<span class="op">.</span><span class="at">fillStyle</span> <span class="op">=</span> colors<span class="op">.</span><span class="at">ocean</span><span class="op">;</span> context<span class="op">.</span><span class="fu">fill</span>()<span class="op">;</span></span>
<span id="cb3-1434"><a href="#cb3-1434" aria-hidden="true" tabindex="-1"></a>    context<span class="op">.</span><span class="fu">beginPath</span>()<span class="op">;</span></span>
<span id="cb3-1435"><a href="#cb3-1435" aria-hidden="true" tabindex="-1"></a>    <span class="fu">path</span>(graticule)<span class="op">;</span></span>
<span id="cb3-1436"><a href="#cb3-1436" aria-hidden="true" tabindex="-1"></a>    context<span class="op">.</span><span class="at">lineWidth</span> <span class="op">=</span> <span class="fl">0.95</span><span class="op">;</span></span>
<span id="cb3-1437"><a href="#cb3-1437" aria-hidden="true" tabindex="-1"></a>    context<span class="op">.</span><span class="at">strokeStyle</span> <span class="op">=</span> <span class="vs">`#aaa`</span><span class="op">;</span></span>
<span id="cb3-1438"><a href="#cb3-1438" aria-hidden="true" tabindex="-1"></a>    context<span class="op">.</span><span class="fu">stroke</span>()<span class="op">;</span></span>
<span id="cb3-1439"><a href="#cb3-1439" aria-hidden="true" tabindex="-1"></a>    context<span class="op">.</span><span class="fu">beginPath</span>()<span class="op">;</span></span>
<span id="cb3-1440"><a href="#cb3-1440" aria-hidden="true" tabindex="-1"></a>    <span class="fu">path</span>(land)<span class="op">;</span></span>
<span id="cb3-1441"><a href="#cb3-1441" aria-hidden="true" tabindex="-1"></a>    context<span class="op">.</span><span class="at">fillStyle</span> <span class="op">=</span> colors<span class="op">.</span><span class="at">land</span><span class="op">;</span></span>
<span id="cb3-1442"><a href="#cb3-1442" aria-hidden="true" tabindex="-1"></a>    context<span class="op">.</span><span class="fu">fill</span>()<span class="op">;</span></span>
<span id="cb3-1443"><a href="#cb3-1443" aria-hidden="true" tabindex="-1"></a>    context<span class="op">.</span><span class="fu">beginPath</span>()<span class="op">;</span></span>
<span id="cb3-1444"><a href="#cb3-1444" aria-hidden="true" tabindex="-1"></a>    <span class="fu">path</span>(countries)<span class="op">;</span></span>
<span id="cb3-1445"><a href="#cb3-1445" aria-hidden="true" tabindex="-1"></a>    context<span class="op">.</span><span class="at">lineWidth</span> <span class="op">=</span> <span class="op">.</span><span class="dv">95</span><span class="op">;</span></span>
<span id="cb3-1446"><a href="#cb3-1446" aria-hidden="true" tabindex="-1"></a>    context<span class="op">.</span><span class="at">strokeStyle</span> <span class="op">=</span> <span class="vs">`#000`</span><span class="op">;</span></span>
<span id="cb3-1447"><a href="#cb3-1447" aria-hidden="true" tabindex="-1"></a>    context<span class="op">.</span><span class="fu">stroke</span>()<span class="op">;</span></span>
<span id="cb3-1448"><a href="#cb3-1448" aria-hidden="true" tabindex="-1"></a>    context<span class="op">.</span><span class="at">fillStyle</span> <span class="op">=</span> <span class="vs">`#000`</span><span class="op">;</span></span>
<span id="cb3-1449"><a href="#cb3-1449" aria-hidden="true" tabindex="-1"></a>    context<span class="op">.</span><span class="at">font</span> <span class="op">=</span> width <span class="op">&lt;</span> <span class="dv">760</span> <span class="op">?</span> <span class="st">"14px serif"</span> <span class="op">:</span> width <span class="op">&lt;</span> <span class="dv">990</span> <span class="op">?</span> <span class="st">"17px serif"</span> <span class="op">:</span> <span class="st">"23px serif"</span><span class="op">;</span></span>
<span id="cb3-1450"><a href="#cb3-1450" aria-hidden="true" tabindex="-1"></a>    d3<span class="op">.</span><span class="fu">range</span>(<span class="op">-</span><span class="fl">1.5</span><span class="op">,</span> <span class="dv">342</span> <span class="op">+</span> <span class="dv">1</span><span class="op">,</span> <span class="dv">36</span>)<span class="op">.</span><span class="fu">map</span>(x <span class="kw">=&gt;</span>  context<span class="op">.</span><span class="fu">fillText</span>(<span class="fu">long2zone</span>(x)<span class="op">,</span> <span class="op">...</span><span class="fu">projection</span>([x<span class="op">,</span> <span class="dv">84</span> <span class="op">-</span> (width <span class="op">&lt;</span> <span class="dv">500</span>) <span class="op">*</span> <span class="fl">8.8</span>])))<span class="op">;</span></span>
<span id="cb3-1451"><a href="#cb3-1451" aria-hidden="true" tabindex="-1"></a>    d3<span class="op">.</span><span class="fu">range</span>(<span class="op">-</span><span class="fl">1.5</span><span class="op">,</span> <span class="dv">342</span> <span class="op">+</span> <span class="dv">1</span><span class="op">,</span> <span class="dv">36</span>)<span class="op">.</span><span class="fu">map</span>(x <span class="kw">=&gt;</span>  context<span class="op">.</span><span class="fu">fillText</span>(<span class="fu">long2zone</span>(x)<span class="op">,</span> <span class="op">...</span><span class="fu">projection</span>([x<span class="op">,</span> <span class="op">-</span><span class="dv">66</span> <span class="op">+</span> (width <span class="op">&lt;</span> <span class="dv">500</span>) <span class="op">*</span> <span class="fl">1.1</span>])))<span class="op">;</span></span>
<span id="cb3-1452"><a href="#cb3-1452" aria-hidden="true" tabindex="-1"></a>    context<span class="op">.</span><span class="fu">beginPath</span>()<span class="op">,</span> <span class="fu">path</span>(night)<span class="op">,</span> context<span class="op">.</span><span class="at">fillStyle</span> <span class="op">=</span> <span class="st">"rgba(0,0,255,0.1)"</span><span class="op">,</span> context<span class="op">.</span><span class="fu">fill</span>()<span class="op">;</span></span>
<span id="cb3-1453"><a href="#cb3-1453" aria-hidden="true" tabindex="-1"></a>    context<span class="op">.</span><span class="fu">beginPath</span>()<span class="op">;</span> path<span class="op">.</span><span class="fu">pointRadius</span>(<span class="dv">17</span>)<span class="op">;</span> <span class="fu">path</span>({<span class="dt">type</span><span class="op">:</span> <span class="st">"Point"</span><span class="op">,</span> <span class="dt">coordinates</span><span class="op">:</span> sun})<span class="op">;</span> context<span class="op">.</span><span class="at">strokeStyle</span> <span class="op">=</span> <span class="st">"#0008"</span><span class="op">;</span> context<span class="op">.</span><span class="at">fillStyle</span> <span class="op">=</span> <span class="st">"#ff08"</span><span class="op">;</span> context<span class="op">.</span><span class="at">lineWidth</span> <span class="op">=</span> <span class="dv">1</span><span class="op">;</span> context<span class="op">.</span><span class="fu">stroke</span>()<span class="op">;</span> context<span class="op">.</span><span class="fu">fill</span>()<span class="op">;</span></span>
<span id="cb3-1454"><a href="#cb3-1454" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> (lon <span class="op">!=</span> <span class="kw">null</span> <span class="op">&amp;&amp;</span> lat <span class="op">!=</span> <span class="kw">null</span>) {</span>
<span id="cb3-1455"><a href="#cb3-1455" aria-hidden="true" tabindex="-1"></a>      path<span class="op">.</span><span class="fu">pointRadius</span>(<span class="dv">17</span>)<span class="op">;</span> context<span class="op">.</span><span class="at">strokeStyle</span> <span class="op">=</span> <span class="st">"black"</span><span class="op">;</span></span>
<span id="cb3-1456"><a href="#cb3-1456" aria-hidden="true" tabindex="-1"></a>      context<span class="op">.</span><span class="fu">beginPath</span>()<span class="op">;</span> <span class="fu">path</span>({<span class="dt">type</span><span class="op">:</span> <span class="st">"Point"</span><span class="op">,</span> <span class="dt">coordinates</span><span class="op">:</span> [lon<span class="op">,</span> lat]})<span class="op">;</span> context<span class="op">.</span><span class="at">lineWidth</span> <span class="op">=</span> <span class="dv">1</span><span class="op">;</span> context<span class="op">.</span><span class="fu">stroke</span>()<span class="op">;</span></span>
<span id="cb3-1457"><a href="#cb3-1457" aria-hidden="true" tabindex="-1"></a>      context<span class="op">.</span><span class="at">lineWidth</span> <span class="op">=</span> <span class="dv">6</span><span class="op">;</span></span>
<span id="cb3-1458"><a href="#cb3-1458" aria-hidden="true" tabindex="-1"></a>      path<span class="op">.</span><span class="fu">pointRadius</span>(<span class="dv">14</span>)<span class="op">;</span> context<span class="op">.</span><span class="at">strokeStyle</span> <span class="op">=</span> <span class="st">"red"</span><span class="op">;</span></span>
<span id="cb3-1459"><a href="#cb3-1459" aria-hidden="true" tabindex="-1"></a>      context<span class="op">.</span><span class="fu">beginPath</span>()<span class="op">;</span> <span class="fu">path</span>({<span class="dt">type</span><span class="op">:</span> <span class="st">"Point"</span><span class="op">,</span> <span class="dt">coordinates</span><span class="op">:</span> [lon<span class="op">,</span> lat]})<span class="op">;</span> context<span class="op">.</span><span class="fu">stroke</span>()<span class="op">;</span></span>
<span id="cb3-1460"><a href="#cb3-1460" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb3-1461"><a href="#cb3-1461" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb3-1462"><a href="#cb3-1462" aria-hidden="true" tabindex="-1"></a>  <span class="kw">let</span> drag <span class="op">=</span> d3<span class="op">.</span><span class="fu">drag</span>()</span>
<span id="cb3-1463"><a href="#cb3-1463" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">on</span>(<span class="st">"drag"</span><span class="op">,</span> (<span class="bu">event</span>) <span class="kw">=&gt;</span> {</span>
<span id="cb3-1464"><a href="#cb3-1464" aria-hidden="true" tabindex="-1"></a>      <span class="kw">let</span> coords <span class="op">=</span> projection<span class="op">.</span><span class="fu">invert</span>([<span class="bu">event</span><span class="op">.</span><span class="at">x</span><span class="op">,</span> <span class="bu">event</span><span class="op">.</span><span class="at">y</span>])<span class="op">;</span></span>
<span id="cb3-1465"><a href="#cb3-1465" aria-hidden="true" tabindex="-1"></a>      lon <span class="op">=</span> <span class="op">+</span>coords[<span class="dv">0</span>]<span class="op">.</span><span class="fu">toFixed</span>(<span class="dv">2</span>)<span class="op">;</span></span>
<span id="cb3-1466"><a href="#cb3-1466" aria-hidden="true" tabindex="-1"></a>      lat <span class="op">=</span> <span class="op">+</span>coords[<span class="dv">1</span>]<span class="op">.</span><span class="fu">toFixed</span>(<span class="dv">2</span>)<span class="op">;</span></span>
<span id="cb3-1467"><a href="#cb3-1467" aria-hidden="true" tabindex="-1"></a>      <span class="fu">draw</span>()<span class="op">;</span></span>
<span id="cb3-1468"><a href="#cb3-1468" aria-hidden="true" tabindex="-1"></a>      canvas<span class="op">.</span><span class="fu">dispatchEvent</span>(<span class="kw">new</span> <span class="bu">CustomEvent</span>(<span class="st">"input"</span><span class="op">,</span> { <span class="dt">bubbles</span><span class="op">:</span> <span class="kw">true</span> }))<span class="op">;</span></span>
<span id="cb3-1469"><a href="#cb3-1469" aria-hidden="true" tabindex="-1"></a>    })</span>
<span id="cb3-1470"><a href="#cb3-1470" aria-hidden="true" tabindex="-1"></a>  d3<span class="op">.</span><span class="fu">select</span>(canvas)<span class="op">.</span><span class="fu">call</span>(drag)</span>
<span id="cb3-1471"><a href="#cb3-1471" aria-hidden="true" tabindex="-1"></a>  canvas<span class="op">.</span><span class="at">onclick</span> <span class="op">=</span> <span class="kw">function</span>(ev) {</span>
<span id="cb3-1472"><a href="#cb3-1472" aria-hidden="true" tabindex="-1"></a>    <span class="kw">const</span> { offsetX<span class="op">,</span> offsetY } <span class="op">=</span> ev<span class="op">;</span></span>
<span id="cb3-1473"><a href="#cb3-1473" aria-hidden="true" tabindex="-1"></a>    <span class="kw">let</span> coords <span class="op">=</span> projection<span class="op">.</span><span class="fu">invert</span>([offsetX<span class="op">,</span> offsetY])<span class="op">;</span></span>
<span id="cb3-1474"><a href="#cb3-1474" aria-hidden="true" tabindex="-1"></a>    lon <span class="op">=</span> <span class="op">+</span>coords[<span class="dv">0</span>]<span class="op">.</span><span class="fu">toFixed</span>(<span class="dv">2</span>)<span class="op">;</span></span>
<span id="cb3-1475"><a href="#cb3-1475" aria-hidden="true" tabindex="-1"></a>    lat <span class="op">=</span> <span class="op">+</span>coords[<span class="dv">1</span>]<span class="op">.</span><span class="fu">toFixed</span>(<span class="dv">2</span>)<span class="op">;</span></span>
<span id="cb3-1476"><a href="#cb3-1476" aria-hidden="true" tabindex="-1"></a>    <span class="fu">draw</span>()<span class="op">;</span></span>
<span id="cb3-1477"><a href="#cb3-1477" aria-hidden="true" tabindex="-1"></a>    canvas<span class="op">.</span><span class="fu">dispatchEvent</span>(<span class="kw">new</span> <span class="bu">CustomEvent</span>(<span class="st">"input"</span><span class="op">,</span> { <span class="dt">bubbles</span><span class="op">:</span> <span class="kw">true</span> }))<span class="op">;</span></span>
<span id="cb3-1478"><a href="#cb3-1478" aria-hidden="true" tabindex="-1"></a>  }<span class="op">;</span></span>
<span id="cb3-1479"><a href="#cb3-1479" aria-hidden="true" tabindex="-1"></a>  <span class="fu">draw</span>()<span class="op">;</span></span>
<span id="cb3-1480"><a href="#cb3-1480" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> form <span class="op">=</span> <span class="fu">input</span>({</span>
<span id="cb3-1481"><a href="#cb3-1481" aria-hidden="true" tabindex="-1"></a>    <span class="dt">type</span><span class="op">:</span> <span class="st">"worldMapCoordinates"</span><span class="op">,</span></span>
<span id="cb3-1482"><a href="#cb3-1482" aria-hidden="true" tabindex="-1"></a>    title<span class="op">,</span></span>
<span id="cb3-1483"><a href="#cb3-1483" aria-hidden="true" tabindex="-1"></a>    description<span class="op">,</span></span>
<span id="cb3-1484"><a href="#cb3-1484" aria-hidden="true" tabindex="-1"></a>    <span class="dt">display</span><span class="op">:</span> v <span class="kw">=&gt;</span> (width <span class="op">&gt;</span> <span class="dv">300</span>) <span class="op">?</span> <span class="fu">html</span><span class="vs">`&lt;div style="width: </span><span class="sc">${</span>width<span class="sc">}</span><span class="vs">px; white-space: nowrap; color: #444; text-align: center; font: </span><span class="sc">${</span>width <span class="op">/</span> <span class="dv">50</span><span class="sc">}</span><span class="vs">px monospace; position: relative; top: -</span><span class="sc">${</span>width <span class="op">/</span> <span class="dv">30</span><span class="sc">}</span><span class="vs">px;  margin-bottom: -.4em;"&gt;</span></span>
<span id="cb3-1485"><a href="#cb3-1485" aria-hidden="true" tabindex="-1"></a><span class="vs">            &lt;span style="color: #000;"&gt;Zone:&lt;/span&gt; </span><span class="sc">${</span>lon <span class="op">!=</span> <span class="kw">null</span> <span class="op">?</span> <span class="fu">long2zone</span>(lon) <span class="op">:</span> <span class="st">""</span><span class="sc">}</span></span>
<span id="cb3-1486"><a href="#cb3-1486" aria-hidden="true" tabindex="-1"></a><span class="vs">            &amp;nbsp; &amp;nbsp;</span></span>
<span id="cb3-1487"><a href="#cb3-1487" aria-hidden="true" tabindex="-1"></a><span class="vs">            &lt;span style="color: #000;"&gt;Longitude:&lt;/span&gt; </span><span class="sc">${</span>lon <span class="op">!=</span> <span class="kw">null</span> <span class="op">?</span> (<span class="fu">long2turn</span>(lon))<span class="op">.</span><span class="fu">toFixed</span>(<span class="dv">0</span>) <span class="op">:</span> <span class="st">""</span><span class="sc">}</span></span>
<span id="cb3-1488"><a href="#cb3-1488" aria-hidden="true" tabindex="-1"></a><span class="vs">            &amp;nbsp; &amp;nbsp;</span></span>
<span id="cb3-1489"><a href="#cb3-1489" aria-hidden="true" tabindex="-1"></a><span class="vs">            &lt;span style="color: #000;"&gt;Latitude:&lt;/span&gt; </span><span class="sc">${</span>lat <span class="op">!=</span> <span class="kw">null</span> <span class="op">?</span> ((<span class="fu">lati2turn1</span>(lat)))<span class="op">.</span><span class="fu">toFixed</span>(<span class="dv">0</span>) <span class="op">:</span> <span class="st">""</span><span class="sc">}</span></span>
<span id="cb3-1490"><a href="#cb3-1490" aria-hidden="true" tabindex="-1"></a><span class="vs">          &lt;/div&gt;`</span> <span class="op">:</span> <span class="st">''</span><span class="op">,</span></span>
<span id="cb3-1491"><a href="#cb3-1491" aria-hidden="true" tabindex="-1"></a>    <span class="dt">getValue</span><span class="op">:</span> () <span class="kw">=&gt;</span> [lon <span class="op">!=</span> <span class="kw">null</span> <span class="op">?</span> lon <span class="op">:</span> <span class="kw">null</span><span class="op">,</span> lat <span class="op">!=</span> <span class="kw">null</span> <span class="op">?</span> lat <span class="op">:</span> <span class="kw">null</span>]<span class="op">,</span></span>
<span id="cb3-1492"><a href="#cb3-1492" aria-hidden="true" tabindex="-1"></a>    <span class="dt">form</span><span class="op">:</span> formEl</span>
<span id="cb3-1493"><a href="#cb3-1493" aria-hidden="true" tabindex="-1"></a>  })<span class="op">;</span></span>
<span id="cb3-1494"><a href="#cb3-1494" aria-hidden="true" tabindex="-1"></a>  <span class="cf">return</span> form<span class="op">;</span></span>
<span id="cb3-1495"><a href="#cb3-1495" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb3-1496"><a href="#cb3-1496" aria-hidden="true" tabindex="-1"></a>sun <span class="op">=</span> {</span>
<span id="cb3-1497"><a href="#cb3-1497" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> now <span class="op">=</span> <span class="kw">new</span> <span class="bu">Date</span><span class="op">;</span></span>
<span id="cb3-1498"><a href="#cb3-1498" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> day <span class="op">=</span> <span class="kw">new</span> <span class="bu">Date</span>(<span class="op">+</span>now)<span class="op">.</span><span class="fu">setUTCHours</span>(<span class="dv">0</span><span class="op">,</span> <span class="dv">0</span><span class="op">,</span> <span class="dv">0</span><span class="op">,</span> <span class="dv">0</span>)<span class="op">;</span></span>
<span id="cb3-1499"><a href="#cb3-1499" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> t <span class="op">=</span> solar<span class="op">.</span><span class="fu">century</span>(now)<span class="op">;</span></span>
<span id="cb3-1500"><a href="#cb3-1500" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> longitude <span class="op">=</span> (day <span class="op">-</span> now) <span class="op">/</span> <span class="fl">864e5</span> <span class="op">*</span> <span class="dv">360</span> <span class="op">-</span> <span class="dv">180</span><span class="op">;</span></span>
<span id="cb3-1501"><a href="#cb3-1501" aria-hidden="true" tabindex="-1"></a>  <span class="cf">return</span> [longitude <span class="op">-</span> solar<span class="op">.</span><span class="fu">equationOfTime</span>(t) <span class="op">/</span> <span class="dv">4</span><span class="op">,</span> solar<span class="op">.</span><span class="fu">declination</span>(t)]<span class="op">;</span></span>
<span id="cb3-1502"><a href="#cb3-1502" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb3-1503"><a href="#cb3-1503" aria-hidden="true" tabindex="-1"></a>night <span class="op">=</span> d3<span class="op">.</span><span class="fu">geoCircle</span>()</span>
<span id="cb3-1504"><a href="#cb3-1504" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">radius</span>(<span class="dv">90</span>)</span>
<span id="cb3-1505"><a href="#cb3-1505" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">center</span>(<span class="fu">antipode</span>(sun))</span>
<span id="cb3-1506"><a href="#cb3-1506" aria-hidden="true" tabindex="-1"></a>  ()</span>
<span id="cb3-1507"><a href="#cb3-1507" aria-hidden="true" tabindex="-1"></a>antipode <span class="op">=</span> ([longitude<span class="op">,</span> latitude]) <span class="kw">=&gt;</span> [longitude <span class="op">+</span> <span class="dv">180</span><span class="op">,</span> <span class="op">-</span>latitude]</span>
<span id="cb3-1508"><a href="#cb3-1508" aria-hidden="true" tabindex="-1"></a>solar <span class="op">=</span> <span class="pp">require</span>(<span class="st">"solar-calculator@0.3/dist/solar-calculator.min.js"</span>)</span>
<span id="cb3-1509"><a href="#cb3-1509" aria-hidden="true" tabindex="-1"></a>viewof fancySecondsOFF <span class="op">=</span> Inputs<span class="op">.</span><span class="fu">toggle</span>({</span>
<span id="cb3-1510"><a href="#cb3-1510" aria-hidden="true" tabindex="-1"></a>  <span class="dt">label</span><span class="op">:</span> <span class="st">"Ticking clock"</span><span class="op">,</span></span>
<span id="cb3-1511"><a href="#cb3-1511" aria-hidden="true" tabindex="-1"></a>  <span class="dt">value</span><span class="op">:</span> <span class="kw">true</span><span class="op">,</span></span>
<span id="cb3-1512"><a href="#cb3-1512" aria-hidden="true" tabindex="-1"></a>})</span>
<span id="cb3-1513"><a href="#cb3-1513" aria-hidden="true" tabindex="-1"></a><span class="kw">function</span> <span class="fu">setStyle</span>(content<span class="op">,</span> style <span class="op">=</span> {}) {</span>
<span id="cb3-1514"><a href="#cb3-1514" aria-hidden="true" tabindex="-1"></a>  <span class="kw">function</span> <span class="fu">yiq</span>(color) {</span>
<span id="cb3-1515"><a href="#cb3-1515" aria-hidden="true" tabindex="-1"></a>    <span class="kw">const</span> {r<span class="op">,</span> g<span class="op">,</span> b} <span class="op">=</span> d3<span class="op">.</span><span class="fu">rgb</span>(color)<span class="op">;</span></span>
<span id="cb3-1516"><a href="#cb3-1516" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> (r <span class="op">*</span> <span class="dv">299</span> <span class="op">+</span> g <span class="op">*</span> <span class="dv">587</span> <span class="op">+</span> b <span class="op">*</span> <span class="dv">114</span>) <span class="op">/</span> <span class="dv">1000</span> <span class="op">/</span> <span class="dv">255</span><span class="op">;</span> <span class="co">// returns values between 0 and 1</span></span>
<span id="cb3-1517"><a href="#cb3-1517" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb3-1518"><a href="#cb3-1518" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> {</span>
<span id="cb3-1519"><a href="#cb3-1519" aria-hidden="true" tabindex="-1"></a>    background<span class="op">,</span></span>
<span id="cb3-1520"><a href="#cb3-1520" aria-hidden="true" tabindex="-1"></a>    color <span class="op">=</span> <span class="fu">yiq</span>(background) <span class="op">&gt;=</span> <span class="fl">0.6</span> <span class="op">?</span> <span class="st">"#111"</span> <span class="op">:</span> <span class="st">"white"</span><span class="op">,</span></span>
<span id="cb3-1521"><a href="#cb3-1521" aria-hidden="true" tabindex="-1"></a>    padding <span class="op">=</span> <span class="st">"0 1px"</span><span class="op">,</span></span>
<span id="cb3-1522"><a href="#cb3-1522" aria-hidden="true" tabindex="-1"></a>    borderRadius <span class="op">=</span> <span class="st">"4px"</span><span class="op">,</span></span>
<span id="cb3-1523"><a href="#cb3-1523" aria-hidden="true" tabindex="-1"></a>    fontWeight <span class="op">=</span> <span class="dv">900</span><span class="op">,</span></span>
<span id="cb3-1524"><a href="#cb3-1524" aria-hidden="true" tabindex="-1"></a>    fontSize <span class="op">=</span> <span class="st">"1em"</span><span class="op">,</span></span>
<span id="cb3-1525"><a href="#cb3-1525" aria-hidden="true" tabindex="-1"></a>    <span class="op">...</span>rest</span>
<span id="cb3-1526"><a href="#cb3-1526" aria-hidden="true" tabindex="-1"></a>  } <span class="op">=</span> <span class="kw">typeof</span> style <span class="op">===</span> <span class="st">"string"</span> <span class="op">?</span> {<span class="dt">background</span><span class="op">:</span> style} <span class="op">:</span> style<span class="op">;</span></span>
<span id="cb3-1527"><a href="#cb3-1527" aria-hidden="true" tabindex="-1"></a>  <span class="cf">return</span> htl<span class="op">.</span><span class="fu">html</span><span class="vs">`&lt;span style=</span><span class="sc">${</span>{</span>
<span id="cb3-1528"><a href="#cb3-1528" aria-hidden="true" tabindex="-1"></a>    background<span class="op">,</span></span>
<span id="cb3-1529"><a href="#cb3-1529" aria-hidden="true" tabindex="-1"></a>    color<span class="op">,</span></span>
<span id="cb3-1530"><a href="#cb3-1530" aria-hidden="true" tabindex="-1"></a>    padding<span class="op">,</span></span>
<span id="cb3-1531"><a href="#cb3-1531" aria-hidden="true" tabindex="-1"></a>    borderRadius<span class="op">,</span></span>
<span id="cb3-1532"><a href="#cb3-1532" aria-hidden="true" tabindex="-1"></a>    fontWeight<span class="op">,</span></span>
<span id="cb3-1533"><a href="#cb3-1533" aria-hidden="true" tabindex="-1"></a>    <span class="op">...</span>rest</span>
<span id="cb3-1534"><a href="#cb3-1534" aria-hidden="true" tabindex="-1"></a>  }<span class="sc">}</span><span class="vs">&gt;</span><span class="sc">${</span>content<span class="sc">}</span><span class="vs">&lt;/span&gt;`</span><span class="op">;</span></span>
<span id="cb3-1535"><a href="#cb3-1535" aria-hidden="true" tabindex="-1"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display hidden">
<div>
<div id="ojs-cell-2-32" data-nodetype="declaration">

</div>
</div>
</div>
<div class="cell-output cell-output-display hidden">
<div>
<div id="ojs-cell-2-33" data-nodetype="declaration">

</div>
</div>
</div>
<div class="cell-output cell-output-display hidden">
<div>
<div id="ojs-cell-2-34" data-nodetype="declaration">

</div>
</div>
</div>
<div class="cell-output cell-output-display hidden">
<div>
<div id="ojs-cell-2-35" data-nodetype="declaration">

</div>
</div>
</div>
<div class="cell-output cell-output-display hidden">
<div>
<div id="ojs-cell-2-36" data-nodetype="declaration">

</div>
</div>
</div>
<div class="cell-output cell-output-display hidden">
<div>
<div id="ojs-cell-2-37" data-nodetype="declaration">

</div>
</div>
</div>
<div class="cell-output cell-output-display hidden">
<div>
<div id="ojs-cell-2-38" data-nodetype="declaration">

</div>
</div>
</div>
<div class="cell-output cell-output-display hidden">
<div>
<div id="ojs-cell-2-39" data-nodetype="declaration">

</div>
</div>
</div>
<div class="cell-output cell-output-display hidden">
<div>
<div id="ojs-cell-2-40" data-nodetype="declaration">

</div>
</div>
</div>
<div class="cell-output cell-output-display hidden">
<div>
<div id="ojs-cell-2-41" data-nodetype="declaration">

</div>
</div>
</div>
<div class="cell-output cell-output-display hidden">
<div>
<div id="ojs-cell-2-42" data-nodetype="declaration">

</div>
</div>
</div>
<div class="cell-output cell-output-display hidden">
<div>
<div id="ojs-cell-2-43" data-nodetype="declaration">

</div>
</div>
</div>
<div class="cell-output cell-output-display hidden">
<div>
<div id="ojs-cell-2-44" data-nodetype="declaration">

</div>
</div>
</div>
<div class="cell-output cell-output-display hidden">
<div>
<div id="ojs-cell-2-45" data-nodetype="declaration">

</div>
</div>
</div>
<div class="cell-output cell-output-display hidden">
<div>
<div id="ojs-cell-2-46" data-nodetype="declaration">

</div>
</div>
</div>
<div class="cell-output cell-output-display hidden">
<div>
<div id="ojs-cell-2-47" data-nodetype="declaration">

</div>
</div>
</div>
<div class="cell-output cell-output-display hidden">
<div>
<div id="ojs-cell-2-48" data-nodetype="declaration">

</div>
</div>
</div>
<div class="cell-output cell-output-display hidden">
<div>
<div id="ojs-cell-2-49" data-nodetype="declaration">

</div>
</div>
</div>
<div class="cell-output cell-output-display hidden">
<div>
<div id="ojs-cell-2-50" data-nodetype="declaration">

</div>
</div>
</div>
<div class="cell-output cell-output-display hidden">
<div>
<div id="ojs-cell-2-51" data-nodetype="declaration">

</div>
</div>
</div>
<div class="cell-output cell-output-display hidden">
<div>
<div id="ojs-cell-2-52" data-nodetype="declaration">

</div>
</div>
</div>
<div class="cell-output cell-output-display hidden">
<div>
<div id="ojs-cell-2-53" data-nodetype="declaration">

</div>
</div>
</div>
<div class="cell-output cell-output-display hidden">
<div>
<div id="ojs-cell-2-54" data-nodetype="declaration">

</div>
</div>
</div>
<div class="cell-output cell-output-display hidden">
<div>
<div id="ojs-cell-2-55" data-nodetype="declaration">

</div>
</div>
</div>
<div class="cell-output cell-output-display hidden">
<div>
<div id="ojs-cell-2-56" data-nodetype="declaration">

</div>
</div>
</div>
<div class="cell-output cell-output-display hidden">
<div>
<div id="ojs-cell-2-57" data-nodetype="declaration">

</div>
</div>
</div>
<div class="cell-output cell-output-display hidden">
<div>
<div id="ojs-cell-2-58" data-nodetype="declaration">

</div>
</div>
</div>
<div class="cell-output cell-output-display hidden">
<div>
<div id="ojs-cell-2-59" data-nodetype="declaration">

</div>
</div>
</div>
<div class="cell-output cell-output-display hidden">
<div>
<div id="ojs-cell-2-60" data-nodetype="declaration">

</div>
</div>
</div>
<div class="cell-output cell-output-display hidden">
<div>
<div id="ojs-cell-2-61" data-nodetype="declaration">

</div>
</div>
</div>
<div class="cell-output cell-output-display hidden">
<div>
<div id="ojs-cell-2-62" data-nodetype="declaration">

</div>
</div>
</div>
<div class="cell-output cell-output-display hidden">
<div>
<div id="ojs-cell-2-63" data-nodetype="declaration">

</div>
</div>
</div>
<div class="cell-output cell-output-display hidden">
<div>
<div id="ojs-cell-2-64" data-nodetype="declaration">

</div>
</div>
</div>
</div>
<style>
  #barClock {
    width: 100%;
  }
  .tickLabel, .tickLabel1, .tickLabel2, .timeLabel {
    fill: #000;
    font-family: monospace;
    text-anchor: middle;
  }
  .timeLabel {
    text-anchor: start;
  }
  .timeBar, .timeBarFull, .timeBarFullN {
    x: 1px;
    height: 25px;
    rx: 5px;
    stroke: #aaa;
  }
  .timeBar {
    fill: #e8e8e8;
  }
  .timeBarFull {
    fill: #ccffff;
  }
  .timeBarFullN {
    fill: #ffcccc;
  }
  .background {
    fill: white;
  }
  .tickDek, .tickDotd, .tickDotd1, .tickC, .tickC1, .tickM, .tickM1, .tickB, .tickB1 {
    stroke: none;
    fill: #666;
    width: 1px;
  }
#clock {
  stroke: #000;
  font-family: "HelveticaNeue-Light", "Helvetica Neue Light", "Helvetica Neue", Helvetica, Arial, "Lucida Grande", sans-serif;
}
#clock #rim {
  fill: none;
  stroke: #999;
  stroke-width: 3px;
}
#clock .second-hand {
  stroke-width: 3;
}
#clock .minute-hand {
  stroke-width: 8;
  stroke-linecap: round;
}
#clock .hour-hand {
  stroke-width: 12;
  stroke-linecap: round;
}
#clock .hands-cover {
  stroke-width: 3;
  fill: #fff;
}
#clock .second-tick {
  stroke-width: 3;
  fill: #000;
}
#clock .hour-tick {
  stroke-width: 8; // same as the minute hand
}
#clock .second-label {
  font-size: 18px;
}
#clock .hour-label {
  font-size: 32px
}
.clocks * {
  margin: -10px 0px 10px 0px;
  padding: 0px;
}
</style>


<!-- -->

<div class="ojs-auto-generated hidden">
<script type="ojs-module-contents">
eyJjb250ZW50cyI6WyAgeyJtZXRob2ROYW1lIjoiaW50ZXJwcmV0IiwiaW5saW5lIjoidHJ1ZSIsInNvdXJjZSI6Imh0bC5odG1sYDxzcGFuPiR7ZGVjVGltZX08L3NwYW4+YCIsICJjZWxsTmFtZSI6Im9qcy1lbGVtZW50LWlkLTEifSwgIHsibWV0aG9kTmFtZSI6ImludGVycHJldCIsImlubGluZSI6InRydWUiLCJzb3VyY2UiOiJodGwuaHRtbGA8c3Bhbj4ke2RlY1RpbWVOfTwvc3Bhbj5gIiwgImNlbGxOYW1lIjoib2pzLWVsZW1lbnQtaWQtMiJ9LCAgeyJtZXRob2ROYW1lIjoiaW50ZXJwcmV0IiwiaW5saW5lIjoidHJ1ZSIsInNvdXJjZSI6Imh0bC5odG1sYDxzcGFuPiR7c2VsZWN0ZWRab25lfTwvc3Bhbj5gIiwgImNlbGxOYW1lIjoib2pzLWVsZW1lbnQtaWQtMyJ9LCAgeyJtZXRob2ROYW1lIjoiaW50ZXJwcmV0IiwiaW5saW5lIjoidHJ1ZSIsInNvdXJjZSI6Imh0bC5odG1sYDxzcGFuPiR7Y2xvY2t9JHtjbG9jazF9PC9zcGFuPmAiLCAiY2VsbE5hbWUiOiJvanMtZWxlbWVudC1pZC00In0sICB7Im1ldGhvZE5hbWUiOiJpbnRlcnByZXQiLCJpbmxpbmUiOiJ0cnVlIiwic291cmNlIjoiaHRsLmh0bWxgPHNwYW4+JHticm93c2VyVGltZS50b0ZpeGVkKDQpfTwvc3Bhbj5gIiwgImNlbGxOYW1lIjoib2pzLWVsZW1lbnQtaWQtNSJ9LCAgeyJtZXRob2ROYW1lIjoiaW50ZXJwcmV0IiwiaW5saW5lIjoidHJ1ZSIsInNvdXJjZSI6Imh0bC5odG1sYDxzcGFuPiR7YnJvd3NlclNpZ259PC9zcGFuPmAiLCAiY2VsbE5hbWUiOiJvanMtZWxlbWVudC1pZC02In0sICB7Im1ldGhvZE5hbWUiOiJpbnRlcnByZXQiLCJpbmxpbmUiOiJ0cnVlIiwic291cmNlIjoiaHRsLmh0bWxgPHNwYW4+JHtNYXRoLmFicyhicm93c2VyWm9uZSl9PC9zcGFuPmAiLCAiY2VsbE5hbWUiOiJvanMtZWxlbWVudC1pZC03In0sICB7Im1ldGhvZE5hbWUiOiJpbnRlcnByZXQiLCJpbmxpbmUiOiJ0cnVlIiwic291cmNlIjoiaHRsLmh0bWxgPHNwYW4+JHt6b25lMHRpbWUudG9GaXhlZCg0KX08L3NwYW4+YCIsICJjZWxsTmFtZSI6Im9qcy1lbGVtZW50LWlkLTgifSwgIHsibWV0aG9kTmFtZSI6ImludGVycHJldCIsImlubGluZSI6InRydWUiLCJzb3VyY2UiOiJodGwuaHRtbGA8c3Bhbj4ke2Jyb3dzZXJab25lfTwvc3Bhbj5gIiwgImNlbGxOYW1lIjoib2pzLWVsZW1lbnQtaWQtOSJ9LCAgeyJtZXRob2ROYW1lIjoiaW50ZXJwcmV0IiwiaW5saW5lIjoidHJ1ZSIsInNvdXJjZSI6Imh0bC5odG1sYDxzcGFuPiR7YnJvd3NlclRpbWUudG9GaXhlZCg0KX08L3NwYW4+YCIsICJjZWxsTmFtZSI6Im9qcy1lbGVtZW50LWlkLTEwIn0sICB7Im1ldGhvZE5hbWUiOiJpbnRlcnByZXQiLCJpbmxpbmUiOiJ0cnVlIiwic291cmNlIjoiaHRsLmh0bWxgPHNwYW4+JHticm93c2VyVGltZS50b0ZpeGVkKDQpfTwvc3Bhbj5gIiwgImNlbGxOYW1lIjoib2pzLWVsZW1lbnQtaWQtMTEifSwgIHsibWV0aG9kTmFtZSI6ImludGVycHJldCIsImlubGluZSI6InRydWUiLCJzb3VyY2UiOiJodGwuaHRtbGA8c3Bhbj4ke2RlY1llYXJ9PC9zcGFuPmAiLCAiY2VsbE5hbWUiOiJvanMtZWxlbWVudC1pZC0xMiJ9LCAgeyJtZXRob2ROYW1lIjoiaW50ZXJwcmV0IiwiaW5saW5lIjoidHJ1ZSIsInNvdXJjZSI6Imh0bC5odG1sYDxzcGFuPiR7ZGVjRGF0ZX08L3NwYW4+YCIsICJjZWxsTmFtZSI6Im9qcy1lbGVtZW50LWlkLTEzIn0sICB7Im1ldGhvZE5hbWUiOiJpbnRlcnByZXQiLCJpbmxpbmUiOiJ0cnVlIiwic291cmNlIjoiaHRsLmh0bWxgPHNwYW4+JHtkZWNZZWFyfTwvc3Bhbj5gIiwgImNlbGxOYW1lIjoib2pzLWVsZW1lbnQtaWQtMTQifSwgIHsibWV0aG9kTmFtZSI6ImludGVycHJldCIsImlubGluZSI6InRydWUiLCJzb3VyY2UiOiJodGwuaHRtbGA8c3Bhbj4ke2RlY0RhdGV9PC9zcGFuPmAiLCAiY2VsbE5hbWUiOiJvanMtZWxlbWVudC1pZC0xNSJ9LCAgeyJtZXRob2ROYW1lIjoiaW50ZXJwcmV0IiwiaW5saW5lIjoidHJ1ZSIsInNvdXJjZSI6Imh0bC5odG1sYDxzcGFuPiR7ZGVjWWVhcn08L3NwYW4+YCIsICJjZWxsTmFtZSI6Im9qcy1lbGVtZW50LWlkLTE2In0sICB7Im1ldGhvZE5hbWUiOiJpbnRlcnByZXQiLCJpbmxpbmUiOiJ0cnVlIiwic291cmNlIjoiaHRsLmh0bWxgPHNwYW4+JHtkZWNEYXRlfTwvc3Bhbj5gIiwgImNlbGxOYW1lIjoib2pzLWVsZW1lbnQtaWQtMTcifSwgIHsibWV0aG9kTmFtZSI6ImludGVycHJldCIsImlubGluZSI6InRydWUiLCJzb3VyY2UiOiJodGwuaHRtbGA8c3Bhbj4ke2RlY1llYXJ9PC9zcGFuPmAiLCAiY2VsbE5hbWUiOiJvanMtZWxlbWVudC1pZC0xOCJ9LCAgeyJtZXRob2ROYW1lIjoiaW50ZXJwcmV0IiwiaW5saW5lIjoidHJ1ZSIsInNvdXJjZSI6Imh0bC5odG1sYDxzcGFuPiR7ZGVjRGF0ZX08L3NwYW4+YCIsICJjZWxsTmFtZSI6Im9qcy1lbGVtZW50LWlkLTE5In0sICB7Im1ldGhvZE5hbWUiOiJpbnRlcnByZXQiLCJpbmxpbmUiOiJ0cnVlIiwic291cmNlIjoiaHRsLmh0bWxgPHNwYW4+JHtkZWNZZWFyfTwvc3Bhbj5gIiwgImNlbGxOYW1lIjoib2pzLWVsZW1lbnQtaWQtMjAifSwgIHsibWV0aG9kTmFtZSI6ImludGVycHJldCIsImlubGluZSI6InRydWUiLCJzb3VyY2UiOiJodGwuaHRtbGA8c3Bhbj4ke2RlY0RhdGV9PC9zcGFuPmAiLCAiY2VsbE5hbWUiOiJvanMtZWxlbWVudC1pZC0yMSJ9LCAgeyJtZXRob2ROYW1lIjoiaW50ZXJwcmV0IiwiaW5saW5lIjoidHJ1ZSIsInNvdXJjZSI6Imh0bC5odG1sYDxzcGFuPiR7TWF0aC5mbG9vcihob3VycykudG9TdHJpbmcoKS5wYWRTdGFydCgyLCBcIjBcIil9PC9zcGFuPmAiLCAiY2VsbE5hbWUiOiJvanMtZWxlbWVudC1pZC0yMiJ9LCAgeyJtZXRob2ROYW1lIjoiaW50ZXJwcmV0IiwiaW5saW5lIjoidHJ1ZSIsInNvdXJjZSI6Imh0bC5odG1sYDxzcGFuPiR7TWF0aC5mbG9vcihtaW51dGVzKS50b1N0cmluZygpLnBhZFN0YXJ0KDIsIFwiMFwiKX08L3NwYW4+YCIsICJjZWxsTmFtZSI6Im9qcy1lbGVtZW50LWlkLTIzIn0sICB7Im1ldGhvZE5hbWUiOiJpbnRlcnByZXQiLCJpbmxpbmUiOiJ0cnVlIiwic291cmNlIjoiaHRsLmh0bWxgPHNwYW4+JHtNYXRoLmZsb29yKHNlY29uZHMpLnRvU3RyaW5nKCkucGFkU3RhcnQoMiwgXCIwXCIpfTwvc3Bhbj5gIiwgImNlbGxOYW1lIjoib2pzLWVsZW1lbnQtaWQtMjQifSwgIHsibWV0aG9kTmFtZSI6ImludGVycHJldCIsImlubGluZSI6InRydWUiLCJzb3VyY2UiOiJodGwuaHRtbGA8c3Bhbj4keyh1bml4IC8gMTAwMCkudG9GaXhlZCgwKX08L3NwYW4+YCIsICJjZWxsTmFtZSI6Im9qcy1lbGVtZW50LWlkLTI1In1dfQ==
</script>
</div>
</section>

<a onclick="window.scrollTo(0, 0); return false;" role="button" id="quarto-back-to-top"><i class="bi bi-arrow-up"></i> Back to top</a><div id="quarto-appendix" class="default"><section class="quarto-appendix-contents" id="quarto-reuse"><h2 class="anchored quarto-appendix-heading">Reuse</h2><div class="quarto-appendix-contents"><div><a rel="license" href="https://creativecommons.org/licenses/by-sa/4.0/">CC BY-SA 4.0</a></div></div></section><section class="quarto-appendix-contents" id="quarto-citation"><h2 class="anchored quarto-appendix-heading">Citation</h2><div><div class="quarto-appendix-secondary-label">BibTeX citation:</div><pre class="sourceCode code-with-copy quarto-appendix-bibtex"><code class="sourceCode bibtex">@online{laptev2024,
  author = {Laptev, Martin},
  title = {Dec {Time}},
  date = {2024},
  urldate = {2024},
  url = {https://maptv.github.io/dec/time},
  langid = {en}
}
</code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre><div class="quarto-appendix-secondary-label">For attribution, please cite this work as:</div><div id="ref-laptev2024" class="csl-entry quarto-appendix-citeas" role="listitem">
Laptev, Martin. 2024. <span>‚ÄúDec Time.‚Äù</span> 2024. <a href="https://maptv.github.io/dec/time">https://maptv.github.io/dec/time</a>.
</div></div></section></div></main> <!-- /main -->
<script src="../../asset/cite.js"></script>
<style>
#title-block-header > div.quarto-title-banner.page-columns.page-full { margin: 0px; padding: 0px; }
#title-block-header { margin: 0px; }
main#quarto-document-content { margin: 0px; padding: 0px; }
ul.navbar-nav.navbar-nav-scroll { -webkit-flex-direction: row; }
#quarto-sidebar { padding: 0px; overflow-x: hidden !important; }
#quarto-sidebar > * { padding: 0px; }
div.quarto-title-meta { padding-bottom: 8px; }
g.node.clickable.flowchart-label:hover { rect.basic.label-container { stroke: green!important; stroke-width:5px!important; } }
h2, h3 { margin: 0px !important; }
h3 { margin-top: 17px !important; }
div.cell.page-columns.page-full { height: 0px !important; }
@media only screen and (max-width: 991px) { #quarto-search { display: none !important; } #quarto-sidebar { padding: 0px 9px 0px 9px !important; } }
@media only screen and (max-width: 767px) { div.cell.page-columns.page-full { display: none !important; } }
</style>
<script src="../../asset/stamp.js"></script>
<script>
const tooltipTriggerList = document.querySelectorAll('[data-bs-toggle="tooltip"]')
const tooltipList = [...tooltipTriggerList].map(tooltipTriggerEl => new bootstrap.Tooltip(tooltipTriggerEl))
</script>
<script type="ojs-module-contents">
eyJjb250ZW50cyI6W3sibWV0aG9kTmFtZSI6ImludGVycHJldCIsImNlbGxOYW1lIjoib2pzLWNlbGwtMSIsImlubGluZSI6ZmFsc2UsInNvdXJjZSI6Ii8vIGh0dHBzOi8vb2JzZXJ2YWJsZWhxLmNvbS9AZmhleWVuL2JhcmNoYXJ0LWNsb2NrXG5iYXJDaGFydCA9IHtcbmNvbnN0IFcgPSB3aWR0aDtcbiAgY29uc3QgSCA9IDg4O1xuICBjb25zdCBiYXJYID0gMTtcbiAgY29uc3QgZmlyc3RCYXJZID0gMTtcbiAgY29uc3Qgc3ZnID0gZDNcbiAgICAuY3JlYXRlKFwic3ZnXCIpXG4gICAgLmF0dHIoXCJ3aWR0aFwiLCBXKVxuICAgIC5hdHRyKFwidmlld0JveFwiLCBbMCwgMCwgVyAqIChXIDwgMzcwID8gLjczIDogVyA8IDQyMCA/IC43NiA6IFcgPCA0NzAgPyAuNzkgOiBXIDwgNTIwID8gLjgxIDogVyA8IDU3MCA/IC44MyA6IFcgPCA2MjAgPyAuODQgOiBXIDwgNjcwID8gLjg1IDogVyA8IDcyMCA/IC44NiA6IC44NyksIEhdKTtcbiAgY29uc3QgeFJhbmdlID0gWzAsIFcgLSAxMDBdO1xuICBjb25zdCBzY2FsZUREID0gZDMuc2NhbGVMaW5lYXIoKVxuICAgIC5kb21haW4oWzAsIDEwXSlcbiAgICAucmFuZ2UoeFJhbmdlKTtcbiAgY29uc3Qgc2NhbGVNYW5kQiA9IGQzLnNjYWxlTGluZWFyKClcbiAgICAuZG9tYWluKFswLCAxMDBdKVxuICAgIC5yYW5nZSh4UmFuZ2UpO1xuICAvLyBCYWNrZ3JvdW5kIGJhcnMgdG8gc2hvdyB3aGVyZSAxMDAlIGxpZXNcbiAgc3ZnLnNlbGVjdEFsbCgnLmJhY2tncm91bmQnKVxuICAgIC5kYXRhKFtcbiAgICAgICdkZCcsIFwibWlsc1wiLCAnYmVhdHMnXSlcbiAgICAuZW50ZXIoKVxuICAgIC5hcHBlbmQoJ3JlY3QnKVxuICAgIC5hdHRyKCdjbGFzcycsICdiYWNrZ3JvdW5kIHRpbWVCYXInKVxuICAgIC5hdHRyKCd3aWR0aCcsIFctMTAwKVxuICAgIC5hdHRyKCd5JywgKGQsaSk9PmkqMzArZmlyc3RCYXJZKVxuICAvLyBCZWF0c1xuICBzdmdcbiAgICAuYXBwZW5kKCdyZWN0JylcbiAgICAuYXR0cignY2xhc3MnLCAndGltZUJhcicpXG4gICAgLmF0dHIoJ3knLCBmaXJzdEJhclkrNjApXG4gICAgLmF0dHIoJ3dpZHRoJywgZCA9PiBzY2FsZU1hbmRCKE51bWJlcihiYXJCZWF0cykpKVxuICBzdmdcbiAgICAuYXBwZW5kKCdyZWN0JylcbiAgICAuYXR0cignY2xhc3MnLCAndGltZUJhckZ1bGwnKVxuICAgIC5hdHRyKCd5JywgZmlyc3RCYXJZKzYwKVxuICAgIC5hdHRyKCd3aWR0aCcsIGQgPT4gc2NhbGVNYW5kQihiYXJCZWF0cykpXG4gIC8vIENlbnRzL01pbHNcbiAgc3ZnXG4gICAgLmFwcGVuZCgncmVjdCcpXG4gICAgLmF0dHIoJ2NsYXNzJywgJ3RpbWVCYXInKVxuICAgIC5hdHRyKCd5JywgZmlyc3RCYXJZKVxuICAgIC5hdHRyKCd3aWR0aCcsIGQgPT4gc2NhbGVERChOdW1iZXIoYmFyREQpK051bWJlcihiYXJNaWxzKS8xMDArTnVtYmVyKGJhckJlYXRzKS8xMDAwMCkpXG4gIHN2Z1xuICAgIC5hcHBlbmQoJ3JlY3QnKVxuICAgIC5hdHRyKCdjbGFzcycsICd0aW1lQmFyRnVsbCcpXG4gICAgLmF0dHIoJ3knLCBmaXJzdEJhclkpXG4gICAgLmF0dHIoJ3dpZHRoJywgZCA9PiBzY2FsZUREKGJhckREKSlcbiAgc3ZnXG4gICAgLmFwcGVuZCgncmVjdCcpXG4gICAgLmF0dHIoJ2NsYXNzJywgJ3RpbWVCYXInKVxuICAgIC5hdHRyKCd5JywgZmlyc3RCYXJZKzMwKVxuICAgIC5hdHRyKCd3aWR0aCcsIGQgPT4gc2NhbGVNYW5kQihOdW1iZXIoYmFyTWlscykrTnVtYmVyKGJhckJlYXRzKS8xMDApKVxuICBzdmdcbiAgICAuYXBwZW5kKCdyZWN0JylcbiAgICAuYXR0cignY2xhc3MnLCAndGltZUJhckZ1bGwnKVxuICAgIC5hdHRyKCd5JywgZmlyc3RCYXJZKzMwKVxuICAgIC5hdHRyKCd3aWR0aCcsIGQgPT4gc2NhbGVNYW5kQihiYXJNaWxzKSlcbiAgLy8gQ2VudCB0aWNrc1xuICBzdmcuc2VsZWN0QWxsKCcudGlja0MnKVxuICAgIC5kYXRhKGQzLnJhbmdlKHdpZHRoID4gNTAwID8gMTAgOiAxMCwgMTAwKSlcbiAgICAuZW50ZXIoKVxuICAgIC5hcHBlbmQoJ3JlY3QnKVxuICAgIC5hdHRyKCdjbGFzcycsICd0aWNrQycpXG4gICAgLmF0dHIoJ3gnLCBkPT5zY2FsZUREKGQvMTApK2JhclgpXG4gICAgLmF0dHIoJ3knLCBmaXJzdEJhclkrMzApXG4gICAgLmF0dHIoJ2hlaWdodCcsIGQ9PmQlMj09PTA/IDg6NSlcbiAgc3ZnLnNlbGVjdEFsbCgnLnRpY2tCMScpXG4gICAgLmRhdGEoZDMucmFuZ2Uod2lkdGggPiA1MDAgPyAxMCA6IDEwLCAxMDApKVxuICAgIC5lbnRlcigpXG4gICAgLmFwcGVuZCgncmVjdCcpXG4gICAgLmF0dHIoJ2NsYXNzJywgJ3RpY2tCMScpXG4gICAgLmF0dHIoJ3gnLCBkPT5zY2FsZUREKGQvMTApK2JhclgpXG4gICAgLmF0dHIoJ3knLCBkPT5kJTI9PT0wPyBmaXJzdEJhclkrNzc6Zmlyc3RCYXJZKzgwKVxuICAgIC5hdHRyKCdoZWlnaHQnLCBkPT5kJTI9PT0wPyA4OjUpXG4gIHN2Zy5zZWxlY3RBbGwoJy50aWNrQzEnKVxuICAgIC5kYXRhKGQzLnJhbmdlKHdpZHRoID4gNTAwID8gMTAgOiAxMCwgMTAwKSlcbiAgICAuZW50ZXIoKVxuICAgIC5hcHBlbmQoJ3JlY3QnKVxuICAgIC5hdHRyKCdjbGFzcycsICd0aWNrQzEnKVxuICAgIC5hdHRyKCd4JywgZD0+c2NhbGVERChkLzEwKStiYXJYKVxuICAgIC5hdHRyKCd5JywgZD0+ZCUyPT09MD8gZmlyc3RCYXJZKzQ3OmZpcnN0QmFyWSs1MClcbiAgICAuYXR0cignaGVpZ2h0JywgZD0+ZCUyPT09MD8gODo1KVxuICAvLyBNaWwgdGlja3NcbiAgc3ZnLnNlbGVjdEFsbCgnLnRpY2tNJylcbiAgICAuZGF0YShkMy5yYW5nZSh3aWR0aCA+IDUwMCA/IDEgOiAxLCAxMCkpXG4gICAgLmVudGVyKClcbiAgICAuYXBwZW5kKCdyZWN0JylcbiAgICAuYXR0cignY2xhc3MnLCAndGlja00nKVxuICAgIC5hdHRyKCd4JywgZD0+c2NhbGVERChkKStiYXJYKVxuICAgIC5hdHRyKCd5JywgZmlyc3RCYXJZKzIwKVxuICAgIC5hdHRyKCdoZWlnaHQnLCA2KVxuICBzdmcuc2VsZWN0QWxsKCcudGlja0xhYmVsMScpXG4gICAgLmRhdGEoZDMucmFuZ2Uod2lkdGggPiA1MDAgPyAxIDogMSwgMTApKVxuICAgIC5lbnRlcigpXG4gICAgLmFwcGVuZCgndGV4dCcpXG4gICAgLmF0dHIoJ2NsYXNzJywgJ3RpY2tMYWJlbDEnKVxuICAgIC5hdHRyKCd4JywgZD0+c2NhbGVERChkKStiYXJYKy41KVxuICAgIC5hdHRyKCd5JywgZmlyc3RCYXJZKzE4KVxuICAgIC8vLnN0eWxlKFwiZm9udC1zaXplXCIsIGB7VyA8IDU1MCA/IDEyIDogVyA8IDY1MCA/IDE0IDogVyA8IDc1MCA/IDE2IDogVyA8IDg1MCA/IDE4IDogMjB9cHhgKVxuICAgIC50ZXh0KGQ9PmQpXG4gIC8vIENlbnQgdGlja3NcbiAgc3ZnLnNlbGVjdEFsbCgnLnRpY2tDMicpXG4gICAgLmRhdGEoZDMucmFuZ2Uod2lkdGggPiA1MDAgPyAxMCA6IDEwLCAxMDApKVxuICAgIC5lbnRlcigpXG4gICAgLmFwcGVuZCgncmVjdCcpXG4gICAgLmF0dHIoJ2NsYXNzJywgJ3RpY2tDMicpXG4gICAgLmF0dHIoJ3gnLCBkPT5zY2FsZUREKGQvMTApK2JhclgpXG4gICAgLmF0dHIoJ3knLCBmaXJzdEJhclkrMTApXG4gICAgLmF0dHIoJ2hlaWdodCcsIGQ9PmQlMj09PTA/IDk6NilcbiAgLy8gQmVhdCB0aWNrc1xuICBzdmcuc2VsZWN0QWxsKCcudGlja0InKVxuICAgIC5kYXRhKGQzLnJhbmdlKHdpZHRoID4gNTAwID8gMTAgOiAxMCwgMTAwKSlcbiAgICAuZW50ZXIoKVxuICAgIC5hcHBlbmQoJ3JlY3QnKVxuICAgIC5hdHRyKCdjbGFzcycsICd0aWNrQicpXG4gICAgLmF0dHIoJ3gnLCBkPT5zY2FsZUREKGQvMTApK2JhclgpXG4gICAgLmF0dHIoJ3knLCBmaXJzdEJhclkrNjApXG4gICAgLmF0dHIoJ2hlaWdodCcsIGQ9PmQlMj09PTA/IDk6NilcbiAgLy8gTGFiZWxzXG4gIHN2Zy5zZWxlY3RBbGwoJy50aW1lTGFiZWwnKVxuICAgIC5kYXRhKFtgKyR7YmFyRER9YCwgYCR7YmFyTWlsc31gLCBgJHtiYXJCZWF0c31gXSlcbiAgICAuZW50ZXIoKVxuICAgIC5hcHBlbmQoJ3RleHQnKVxuICAgIC5hdHRyKCdjbGFzcycsICd0aW1lTGFiZWwnKVxuICAgIC5hdHRyKCd4JywgYmFyWCsyKVxuICAgIC5hdHRyKCd5JywgKGQsaSk9PmkqMzArZmlyc3RCYXJZKzIwKVxuICAgIC5zdHlsZShcImZvbnQtc2l6ZVwiLCBgJHtXIDwgMzAwID8gMTQgOiBXIDwgNDAwID8gMTYgOiBXIDwgNTAwID8gMTggOiBXIDwgNjAwID8gMjAgOiAyMn1weGApXG4gICAgLnRleHQoZD0+ZCk7XG4gIHN2Zy5hdHRyKFwiaWRcIiwgXCJiYXJDbG9ja1wiKTtcbiAgcmV0dXJuIHN2Zy5ub2RlKCk7XG59XG5iYXJDaGFydDEgPSB7XG5jb25zdCBXID0gd2lkdGg7XG4gIGNvbnN0IEggPSA4ODtcbiAgY29uc3QgYmFyWCA9IDE7XG4gIGNvbnN0IGZpcnN0QmFyWSA9IDE7XG4gIGNvbnN0IHN2ZyA9IGQzXG4gICAgLmNyZWF0ZShcInN2Z1wiKVxuICAgIC5hdHRyKFwid2lkdGhcIiwgVylcbiAgICAuYXR0cihcInZpZXdCb3hcIiwgWzAsIDAsIFcgKiAoVyA8IDM3MCA/IC43MyA6IFcgPCA0MjAgPyAuNzYgOiBXIDwgNDcwID8gLjc5IDogVyA8IDUyMCA/IC44MSA6IFcgPCA1NzAgPyAuODMgOiBXIDwgNjIwID8gLjg0IDogVyA8IDY3MCA/IC44NSA6IFcgPCA3MjAgPyAuODYgOiAuODcpLCBIXSk7XG4gIGNvbnN0IHhSYW5nZSA9IFswLCBXIC0gMTAwXTtcbiAgY29uc3Qgc2NhbGVERCA9IGQzLnNjYWxlTGluZWFyKClcbiAgICAuZG9tYWluKFswLCAxMF0pXG4gICAgLnJhbmdlKHhSYW5nZSk7XG4gIGNvbnN0IHNjYWxlTWFuZEIgPSBkMy5zY2FsZUxpbmVhcigpXG4gICAgLmRvbWFpbihbMCwgMTAwXSlcbiAgICAucmFuZ2UoeFJhbmdlKTtcbiAgLy8gY29uc3Qgc2NhbGVEZWsgPSBkMy5zY2FsZUxpbmVhcigpXG4gIC8vICAuZG9tYWluKFswLCAzN10pXG4gIC8vICAucmFuZ2UoeFJhbmdlKTtcbiAgLy8gQmFja2dyb3VuZCBiYXJzIHRvIHNob3cgd2hlcmUgMTAwJSBsaWVzXG4gIHN2Zy5zZWxlY3RBbGwoJy5iYWNrZ3JvdW5kJylcbiAgICAuZGF0YShbXG4gICAgICAvLyAnZGVrJywgJ2RvdGQnLFxuICAgICAgJ2RkJywgXCJtaWxzXCIsICdiZWF0cyddKVxuICAgIC5lbnRlcigpXG4gICAgLmFwcGVuZCgncmVjdCcpXG4gICAgLmF0dHIoJ2NsYXNzJywgJ2JhY2tncm91bmQgdGltZUJhcicpXG4gICAgLmF0dHIoJ3dpZHRoJywgVy0xMDApXG4gICAgLmF0dHIoJ3knLCAoZCxpKT0+aSozMCtmaXJzdEJhclkpXG4gIC8vIEJlYXRzXG4gIHN2Z1xuICAgIC5hcHBlbmQoJ3JlY3QnKVxuICAgIC5hdHRyKCdjbGFzcycsICd0aW1lQmFyJylcbiAgICAuYXR0cigneScsIGZpcnN0QmFyWSs2MClcbiAgICAuYXR0cignd2lkdGgnLCBkID0+IHNjYWxlTWFuZEIoTnVtYmVyKGJhckJlYXRzTikpKVxuICBzdmdcbiAgICAuYXBwZW5kKCdyZWN0JylcbiAgICAuYXR0cignY2xhc3MnLCAndGltZUJhckZ1bGxOJylcbiAgICAuYXR0cigneScsIGZpcnN0QmFyWSs2MClcbiAgICAuYXR0cignd2lkdGgnLCBkID0+IHNjYWxlTWFuZEIoYmFyQmVhdHNOKSlcbiAgLy8gQ2VudHMvTWlsc1xuICBzdmdcbiAgICAuYXBwZW5kKCdyZWN0JylcbiAgICAuYXR0cignY2xhc3MnLCAndGltZUJhcicpXG4gICAgLmF0dHIoJ3knLCBmaXJzdEJhclkpXG4gICAgLmF0dHIoJ3dpZHRoJywgZCA9PiBzY2FsZUREKE51bWJlcihiYXJERE4pK051bWJlcihiYXJNaWxzTikvMTAwK051bWJlcihiYXJCZWF0c04pLzEwMDAwKSlcbiAgc3ZnXG4gICAgLmFwcGVuZCgncmVjdCcpXG4gICAgLmF0dHIoJ2NsYXNzJywgJ3RpbWVCYXJGdWxsTicpXG4gICAgLmF0dHIoJ3knLCBmaXJzdEJhclkpXG4gICAgLmF0dHIoJ3dpZHRoJywgZCA9PiBzY2FsZUREKGJhckRETikpXG4gIHN2Z1xuICAgIC5hcHBlbmQoJ3JlY3QnKVxuICAgIC5hdHRyKCdjbGFzcycsICd0aW1lQmFyJylcbiAgICAuYXR0cigneScsIGZpcnN0QmFyWSszMClcbiAgICAuYXR0cignd2lkdGgnLCBkID0+IHNjYWxlTWFuZEIoTnVtYmVyKGJhck1pbHNOKStOdW1iZXIoYmFyQmVhdHNOKS8xMDApKVxuICBzdmdcbiAgICAuYXBwZW5kKCdyZWN0JylcbiAgICAuYXR0cignY2xhc3MnLCAndGltZUJhckZ1bGxOJylcbiAgICAuYXR0cigneScsIGZpcnN0QmFyWSszMClcbiAgICAuYXR0cignd2lkdGgnLCBkID0+IHNjYWxlTWFuZEIoYmFyTWlsc04pKVxuICAvLyBDZW50IHRpY2tzXG4gIHN2Zy5zZWxlY3RBbGwoJy50aWNrQycpXG4gICAgLmRhdGEoZDMucmFuZ2Uod2lkdGggPiA1MDAgPyAxMCA6IDEwLCAxMDApKVxuICAgIC5lbnRlcigpXG4gICAgLmFwcGVuZCgncmVjdCcpXG4gICAgLmF0dHIoJ2NsYXNzJywgJ3RpY2tDJylcbiAgICAuYXR0cigneCcsIGQ9PnNjYWxlREQoZC8xMCkrYmFyWClcbiAgICAuYXR0cigneScsIGZpcnN0QmFyWSszMClcbiAgICAuYXR0cignaGVpZ2h0JywgZD0+ZCUyPT09MD8gODo1KVxuICBzdmcuc2VsZWN0QWxsKCcudGlja0IxJylcbiAgICAuZGF0YShkMy5yYW5nZSh3aWR0aCA+IDUwMCA/IDEwIDogMTAsIDEwMCkpXG4gICAgLmVudGVyKClcbiAgICAuYXBwZW5kKCdyZWN0JylcbiAgICAuYXR0cignY2xhc3MnLCAndGlja0IxJylcbiAgICAuYXR0cigneCcsIGQ9PnNjYWxlREQoZC8xMCkrYmFyWClcbiAgICAuYXR0cigneScsIGQ9PmQlMj09PTA/IGZpcnN0QmFyWSs3NzpmaXJzdEJhclkrODApXG4gICAgLmF0dHIoJ2hlaWdodCcsIGQ9PmQlMj09PTA/IDg6NSlcbiAgc3ZnLnNlbGVjdEFsbCgnLnRpY2tDMScpXG4gICAgLmRhdGEoZDMucmFuZ2Uod2lkdGggPiA1MDAgPyAxMCA6IDEwLCAxMDApKVxuICAgIC5lbnRlcigpXG4gICAgLmFwcGVuZCgncmVjdCcpXG4gICAgLmF0dHIoJ2NsYXNzJywgJ3RpY2tDMScpXG4gICAgLmF0dHIoJ3gnLCBkPT5zY2FsZUREKGQvMTApK2JhclgpXG4gICAgLmF0dHIoJ3knLCBkPT5kJTI9PT0wPyBmaXJzdEJhclkrNDc6Zmlyc3RCYXJZKzUwKVxuICAgIC5hdHRyKCdoZWlnaHQnLCBkPT5kJTI9PT0wPyA4OjUpXG4gIC8vIE1pbCB0aWNrc1xuICBzdmcuc2VsZWN0QWxsKCcudGlja00nKVxuICAgIC5kYXRhKGQzLnJhbmdlKHdpZHRoID4gNTAwID8gMSA6IDEsIDEwKSlcbiAgICAuZW50ZXIoKVxuICAgIC5hcHBlbmQoJ3JlY3QnKVxuICAgIC5hdHRyKCdjbGFzcycsICd0aWNrTScpXG4gICAgLmF0dHIoJ3gnLCBkPT5zY2FsZUREKGQpK2JhclgpXG4gICAgLmF0dHIoJ3knLCBmaXJzdEJhclkrMjApXG4gICAgLmF0dHIoJ2hlaWdodCcsIDYpXG4gIHN2Zy5zZWxlY3RBbGwoJy50aWNrTGFiZWwxJylcbiAgICAuZGF0YShkMy5yYW5nZSh3aWR0aCA+IDUwMCA/IDEgOiAxLCAxMCkpXG4gICAgLmVudGVyKClcbiAgICAuYXBwZW5kKCd0ZXh0JylcbiAgICAuYXR0cignY2xhc3MnLCAndGlja0xhYmVsMScpXG4gICAgLmF0dHIoJ3gnLCBkPT5zY2FsZUREKGQpK2JhclgrLjUpXG4gICAgLmF0dHIoJ3knLCBmaXJzdEJhclkrMTgpXG4gICAgLy8uc3R5bGUoXCJmb250LXNpemVcIiwgYHtXIDwgMzUwID8gMTIgOiBXIDwgNDUwID8gMTQgOiBXIDwgNTUwID8gMTYgOiBXIDwgNjUwID8gMTggOiAyMH1weGApXG4gICAgLnRleHQoZD0+ZClcbiAgLy8gQ2VudCB0aWNrc1xuICBzdmcuc2VsZWN0QWxsKCcudGlja0MyJylcbiAgICAuZGF0YShkMy5yYW5nZSh3aWR0aCA+IDUwMCA/IDEwIDogMTAsIDEwMCkpXG4gICAgLmVudGVyKClcbiAgICAuYXBwZW5kKCdyZWN0JylcbiAgICAuYXR0cignY2xhc3MnLCAndGlja0MyJylcbiAgICAuYXR0cigneCcsIGQ9PnNjYWxlREQoZC8xMCkrYmFyWClcbiAgICAuYXR0cigneScsIGZpcnN0QmFyWSsxMClcbiAgICAuYXR0cignaGVpZ2h0JywgZD0+ZCUyPT09MD8gOTo2KVxuICAvLyBCZWF0IHRpY2tzXG4gIHN2Zy5zZWxlY3RBbGwoJy50aWNrQicpXG4gICAgLmRhdGEoZDMucmFuZ2Uod2lkdGggPiA1MDAgPyAxMCA6IDEwLCAxMDApKVxuICAgIC5lbnRlcigpXG4gICAgLmFwcGVuZCgncmVjdCcpXG4gICAgLmF0dHIoJ2NsYXNzJywgJ3RpY2tCJylcbiAgICAuYXR0cigneCcsIGQ9PnNjYWxlREQoZC8xMCkrYmFyWClcbiAgICAuYXR0cigneScsIGZpcnN0QmFyWSs2MClcbiAgICAuYXR0cignaGVpZ2h0JywgZD0+ZCUyPT09MD8gOTo2KVxuICAvLyBMYWJlbHNcbiAgc3ZnLnNlbGVjdEFsbCgnLnRpbWVMYWJlbCcpXG4gICAgLmRhdGEoW2AtJHtiYXJERE59YCwgYCR7YmFyTWlsc059YCwgYCR7YmFyQmVhdHNOfWBdKVxuICAgIC5lbnRlcigpXG4gICAgLmFwcGVuZCgndGV4dCcpXG4gICAgLmF0dHIoJ2NsYXNzJywgJ3RpbWVMYWJlbCcpXG4gICAgLmF0dHIoJ3gnLCBiYXJYKzIpXG4gICAgLmF0dHIoJ3knLCAoZCxpKT0+aSozMCtmaXJzdEJhclkrMjApXG4gICAgLnN0eWxlKFwiZm9udC1zaXplXCIsIGAke1cgPCAzMDAgPyAxNCA6IFcgPCA0MDAgPyAxNiA6IFcgPCA1MDAgPyAxOCA6IFcgPCA2MDAgPyAyMCA6IDIyfXB4YClcbiAgICAudGV4dChkPT5kKTtcbiAgc3ZnLmF0dHIoXCJpZFwiLCBcImJhckNsb2NrXCIpO1xuICByZXR1cm4gc3ZnLm5vZGUoKTtcbn1cbnZpZXdvZiBsb2NhdGlvbiA9IHdvcmxkTWFwQ29vcmRpbmF0ZXMoWzE2MiwgMF0sIFt3aWR0aCAqIC45OTgsIE1hdGgucm91bmQoKDIxIC8gNDApICogd2lkdGgpXSlcbi8vIGh0dHBzOi8vb2JzZXJ2YWJsZWhxLmNvbS9AZGJyaWRnZXMvdmlzdWFsaXppbmctc2Vhc29uYWwtZGF5bGlnaHRcbmFwcCA9IHtcbmNvbnN0IHN2ZyA9IGQzLnNlbGVjdChET00uc3ZnKHdpZHRoLCBoZWlnaHQgLSAod2lkdGggPCA0MDAgPyAxMCA6IHdpZHRoIDwgNjAwID8gMTUgOiB3aWR0aCA8IDcwMCA/IDMwIDogNDApKSk7XG4gIHN2Zy5zdHlsZShcInVzZXItc2VsZWN0XCIsIFwibm9uZVwiKVxuICAgICAuc3R5bGUoXCItd2Via2l0LXVzZXItc2VsZWN0XCIsIFwibm9uZVwiKTtcbiAgc3ZnLmF0dHIoXCJpZFwiLCBcImRheWxpZ2h0YXBwXCIpXG4gIGNvbnN0IG1hcmdpbiA9IHt0b3A6IDAsIGxlZnQ6IDEwLCByaWdodDogMTAsIGJvdHRvbTogMCwgaW5uZXI6IDN9O1xuICBjb25zdCBjb250ZW50V2lkdGggPSB3aWR0aCAtIG1hcmdpbi5sZWZ0IC0gbWFyZ2luLnJpZ2h0IC0gbWFyZ2luLmlubmVyO1xuICBjb25zdCBjb2x1bW5XaWR0aCA9IGNvbnRlbnRXaWR0aCAvIDI7XG4gIGNvbnN0IGRhdGUyMDIyID0gbmV3IERhdGUoMjAyMiwgbmV3IERhdGUoKS5nZXRNb250aCgpLCBuZXcgRGF0ZSgpLmdldERhdGUoKSwgbmV3IERhdGUoKS5nZXRIb3VycygpKVxuICBsZXQgc2VsZWN0aW9uID0ge1xuICAgIGRhdGU6IGRhdGUyMDIyLFxuICAgIGhvdXI6IGRhdGUyMDIyLmdldEhvdXJzKClcbiAgfVxuICBjb25zdCByZW5kZXJQbG90ID0gKCkgPT4ge1xuICAgIHN2Zy5zZWxlY3RBbGwoXCIjZGF5bGlnaHRwbG90ICpcIikucmVtb3ZlKCk7XG4gICAgc3ZnLnNlbGVjdChcIiNkYXlsaWdodHBsb3RcIikuY2FsbChkYXlsaWdodFBsb3QsIHtcbiAgICAgIHdpZHRoOiBjb2x1bW5XaWR0aCAvIDEuMjYsXG4gICAgICBoZWlnaHQ6IGhlaWdodCAvIDEuNTEgLSBtYXJnaW4udG9wIC0gbWFyZ2luLmJvdHRvbSxcbiAgICAgIHllYXI6IGRhdGUyMDIyLmdldEZ1bGxZZWFyKCksXG4gICAgICBsYXRpdHVkZTogbG9jYXRpb25bMV0sXG4gICAgICBkZWZhdWx0RGF0ZTogc2VsZWN0aW9uLmRhdGUsXG4gICAgICBkZWZhdWx0SG91cjogc2VsZWN0aW9uLmhvdXJcbiAgICB9KVxuICB9XG4gIGNvbnN0IHJlbmRlckdsb2JlID0gKCkgPT4ge1xuICAgIHN2Zy5zZWxlY3RBbGwoXCIjZ2xvYmUgKlwiKS5yZW1vdmUoKTtcbiAgICBzdmcuc2VsZWN0QWxsKFwiI2dsb2JlXCIpLmNhbGwoZ2xvYmUsIHsgd2lkdGg6IGNvbHVtbldpZHRoICogMS4yLCBsb2NhdGlvbiwgLi4uc2VsZWN0aW9uIH0pO1xuICB9XG4gIGNvbnN0IHJlbmRlclNvbGFyU3lzdGVtID0gKCkgPT4ge1xuICAgIHN2Zy5zZWxlY3RBbGwoXCIjc29sYXItc3lzdGVtICpcIikucmVtb3ZlKCk7XG4gICAgc3ZnLnNlbGVjdEFsbChcIiNzb2xhci1zeXN0ZW1cIikuY2FsbChzb2xhclN5c3RlbSxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBjb2x1bW5XaWR0aCAvIDEuMSxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBsb2NhdGlvbixcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBzZWxlY3Rpb24uZGF0ZSxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBzZWxlY3Rpb24uaG91cik7XG4gIH1cbiAgY29uc3Qgc2V0U2VsZWN0aW9uID0gKG5ld1NlbGVjdGlvbiwgZm9yY2VSZW5kZXIgPSBmYWxzZSkgPT4ge1xuICAgIGNvbnN0IHByZXYgPSB7Li4uc2VsZWN0aW9ufTtcbiAgICBzZWxlY3Rpb24gPSBuZXdTZWxlY3Rpb247XG4gICAgc3ZnLm5vZGUoKS52YWx1ZSA9IHNlbGVjdGlvbjtcbiAgICBpZiAoZm9yY2VSZW5kZXIpIHtcbiAgICAgIHJlbmRlclBsb3QoKTtcbiAgICAgIHJlbmRlclNvbGFyU3lzdGVtKCk7XG4gICAgICByZW5kZXJHbG9iZSgpO1xuICAgIH0gZWxzZSBpZiAocHJldi5ob3VyICE9PSBzZWxlY3Rpb24uaG91ciB8fCBwcmV2LmRhdGUgIT09IHNlbGVjdGlvbi5kYXRlKSB7XG4gICAgICByZW5kZXJTb2xhclN5c3RlbSgpO1xuICAgICAgcmVuZGVyR2xvYmUoKTtcbiAgICB9XG4gIH1cbiAgc3ZnLmFwcGVuZChcImdcIilcbiAgICAuYXR0cihcImlkXCIsIFwic29sYXItc3lzdGVtXCIpXG4gICAgLmF0dHIoXCJ0cmFuc2Zvcm1cIiwgYHRyYW5zbGF0ZSgke21hcmdpbi5sZWZ0ICsgMn0sICR7bWFyZ2luLnRvcCArIGhlaWdodCAvIDcuNX0pYCk7XG4gIGNvbnN0IHBsb3QgPSBzdmcuYXBwZW5kKFwiZ1wiKVxuICAgIC5hdHRyKFwiaWRcIiwgXCJkYXlsaWdodHBsb3RcIilcbiAgICAuYXR0cihcInRyYW5zZm9ybVwiLCBgdHJhbnNsYXRlKCR7bWFyZ2luLmxlZnR9LCAke21hcmdpbi50b3AgKyBoZWlnaHQgLyA0fSlgKTtcbiAgc3ZnLmFwcGVuZChcImdcIilcbiAgICAuYXR0cihcImlkXCIsIFwiZ2xvYmVcIilcbiAgICAuYXR0cihcInRyYW5zZm9ybVwiLCBgdHJhbnNsYXRlKCR7bWFyZ2luLmxlZnQgKyBtYXJnaW4uaW5uZXIgKyBjb2x1bW5XaWR0aCAvIDEuMjV9LCAke21hcmdpbi50b3AgKyBOdW1iZXIoY29sdW1uV2lkdGggPCAzMDApICogMTJ9KWApO1xuICBzZXRTZWxlY3Rpb24oc2VsZWN0aW9uLCB0cnVlKTtcbiAgY29uc3QgaGFuZGxlRGF0ZUhvdXJDaGFuZ2UgPSAoeyB0YXJnZXQsIGRldGFpbDogeyBkYXRlLCBob3VyIH19KSA9PiB7XG4gICAgaWYgKGRhdGUgIT0gbnVsbCAmJiBob3VyICE9IG51bGwpIHNldFNlbGVjdGlvbih7Li4uc2VsZWN0aW9uLCBkYXRlLCBob3VyfSk7XG4gIH1cbiAgc3ZnLm5vZGUoKS5hZGRFdmVudExpc3RlbmVyKEV2ZW50VHlwZS5EYXRlSG91ckNoYW5nZSwgaGFuZGxlRGF0ZUhvdXJDaGFuZ2UsIGZhbHNlKTtcbiAgcmV0dXJuIHN2Zy5ub2RlKCk7XG59XG4vLyBodHRwczovL29ic2VydmFibGVocS5jb20vQGQzL3NpbXBsZS1jbG9ja1xuLy8gaHR0cHM6Ly9vYnNlcnZhYmxlaHEuY29tL0BkcmlvL2xldHMtYnVpbGQtYW4tYW5hbG9nLWNsb2NrXG5jbG9jayA9IHtcbiAgY29uc3QgY2xvY2tSYWRpdXMgPSAyMDAsXG4gICAgbWFyZ2luID0gNTAsXG4gICAgdyA9IChjbG9ja1JhZGl1cyArIG1hcmdpbikgKiAyLFxuICAgIGggPSAoY2xvY2tSYWRpdXMgKyBtYXJnaW4pICogMixcbiAgICBob3VySGFuZExlbmd0aCA9ICgyICogY2xvY2tSYWRpdXMpIC8gMyxcbiAgICBtaW51dGVIYW5kTGVuZ3RoID0gY2xvY2tSYWRpdXMsXG4gICAgc2Vjb25kSGFuZExlbmd0aCA9IGNsb2NrUmFkaXVzIC0gMTIsXG4gICAgc2Vjb25kSGFuZEJhbGFuY2UgPSAzMCxcbiAgICBzZWNvbmRUaWNrU3RhcnQgPSBjbG9ja1JhZGl1cyxcbiAgICBzZWNvbmRUaWNrTGVuZ3RoID0gLTEwLFxuICAgIGhvdXJUaWNrU3RhcnQgPSBjbG9ja1JhZGl1cyxcbiAgICBob3VyVGlja0xlbmd0aCA9IC0xOCxcbiAgICBzZWNvbmRMYWJlbFJhZGl1cyA9IGNsb2NrUmFkaXVzICsgMTYsXG4gICAgc2Vjb25kTGFiZWxZT2Zmc2V0ID0gNSxcbiAgICBob3VyTGFiZWxSYWRpdXMgPSBjbG9ja1JhZGl1cyAtIDQwLFxuICAgIGhvdXJMYWJlbFlPZmZzZXQgPSA3LFxuICAgIHJhZGlhbnMgPSBNYXRoLlBJIC8gMTgwO1xuICBjb25zdCB0ZW4gPSBkM1xuICAgIC5zY2FsZUxpbmVhcigpXG4gICAgLnJhbmdlKFswLCAzNjBdKVxuICAgIC5kb21haW4oWzAsIDEwXSk7XG4gIGNvbnN0IHN0byA9IGQzXG4gICAgLnNjYWxlTGluZWFyKClcbiAgICAucmFuZ2UoWzAsIDM2MF0pXG4gICAgLmRvbWFpbihbMCwgMTAwXSk7XG4gIGNvbnN0IGhhbmREYXRhID0gW1xuICAgIHtcbiAgICAgIHR5cGU6IFwiaG91clwiLFxuICAgICAgdmFsdWU6IDAsXG4gICAgICBsZW5ndGg6IC1ob3VySGFuZExlbmd0aCxcbiAgICAgIHNjYWxlOiB0ZW5cbiAgICB9LFxuICAgIHtcbiAgICAgIHR5cGU6IFwibWludXRlXCIsXG4gICAgICB2YWx1ZTogMCxcbiAgICAgIGxlbmd0aDogLW1pbnV0ZUhhbmRMZW5ndGgsXG4gICAgICBzY2FsZTogc3RvXG4gICAgfSxcbiAgICB7XG4gICAgICB0eXBlOiBcInNlY29uZFwiLFxuICAgICAgdmFsdWU6IDAsXG4gICAgICBsZW5ndGg6IC1zZWNvbmRIYW5kTGVuZ3RoLFxuICAgICAgc2NhbGU6IHN0byxcbiAgICAgIGJhbGFuY2U6IHNlY29uZEhhbmRCYWxhbmNlXG4gICAgfVxuICBdO1xuICBmdW5jdGlvbiBkcmF3Q2xvY2soKSB7XG4gICAgLy8gY3JlYXRlIGFsbCB0aGUgY2xvY2sgZWxlbWVudHNcbiAgICB1cGRhdGVEYXRhKCk7IC8vZHJhdyB0aGVtIGluIHRoZSBjb3JyZWN0IHN0YXJ0aW5nIHBvc2l0aW9uXG4gICAgY29uc3QgZmFjZSA9IHN2Z1xuICAgICAgLmFwcGVuZChcImdcIilcbiAgICAgIC5hdHRyKFwiaWRcIiwgXCJjbG9jay1mYWNlXCIpXG4gICAgICAuYXR0cihcInRyYW5zZm9ybVwiLCBgdHJhbnNsYXRlKCR7W3cgLyAyLCBoIC8gMl19KWApO1xuICAgIC8vIGFkZCBtYXJrcyBmb3Igc2Vjb25kc1xuICAgIGZhY2VcbiAgICAgIC5zZWxlY3RBbGwoXCIuc2Vjb25kLXRpY2tcIilcbiAgICAgIC5kYXRhKGQzLnJhbmdlKDAsIDEwMCkpXG4gICAgICAuZW50ZXIoKVxuICAgICAgLmFwcGVuZChcImxpbmVcIilcbiAgICAgIC5hdHRyKFwiY2xhc3NcIiwgXCJzZWNvbmQtdGlja1wiKVxuICAgICAgLmF0dHIoXCJ4MVwiLCAwKVxuICAgICAgLmF0dHIoXCJ4MlwiLCAwKVxuICAgICAgLmF0dHIoXCJ5MVwiLCBzZWNvbmRUaWNrU3RhcnQpXG4gICAgICAuYXR0cihcInkyXCIsIHNlY29uZFRpY2tTdGFydCArIHNlY29uZFRpY2tMZW5ndGgpXG4gICAgICAuYXR0cihcInRyYW5zZm9ybVwiLCBkID0+IGByb3RhdGUoJHtzdG8oZCl9KWApO1xuICAgIC8vIGFuZCBsYWJlbHMuLi5cbiAgICBmYWNlXG4gICAgICAuc2VsZWN0QWxsKFwiLnNlY29uZC1sYWJlbFwiKVxuICAgICAgLmRhdGEoZDMucmFuZ2UoMCwgMTAwLCA1KSlcbiAgICAgIC5lbnRlcigpXG4gICAgICAuYXBwZW5kKFwidGV4dFwiKVxuICAgICAgLmF0dHIoXCJjbGFzc1wiLCBcInNlY29uZC1sYWJlbFwiKVxuICAgICAgLmF0dHIoXCJ0ZXh0LWFuY2hvclwiLCBcIm1pZGRsZVwiKVxuICAgICAgLmF0dHIoXCJ4XCIsIGQgPT4gc2Vjb25kTGFiZWxSYWRpdXMgKiBNYXRoLnNpbihzdG8oZCkgKiByYWRpYW5zKSlcbiAgICAgIC5hdHRyKFxuICAgICAgICBcInlcIixcbiAgICAgICAgZCA9PlxuICAgICAgICAgIC1zZWNvbmRMYWJlbFJhZGl1cyAqIE1hdGguY29zKHN0byhkKSAqIHJhZGlhbnMpICsgc2Vjb25kTGFiZWxZT2Zmc2V0XG4gICAgICApXG4gICAgICAudGV4dChkID0+IGQpO1xuICAgIC8vIC4uLiBhbmQgaG91cnNcbiAgICBmYWNlXG4gICAgICAuc2VsZWN0QWxsKFwiLmhvdXItdGlja1wiKVxuICAgICAgLmRhdGEoZDMucmFuZ2UoMCwgMTAsIDEpKVxuICAgICAgLmVudGVyKClcbiAgICAgIC5hcHBlbmQoXCJsaW5lXCIpXG4gICAgICAuYXR0cihcImNsYXNzXCIsIFwiaG91ci10aWNrXCIpXG4gICAgICAuYXR0cihcIngxXCIsIDApXG4gICAgICAuYXR0cihcIngyXCIsIDApXG4gICAgICAuYXR0cihcInkxXCIsIGhvdXJUaWNrU3RhcnQpXG4gICAgICAuYXR0cihcInkyXCIsIGhvdXJUaWNrU3RhcnQgKyBob3VyVGlja0xlbmd0aClcbiAgICAgIC5hdHRyKFwidHJhbnNmb3JtXCIsIGQgPT4gYHJvdGF0ZSgke3RlbihkKX0pYCk7XG4gICAgZmFjZVxuICAgICAgLnNlbGVjdEFsbChcIi5ob3VyLWxhYmVsXCIpXG4gICAgICAuZGF0YShkMy5yYW5nZSgwLCAxMCwgMSkpXG4gICAgICAuZW50ZXIoKVxuICAgICAgLmFwcGVuZChcInRleHRcIilcbiAgICAgIC5hdHRyKFwiY2xhc3NcIiwgXCJob3VyLWxhYmVsXCIpXG4gICAgICAuYXR0cihcInRleHQtYW5jaG9yXCIsIFwibWlkZGxlXCIpXG4gICAgICAuYXR0cihcInhcIiwgZCA9PiBob3VyTGFiZWxSYWRpdXMgKiBNYXRoLnNpbih0ZW4oZCkgKiByYWRpYW5zKSlcbiAgICAgIC5hdHRyKFxuICAgICAgICBcInlcIixcbiAgICAgICAgZCA9PiAtaG91ckxhYmVsUmFkaXVzICogTWF0aC5jb3ModGVuKGQpICogcmFkaWFucykgKyBob3VyTGFiZWxZT2Zmc2V0XG4gICAgICApXG4gICAgICAudGV4dChkID0+IGQpO1xuICAgIGNvbnN0IGhhbmRzID0gZmFjZS5hcHBlbmQoXCJnXCIpLmF0dHIoXCJpZFwiLCBcImNsb2NrLWhhbmRzXCIpO1xuICAgIGhhbmRzXG4gICAgICAuc2VsZWN0QWxsKFwibGluZVwiKVxuICAgICAgLmRhdGEoaGFuZERhdGEpXG4gICAgICAuZW50ZXIoKVxuICAgICAgLmFwcGVuZChcImxpbmVcIilcbiAgICAgIC5hdHRyKFwiY2xhc3NcIiwgZCA9PiBkLnR5cGUgKyBcIi1oYW5kXCIpXG4gICAgICAuYXR0cihcIngxXCIsIDApXG4gICAgICAuYXR0cihcInkxXCIsIGQgPT4gZC5iYWxhbmNlIHx8IDApXG4gICAgICAuYXR0cihcIngyXCIsIDApXG4gICAgICAuYXR0cihcInkyXCIsIGQgPT4gZC5sZW5ndGgpXG4gICAgICAuYXR0cihcInRyYW5zZm9ybVwiLCBkID0+IGByb3RhdGUoJHtkLnNjYWxlKGQudmFsdWUpfSlgKTtcbiAgICBmYWNlXG4gICAgICAuYXBwZW5kKFwiZ1wiKVxuICAgICAgLmF0dHIoXCJpZFwiLCBcImZhY2Utb3ZlcmxheVwiKVxuICAgICAgLmFwcGVuZChcImNpcmNsZVwiKVxuICAgICAgLmF0dHIoXCJjbGFzc1wiLCBcImhhbmRzLWNvdmVyXCIpXG4gICAgICAuYXR0cihcInhcIiwgMClcbiAgICAgIC5hdHRyKFwieVwiLCAwKVxuICAgICAgLmF0dHIoXCJyXCIsIGNsb2NrUmFkaXVzIC8gMjApO1xuICB9XG4gIGZ1bmN0aW9uIG1vdmVIYW5kcygpIHtcbiAgICBjb25zdCBzZWwgPSBkM1xuICAgICAgLnNlbGVjdChcIiNjbG9jay1oYW5kcy1maW5hbFwiKVxuICAgICAgLnNlbGVjdEFsbChcImxpbmVcIilcbiAgICAgIC5kYXRhKGhhbmREYXRhKVxuICAgICAgLnRyYW5zaXRpb24oKTtcbiAgICBpZiAoZmFuY3lTZWNvbmRzT0ZGKSBzZWwuZWFzZShkMy5lYXNlRWxhc3RpYy5wZXJpb2QoMC41KSk7XG4gICAgc2VsLmF0dHIoXCJ0cmFuc2Zvcm1cIiwgZCA9PiBgcm90YXRlKCR7ZC5zY2FsZShkLnZhbHVlKX0pYCk7XG4gIH1cbiAgZnVuY3Rpb24gdXBkYXRlRGF0YSgpIHtcbiAgICBoYW5kRGF0YVswXS52YWx1ZSA9ICFmYW5jeVNlY29uZHNPRkYgPyBNYXRoLmZsb29yKHNlbGVjdGVkRXhhY3QgKiAxMCkgOiBkZWNUaW1lWzBdO1xuICAgIGhhbmREYXRhWzFdLnZhbHVlID0gIWZhbmN5U2Vjb25kc09GRiA/IE1hdGguZmxvb3Ioc2VsZWN0ZWRFeGFjdCAqIDEwICUgMSAqIDEwMCkgOiBkZWNUaW1lLnNsaWNlKDIsIDQpO1xuICAgIGhhbmREYXRhWzJdLnZhbHVlID0gIWZhbmN5U2Vjb25kc09GRiA/IHNlbGVjdGVkRXhhY3QgKiAxMCAlIDEgKiAxMDAgJSAxICogMTAwIDogZGVjVGltZS5zbGljZSg0LCA2KTtcbiAgfVxuICBjb25zdCBzdmcgPSBkM1xuICAgIC5jcmVhdGUoXCJzdmdcIilcbiAgICAuYXR0cihcInZpZXdCb3hcIiwgWzAsIDAsIHcsIGhdKVxuICAgIC5zdHlsZShcIm1heC13aWR0aFwiLCBgJHt3aWR0aCAvIDIuMX1weGApXG4gICAgLmF0dHIoXCJjbGFzc1wiLCBcImNsb2NrLXRvcFwiKVxuICAgIC5hdHRyKFwiaWRcIiwgXCJjbG9ja1wiKTtcbiAgc3ZnXG4gICAgLmFwcGVuZChcInRleHRcIilcbiAgICAudGV4dChgKyR7ZGVjVGltZX0tJHtzZWxlY3RlZFpvbmV9YClcbiAgICAuYXR0cihcInhcIiwgY2xvY2tSYWRpdXMgKyBtYXJnaW4pXG4gICAgLmF0dHIoXCJ5XCIsIGNsb2NrUmFkaXVzICogMiArIG1hcmdpbiAqIDEuOTc1KVxuICAgIC5hdHRyKFwidGV4dC1hbmNob3JcIiwgXCJtaWRkbGVcIilcbiAgICAuYXR0cihcImZvbnQtc2l6ZVwiLCAzMilcbiAgICAuYXR0cihcImZvbnQtZmFtaWx5XCIsIFwibW9ub3NwYWNlXCIpO1xuICBkcmF3Q2xvY2soKTtcbiAgLy8gQW5pbWF0aW9uXG4gIGNvbnN0IGludGVydmFsID0gc2V0SW50ZXJ2YWwoXG4gICAgKCkgPT4ge1xuICAgICAgdXBkYXRlRGF0YSgpO1xuICAgICAgbW92ZUhhbmRzKCk7XG4gICAgfSxcbiAgICAhZmFuY3lTZWNvbmRzT0ZGID8gMTAgOiA4NjRcbiAgKTtcbiAgaW52YWxpZGF0aW9uLnRoZW4oKCkgPT4gY2xlYXJJbnRlcnZhbChpbnRlcnZhbCkpO1xuICByZXR1cm4gc3ZnLm5vZGUoKTtcbn1cbmNsb2NrMSA9IHtcbiAgY29uc3QgY2xvY2tSYWRpdXMgPSAyMDAsXG4gICAgbWFyZ2luID0gNTAsXG4gICAgdyA9IChjbG9ja1JhZGl1cyArIG1hcmdpbikgKiAyLFxuICAgIGggPSAoY2xvY2tSYWRpdXMgKyBtYXJnaW4pICogMixcbiAgICBob3VySGFuZExlbmd0aCA9ICgyICogY2xvY2tSYWRpdXMpIC8gMyxcbiAgICBtaW51dGVIYW5kTGVuZ3RoID0gY2xvY2tSYWRpdXMsXG4gICAgc2Vjb25kSGFuZExlbmd0aCA9IGNsb2NrUmFkaXVzIC0gMTIsXG4gICAgc2Vjb25kSGFuZEJhbGFuY2UgPSAzMCxcbiAgICBzZWNvbmRUaWNrU3RhcnQgPSBjbG9ja1JhZGl1cyxcbiAgICBzZWNvbmRUaWNrTGVuZ3RoID0gLTEwLFxuICAgIGhvdXJUaWNrU3RhcnQgPSBjbG9ja1JhZGl1cyxcbiAgICBob3VyVGlja0xlbmd0aCA9IC0xOCxcbiAgICBzZWNvbmRMYWJlbFJhZGl1cyA9IGNsb2NrUmFkaXVzICsgMTYsXG4gICAgc2Vjb25kTGFiZWxZT2Zmc2V0ID0gNSxcbiAgICBob3VyTGFiZWxSYWRpdXMgPSBjbG9ja1JhZGl1cyAtIDQwLFxuICAgIGhvdXJMYWJlbFlPZmZzZXQgPSA3LFxuICAgIHJhZGlhbnMgPSBNYXRoLlBJIC8gMTgwO1xuICBjb25zdCB0ZW4gPSBkM1xuICAgIC5zY2FsZUxpbmVhcigpXG4gICAgLnJhbmdlKFswLCAzNjBdKVxuICAgIC5kb21haW4oWzAsIDEwXSk7XG4gIGNvbnN0IHN0byA9IGQzXG4gICAgLnNjYWxlTGluZWFyKClcbiAgICAucmFuZ2UoWzAsIDM2MF0pXG4gICAgLmRvbWFpbihbMCwgMTAwXSk7XG4gIGNvbnN0IGhhbmREYXRhID0gW1xuICAgIHtcbiAgICAgIHR5cGU6IFwiaG91clwiLFxuICAgICAgdmFsdWU6IDAsXG4gICAgICBsZW5ndGg6IC1ob3VySGFuZExlbmd0aCxcbiAgICAgIHNjYWxlOiB0ZW5cbiAgICB9LFxuICAgIHtcbiAgICAgIHR5cGU6IFwibWludXRlXCIsXG4gICAgICB2YWx1ZTogMCxcbiAgICAgIGxlbmd0aDogLW1pbnV0ZUhhbmRMZW5ndGgsXG4gICAgICBzY2FsZTogc3RvXG4gICAgfSxcbiAgICB7XG4gICAgICB0eXBlOiBcInNlY29uZFwiLFxuICAgICAgdmFsdWU6IDAsXG4gICAgICBsZW5ndGg6IC1zZWNvbmRIYW5kTGVuZ3RoLFxuICAgICAgc2NhbGU6IHN0byxcbiAgICAgIGJhbGFuY2U6IHNlY29uZEhhbmRCYWxhbmNlXG4gICAgfVxuICBdO1xuICBmdW5jdGlvbiBkcmF3Q2xvY2soKSB7XG4gICAgLy8gY3JlYXRlIGFsbCB0aGUgY2xvY2sgZWxlbWVudHNcbiAgICB1cGRhdGVEYXRhKCk7IC8vZHJhdyB0aGVtIGluIHRoZSBjb3JyZWN0IHN0YXJ0aW5nIHBvc2l0aW9uXG4gICAgY29uc3QgZmFjZSA9IHN2Z1xuICAgICAgLmFwcGVuZChcImdcIilcbiAgICAgIC5hdHRyKFwiaWRcIiwgXCJjbG9jay1mYWNlXCIpXG4gICAgICAuYXR0cihcInRyYW5zZm9ybVwiLCBgdHJhbnNsYXRlKCR7W3cgLyAyLCBoIC8gMl19KWApO1xuICAgIC8vIGFkZCBtYXJrcyBmb3Igc2Vjb25kc1xuICAgIGZhY2VcbiAgICAgIC5zZWxlY3RBbGwoXCIuc2Vjb25kLXRpY2tcIilcbiAgICAgIC5kYXRhKGQzLnJhbmdlKDAsIDEwMCkpXG4gICAgICAuZW50ZXIoKVxuICAgICAgLmFwcGVuZChcImxpbmVcIilcbiAgICAgIC5hdHRyKFwiY2xhc3NcIiwgXCJzZWNvbmQtdGlja1wiKVxuICAgICAgLmF0dHIoXCJ4MVwiLCAwKVxuICAgICAgLmF0dHIoXCJ4MlwiLCAwKVxuICAgICAgLmF0dHIoXCJ5MVwiLCBzZWNvbmRUaWNrU3RhcnQpXG4gICAgICAuYXR0cihcInkyXCIsIHNlY29uZFRpY2tTdGFydCArIHNlY29uZFRpY2tMZW5ndGgpXG4gICAgICAuYXR0cihcInRyYW5zZm9ybVwiLCBkID0+IGByb3RhdGUoJHtzdG8oZCl9KWApO1xuICAgIC8vIGFuZCBsYWJlbHMuLi5cbiAgICBmYWNlXG4gICAgICAuc2VsZWN0QWxsKFwiLnNlY29uZC1sYWJlbFwiKVxuICAgICAgLmRhdGEoZDMucmFuZ2UoMCwgMTAwLCA1KSlcbiAgICAgIC5lbnRlcigpXG4gICAgICAuYXBwZW5kKFwidGV4dFwiKVxuICAgICAgLmF0dHIoXCJjbGFzc1wiLCBcInNlY29uZC1sYWJlbFwiKVxuICAgICAgLmF0dHIoXCJ0ZXh0LWFuY2hvclwiLCBcIm1pZGRsZVwiKVxuICAgICAgLmF0dHIoXCJ4XCIsIGQgPT4gc2Vjb25kTGFiZWxSYWRpdXMgKiBNYXRoLnNpbihzdG8oZCkgKiByYWRpYW5zKSlcbiAgICAgIC5hdHRyKFxuICAgICAgICBcInlcIixcbiAgICAgICAgZCA9PlxuICAgICAgICAgIC1zZWNvbmRMYWJlbFJhZGl1cyAqIE1hdGguY29zKHN0byhkKSAqIHJhZGlhbnMpICsgc2Vjb25kTGFiZWxZT2Zmc2V0XG4gICAgICApXG4gICAgICAudGV4dChkID0+IGQpO1xuICAgIC8vIC4uLiBhbmQgaG91cnNcbiAgICBmYWNlXG4gICAgICAuc2VsZWN0QWxsKFwiLmhvdXItdGlja1wiKVxuICAgICAgLmRhdGEoZDMucmFuZ2UoMCwgMTAsIDEpKVxuICAgICAgLmVudGVyKClcbiAgICAgIC5hcHBlbmQoXCJsaW5lXCIpXG4gICAgICAuYXR0cihcImNsYXNzXCIsIFwiaG91ci10aWNrXCIpXG4gICAgICAuYXR0cihcIngxXCIsIDApXG4gICAgICAuYXR0cihcIngyXCIsIDApXG4gICAgICAuYXR0cihcInkxXCIsIGhvdXJUaWNrU3RhcnQpXG4gICAgICAuYXR0cihcInkyXCIsIGhvdXJUaWNrU3RhcnQgKyBob3VyVGlja0xlbmd0aClcbiAgICAgIC5hdHRyKFwidHJhbnNmb3JtXCIsIGQgPT4gYHJvdGF0ZSgke3RlbihkKX0pYCk7XG4gICAgZmFjZVxuICAgICAgLnNlbGVjdEFsbChcIi5ob3VyLWxhYmVsXCIpXG4gICAgICAuZGF0YShkMy5yYW5nZSgwLCAxMCwgMSkpXG4gICAgICAuZW50ZXIoKVxuICAgICAgLmFwcGVuZChcInRleHRcIilcbiAgICAgIC5hdHRyKFwiY2xhc3NcIiwgXCJob3VyLWxhYmVsXCIpXG4gICAgICAuYXR0cihcInRleHQtYW5jaG9yXCIsIFwibWlkZGxlXCIpXG4gICAgICAuYXR0cihcInhcIiwgZCA9PiBob3VyTGFiZWxSYWRpdXMgKiBNYXRoLnNpbih0ZW4oZCkgKiByYWRpYW5zKSlcbiAgICAgIC5hdHRyKFxuICAgICAgICBcInlcIixcbiAgICAgICAgZCA9PiAtaG91ckxhYmVsUmFkaXVzICogTWF0aC5jb3ModGVuKGQpICogcmFkaWFucykgKyBob3VyTGFiZWxZT2Zmc2V0XG4gICAgICApXG4gICAgICAudGV4dChkID0+IGQpO1xuICAgIGNvbnN0IGhhbmRzID0gZmFjZS5hcHBlbmQoXCJnXCIpLmF0dHIoXCJpZFwiLCBcImNsb2NrLWhhbmRzXCIpO1xuICAgIGhhbmRzXG4gICAgICAuc2VsZWN0QWxsKFwibGluZVwiKVxuICAgICAgLmRhdGEoaGFuZERhdGEpXG4gICAgICAuZW50ZXIoKVxuICAgICAgLmFwcGVuZChcImxpbmVcIilcbiAgICAgIC5hdHRyKFwiY2xhc3NcIiwgZCA9PiBkLnR5cGUgKyBcIi1oYW5kXCIpXG4gICAgICAuYXR0cihcIngxXCIsIDApXG4gICAgICAuYXR0cihcInkxXCIsIGQgPT4gZC5iYWxhbmNlIHx8IDApXG4gICAgICAuYXR0cihcIngyXCIsIDApXG4gICAgICAuYXR0cihcInkyXCIsIGQgPT4gZC5sZW5ndGgpXG4gICAgICAuYXR0cihcInRyYW5zZm9ybVwiLCBkID0+IGByb3RhdGUoJHtkLnNjYWxlKGQudmFsdWUpfSlgKTtcbiAgICBmYWNlXG4gICAgICAuYXBwZW5kKFwiZ1wiKVxuICAgICAgLmF0dHIoXCJpZFwiLCBcImZhY2Utb3ZlcmxheVwiKVxuICAgICAgLmFwcGVuZChcImNpcmNsZVwiKVxuICAgICAgLmF0dHIoXCJjbGFzc1wiLCBcImhhbmRzLWNvdmVyXCIpXG4gICAgICAuYXR0cihcInhcIiwgMClcbiAgICAgIC5hdHRyKFwieVwiLCAwKVxuICAgICAgLmF0dHIoXCJyXCIsIGNsb2NrUmFkaXVzIC8gMjApO1xuICB9XG4gIGZ1bmN0aW9uIG1vdmVIYW5kcygpIHtcbiAgICBjb25zdCBzZWwgPSBkM1xuICAgICAgLnNlbGVjdChcIiNjbG9jay1oYW5kcy1maW5hbFwiKVxuICAgICAgLnNlbGVjdEFsbChcImxpbmVcIilcbiAgICAgIC5kYXRhKGhhbmREYXRhKVxuICAgICAgLnRyYW5zaXRpb24oKTtcbiAgICBpZiAoZmFuY3lTZWNvbmRzT0ZGKSBzZWwuZWFzZShkMy5lYXNlRWxhc3RpYy5wZXJpb2QoMC41KSk7XG4gICAgc2VsLmF0dHIoXCJ0cmFuc2Zvcm1cIiwgZCA9PiBgcm90YXRlKCR7ZC5zY2FsZShkLnZhbHVlKX0pYCk7XG4gIH1cbiAgZnVuY3Rpb24gdXBkYXRlRGF0YSgpIHtcbiAgICBoYW5kRGF0YVswXS52YWx1ZSA9ICFmYW5jeVNlY29uZHNPRkYgPyBNYXRoLmZsb29yKHNlbGVjdGVkRXhhY3ROICogMTApIDogZGVjVGltZU5bMF07XG4gICAgaGFuZERhdGFbMV0udmFsdWUgPSAhZmFuY3lTZWNvbmRzT0ZGID8gTWF0aC5mbG9vcihzZWxlY3RlZEV4YWN0TiAqIDEwICUgMSAqIDEwMCkgOiBkZWNUaW1lTi5zbGljZSgyLCA0KTtcbiAgICBoYW5kRGF0YVsyXS52YWx1ZSA9ICFmYW5jeVNlY29uZHNPRkYgPyBzZWxlY3RlZEV4YWN0TiAqIDEwICUgMSAqIDEwMCAlIDEgKiAxMDAgOiBkZWNUaW1lTi5zbGljZSg0LCA2KTtcbiAgfVxuICBjb25zdCBzdmcgPSBkM1xuICAgIC5jcmVhdGUoXCJzdmdcIilcbiAgICAuYXR0cihcInZpZXdCb3hcIiwgWzAsIDAsIHcsIGhdKVxuICAgIC5zdHlsZShcIm1heC13aWR0aFwiLCBgJHt3aWR0aCAvIDIuMX1weGApXG4gICAgLmF0dHIoXCJjbGFzc1wiLCBcImNsb2NrLWJ0bVwiKVxuICAgIC5hdHRyKFwiaWRcIiwgXCJjbG9ja1wiKTtcbiAgc3ZnXG4gICAgLmFwcGVuZChcInRleHRcIilcbiAgICAudGV4dChgLSR7ZGVjVGltZU59LSR7c2VsZWN0ZWRab25lfWApXG4gICAgLmF0dHIoXCJ4XCIsIGNsb2NrUmFkaXVzICsgbWFyZ2luKVxuICAgIC5hdHRyKFwieVwiLCBjbG9ja1JhZGl1cyAqIDIgKyBtYXJnaW4gKiAxLjk3NSlcbiAgICAuYXR0cihcInRleHQtYW5jaG9yXCIsIFwibWlkZGxlXCIpXG4gICAgLmF0dHIoXCJmb250LXNpemVcIiwgMzIpXG4gICAgLmF0dHIoXCJmb250LWZhbWlseVwiLCBcIm1vbm9zcGFjZVwiKTtcbiAgZHJhd0Nsb2NrKCk7XG4gIC8vIEFuaW1hdGlvblxuICBjb25zdCBpbnRlcnZhbCA9IHNldEludGVydmFsKFxuICAgICgpID0+IHtcbiAgICAgIHVwZGF0ZURhdGEoKTtcbiAgICAgIG1vdmVIYW5kcygpO1xuICAgIH0sXG4gICAgIWZhbmN5U2Vjb25kc09GRiA/IDEwIDogODY0XG4gICk7XG4gIGludmFsaWRhdGlvbi50aGVuKCgpID0+IGNsZWFySW50ZXJ2YWwoaW50ZXJ2YWwpKTtcbiAgcmV0dXJuIHN2Zy5ub2RlKCk7XG59XG4ifSx7Im1ldGhvZE5hbWUiOiJpbnRlcnByZXQiLCJjZWxsTmFtZSI6Im9qcy1jZWxsLTIiLCJpbmxpbmUiOmZhbHNlLCJzb3VyY2UiOiJ1bml4ID0ge1xuICB3aGlsZSh0cnVlKSB7XG4gICAgeWllbGQgRGF0ZS5ub3coKTtcbiAgfVxufVxuZnVuY3Rpb24gdW5peDJkb3RlKHVuaXgsIHpvbmUsIG9mZnNldCA9IDcxOTQ2OCkge1xuICByZXR1cm4gWyh1bml4ID8/IERhdGUubm93KCkpIC8gODY0MDAwMDAgKyAoXG4gICAgem9uZSA9IHpvbmUgPz8gLU1hdGgucm91bmQoXG4gICAgICAobmV3IERhdGUpLmdldFRpbWV6b25lT2Zmc2V0KCkgLyAxNDQpXG4gICAgKSAvIDEwICsgb2Zmc2V0LCB6b25lXVxufVxuZnVuY3Rpb24gdW5peDJkb3RlMSh1bml4LCB6b25lLCBvZmZzZXQgPSA3MTk0NjgpIHtcbiAgcmV0dXJuIFtcbiAgICAodW5peCA/PyBEYXRlLm5vdygpKSAvIDg2NDAwMDAwXG4gICAgKyAoem9uZSA9IHpvbmUgPz8gKDEwIC0gTWF0aC5yb3VuZChcbiAgICAgICAgKG5ldyBEYXRlKS5nZXRUaW1lem9uZU9mZnNldCgpIC8gMTQ0KSkgJSAxMFxuICAgICAgKSAvIDEwICsgb2Zmc2V0LCB6b25lXVxufVxuZnVuY3Rpb24gZG90ZTJkYXRlKGRvdGUsIHpvbmUgPSAwKSB7XG4gIGNvbnN0IGNvdGUgPSBNYXRoLmZsb29yKChcbiAgICAgIGRvdGUgPj0gMCA/IGRvdGVcbiAgICAgIDogZG90ZSAtIDE0NjA5NlxuICAgICkgLyAxNDYwOTcpLFxuICBkb3RjID0gZG90ZSAtIGNvdGUgKiAxNDYwOTcsXG4gIHlvdGMgPSBNYXRoLmZsb29yKChkb3RjXG4gICAgLSBNYXRoLmZsb29yKGRvdGMgLyAxNDYwKVxuICAgICsgTWF0aC5mbG9vcihkb3RjIC8gMzY1MjQpXG4gICAgLSBNYXRoLmZsb29yKGRvdGMgLyAxNDYwOTYpXG4gICkgLyAzNjUpO1xuICByZXR1cm4gW1xuICAgIHlvdGMgKyBjb3RlICogNDAwLFxuICAgIGRvdGMgLSAoeW90YyAqIDM2NVxuICAgICAgKyBNYXRoLmZsb29yKHlvdGMgLyA0KVxuICAgICAgLSBNYXRoLmZsb29yKHlvdGMgLyAxMDApXG4gICksIHpvbmVdfVxuZHogPSB1bml4MmRvdGUodW5peClcbnlkeiA9IGRvdGUyZGF0ZSguLi5keilcbmRlY1llYXIgPSB5ZHpbMF0udG9TdHJpbmcoKS5wYWRTdGFydCg0LCBcIjBcIilcbmRlY0RhdGUgPSBNYXRoLmZsb29yKHlkelsxXSkudG9TdHJpbmcoKS5wYWRTdGFydCgzLCBcIjBcIilcbmJyb3dzZXJEb3RlID0gdW5peDJkb3RlKHVuaXgpXG5icm93c2VyVGltZSA9IGJyb3dzZXJEb3RlWzBdICUgMSAqIDEwXG5icm93c2VyWm9uZSA9IGJyb3dzZXJEb3RlWzFdXG5icm93c2VyU2lnbiA9IGJyb3dzZXJab25lID4gMCA/IFwiLVwiIDogXCIrXCJcbnpvbmUwdGltZSA9IChicm93c2VyVGltZSAtIGJyb3dzZXJab25lICsgMTApICUgMTBcbmhvdXJzID0gYnJvd3NlclRpbWUgKiAyLjRcbm1pbnV0ZXMgPSBob3VycyAlIDEgKiA2MFxuc2Vjb25kcyA9IG1pbnV0ZXMgJSAxICogNjBcbnNlbGVjdGVkRG90ZSA9IHVuaXgyZG90ZSh1bml4LCBsb25nMnpvbmUobG9jYXRpb25bMF0pKVxuc2VsZWN0ZWRFeGFjdCA9IHNlbGVjdGVkRG90ZVswXSAlIDFcbnNlbGVjdGVkRXhhY3ROID0gKDEgLSBzZWxlY3RlZEV4YWN0KSAlIDFcbnNlbGVjdGVkWm9uZSA9IHNlbGVjdGVkRG90ZVsxXVxuZGVjVGltZSA9IChzZWxlY3RlZEV4YWN0ICogMTApLnRvRml4ZWQoNClcbmRlY1RpbWVOID0gKHNlbGVjdGVkRXhhY3ROICogMTApLnRvRml4ZWQoNClcbmJhckREID0gZGVjVGltZVswXVxuYmFyREROID0gZGVjVGltZU5bMF1cbmJhck1pbHMgPSBkZWNUaW1lLnNsaWNlKDIsIDQpXG5iYXJNaWxzTiA9IGRlY1RpbWVOLnNsaWNlKDIsIDQpXG5iYXJCZWF0cyA9IGRlY1RpbWUuc2xpY2UoNCwgNilcbmJhckJlYXRzTiA9IGRlY1RpbWVOLnNsaWNlKDQsIDYpXG5mdW5jdGlvbiBsYXRpMnR1cm4xKGRlZ3JlZXMgPSAtMTgwLCBlID0gMykge1xuICAvLyB0dXJuczogZT0wLCBkZWNpdHVybnM6IGU9MSwgZXRjLlxuICByZXR1cm4gKGRlZ3JlZXMgJT0gMzYwKSAvICgzNjAgLyAxMCoqZSkgJSAxMCoqZTtcbn1cbmdyYXRpY3VsZSA9IGQzLmdlb0dyYXRpY3VsZSgpLnN0ZXBNaW5vcihbMzYsMzZdKS5zdGVwTWFqb3IoWzM2LDM2XSkoKVxuZ3JhdGljdWxlLmNvb3JkaW5hdGVzID0gZ3JhdGljdWxlLmNvb3JkaW5hdGVzLm1hcChcbiAgaSA9PiBpLm1hcChqID0+IGoubWFwKChrLCBpbmRleCwgYXJyKSA9PiBpLmxlbmd0aCA9PT0gMyAmJiBpbmRleCA9PT0gMCA/IGsgLSAxOCA6IGspKVxuKVxuZnVuY3Rpb24gbG9uZzJ0dXJuKGRlZ3JlZXMgPSAtMTgwLCBlID0gMykge1xuICAvLyB0dXJuczogZT0wLCBkZWNpdHVybnM6IGU9MSwgZXRjLlxuICByZXR1cm4gKCgoZGVncmVlcyAlPSAzNjApIDwgMCA/IGRlZ3JlZXMgKyAzNjAgOiBkZWdyZWVzKSArIDE4KSAvICgzNjAgLyAxMCoqZSkgJSAxMCoqZTtcbn1cbi8vIGh0dHBzOi8vZ2l0aHViLmNvbS90b3BvanNvbi93b3JsZC1hdGxhc1xud29ybGQgPSBkMy5qc29uKFwiaHR0cHM6Ly9jZG4uanNkZWxpdnIubmV0L25wbS93b3JsZC1hdGxhc0AyL2NvdW50cmllcy0xMTBtLmpzb25cIilcbmNvdW50cmllcyA9IHRvcG9qc29uLmZlYXR1cmUod29ybGQsIHdvcmxkLm9iamVjdHMuY291bnRyaWVzKVxudG9wb2pzb24gPSByZXF1aXJlKFwidG9wb2pzb24tY2xpZW50QDNcIilcbmZ1bmN0aW9uIGxvbmcyem9uZShkZWdyZWVzID0gLTE4MCkge1xuICByZXR1cm4gTWF0aC5mbG9vcihsb25nMnR1cm4oZGVncmVlcywgMSkpO1xufVxuZnVuY3Rpb24geWVhcjJsZWFwKHllYXIgPSAxOTcwKSB7XG4gICAgcmV0dXJuIHllYXIgJSA0ID09IDAgJiYgeWVhciAlIDEwMCAhPSAwIHx8IHllYXIgJSA0MDAgPT0gMDtcbn1cbi8vIGh0dHBzOi8vb2JzZXJ2YWJsZWhxLmNvbS9AZGJyaWRnZXMvdmlzdWFsaXppbmctc2Vhc29uYWwtZGF5bGlnaHRcbnNvbGFyU3lzdGVtID0gKHJvb3QsIHdpZHRoLCBsb2NhdGlvbiwgZGF0ZSwgaG91cikgPT4ge1xuICBjb25zdCBlYXJ0aFJhZGl1cyA9IDAuMDQgKiB3aWR0aDtcbiAgY29uc3Qgc3VuUmFkaXVzID0gMC4wOCAqIHdpZHRoO1xuICBjb25zdCBzb2xhclN5c3RlbVJhZGl1cyA9IHdpZHRoIC8gMiAtIDIwO1xuICBjb25zdCBzdHJldGNoID0gMC4zO1xuICBjb25zdCBzb2xhckFuZ2xlID0gZ2V0U29sYXJBbmdsZShkYXRlKTtcbiAgY29uc3Qgc29sYXJBbmdsZURlZyA9IChzb2xhckFuZ2xlICogMTgwKSAvIE1hdGguUEk7XG4gIGNvbnN0IHggPSBzb2xhclN5c3RlbVJhZGl1cyAqIE1hdGguc2luKHNvbGFyQW5nbGUpO1xuICBjb25zdCB5ID0gc3RyZXRjaCAqIHNvbGFyU3lzdGVtUmFkaXVzICogTWF0aC5jb3Moc29sYXJBbmdsZSk7XG4gIGNvbnN0IHNwaW4gPSAxODAgKyAtbG9jYXRpb25bMF0gKyBzb2xhckFuZ2xlRGVnICsgMzYwICogKChob3VyICsgMTIpIC8gMjQpO1xuICBjb25zdCBlYXJ0aEdlbyA9IHsgdHlwZTogXCJTcGhlcmVcIiB9O1xuICBjb25zdCBwcm9qZWN0aW9uID0gZDNcbiAgICAuZ2VvT3J0aG9ncmFwaGljKClcbiAgICAuZml0V2lkdGgoZWFydGhSYWRpdXMgKiAyLCBlYXJ0aEdlbylcbiAgICAucm90YXRlKFtzcGluLCAwLCAyMy41XSlcbiAgICAudHJhbnNsYXRlKFswLCAwXSk7XG4gIGNvbnN0IHN0YXRpY1Byb2plY3Rpb24gPSBkM1xuICAgIC5nZW9PcnRob2dyYXBoaWMoKVxuICAgIC5maXRXaWR0aChlYXJ0aFJhZGl1cyAqIDIsIGVhcnRoR2VvKVxuICAgIC5yb3RhdGUoW3NvbGFyQW5nbGVEZWcgLSA5MCwgMF0pXG4gICAgLnRyYW5zbGF0ZShbMCwgMF0pO1xuICBjb25zdCBwYXRoID0gZDMuZ2VvUGF0aChwcm9qZWN0aW9uKS5wb2ludFJhZGl1cygxLjUpO1xuICBjb25zdCBzdGF0aWNQYXRoID0gZDMuZ2VvUGF0aChzdGF0aWNQcm9qZWN0aW9uKTtcbiAgY29uc3Qgc29sYXJTeXN0ZW0gPSByb290XG4gICAgLmFwcGVuZChcImdcIilcbiAgICAuYXR0cihcInRyYW5zZm9ybVwiLCBgdHJhbnNsYXRlKCR7d2lkdGggLyAyfSlgKTtcbiAgc29sYXJTeXN0ZW0uYXBwZW5kKFwiY2lyY2xlXCIpLmF0dHIoXCJyXCIsIHN1blJhZGl1cykuYXR0cihcImZpbGxcIiwgY29sb3JzLnN1bik7XG4gIC8qIERyYXcgb3JiaXQgKi9cbiAgc29sYXJTeXN0ZW1cbiAgICAuYXBwZW5kKFwiZWxsaXBzZVwiKVxuICAgIC5hdHRyKFwicnhcIiwgc29sYXJTeXN0ZW1SYWRpdXMpXG4gICAgLmF0dHIoXCJyeVwiLCBzdHJldGNoICogc29sYXJTeXN0ZW1SYWRpdXMpXG4gICAgLmF0dHIoXCJmaWxsXCIsIFwibm9uZVwiKVxuICAgIC5hdHRyKFwic3Ryb2tlXCIsIFwiYmxhY2tcIik7XG4gIC8qIERyYXcgbW9udGggdGlja3MgKi9cbiAgZDMucmFuZ2UoMTIpLm1hcCgobSkgPT4ge1xuICAgIGNvbnN0IGQgPSBuZXcgRGF0ZShkYXRlLmdldEZ1bGxZZWFyKCksIG0sIDEpO1xuICAgIGNvbnN0IGFuZ2xlID0gZ2V0U29sYXJBbmdsZShkKTtcbiAgICBzb2xhclN5c3RlbVxuICAgICAgLmFwcGVuZChcImxpbmVcIilcbiAgICAgIC5hdHRyKFwieDFcIiwgKHNvbGFyU3lzdGVtUmFkaXVzICsgNikgKiBNYXRoLnNpbihhbmdsZSkpXG4gICAgICAuYXR0cihcInkxXCIsIChzb2xhclN5c3RlbVJhZGl1cyArIDYpICogc3RyZXRjaCAqIE1hdGguY29zKGFuZ2xlKSlcbiAgICAgIC5hdHRyKFwieDJcIiwgKHNvbGFyU3lzdGVtUmFkaXVzIC0gNikgKiBNYXRoLnNpbihhbmdsZSkpXG4gICAgICAuYXR0cihcInkyXCIsIChzb2xhclN5c3RlbVJhZGl1cyAtIDYpICogc3RyZXRjaCAqIE1hdGguY29zKGFuZ2xlKSlcbiAgICAgIC5hdHRyKFwic3Ryb2tlXCIsIFwiYmxhY2tcIik7XG4gICAgY29uc3Qgc3RhcnRNb250aEFuZ2xlID0gZ2V0U29sYXJBbmdsZShuZXcgRGF0ZShkYXRlLmdldEZ1bGxZZWFyKCksIG0sIDEpKTtcbiAgICBzb2xhclN5c3RlbVxuICAgICAgLmFwcGVuZChcInRleHRcIilcbiAgICAgIC50ZXh0KGRhdGUyZG90eShkKSlcbiAgICAgIC5hdHRyKFwieFwiLCAoc29sYXJTeXN0ZW1SYWRpdXMgKyAxOCkgKiBNYXRoLnNpbihzdGFydE1vbnRoQW5nbGUpKVxuICAgICAgLmF0dHIoXG4gICAgICAgIFwieVwiLFxuICAgICAgICAoc29sYXJTeXN0ZW1SYWRpdXMgKyAxOCkgKiAxLjE4ICogc3RyZXRjaCAqIE1hdGguY29zKHN0YXJ0TW9udGhBbmdsZSlcbiAgICAgIClcbiAgICAgIC5hdHRyKFwidGV4dC1hbmNob3JcIiwgXCJtaWRkbGVcIilcbiAgICAgIC5hdHRyKFwiZm9udC1zaXplXCIsIGZvbnRTaXplICogKHdpZHRoIDwgMTY1ID8gLjkgOiB3aWR0aCA8IDI2NSA/IDEgOiB3aWR0aCA8IDM2NSA/IDEuMSA6IDEuMikpXG4gICAgICAuYXR0cihcImRvbWluYW50LWJhc2VsaW5lXCIsIFwibWlkZGxlXCIpXG4gICAgICAuYXR0cihcImZvbnQtc2l6ZVwiLCBmb250U2l6ZSAqICh3aWR0aCA8IDE2NSA/IC45IDogd2lkdGggPCAyNjUgPyAxIDogd2lkdGggPCAzNjUgPyAxLjEgOiAxLjIpKVxuICAgICAgLmF0dHIoXCJmb250LWZhbWlseVwiLCBcInNhbnMtc2VyaWZcIilcbiAgICAgIC5hdHRyKFwiZmlsbFwiLCBcImJsYWNrXCIpO1xuICB9KTtcbiAgY29uc3QgZWFydGggPSBzb2xhclN5c3RlbVxuICAgIC5hcHBlbmQoXCJnXCIpXG4gICAgLmF0dHIoXCJ0cmFuc2Zvcm1cIiwgYHRyYW5zbGF0ZSgke3h9LCAke3l9KWApO1xuICBlYXJ0aFxuICAgIC5hcHBlbmQoXCJsaW5lXCIpXG4gICAgLmF0dHIoXCJ5MVwiLCAtMS41ICogZWFydGhSYWRpdXMpXG4gICAgLmF0dHIoXCJ5MlwiLCAxLjUgKiBlYXJ0aFJhZGl1cylcbiAgICAuYXR0cihcInN0cm9rZVwiLCBcImJsdWVcIilcbiAgICAuYXR0cihcInRyYW5zZm9ybVwiLCBgcm90YXRlKC0yMy41KWApO1xuICBlYXJ0aC5hcHBlbmQoXCJwYXRoXCIpLmF0dHIoXCJkXCIsIHBhdGgoZWFydGhHZW8pKS5hdHRyKFwiZmlsbFwiLCBjb2xvcnMub2NlYW4pO1xuICBlYXJ0aC5hcHBlbmQoXCJwYXRoXCIpLmF0dHIoXCJkXCIsIHBhdGgobGFuZCkpLmF0dHIoXCJmaWxsXCIsIGNvbG9ycy5sYW5kKTtcbiAgZWFydGguYXBwZW5kKFwicGF0aFwiKVxuICAuYXR0cihcImRcIiwgcGF0aChjb3VudHJpZXMpKVxuICAuYXR0cihcInN0cm9rZS13aWR0aFwiLCBcIi4wNzVcIilcbiAgLmF0dHIoXCJmaWxsXCIsIFwibm9uZVwiKVxuICAuYXR0cihcInN0cm9rZVwiLCBcIiM1NTVcIik7XG4gIGNvbnN0IHNoYWRvd1BvbHlnb24gPSBbXG4gICAgWzAsIC05MF0sXG4gICAgWzAsIDBdLFxuICAgIFswLCA5MF0sXG4gICAgWzE4MCwgMF0sXG4gICAgWzAsIC05MF1cbiAgXTtcbiAgZWFydGhcbiAgICAuYXBwZW5kKFwicGF0aFwiKVxuICAgIC5hdHRyKFwiZFwiLCBzdGF0aWNQYXRoKHsgdHlwZTogXCJQb2x5Z29uXCIsIGNvb3JkaW5hdGVzOiBbc2hhZG93UG9seWdvbl0gfSkpXG4gICAgLmF0dHIoXCJmaWxsXCIsIFwicmdiYSgwLCAwLCAwLCAwLjUpXCIpO1xuICBlYXJ0aFxuICAgIC5hcHBlbmQoXCJwYXRoXCIpXG4gICAgLmF0dHIoXCJkXCIsIHBhdGgoeyB0eXBlOiBcIlBvaW50XCIsIGNvb3JkaW5hdGVzOiBsb2NhdGlvbiB9KSlcbiAgICAuYXR0cihcInJcIiwgMTgpXG4gICAgLmF0dHIoXCJzdHJva2Utd2lkdGhcIiwgLjMpXG4gICAgLmF0dHIoXCJzdHJva2VcIiwgXCJibGFja1wiKVxuICAgIC5hdHRyKFwiZmlsbFwiLCBcInJlZFwiKTtcbn1cbmZ1bmN0aW9uIGdyZWcyZG90eShtb250aCA9IDEsIGRheSA9IDEpIHtcbiAgICByZXR1cm4gTWF0aC5mbG9vcihcbiAgICAgICAgKDE1MyAqIChtb250aCA+IDIgPyBtb250aCAtIDMgOiBtb250aCArIDkpICsgMikgLyA1ICsgZGF5IC0gMVxuKX1cbmZ1bmN0aW9uIGRhdGUyZG90eShkYXRlKSB7XG4gIHJldHVybiBncmVnMmRvdHkoZGF0ZS5nZXRNb250aCgpICsgMSwgZGF0ZS5nZXREYXRlKCkpXG59XG5mdW5jdGlvbiBkYXRlMmRvdHkxKGRhdGUpIHtcbiAgY29uc3QgZG90eSA9IGdyZWcyZG90eShkYXRlLmdldE1vbnRoKCkgKyAxLCBkYXRlLmdldERhdGUoKSlcbiAgcmV0dXJuIGRvdHkgPT09IDMxID8gXCJEYXkgXCIgKyBTdHJpbmcoZG90eSkgOiBkb3R5XG59XG4vLyBodHRwczovL29ic2VydmFibGVocS5jb20vQGRicmlkZ2VzL3Zpc3VhbGl6aW5nLXNlYXNvbmFsLWRheWxpZ2h0XG5nbG9iZSA9IChyb290LCB7IHdpZHRoLCBsb2NhdGlvbiwgZGF0ZSwgaG91ciB9KSA9PiB7XG4gIGNvbnN0IHNvbGFyQW5nbGUgPSBnZXRTb2xhckFuZ2xlKGRhdGUpO1xuICBjb25zdCBzb2xhckFuZ2xlRGVnID0gdG9EZWdyZWVzKHNvbGFyQW5nbGUpO1xuICBjb25zdCBob3VyU3BpbiA9IDM2MCAqICgoaG91ciArIDEyKSAvIDI0KTtcbiAgY29uc3Qgc3BpbiA9ICgxODAgKyAtbG9jYXRpb25bMF0gKyBzb2xhckFuZ2xlRGVnICsgaG91clNwaW4pO1xuICBjb25zdCB0aWx0ID0gLTE1O1xuICBjb25zdCBwcm9qZWN0aW9uID0gZDMuZ2VvT3J0aG9ncmFwaGljKClcbiAgICAgICAgICAgICAgICAgICAgICAgLmZpdFdpZHRoKHdpZHRoLCBncmF0aWN1bGUpXG4gICAgICAgICAgICAgICAgICAgICAgIC5yb3RhdGUoW3NwaW4sIHRpbHQsIDIzLjVdKTtcbiAgY29uc3QgcGF0aCA9IGQzLmdlb1BhdGgocHJvamVjdGlvbik7XG4gIGNvbnN0IHVuQ2xpcHBlZFByb2plY3Rpb24gPSBkMy5nZW9PcnRob2dyYXBoaWMoKVxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAuY2xpcEFuZ2xlKG51bGwpXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIC5maXRXaWR0aCh3aWR0aCwgZ3JhdGljdWxlKVxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAucm90YXRlKFtzcGluLCB0aWx0LCAyMy41XSk7XG4gIGNvbnN0IHVuQ2xpcHBlZFBhdGggPSBkMy5nZW9QYXRoKHVuQ2xpcHBlZFByb2plY3Rpb24pO1xuICBjb25zdCBzdGF0aWNQcm9qZWN0aW9uID0gZDMuZ2VvT3J0aG9ncmFwaGljKClcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgLmZpdFdpZHRoKHdpZHRoLCBncmF0aWN1bGUpXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgIC5yb3RhdGUoW3NvbGFyQW5nbGVEZWcgLSA5MCwgdGlsdF0pO1xuICBjb25zdCBzdGF0aWNQYXRoID0gZDMuZ2VvUGF0aChzdGF0aWNQcm9qZWN0aW9uKTtcbiAgY29uc3QgYmFja2dyb3VuZCA9IHJvb3QuYXBwZW5kKFwiZ1wiKTtcbiAgY29uc3QgZWFydGggPSByb290LmFwcGVuZChcImdcIikuc3R5bGUoXCJvcGFjaXR5XCIsIDAuNzUpO1xuICBjb25zdCBmb3JlZ3JvdW5kID0gcm9vdC5hcHBlbmQoXCJnXCIpO1xuICBlYXJ0aC5hcHBlbmQoXCJwYXRoXCIpXG4gICAgLmF0dHIoXCJkXCIsIHBhdGgoe3R5cGU6IFwiU3BoZXJlXCJ9KSlcbiAgICAuYXR0cihcImZpbGxcIiwgY29sb3JzLm9jZWFuKVxuICAgIC5hdHRyKFwic3Ryb2tlXCIsIFwiIzllY2JkYVwiKTtcbiAgZWFydGguYXBwZW5kKFwicGF0aFwiKVxuICAgIC5hdHRyKFwiZFwiLCBwYXRoKGdyYXRpY3VsZSkpXG4gICAgLmF0dHIoXCJzdHJva2Utd2lkdGhcIiwgXCIxXCIpXG4gICAgLmF0dHIoXCJmaWxsXCIsIFwibm9uZVwiKVxuICAgIC5hdHRyKFwic3Ryb2tlXCIsIFwiIzg4OFwiKTtcbiAgZWFydGguYXBwZW5kKFwicGF0aFwiKVxuICAgIC5hdHRyKFwiZFwiLCBwYXRoKGxhbmQpKVxuICAgIC5hdHRyKFwiZmlsbFwiLCBjb2xvcnMubGFuZCk7XG4gIGVhcnRoLmFwcGVuZChcInBhdGhcIilcbiAgICAuYXR0cihcImRcIiwgcGF0aChjb3VudHJpZXMpKVxuICAgIC5hdHRyKFwic3Ryb2tlLXdpZHRoXCIsIFwiMVwiKVxuICAgIC5hdHRyKFwiZmlsbFwiLCBcIm5vbmVcIilcbiAgICAuYXR0cihcInN0cm9rZVwiLCBcIiMwMDBcIik7XG4gIGJhY2tncm91bmQuYXBwZW5kKFwicGF0aFwiKVxuICAgIC5hdHRyKFwiZFwiLCB1bkNsaXBwZWRQYXRoKHt0eXBlOiBcIlBvaW50XCIsIGNvb3JkaW5hdGVzOiBsb2NhdGlvbn0pKVxuICAgIC5hdHRyKFwiZmlsbFwiLCBcInJlZFwiKTtcbiAgY29uc3QgbGF0aXR1ZGVDb29yZHMgPSAobGF0aXR1ZGUsIHN0YXJ0LCBlbmQpID0+IHtcbiAgICBjb25zdCBsb25naXR1ZGVzID0gZDMucmFuZ2Uoc3RhcnQsIGVuZCwgMikuY29uY2F0KGVuZCk7XG4gICAgcmV0dXJuIGxvbmdpdHVkZXMubWFwKGQgPT4gW2QsIGxhdGl0dWRlXSk7XG4gIH1cbiAgY29uc3QgY29ycmVjdFNwaW4gPSBkMy5nZW9Sb3RhdGlvbihbLWhvdXJTcGluLCAwXSk7XG4gIGNvbnN0IGNvcnJlY3RUaWx0ID0gZDMuZ2VvUm90YXRpb24oWzYsIDAsIDBdKTtcbiAgLyogdG90YWwgYW5ndWxhciBleHRlbnQgb2YgZGF5L25pZ2h0ICovXG4gIGNvbnN0IGRheUV4dGVudCA9IDM2MCAqIGRheUxlbmd0aChkYXRlLCBsb2NhdGlvblsxXSkgLyAyNDtcbiAgY29uc3QgbmlnaHRFeHRlbnQgPSAzNjAgLSBkYXlFeHRlbnQ7XG4gIGNvbnN0IGRheUxpbmUgPSB7XG4gICAgdHlwZTogXCJMaW5lU3RyaW5nXCIsXG4gICAgY29vcmRpbmF0ZXM6IGxhdGl0dWRlQ29vcmRzKGxvY2F0aW9uWzFdLFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBsb2NhdGlvblswXSAtIGRheUV4dGVudCAvIDIsXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGxvY2F0aW9uWzBdICsgZGF5RXh0ZW50IC8gMikubWFwKGQgPT4gY29ycmVjdFNwaW4oZCkpXG4gIH07XG4gIGNvbnN0IG5pZ2h0TGluZSA9IHtcbiAgICB0eXBlOiBcIkxpbmVTdHJpbmdcIixcbiAgICBjb29yZGluYXRlczogbGF0aXR1ZGVDb29yZHMobG9jYXRpb25bMV0sXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGxvY2F0aW9uWzBdIC0gZGF5RXh0ZW50IC8gMiAtIG5pZ2h0RXh0ZW50LFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBsb2NhdGlvblswXSAtIGRheUV4dGVudCAvIDIpLm1hcChkID0+IGNvcnJlY3RTcGluKGQpKVxuICB9O1xuICBiYWNrZ3JvdW5kLmFwcGVuZChcInBhdGhcIilcbiAgICAuYXR0cihcImRcIiwgdW5DbGlwcGVkUGF0aChkYXlMaW5lKSlcbiAgICAuYXR0cihcImZpbGxcIiwgXCJub25lXCIpXG4gICAgLmF0dHIoXCJzdHJva2VcIiwgY29sb3JzLmRheSlcbiAgICAuYXR0cihcInN0cm9rZS13aWR0aFwiLCAzKTtcbiAgYmFja2dyb3VuZC5hcHBlbmQoXCJwYXRoXCIpXG4gICAgLmF0dHIoXCJkXCIsIHVuQ2xpcHBlZFBhdGgobmlnaHRMaW5lKSlcbiAgICAuYXR0cihcImZpbGxcIiwgXCJub25lXCIpXG4gICAgLmF0dHIoXCJzdHJva2VcIiwgY29sb3JzLm5pZ2h0KVxuICAgIC5hdHRyKFwic3Ryb2tlLXdpZHRoXCIsIDMpO1xuICBmb3JlZ3JvdW5kLmFwcGVuZChcInBhdGhcIilcbiAgICAuYXR0cihcImRcIiwgcGF0aChkYXlMaW5lKSlcbiAgICAuYXR0cihcImZpbGxcIiwgXCJub25lXCIpXG4gICAgLmF0dHIoXCJzdHJva2VcIiwgY29sb3JzLmRheSlcbiAgICAuYXR0cihcInN0cm9rZS13aWR0aFwiLCAzKTtcbiAgZm9yZWdyb3VuZC5hcHBlbmQoXCJwYXRoXCIpXG4gICAgLmF0dHIoXCJkXCIsIHBhdGgobmlnaHRMaW5lKSlcbiAgICAuYXR0cihcImZpbGxcIiwgXCJub25lXCIpXG4gICAgLmF0dHIoXCJzdHJva2VcIiwgY29sb3JzLm5pZ2h0KVxuICAgIC5hdHRyKFwic3Ryb2tlLXdpZHRoXCIsIDMpO1xuICBmb3JlZ3JvdW5kLmFwcGVuZChcInBhdGhcIilcbiAgICAuYXR0cihcImRcIiwgcGF0aCh7dHlwZTogXCJQb2ludFwiLCBjb29yZGluYXRlczogbG9jYXRpb259KSlcbiAgICAuYXR0cihcInN0cm9rZS13aWR0aFwiLCAuNSlcbiAgICAuYXR0cihcInN0cm9rZVwiLCBcImJsYWNrXCIpXG4gICAgLmF0dHIoXCJmaWxsXCIsIFwicmVkXCIpO1xuICBjb25zdCBzaGFkb3dQb2x5Z29uID0gW1swLCAtOTBdLCBbMCwgMF0sIFswLCA5MF0sIFsxODAsIDBdLCBbMCwgLTkwXV0ubWFwKGQgPT4gY29ycmVjdFRpbHQoZCkpO1xuICBmb3JlZ3JvdW5kLmFwcGVuZChcInBhdGhcIilcbiAgICAuYXR0cihcImRcIiwgc3RhdGljUGF0aCh7dHlwZTogXCJQb2x5Z29uXCIsIGNvb3JkaW5hdGVzOiBbc2hhZG93UG9seWdvbl19KSlcbiAgICAuYXR0cihcImZpbGxcIiwgXCJyZ2JhKDAsIDAsIDAsIDAuMjUpXCIpO1xufVxuZGF5T2ZZZWFyID0gKGRhdGUpID0+IHtcbiAgY29uc3QgeWVhclN0YXJ0ID0gbmV3IERhdGUoZGF0ZS5nZXRGdWxsWWVhcigpLCAwLCAxKzYwKTtcbiAgcmV0dXJuIE1hdGguZmxvb3IoKGRhdGUuZ2V0VGltZSgpIC0geWVhclN0YXJ0LmdldFRpbWUoKSkvODY0MDAwMDApICsgMVxufVxuLy8gaHR0cHM6Ly9vYnNlcnZhYmxlaHEuY29tL0BkYnJpZGdlcy92aXN1YWxpemluZy1zZWFzb25hbC1kYXlsaWdodFxuZGF5bGlnaHRQbG90ID0gKFxuICByb290LFxuICB7IHdpZHRoLCBoZWlnaHQsIHllYXIsIGxhdGl0dWRlLCBkZWZhdWx0RGF0ZSwgZGVmYXVsdEhvdXIgfVxuKSA9PiB7XG4gIGNvbnN0IG1hcmdpbiA9IHsgdG9wOiAyNCwgYm90dG9tOiAzMiwgbGVmdDogNDgsIHJpZ2h0OiAwIH07XG4gIGNvbnN0IGNoYXJ0V2lkdGggPSB3aWR0aCAtIG1hcmdpbi5sZWZ0IC0gbWFyZ2luLnJpZ2h0O1xuICBjb25zdCBjaGFydEhlaWdodCA9IGhlaWdodCAtIG1hcmdpbi50b3AgLSBtYXJnaW4uYm90dG9tO1xuICBjb25zdCB4VGlja1ZhbHVlcyA9XG4gICAgd2lkdGggPiAyODAgPyBbMywgNiwgOSwgMTIsIDE1LCAxOCwgMjFdIDogd2lkdGggPiAxNDAgPyBbNiwgMTIsIDE4XSA6IFsxMl07XG4gIGNvbnN0IHhTY2FsZSA9IGQzXG4gICAgLnNjYWxlTGluZWFyKClcbiAgICAuZG9tYWluKFswLCAyNF0pXG4gICAgLnJhbmdlKFttYXJnaW4ubGVmdCwgbWFyZ2luLmxlZnQgKyBjaGFydFdpZHRoXSlcbiAgICAuY2xhbXAodHJ1ZSk7XG4gIC8vIHktYXhpcyBzY2FsZVxuICBjb25zdCB5U2NhbGUgPSBkM1xuICAgIC5zY2FsZVRpbWUoKVxuICAgIC5kb21haW4oW25ldyBEYXRlKHllYXIsIDAsIDErNjApLCBuZXcgRGF0ZSh5ZWFyLCAxMSwgMzErNjApXSlcbiAgICAucmFuZ2UoW21hcmdpbi50b3AsIG1hcmdpbi50b3AgKyBjaGFydEhlaWdodF0pXG4gICAgLmNsYW1wKHRydWUpO1xuICAvLyB5LWF4aXMgbGFiZWxzXG4gIGNvbnN0IHlBeGlzID0gZDNcbiAgICAuYXhpc0xlZnQoeVNjYWxlKVxuICAgIC50aWNrVmFsdWVzKGQzLnRpbWVNb250aC5yYW5nZShuZXcgRGF0ZSh5ZWFyLCAwLCAxKzYwKSwgbmV3IERhdGUoeWVhciwgMTIsIDErNTcpKSlcbiAgICAudGlja1NpemUoY2hhcnRXaWR0aClcbiAgICAudGlja0Zvcm1hdChkYXRlMmRvdHkxKTtcbiAgY29uc3QgeEF4aXMgPSBkM1xuICAgIC5heGlzQm90dG9tKHhTY2FsZSlcbiAgICAudGlja1ZhbHVlcyh4VGlja1ZhbHVlcylcbiAgICAudGlja1NpemUoY2hhcnRIZWlnaHQpXG4gICAgLnRpY2tGb3JtYXQoKGQpID0+IHtcbiAgICAgIHJldHVybiBgJHtkIC8gLjAyNH1gO1xuICAgIH0pO1xuICBsZXQgZGF0ZSA9IGRlZmF1bHREYXRlIHx8IG5ldyBEYXRlKCk7XG4gIGxldCBob3VyID0gZGVmYXVsdEhvdXIgIT0gbnVsbCA/IGRlZmF1bHRIb3VyIDogZGF0ZS5nZXRIb3VycygpO1xuICBjb25zdCBoYW5kbGVNb3VzZU1vdmUgPSAoZSkgPT4ge307XG4gIHJvb3RcbiAgICAuYXBwZW5kKFwicmVjdFwiKVxuICAgIC5hdHRyKFwieFwiLCBtYXJnaW4ubGVmdClcbiAgICAuYXR0cihcInlcIiwgbWFyZ2luLnRvcClcbiAgICAuYXR0cihcIndpZHRoXCIsIGNoYXJ0V2lkdGgpXG4gICAgLmF0dHIoXCJoZWlnaHRcIiwgY2hhcnRIZWlnaHQpXG4gICAgLmF0dHIoXCJyeFwiLCAwLjA1ICogd2lkdGgpXG4gICAgLmF0dHIoXCJmaWxsXCIsIGNvbG9ycy5uaWdodCk7XG4gIHJvb3RcbiAgICAuYXBwZW5kKFwiZ1wiKVxuICAgIC5hdHRyKFwidHJhbnNmb3JtXCIsIGB0cmFuc2xhdGUoJHttYXJnaW4ubGVmdCArIGNoYXJ0V2lkdGh9LCAwKWApXG4gICAgLmNhbGwoeUF4aXMpXG4gICAgLmNhbGwoKGcpID0+IGcuc2VsZWN0KFwiLmRvbWFpblwiKS5yZW1vdmUoKSlcbiAgICAuY2FsbCgoZykgPT4gZy5zZWxlY3RBbGwoXCIudGlja1wiKS5hdHRyKFwiY29sb3JcIiwgY29sb3JzLmdyaWQpKVxuICAgIC5jYWxsKChnKSA9PiBnLnNlbGVjdEFsbChcIi50aWNrIHRleHRcIikuYXR0cihcImZvbnQtc2l6ZVwiLCBmb250U2l6ZSAqICh3aWR0aCA8IDE2NSA/IC43IDogd2lkdGggPCAyNjUgPyAuOSA6IHdpZHRoIDwgMzY1ID8gMS4zIDogMS40KSkpXG4gICAgLmNhbGwoKGcpID0+IGcuc2VsZWN0QWxsKFwiLnRpY2sgdGV4dFwiKS5hdHRyKFwiY29sb3JcIiwgXCJibGFja1wiKSlcbiAgICAuY2FsbCgoZykgPT4gZy5zZWxlY3RBbGwoXCIudGljayBsaW5lXCIpLmF0dHIoXCJzdHJva2UtZGFzaGFycmF5XCIsIFwiNSAzXCIpKTtcbiAgcm9vdFxuICAgIC5hcHBlbmQoXCJnXCIpXG4gICAgLmF0dHIoXCJ0cmFuc2Zvcm1cIiwgYHRyYW5zbGF0ZSgwLCAke21hcmdpbi50b3B9KWApXG4gICAgLmNhbGwoeEF4aXMpXG4gICAgLmNhbGwoKGcpID0+IGcuc2VsZWN0KFwiLmRvbWFpblwiKS5yZW1vdmUoKSlcbiAgICAuY2FsbCgoZykgPT4gZy5zZWxlY3RBbGwoXCIudGlja1wiKS5hdHRyKFwiY29sb3JcIiwgY29sb3JzLmdyaWQpKVxuICAgIC5jYWxsKChnKSA9PiBnLnNlbGVjdEFsbChcIi50aWNrIHRleHRcIikuYXR0cihcImZvbnQtc2l6ZVwiLCBmb250U2l6ZSAqICh3aWR0aCA8IDE2NSA/IC45IDogd2lkdGggPCAyNjUgPyAxLjEgOiB3aWR0aCA8IDM2NSA/IDEuMiA6IDEuMykpKVxuICAgIC5jYWxsKChnKSA9PiBnLnNlbGVjdEFsbChcIi50aWNrIHRleHRcIikuYXR0cihcImNvbG9yXCIsIFwiYmxhY2tcIikpXG4gICAgLmNhbGwoKGcpID0+IGcuc2VsZWN0QWxsKFwiLnRpY2sgbGluZVwiKS5hdHRyKFwic3Ryb2tlLWRhc2hhcnJheVwiLCBcIjUgM1wiKSk7XG4gIHJvb3RcbiAgICAuYXBwZW5kKFwidGV4dFwiKVxuICAgIC50ZXh0KFwiVGltZSBvZiBkYXkgKG1pbGxpZGF5cylcIilcbiAgICAuYXR0cihcInhcIiwgbWFyZ2luLmxlZnQgKyBjaGFydFdpZHRoIC8gMilcbiAgICAuYXR0cihcInlcIiwgbWFyZ2luLnRvcCArIGNoYXJ0SGVpZ2h0ICsgbWFyZ2luLmJvdHRvbSAtICh3aWR0aCA8IDE2NSA/IDkgOiB3aWR0aCA8IDI2NSA/IDYgOiB3aWR0aCA8IDM2NSA/IDIgOiAwKSlcbiAgICAuYXR0cihcInRleHQtYW5jaG9yXCIsIFwibWlkZGxlXCIpXG4gICAgLmF0dHIoXCJmb250LXNpemVcIiwgZm9udFNpemUgKiAod2lkdGggPCAxNjUgPyAuODUgOiB3aWR0aCA8IDI2NSA/IDEuMTUgOiB3aWR0aCA8IDM2NSA/IDEuNSA6IDEuNikpXG4gICAgLmF0dHIoXCJmb250LWZhbWlseVwiLCBcInNhbnMtc2VyaWZcIilcbiAgICAuYXR0cihcImZpbGxcIiwgXCJibGFja1wiKTtcbiAgY29uc3QgZGF0YSA9IHllYXJEYXRlcyh5ZWFyKVxuICAgIC5tYXAoKGQpID0+IFtkLCBkYXlMZW5ndGgoZCwgbGF0aXR1ZGUpXSlcbiAgICAuZmlsdGVyKChbXywgZF0pID0+IGQgPiAwKTtcbiAgLyogUmVuZGVyIHNlcGFyYXRlIHBvbHlnb25zIGZvciBlYWNoIGNvbnRpbnVvdXMgc2VxdWVuY2Ugb2ZcbiAgICogZGF5cyB3aXRoIG1vcmUgdGhhbiAwIGhvdXJzIG9mIGRheSBsaWdodFxuICAgKi9cbiAgY29uc3QgcG9seXMgPSBbXTtcbiAgbGV0IGN1cnJlbnRQb2x5ID0gW107XG4gIGZvciAobGV0IGkgPSAwOyBpIDwgZGF0YS5sZW5ndGg7IGkrKykge1xuICAgIGNvbnN0IGN1cnJlbnREYXRlID0gZGF0YVtpXVswXTtcbiAgICBjb25zdCBwcmV2RGF0ZSA9IChkYXRhW2kgLSAxXSB8fCBbXSlbMF07XG4gICAgaWYgKFxuICAgICAgaSA9PT0gMCB8fFxuICAgICAgY3VycmVudERhdGUuZ2V0VGltZSgpIC0gcHJldkRhdGUuZ2V0VGltZSgpIDwgMzYwMCAqIDI0ICogMTAwMCAqIDEuNVxuICAgICkge1xuICAgICAgY3VycmVudFBvbHkucHVzaChkYXRhW2ldKTtcbiAgICB9IGVsc2Uge1xuICAgICAgcG9seXMucHVzaChjdXJyZW50UG9seSk7XG4gICAgICBjdXJyZW50UG9seSA9IFtkYXRhW2ldXTtcbiAgICB9XG4gIH1cbiAgcG9seXMucHVzaChjdXJyZW50UG9seSk7XG4gIHBvbHlzLmZvckVhY2goKHApID0+IHtcbiAgICBjb25zdCBwb2ludHMgPSBbXG4gICAgICAuLi5wLm1hcCgoW2QsIGxdKSA9PiBgJHt4U2NhbGUoMTIgLSBsIC8gMil9LCR7eVNjYWxlKGQpfWApLFxuICAgICAgLi4ucC5yZXZlcnNlKCkubWFwKChbZCwgbF0pID0+IGAke3hTY2FsZSgxMiArIGwgLyAyKX0sJHt5U2NhbGUoZCl9YClcbiAgICBdLmpvaW4oXCIgXCIpO1xuICAgIHJvb3QuYXBwZW5kKFwicG9seWdvblwiKS5hdHRyKFwicG9pbnRzXCIsIHBvaW50cykuYXR0cihcImZpbGxcIiwgY29sb3JzLmRheSk7XG4gIH0pO1xuICAvKiBMZWdlbmQgKi9cbiAgY29uc3QgbGVnZW5kID0gcm9vdFxuICAgIC5hcHBlbmQoXCJnXCIpXG4gICAgLmF0dHIoXCJ0cmFuc2Zvcm1cIiwgYHRyYW5zbGF0ZSgke21hcmdpbi5sZWZ0ICsgY2hhcnRXaWR0aCAvIDIgLSA2NH0pYCk7XG4gIGxlZ2VuZFxuICAgIC5hcHBlbmQoXCJyZWN0XCIpXG4gICAgLmF0dHIoXCJyeFwiLCA1KVxuICAgIC5hdHRyKFwieFwiLCAtMzQgKyA0ICogKHdpZHRoIDwgMTY1ID8gMTIuNyA6IHdpZHRoIDwgMjY1ID8gNS41IDogd2lkdGggPCAzNjUgPyAzIDogMCkpXG4gICAgLmF0dHIoXCJ5XCIsIDQuNSAqICh3aWR0aCA8IDE2NSA/IDEuOSA6IHdpZHRoIDwgMjY1ID8gMS40IDogd2lkdGggPCAzNjUgPyAuOSA6IC44KSlcbiAgICAuYXR0cihcIndpZHRoXCIsIGZvbnRTaXplICogKHdpZHRoIDwgMTY1ID8gMSA6IHdpZHRoIDwgMjY1ID8gMS4yIDogd2lkdGggPCAzNjUgPyAxLjQgOiAxLjYpKVxuICAgIC5hdHRyKFwiaGVpZ2h0XCIsIGZvbnRTaXplICogKHdpZHRoIDwgMTY1ID8gMSA6IHdpZHRoIDwgMjY1ID8gMS4yIDogd2lkdGggPCAzNjUgPyAxLjQgOiAxLjYpKVxuICAgIC5hdHRyKFwiZmlsbFwiLCBjb2xvcnMubmlnaHQpO1xuICBsZWdlbmRcbiAgICAuYXBwZW5kKFwidGV4dFwiKVxuICAgIC5hdHRyKFwieFwiLCAtMTYgKyA0ICogKHdpZHRoIDwgMTY1ID8gMTEuOCA6IHdpZHRoIDwgMjY1ID8gNC45IDogd2lkdGggPCAzNjUgPyAyLjggOiAwKSlcbiAgICAuYXR0cihcInlcIiwgMTkpXG4gICAgLmF0dHIoXCJmb250LXNpemVcIiwgZm9udFNpemUgKiAod2lkdGggPCAxNjUgPyAxIDogd2lkdGggPCAyNjUgPyAxLjIgOiB3aWR0aCA8IDM2NSA/IDEuNCA6IDEuNikpXG4gICAgLmF0dHIoXCJmb250LWZhbWlseVwiLCBcInNhbnMtc2VyaWZcIilcbiAgICAudGV4dChcIk5pZ2h0XCIpO1xuICBsZWdlbmRcbiAgICAuYXBwZW5kKFwicmVjdFwiKVxuICAgIC5hdHRyKFwieFwiLCAzNCArIDQgKiAod2lkdGggPCAxNjUgPyA3LjggOiB3aWR0aCA8IDI2NSA/IDguMiA6IHdpZHRoIDwgMzY1ID8gNi45IDogNC4yKSlcbiAgICAuYXR0cihcInJ4XCIsIDUpXG4gICAgLmF0dHIoXCJ5XCIsIDQuNSAqICh3aWR0aCA8IDE2NSA/IDEuOSA6IHdpZHRoIDwgMjY1ID8gMS40IDogd2lkdGggPCAzNjUgPyAuOSA6IC44KSlcbiAgICAuYXR0cihcIndpZHRoXCIsIGZvbnRTaXplICogKHdpZHRoIDwgMTY1ID8gMSA6IHdpZHRoIDwgMjY1ID8gMS4yIDogd2lkdGggPCAzNjUgPyAxLjQgOiAxLjYpKVxuICAgIC5hdHRyKFwiaGVpZ2h0XCIsIGZvbnRTaXplICogKHdpZHRoIDwgMTY1ID8gMSA6IHdpZHRoIDwgMjY1ID8gMS4yIDogd2lkdGggPCAzNjUgPyAxLjQgOiAxLjYpKVxuICAgIC5hdHRyKFwiZmlsbFwiLCBjb2xvcnMuZGF5KTtcbiAgbGVnZW5kXG4gICAgLmFwcGVuZChcInRleHRcIilcbiAgICAuYXR0cihcInhcIiwgNTIgKyA0ICogKHdpZHRoIDwgMTY1ID8gNi44IDogd2lkdGggPCAyNjUgPyA3LjggOiB3aWR0aCA8IDM2NSA/IDYuOSA6IDQuMikpXG4gICAgLmF0dHIoXCJ5XCIsIDE5KVxuICAgIC5hdHRyKFwiZm9udC1zaXplXCIsIGZvbnRTaXplICogKHdpZHRoIDwgMTY1ID8gMSA6IHdpZHRoIDwgMjY1ID8gMS4yIDogd2lkdGggPCAzNjUgPyAxLjQgOiAxLjYpKVxuICAgIC5hdHRyKFwiZm9udC1mYW1pbHlcIiwgXCJzYW5zLXNlcmlmXCIpXG4gICAgLnRleHQoXCJEYXlcIik7XG4gIC8qIFRpbWUgYW5kIGRhdGUgY29udHJvbHMgKi9cbiAgY29uc3QgZGF0ZUxpbmUgPSByb290LmFwcGVuZChcImdcIik7XG4gIGNvbnN0IHVwZGF0ZUNvbnRyb2xQb3NpdGlvbnMgPSAoKSA9PiB7XG4gICAgZGF0ZUxpbmVcbiAgICAgIC5zZWxlY3QoXCJsaW5lXCIpXG4gICAgICAuYXR0cihcImlkXCIsIFwiZGF0ZWxpbmVcIilcbiAgICAgIC5hdHRyKFwieDFcIiwgeFNjYWxlKDApKVxuICAgICAgLmF0dHIoXCJ5MVwiLCB5U2NhbGUoZGF0ZSkpXG4gICAgICAuYXR0cihcIngyXCIsIHhTY2FsZSgyNCkpXG4gICAgICAuYXR0cihcInkyXCIsIHlTY2FsZShkYXRlKSk7XG4gICAgZGF0ZUxpbmVcbiAgICAgIC5zZWxlY3QoXCJyZWN0XCIpXG4gICAgICAuYXR0cihcImlkXCIsIFwiZGF0ZXJlY3RcIilcbiAgICAgIC5hdHRyKFwieFwiLCB4U2NhbGUoMCkpXG4gICAgICAuYXR0cihcInlcIiwgeVNjYWxlKGRhdGUpIC0gNCk7XG4gICAgcm9vdFxuICAgICAgLnNlbGVjdChcIiN0aW1lLWNvbnRyb2xcIilcbiAgICAgIC5hdHRyKFwiY3hcIiwgeFNjYWxlKGhvdXIpKVxuICAgICAgLmF0dHIoXCJjeVwiLCB5U2NhbGUoZGF0ZSkpO1xuICB9O1xuICBjb25zdCBkaXNwYXRjaERhdGVIb3VyQ2hhbmdlID0gKCkgPT4ge1xuICAgIGNvbnN0IGRldGFpbCA9IHsgZGF0ZSwgaG91ciB9O1xuICAgIGNvbnN0IGNoYW5nZUV2ZW50ID0gbmV3IEN1c3RvbUV2ZW50KEV2ZW50VHlwZS5EYXRlSG91ckNoYW5nZSwge1xuICAgICAgZGV0YWlsLFxuICAgICAgYnViYmxlczogdHJ1ZVxuICAgIH0pO1xuICAgIHJvb3Qubm9kZSgpLmRpc3BhdGNoRXZlbnQoY2hhbmdlRXZlbnQpO1xuICB9O1xuICBjb25zdCBoYW5kbGVEYXRlTGluZURyYWcgPSAoeyB5IH0pID0+IHtcbiAgICBkYXRlID0geVNjYWxlLmludmVydCh5KTtcbiAgICB1cGRhdGVDb250cm9sUG9zaXRpb25zKCk7XG4gICAgZGlzcGF0Y2hEYXRlSG91ckNoYW5nZSgpO1xuICB9O1xuICBjb25zdCBoYW5kbGVUaW1lQ2lyY2xlRHJhZyA9ICh7IHggfSkgPT4ge1xuICAgIGhvdXIgPSB4U2NhbGUuaW52ZXJ0KHgpO1xuICAgIHVwZGF0ZUNvbnRyb2xQb3NpdGlvbnMoKTtcbiAgICBkaXNwYXRjaERhdGVIb3VyQ2hhbmdlKCk7XG4gIH07XG4gIGRhdGVMaW5lLmFwcGVuZChcImxpbmVcIikuYXR0cihcInN0cm9rZS13aWR0aFwiLCA0KS5hdHRyKFwic3Ryb2tlXCIsIFwicmVkXCIpO1xuICBkYXRlTGluZVxuICAgIC5hcHBlbmQoXCJyZWN0XCIpXG4gICAgLmF0dHIoXCJ3aWR0aFwiLCBjaGFydFdpZHRoKVxuICAgIC5hdHRyKFwiaGVpZ2h0XCIsIDgpXG4gICAgLmF0dHIoXCJmaWxsXCIsIFwicmdiYSgwLCAwLCAwLCAwKVwiKVxuICAgIC5zdHlsZShcImN1cnNvclwiLCBcInJvdy1yZXNpemVcIilcbiAgICAuY2FsbChkMy5kcmFnKCkub24oXCJkcmFnXCIsIGhhbmRsZURhdGVMaW5lRHJhZykpO1xuICByb290XG4gICAgLmFwcGVuZChcImNpcmNsZVwiKVxuICAgIC5hdHRyKFwiaWRcIiwgXCJ0aW1lLWNvbnRyb2xcIilcbiAgICAuYXR0cihcInJcIiwgMTIpXG4gICAgLmF0dHIoXCJmaWxsXCIsIFwicmVkXCIpXG4gICAgLmF0dHIoXCJzdHJva2Utd2lkdGhcIiwgLjYpXG4gICAgLmF0dHIoXCJzdHJva2VcIiwgXCJibGFja1wiKVxuICAgIC5zdHlsZShcImN1cnNvclwiLCBcInBvaW50ZXJcIilcbiAgICAuY2FsbChkMy5kcmFnKCkub24oXCJkcmFnXCIsIGhhbmRsZVRpbWVDaXJjbGVEcmFnKSk7XG4gIHVwZGF0ZUNvbnRyb2xQb3NpdGlvbnMoKTtcbn1cbmZvbnRTaXplID0gMTI7XG5nZXRTb2xhckFuZ2xlID0gKGRhdGUpID0+IChkYXlPZlllYXIoZGF0ZSkgKyAxMCkgLyAzNjUgKiBNYXRoLlBJICogMiAtIE1hdGguUEkgLyAyO1xuLypcbiAqIEZvcm11bGFzIHVzZXMgdGhlIENCTSBtb2RlbCBhcyByZXZpZXdlZCBoZXJlOlxuICogaHR0cHM6Ly93d3cuaWtoZWJlZW52cmFhZy5iZS9tZWRpYXN0b3JhZ2UvRlNEb2N1bWVudC8xNzEvRm9yc3l0aGUrLStBK21vZGVsK2NvbXBhcmlzb24rZm9yK2RheWxlbmd0aCthcythK2Z1bmN0aW9uK29mK2xhdGl0dWRlK2FuZCtkYXkrb2YreWVhcistKzE5OTUucGRmXG4gKi9cbmRheUxlbmd0aCA9IChkYXRlLCBsYXRpdHVkZSkgPT4ge1xuICBjb25zdCB5ZWFyU3RhcnQgPSBuZXcgRGF0ZShkYXRlLmdldEZ1bGxZZWFyKCksIDAsIDEpO1xuICBjb25zdCBkYXlPZlllYXIgPSBNYXRoLmZsb29yKChkYXRlLmdldFRpbWUoKSAtIHllYXJTdGFydC5nZXRUaW1lKCkpLzg2NDAwMDAwKSArIDE7XG4gIGNvbnN0IHJldkFuZ2xlID0gMC4yMTYzMTA4ICsgMiAqIE1hdGguYXRhbigwLjk2NzEzOTYgKiBNYXRoLnRhbigwLjAwODYwICogKGRheU9mWWVhciAtIDE4NikpKTtcbiAgY29uc3QgZGVjQW5nbGUgPSBNYXRoLmFzaW4oMC4zOTc5NSAqIE1hdGguY29zKHJldkFuZ2xlKSk7XG4gIC8qIGRheWxpZ2h0IGNvZWZmaWNpZW50IHNlbGVjdGVkIGZvciBhcHBhcmVudCBzdW5yaXNlL3N1bnNldCAqL1xuICBjb25zdCBwID0gMC44MzMzXG4gIGNvbnN0IGludFJlc3VsdCA9XG4gICAgKE1hdGguc2luKChwICogTWF0aC5QSSkgLyAxODApICtcbiAgICAgIE1hdGguc2luKChsYXRpdHVkZSAqIE1hdGguUEkpIC8gMTgwKSAqIE1hdGguc2luKGRlY0FuZ2xlKSkgL1xuICAgIChNYXRoLmNvcygobGF0aXR1ZGUgKiBNYXRoLlBJKSAvIDE4MCkgKiBNYXRoLmNvcyhkZWNBbmdsZSkpO1xuICBpZiAoaW50UmVzdWx0ID49IDEpIHJldHVybiAyNDtcbiAgaWYgKGludFJlc3VsdCA8PSAtMSkgcmV0dXJuIDA7XG4gIHJldHVybiAyNCAtIDI0ICogTWF0aC5hY29zKGludFJlc3VsdCkgLyBNYXRoLlBJO1xufVxueWVhckRhdGVzID0gKHllYXIpID0+IHtcbiAgY29uc3Qgc3RhcnREYXRlID0gbmV3IERhdGUoeWVhciwgMCwgMSs2MCk7XG4gIGNvbnN0IGVuZERhdGUgPSBuZXcgRGF0ZSh5ZWFyICsgMSwgMCwgMSs2MCk7XG4gIHJldHVybiBkMy50aW1lRGF5LnJhbmdlKHN0YXJ0RGF0ZSwgZW5kRGF0ZSk7XG59XG5oZWlnaHQgPSAwLjY1ICogd2lkdGg7XG5FdmVudFR5cGUgPSAoe1xuICBMb2NhdGlvbkNoYW5nZTogXCJMT0NBVElPTl9DSEFOR0VcIixcbiAgRGF0ZUhvdXJDaGFuZ2U6IFwiREFURV9IT1VSX0NIQU5HRVwiXG59KVxuY29sb3JzID0gKHtcbiAgbmlnaHQ6IFwiIzcxOWZiNlwiLFxuICBkYXk6IFwiI2ZmZTQzOFwiLFxuICBncmlkOiBcIiM0YjZhNzlcIixcbiAgb2NlYW46IFwiI2FkZWVmZlwiLFxuICBsYW5kOiBcIiNmNWYxZGNcIixcbiAgc3VuOiBcIiNmZmU0MzhcIlxufSlcbnRvUmFkaWFucyA9ICh2YWwpID0+IHZhbCAqIE1hdGguUEkgLyAxODBcbnRvRGVncmVlcyA9ICh2YWwpID0+IHZhbCAqIDE4MCAvIE1hdGguUEk7XG5sYW5kID0gdG9wb2pzb24uZmVhdHVyZSh3b3JsZCwgd29ybGQub2JqZWN0cy5sYW5kKTtcbmQzID0gcmVxdWlyZShcImQzQDdcIiwgXCJkMy1nZW8tcHJvamVjdGlvbkAzXCIpXG5mdW5jdGlvbiBpbnB1dChjb25maWcpIHtcbiAgbGV0IHtcbiAgICBmb3JtLFxuICAgIHR5cGUgPSBcInRleHRcIixcbiAgICBhdHRyaWJ1dGVzID0ge30sXG4gICAgYWN0aW9uLFxuICAgIGdldFZhbHVlLFxuICAgIHRpdGxlLFxuICAgIGRlc2NyaXB0aW9uLFxuICAgIGZvcm1hdCxcbiAgICBkaXNwbGF5LFxuICAgIHN1Ym1pdCxcbiAgICBvcHRpb25zXG4gIH0gPSBjb25maWc7XG4gIGNvbnN0IHdyYXBwZXIgPSBodG1sYDxkaXY+PC9kaXY+YDtcbiAgaWYgKCFmb3JtKVxuICAgIGZvcm0gPSBodG1sYDxmb3JtPlxuXHQ8aW5wdXQgbmFtZT1pbnB1dCB0eXBlPSR7dHlwZX0gLz5cbiAgPC9mb3JtPmA7XG4gIE9iamVjdC5rZXlzKGF0dHJpYnV0ZXMpLmZvckVhY2goa2V5ID0+IHtcbiAgICBjb25zdCB2YWwgPSBhdHRyaWJ1dGVzW2tleV07XG4gICAgaWYgKHZhbCAhPSBudWxsKSBmb3JtLmlucHV0LnNldEF0dHJpYnV0ZShrZXksIHZhbCk7XG4gIH0pO1xuICBpZiAoc3VibWl0KVxuICAgIGZvcm0uYXBwZW5kKFxuICAgICAgaHRtbGA8aW5wdXQgbmFtZT1zdWJtaXQgdHlwZT1zdWJtaXQgc3R5bGU9XCJtYXJnaW46IDAgMC43NWVtXCIgdmFsdWU9XCIke1xuICAgICAgICB0eXBlb2Ygc3VibWl0ID09IFwic3RyaW5nXCIgPyBzdWJtaXQgOiBcIlN1Ym1pdFwiXG4gICAgICB9XCIgLz5gXG4gICAgKTtcbiAgZm9ybS5hcHBlbmQoXG4gICAgaHRtbGA8b3V0cHV0IG5hbWU9b3V0cHV0IHN0eWxlPVwiZm9udDogMTRweCBNZW5sbywgQ29uc29sYXMsIG1vbm9zcGFjZTsgbWFyZ2luLWxlZnQ6IDAuMWVtOyB0ZXh0LWFsaWduOmNlbnRlcjtcIj48L291dHB1dD5gXG4gICk7XG4gIGlmICh0aXRsZSlcbiAgICBmb3JtLnByZXBlbmQoXG4gICAgICBodG1sYDxkaXYgc3R5bGU9XCJmb250OiA3MDAgMC45cmVtIHNhbnMtc2VyaWY7IG1hcmdpbi1ib3R0b206IDNweDtcIj4ke3RpdGxlfTwvZGl2PmBcbiAgICApO1xuICBpZiAoZGVzY3JpcHRpb24pXG4gICAgZm9ybS5hcHBlbmQoXG4gICAgICBodG1sYDxkaXYgc3R5bGU9XCJmb250LXNpemU6IDAuODVyZW07IGZvbnQtc3R5bGU6IGl0YWxpYzsgbWFyZ2luLXRvcDogM3B4O1wiPiR7ZGVzY3JpcHRpb259PC9kaXY+YFxuICAgICk7XG4gIGlmIChmb3JtYXQpXG4gICAgZm9ybWF0ID0gdHlwZW9mIGZvcm1hdCA9PT0gXCJmdW5jdGlvblwiID8gZm9ybWF0IDogZDNmb3JtYXQuZm9ybWF0KGZvcm1hdCk7XG4gIGlmIChhY3Rpb24pIHtcbiAgICBhY3Rpb24oZm9ybSk7XG4gIH0gZWxzZSB7XG4gICAgY29uc3QgdmVyYiA9IHN1Ym1pdFxuICAgICAgPyBcIm9uc3VibWl0XCJcbiAgICAgIDogdHlwZSA9PSBcImJ1dHRvblwiXG4gICAgICA/IFwib25jbGlja1wiXG4gICAgICA6IHR5cGUgPT0gXCJjaGVja2JveFwiIHx8IHR5cGUgPT0gXCJyYWRpb1wiXG4gICAgICA/IFwib25jaGFuZ2VcIlxuICAgICAgOiBcIm9uaW5wdXRcIjtcbiAgICBmb3JtW3ZlcmJdID0gZSA9PiB7XG4gICAgICBlICYmIGUucHJldmVudERlZmF1bHQoKTtcbiAgICAgIGNvbnN0IHZhbHVlID0gZ2V0VmFsdWUgPyBnZXRWYWx1ZShmb3JtLmlucHV0KSA6IGZvcm0uaW5wdXQudmFsdWU7XG4gICAgICBpZiAoZm9ybS5vdXRwdXQpIHtcbiAgICAgICAgY29uc3Qgb3V0ID0gZGlzcGxheSA/IGRpc3BsYXkodmFsdWUpIDogZm9ybWF0ID8gZm9ybWF0KHZhbHVlKSA6IHZhbHVlO1xuICAgICAgICBpZiAob3V0IGluc3RhbmNlb2Ygd2luZG93LkVsZW1lbnQpIHtcbiAgICAgICAgICB3aGlsZSAoZm9ybS5vdXRwdXQuaGFzQ2hpbGROb2RlcygpKSB7XG4gICAgICAgICAgICBmb3JtLm91dHB1dC5yZW1vdmVDaGlsZChmb3JtLm91dHB1dC5sYXN0Q2hpbGQpO1xuICAgICAgICAgIH1cbiAgICAgICAgICBmb3JtLm91dHB1dC5hcHBlbmQob3V0KTtcbiAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICBmb3JtLm91dHB1dC52YWx1ZSA9IG91dDtcbiAgICAgICAgfVxuICAgICAgfVxuICAgICAgZm9ybS52YWx1ZSA9IHZhbHVlO1xuICAgICAgaWYgKHZlcmIgIT09IFwib25pbnB1dFwiKVxuICAgICAgICBmb3JtLmRpc3BhdGNoRXZlbnQobmV3IEN1c3RvbUV2ZW50KFwiaW5wdXRcIiwgeyBidWJibGVzOiB0cnVlIH0pKTtcbiAgICB9O1xuICAgIGlmICh2ZXJiICE9PSBcIm9uaW5wdXRcIilcbiAgICAgIHdyYXBwZXIub25pbnB1dCA9IGUgPT4gZSAmJiBlLnN0b3BQcm9wYWdhdGlvbigpICYmIGUucHJldmVudERlZmF1bHQoKTtcbiAgICBpZiAodmVyYiAhPT0gXCJvbnN1Ym1pdFwiKSBmb3JtLm9uc3VibWl0ID0gZSA9PiBlICYmIGUucHJldmVudERlZmF1bHQoKTtcbiAgICBmb3JtW3ZlcmJdKCk7XG4gIH1cbiAgd2hpbGUgKGZvcm0uY2hpbGROb2Rlcy5sZW5ndGgpIHtcbiAgICB3cmFwcGVyLmFwcGVuZENoaWxkKGZvcm0uY2hpbGROb2Rlc1swXSk7XG4gIH1cbiAgZm9ybS5hcHBlbmQod3JhcHBlcik7XG4gIHJldHVybiBmb3JtO1xufVxuZDNmb3JtYXQgPSByZXF1aXJlKFwiZDMtZm9ybWF0QDFcIilcbi8vIGh0dHBzOi8vb2JzZXJ2YWJsZWhxLmNvbS9AZW5qYWxvdC9kcmFnZ2FibGUtd29ybGQtbWFwLWNvb3JkaW5hdGVzLWlucHV0XG5mdW5jdGlvbiB3b3JsZE1hcENvb3JkaW5hdGVzKGNvbmZpZyA9IHt9LCBkaW1lbnNpb25zKSB7XG4gIGNvbnN0IHtcbiAgICB2YWx1ZSA9IFtdLCB0aXRsZSwgZGVzY3JpcHRpb24sIHdpZHRoID0gZGltZW5zaW9uc1swXVxuICB9ID0gQXJyYXkuaXNBcnJheShjb25maWcpID8ge3ZhbHVlOiBjb25maWd9IDogY29uZmlnO1xuICBjb25zdCBoZWlnaHQgPSBkaW1lbnNpb25zWzFdO1xuICBsZXQgW2xvbiwgbGF0XSA9IHZhbHVlO1xuICBsb24gPSBsb24gIT0gbnVsbCA/IGxvbiA6IG51bGw7XG4gIGxhdCA9IGxhdCAhPSBudWxsID8gbGF0IDogbnVsbDtcbiAgY29uc3QgZm9ybUVsID0gaHRtbGA8Zm9ybSBzdHlsZT1cIndpZHRoOiAke3dpZHRofXB4O1wiPjwvZm9ybT5gO1xuICBjb25zdCBjb250ZXh0ID0gRE9NLmNvbnRleHQyZCh3aWR0aCwgaGVpZ2h0LXdpZHRoLzEzLjIpO1xuICBjb25zdCBjYW52YXMgPSBjb250ZXh0LmNhbnZhcztcbiAgY2FudmFzLnN0eWxlLm1hcmdpbiA9IGAtMTBweCAwcHggLTI2cHggMHB4YDtcbiAgY29uc3QgcHJvamVjdGlvbiA9IGQzXG4gICAgLmdlb0VxdWlyZWN0YW5ndWxhcigpXG4gICAgLnByZWNpc2lvbigwLjEpXG4gICAgLmZpdFNpemUoW3dpZHRoLCBoZWlnaHRdLCB7IHR5cGU6IFwiU3BoZXJlXCIgfSkucm90YXRlKFstMTUzLCAwXSk7XG4gIGNvbnN0IHBhdGggPSBkMy5nZW9QYXRoKHByb2plY3Rpb24sIGNvbnRleHQpLnBvaW50UmFkaXVzKDIuNSk7XG4gIGZvcm1FbC5hcHBlbmQoY2FudmFzKTtcbiAgZnVuY3Rpb24gZHJhdygpIHtcbiAgICBjb250ZXh0LmZpbGxTdHlsZSA9IFwiI2ZmZlwiO1xuICAgIGNvbnRleHQuZmlsbFJlY3QoMCwgMCwgd2lkdGgsIGhlaWdodCk7XG4gICAgY29udGV4dC5iZWdpblBhdGgoKTsgcGF0aCh7dHlwZTogXCJTcGhlcmVcIn0pO1xuICAgIGNvbnRleHQuZmlsbFN0eWxlID0gY29sb3JzLm9jZWFuOyBjb250ZXh0LmZpbGwoKTtcbiAgICBjb250ZXh0LmJlZ2luUGF0aCgpO1xuICAgIHBhdGgoZ3JhdGljdWxlKTtcbiAgICBjb250ZXh0LmxpbmVXaWR0aCA9IDAuOTU7XG4gICAgY29udGV4dC5zdHJva2VTdHlsZSA9IGAjYWFhYDtcbiAgICBjb250ZXh0LnN0cm9rZSgpO1xuICAgIGNvbnRleHQuYmVnaW5QYXRoKCk7XG4gICAgcGF0aChsYW5kKTtcbiAgICBjb250ZXh0LmZpbGxTdHlsZSA9IGNvbG9ycy5sYW5kO1xuICAgIGNvbnRleHQuZmlsbCgpO1xuICAgIGNvbnRleHQuYmVnaW5QYXRoKCk7XG4gICAgcGF0aChjb3VudHJpZXMpO1xuICAgIGNvbnRleHQubGluZVdpZHRoID0gLjk1O1xuICAgIGNvbnRleHQuc3Ryb2tlU3R5bGUgPSBgIzAwMGA7XG4gICAgY29udGV4dC5zdHJva2UoKTtcbiAgICBjb250ZXh0LmZpbGxTdHlsZSA9IGAjMDAwYDtcbiAgICBjb250ZXh0LmZvbnQgPSB3aWR0aCA8IDc2MCA/IFwiMTRweCBzZXJpZlwiIDogd2lkdGggPCA5OTAgPyBcIjE3cHggc2VyaWZcIiA6IFwiMjNweCBzZXJpZlwiO1xuICAgIGQzLnJhbmdlKC0xLjUsIDM0MiArIDEsIDM2KS5tYXAoeCA9PiAgY29udGV4dC5maWxsVGV4dChsb25nMnpvbmUoeCksIC4uLnByb2plY3Rpb24oW3gsIDg0IC0gKHdpZHRoIDwgNTAwKSAqIDguOF0pKSk7XG4gICAgZDMucmFuZ2UoLTEuNSwgMzQyICsgMSwgMzYpLm1hcCh4ID0+ICBjb250ZXh0LmZpbGxUZXh0KGxvbmcyem9uZSh4KSwgLi4ucHJvamVjdGlvbihbeCwgLTY2ICsgKHdpZHRoIDwgNTAwKSAqIDEuMV0pKSk7XG4gICAgY29udGV4dC5iZWdpblBhdGgoKSwgcGF0aChuaWdodCksIGNvbnRleHQuZmlsbFN0eWxlID0gXCJyZ2JhKDAsMCwyNTUsMC4xKVwiLCBjb250ZXh0LmZpbGwoKTtcbiAgICBjb250ZXh0LmJlZ2luUGF0aCgpOyBwYXRoLnBvaW50UmFkaXVzKDE3KTsgcGF0aCh7dHlwZTogXCJQb2ludFwiLCBjb29yZGluYXRlczogc3VufSk7IGNvbnRleHQuc3Ryb2tlU3R5bGUgPSBcIiMwMDA4XCI7IGNvbnRleHQuZmlsbFN0eWxlID0gXCIjZmYwOFwiOyBjb250ZXh0LmxpbmVXaWR0aCA9IDE7IGNvbnRleHQuc3Ryb2tlKCk7IGNvbnRleHQuZmlsbCgpO1xuICAgIGlmIChsb24gIT0gbnVsbCAmJiBsYXQgIT0gbnVsbCkge1xuICAgICAgcGF0aC5wb2ludFJhZGl1cygxNyk7IGNvbnRleHQuc3Ryb2tlU3R5bGUgPSBcImJsYWNrXCI7XG4gICAgICBjb250ZXh0LmJlZ2luUGF0aCgpOyBwYXRoKHt0eXBlOiBcIlBvaW50XCIsIGNvb3JkaW5hdGVzOiBbbG9uLCBsYXRdfSk7IGNvbnRleHQubGluZVdpZHRoID0gMTsgY29udGV4dC5zdHJva2UoKTtcbiAgICAgIGNvbnRleHQubGluZVdpZHRoID0gNjtcbiAgICAgIHBhdGgucG9pbnRSYWRpdXMoMTQpOyBjb250ZXh0LnN0cm9rZVN0eWxlID0gXCJyZWRcIjtcbiAgICAgIGNvbnRleHQuYmVnaW5QYXRoKCk7IHBhdGgoe3R5cGU6IFwiUG9pbnRcIiwgY29vcmRpbmF0ZXM6IFtsb24sIGxhdF19KTsgY29udGV4dC5zdHJva2UoKTtcbiAgICB9XG4gIH1cbiAgbGV0IGRyYWcgPSBkMy5kcmFnKClcbiAgICAub24oXCJkcmFnXCIsIChldmVudCkgPT4ge1xuICAgICAgbGV0IGNvb3JkcyA9IHByb2plY3Rpb24uaW52ZXJ0KFtldmVudC54LCBldmVudC55XSk7XG4gICAgICBsb24gPSArY29vcmRzWzBdLnRvRml4ZWQoMik7XG4gICAgICBsYXQgPSArY29vcmRzWzFdLnRvRml4ZWQoMik7XG4gICAgICBkcmF3KCk7XG4gICAgICBjYW52YXMuZGlzcGF0Y2hFdmVudChuZXcgQ3VzdG9tRXZlbnQoXCJpbnB1dFwiLCB7IGJ1YmJsZXM6IHRydWUgfSkpO1xuICAgIH0pXG4gIGQzLnNlbGVjdChjYW52YXMpLmNhbGwoZHJhZylcbiAgY2FudmFzLm9uY2xpY2sgPSBmdW5jdGlvbihldikge1xuICAgIGNvbnN0IHsgb2Zmc2V0WCwgb2Zmc2V0WSB9ID0gZXY7XG4gICAgbGV0IGNvb3JkcyA9IHByb2plY3Rpb24uaW52ZXJ0KFtvZmZzZXRYLCBvZmZzZXRZXSk7XG4gICAgbG9uID0gK2Nvb3Jkc1swXS50b0ZpeGVkKDIpO1xuICAgIGxhdCA9ICtjb29yZHNbMV0udG9GaXhlZCgyKTtcbiAgICBkcmF3KCk7XG4gICAgY2FudmFzLmRpc3BhdGNoRXZlbnQobmV3IEN1c3RvbUV2ZW50KFwiaW5wdXRcIiwgeyBidWJibGVzOiB0cnVlIH0pKTtcbiAgfTtcbiAgZHJhdygpO1xuICBjb25zdCBmb3JtID0gaW5wdXQoe1xuICAgIHR5cGU6IFwid29ybGRNYXBDb29yZGluYXRlc1wiLFxuICAgIHRpdGxlLFxuICAgIGRlc2NyaXB0aW9uLFxuICAgIGRpc3BsYXk6IHYgPT4gKHdpZHRoID4gMzAwKSA/IGh0bWxgPGRpdiBzdHlsZT1cIndpZHRoOiAke3dpZHRofXB4OyB3aGl0ZS1zcGFjZTogbm93cmFwOyBjb2xvcjogIzQ0NDsgdGV4dC1hbGlnbjogY2VudGVyOyBmb250OiAke3dpZHRoIC8gNTB9cHggbW9ub3NwYWNlOyBwb3NpdGlvbjogcmVsYXRpdmU7IHRvcDogLSR7d2lkdGggLyAzMH1weDsgIG1hcmdpbi1ib3R0b206IC0uNGVtO1wiPlxuICAgICAgICAgICAgPHNwYW4gc3R5bGU9XCJjb2xvcjogIzAwMDtcIj5ab25lOjwvc3Bhbj4gJHtsb24gIT0gbnVsbCA/IGxvbmcyem9uZShsb24pIDogXCJcIn1cbiAgICAgICAgICAgICZuYnNwOyAmbmJzcDtcbiAgICAgICAgICAgIDxzcGFuIHN0eWxlPVwiY29sb3I6ICMwMDA7XCI+TG9uZ2l0dWRlOjwvc3Bhbj4gJHtsb24gIT0gbnVsbCA/IChsb25nMnR1cm4obG9uKSkudG9GaXhlZCgwKSA6IFwiXCJ9XG4gICAgICAgICAgICAmbmJzcDsgJm5ic3A7XG4gICAgICAgICAgICA8c3BhbiBzdHlsZT1cImNvbG9yOiAjMDAwO1wiPkxhdGl0dWRlOjwvc3Bhbj4gJHtsYXQgIT0gbnVsbCA/ICgobGF0aTJ0dXJuMShsYXQpKSkudG9GaXhlZCgwKSA6IFwiXCJ9XG4gICAgICAgICAgPC9kaXY+YCA6ICcnLFxuICAgIGdldFZhbHVlOiAoKSA9PiBbbG9uICE9IG51bGwgPyBsb24gOiBudWxsLCBsYXQgIT0gbnVsbCA/IGxhdCA6IG51bGxdLFxuICAgIGZvcm06IGZvcm1FbFxuICB9KTtcbiAgcmV0dXJuIGZvcm07XG59XG5zdW4gPSB7XG4gIGNvbnN0IG5vdyA9IG5ldyBEYXRlO1xuICBjb25zdCBkYXkgPSBuZXcgRGF0ZSgrbm93KS5zZXRVVENIb3VycygwLCAwLCAwLCAwKTtcbiAgY29uc3QgdCA9IHNvbGFyLmNlbnR1cnkobm93KTtcbiAgY29uc3QgbG9uZ2l0dWRlID0gKGRheSAtIG5vdykgLyA4NjRlNSAqIDM2MCAtIDE4MDtcbiAgcmV0dXJuIFtsb25naXR1ZGUgLSBzb2xhci5lcXVhdGlvbk9mVGltZSh0KSAvIDQsIHNvbGFyLmRlY2xpbmF0aW9uKHQpXTtcbn1cbm5pZ2h0ID0gZDMuZ2VvQ2lyY2xlKClcbiAgICAucmFkaXVzKDkwKVxuICAgIC5jZW50ZXIoYW50aXBvZGUoc3VuKSlcbiAgKClcbmFudGlwb2RlID0gKFtsb25naXR1ZGUsIGxhdGl0dWRlXSkgPT4gW2xvbmdpdHVkZSArIDE4MCwgLWxhdGl0dWRlXVxuc29sYXIgPSByZXF1aXJlKFwic29sYXItY2FsY3VsYXRvckAwLjMvZGlzdC9zb2xhci1jYWxjdWxhdG9yLm1pbi5qc1wiKVxudmlld29mIGZhbmN5U2Vjb25kc09GRiA9IElucHV0cy50b2dnbGUoe1xuICBsYWJlbDogXCJUaWNraW5nIGNsb2NrXCIsXG4gIHZhbHVlOiB0cnVlLFxufSlcbmZ1bmN0aW9uIHNldFN0eWxlKGNvbnRlbnQsIHN0eWxlID0ge30pIHtcbiAgZnVuY3Rpb24geWlxKGNvbG9yKSB7XG4gICAgY29uc3Qge3IsIGcsIGJ9ID0gZDMucmdiKGNvbG9yKTtcbiAgICByZXR1cm4gKHIgKiAyOTkgKyBnICogNTg3ICsgYiAqIDExNCkgLyAxMDAwIC8gMjU1OyAvLyByZXR1cm5zIHZhbHVlcyBiZXR3ZWVuIDAgYW5kIDFcbiAgfVxuICBjb25zdCB7XG4gICAgYmFja2dyb3VuZCxcbiAgICBjb2xvciA9IHlpcShiYWNrZ3JvdW5kKSA+PSAwLjYgPyBcIiMxMTFcIiA6IFwid2hpdGVcIixcbiAgICBwYWRkaW5nID0gXCIwIDFweFwiLFxuICAgIGJvcmRlclJhZGl1cyA9IFwiNHB4XCIsXG4gICAgZm9udFdlaWdodCA9IDkwMCxcbiAgICBmb250U2l6ZSA9IFwiMWVtXCIsXG4gICAgLi4ucmVzdFxuICB9ID0gdHlwZW9mIHN0eWxlID09PSBcInN0cmluZ1wiID8ge2JhY2tncm91bmQ6IHN0eWxlfSA6IHN0eWxlO1xuICByZXR1cm4gaHRsLmh0bWxgPHNwYW4gc3R5bGU9JHt7XG4gICAgYmFja2dyb3VuZCxcbiAgICBjb2xvcixcbiAgICBwYWRkaW5nLFxuICAgIGJvcmRlclJhZGl1cyxcbiAgICBmb250V2VpZ2h0LFxuICAgIC4uLnJlc3RcbiAgfX0+JHtjb250ZW50fTwvc3Bhbj5gO1xufVxuIn0seyJtZXRob2ROYW1lIjoiaW50ZXJwcmV0UXVpZXQiLCJzb3VyY2UiOiJzaGlueUlucHV0KCdsb2NhdGlvbicpIn0seyJtZXRob2ROYW1lIjoiaW50ZXJwcmV0UXVpZXQiLCJzb3VyY2UiOiJzaGlueUlucHV0KCdmYW5jeVNlY29uZHNPRkYnKSJ9XX0=
</script>
<script type="module">
if (window.location.protocol === "file:") { alert("The OJS runtime does not work with file:// URLs. Please use a web server to view this document."); }
window._ojs.paths.runtimeToDoc = "../../dec/time";
window._ojs.paths.runtimeToRoot = "../..";
window._ojs.paths.docToRoot = "../..";
window._ojs.selfContained = false;
window._ojs.runtime.interpretFromScriptTags();
</script>
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const disableStylesheet = (stylesheets) => {
    for (let i=0; i < stylesheets.length; i++) {
      const stylesheet = stylesheets[i];
      stylesheet.rel = 'prefetch';
    }
  }
  const enableStylesheet = (stylesheets) => {
    for (let i=0; i < stylesheets.length; i++) {
      const stylesheet = stylesheets[i];
      stylesheet.rel = 'stylesheet';
    }
  }
  const manageTransitions = (selector, allowTransitions) => {
    const els = window.document.querySelectorAll(selector);
    for (let i=0; i < els.length; i++) {
      const el = els[i];
      if (allowTransitions) {
        el.classList.remove('notransition');
      } else {
        el.classList.add('notransition');
      }
    }
  }
  const toggleGiscusIfUsed = (isAlternate, darkModeDefault) => {
    const baseTheme = document.querySelector('#giscus-base-theme')?.value ?? 'light';
    const alternateTheme = document.querySelector('#giscus-alt-theme')?.value ?? 'dark';
    let newTheme = '';
    if(darkModeDefault) {
      newTheme = isAlternate ? baseTheme : alternateTheme;
    } else {
      newTheme = isAlternate ? alternateTheme : baseTheme;
    }
    const changeGiscusTheme = () => {
      // From: https://github.com/giscus/giscus/issues/336
      const sendMessage = (message) => {
        const iframe = document.querySelector('iframe.giscus-frame');
        if (!iframe) return;
        iframe.contentWindow.postMessage({ giscus: message }, 'https://giscus.app');
      }
      sendMessage({
        setConfig: {
          theme: newTheme
        }
      });
    }
    const isGiscussLoaded = window.document.querySelector('iframe.giscus-frame') !== null;
    if (isGiscussLoaded) {
      changeGiscusTheme();
    }
  }
  const toggleColorMode = (alternate) => {
    // Switch the stylesheets
    const alternateStylesheets = window.document.querySelectorAll('link.quarto-color-scheme.quarto-color-alternate');
    manageTransitions('#quarto-margin-sidebar .nav-link', false);
    if (alternate) {
      enableStylesheet(alternateStylesheets);
      for (const sheetNode of alternateStylesheets) {
        if (sheetNode.id === "quarto-bootstrap") {
          toggleBodyColorMode(sheetNode);
        }
      }
    } else {
      disableStylesheet(alternateStylesheets);
      toggleBodyColorPrimary();
    }
    manageTransitions('#quarto-margin-sidebar .nav-link', true);
    // Switch the toggles
    const toggles = window.document.querySelectorAll('.quarto-color-scheme-toggle');
    for (let i=0; i < toggles.length; i++) {
      const toggle = toggles[i];
      if (toggle) {
        if (alternate) {
          toggle.classList.add("alternate");     
        } else {
          toggle.classList.remove("alternate");
        }
      }
    }
    // Hack to workaround the fact that safari doesn't
    // properly recolor the scrollbar when toggling (#1455)
    if (navigator.userAgent.indexOf('Safari') > 0 && navigator.userAgent.indexOf('Chrome') == -1) {
      manageTransitions("body", false);
      window.scrollTo(0, 1);
      setTimeout(() => {
        window.scrollTo(0, 0);
        manageTransitions("body", true);
      }, 40);  
    }
  }
  const isFileUrl = () => { 
    return window.location.protocol === 'file:';
  }
  const hasAlternateSentinel = () => {  
    let styleSentinel = getColorSchemeSentinel();
    if (styleSentinel !== null) {
      return styleSentinel === "alternate";
    } else {
      return false;
    }
  }
  const setStyleSentinel = (alternate) => {
    const value = alternate ? "alternate" : "default";
    if (!isFileUrl()) {
      window.localStorage.setItem("quarto-color-scheme", value);
    } else {
      localAlternateSentinel = value;
    }
  }
  const getColorSchemeSentinel = () => {
    if (!isFileUrl()) {
      const storageValue = window.localStorage.getItem("quarto-color-scheme");
      return storageValue != null ? storageValue : localAlternateSentinel;
    } else {
      return localAlternateSentinel;
    }
  }
  const darkModeDefault = false;
  let localAlternateSentinel = darkModeDefault ? 'alternate' : 'default';
  // Dark / light mode switch
  window.quartoToggleColorScheme = () => {
    // Read the current dark / light value 
    let toAlternate = !hasAlternateSentinel();
    toggleColorMode(toAlternate);
    setStyleSentinel(toAlternate);
    toggleGiscusIfUsed(toAlternate, darkModeDefault);
  };
  // Ensure there is a toggle, if there isn't float one in the top right
  if (window.document.querySelector('.quarto-color-scheme-toggle') === null) {
    const a = window.document.createElement('a');
    a.classList.add('top-right');
    a.classList.add('quarto-color-scheme-toggle');
    a.href = "";
    a.onclick = function() { try { window.quartoToggleColorScheme(); } catch {} return false; };
    const i = window.document.createElement("i");
    i.classList.add('bi');
    a.appendChild(i);
    window.document.body.appendChild(a);
  }
  // Switch to dark mode if need be
  if (hasAlternateSentinel()) {
    toggleColorMode(true);
  } else {
    toggleColorMode(false);
  }
  const icon = "Óßã";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const onCopySuccess = function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  }
  const getTextToCopy = function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button:not([data-in-quarto-modal])', {
    text: getTextToCopy
  });
  clipboard.on('success', onCopySuccess);
  if (window.document.getElementById('quarto-embedded-source-code-modal')) {
    const clipboardModal = new window.ClipboardJS('.code-copy-button[data-in-quarto-modal]', {
      text: getTextToCopy,
      container: window.document.getElementById('quarto-embedded-source-code-modal')
    });
    clipboardModal.on('success', onCopySuccess);
  }
  const viewSource = window.document.getElementById('quarto-view-source') ||
                     window.document.getElementById('quarto-code-tools-source');
  if (viewSource) {
    const sourceUrl = viewSource.getAttribute("data-quarto-source-url");
    viewSource.addEventListener("click", function(e) {
      if (sourceUrl) {
        // rstudio viewer pane
        if (/\bcapabilities=\b/.test(window.location)) {
          window.open(sourceUrl);
        } else {
          window.location.href = sourceUrl;
        }
      } else {
        const modal = new bootstrap.Modal(document.getElementById('quarto-embedded-source-code-modal'));
        modal.show();
      }
      return false;
    });
  }
  function toggleCodeHandler(show) {
    return function(e) {
      const detailsSrc = window.document.querySelectorAll(".cell > details > .sourceCode");
      for (let i=0; i<detailsSrc.length; i++) {
        const details = detailsSrc[i].parentElement;
        if (show) {
          details.open = true;
        } else {
          details.removeAttribute("open");
        }
      }
      const cellCodeDivs = window.document.querySelectorAll(".cell > .sourceCode");
      const fromCls = show ? "hidden" : "unhidden";
      const toCls = show ? "unhidden" : "hidden";
      for (let i=0; i<cellCodeDivs.length; i++) {
        const codeDiv = cellCodeDivs[i];
        if (codeDiv.classList.contains(fromCls)) {
          codeDiv.classList.remove(fromCls);
          codeDiv.classList.add(toCls);
        } 
      }
      return false;
    }
  }
  const hideAllCode = window.document.getElementById("quarto-hide-all-code");
  if (hideAllCode) {
    hideAllCode.addEventListener("click", toggleCodeHandler(false));
  }
  const showAllCode = window.document.getElementById("quarto-show-all-code");
  if (showAllCode) {
    showAllCode.addEventListener("click", toggleCodeHandler(true));
  }
    var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
    var mailtoRegex = new RegExp(/^mailto:/);
      var filterRegex = new RegExp("https:\/\/maptv\.github\.io");
    var isInternal = (href) => {
        return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
    }
    // Inspect non-navigation links and adorn them if external
 	var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
    for (var i=0; i<links.length; i++) {
      const link = links[i];
      if (!isInternal(link.href)) {
        // undo the damage that might have been done by quarto-nav.js in the case of
        // links that we want to consider external
        if (link.dataset.originalHref !== undefined) {
          link.href = link.dataset.originalHref;
        }
          // target, if specified
          link.setAttribute("target", "_blank");
          if (link.getAttribute("rel") === null) {
            link.setAttribute("rel", "noopener");
          }
      }
    }
  function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
    const config = {
      allowHTML: true,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start',
    };
    if (contentFn) {
      config.content = contentFn;
    }
    if (onTriggerFn) {
      config.onTrigger = onTriggerFn;
    }
    if (onUntriggerFn) {
      config.onUntrigger = onUntriggerFn;
    }
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      if (note) {
        return note.innerHTML;
      } else {
        return "";
      }
    });
  }
  const xrefs = window.document.querySelectorAll('a.quarto-xref');
  const processXRef = (id, note) => {
    // Strip column container classes
    const stripColumnClz = (el) => {
      el.classList.remove("page-full", "page-columns");
      if (el.children) {
        for (const child of el.children) {
          stripColumnClz(child);
        }
      }
    }
    stripColumnClz(note)
    if (id === null || id.startsWith('sec-')) {
      // Special case sections, only their first couple elements
      const container = document.createElement("div");
      if (note.children && note.children.length > 2) {
        container.appendChild(note.children[0].cloneNode(true));
        for (let i = 1; i < note.children.length; i++) {
          const child = note.children[i];
          if (child.tagName === "P" && child.innerText === "") {
            continue;
          } else {
            container.appendChild(child.cloneNode(true));
            break;
          }
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(container);
        }
        return container.innerHTML
      } else {
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        return note.innerHTML;
      }
    } else {
      // Remove any anchor links if they are present
      const anchorLink = note.querySelector('a.anchorjs-link');
      if (anchorLink) {
        anchorLink.remove();
      }
      if (window.Quarto?.typesetMath) {
        window.Quarto.typesetMath(note);
      }
      if (note.classList.contains("callout")) {
        return note.outerHTML;
      } else {
        return note.innerHTML;
      }
    }
  }
  for (var i=0; i<xrefs.length; i++) {
    const xref = xrefs[i];
    tippyHover(xref, undefined, function(instance) {
      instance.disable();
      let url = xref.getAttribute('href');
      let hash = undefined; 
      if (url.startsWith('#')) {
        hash = url;
      } else {
        try { hash = new URL(url).hash; } catch {}
      }
      if (hash) {
        const id = hash.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note !== null) {
          try {
            const html = processXRef(id, note.cloneNode(true));
            instance.setContent(html);
          } finally {
            instance.enable();
            instance.show();
          }
        } else {
          // See if we can fetch this
          fetch(url.split('#')[0])
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.getElementById(id);
            if (note !== null) {
              const html = processXRef(id, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      } else {
        // See if we can fetch a full url (with no hash to target)
        // This is a special case and we should probably do some content thinning / targeting
        fetch(url)
        .then(res => res.text())
        .then(html => {
          const parser = new DOMParser();
          const htmlDoc = parser.parseFromString(html, "text/html");
          const note = htmlDoc.querySelector('main.content');
          if (note !== null) {
            // This should only happen for chapter cross references
            // (since there is no id in the URL)
            // remove the first header
            if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
              note.children[0].remove();
            }
            const html = processXRef(null, note);
            instance.setContent(html);
          } 
        }).finally(() => {
          instance.enable();
          instance.show();
        });
      }
    }, function(instance) {
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            div.style.left = 0;
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
        // Handle positioning of the toggle
    window.addEventListener(
      "resize",
      throttle(() => {
        elRect = undefined;
        if (selectedAnnoteEl) {
          selectCodeLines(selectedAnnoteEl);
        }
      }, 10)
    );
    function throttle(fn, ms) {
    let throttle = false;
    let timer;
      return (...args) => {
        if(!throttle) { // first call gets through
            fn.apply(this, args);
            throttle = true;
        } else { // all the others get throttled
            if(timer) clearTimeout(timer); // cancel #2
            timer = setTimeout(() => {
              fn.apply(this, args);
              timer = throttle = false;
            }, ms);
        }
      };
    }
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
<nav class="page-navigation column-body">
  <div class="nav-page nav-page-previous">
      <a href="../../dec/date/index.html" class="pagination-link" aria-label="Date">
        <i class="bi bi-arrow-left-short"></i> <span class="nav-page-text">Date</span>
      </a>          
  </div>
  <div class="nav-page nav-page-next">
      <a href="../../dec/iso/index.html" class="pagination-link" aria-label="ISO 8601">
        <span class="nav-page-text">ISO 8601</span> <i class="bi bi-arrow-right-short"></i>
      </a>
  </div>
</nav><div class="modal fade" id="quarto-embedded-source-code-modal" tabindex="-1" aria-labelledby="quarto-embedded-source-code-modal-label" aria-hidden="true"><div class="modal-dialog modal-dialog-scrollable"><div class="modal-content"><div class="modal-header"><h5 class="modal-title" id="quarto-embedded-source-code-modal-label">Source Code</h5><button class="btn-close" data-bs-dismiss="modal"></button></div><div class="modal-body"><div class="">
<div class="sourceCode" id="cb4" data-shortcodes="false"><pre class="sourceCode markdown code-with-copy"><code class="sourceCode markdown"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a><span class="co">---</span></span>
<span id="cb4-2"><a href="#cb4-2" aria-hidden="true" tabindex="-1"></a><span class="an">title:</span><span class="co"> Dec Time</span></span>
<span id="cb4-3"><a href="#cb4-3" aria-hidden="true" tabindex="-1"></a><span class="an">image:</span><span class="co"> /asset/daywide.svg</span></span>
<span id="cb4-4"><a href="#cb4-4" aria-hidden="true" tabindex="-1"></a><span class="an">description:</span><span class="co"> &gt;</span></span>
<span id="cb4-5"><a href="#cb4-5" aria-hidden="true" tabindex="-1"></a><span class="co">  Introducing Declock, a timekeeping system that displays time in decimal days using math notation without the need for hours, minutes, or seconds.</span></span>
<span id="cb4-6"><a href="#cb4-6" aria-hidden="true" tabindex="-1"></a><span class="an">citation:</span></span>
<span id="cb4-7"><a href="#cb4-7" aria-hidden="true" tabindex="-1"></a><span class="co">  url: https://maptv.github.io/dec/time</span></span>
<span id="cb4-8"><a href="#cb4-8" aria-hidden="true" tabindex="-1"></a><span class="an">aliases:</span></span>
<span id="cb4-9"><a href="#cb4-9" aria-hidden="true" tabindex="-1"></a><span class="co">  - /measure/dec/time</span></span>
<span id="cb4-10"><a href="#cb4-10" aria-hidden="true" tabindex="-1"></a><span class="co">  - /time</span></span>
<span id="cb4-11"><a href="#cb4-11" aria-hidden="true" tabindex="-1"></a><span class="an">license:</span><span class="co"> CC BY-SA</span></span>
<span id="cb4-12"><a href="#cb4-12" aria-hidden="true" tabindex="-1"></a><span class="an">lightbox:</span><span class="co"> false</span></span>
<span id="cb4-13"><a href="#cb4-13" aria-hidden="true" tabindex="-1"></a><span class="an">toc:</span><span class="co"> true</span></span>
<span id="cb4-14"><a href="#cb4-14" aria-hidden="true" tabindex="-1"></a><span class="an">toc-depth:</span><span class="co"> 4</span></span>
<span id="cb4-15"><a href="#cb4-15" aria-hidden="true" tabindex="-1"></a><span class="an">format:</span></span>
<span id="cb4-16"><a href="#cb4-16" aria-hidden="true" tabindex="-1"></a><span class="co">  html:</span></span>
<span id="cb4-17"><a href="#cb4-17" aria-hidden="true" tabindex="-1"></a><span class="co">    shift-heading-level-by: 3</span></span>
<span id="cb4-18"><a href="#cb4-18" aria-hidden="true" tabindex="-1"></a><span class="co">    include-after-body:</span></span>
<span id="cb4-19"><a href="#cb4-19" aria-hidden="true" tabindex="-1"></a><span class="co">      - ../../asset/cite.html</span></span>
<span id="cb4-20"><a href="#cb4-20" aria-hidden="true" tabindex="-1"></a><span class="co">      - ../../asset/style.html</span></span>
<span id="cb4-21"><a href="#cb4-21" aria-hidden="true" tabindex="-1"></a><span class="co">      - ../../asset/stamp.html</span></span>
<span id="cb4-22"><a href="#cb4-22" aria-hidden="true" tabindex="-1"></a><span class="co">      - ../../asset/tooltip.html</span></span>
<span id="cb4-23"><a href="#cb4-23" aria-hidden="true" tabindex="-1"></a><span class="co">  commonmark: default</span></span>
<span id="cb4-24"><a href="#cb4-24" aria-hidden="true" tabindex="-1"></a><span class="an">filters:</span></span>
<span id="cb4-25"><a href="#cb4-25" aria-hidden="true" tabindex="-1"></a><span class="co">  - ../../asset/date.lua</span></span>
<span id="cb4-26"><a href="#cb4-26" aria-hidden="true" tabindex="-1"></a><span class="co">  - include-code-files</span></span>
<span id="cb4-27"><a href="#cb4-27" aria-hidden="true" tabindex="-1"></a><span class="co">---</span></span>
<span id="cb4-28"><a href="#cb4-28" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-29"><a href="#cb4-29" aria-hidden="true" tabindex="-1"></a><span class="fu"># Time {.hiddenheading}</span></span>
<span id="cb4-30"><a href="#cb4-30" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-31"><a href="#cb4-31" aria-hidden="true" tabindex="-1"></a>My website provides many examples of the <span class="co">[</span><span class="ot">Quarto</span><span class="co">](https://quarto.org)</span> publishing and the <span class="co">[</span><span class="ot">Dec</span><span class="co">](/dec)</span> measurement systems in action. I leverage Quarto support for the <span class="co">[</span><span class="ot">Observable</span><span class="co">](https://observablehq.com/)</span> data analysis and visualization system to create animated and interactive graphics like the clocksüïìand barüìächarts below, which display a Dec time like the one on the left side of the <span class="co">[</span><span class="ot">navigation bar</span><span class="co">](https://en.wikipedia.org/wiki/Navigation_bar#:~:text=a%20section%20of%20a%20graphical%20user%20interface%20intended%20to%20aid%20visitors%20in%20accessing%20information)</span> (navbar) above.</span>
<span id="cb4-32"><a href="#cb4-32" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-33"><a href="#cb4-33" aria-hidden="true" tabindex="-1"></a>Dec times are measured in <span class="co">[</span><span class="ot">fractional days</span><span class="co">](https://en.wikipedia.org/wiki/Decimal_time#Fractional_days:~:text=a%20decimal%20fraction%20of%20a%20day)</span>. The shortest, longest, and thinnest clocküïìhands and the top, middle, and bottom barsüìäindicate the <span class="co">[</span><span class="ot">decidays</span><span class="co">](https://en.wikipedia.org/wiki/Decimal_time#:~:text=dividing%20the%20day%20into%2010%20decidays)</span>{.under .tool data-bs-toggle="tooltip" data-bs-title="tenths of a day"}, <span class="co">[</span><span class="ot">millidays</span><span class="co">]</span>{.under .tool data-bs-toggle="tooltip" data-bs-title="thousandths of a day"}, and <span class="co">[</span><span class="ot">centimillidays</span><span class="co">]</span>{.under .tool data-bs-toggle="tooltip" data-bs-title="hundred thousandths of a day"}, respectively, of the time since the start, <span class="co">[</span><span class="ot">+\${decTime}</span><span class="co">]</span>{.cyan}, or until the end, <span class="co">[</span><span class="ot">-\${decTimeN}</span><span class="co">]</span>{.pink}, of the day in the Dec time zone, <span class="co">[</span><span class="ot">\${selectedZone}</span><span class="co">]</span>{.lime}, selected by the red‚≠ïÔ∏ècircle on the <span class="co">[</span><span class="ot">solar‚òÄÔ∏èterminator</span><span class="co">](https://en.wikipedia.org/wiki/Terminator_%28solar%29#:~:text=a%20moving%20line%20that%20divides%20the%20daylit%20side%20and%20the%20dark%20night%20side%20of%20a%20planetary%20body)</span> mapüó∫Ô∏èbeneath the  barsüìä.</span>
<span id="cb4-34"><a href="#cb4-34" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-35"><a href="#cb4-35" aria-hidden="true" tabindex="-1"></a>:::{.clocks}</span>
<span id="cb4-36"><a href="#cb4-36" aria-hidden="true" tabindex="-1"></a>\${clock}\${clock1}</span>
<span id="cb4-37"><a href="#cb4-37" aria-hidden="true" tabindex="-1"></a>:::</span>
<span id="cb4-38"><a href="#cb4-38" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-41"><a href="#cb4-41" aria-hidden="true" tabindex="-1"></a><span class="in">```{ojs}</span></span>
<span id="cb4-42"><a href="#cb4-42" aria-hidden="true" tabindex="-1"></a><span class="in">//| echo: false</span></span>
<span id="cb4-43"><a href="#cb4-43" aria-hidden="true" tabindex="-1"></a><span class="in">// https://observablehq.com/@fheyen/barchart-clock</span></span>
<span id="cb4-44"><a href="#cb4-44" aria-hidden="true" tabindex="-1"></a><span class="in">barChart = {</span></span>
<span id="cb4-45"><a href="#cb4-45" aria-hidden="true" tabindex="-1"></a><span class="in">const W = width;</span></span>
<span id="cb4-46"><a href="#cb4-46" aria-hidden="true" tabindex="-1"></a><span class="in">  const H = 88;</span></span>
<span id="cb4-47"><a href="#cb4-47" aria-hidden="true" tabindex="-1"></a><span class="in">  const barX = 1;</span></span>
<span id="cb4-48"><a href="#cb4-48" aria-hidden="true" tabindex="-1"></a><span class="in">  const firstBarY = 1;</span></span>
<span id="cb4-49"><a href="#cb4-49" aria-hidden="true" tabindex="-1"></a><span class="in">  const svg = d3</span></span>
<span id="cb4-50"><a href="#cb4-50" aria-hidden="true" tabindex="-1"></a><span class="in">    .create("svg")</span></span>
<span id="cb4-51"><a href="#cb4-51" aria-hidden="true" tabindex="-1"></a><span class="in">    .attr("width", W)</span></span>
<span id="cb4-52"><a href="#cb4-52" aria-hidden="true" tabindex="-1"></a><span class="in">    .attr("viewBox", [0, 0, W * (W &lt; 370 ? .73 : W &lt; 420 ? .76 : W &lt; 470 ? .79 : W &lt; 520 ? .81 : W &lt; 570 ? .83 : W &lt; 620 ? .84 : W &lt; 670 ? .85 : W &lt; 720 ? .86 : .87), H]);</span></span>
<span id="cb4-53"><a href="#cb4-53" aria-hidden="true" tabindex="-1"></a><span class="in">  const xRange = [0, W - 100];</span></span>
<span id="cb4-54"><a href="#cb4-54" aria-hidden="true" tabindex="-1"></a><span class="in">  const scaleDD = d3.scaleLinear()</span></span>
<span id="cb4-55"><a href="#cb4-55" aria-hidden="true" tabindex="-1"></a><span class="in">    .domain([0, 10])</span></span>
<span id="cb4-56"><a href="#cb4-56" aria-hidden="true" tabindex="-1"></a><span class="in">    .range(xRange);</span></span>
<span id="cb4-57"><a href="#cb4-57" aria-hidden="true" tabindex="-1"></a><span class="in">  const scaleMandB = d3.scaleLinear()</span></span>
<span id="cb4-58"><a href="#cb4-58" aria-hidden="true" tabindex="-1"></a><span class="in">    .domain([0, 100])</span></span>
<span id="cb4-59"><a href="#cb4-59" aria-hidden="true" tabindex="-1"></a><span class="in">    .range(xRange);</span></span>
<span id="cb4-60"><a href="#cb4-60" aria-hidden="true" tabindex="-1"></a><span class="in">  // Background bars to show where 100% lies</span></span>
<span id="cb4-61"><a href="#cb4-61" aria-hidden="true" tabindex="-1"></a><span class="in">  svg.selectAll('.background')</span></span>
<span id="cb4-62"><a href="#cb4-62" aria-hidden="true" tabindex="-1"></a><span class="in">    .data([</span></span>
<span id="cb4-63"><a href="#cb4-63" aria-hidden="true" tabindex="-1"></a><span class="in">      'dd', "mils", 'beats'])</span></span>
<span id="cb4-64"><a href="#cb4-64" aria-hidden="true" tabindex="-1"></a><span class="in">    .enter()</span></span>
<span id="cb4-65"><a href="#cb4-65" aria-hidden="true" tabindex="-1"></a><span class="in">    .append('rect')</span></span>
<span id="cb4-66"><a href="#cb4-66" aria-hidden="true" tabindex="-1"></a><span class="in">    .attr('class', 'background timeBar')</span></span>
<span id="cb4-67"><a href="#cb4-67" aria-hidden="true" tabindex="-1"></a><span class="in">    .attr('width', W-100)</span></span>
<span id="cb4-68"><a href="#cb4-68" aria-hidden="true" tabindex="-1"></a><span class="in">    .attr('y', (d,i)=&gt;i*30+firstBarY)</span></span>
<span id="cb4-69"><a href="#cb4-69" aria-hidden="true" tabindex="-1"></a><span class="in">  // Beats</span></span>
<span id="cb4-70"><a href="#cb4-70" aria-hidden="true" tabindex="-1"></a><span class="in">  svg</span></span>
<span id="cb4-71"><a href="#cb4-71" aria-hidden="true" tabindex="-1"></a><span class="in">    .append('rect')</span></span>
<span id="cb4-72"><a href="#cb4-72" aria-hidden="true" tabindex="-1"></a><span class="in">    .attr('class', 'timeBar')</span></span>
<span id="cb4-73"><a href="#cb4-73" aria-hidden="true" tabindex="-1"></a><span class="in">    .attr('y', firstBarY+60)</span></span>
<span id="cb4-74"><a href="#cb4-74" aria-hidden="true" tabindex="-1"></a><span class="in">    .attr('width', d =&gt; scaleMandB(Number(barBeats)))</span></span>
<span id="cb4-75"><a href="#cb4-75" aria-hidden="true" tabindex="-1"></a><span class="in">  svg</span></span>
<span id="cb4-76"><a href="#cb4-76" aria-hidden="true" tabindex="-1"></a><span class="in">    .append('rect')</span></span>
<span id="cb4-77"><a href="#cb4-77" aria-hidden="true" tabindex="-1"></a><span class="in">    .attr('class', 'timeBarFull')</span></span>
<span id="cb4-78"><a href="#cb4-78" aria-hidden="true" tabindex="-1"></a><span class="in">    .attr('y', firstBarY+60)</span></span>
<span id="cb4-79"><a href="#cb4-79" aria-hidden="true" tabindex="-1"></a><span class="in">    .attr('width', d =&gt; scaleMandB(barBeats))</span></span>
<span id="cb4-80"><a href="#cb4-80" aria-hidden="true" tabindex="-1"></a><span class="in">  // Cents/Mils</span></span>
<span id="cb4-81"><a href="#cb4-81" aria-hidden="true" tabindex="-1"></a><span class="in">  svg</span></span>
<span id="cb4-82"><a href="#cb4-82" aria-hidden="true" tabindex="-1"></a><span class="in">    .append('rect')</span></span>
<span id="cb4-83"><a href="#cb4-83" aria-hidden="true" tabindex="-1"></a><span class="in">    .attr('class', 'timeBar')</span></span>
<span id="cb4-84"><a href="#cb4-84" aria-hidden="true" tabindex="-1"></a><span class="in">    .attr('y', firstBarY)</span></span>
<span id="cb4-85"><a href="#cb4-85" aria-hidden="true" tabindex="-1"></a><span class="in">    .attr('width', d =&gt; scaleDD(Number(barDD)+Number(barMils)/100+Number(barBeats)/10000))</span></span>
<span id="cb4-86"><a href="#cb4-86" aria-hidden="true" tabindex="-1"></a><span class="in">  svg</span></span>
<span id="cb4-87"><a href="#cb4-87" aria-hidden="true" tabindex="-1"></a><span class="in">    .append('rect')</span></span>
<span id="cb4-88"><a href="#cb4-88" aria-hidden="true" tabindex="-1"></a><span class="in">    .attr('class', 'timeBarFull')</span></span>
<span id="cb4-89"><a href="#cb4-89" aria-hidden="true" tabindex="-1"></a><span class="in">    .attr('y', firstBarY)</span></span>
<span id="cb4-90"><a href="#cb4-90" aria-hidden="true" tabindex="-1"></a><span class="in">    .attr('width', d =&gt; scaleDD(barDD))</span></span>
<span id="cb4-91"><a href="#cb4-91" aria-hidden="true" tabindex="-1"></a><span class="in">  svg</span></span>
<span id="cb4-92"><a href="#cb4-92" aria-hidden="true" tabindex="-1"></a><span class="in">    .append('rect')</span></span>
<span id="cb4-93"><a href="#cb4-93" aria-hidden="true" tabindex="-1"></a><span class="in">    .attr('class', 'timeBar')</span></span>
<span id="cb4-94"><a href="#cb4-94" aria-hidden="true" tabindex="-1"></a><span class="in">    .attr('y', firstBarY+30)</span></span>
<span id="cb4-95"><a href="#cb4-95" aria-hidden="true" tabindex="-1"></a><span class="in">    .attr('width', d =&gt; scaleMandB(Number(barMils)+Number(barBeats)/100))</span></span>
<span id="cb4-96"><a href="#cb4-96" aria-hidden="true" tabindex="-1"></a><span class="in">  svg</span></span>
<span id="cb4-97"><a href="#cb4-97" aria-hidden="true" tabindex="-1"></a><span class="in">    .append('rect')</span></span>
<span id="cb4-98"><a href="#cb4-98" aria-hidden="true" tabindex="-1"></a><span class="in">    .attr('class', 'timeBarFull')</span></span>
<span id="cb4-99"><a href="#cb4-99" aria-hidden="true" tabindex="-1"></a><span class="in">    .attr('y', firstBarY+30)</span></span>
<span id="cb4-100"><a href="#cb4-100" aria-hidden="true" tabindex="-1"></a><span class="in">    .attr('width', d =&gt; scaleMandB(barMils))</span></span>
<span id="cb4-101"><a href="#cb4-101" aria-hidden="true" tabindex="-1"></a><span class="in">  // Cent ticks</span></span>
<span id="cb4-102"><a href="#cb4-102" aria-hidden="true" tabindex="-1"></a><span class="in">  svg.selectAll('.tickC')</span></span>
<span id="cb4-103"><a href="#cb4-103" aria-hidden="true" tabindex="-1"></a><span class="in">    .data(d3.range(width &gt; 500 ? 10 : 10, 100))</span></span>
<span id="cb4-104"><a href="#cb4-104" aria-hidden="true" tabindex="-1"></a><span class="in">    .enter()</span></span>
<span id="cb4-105"><a href="#cb4-105" aria-hidden="true" tabindex="-1"></a><span class="in">    .append('rect')</span></span>
<span id="cb4-106"><a href="#cb4-106" aria-hidden="true" tabindex="-1"></a><span class="in">    .attr('class', 'tickC')</span></span>
<span id="cb4-107"><a href="#cb4-107" aria-hidden="true" tabindex="-1"></a><span class="in">    .attr('x', d=&gt;scaleDD(d/10)+barX)</span></span>
<span id="cb4-108"><a href="#cb4-108" aria-hidden="true" tabindex="-1"></a><span class="in">    .attr('y', firstBarY+30)</span></span>
<span id="cb4-109"><a href="#cb4-109" aria-hidden="true" tabindex="-1"></a><span class="in">    .attr('height', d=&gt;d%2===0? 8:5)</span></span>
<span id="cb4-110"><a href="#cb4-110" aria-hidden="true" tabindex="-1"></a><span class="in">  svg.selectAll('.tickB1')</span></span>
<span id="cb4-111"><a href="#cb4-111" aria-hidden="true" tabindex="-1"></a><span class="in">    .data(d3.range(width &gt; 500 ? 10 : 10, 100))</span></span>
<span id="cb4-112"><a href="#cb4-112" aria-hidden="true" tabindex="-1"></a><span class="in">    .enter()</span></span>
<span id="cb4-113"><a href="#cb4-113" aria-hidden="true" tabindex="-1"></a><span class="in">    .append('rect')</span></span>
<span id="cb4-114"><a href="#cb4-114" aria-hidden="true" tabindex="-1"></a><span class="in">    .attr('class', 'tickB1')</span></span>
<span id="cb4-115"><a href="#cb4-115" aria-hidden="true" tabindex="-1"></a><span class="in">    .attr('x', d=&gt;scaleDD(d/10)+barX)</span></span>
<span id="cb4-116"><a href="#cb4-116" aria-hidden="true" tabindex="-1"></a><span class="in">    .attr('y', d=&gt;d%2===0? firstBarY+77:firstBarY+80)</span></span>
<span id="cb4-117"><a href="#cb4-117" aria-hidden="true" tabindex="-1"></a><span class="in">    .attr('height', d=&gt;d%2===0? 8:5)</span></span>
<span id="cb4-118"><a href="#cb4-118" aria-hidden="true" tabindex="-1"></a><span class="in">  svg.selectAll('.tickC1')</span></span>
<span id="cb4-119"><a href="#cb4-119" aria-hidden="true" tabindex="-1"></a><span class="in">    .data(d3.range(width &gt; 500 ? 10 : 10, 100))</span></span>
<span id="cb4-120"><a href="#cb4-120" aria-hidden="true" tabindex="-1"></a><span class="in">    .enter()</span></span>
<span id="cb4-121"><a href="#cb4-121" aria-hidden="true" tabindex="-1"></a><span class="in">    .append('rect')</span></span>
<span id="cb4-122"><a href="#cb4-122" aria-hidden="true" tabindex="-1"></a><span class="in">    .attr('class', 'tickC1')</span></span>
<span id="cb4-123"><a href="#cb4-123" aria-hidden="true" tabindex="-1"></a><span class="in">    .attr('x', d=&gt;scaleDD(d/10)+barX)</span></span>
<span id="cb4-124"><a href="#cb4-124" aria-hidden="true" tabindex="-1"></a><span class="in">    .attr('y', d=&gt;d%2===0? firstBarY+47:firstBarY+50)</span></span>
<span id="cb4-125"><a href="#cb4-125" aria-hidden="true" tabindex="-1"></a><span class="in">    .attr('height', d=&gt;d%2===0? 8:5)</span></span>
<span id="cb4-126"><a href="#cb4-126" aria-hidden="true" tabindex="-1"></a><span class="in">  // Mil ticks</span></span>
<span id="cb4-127"><a href="#cb4-127" aria-hidden="true" tabindex="-1"></a><span class="in">  svg.selectAll('.tickM')</span></span>
<span id="cb4-128"><a href="#cb4-128" aria-hidden="true" tabindex="-1"></a><span class="in">    .data(d3.range(width &gt; 500 ? 1 : 1, 10))</span></span>
<span id="cb4-129"><a href="#cb4-129" aria-hidden="true" tabindex="-1"></a><span class="in">    .enter()</span></span>
<span id="cb4-130"><a href="#cb4-130" aria-hidden="true" tabindex="-1"></a><span class="in">    .append('rect')</span></span>
<span id="cb4-131"><a href="#cb4-131" aria-hidden="true" tabindex="-1"></a><span class="in">    .attr('class', 'tickM')</span></span>
<span id="cb4-132"><a href="#cb4-132" aria-hidden="true" tabindex="-1"></a><span class="in">    .attr('x', d=&gt;scaleDD(d)+barX)</span></span>
<span id="cb4-133"><a href="#cb4-133" aria-hidden="true" tabindex="-1"></a><span class="in">    .attr('y', firstBarY+20)</span></span>
<span id="cb4-134"><a href="#cb4-134" aria-hidden="true" tabindex="-1"></a><span class="in">    .attr('height', 6)</span></span>
<span id="cb4-135"><a href="#cb4-135" aria-hidden="true" tabindex="-1"></a><span class="in">  svg.selectAll('.tickLabel1')</span></span>
<span id="cb4-136"><a href="#cb4-136" aria-hidden="true" tabindex="-1"></a><span class="in">    .data(d3.range(width &gt; 500 ? 1 : 1, 10))</span></span>
<span id="cb4-137"><a href="#cb4-137" aria-hidden="true" tabindex="-1"></a><span class="in">    .enter()</span></span>
<span id="cb4-138"><a href="#cb4-138" aria-hidden="true" tabindex="-1"></a><span class="in">    .append('text')</span></span>
<span id="cb4-139"><a href="#cb4-139" aria-hidden="true" tabindex="-1"></a><span class="in">    .attr('class', 'tickLabel1')</span></span>
<span id="cb4-140"><a href="#cb4-140" aria-hidden="true" tabindex="-1"></a><span class="in">    .attr('x', d=&gt;scaleDD(d)+barX+.5)</span></span>
<span id="cb4-141"><a href="#cb4-141" aria-hidden="true" tabindex="-1"></a><span class="in">    .attr('y', firstBarY+18)</span></span>
<span id="cb4-142"><a href="#cb4-142" aria-hidden="true" tabindex="-1"></a><span class="in">    //.style("font-size", `{W &lt; 550 ? 12 : W &lt; 650 ? 14 : W &lt; 750 ? 16 : W &lt; 850 ? 18 : 20}px`)</span></span>
<span id="cb4-143"><a href="#cb4-143" aria-hidden="true" tabindex="-1"></a><span class="in">    .text(d=&gt;d)</span></span>
<span id="cb4-144"><a href="#cb4-144" aria-hidden="true" tabindex="-1"></a><span class="in">  // Cent ticks</span></span>
<span id="cb4-145"><a href="#cb4-145" aria-hidden="true" tabindex="-1"></a><span class="in">  svg.selectAll('.tickC2')</span></span>
<span id="cb4-146"><a href="#cb4-146" aria-hidden="true" tabindex="-1"></a><span class="in">    .data(d3.range(width &gt; 500 ? 10 : 10, 100))</span></span>
<span id="cb4-147"><a href="#cb4-147" aria-hidden="true" tabindex="-1"></a><span class="in">    .enter()</span></span>
<span id="cb4-148"><a href="#cb4-148" aria-hidden="true" tabindex="-1"></a><span class="in">    .append('rect')</span></span>
<span id="cb4-149"><a href="#cb4-149" aria-hidden="true" tabindex="-1"></a><span class="in">    .attr('class', 'tickC2')</span></span>
<span id="cb4-150"><a href="#cb4-150" aria-hidden="true" tabindex="-1"></a><span class="in">    .attr('x', d=&gt;scaleDD(d/10)+barX)</span></span>
<span id="cb4-151"><a href="#cb4-151" aria-hidden="true" tabindex="-1"></a><span class="in">    .attr('y', firstBarY+10)</span></span>
<span id="cb4-152"><a href="#cb4-152" aria-hidden="true" tabindex="-1"></a><span class="in">    .attr('height', d=&gt;d%2===0? 9:6)</span></span>
<span id="cb4-153"><a href="#cb4-153" aria-hidden="true" tabindex="-1"></a><span class="in">  // Beat ticks</span></span>
<span id="cb4-154"><a href="#cb4-154" aria-hidden="true" tabindex="-1"></a><span class="in">  svg.selectAll('.tickB')</span></span>
<span id="cb4-155"><a href="#cb4-155" aria-hidden="true" tabindex="-1"></a><span class="in">    .data(d3.range(width &gt; 500 ? 10 : 10, 100))</span></span>
<span id="cb4-156"><a href="#cb4-156" aria-hidden="true" tabindex="-1"></a><span class="in">    .enter()</span></span>
<span id="cb4-157"><a href="#cb4-157" aria-hidden="true" tabindex="-1"></a><span class="in">    .append('rect')</span></span>
<span id="cb4-158"><a href="#cb4-158" aria-hidden="true" tabindex="-1"></a><span class="in">    .attr('class', 'tickB')</span></span>
<span id="cb4-159"><a href="#cb4-159" aria-hidden="true" tabindex="-1"></a><span class="in">    .attr('x', d=&gt;scaleDD(d/10)+barX)</span></span>
<span id="cb4-160"><a href="#cb4-160" aria-hidden="true" tabindex="-1"></a><span class="in">    .attr('y', firstBarY+60)</span></span>
<span id="cb4-161"><a href="#cb4-161" aria-hidden="true" tabindex="-1"></a><span class="in">    .attr('height', d=&gt;d%2===0? 9:6)</span></span>
<span id="cb4-162"><a href="#cb4-162" aria-hidden="true" tabindex="-1"></a><span class="in">  // Labels</span></span>
<span id="cb4-163"><a href="#cb4-163" aria-hidden="true" tabindex="-1"></a><span class="in">  svg.selectAll('.timeLabel')</span></span>
<span id="cb4-164"><a href="#cb4-164" aria-hidden="true" tabindex="-1"></a><span class="in">    .data([`+${barDD}`, `${barMils}`, `${barBeats}`])</span></span>
<span id="cb4-165"><a href="#cb4-165" aria-hidden="true" tabindex="-1"></a><span class="in">    .enter()</span></span>
<span id="cb4-166"><a href="#cb4-166" aria-hidden="true" tabindex="-1"></a><span class="in">    .append('text')</span></span>
<span id="cb4-167"><a href="#cb4-167" aria-hidden="true" tabindex="-1"></a><span class="in">    .attr('class', 'timeLabel')</span></span>
<span id="cb4-168"><a href="#cb4-168" aria-hidden="true" tabindex="-1"></a><span class="in">    .attr('x', barX+2)</span></span>
<span id="cb4-169"><a href="#cb4-169" aria-hidden="true" tabindex="-1"></a><span class="in">    .attr('y', (d,i)=&gt;i*30+firstBarY+20)</span></span>
<span id="cb4-170"><a href="#cb4-170" aria-hidden="true" tabindex="-1"></a><span class="in">    .style("font-size", `${W &lt; 300 ? 14 : W &lt; 400 ? 16 : W &lt; 500 ? 18 : W &lt; 600 ? 20 : 22}px`)</span></span>
<span id="cb4-171"><a href="#cb4-171" aria-hidden="true" tabindex="-1"></a><span class="in">    .text(d=&gt;d);</span></span>
<span id="cb4-172"><a href="#cb4-172" aria-hidden="true" tabindex="-1"></a><span class="in">  svg.attr("id", "barClock");</span></span>
<span id="cb4-173"><a href="#cb4-173" aria-hidden="true" tabindex="-1"></a><span class="in">  return svg.node();</span></span>
<span id="cb4-174"><a href="#cb4-174" aria-hidden="true" tabindex="-1"></a><span class="in">}</span></span>
<span id="cb4-175"><a href="#cb4-175" aria-hidden="true" tabindex="-1"></a><span class="in">barChart1 = {</span></span>
<span id="cb4-176"><a href="#cb4-176" aria-hidden="true" tabindex="-1"></a><span class="in">const W = width;</span></span>
<span id="cb4-177"><a href="#cb4-177" aria-hidden="true" tabindex="-1"></a><span class="in">  const H = 88;</span></span>
<span id="cb4-178"><a href="#cb4-178" aria-hidden="true" tabindex="-1"></a><span class="in">  const barX = 1;</span></span>
<span id="cb4-179"><a href="#cb4-179" aria-hidden="true" tabindex="-1"></a><span class="in">  const firstBarY = 1;</span></span>
<span id="cb4-180"><a href="#cb4-180" aria-hidden="true" tabindex="-1"></a><span class="in">  const svg = d3</span></span>
<span id="cb4-181"><a href="#cb4-181" aria-hidden="true" tabindex="-1"></a><span class="in">    .create("svg")</span></span>
<span id="cb4-182"><a href="#cb4-182" aria-hidden="true" tabindex="-1"></a><span class="in">    .attr("width", W)</span></span>
<span id="cb4-183"><a href="#cb4-183" aria-hidden="true" tabindex="-1"></a><span class="in">    .attr("viewBox", [0, 0, W * (W &lt; 370 ? .73 : W &lt; 420 ? .76 : W &lt; 470 ? .79 : W &lt; 520 ? .81 : W &lt; 570 ? .83 : W &lt; 620 ? .84 : W &lt; 670 ? .85 : W &lt; 720 ? .86 : .87), H]);</span></span>
<span id="cb4-184"><a href="#cb4-184" aria-hidden="true" tabindex="-1"></a><span class="in">  const xRange = [0, W - 100];</span></span>
<span id="cb4-185"><a href="#cb4-185" aria-hidden="true" tabindex="-1"></a><span class="in">  const scaleDD = d3.scaleLinear()</span></span>
<span id="cb4-186"><a href="#cb4-186" aria-hidden="true" tabindex="-1"></a><span class="in">    .domain([0, 10])</span></span>
<span id="cb4-187"><a href="#cb4-187" aria-hidden="true" tabindex="-1"></a><span class="in">    .range(xRange);</span></span>
<span id="cb4-188"><a href="#cb4-188" aria-hidden="true" tabindex="-1"></a><span class="in">  const scaleMandB = d3.scaleLinear()</span></span>
<span id="cb4-189"><a href="#cb4-189" aria-hidden="true" tabindex="-1"></a><span class="in">    .domain([0, 100])</span></span>
<span id="cb4-190"><a href="#cb4-190" aria-hidden="true" tabindex="-1"></a><span class="in">    .range(xRange);</span></span>
<span id="cb4-191"><a href="#cb4-191" aria-hidden="true" tabindex="-1"></a><span class="in">  // const scaleDek = d3.scaleLinear()</span></span>
<span id="cb4-192"><a href="#cb4-192" aria-hidden="true" tabindex="-1"></a><span class="in">  //  .domain([0, 37])</span></span>
<span id="cb4-193"><a href="#cb4-193" aria-hidden="true" tabindex="-1"></a><span class="in">  //  .range(xRange);</span></span>
<span id="cb4-194"><a href="#cb4-194" aria-hidden="true" tabindex="-1"></a><span class="in">  // Background bars to show where 100% lies</span></span>
<span id="cb4-195"><a href="#cb4-195" aria-hidden="true" tabindex="-1"></a><span class="in">  svg.selectAll('.background')</span></span>
<span id="cb4-196"><a href="#cb4-196" aria-hidden="true" tabindex="-1"></a><span class="in">    .data([</span></span>
<span id="cb4-197"><a href="#cb4-197" aria-hidden="true" tabindex="-1"></a><span class="in">      // 'dek', 'dotd',</span></span>
<span id="cb4-198"><a href="#cb4-198" aria-hidden="true" tabindex="-1"></a><span class="in">      'dd', "mils", 'beats'])</span></span>
<span id="cb4-199"><a href="#cb4-199" aria-hidden="true" tabindex="-1"></a><span class="in">    .enter()</span></span>
<span id="cb4-200"><a href="#cb4-200" aria-hidden="true" tabindex="-1"></a><span class="in">    .append('rect')</span></span>
<span id="cb4-201"><a href="#cb4-201" aria-hidden="true" tabindex="-1"></a><span class="in">    .attr('class', 'background timeBar')</span></span>
<span id="cb4-202"><a href="#cb4-202" aria-hidden="true" tabindex="-1"></a><span class="in">    .attr('width', W-100)</span></span>
<span id="cb4-203"><a href="#cb4-203" aria-hidden="true" tabindex="-1"></a><span class="in">    .attr('y', (d,i)=&gt;i*30+firstBarY)</span></span>
<span id="cb4-204"><a href="#cb4-204" aria-hidden="true" tabindex="-1"></a><span class="in">  // Beats</span></span>
<span id="cb4-205"><a href="#cb4-205" aria-hidden="true" tabindex="-1"></a><span class="in">  svg</span></span>
<span id="cb4-206"><a href="#cb4-206" aria-hidden="true" tabindex="-1"></a><span class="in">    .append('rect')</span></span>
<span id="cb4-207"><a href="#cb4-207" aria-hidden="true" tabindex="-1"></a><span class="in">    .attr('class', 'timeBar')</span></span>
<span id="cb4-208"><a href="#cb4-208" aria-hidden="true" tabindex="-1"></a><span class="in">    .attr('y', firstBarY+60)</span></span>
<span id="cb4-209"><a href="#cb4-209" aria-hidden="true" tabindex="-1"></a><span class="in">    .attr('width', d =&gt; scaleMandB(Number(barBeatsN)))</span></span>
<span id="cb4-210"><a href="#cb4-210" aria-hidden="true" tabindex="-1"></a><span class="in">  svg</span></span>
<span id="cb4-211"><a href="#cb4-211" aria-hidden="true" tabindex="-1"></a><span class="in">    .append('rect')</span></span>
<span id="cb4-212"><a href="#cb4-212" aria-hidden="true" tabindex="-1"></a><span class="in">    .attr('class', 'timeBarFullN')</span></span>
<span id="cb4-213"><a href="#cb4-213" aria-hidden="true" tabindex="-1"></a><span class="in">    .attr('y', firstBarY+60)</span></span>
<span id="cb4-214"><a href="#cb4-214" aria-hidden="true" tabindex="-1"></a><span class="in">    .attr('width', d =&gt; scaleMandB(barBeatsN))</span></span>
<span id="cb4-215"><a href="#cb4-215" aria-hidden="true" tabindex="-1"></a><span class="in">  // Cents/Mils</span></span>
<span id="cb4-216"><a href="#cb4-216" aria-hidden="true" tabindex="-1"></a><span class="in">  svg</span></span>
<span id="cb4-217"><a href="#cb4-217" aria-hidden="true" tabindex="-1"></a><span class="in">    .append('rect')</span></span>
<span id="cb4-218"><a href="#cb4-218" aria-hidden="true" tabindex="-1"></a><span class="in">    .attr('class', 'timeBar')</span></span>
<span id="cb4-219"><a href="#cb4-219" aria-hidden="true" tabindex="-1"></a><span class="in">    .attr('y', firstBarY)</span></span>
<span id="cb4-220"><a href="#cb4-220" aria-hidden="true" tabindex="-1"></a><span class="in">    .attr('width', d =&gt; scaleDD(Number(barDDN)+Number(barMilsN)/100+Number(barBeatsN)/10000))</span></span>
<span id="cb4-221"><a href="#cb4-221" aria-hidden="true" tabindex="-1"></a><span class="in">  svg</span></span>
<span id="cb4-222"><a href="#cb4-222" aria-hidden="true" tabindex="-1"></a><span class="in">    .append('rect')</span></span>
<span id="cb4-223"><a href="#cb4-223" aria-hidden="true" tabindex="-1"></a><span class="in">    .attr('class', 'timeBarFullN')</span></span>
<span id="cb4-224"><a href="#cb4-224" aria-hidden="true" tabindex="-1"></a><span class="in">    .attr('y', firstBarY)</span></span>
<span id="cb4-225"><a href="#cb4-225" aria-hidden="true" tabindex="-1"></a><span class="in">    .attr('width', d =&gt; scaleDD(barDDN))</span></span>
<span id="cb4-226"><a href="#cb4-226" aria-hidden="true" tabindex="-1"></a><span class="in">  svg</span></span>
<span id="cb4-227"><a href="#cb4-227" aria-hidden="true" tabindex="-1"></a><span class="in">    .append('rect')</span></span>
<span id="cb4-228"><a href="#cb4-228" aria-hidden="true" tabindex="-1"></a><span class="in">    .attr('class', 'timeBar')</span></span>
<span id="cb4-229"><a href="#cb4-229" aria-hidden="true" tabindex="-1"></a><span class="in">    .attr('y', firstBarY+30)</span></span>
<span id="cb4-230"><a href="#cb4-230" aria-hidden="true" tabindex="-1"></a><span class="in">    .attr('width', d =&gt; scaleMandB(Number(barMilsN)+Number(barBeatsN)/100))</span></span>
<span id="cb4-231"><a href="#cb4-231" aria-hidden="true" tabindex="-1"></a><span class="in">  svg</span></span>
<span id="cb4-232"><a href="#cb4-232" aria-hidden="true" tabindex="-1"></a><span class="in">    .append('rect')</span></span>
<span id="cb4-233"><a href="#cb4-233" aria-hidden="true" tabindex="-1"></a><span class="in">    .attr('class', 'timeBarFullN')</span></span>
<span id="cb4-234"><a href="#cb4-234" aria-hidden="true" tabindex="-1"></a><span class="in">    .attr('y', firstBarY+30)</span></span>
<span id="cb4-235"><a href="#cb4-235" aria-hidden="true" tabindex="-1"></a><span class="in">    .attr('width', d =&gt; scaleMandB(barMilsN))</span></span>
<span id="cb4-236"><a href="#cb4-236" aria-hidden="true" tabindex="-1"></a><span class="in">  // Cent ticks</span></span>
<span id="cb4-237"><a href="#cb4-237" aria-hidden="true" tabindex="-1"></a><span class="in">  svg.selectAll('.tickC')</span></span>
<span id="cb4-238"><a href="#cb4-238" aria-hidden="true" tabindex="-1"></a><span class="in">    .data(d3.range(width &gt; 500 ? 10 : 10, 100))</span></span>
<span id="cb4-239"><a href="#cb4-239" aria-hidden="true" tabindex="-1"></a><span class="in">    .enter()</span></span>
<span id="cb4-240"><a href="#cb4-240" aria-hidden="true" tabindex="-1"></a><span class="in">    .append('rect')</span></span>
<span id="cb4-241"><a href="#cb4-241" aria-hidden="true" tabindex="-1"></a><span class="in">    .attr('class', 'tickC')</span></span>
<span id="cb4-242"><a href="#cb4-242" aria-hidden="true" tabindex="-1"></a><span class="in">    .attr('x', d=&gt;scaleDD(d/10)+barX)</span></span>
<span id="cb4-243"><a href="#cb4-243" aria-hidden="true" tabindex="-1"></a><span class="in">    .attr('y', firstBarY+30)</span></span>
<span id="cb4-244"><a href="#cb4-244" aria-hidden="true" tabindex="-1"></a><span class="in">    .attr('height', d=&gt;d%2===0? 8:5)</span></span>
<span id="cb4-245"><a href="#cb4-245" aria-hidden="true" tabindex="-1"></a><span class="in">  svg.selectAll('.tickB1')</span></span>
<span id="cb4-246"><a href="#cb4-246" aria-hidden="true" tabindex="-1"></a><span class="in">    .data(d3.range(width &gt; 500 ? 10 : 10, 100))</span></span>
<span id="cb4-247"><a href="#cb4-247" aria-hidden="true" tabindex="-1"></a><span class="in">    .enter()</span></span>
<span id="cb4-248"><a href="#cb4-248" aria-hidden="true" tabindex="-1"></a><span class="in">    .append('rect')</span></span>
<span id="cb4-249"><a href="#cb4-249" aria-hidden="true" tabindex="-1"></a><span class="in">    .attr('class', 'tickB1')</span></span>
<span id="cb4-250"><a href="#cb4-250" aria-hidden="true" tabindex="-1"></a><span class="in">    .attr('x', d=&gt;scaleDD(d/10)+barX)</span></span>
<span id="cb4-251"><a href="#cb4-251" aria-hidden="true" tabindex="-1"></a><span class="in">    .attr('y', d=&gt;d%2===0? firstBarY+77:firstBarY+80)</span></span>
<span id="cb4-252"><a href="#cb4-252" aria-hidden="true" tabindex="-1"></a><span class="in">    .attr('height', d=&gt;d%2===0? 8:5)</span></span>
<span id="cb4-253"><a href="#cb4-253" aria-hidden="true" tabindex="-1"></a><span class="in">  svg.selectAll('.tickC1')</span></span>
<span id="cb4-254"><a href="#cb4-254" aria-hidden="true" tabindex="-1"></a><span class="in">    .data(d3.range(width &gt; 500 ? 10 : 10, 100))</span></span>
<span id="cb4-255"><a href="#cb4-255" aria-hidden="true" tabindex="-1"></a><span class="in">    .enter()</span></span>
<span id="cb4-256"><a href="#cb4-256" aria-hidden="true" tabindex="-1"></a><span class="in">    .append('rect')</span></span>
<span id="cb4-257"><a href="#cb4-257" aria-hidden="true" tabindex="-1"></a><span class="in">    .attr('class', 'tickC1')</span></span>
<span id="cb4-258"><a href="#cb4-258" aria-hidden="true" tabindex="-1"></a><span class="in">    .attr('x', d=&gt;scaleDD(d/10)+barX)</span></span>
<span id="cb4-259"><a href="#cb4-259" aria-hidden="true" tabindex="-1"></a><span class="in">    .attr('y', d=&gt;d%2===0? firstBarY+47:firstBarY+50)</span></span>
<span id="cb4-260"><a href="#cb4-260" aria-hidden="true" tabindex="-1"></a><span class="in">    .attr('height', d=&gt;d%2===0? 8:5)</span></span>
<span id="cb4-261"><a href="#cb4-261" aria-hidden="true" tabindex="-1"></a><span class="in">  // Mil ticks</span></span>
<span id="cb4-262"><a href="#cb4-262" aria-hidden="true" tabindex="-1"></a><span class="in">  svg.selectAll('.tickM')</span></span>
<span id="cb4-263"><a href="#cb4-263" aria-hidden="true" tabindex="-1"></a><span class="in">    .data(d3.range(width &gt; 500 ? 1 : 1, 10))</span></span>
<span id="cb4-264"><a href="#cb4-264" aria-hidden="true" tabindex="-1"></a><span class="in">    .enter()</span></span>
<span id="cb4-265"><a href="#cb4-265" aria-hidden="true" tabindex="-1"></a><span class="in">    .append('rect')</span></span>
<span id="cb4-266"><a href="#cb4-266" aria-hidden="true" tabindex="-1"></a><span class="in">    .attr('class', 'tickM')</span></span>
<span id="cb4-267"><a href="#cb4-267" aria-hidden="true" tabindex="-1"></a><span class="in">    .attr('x', d=&gt;scaleDD(d)+barX)</span></span>
<span id="cb4-268"><a href="#cb4-268" aria-hidden="true" tabindex="-1"></a><span class="in">    .attr('y', firstBarY+20)</span></span>
<span id="cb4-269"><a href="#cb4-269" aria-hidden="true" tabindex="-1"></a><span class="in">    .attr('height', 6)</span></span>
<span id="cb4-270"><a href="#cb4-270" aria-hidden="true" tabindex="-1"></a><span class="in">  svg.selectAll('.tickLabel1')</span></span>
<span id="cb4-271"><a href="#cb4-271" aria-hidden="true" tabindex="-1"></a><span class="in">    .data(d3.range(width &gt; 500 ? 1 : 1, 10))</span></span>
<span id="cb4-272"><a href="#cb4-272" aria-hidden="true" tabindex="-1"></a><span class="in">    .enter()</span></span>
<span id="cb4-273"><a href="#cb4-273" aria-hidden="true" tabindex="-1"></a><span class="in">    .append('text')</span></span>
<span id="cb4-274"><a href="#cb4-274" aria-hidden="true" tabindex="-1"></a><span class="in">    .attr('class', 'tickLabel1')</span></span>
<span id="cb4-275"><a href="#cb4-275" aria-hidden="true" tabindex="-1"></a><span class="in">    .attr('x', d=&gt;scaleDD(d)+barX+.5)</span></span>
<span id="cb4-276"><a href="#cb4-276" aria-hidden="true" tabindex="-1"></a><span class="in">    .attr('y', firstBarY+18)</span></span>
<span id="cb4-277"><a href="#cb4-277" aria-hidden="true" tabindex="-1"></a><span class="in">    //.style("font-size", `{W &lt; 350 ? 12 : W &lt; 450 ? 14 : W &lt; 550 ? 16 : W &lt; 650 ? 18 : 20}px`)</span></span>
<span id="cb4-278"><a href="#cb4-278" aria-hidden="true" tabindex="-1"></a><span class="in">    .text(d=&gt;d)</span></span>
<span id="cb4-279"><a href="#cb4-279" aria-hidden="true" tabindex="-1"></a><span class="in">  // Cent ticks</span></span>
<span id="cb4-280"><a href="#cb4-280" aria-hidden="true" tabindex="-1"></a><span class="in">  svg.selectAll('.tickC2')</span></span>
<span id="cb4-281"><a href="#cb4-281" aria-hidden="true" tabindex="-1"></a><span class="in">    .data(d3.range(width &gt; 500 ? 10 : 10, 100))</span></span>
<span id="cb4-282"><a href="#cb4-282" aria-hidden="true" tabindex="-1"></a><span class="in">    .enter()</span></span>
<span id="cb4-283"><a href="#cb4-283" aria-hidden="true" tabindex="-1"></a><span class="in">    .append('rect')</span></span>
<span id="cb4-284"><a href="#cb4-284" aria-hidden="true" tabindex="-1"></a><span class="in">    .attr('class', 'tickC2')</span></span>
<span id="cb4-285"><a href="#cb4-285" aria-hidden="true" tabindex="-1"></a><span class="in">    .attr('x', d=&gt;scaleDD(d/10)+barX)</span></span>
<span id="cb4-286"><a href="#cb4-286" aria-hidden="true" tabindex="-1"></a><span class="in">    .attr('y', firstBarY+10)</span></span>
<span id="cb4-287"><a href="#cb4-287" aria-hidden="true" tabindex="-1"></a><span class="in">    .attr('height', d=&gt;d%2===0? 9:6)</span></span>
<span id="cb4-288"><a href="#cb4-288" aria-hidden="true" tabindex="-1"></a><span class="in">  // Beat ticks</span></span>
<span id="cb4-289"><a href="#cb4-289" aria-hidden="true" tabindex="-1"></a><span class="in">  svg.selectAll('.tickB')</span></span>
<span id="cb4-290"><a href="#cb4-290" aria-hidden="true" tabindex="-1"></a><span class="in">    .data(d3.range(width &gt; 500 ? 10 : 10, 100))</span></span>
<span id="cb4-291"><a href="#cb4-291" aria-hidden="true" tabindex="-1"></a><span class="in">    .enter()</span></span>
<span id="cb4-292"><a href="#cb4-292" aria-hidden="true" tabindex="-1"></a><span class="in">    .append('rect')</span></span>
<span id="cb4-293"><a href="#cb4-293" aria-hidden="true" tabindex="-1"></a><span class="in">    .attr('class', 'tickB')</span></span>
<span id="cb4-294"><a href="#cb4-294" aria-hidden="true" tabindex="-1"></a><span class="in">    .attr('x', d=&gt;scaleDD(d/10)+barX)</span></span>
<span id="cb4-295"><a href="#cb4-295" aria-hidden="true" tabindex="-1"></a><span class="in">    .attr('y', firstBarY+60)</span></span>
<span id="cb4-296"><a href="#cb4-296" aria-hidden="true" tabindex="-1"></a><span class="in">    .attr('height', d=&gt;d%2===0? 9:6)</span></span>
<span id="cb4-297"><a href="#cb4-297" aria-hidden="true" tabindex="-1"></a><span class="in">  // Labels</span></span>
<span id="cb4-298"><a href="#cb4-298" aria-hidden="true" tabindex="-1"></a><span class="in">  svg.selectAll('.timeLabel')</span></span>
<span id="cb4-299"><a href="#cb4-299" aria-hidden="true" tabindex="-1"></a><span class="in">    .data([`-${barDDN}`, `${barMilsN}`, `${barBeatsN}`])</span></span>
<span id="cb4-300"><a href="#cb4-300" aria-hidden="true" tabindex="-1"></a><span class="in">    .enter()</span></span>
<span id="cb4-301"><a href="#cb4-301" aria-hidden="true" tabindex="-1"></a><span class="in">    .append('text')</span></span>
<span id="cb4-302"><a href="#cb4-302" aria-hidden="true" tabindex="-1"></a><span class="in">    .attr('class', 'timeLabel')</span></span>
<span id="cb4-303"><a href="#cb4-303" aria-hidden="true" tabindex="-1"></a><span class="in">    .attr('x', barX+2)</span></span>
<span id="cb4-304"><a href="#cb4-304" aria-hidden="true" tabindex="-1"></a><span class="in">    .attr('y', (d,i)=&gt;i*30+firstBarY+20)</span></span>
<span id="cb4-305"><a href="#cb4-305" aria-hidden="true" tabindex="-1"></a><span class="in">    .style("font-size", `${W &lt; 300 ? 14 : W &lt; 400 ? 16 : W &lt; 500 ? 18 : W &lt; 600 ? 20 : 22}px`)</span></span>
<span id="cb4-306"><a href="#cb4-306" aria-hidden="true" tabindex="-1"></a><span class="in">    .text(d=&gt;d);</span></span>
<span id="cb4-307"><a href="#cb4-307" aria-hidden="true" tabindex="-1"></a><span class="in">  svg.attr("id", "barClock");</span></span>
<span id="cb4-308"><a href="#cb4-308" aria-hidden="true" tabindex="-1"></a><span class="in">  return svg.node();</span></span>
<span id="cb4-309"><a href="#cb4-309" aria-hidden="true" tabindex="-1"></a><span class="in">}</span></span>
<span id="cb4-310"><a href="#cb4-310" aria-hidden="true" tabindex="-1"></a><span class="in">viewof location = worldMapCoordinates([162, 0], [width * .998, Math.round((21 / 40) * width)])</span></span>
<span id="cb4-311"><a href="#cb4-311" aria-hidden="true" tabindex="-1"></a><span class="in">// https://observablehq.com/@dbridges/visualizing-seasonal-daylight</span></span>
<span id="cb4-312"><a href="#cb4-312" aria-hidden="true" tabindex="-1"></a><span class="in">app = {</span></span>
<span id="cb4-313"><a href="#cb4-313" aria-hidden="true" tabindex="-1"></a><span class="in">const svg = d3.select(DOM.svg(width, height - (width &lt; 400 ? 10 : width &lt; 600 ? 15 : width &lt; 700 ? 30 : 40)));</span></span>
<span id="cb4-314"><a href="#cb4-314" aria-hidden="true" tabindex="-1"></a><span class="in">  svg.style("user-select", "none")</span></span>
<span id="cb4-315"><a href="#cb4-315" aria-hidden="true" tabindex="-1"></a><span class="in">     .style("-webkit-user-select", "none");</span></span>
<span id="cb4-316"><a href="#cb4-316" aria-hidden="true" tabindex="-1"></a><span class="in">  svg.attr("id", "daylightapp")</span></span>
<span id="cb4-317"><a href="#cb4-317" aria-hidden="true" tabindex="-1"></a><span class="in">  const margin = {top: 0, left: 10, right: 10, bottom: 0, inner: 3};</span></span>
<span id="cb4-318"><a href="#cb4-318" aria-hidden="true" tabindex="-1"></a><span class="in">  const contentWidth = width - margin.left - margin.right - margin.inner;</span></span>
<span id="cb4-319"><a href="#cb4-319" aria-hidden="true" tabindex="-1"></a><span class="in">  const columnWidth = contentWidth / 2;</span></span>
<span id="cb4-320"><a href="#cb4-320" aria-hidden="true" tabindex="-1"></a><span class="in">  const date2022 = new Date(2022, new Date().getMonth(), new Date().getDate(), new Date().getHours())</span></span>
<span id="cb4-321"><a href="#cb4-321" aria-hidden="true" tabindex="-1"></a><span class="in">  let selection = {</span></span>
<span id="cb4-322"><a href="#cb4-322" aria-hidden="true" tabindex="-1"></a><span class="in">    date: date2022,</span></span>
<span id="cb4-323"><a href="#cb4-323" aria-hidden="true" tabindex="-1"></a><span class="in">    hour: date2022.getHours()</span></span>
<span id="cb4-324"><a href="#cb4-324" aria-hidden="true" tabindex="-1"></a><span class="in">  }</span></span>
<span id="cb4-325"><a href="#cb4-325" aria-hidden="true" tabindex="-1"></a><span class="in">  const renderPlot = () =&gt; {</span></span>
<span id="cb4-326"><a href="#cb4-326" aria-hidden="true" tabindex="-1"></a><span class="in">    svg.selectAll("#daylightplot *").remove();</span></span>
<span id="cb4-327"><a href="#cb4-327" aria-hidden="true" tabindex="-1"></a><span class="in">    svg.select("#daylightplot").call(daylightPlot, {</span></span>
<span id="cb4-328"><a href="#cb4-328" aria-hidden="true" tabindex="-1"></a><span class="in">      width: columnWidth / 1.26,</span></span>
<span id="cb4-329"><a href="#cb4-329" aria-hidden="true" tabindex="-1"></a><span class="in">      height: height / 1.51 - margin.top - margin.bottom,</span></span>
<span id="cb4-330"><a href="#cb4-330" aria-hidden="true" tabindex="-1"></a><span class="in">      year: date2022.getFullYear(),</span></span>
<span id="cb4-331"><a href="#cb4-331" aria-hidden="true" tabindex="-1"></a><span class="in">      latitude: location[1],</span></span>
<span id="cb4-332"><a href="#cb4-332" aria-hidden="true" tabindex="-1"></a><span class="in">      defaultDate: selection.date,</span></span>
<span id="cb4-333"><a href="#cb4-333" aria-hidden="true" tabindex="-1"></a><span class="in">      defaultHour: selection.hour</span></span>
<span id="cb4-334"><a href="#cb4-334" aria-hidden="true" tabindex="-1"></a><span class="in">    })</span></span>
<span id="cb4-335"><a href="#cb4-335" aria-hidden="true" tabindex="-1"></a><span class="in">  }</span></span>
<span id="cb4-336"><a href="#cb4-336" aria-hidden="true" tabindex="-1"></a><span class="in">  const renderGlobe = () =&gt; {</span></span>
<span id="cb4-337"><a href="#cb4-337" aria-hidden="true" tabindex="-1"></a><span class="in">    svg.selectAll("#globe *").remove();</span></span>
<span id="cb4-338"><a href="#cb4-338" aria-hidden="true" tabindex="-1"></a><span class="in">    svg.selectAll("#globe").call(globe, { width: columnWidth * 1.2, location, ...selection });</span></span>
<span id="cb4-339"><a href="#cb4-339" aria-hidden="true" tabindex="-1"></a><span class="in">  }</span></span>
<span id="cb4-340"><a href="#cb4-340" aria-hidden="true" tabindex="-1"></a><span class="in">  const renderSolarSystem = () =&gt; {</span></span>
<span id="cb4-341"><a href="#cb4-341" aria-hidden="true" tabindex="-1"></a><span class="in">    svg.selectAll("#solar-system *").remove();</span></span>
<span id="cb4-342"><a href="#cb4-342" aria-hidden="true" tabindex="-1"></a><span class="in">    svg.selectAll("#solar-system").call(solarSystem,</span></span>
<span id="cb4-343"><a href="#cb4-343" aria-hidden="true" tabindex="-1"></a><span class="in">                                        columnWidth / 1.1,</span></span>
<span id="cb4-344"><a href="#cb4-344" aria-hidden="true" tabindex="-1"></a><span class="in">                                        location,</span></span>
<span id="cb4-345"><a href="#cb4-345" aria-hidden="true" tabindex="-1"></a><span class="in">                                        selection.date,</span></span>
<span id="cb4-346"><a href="#cb4-346" aria-hidden="true" tabindex="-1"></a><span class="in">                                        selection.hour);</span></span>
<span id="cb4-347"><a href="#cb4-347" aria-hidden="true" tabindex="-1"></a><span class="in">  }</span></span>
<span id="cb4-348"><a href="#cb4-348" aria-hidden="true" tabindex="-1"></a><span class="in">  const setSelection = (newSelection, forceRender = false) =&gt; {</span></span>
<span id="cb4-349"><a href="#cb4-349" aria-hidden="true" tabindex="-1"></a><span class="in">    const prev = {...selection};</span></span>
<span id="cb4-350"><a href="#cb4-350" aria-hidden="true" tabindex="-1"></a><span class="in">    selection = newSelection;</span></span>
<span id="cb4-351"><a href="#cb4-351" aria-hidden="true" tabindex="-1"></a><span class="in">    svg.node().value = selection;</span></span>
<span id="cb4-352"><a href="#cb4-352" aria-hidden="true" tabindex="-1"></a><span class="in">    if (forceRender) {</span></span>
<span id="cb4-353"><a href="#cb4-353" aria-hidden="true" tabindex="-1"></a><span class="in">      renderPlot();</span></span>
<span id="cb4-354"><a href="#cb4-354" aria-hidden="true" tabindex="-1"></a><span class="in">      renderSolarSystem();</span></span>
<span id="cb4-355"><a href="#cb4-355" aria-hidden="true" tabindex="-1"></a><span class="in">      renderGlobe();</span></span>
<span id="cb4-356"><a href="#cb4-356" aria-hidden="true" tabindex="-1"></a><span class="in">    } else if (prev.hour !== selection.hour || prev.date !== selection.date) {</span></span>
<span id="cb4-357"><a href="#cb4-357" aria-hidden="true" tabindex="-1"></a><span class="in">      renderSolarSystem();</span></span>
<span id="cb4-358"><a href="#cb4-358" aria-hidden="true" tabindex="-1"></a><span class="in">      renderGlobe();</span></span>
<span id="cb4-359"><a href="#cb4-359" aria-hidden="true" tabindex="-1"></a><span class="in">    }</span></span>
<span id="cb4-360"><a href="#cb4-360" aria-hidden="true" tabindex="-1"></a><span class="in">  }</span></span>
<span id="cb4-361"><a href="#cb4-361" aria-hidden="true" tabindex="-1"></a><span class="in">  svg.append("g")</span></span>
<span id="cb4-362"><a href="#cb4-362" aria-hidden="true" tabindex="-1"></a><span class="in">    .attr("id", "solar-system")</span></span>
<span id="cb4-363"><a href="#cb4-363" aria-hidden="true" tabindex="-1"></a><span class="in">    .attr("transform", `translate(${margin.left + 2}, ${margin.top + height / 7.5})`);</span></span>
<span id="cb4-364"><a href="#cb4-364" aria-hidden="true" tabindex="-1"></a><span class="in">  const plot = svg.append("g")</span></span>
<span id="cb4-365"><a href="#cb4-365" aria-hidden="true" tabindex="-1"></a><span class="in">    .attr("id", "daylightplot")</span></span>
<span id="cb4-366"><a href="#cb4-366" aria-hidden="true" tabindex="-1"></a><span class="in">    .attr("transform", `translate(${margin.left}, ${margin.top + height / 4})`);</span></span>
<span id="cb4-367"><a href="#cb4-367" aria-hidden="true" tabindex="-1"></a><span class="in">  svg.append("g")</span></span>
<span id="cb4-368"><a href="#cb4-368" aria-hidden="true" tabindex="-1"></a><span class="in">    .attr("id", "globe")</span></span>
<span id="cb4-369"><a href="#cb4-369" aria-hidden="true" tabindex="-1"></a><span class="in">    .attr("transform", `translate(${margin.left + margin.inner + columnWidth / 1.25}, ${margin.top + Number(columnWidth &lt; 300) * 12})`);</span></span>
<span id="cb4-370"><a href="#cb4-370" aria-hidden="true" tabindex="-1"></a><span class="in">  setSelection(selection, true);</span></span>
<span id="cb4-371"><a href="#cb4-371" aria-hidden="true" tabindex="-1"></a><span class="in">  const handleDateHourChange = ({ target, detail: { date, hour }}) =&gt; {</span></span>
<span id="cb4-372"><a href="#cb4-372" aria-hidden="true" tabindex="-1"></a><span class="in">    if (date != null &amp;&amp; hour != null) setSelection({...selection, date, hour});</span></span>
<span id="cb4-373"><a href="#cb4-373" aria-hidden="true" tabindex="-1"></a><span class="in">  }</span></span>
<span id="cb4-374"><a href="#cb4-374" aria-hidden="true" tabindex="-1"></a><span class="in">  svg.node().addEventListener(EventType.DateHourChange, handleDateHourChange, false);</span></span>
<span id="cb4-375"><a href="#cb4-375" aria-hidden="true" tabindex="-1"></a><span class="in">  return svg.node();</span></span>
<span id="cb4-376"><a href="#cb4-376" aria-hidden="true" tabindex="-1"></a><span class="in">}</span></span>
<span id="cb4-377"><a href="#cb4-377" aria-hidden="true" tabindex="-1"></a><span class="in">// https://observablehq.com/@d3/simple-clock</span></span>
<span id="cb4-378"><a href="#cb4-378" aria-hidden="true" tabindex="-1"></a><span class="in">// https://observablehq.com/@drio/lets-build-an-analog-clock</span></span>
<span id="cb4-379"><a href="#cb4-379" aria-hidden="true" tabindex="-1"></a><span class="in">clock = {</span></span>
<span id="cb4-380"><a href="#cb4-380" aria-hidden="true" tabindex="-1"></a><span class="in">  const clockRadius = 200,</span></span>
<span id="cb4-381"><a href="#cb4-381" aria-hidden="true" tabindex="-1"></a><span class="in">    margin = 50,</span></span>
<span id="cb4-382"><a href="#cb4-382" aria-hidden="true" tabindex="-1"></a><span class="in">    w = (clockRadius + margin) * 2,</span></span>
<span id="cb4-383"><a href="#cb4-383" aria-hidden="true" tabindex="-1"></a><span class="in">    h = (clockRadius + margin) * 2,</span></span>
<span id="cb4-384"><a href="#cb4-384" aria-hidden="true" tabindex="-1"></a><span class="in">    hourHandLength = (2 * clockRadius) / 3,</span></span>
<span id="cb4-385"><a href="#cb4-385" aria-hidden="true" tabindex="-1"></a><span class="in">    minuteHandLength = clockRadius,</span></span>
<span id="cb4-386"><a href="#cb4-386" aria-hidden="true" tabindex="-1"></a><span class="in">    secondHandLength = clockRadius - 12,</span></span>
<span id="cb4-387"><a href="#cb4-387" aria-hidden="true" tabindex="-1"></a><span class="in">    secondHandBalance = 30,</span></span>
<span id="cb4-388"><a href="#cb4-388" aria-hidden="true" tabindex="-1"></a><span class="in">    secondTickStart = clockRadius,</span></span>
<span id="cb4-389"><a href="#cb4-389" aria-hidden="true" tabindex="-1"></a><span class="in">    secondTickLength = -10,</span></span>
<span id="cb4-390"><a href="#cb4-390" aria-hidden="true" tabindex="-1"></a><span class="in">    hourTickStart = clockRadius,</span></span>
<span id="cb4-391"><a href="#cb4-391" aria-hidden="true" tabindex="-1"></a><span class="in">    hourTickLength = -18,</span></span>
<span id="cb4-392"><a href="#cb4-392" aria-hidden="true" tabindex="-1"></a><span class="in">    secondLabelRadius = clockRadius + 16,</span></span>
<span id="cb4-393"><a href="#cb4-393" aria-hidden="true" tabindex="-1"></a><span class="in">    secondLabelYOffset = 5,</span></span>
<span id="cb4-394"><a href="#cb4-394" aria-hidden="true" tabindex="-1"></a><span class="in">    hourLabelRadius = clockRadius - 40,</span></span>
<span id="cb4-395"><a href="#cb4-395" aria-hidden="true" tabindex="-1"></a><span class="in">    hourLabelYOffset = 7,</span></span>
<span id="cb4-396"><a href="#cb4-396" aria-hidden="true" tabindex="-1"></a><span class="in">    radians = Math.PI / 180;</span></span>
<span id="cb4-397"><a href="#cb4-397" aria-hidden="true" tabindex="-1"></a><span class="in">  const ten = d3</span></span>
<span id="cb4-398"><a href="#cb4-398" aria-hidden="true" tabindex="-1"></a><span class="in">    .scaleLinear()</span></span>
<span id="cb4-399"><a href="#cb4-399" aria-hidden="true" tabindex="-1"></a><span class="in">    .range([0, 360])</span></span>
<span id="cb4-400"><a href="#cb4-400" aria-hidden="true" tabindex="-1"></a><span class="in">    .domain([0, 10]);</span></span>
<span id="cb4-401"><a href="#cb4-401" aria-hidden="true" tabindex="-1"></a><span class="in">  const sto = d3</span></span>
<span id="cb4-402"><a href="#cb4-402" aria-hidden="true" tabindex="-1"></a><span class="in">    .scaleLinear()</span></span>
<span id="cb4-403"><a href="#cb4-403" aria-hidden="true" tabindex="-1"></a><span class="in">    .range([0, 360])</span></span>
<span id="cb4-404"><a href="#cb4-404" aria-hidden="true" tabindex="-1"></a><span class="in">    .domain([0, 100]);</span></span>
<span id="cb4-405"><a href="#cb4-405" aria-hidden="true" tabindex="-1"></a><span class="in">  const handData = [</span></span>
<span id="cb4-406"><a href="#cb4-406" aria-hidden="true" tabindex="-1"></a><span class="in">    {</span></span>
<span id="cb4-407"><a href="#cb4-407" aria-hidden="true" tabindex="-1"></a><span class="in">      type: "hour",</span></span>
<span id="cb4-408"><a href="#cb4-408" aria-hidden="true" tabindex="-1"></a><span class="in">      value: 0,</span></span>
<span id="cb4-409"><a href="#cb4-409" aria-hidden="true" tabindex="-1"></a><span class="in">      length: -hourHandLength,</span></span>
<span id="cb4-410"><a href="#cb4-410" aria-hidden="true" tabindex="-1"></a><span class="in">      scale: ten</span></span>
<span id="cb4-411"><a href="#cb4-411" aria-hidden="true" tabindex="-1"></a><span class="in">    },</span></span>
<span id="cb4-412"><a href="#cb4-412" aria-hidden="true" tabindex="-1"></a><span class="in">    {</span></span>
<span id="cb4-413"><a href="#cb4-413" aria-hidden="true" tabindex="-1"></a><span class="in">      type: "minute",</span></span>
<span id="cb4-414"><a href="#cb4-414" aria-hidden="true" tabindex="-1"></a><span class="in">      value: 0,</span></span>
<span id="cb4-415"><a href="#cb4-415" aria-hidden="true" tabindex="-1"></a><span class="in">      length: -minuteHandLength,</span></span>
<span id="cb4-416"><a href="#cb4-416" aria-hidden="true" tabindex="-1"></a><span class="in">      scale: sto</span></span>
<span id="cb4-417"><a href="#cb4-417" aria-hidden="true" tabindex="-1"></a><span class="in">    },</span></span>
<span id="cb4-418"><a href="#cb4-418" aria-hidden="true" tabindex="-1"></a><span class="in">    {</span></span>
<span id="cb4-419"><a href="#cb4-419" aria-hidden="true" tabindex="-1"></a><span class="in">      type: "second",</span></span>
<span id="cb4-420"><a href="#cb4-420" aria-hidden="true" tabindex="-1"></a><span class="in">      value: 0,</span></span>
<span id="cb4-421"><a href="#cb4-421" aria-hidden="true" tabindex="-1"></a><span class="in">      length: -secondHandLength,</span></span>
<span id="cb4-422"><a href="#cb4-422" aria-hidden="true" tabindex="-1"></a><span class="in">      scale: sto,</span></span>
<span id="cb4-423"><a href="#cb4-423" aria-hidden="true" tabindex="-1"></a><span class="in">      balance: secondHandBalance</span></span>
<span id="cb4-424"><a href="#cb4-424" aria-hidden="true" tabindex="-1"></a><span class="in">    }</span></span>
<span id="cb4-425"><a href="#cb4-425" aria-hidden="true" tabindex="-1"></a><span class="in">  ];</span></span>
<span id="cb4-426"><a href="#cb4-426" aria-hidden="true" tabindex="-1"></a><span class="in">  function drawClock() {</span></span>
<span id="cb4-427"><a href="#cb4-427" aria-hidden="true" tabindex="-1"></a><span class="in">    // create all the clock elements</span></span>
<span id="cb4-428"><a href="#cb4-428" aria-hidden="true" tabindex="-1"></a><span class="in">    updateData(); //draw them in the correct starting position</span></span>
<span id="cb4-429"><a href="#cb4-429" aria-hidden="true" tabindex="-1"></a><span class="in">    const face = svg</span></span>
<span id="cb4-430"><a href="#cb4-430" aria-hidden="true" tabindex="-1"></a><span class="in">      .append("g")</span></span>
<span id="cb4-431"><a href="#cb4-431" aria-hidden="true" tabindex="-1"></a><span class="in">      .attr("id", "clock-face")</span></span>
<span id="cb4-432"><a href="#cb4-432" aria-hidden="true" tabindex="-1"></a><span class="in">      .attr("transform", `translate(${[w / 2, h / 2]})`);</span></span>
<span id="cb4-433"><a href="#cb4-433" aria-hidden="true" tabindex="-1"></a><span class="in">    // add marks for seconds</span></span>
<span id="cb4-434"><a href="#cb4-434" aria-hidden="true" tabindex="-1"></a><span class="in">    face</span></span>
<span id="cb4-435"><a href="#cb4-435" aria-hidden="true" tabindex="-1"></a><span class="in">      .selectAll(".second-tick")</span></span>
<span id="cb4-436"><a href="#cb4-436" aria-hidden="true" tabindex="-1"></a><span class="in">      .data(d3.range(0, 100))</span></span>
<span id="cb4-437"><a href="#cb4-437" aria-hidden="true" tabindex="-1"></a><span class="in">      .enter()</span></span>
<span id="cb4-438"><a href="#cb4-438" aria-hidden="true" tabindex="-1"></a><span class="in">      .append("line")</span></span>
<span id="cb4-439"><a href="#cb4-439" aria-hidden="true" tabindex="-1"></a><span class="in">      .attr("class", "second-tick")</span></span>
<span id="cb4-440"><a href="#cb4-440" aria-hidden="true" tabindex="-1"></a><span class="in">      .attr("x1", 0)</span></span>
<span id="cb4-441"><a href="#cb4-441" aria-hidden="true" tabindex="-1"></a><span class="in">      .attr("x2", 0)</span></span>
<span id="cb4-442"><a href="#cb4-442" aria-hidden="true" tabindex="-1"></a><span class="in">      .attr("y1", secondTickStart)</span></span>
<span id="cb4-443"><a href="#cb4-443" aria-hidden="true" tabindex="-1"></a><span class="in">      .attr("y2", secondTickStart + secondTickLength)</span></span>
<span id="cb4-444"><a href="#cb4-444" aria-hidden="true" tabindex="-1"></a><span class="in">      .attr("transform", d =&gt; `rotate(${sto(d)})`);</span></span>
<span id="cb4-445"><a href="#cb4-445" aria-hidden="true" tabindex="-1"></a><span class="in">    // and labels...</span></span>
<span id="cb4-446"><a href="#cb4-446" aria-hidden="true" tabindex="-1"></a><span class="in">    face</span></span>
<span id="cb4-447"><a href="#cb4-447" aria-hidden="true" tabindex="-1"></a><span class="in">      .selectAll(".second-label")</span></span>
<span id="cb4-448"><a href="#cb4-448" aria-hidden="true" tabindex="-1"></a><span class="in">      .data(d3.range(0, 100, 5))</span></span>
<span id="cb4-449"><a href="#cb4-449" aria-hidden="true" tabindex="-1"></a><span class="in">      .enter()</span></span>
<span id="cb4-450"><a href="#cb4-450" aria-hidden="true" tabindex="-1"></a><span class="in">      .append("text")</span></span>
<span id="cb4-451"><a href="#cb4-451" aria-hidden="true" tabindex="-1"></a><span class="in">      .attr("class", "second-label")</span></span>
<span id="cb4-452"><a href="#cb4-452" aria-hidden="true" tabindex="-1"></a><span class="in">      .attr("text-anchor", "middle")</span></span>
<span id="cb4-453"><a href="#cb4-453" aria-hidden="true" tabindex="-1"></a><span class="in">      .attr("x", d =&gt; secondLabelRadius * Math.sin(sto(d) * radians))</span></span>
<span id="cb4-454"><a href="#cb4-454" aria-hidden="true" tabindex="-1"></a><span class="in">      .attr(</span></span>
<span id="cb4-455"><a href="#cb4-455" aria-hidden="true" tabindex="-1"></a><span class="in">        "y",</span></span>
<span id="cb4-456"><a href="#cb4-456" aria-hidden="true" tabindex="-1"></a><span class="in">        d =&gt;</span></span>
<span id="cb4-457"><a href="#cb4-457" aria-hidden="true" tabindex="-1"></a><span class="in">          -secondLabelRadius * Math.cos(sto(d) * radians) + secondLabelYOffset</span></span>
<span id="cb4-458"><a href="#cb4-458" aria-hidden="true" tabindex="-1"></a><span class="in">      )</span></span>
<span id="cb4-459"><a href="#cb4-459" aria-hidden="true" tabindex="-1"></a><span class="in">      .text(d =&gt; d);</span></span>
<span id="cb4-460"><a href="#cb4-460" aria-hidden="true" tabindex="-1"></a><span class="in">    // ... and hours</span></span>
<span id="cb4-461"><a href="#cb4-461" aria-hidden="true" tabindex="-1"></a><span class="in">    face</span></span>
<span id="cb4-462"><a href="#cb4-462" aria-hidden="true" tabindex="-1"></a><span class="in">      .selectAll(".hour-tick")</span></span>
<span id="cb4-463"><a href="#cb4-463" aria-hidden="true" tabindex="-1"></a><span class="in">      .data(d3.range(0, 10, 1))</span></span>
<span id="cb4-464"><a href="#cb4-464" aria-hidden="true" tabindex="-1"></a><span class="in">      .enter()</span></span>
<span id="cb4-465"><a href="#cb4-465" aria-hidden="true" tabindex="-1"></a><span class="in">      .append("line")</span></span>
<span id="cb4-466"><a href="#cb4-466" aria-hidden="true" tabindex="-1"></a><span class="in">      .attr("class", "hour-tick")</span></span>
<span id="cb4-467"><a href="#cb4-467" aria-hidden="true" tabindex="-1"></a><span class="in">      .attr("x1", 0)</span></span>
<span id="cb4-468"><a href="#cb4-468" aria-hidden="true" tabindex="-1"></a><span class="in">      .attr("x2", 0)</span></span>
<span id="cb4-469"><a href="#cb4-469" aria-hidden="true" tabindex="-1"></a><span class="in">      .attr("y1", hourTickStart)</span></span>
<span id="cb4-470"><a href="#cb4-470" aria-hidden="true" tabindex="-1"></a><span class="in">      .attr("y2", hourTickStart + hourTickLength)</span></span>
<span id="cb4-471"><a href="#cb4-471" aria-hidden="true" tabindex="-1"></a><span class="in">      .attr("transform", d =&gt; `rotate(${ten(d)})`);</span></span>
<span id="cb4-472"><a href="#cb4-472" aria-hidden="true" tabindex="-1"></a><span class="in">    face</span></span>
<span id="cb4-473"><a href="#cb4-473" aria-hidden="true" tabindex="-1"></a><span class="in">      .selectAll(".hour-label")</span></span>
<span id="cb4-474"><a href="#cb4-474" aria-hidden="true" tabindex="-1"></a><span class="in">      .data(d3.range(0, 10, 1))</span></span>
<span id="cb4-475"><a href="#cb4-475" aria-hidden="true" tabindex="-1"></a><span class="in">      .enter()</span></span>
<span id="cb4-476"><a href="#cb4-476" aria-hidden="true" tabindex="-1"></a><span class="in">      .append("text")</span></span>
<span id="cb4-477"><a href="#cb4-477" aria-hidden="true" tabindex="-1"></a><span class="in">      .attr("class", "hour-label")</span></span>
<span id="cb4-478"><a href="#cb4-478" aria-hidden="true" tabindex="-1"></a><span class="in">      .attr("text-anchor", "middle")</span></span>
<span id="cb4-479"><a href="#cb4-479" aria-hidden="true" tabindex="-1"></a><span class="in">      .attr("x", d =&gt; hourLabelRadius * Math.sin(ten(d) * radians))</span></span>
<span id="cb4-480"><a href="#cb4-480" aria-hidden="true" tabindex="-1"></a><span class="in">      .attr(</span></span>
<span id="cb4-481"><a href="#cb4-481" aria-hidden="true" tabindex="-1"></a><span class="in">        "y",</span></span>
<span id="cb4-482"><a href="#cb4-482" aria-hidden="true" tabindex="-1"></a><span class="in">        d =&gt; -hourLabelRadius * Math.cos(ten(d) * radians) + hourLabelYOffset</span></span>
<span id="cb4-483"><a href="#cb4-483" aria-hidden="true" tabindex="-1"></a><span class="in">      )</span></span>
<span id="cb4-484"><a href="#cb4-484" aria-hidden="true" tabindex="-1"></a><span class="in">      .text(d =&gt; d);</span></span>
<span id="cb4-485"><a href="#cb4-485" aria-hidden="true" tabindex="-1"></a><span class="in">    const hands = face.append("g").attr("id", "clock-hands");</span></span>
<span id="cb4-486"><a href="#cb4-486" aria-hidden="true" tabindex="-1"></a><span class="in">    hands</span></span>
<span id="cb4-487"><a href="#cb4-487" aria-hidden="true" tabindex="-1"></a><span class="in">      .selectAll("line")</span></span>
<span id="cb4-488"><a href="#cb4-488" aria-hidden="true" tabindex="-1"></a><span class="in">      .data(handData)</span></span>
<span id="cb4-489"><a href="#cb4-489" aria-hidden="true" tabindex="-1"></a><span class="in">      .enter()</span></span>
<span id="cb4-490"><a href="#cb4-490" aria-hidden="true" tabindex="-1"></a><span class="in">      .append("line")</span></span>
<span id="cb4-491"><a href="#cb4-491" aria-hidden="true" tabindex="-1"></a><span class="in">      .attr("class", d =&gt; d.type + "-hand")</span></span>
<span id="cb4-492"><a href="#cb4-492" aria-hidden="true" tabindex="-1"></a><span class="in">      .attr("x1", 0)</span></span>
<span id="cb4-493"><a href="#cb4-493" aria-hidden="true" tabindex="-1"></a><span class="in">      .attr("y1", d =&gt; d.balance || 0)</span></span>
<span id="cb4-494"><a href="#cb4-494" aria-hidden="true" tabindex="-1"></a><span class="in">      .attr("x2", 0)</span></span>
<span id="cb4-495"><a href="#cb4-495" aria-hidden="true" tabindex="-1"></a><span class="in">      .attr("y2", d =&gt; d.length)</span></span>
<span id="cb4-496"><a href="#cb4-496" aria-hidden="true" tabindex="-1"></a><span class="in">      .attr("transform", d =&gt; `rotate(${d.scale(d.value)})`);</span></span>
<span id="cb4-497"><a href="#cb4-497" aria-hidden="true" tabindex="-1"></a><span class="in">    face</span></span>
<span id="cb4-498"><a href="#cb4-498" aria-hidden="true" tabindex="-1"></a><span class="in">      .append("g")</span></span>
<span id="cb4-499"><a href="#cb4-499" aria-hidden="true" tabindex="-1"></a><span class="in">      .attr("id", "face-overlay")</span></span>
<span id="cb4-500"><a href="#cb4-500" aria-hidden="true" tabindex="-1"></a><span class="in">      .append("circle")</span></span>
<span id="cb4-501"><a href="#cb4-501" aria-hidden="true" tabindex="-1"></a><span class="in">      .attr("class", "hands-cover")</span></span>
<span id="cb4-502"><a href="#cb4-502" aria-hidden="true" tabindex="-1"></a><span class="in">      .attr("x", 0)</span></span>
<span id="cb4-503"><a href="#cb4-503" aria-hidden="true" tabindex="-1"></a><span class="in">      .attr("y", 0)</span></span>
<span id="cb4-504"><a href="#cb4-504" aria-hidden="true" tabindex="-1"></a><span class="in">      .attr("r", clockRadius / 20);</span></span>
<span id="cb4-505"><a href="#cb4-505" aria-hidden="true" tabindex="-1"></a><span class="in">  }</span></span>
<span id="cb4-506"><a href="#cb4-506" aria-hidden="true" tabindex="-1"></a><span class="in">  function moveHands() {</span></span>
<span id="cb4-507"><a href="#cb4-507" aria-hidden="true" tabindex="-1"></a><span class="in">    const sel = d3</span></span>
<span id="cb4-508"><a href="#cb4-508" aria-hidden="true" tabindex="-1"></a><span class="in">      .select("#clock-hands-final")</span></span>
<span id="cb4-509"><a href="#cb4-509" aria-hidden="true" tabindex="-1"></a><span class="in">      .selectAll("line")</span></span>
<span id="cb4-510"><a href="#cb4-510" aria-hidden="true" tabindex="-1"></a><span class="in">      .data(handData)</span></span>
<span id="cb4-511"><a href="#cb4-511" aria-hidden="true" tabindex="-1"></a><span class="in">      .transition();</span></span>
<span id="cb4-512"><a href="#cb4-512" aria-hidden="true" tabindex="-1"></a><span class="in">    if (fancySecondsOFF) sel.ease(d3.easeElastic.period(0.5));</span></span>
<span id="cb4-513"><a href="#cb4-513" aria-hidden="true" tabindex="-1"></a><span class="in">    sel.attr("transform", d =&gt; `rotate(${d.scale(d.value)})`);</span></span>
<span id="cb4-514"><a href="#cb4-514" aria-hidden="true" tabindex="-1"></a><span class="in">  }</span></span>
<span id="cb4-515"><a href="#cb4-515" aria-hidden="true" tabindex="-1"></a><span class="in">  function updateData() {</span></span>
<span id="cb4-516"><a href="#cb4-516" aria-hidden="true" tabindex="-1"></a><span class="in">    handData[0].value = !fancySecondsOFF ? Math.floor(selectedExact * 10) : decTime[0];</span></span>
<span id="cb4-517"><a href="#cb4-517" aria-hidden="true" tabindex="-1"></a><span class="in">    handData[1].value = !fancySecondsOFF ? Math.floor(selectedExact * 10 % 1 * 100) : decTime.slice(2, 4);</span></span>
<span id="cb4-518"><a href="#cb4-518" aria-hidden="true" tabindex="-1"></a><span class="in">    handData[2].value = !fancySecondsOFF ? selectedExact * 10 % 1 * 100 % 1 * 100 : decTime.slice(4, 6);</span></span>
<span id="cb4-519"><a href="#cb4-519" aria-hidden="true" tabindex="-1"></a><span class="in">  }</span></span>
<span id="cb4-520"><a href="#cb4-520" aria-hidden="true" tabindex="-1"></a><span class="in">  const svg = d3</span></span>
<span id="cb4-521"><a href="#cb4-521" aria-hidden="true" tabindex="-1"></a><span class="in">    .create("svg")</span></span>
<span id="cb4-522"><a href="#cb4-522" aria-hidden="true" tabindex="-1"></a><span class="in">    .attr("viewBox", [0, 0, w, h])</span></span>
<span id="cb4-523"><a href="#cb4-523" aria-hidden="true" tabindex="-1"></a><span class="in">    .style("max-width", `${width / 2.1}px`)</span></span>
<span id="cb4-524"><a href="#cb4-524" aria-hidden="true" tabindex="-1"></a><span class="in">    .attr("class", "clock-top")</span></span>
<span id="cb4-525"><a href="#cb4-525" aria-hidden="true" tabindex="-1"></a><span class="in">    .attr("id", "clock");</span></span>
<span id="cb4-526"><a href="#cb4-526" aria-hidden="true" tabindex="-1"></a><span class="in">  svg</span></span>
<span id="cb4-527"><a href="#cb4-527" aria-hidden="true" tabindex="-1"></a><span class="in">    .append("text")</span></span>
<span id="cb4-528"><a href="#cb4-528" aria-hidden="true" tabindex="-1"></a><span class="in">    .text(`+${decTime}-${selectedZone}`)</span></span>
<span id="cb4-529"><a href="#cb4-529" aria-hidden="true" tabindex="-1"></a><span class="in">    .attr("x", clockRadius + margin)</span></span>
<span id="cb4-530"><a href="#cb4-530" aria-hidden="true" tabindex="-1"></a><span class="in">    .attr("y", clockRadius * 2 + margin * 1.975)</span></span>
<span id="cb4-531"><a href="#cb4-531" aria-hidden="true" tabindex="-1"></a><span class="in">    .attr("text-anchor", "middle")</span></span>
<span id="cb4-532"><a href="#cb4-532" aria-hidden="true" tabindex="-1"></a><span class="in">    .attr("font-size", 32)</span></span>
<span id="cb4-533"><a href="#cb4-533" aria-hidden="true" tabindex="-1"></a><span class="in">    .attr("font-family", "monospace");</span></span>
<span id="cb4-534"><a href="#cb4-534" aria-hidden="true" tabindex="-1"></a><span class="in">  drawClock();</span></span>
<span id="cb4-535"><a href="#cb4-535" aria-hidden="true" tabindex="-1"></a><span class="in">  // Animation</span></span>
<span id="cb4-536"><a href="#cb4-536" aria-hidden="true" tabindex="-1"></a><span class="in">  const interval = setInterval(</span></span>
<span id="cb4-537"><a href="#cb4-537" aria-hidden="true" tabindex="-1"></a><span class="in">    () =&gt; {</span></span>
<span id="cb4-538"><a href="#cb4-538" aria-hidden="true" tabindex="-1"></a><span class="in">      updateData();</span></span>
<span id="cb4-539"><a href="#cb4-539" aria-hidden="true" tabindex="-1"></a><span class="in">      moveHands();</span></span>
<span id="cb4-540"><a href="#cb4-540" aria-hidden="true" tabindex="-1"></a><span class="in">    },</span></span>
<span id="cb4-541"><a href="#cb4-541" aria-hidden="true" tabindex="-1"></a><span class="in">    !fancySecondsOFF ? 10 : 864</span></span>
<span id="cb4-542"><a href="#cb4-542" aria-hidden="true" tabindex="-1"></a><span class="in">  );</span></span>
<span id="cb4-543"><a href="#cb4-543" aria-hidden="true" tabindex="-1"></a><span class="in">  invalidation.then(() =&gt; clearInterval(interval));</span></span>
<span id="cb4-544"><a href="#cb4-544" aria-hidden="true" tabindex="-1"></a><span class="in">  return svg.node();</span></span>
<span id="cb4-545"><a href="#cb4-545" aria-hidden="true" tabindex="-1"></a><span class="in">}</span></span>
<span id="cb4-546"><a href="#cb4-546" aria-hidden="true" tabindex="-1"></a><span class="in">clock1 = {</span></span>
<span id="cb4-547"><a href="#cb4-547" aria-hidden="true" tabindex="-1"></a><span class="in">  const clockRadius = 200,</span></span>
<span id="cb4-548"><a href="#cb4-548" aria-hidden="true" tabindex="-1"></a><span class="in">    margin = 50,</span></span>
<span id="cb4-549"><a href="#cb4-549" aria-hidden="true" tabindex="-1"></a><span class="in">    w = (clockRadius + margin) * 2,</span></span>
<span id="cb4-550"><a href="#cb4-550" aria-hidden="true" tabindex="-1"></a><span class="in">    h = (clockRadius + margin) * 2,</span></span>
<span id="cb4-551"><a href="#cb4-551" aria-hidden="true" tabindex="-1"></a><span class="in">    hourHandLength = (2 * clockRadius) / 3,</span></span>
<span id="cb4-552"><a href="#cb4-552" aria-hidden="true" tabindex="-1"></a><span class="in">    minuteHandLength = clockRadius,</span></span>
<span id="cb4-553"><a href="#cb4-553" aria-hidden="true" tabindex="-1"></a><span class="in">    secondHandLength = clockRadius - 12,</span></span>
<span id="cb4-554"><a href="#cb4-554" aria-hidden="true" tabindex="-1"></a><span class="in">    secondHandBalance = 30,</span></span>
<span id="cb4-555"><a href="#cb4-555" aria-hidden="true" tabindex="-1"></a><span class="in">    secondTickStart = clockRadius,</span></span>
<span id="cb4-556"><a href="#cb4-556" aria-hidden="true" tabindex="-1"></a><span class="in">    secondTickLength = -10,</span></span>
<span id="cb4-557"><a href="#cb4-557" aria-hidden="true" tabindex="-1"></a><span class="in">    hourTickStart = clockRadius,</span></span>
<span id="cb4-558"><a href="#cb4-558" aria-hidden="true" tabindex="-1"></a><span class="in">    hourTickLength = -18,</span></span>
<span id="cb4-559"><a href="#cb4-559" aria-hidden="true" tabindex="-1"></a><span class="in">    secondLabelRadius = clockRadius + 16,</span></span>
<span id="cb4-560"><a href="#cb4-560" aria-hidden="true" tabindex="-1"></a><span class="in">    secondLabelYOffset = 5,</span></span>
<span id="cb4-561"><a href="#cb4-561" aria-hidden="true" tabindex="-1"></a><span class="in">    hourLabelRadius = clockRadius - 40,</span></span>
<span id="cb4-562"><a href="#cb4-562" aria-hidden="true" tabindex="-1"></a><span class="in">    hourLabelYOffset = 7,</span></span>
<span id="cb4-563"><a href="#cb4-563" aria-hidden="true" tabindex="-1"></a><span class="in">    radians = Math.PI / 180;</span></span>
<span id="cb4-564"><a href="#cb4-564" aria-hidden="true" tabindex="-1"></a><span class="in">  const ten = d3</span></span>
<span id="cb4-565"><a href="#cb4-565" aria-hidden="true" tabindex="-1"></a><span class="in">    .scaleLinear()</span></span>
<span id="cb4-566"><a href="#cb4-566" aria-hidden="true" tabindex="-1"></a><span class="in">    .range([0, 360])</span></span>
<span id="cb4-567"><a href="#cb4-567" aria-hidden="true" tabindex="-1"></a><span class="in">    .domain([0, 10]);</span></span>
<span id="cb4-568"><a href="#cb4-568" aria-hidden="true" tabindex="-1"></a><span class="in">  const sto = d3</span></span>
<span id="cb4-569"><a href="#cb4-569" aria-hidden="true" tabindex="-1"></a><span class="in">    .scaleLinear()</span></span>
<span id="cb4-570"><a href="#cb4-570" aria-hidden="true" tabindex="-1"></a><span class="in">    .range([0, 360])</span></span>
<span id="cb4-571"><a href="#cb4-571" aria-hidden="true" tabindex="-1"></a><span class="in">    .domain([0, 100]);</span></span>
<span id="cb4-572"><a href="#cb4-572" aria-hidden="true" tabindex="-1"></a><span class="in">  const handData = [</span></span>
<span id="cb4-573"><a href="#cb4-573" aria-hidden="true" tabindex="-1"></a><span class="in">    {</span></span>
<span id="cb4-574"><a href="#cb4-574" aria-hidden="true" tabindex="-1"></a><span class="in">      type: "hour",</span></span>
<span id="cb4-575"><a href="#cb4-575" aria-hidden="true" tabindex="-1"></a><span class="in">      value: 0,</span></span>
<span id="cb4-576"><a href="#cb4-576" aria-hidden="true" tabindex="-1"></a><span class="in">      length: -hourHandLength,</span></span>
<span id="cb4-577"><a href="#cb4-577" aria-hidden="true" tabindex="-1"></a><span class="in">      scale: ten</span></span>
<span id="cb4-578"><a href="#cb4-578" aria-hidden="true" tabindex="-1"></a><span class="in">    },</span></span>
<span id="cb4-579"><a href="#cb4-579" aria-hidden="true" tabindex="-1"></a><span class="in">    {</span></span>
<span id="cb4-580"><a href="#cb4-580" aria-hidden="true" tabindex="-1"></a><span class="in">      type: "minute",</span></span>
<span id="cb4-581"><a href="#cb4-581" aria-hidden="true" tabindex="-1"></a><span class="in">      value: 0,</span></span>
<span id="cb4-582"><a href="#cb4-582" aria-hidden="true" tabindex="-1"></a><span class="in">      length: -minuteHandLength,</span></span>
<span id="cb4-583"><a href="#cb4-583" aria-hidden="true" tabindex="-1"></a><span class="in">      scale: sto</span></span>
<span id="cb4-584"><a href="#cb4-584" aria-hidden="true" tabindex="-1"></a><span class="in">    },</span></span>
<span id="cb4-585"><a href="#cb4-585" aria-hidden="true" tabindex="-1"></a><span class="in">    {</span></span>
<span id="cb4-586"><a href="#cb4-586" aria-hidden="true" tabindex="-1"></a><span class="in">      type: "second",</span></span>
<span id="cb4-587"><a href="#cb4-587" aria-hidden="true" tabindex="-1"></a><span class="in">      value: 0,</span></span>
<span id="cb4-588"><a href="#cb4-588" aria-hidden="true" tabindex="-1"></a><span class="in">      length: -secondHandLength,</span></span>
<span id="cb4-589"><a href="#cb4-589" aria-hidden="true" tabindex="-1"></a><span class="in">      scale: sto,</span></span>
<span id="cb4-590"><a href="#cb4-590" aria-hidden="true" tabindex="-1"></a><span class="in">      balance: secondHandBalance</span></span>
<span id="cb4-591"><a href="#cb4-591" aria-hidden="true" tabindex="-1"></a><span class="in">    }</span></span>
<span id="cb4-592"><a href="#cb4-592" aria-hidden="true" tabindex="-1"></a><span class="in">  ];</span></span>
<span id="cb4-593"><a href="#cb4-593" aria-hidden="true" tabindex="-1"></a><span class="in">  function drawClock() {</span></span>
<span id="cb4-594"><a href="#cb4-594" aria-hidden="true" tabindex="-1"></a><span class="in">    // create all the clock elements</span></span>
<span id="cb4-595"><a href="#cb4-595" aria-hidden="true" tabindex="-1"></a><span class="in">    updateData(); //draw them in the correct starting position</span></span>
<span id="cb4-596"><a href="#cb4-596" aria-hidden="true" tabindex="-1"></a><span class="in">    const face = svg</span></span>
<span id="cb4-597"><a href="#cb4-597" aria-hidden="true" tabindex="-1"></a><span class="in">      .append("g")</span></span>
<span id="cb4-598"><a href="#cb4-598" aria-hidden="true" tabindex="-1"></a><span class="in">      .attr("id", "clock-face")</span></span>
<span id="cb4-599"><a href="#cb4-599" aria-hidden="true" tabindex="-1"></a><span class="in">      .attr("transform", `translate(${[w / 2, h / 2]})`);</span></span>
<span id="cb4-600"><a href="#cb4-600" aria-hidden="true" tabindex="-1"></a><span class="in">    // add marks for seconds</span></span>
<span id="cb4-601"><a href="#cb4-601" aria-hidden="true" tabindex="-1"></a><span class="in">    face</span></span>
<span id="cb4-602"><a href="#cb4-602" aria-hidden="true" tabindex="-1"></a><span class="in">      .selectAll(".second-tick")</span></span>
<span id="cb4-603"><a href="#cb4-603" aria-hidden="true" tabindex="-1"></a><span class="in">      .data(d3.range(0, 100))</span></span>
<span id="cb4-604"><a href="#cb4-604" aria-hidden="true" tabindex="-1"></a><span class="in">      .enter()</span></span>
<span id="cb4-605"><a href="#cb4-605" aria-hidden="true" tabindex="-1"></a><span class="in">      .append("line")</span></span>
<span id="cb4-606"><a href="#cb4-606" aria-hidden="true" tabindex="-1"></a><span class="in">      .attr("class", "second-tick")</span></span>
<span id="cb4-607"><a href="#cb4-607" aria-hidden="true" tabindex="-1"></a><span class="in">      .attr("x1", 0)</span></span>
<span id="cb4-608"><a href="#cb4-608" aria-hidden="true" tabindex="-1"></a><span class="in">      .attr("x2", 0)</span></span>
<span id="cb4-609"><a href="#cb4-609" aria-hidden="true" tabindex="-1"></a><span class="in">      .attr("y1", secondTickStart)</span></span>
<span id="cb4-610"><a href="#cb4-610" aria-hidden="true" tabindex="-1"></a><span class="in">      .attr("y2", secondTickStart + secondTickLength)</span></span>
<span id="cb4-611"><a href="#cb4-611" aria-hidden="true" tabindex="-1"></a><span class="in">      .attr("transform", d =&gt; `rotate(${sto(d)})`);</span></span>
<span id="cb4-612"><a href="#cb4-612" aria-hidden="true" tabindex="-1"></a><span class="in">    // and labels...</span></span>
<span id="cb4-613"><a href="#cb4-613" aria-hidden="true" tabindex="-1"></a><span class="in">    face</span></span>
<span id="cb4-614"><a href="#cb4-614" aria-hidden="true" tabindex="-1"></a><span class="in">      .selectAll(".second-label")</span></span>
<span id="cb4-615"><a href="#cb4-615" aria-hidden="true" tabindex="-1"></a><span class="in">      .data(d3.range(0, 100, 5))</span></span>
<span id="cb4-616"><a href="#cb4-616" aria-hidden="true" tabindex="-1"></a><span class="in">      .enter()</span></span>
<span id="cb4-617"><a href="#cb4-617" aria-hidden="true" tabindex="-1"></a><span class="in">      .append("text")</span></span>
<span id="cb4-618"><a href="#cb4-618" aria-hidden="true" tabindex="-1"></a><span class="in">      .attr("class", "second-label")</span></span>
<span id="cb4-619"><a href="#cb4-619" aria-hidden="true" tabindex="-1"></a><span class="in">      .attr("text-anchor", "middle")</span></span>
<span id="cb4-620"><a href="#cb4-620" aria-hidden="true" tabindex="-1"></a><span class="in">      .attr("x", d =&gt; secondLabelRadius * Math.sin(sto(d) * radians))</span></span>
<span id="cb4-621"><a href="#cb4-621" aria-hidden="true" tabindex="-1"></a><span class="in">      .attr(</span></span>
<span id="cb4-622"><a href="#cb4-622" aria-hidden="true" tabindex="-1"></a><span class="in">        "y",</span></span>
<span id="cb4-623"><a href="#cb4-623" aria-hidden="true" tabindex="-1"></a><span class="in">        d =&gt;</span></span>
<span id="cb4-624"><a href="#cb4-624" aria-hidden="true" tabindex="-1"></a><span class="in">          -secondLabelRadius * Math.cos(sto(d) * radians) + secondLabelYOffset</span></span>
<span id="cb4-625"><a href="#cb4-625" aria-hidden="true" tabindex="-1"></a><span class="in">      )</span></span>
<span id="cb4-626"><a href="#cb4-626" aria-hidden="true" tabindex="-1"></a><span class="in">      .text(d =&gt; d);</span></span>
<span id="cb4-627"><a href="#cb4-627" aria-hidden="true" tabindex="-1"></a><span class="in">    // ... and hours</span></span>
<span id="cb4-628"><a href="#cb4-628" aria-hidden="true" tabindex="-1"></a><span class="in">    face</span></span>
<span id="cb4-629"><a href="#cb4-629" aria-hidden="true" tabindex="-1"></a><span class="in">      .selectAll(".hour-tick")</span></span>
<span id="cb4-630"><a href="#cb4-630" aria-hidden="true" tabindex="-1"></a><span class="in">      .data(d3.range(0, 10, 1))</span></span>
<span id="cb4-631"><a href="#cb4-631" aria-hidden="true" tabindex="-1"></a><span class="in">      .enter()</span></span>
<span id="cb4-632"><a href="#cb4-632" aria-hidden="true" tabindex="-1"></a><span class="in">      .append("line")</span></span>
<span id="cb4-633"><a href="#cb4-633" aria-hidden="true" tabindex="-1"></a><span class="in">      .attr("class", "hour-tick")</span></span>
<span id="cb4-634"><a href="#cb4-634" aria-hidden="true" tabindex="-1"></a><span class="in">      .attr("x1", 0)</span></span>
<span id="cb4-635"><a href="#cb4-635" aria-hidden="true" tabindex="-1"></a><span class="in">      .attr("x2", 0)</span></span>
<span id="cb4-636"><a href="#cb4-636" aria-hidden="true" tabindex="-1"></a><span class="in">      .attr("y1", hourTickStart)</span></span>
<span id="cb4-637"><a href="#cb4-637" aria-hidden="true" tabindex="-1"></a><span class="in">      .attr("y2", hourTickStart + hourTickLength)</span></span>
<span id="cb4-638"><a href="#cb4-638" aria-hidden="true" tabindex="-1"></a><span class="in">      .attr("transform", d =&gt; `rotate(${ten(d)})`);</span></span>
<span id="cb4-639"><a href="#cb4-639" aria-hidden="true" tabindex="-1"></a><span class="in">    face</span></span>
<span id="cb4-640"><a href="#cb4-640" aria-hidden="true" tabindex="-1"></a><span class="in">      .selectAll(".hour-label")</span></span>
<span id="cb4-641"><a href="#cb4-641" aria-hidden="true" tabindex="-1"></a><span class="in">      .data(d3.range(0, 10, 1))</span></span>
<span id="cb4-642"><a href="#cb4-642" aria-hidden="true" tabindex="-1"></a><span class="in">      .enter()</span></span>
<span id="cb4-643"><a href="#cb4-643" aria-hidden="true" tabindex="-1"></a><span class="in">      .append("text")</span></span>
<span id="cb4-644"><a href="#cb4-644" aria-hidden="true" tabindex="-1"></a><span class="in">      .attr("class", "hour-label")</span></span>
<span id="cb4-645"><a href="#cb4-645" aria-hidden="true" tabindex="-1"></a><span class="in">      .attr("text-anchor", "middle")</span></span>
<span id="cb4-646"><a href="#cb4-646" aria-hidden="true" tabindex="-1"></a><span class="in">      .attr("x", d =&gt; hourLabelRadius * Math.sin(ten(d) * radians))</span></span>
<span id="cb4-647"><a href="#cb4-647" aria-hidden="true" tabindex="-1"></a><span class="in">      .attr(</span></span>
<span id="cb4-648"><a href="#cb4-648" aria-hidden="true" tabindex="-1"></a><span class="in">        "y",</span></span>
<span id="cb4-649"><a href="#cb4-649" aria-hidden="true" tabindex="-1"></a><span class="in">        d =&gt; -hourLabelRadius * Math.cos(ten(d) * radians) + hourLabelYOffset</span></span>
<span id="cb4-650"><a href="#cb4-650" aria-hidden="true" tabindex="-1"></a><span class="in">      )</span></span>
<span id="cb4-651"><a href="#cb4-651" aria-hidden="true" tabindex="-1"></a><span class="in">      .text(d =&gt; d);</span></span>
<span id="cb4-652"><a href="#cb4-652" aria-hidden="true" tabindex="-1"></a><span class="in">    const hands = face.append("g").attr("id", "clock-hands");</span></span>
<span id="cb4-653"><a href="#cb4-653" aria-hidden="true" tabindex="-1"></a><span class="in">    hands</span></span>
<span id="cb4-654"><a href="#cb4-654" aria-hidden="true" tabindex="-1"></a><span class="in">      .selectAll("line")</span></span>
<span id="cb4-655"><a href="#cb4-655" aria-hidden="true" tabindex="-1"></a><span class="in">      .data(handData)</span></span>
<span id="cb4-656"><a href="#cb4-656" aria-hidden="true" tabindex="-1"></a><span class="in">      .enter()</span></span>
<span id="cb4-657"><a href="#cb4-657" aria-hidden="true" tabindex="-1"></a><span class="in">      .append("line")</span></span>
<span id="cb4-658"><a href="#cb4-658" aria-hidden="true" tabindex="-1"></a><span class="in">      .attr("class", d =&gt; d.type + "-hand")</span></span>
<span id="cb4-659"><a href="#cb4-659" aria-hidden="true" tabindex="-1"></a><span class="in">      .attr("x1", 0)</span></span>
<span id="cb4-660"><a href="#cb4-660" aria-hidden="true" tabindex="-1"></a><span class="in">      .attr("y1", d =&gt; d.balance || 0)</span></span>
<span id="cb4-661"><a href="#cb4-661" aria-hidden="true" tabindex="-1"></a><span class="in">      .attr("x2", 0)</span></span>
<span id="cb4-662"><a href="#cb4-662" aria-hidden="true" tabindex="-1"></a><span class="in">      .attr("y2", d =&gt; d.length)</span></span>
<span id="cb4-663"><a href="#cb4-663" aria-hidden="true" tabindex="-1"></a><span class="in">      .attr("transform", d =&gt; `rotate(${d.scale(d.value)})`);</span></span>
<span id="cb4-664"><a href="#cb4-664" aria-hidden="true" tabindex="-1"></a><span class="in">    face</span></span>
<span id="cb4-665"><a href="#cb4-665" aria-hidden="true" tabindex="-1"></a><span class="in">      .append("g")</span></span>
<span id="cb4-666"><a href="#cb4-666" aria-hidden="true" tabindex="-1"></a><span class="in">      .attr("id", "face-overlay")</span></span>
<span id="cb4-667"><a href="#cb4-667" aria-hidden="true" tabindex="-1"></a><span class="in">      .append("circle")</span></span>
<span id="cb4-668"><a href="#cb4-668" aria-hidden="true" tabindex="-1"></a><span class="in">      .attr("class", "hands-cover")</span></span>
<span id="cb4-669"><a href="#cb4-669" aria-hidden="true" tabindex="-1"></a><span class="in">      .attr("x", 0)</span></span>
<span id="cb4-670"><a href="#cb4-670" aria-hidden="true" tabindex="-1"></a><span class="in">      .attr("y", 0)</span></span>
<span id="cb4-671"><a href="#cb4-671" aria-hidden="true" tabindex="-1"></a><span class="in">      .attr("r", clockRadius / 20);</span></span>
<span id="cb4-672"><a href="#cb4-672" aria-hidden="true" tabindex="-1"></a><span class="in">  }</span></span>
<span id="cb4-673"><a href="#cb4-673" aria-hidden="true" tabindex="-1"></a><span class="in">  function moveHands() {</span></span>
<span id="cb4-674"><a href="#cb4-674" aria-hidden="true" tabindex="-1"></a><span class="in">    const sel = d3</span></span>
<span id="cb4-675"><a href="#cb4-675" aria-hidden="true" tabindex="-1"></a><span class="in">      .select("#clock-hands-final")</span></span>
<span id="cb4-676"><a href="#cb4-676" aria-hidden="true" tabindex="-1"></a><span class="in">      .selectAll("line")</span></span>
<span id="cb4-677"><a href="#cb4-677" aria-hidden="true" tabindex="-1"></a><span class="in">      .data(handData)</span></span>
<span id="cb4-678"><a href="#cb4-678" aria-hidden="true" tabindex="-1"></a><span class="in">      .transition();</span></span>
<span id="cb4-679"><a href="#cb4-679" aria-hidden="true" tabindex="-1"></a><span class="in">    if (fancySecondsOFF) sel.ease(d3.easeElastic.period(0.5));</span></span>
<span id="cb4-680"><a href="#cb4-680" aria-hidden="true" tabindex="-1"></a><span class="in">    sel.attr("transform", d =&gt; `rotate(${d.scale(d.value)})`);</span></span>
<span id="cb4-681"><a href="#cb4-681" aria-hidden="true" tabindex="-1"></a><span class="in">  }</span></span>
<span id="cb4-682"><a href="#cb4-682" aria-hidden="true" tabindex="-1"></a><span class="in">  function updateData() {</span></span>
<span id="cb4-683"><a href="#cb4-683" aria-hidden="true" tabindex="-1"></a><span class="in">    handData[0].value = !fancySecondsOFF ? Math.floor(selectedExactN * 10) : decTimeN[0];</span></span>
<span id="cb4-684"><a href="#cb4-684" aria-hidden="true" tabindex="-1"></a><span class="in">    handData[1].value = !fancySecondsOFF ? Math.floor(selectedExactN * 10 % 1 * 100) : decTimeN.slice(2, 4);</span></span>
<span id="cb4-685"><a href="#cb4-685" aria-hidden="true" tabindex="-1"></a><span class="in">    handData[2].value = !fancySecondsOFF ? selectedExactN * 10 % 1 * 100 % 1 * 100 : decTimeN.slice(4, 6);</span></span>
<span id="cb4-686"><a href="#cb4-686" aria-hidden="true" tabindex="-1"></a><span class="in">  }</span></span>
<span id="cb4-687"><a href="#cb4-687" aria-hidden="true" tabindex="-1"></a><span class="in">  const svg = d3</span></span>
<span id="cb4-688"><a href="#cb4-688" aria-hidden="true" tabindex="-1"></a><span class="in">    .create("svg")</span></span>
<span id="cb4-689"><a href="#cb4-689" aria-hidden="true" tabindex="-1"></a><span class="in">    .attr("viewBox", [0, 0, w, h])</span></span>
<span id="cb4-690"><a href="#cb4-690" aria-hidden="true" tabindex="-1"></a><span class="in">    .style("max-width", `${width / 2.1}px`)</span></span>
<span id="cb4-691"><a href="#cb4-691" aria-hidden="true" tabindex="-1"></a><span class="in">    .attr("class", "clock-btm")</span></span>
<span id="cb4-692"><a href="#cb4-692" aria-hidden="true" tabindex="-1"></a><span class="in">    .attr("id", "clock");</span></span>
<span id="cb4-693"><a href="#cb4-693" aria-hidden="true" tabindex="-1"></a><span class="in">  svg</span></span>
<span id="cb4-694"><a href="#cb4-694" aria-hidden="true" tabindex="-1"></a><span class="in">    .append("text")</span></span>
<span id="cb4-695"><a href="#cb4-695" aria-hidden="true" tabindex="-1"></a><span class="in">    .text(`-${decTimeN}-${selectedZone}`)</span></span>
<span id="cb4-696"><a href="#cb4-696" aria-hidden="true" tabindex="-1"></a><span class="in">    .attr("x", clockRadius + margin)</span></span>
<span id="cb4-697"><a href="#cb4-697" aria-hidden="true" tabindex="-1"></a><span class="in">    .attr("y", clockRadius * 2 + margin * 1.975)</span></span>
<span id="cb4-698"><a href="#cb4-698" aria-hidden="true" tabindex="-1"></a><span class="in">    .attr("text-anchor", "middle")</span></span>
<span id="cb4-699"><a href="#cb4-699" aria-hidden="true" tabindex="-1"></a><span class="in">    .attr("font-size", 32)</span></span>
<span id="cb4-700"><a href="#cb4-700" aria-hidden="true" tabindex="-1"></a><span class="in">    .attr("font-family", "monospace");</span></span>
<span id="cb4-701"><a href="#cb4-701" aria-hidden="true" tabindex="-1"></a><span class="in">  drawClock();</span></span>
<span id="cb4-702"><a href="#cb4-702" aria-hidden="true" tabindex="-1"></a><span class="in">  // Animation</span></span>
<span id="cb4-703"><a href="#cb4-703" aria-hidden="true" tabindex="-1"></a><span class="in">  const interval = setInterval(</span></span>
<span id="cb4-704"><a href="#cb4-704" aria-hidden="true" tabindex="-1"></a><span class="in">    () =&gt; {</span></span>
<span id="cb4-705"><a href="#cb4-705" aria-hidden="true" tabindex="-1"></a><span class="in">      updateData();</span></span>
<span id="cb4-706"><a href="#cb4-706" aria-hidden="true" tabindex="-1"></a><span class="in">      moveHands();</span></span>
<span id="cb4-707"><a href="#cb4-707" aria-hidden="true" tabindex="-1"></a><span class="in">    },</span></span>
<span id="cb4-708"><a href="#cb4-708" aria-hidden="true" tabindex="-1"></a><span class="in">    !fancySecondsOFF ? 10 : 864</span></span>
<span id="cb4-709"><a href="#cb4-709" aria-hidden="true" tabindex="-1"></a><span class="in">  );</span></span>
<span id="cb4-710"><a href="#cb4-710" aria-hidden="true" tabindex="-1"></a><span class="in">  invalidation.then(() =&gt; clearInterval(interval));</span></span>
<span id="cb4-711"><a href="#cb4-711" aria-hidden="true" tabindex="-1"></a><span class="in">  return svg.node();</span></span>
<span id="cb4-712"><a href="#cb4-712" aria-hidden="true" tabindex="-1"></a><span class="in">}</span></span>
<span id="cb4-713"><a href="#cb4-713" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb4-714"><a href="#cb4-714" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-715"><a href="#cb4-715" aria-hidden="true" tabindex="-1"></a>The plot to the lower left of the mapüó∫Ô∏èvisualizes the night (blue) and day (yellow) time of day (x-axis) throughout every day of the year (y-axis) at the latitude of the red‚≠ïÔ∏ècircle on the mapüó∫Ô∏è. The vertical‚Üïposition of the red&lt;font color=red&gt;‚Äî&lt;/font&gt;line (time of day) and the‚ÜîÔ∏èhorizontal position of the redüî¥dot (day of the year) on the plot control theüåêglobes above and to the right of the plot.</span>
<span id="cb4-716"><a href="#cb4-716" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-717"><a href="#cb4-717" aria-hidden="true" tabindex="-1"></a><span class="fu"># Zone</span></span>
<span id="cb4-718"><a href="#cb4-718" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-719"><a href="#cb4-719" aria-hidden="true" tabindex="-1"></a>Drag the red‚≠ïÔ∏ècircle across the <span class="co">[</span><span class="ot">meridians</span><span class="co">](https://en.wikipedia.org/wiki/Meridian_%28geography%29#:~:text=words%2C%20it%20is-,a%20line%20of%20longitude,-.%20The%20position%20of)</span> (vertical‚Üïgray lines) on the mapüó∫Ô∏èto see how changing time zones affects the time. Only the first digit of the Dec times shown above, the <span class="co">[</span><span class="ot">deciday</span><span class="co">]</span>{.under .tool data-bs-toggle="tooltip" data-bs-title="a tenth of a day"}, varies across time zones, because the 10 Dec time zones, numbered 0 through 9 on the mapüó∫Ô∏è, are each 1 <span class="co">[</span><span class="ot">deci[turn](https://en.wikipedia.org/wiki/Turn_%28angle%29#:~:text=a%20unit%20of%20plane%20angle%20measurement%20equal%20to%202%CF%80%C2%A0radians%2C%20360%C2%A0degrees)</span><span class="co">]</span>{.under .tool data-bs-toggle="tooltip" data-bs-title="a tenth of a turn"} (d<span class="co">[</span><span class="ot">$\tau$</span><span class="co">](https://en.wikipedia.org/wiki/Turn_%28angle%29#:~:text=the%20Greek%20letter,to%20one%20turn)</span>) wide. Simply put, a <span class="co">[</span><span class="ot">deciturn</span><span class="co">]</span>{.under .tool data-bs-toggle="tooltip" data-bs-title="a tenth of a turn"} of longitude translates into a <span class="co">[</span><span class="ot">deciday</span><span class="co">]</span>{.under .tool data-bs-toggle="tooltip" data-bs-title="a tenth of a day"} of time.</span>
<span id="cb4-720"><a href="#cb4-720" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-721"><a href="#cb4-721" aria-hidden="true" tabindex="-1"></a>The leftmost vertical‚Üïline on the mapüó∫Ô∏èis <span class="co">[</span><span class="ot">Meridian 0</span><span class="co">](https://en.wikipedia.org/wiki/18th_meridian_west#:~:text=a%20line%20of%20longitude%20that%20extends%20from%20the%20North%20Pole%20across%20the%20Arctic%20Ocean%2C%20Greenland%2C%20Iceland%2C%20the%20Atlantic%20Ocean%2C%20the%20Canary%20Islands%2C%20the%20Southern%20Ocean%2C%20and%20Antarctica%20to%20the%20South%20Pole)</span>, the Dec <span class="co">[</span><span class="ot">International Date Line</span><span class="co">](https://en.wikipedia.org/wiki/International_Date_Line#:~:text=the%20line%20between%20the%20South%20and%20North%20Poles%20that%20is%20the%20boundary%20between%20one%20calendar%20day%20and%20the%20next)</span> and <span class="co">[</span><span class="ot">prime meridian</span><span class="co">](https://en.wikipedia.org/wiki/Prime_meridian#:~:text=an%20arbitrarily%2Dchosen%20meridian%20%28a%20line%20of%20longitude%29%20in%20a%20geographic%20coordinate%20system%20at%20which%20longitude%20is%20defined%20to%20be%200%C2%B0)</span>, which cuts across the Atlantic Ocean through IcelandüáÆüá∏just West of Africaüåçand is the boundary between Zone 9 and Zone 0, the rightmost and leftmost Dec time zones on the mapüó∫Ô∏è, respectively. Arranging Dec time zones from 0 to 9 yields</span>
<span id="cb4-722"><a href="#cb4-722" aria-hidden="true" tabindex="-1"></a>a <span class="co">[</span><span class="ot">Pacific-centric</span><span class="co">]</span>(https://en.wikipedia.org/wiki/World_map#:~:text=south%2Dup%20map-,Pacific%2Dcentric%20map,-(more%20commonly%20used)) mapüó∫Ô∏è.</span>
<span id="cb4-723"><a href="#cb4-723" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-724"><a href="#cb4-724" aria-hidden="true" tabindex="-1"></a>While only positive Dec time zones are shown on the mapüó∫Ô∏è, every Dec time zone can also be expressed as a negative number. Each pair of time zone numbers produces the same Dec time, but result in <span class="co">[</span><span class="ot">Dec dates</span><span class="co">](/dec/date)</span>üóìÔ∏èthat are 1 day apart. Negative time zone numbers can be useful for getting <span class="co">[</span><span class="ot">Dec dates</span><span class="co">](/dec/date)</span>üóìÔ∏èto match <span class="co">[</span><span class="ot">Gregorian calendar</span><span class="co">](https://en.wikipedia.org/wiki/Gregorian_calendar#:~:text=the%20calendar%20used%20in%20most%20parts%20of%20the%20world)</span> datesüóìÔ∏èwith negative <span class="co">[</span><span class="ot">UTC offsets</span><span class="co">]</span>(https://en.wikipedia.org/wiki/UTC_offset#:~:text=the%20difference%20in%20hours%20and%20minutes%20between%20Coordinated%20Universal%20Time%20(UTC)%20and%20the%20standard%20time%20at%20a%20particular%20place).</span>
<span id="cb4-725"><a href="#cb4-725" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-726"><a href="#cb4-726" aria-hidden="true" tabindex="-1"></a>There are <span class="co">[</span><span class="ot">37 UTC offsets</span><span class="co">](https://en.wikipedia.org/wiki/List_of_UTC_offsets)</span>, but only 10 Dec time zones. Conversion between Dec time zones and UTC offsets is inexact, because UTC offsets depend on geographic and political boundaries, whereas Dec time zones are determined solely by longitude. If you know your longitude in degrees (¬∞) or <span class="co">[</span><span class="ot">centi[turns](https://en.wikipedia.org/wiki/Turn_%28angle%29#:~:text=a%20unit%20of%20plane%20angle%20measurement%20equal%20to%202%CF%80%C2%A0radians%2C%20360%C2%A0degrees)</span><span class="co">]</span>{.under .tool data-bs-toggle="tooltip" data-bs-title="hundredths of a turn"}  (<span class="co">[</span><span class="ot">$c\tau$</span><span class="co">](https://en.wikipedia.org/wiki/Turn_%28angle%29#:~:text=the%20Greek%20letter,to%20one%20turn)</span>), you can look up your Dec time zone (TZ) in the table below.</span>
<span id="cb4-727"><a href="#cb4-727" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-728"><a href="#cb4-728" aria-hidden="true" tabindex="-1"></a>| TZ&lt;br&gt;+ | TZ&lt;br&gt;- | Start&lt;br&gt;¬∞ | Mid&lt;br&gt;¬∞ | End&lt;br&gt;¬∞ | Start&lt;br&gt;$c\tau$ | Mid&lt;br&gt;$c\tau$ | End&lt;br&gt;$c\tau$ |</span>
<span id="cb4-729"><a href="#cb4-729" aria-hidden="true" tabindex="-1"></a>| :---:   | :---:   | :---:      | :---:    | :---:    | :---:            | :---:          | :---:          |</span>
<span id="cb4-730"><a href="#cb4-730" aria-hidden="true" tabindex="-1"></a>| 9       | -1      | -54        | -36      | -18      | 90               | 95             | 100            |</span>
<span id="cb4-731"><a href="#cb4-731" aria-hidden="true" tabindex="-1"></a>| 8       | -2      | -90        | -72      | -54      | 80               | 85             | 90             |</span>
<span id="cb4-732"><a href="#cb4-732" aria-hidden="true" tabindex="-1"></a>| 7       | -3      | -126       | -108     | -90      | 70               | 75             | 80             |</span>
<span id="cb4-733"><a href="#cb4-733" aria-hidden="true" tabindex="-1"></a>| 6       | -4      | -162       | -144     | -126     | 60               | 65             | 70             |</span>
<span id="cb4-734"><a href="#cb4-734" aria-hidden="true" tabindex="-1"></a>| 5       | -5      | 162        | 180      | -162     | 50               | 55             | 60             |</span>
<span id="cb4-735"><a href="#cb4-735" aria-hidden="true" tabindex="-1"></a>| 4       | -6      | 126        | 144      | 162      | 40               | 45             | 50             |</span>
<span id="cb4-736"><a href="#cb4-736" aria-hidden="true" tabindex="-1"></a>| 3       | -7      | 90         | 108      | 126      | 30               | 35             | 40             |</span>
<span id="cb4-737"><a href="#cb4-737" aria-hidden="true" tabindex="-1"></a>| 2       | -8      | 54         | 72       | 90       | 20               | 25             | 30             |</span>
<span id="cb4-738"><a href="#cb4-738" aria-hidden="true" tabindex="-1"></a>| 1       | -9      | 18         | 36       | 54       | 10               | 15             | 20             |</span>
<span id="cb4-739"><a href="#cb4-739" aria-hidden="true" tabindex="-1"></a>| 0       | -10     | -18        | 0        | 18       | 0                | 5              | 10             |</span>
<span id="cb4-740"><a href="#cb4-740" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-741"><a href="#cb4-741" aria-hidden="true" tabindex="-1"></a>Dec times in Zone 0 and 5 can be directly converted to and from UTC times with an offset of 0 and 12 hours, respectively. The other Dec time zones will differ from the closest UTC time by 8.<span class="co">[</span><span class="ot">3</span><span class="co">]</span>{.over}, 16.<span class="co">[</span><span class="ot">6</span><span class="co">]</span>{.over}, 25, 33.<span class="co">[</span><span class="ot">3</span><span class="co">]</span>{.over}, 41.<span class="co">[</span><span class="ot">6</span><span class="co">]</span>{.over} or 50 <span class="co">[</span><span class="ot">millidays</span><span class="co">]</span>{.under .tool data-bs-toggle="tooltip" data-bs-title="thousands of a day"}. To find the difference <span class="dv">&amp;delta;</span>, convert the UTC offset hours <span class="co">[</span><span class="ot">o~H~</span><span class="co">]</span>{.cyan} and minutes <span class="co">[</span><span class="ot">o~M~</span><span class="co">]</span>{.cyan} into <span class="co">[</span><span class="ot">deci[turns](https://en.wikipedia.org/wiki/Turn_%28angle%29#:~:text=a%20unit%20of%20plane%20angle%20measurement%20equal%20to%202%CF%80%C2%A0radians%2C%20360%C2%A0degrees)</span><span class="co">]</span>{.under .tool data-bs-toggle="tooltip" data-bs-title="tenths of a turn"} of the longitude <span class="dv">&amp;lambda;</span> and then subtract the Dec zone number <span class="co">[</span><span class="ot">z</span><span class="co">]</span>{.lime}:</span>
<span id="cb4-742"><a href="#cb4-742" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-743"><a href="#cb4-743" aria-hidden="true" tabindex="-1"></a>$$\lambda = o_H \div 2.4 + o_M \div 144$$</span>
<span id="cb4-744"><a href="#cb4-744" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-745"><a href="#cb4-745" aria-hidden="true" tabindex="-1"></a>$$z = \lfloor\lambda + 1 \div 2\rfloor$$</span>
<span id="cb4-746"><a href="#cb4-746" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-747"><a href="#cb4-747" aria-hidden="true" tabindex="-1"></a>$$\delta = \lambda - z$$</span>
<span id="cb4-748"><a href="#cb4-748" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-749"><a href="#cb4-749" aria-hidden="true" tabindex="-1"></a>We can avoid dealing with the time zone difference by shifting the time zone so that we always convert between Zone 0 and <span class="co">[</span><span class="ot">UTC+00:00</span><span class="co">](https://en.wikipedia.org/wiki/List_of_UTC_offsets#UTC+00:00,_Z)</span> or Zone 5 and <span class="co">[</span><span class="ot">UTC+12:00</span><span class="co">](https://en.wikipedia.org/wiki/List_of_UTC_offsets#UTC+12:00,_M)</span>. To obtain the Zone 0 time, we evaluate a Dec time as a math expression, add 10, and get the remainder after dividing by 10 to make sure the result is less than 10 <span class="co">[</span><span class="ot">decidays</span><span class="co">](https://en.wikipedia.org/wiki/Decimal_time#:~:text=dividing%20the%20day%20into%2010%20decidays)</span>{.under .tool data-bs-toggle="tooltip" data-bs-title="tenths of a day"}: (<span class="co">[</span><span class="ot">\${browserTime.toFixed(4)}</span><span class="co">]</span>{.cyan} \${browserSign} <span class="co">[</span><span class="ot">\${Math.abs(browserZone)}</span><span class="co">]</span>{.lime} + 10) <span class="co">[</span><span class="ot">mod</span><span class="co">](https://en.wikipedia.org/wiki/Modulo#:~:text=returns%20the%20remainder)</span> 10 = <span class="co">[</span><span class="ot">\${zone0time.toFixed(4)}</span><span class="co">]</span>{.cyan}.</span>
<span id="cb4-750"><a href="#cb4-750" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-751"><a href="#cb4-751" aria-hidden="true" tabindex="-1"></a>::: {.callout-warning}</span>
<span id="cb4-752"><a href="#cb4-752" aria-hidden="true" tabindex="-1"></a><span class="fu"># Bad Pun Alert</span></span>
<span id="cb4-753"><a href="#cb4-753" aria-hidden="true" tabindex="-1"></a>Sorry if reading this takes a long <span class="co">[</span><span class="ot">time</span><span class="co">]</span>{.cyan}; I hope you don‚Äôt <span class="co">[</span><span class="ot">zone</span><span class="co">]</span>{.lime} out!</span>
<span id="cb4-754"><a href="#cb4-754" aria-hidden="true" tabindex="-1"></a>:::</span>
<span id="cb4-755"><a href="#cb4-755" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-756"><a href="#cb4-756" aria-hidden="true" tabindex="-1"></a><span class="fu"># Unit</span></span>
<span id="cb4-757"><a href="#cb4-757" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-758"><a href="#cb4-758" aria-hidden="true" tabindex="-1"></a>Dec uses <span class="co">[</span><span class="ot">metric prefixes</span><span class="co">](https://en.wikipedia.org/wiki/Metric_prefix#:~:text=a%20unit%20prefix%20that%20precedes%20a%20basic%20unit%20of%20measure%20to%20indicate%20a%20multiple%20or%20submultiple%20of%20the%20unit)</span> to create <span class="co">[</span><span class="ot">submultiples</span><span class="co">](https://en.wikipedia.org/wiki/Multiple_%28mathematics%29#Submultiple:~:text=of%20%22a%20being-,a%20unit%20fraction,-of%20b%22%20)</span> of a day that can naturally be combined together into a single <span class="co">[</span><span class="ot">decimal</span><span class="co">](https://en.wikipedia.org/wiki/Decimal#:~:text=system%20for%20denoting%20integer%20and%20non%2Dinteger%20numbers)</span> number. Conversion between decimal units is as simple as moving‚ÜîÔ∏éÔ∏èor removing‚ùåthe <span class="co">[</span><span class="ot">decimal separator</span><span class="co">](https://en.wikipedia.org/wiki/Decimal_separator#:~:text=a%20symbol%20that%20separates%20the%20integer%20part%20from%20the%20fractional%20part%20of%20a%20number)</span>. In contrast, an <span class="in">`hh:mm:ss`</span> time is a <span class="co">[</span><span class="ot">mixed-radix</span><span class="co">](https://en.wikipedia.org/wiki/Mixed_radix#:~:text=non%2Dstandard%20positional%20numeral%20systems%20in%20which%20the%20numerical%20base%20varies%20from%20position%20to%20position)</span> number, where <span class="in">`hh`</span> is the <span class="co">[</span><span class="ot">base-12</span><span class="co">](https://en.wikipedia.org/wiki/List_of_numeral_systems#:~:text=12-,Duodecimal,-%2C%20dozenal)</span> or <span class="co">[</span><span class="ot">base-24</span><span class="co">](https://en.wikipedia.org/wiki/List_of_numeral_systems#:~:text=24-,Quadravigesimal,-%5B48%5D)</span> hour, <span class="in">`mm`</span> is the <span class="co">[</span><span class="ot">base-60</span><span class="co">](https://en.wikipedia.org/wiki/List_of_numeral_systems#:~:text=60-,Sexagesimal,-Babylonian%20numerals%20and)</span> minute, and <span class="in">`ss`</span> is the base-60 second.</span>
<span id="cb4-759"><a href="#cb4-759" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-760"><a href="#cb4-760" aria-hidden="true" tabindex="-1"></a>| Prefix     | Power | Day    | hh:mm:ss.sss |</span>
<span id="cb4-761"><a href="#cb4-761" aria-hidden="true" tabindex="-1"></a>| ---------- | ----- | ------ | ------------ |</span>
<span id="cb4-762"><a href="#cb4-762" aria-hidden="true" tabindex="-1"></a>|            |  0    | 1      | 24:00:00.000 |</span>
<span id="cb4-763"><a href="#cb4-763" aria-hidden="true" tabindex="-1"></a>| deci       | -1    | .1     | 02:24:00.000 |</span>
<span id="cb4-764"><a href="#cb4-764" aria-hidden="true" tabindex="-1"></a>| centi      | -2    | .01    | 00:14:24.000 |</span>
<span id="cb4-765"><a href="#cb4-765" aria-hidden="true" tabindex="-1"></a>| milli      | -3    | .001   | 00:01:26.400 |</span>
<span id="cb4-766"><a href="#cb4-766" aria-hidden="true" tabindex="-1"></a>| decimilli  | -4    | .0001  | 00:00:08.640 |</span>
<span id="cb4-767"><a href="#cb4-767" aria-hidden="true" tabindex="-1"></a>| centimilli | -5    | .00001 | 00:00:00.864 |</span>
<span id="cb4-768"><a href="#cb4-768" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-769"><a href="#cb4-769" aria-hidden="true" tabindex="-1"></a>To convert the hour <span class="co">[</span><span class="ot">h</span><span class="co">]</span>{.orchid}, minute <span class="co">[</span><span class="ot">m</span><span class="co">]</span>{.maroon}, and second <span class="co">[</span><span class="ot">s</span><span class="co">]</span>{.seagreen} into the <span class="co">[</span><span class="ot">deciday</span><span class="co">](https://en.wikipedia.org/wiki/Decimal_time#:~:text=dividing%20the%20day%20into%2010%20decidays)</span>{.under .tool data-bs-toggle="tooltip" data-bs-title="a tenth of a day"} <span class="co">[</span><span class="ot">d</span><span class="co">]</span>{.cyan}, Dec uses the following equation: <span class="co">[</span><span class="ot">d</span><span class="co">]</span>{.cyan} = <span class="co">[</span><span class="ot">h</span><span class="co">]</span>{.orchid} <span class="dv">&amp;div;</span> 2.4 + <span class="co">[</span><span class="ot">m</span><span class="co">]</span>{.maroon} <span class="dv">&amp;div;</span> 144 + <span class="co">[</span><span class="ot">s</span><span class="co">]</span>{.seagreen} <span class="dv">&amp;div;</span> 8640. The current equation values in Zone <span class="co">[</span><span class="ot">\${browserZone}</span><span class="co">]</span>{.lime} are: <span class="co">[</span><span class="ot">\${browserTime.toFixed(4)}</span><span class="co">]</span>{.cyan} = <span class="co">[</span><span class="ot">\${Math.floor(hours).toString().padStart(2, "0")}</span><span class="co">]</span>{.orchid} <span class="dv">&amp;div;</span> 2.4 + <span class="co">[</span><span class="ot">\${Math.floor(minutes).toString().padStart(2, "0")}</span><span class="co">]</span>{.maroon} <span class="dv">&amp;div;</span> 144 + <span class="co">[</span><span class="ot">\${Math.floor(seconds).toString().padStart(2, "0")}</span><span class="co">]</span>{.seagreen} <span class="dv">&amp;div;</span> 8640. Inversely, we can convert <span class="co">[</span><span class="ot">decidays</span><span class="co">](https://en.wikipedia.org/wiki/Decimal_time#:~:text=dividing%20the%20day%20into%2010%20decidays)</span>{.under .tool data-bs-toggle="tooltip" data-bs-title="tenths of a day"} into hours: <span class="co">[</span><span class="ot">h</span><span class="co">]</span>{.orchid} = <span class="co">[</span><span class="ot">d</span><span class="co">]</span>{.cyan} <span class="dv">&amp;times;</span> 2.4, minutes: <span class="co">[</span><span class="ot">m</span><span class="co">]</span>{.maroon} = <span class="co">[</span><span class="ot">h</span><span class="co">]</span>{.orchid} <span class="co">[</span><span class="ot">mod</span><span class="co">](https://en.wikipedia.org/wiki/Modulo#:~:text=returns%20the%20remainder)</span> 1 <span class="dv">&amp;times;</span> 60, and seconds: <span class="co">[</span><span class="ot">s</span><span class="co">]</span>{.seagreen} = <span class="co">[</span><span class="ot">m</span><span class="co">]</span>{.maroon} <span class="co">[</span><span class="ot">mod</span><span class="co">](https://en.wikipedia.org/wiki/Modulo#:~:text=returns%20the%20remainder)</span> 1 <span class="dv">&amp;times;</span> 60.</span>
<span id="cb4-770"><a href="#cb4-770" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-771"><a href="#cb4-771" aria-hidden="true" tabindex="-1"></a>Instead of dealing with hours, minutes, and seconds, we can convert the <span class="co">[</span><span class="ot">UNIX timestamp</span><span class="co">](https://en.wikipedia.org/wiki/Unix_time#:~:text=the%20number%20of%20non%2Dleap%20seconds%20that%20have%20elapsed%20since%2000%3A00%3A00%20UTC%20on%201%C2%A0January%201970)</span> <span class="co">[</span><span class="ot">u</span><span class="co">]</span>{.azul} into the Dec time <span class="co">[</span><span class="ot">d</span><span class="co">]</span>{.cyan}+<span class="co">[</span><span class="ot">0</span><span class="co">]</span>{.lime}. First, we divide <span class="co">[</span><span class="ot">u</span><span class="co">]</span>{.azul} by 86400 to convert seconds to days, then isolate the <span class="co">[</span><span class="ot">decimal part</span><span class="co">](https://en.wikipedia.org/wiki/Fractional_part#:~:text=the%20excess%20beyond%20that%20number%27s%20integer%20part)</span> of the <span class="co">[</span><span class="ot">quotient</span><span class="co">](https://en.wikipedia.org/wiki/Quotient#:~:text=a%20quantity%20produced%20by%20the%20division%20of%20two%20numbers)</span>, and finally multiply by 10: <span class="co">[</span><span class="ot">d</span><span class="co">]</span>{.cyan} + <span class="co">[</span><span class="ot">0</span><span class="co">]</span>{.lime} = <span class="co">[</span><span class="ot">u</span><span class="co">]</span>{.azul} <span class="dv">&amp;div;</span> 86400 <span class="co">[</span><span class="ot">mod</span><span class="co">](https://en.wikipedia.org/wiki/Modulo#:~:text=returns%20the%20remainder)</span> 1 <span class="dv">&amp;times;</span> 10. The current values in this equation are <span class="co">[</span><span class="ot">\${browserTime.toFixed(4)}</span><span class="co">]</span>{.cyan} + <span class="co">[</span><span class="ot">0</span><span class="co">]</span>{.lime} = <span class="co">[</span><span class="ot">\${(unix / 1000).toFixed(0)}</span><span class="co">]</span>{.azul} <span class="dv">&amp;div;</span> 86400 <span class="co">[</span><span class="ot">mod</span><span class="co">](https://en.wikipedia.org/wiki/Modulo#:~:text=returns%20the%20remainder)</span> 1 <span class="dv">&amp;times;</span> 10.</span>
<span id="cb4-772"><a href="#cb4-772" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-773"><a href="#cb4-773" aria-hidden="true" tabindex="-1"></a>The concept of measuring time in decimal days is not novel. In the late 1700s, the <span class="co">[</span><span class="ot">French Republican calendar</span><span class="co">](https://en.wikipedia.org/wiki/French_Republican_calendar#:~:text=a%20calendar%20created%20and%20implemented%20during%20the%20French%20Revolution)</span> time system referred to <span class="co">[</span><span class="ot">decidays</span><span class="co">](https://en.wikipedia.org/wiki/Decimal_time#:~:text=dividing%20the%20day%20into%2010%20decidays)</span>{.under .tool data-bs-toggle="tooltip" data-bs-title="tenths of a day"} as decimal hours, <span class="co">[</span><span class="ot">centidays</span><span class="co">]</span>{.under .tool data-bs-toggle="tooltip" data-bs-title="hundredths of a day"} as <span class="co">[</span><span class="ot">d√©cimes</span><span class="co">](https://en.wikipedia.org/wiki/Decimal_time#:~:text=into%20tenths%2C%20or-,d%C3%A9cimes,-%2C%20instead%20of%20minutes)</span>, <span class="co">[</span><span class="ot">millidays</span><span class="co">]</span>{.under .tool data-bs-toggle="tooltip" data-bs-title="thousandths of a day"} as decimal minutes, and <span class="co">[</span><span class="ot">centimillidays</span><span class="co">]</span>{.under .tool data-bs-toggle="tooltip" data-bs-title="hundred thousandths of a day"} as decimal seconds. Similarly, <span class="co">[</span><span class="ot">Swatch Internet Time</span><span class="co">](https://en.wikipedia.org/wiki/Swatch_Internet_Time#:~:text=a%20decimal%20time%20system%20introduced%20in%201998%20by%20the%20Swatch%20corporation)</span>, a <span class="co">[</span><span class="ot">decimal time</span><span class="co">](https://en.wikipedia.org/wiki/Decimal_time#:~:text=the%20representation%20of%20the%20time%20of%20day%20using%20units%20which%20are%20decimally%20related)</span> system introduced in 1998, uses the term ".beats" for <span class="co">[</span><span class="ot">millidays</span><span class="co">]</span>{.under .tool data-bs-toggle="tooltip" data-bs-title="thousandths of a day"}.</span>
<span id="cb4-774"><a href="#cb4-774" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-775"><a href="#cb4-775" aria-hidden="true" tabindex="-1"></a>Swatch Internet Time differs from Dec in that it <span class="co">[</span><span class="ot">has no time zones</span><span class="co">](https://en.wikipedia.org/wiki/Swatch_Internet_Time#Calculation_from_UTC+1:~:text=There%20are%20no%20time%20zones%20in%20Swatch%20Internet%20Time)</span> and is obtained from the <span class="co">[</span><span class="ot">hours, minutes, and seconds</span><span class="co">](https://en.wikipedia.org/wiki/Swatch_Internet_Time#Calculation_from_UTC+1:~:text=The%20formula%20for%20calculating%20the%20time%20in%20.beats%20from%20UTC%2B1)</span> of <span class="co">[</span><span class="ot">UTC+01:00</span><span class="co">](https://en.wikipedia.org/wiki/UTC%2B01:00#:~:text=a%20time%20offset%20from%20UTC%20of%20%2B01%3A00)</span>. In contrast, the major innovations described in this article are the Dec time zone system and the simple equation for obtaining the Dec time in Zone 0 from a UNIX timestamp, but Dec has much more to offer than <span class="co">[</span><span class="ot">deciday</span><span class="co">](https://en.wikipedia.org/wiki/Decimal_time#:~:text=dividing%20the%20day%20into%2010%20decidays)</span>{.under .tool data-bs-toggle="tooltip" data-bs-title="a tenth of a day"} times and zones.</span>
<span id="cb4-776"><a href="#cb4-776" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-777"><a href="#cb4-777" aria-hidden="true" tabindex="-1"></a><span class="fu"># Next</span></span>
<span id="cb4-778"><a href="#cb4-778" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-779"><a href="#cb4-779" aria-hidden="true" tabindex="-1"></a>The next article in the <span class="co">[</span><span class="ot">Dec section</span><span class="co">](/dec)</span> of my site compares Dec to the <span class="co">[</span><span class="ot">ISO 8601</span><span class="co">](https://en.wikipedia.org/wiki/ISO_8601#:~:text=an%20international%20standard%20covering%20the%20worldwide%20exchange%20and%20communication%20of%20date%20and%20time%2Drelated%20data)</span> international standard for dates and times. Like ISO 8601, Dec allows for <span class="co">[</span><span class="ot">combined date and time representations</span><span class="co">](https://en.wikipedia.org/wiki/ISO_8601#Combined_date_and_time_representations)</span> that can be paired up to express <span class="co">[</span><span class="ot">time intervals</span><span class="co">](https://en.wikipedia.org/wiki/ISO_8601#Time_intervals:~:text=the%20intervening%20time%20between%20two%20time%20points)</span>. In Dec, the combination of a date and time is called a snapü´∞and a time interval expressed as a pair of snaps is called a spanüåà.</span>
<span id="cb4-780"><a href="#cb4-780" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-781"><a href="#cb4-781" aria-hidden="true" tabindex="-1"></a>My <span class="co">[</span><span class="ot">ISO 8601 article</span><span class="co">](/dec/iso)</span> is unique because it avoids the use of Observable in favor of leveraging <span class="co">[</span><span class="ot">Jupyter</span><span class="co">](https://jupyter.org)</span> support in Quarto to make the code underlying Dec available in multiple programming languages. Observable is a great visualization tool but does not translate well into Jupyter notebooks. After the next article, I return to the use of Observable in my Dec <span class="co">[</span><span class="ot">snap</span><span class="co">](/dec/span)</span>ü´∞and <span class="co">[</span><span class="ot">span</span><span class="co">](/dec/span)</span>üåàarticles.</span>
<span id="cb4-782"><a href="#cb4-782" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-785"><a href="#cb4-785" aria-hidden="true" tabindex="-1"></a><span class="in">```{mermaid}</span></span>
<span id="cb4-786"><a href="#cb4-786" aria-hidden="true" tabindex="-1"></a><span class="in">%%| label: navchart</span></span>
<span id="cb4-787"><a href="#cb4-787" aria-hidden="true" tabindex="-1"></a><span class="in">flowchart LR</span></span>
<span id="cb4-788"><a href="#cb4-788" aria-hidden="true" tabindex="-1"></a><span class="in">   B[date]--&gt;C[time]--&gt;D[iso]--&gt;E[snap]--&gt;F[span]</span></span>
<span id="cb4-789"><a href="#cb4-789" aria-hidden="true" tabindex="-1"></a><span class="in">   click B "/dec/date"</span></span>
<span id="cb4-790"><a href="#cb4-790" aria-hidden="true" tabindex="-1"></a><span class="in">   click C "/dec/time"</span></span>
<span id="cb4-791"><a href="#cb4-791" aria-hidden="true" tabindex="-1"></a><span class="in">   click D "/dec/iso"</span></span>
<span id="cb4-792"><a href="#cb4-792" aria-hidden="true" tabindex="-1"></a><span class="in">   click E "/dec/snap"</span></span>
<span id="cb4-793"><a href="#cb4-793" aria-hidden="true" tabindex="-1"></a><span class="in">   click F "/dec/span"</span></span>
<span id="cb4-794"><a href="#cb4-794" aria-hidden="true" tabindex="-1"></a><span class="in">   style C stroke:#99f,stroke-width:5px</span></span>
<span id="cb4-795"><a href="#cb4-795" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb4-796"><a href="#cb4-796" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-797"><a href="#cb4-797" aria-hidden="true" tabindex="-1"></a><span class="fu"># Cite</span></span>
<span id="cb4-798"><a href="#cb4-798" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-799"><a href="#cb4-799" aria-hidden="true" tabindex="-1"></a>Please spread the good word about Dec using the citation information at the bottom of this article. You may also want to cite the Observable notebooks that I adapted into the clocküïì, barüìächart, mapüó∫Ô∏è, and daylight‚òÄÔ∏èplot visualizations in this article or the 2014 blog post which proposed a system of 20 decimal time zones, each 5 <span class="co">[</span><span class="ot">centidays</span><span class="co">]</span>{.under .tool data-bs-toggle="tooltip" data-bs-title="hundredths of a day"} wide, based on the <span class="co">[</span><span class="ot">Greenwich Meridian</span><span class="co">]</span>(https://en.wikipedia.org/wiki/Prime_meridian_(Greenwich)#:~:text=a%20geographical%20reference%20line%20that%20passes%20through%20the%20Royal%20Observatory%2C%20Greenwich%2C%20in%20London%2C%20England):</span>
<span id="cb4-800"><a href="#cb4-800" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-801"><a href="#cb4-801" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span><span class="co">[</span><span class="ot">Pearson, Tom</span><span class="co">](https://www.2x2.graphics)</span>. [<span class="co">[</span><span class="ot">2013</span><span class="co">]</span>{.yellow}+<span class="co">[</span><span class="ot">124</span><span class="co">]</span>{.cyan}]{.underline .tool data-bs-toggle="tooltip" data-bs-title="2013-07-03"}. ‚ÄúSimple D3 clock.‚Äù <span class="co">[</span><span class="ot">\${decYear}</span><span class="co">]</span>{.yellow}+<span class="co">[</span><span class="ot">\${decDate}</span><span class="co">]</span>{.cyan}. <span class="ot">&lt;https://observablehq.com/@d3/simple-clock&gt;</span>.</span>
<span id="cb4-802"><a href="#cb4-802" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span><span class="co">[</span><span class="ot">Heyen, Frank</span><span class="co">](https://fheyen.github.io)</span>. [<span class="co">[</span><span class="ot">2021</span><span class="co">]</span>{.yellow}+<span class="co">[</span><span class="ot">246</span><span class="co">]</span>{.cyan}]{.underline .tool data-bs-toggle="tooltip" data-bs-title="2021-11-02"}. ‚ÄúBarChart Clock.‚Äù <span class="co">[</span><span class="ot">\${decYear}</span><span class="co">]</span>{.yellow}+<span class="co">[</span><span class="ot">\${decDate}</span><span class="co">]</span>{.cyan}. <span class="ot">&lt;https://observablehq.com/@fheyen/barchart-clock&gt;</span>.</span>
<span id="cb4-803"><a href="#cb4-803" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span><span class="co">[</span><span class="ot">Johnson, Ian</span><span class="co">](https://enjalot.github.io)</span>. [<span class="co">[</span><span class="ot">2021</span><span class="co">]</span>{.yellow}+<span class="co">[</span><span class="ot">090</span><span class="co">]</span>{.cyan}]{.underline .tool data-bs-toggle="tooltip" data-bs-title="2021-05-30"}. ‚ÄúDraggable World Map Coordinates Input.‚Äù <span class="co">[</span><span class="ot">\${decYear}</span><span class="co">]</span>{.yellow}+<span class="co">[</span><span class="ot">\${decDate}</span><span class="co">]</span>{.cyan}. <span class="ot">&lt;https://observablehq.com/@enjalot/draggable-world-map-coordinates-input&gt;</span>.</span>
<span id="cb4-804"><a href="#cb4-804" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span><span class="co">[</span><span class="ot">Bridges, Dan</span><span class="co">](https://www.danbridges.org)</span>. [<span class="co">[</span><span class="ot">2021</span><span class="co">]</span>{.yellow}+<span class="co">[</span><span class="ot">311</span><span class="co">]</span>{.cyan}]{.underline .tool data-bs-toggle="tooltip" data-bs-title="2022-01-06"}. ‚ÄúVisualizing Seasonal Daylight.‚Äù <span class="co">[</span><span class="ot">\${decYear}</span><span class="co">]</span>{.yellow}+<span class="co">[</span><span class="ot">\${decDate}</span><span class="co">]</span>{.cyan}. <span class="ot">&lt;https://observablehq.com/@dbridges/visualizing-seasonal-daylight&gt;</span>.</span>
<span id="cb4-805"><a href="#cb4-805" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span><span class="co">[</span><span class="ot">Clements, John</span><span class="co">](https://www.brinckerhoff.org)</span>. [<span class="co">[</span><span class="ot">2014</span><span class="co">]</span>{.yellow}+<span class="co">[</span><span class="ot">091</span><span class="co">]</span>{.cyan}]{.underline .tool data-bs-toggle="tooltip" data-bs-title="2021-05-31"}, ‚ÄúDecimal Time Zones.‚Äù <span class="co">[</span><span class="ot">\${decYear}</span><span class="co">]</span>{.yellow}+<span class="co">[</span><span class="ot">\${decDate}</span><span class="co">]</span>{.cyan}. <span class="ot">&lt;https://www.brinckerhoff.org/blog/2014/05/31/decimal-time-zones&gt;</span>.</span>
<span id="cb4-806"><a href="#cb4-806" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-809"><a href="#cb4-809" aria-hidden="true" tabindex="-1"></a><span class="in">```{ojs}</span></span>
<span id="cb4-810"><a href="#cb4-810" aria-hidden="true" tabindex="-1"></a><span class="in">//| echo: false</span></span>
<span id="cb4-811"><a href="#cb4-811" aria-hidden="true" tabindex="-1"></a><span class="in">//| output: false</span></span>
<span id="cb4-812"><a href="#cb4-812" aria-hidden="true" tabindex="-1"></a><span class="in">unix = {</span></span>
<span id="cb4-813"><a href="#cb4-813" aria-hidden="true" tabindex="-1"></a><span class="in">  while(true) {</span></span>
<span id="cb4-814"><a href="#cb4-814" aria-hidden="true" tabindex="-1"></a><span class="in">    yield Date.now();</span></span>
<span id="cb4-815"><a href="#cb4-815" aria-hidden="true" tabindex="-1"></a><span class="in">  }</span></span>
<span id="cb4-816"><a href="#cb4-816" aria-hidden="true" tabindex="-1"></a><span class="in">}</span></span>
<span id="cb4-817"><a href="#cb4-817" aria-hidden="true" tabindex="-1"></a><span class="in">function unix2dote(unix, zone, offset = 719468) {</span></span>
<span id="cb4-818"><a href="#cb4-818" aria-hidden="true" tabindex="-1"></a><span class="in">  return [(unix ?? Date.now()) / 86400000 + (</span></span>
<span id="cb4-819"><a href="#cb4-819" aria-hidden="true" tabindex="-1"></a><span class="in">    zone = zone ?? -Math.round(</span></span>
<span id="cb4-820"><a href="#cb4-820" aria-hidden="true" tabindex="-1"></a><span class="in">      (new Date).getTimezoneOffset() / 144)</span></span>
<span id="cb4-821"><a href="#cb4-821" aria-hidden="true" tabindex="-1"></a><span class="in">    ) / 10 + offset, zone]</span></span>
<span id="cb4-822"><a href="#cb4-822" aria-hidden="true" tabindex="-1"></a><span class="in">}</span></span>
<span id="cb4-823"><a href="#cb4-823" aria-hidden="true" tabindex="-1"></a><span class="in">function unix2dote1(unix, zone, offset = 719468) {</span></span>
<span id="cb4-824"><a href="#cb4-824" aria-hidden="true" tabindex="-1"></a><span class="in">  return [</span></span>
<span id="cb4-825"><a href="#cb4-825" aria-hidden="true" tabindex="-1"></a><span class="in">    (unix ?? Date.now()) / 86400000</span></span>
<span id="cb4-826"><a href="#cb4-826" aria-hidden="true" tabindex="-1"></a><span class="in">    + (zone = zone ?? (10 - Math.round(</span></span>
<span id="cb4-827"><a href="#cb4-827" aria-hidden="true" tabindex="-1"></a><span class="in">        (new Date).getTimezoneOffset() / 144)) % 10</span></span>
<span id="cb4-828"><a href="#cb4-828" aria-hidden="true" tabindex="-1"></a><span class="in">      ) / 10 + offset, zone]</span></span>
<span id="cb4-829"><a href="#cb4-829" aria-hidden="true" tabindex="-1"></a><span class="in">}</span></span>
<span id="cb4-830"><a href="#cb4-830" aria-hidden="true" tabindex="-1"></a><span class="in">function dote2date(dote, zone = 0) {</span></span>
<span id="cb4-831"><a href="#cb4-831" aria-hidden="true" tabindex="-1"></a><span class="in">  const cote = Math.floor((</span></span>
<span id="cb4-832"><a href="#cb4-832" aria-hidden="true" tabindex="-1"></a><span class="in">      dote &gt;= 0 ? dote</span></span>
<span id="cb4-833"><a href="#cb4-833" aria-hidden="true" tabindex="-1"></a><span class="in">      : dote - 146096</span></span>
<span id="cb4-834"><a href="#cb4-834" aria-hidden="true" tabindex="-1"></a><span class="in">    ) / 146097),</span></span>
<span id="cb4-835"><a href="#cb4-835" aria-hidden="true" tabindex="-1"></a><span class="in">  dotc = dote - cote * 146097,</span></span>
<span id="cb4-836"><a href="#cb4-836" aria-hidden="true" tabindex="-1"></a><span class="in">  yotc = Math.floor((dotc</span></span>
<span id="cb4-837"><a href="#cb4-837" aria-hidden="true" tabindex="-1"></a><span class="in">    - Math.floor(dotc / 1460)</span></span>
<span id="cb4-838"><a href="#cb4-838" aria-hidden="true" tabindex="-1"></a><span class="in">    + Math.floor(dotc / 36524)</span></span>
<span id="cb4-839"><a href="#cb4-839" aria-hidden="true" tabindex="-1"></a><span class="in">    - Math.floor(dotc / 146096)</span></span>
<span id="cb4-840"><a href="#cb4-840" aria-hidden="true" tabindex="-1"></a><span class="in">  ) / 365);</span></span>
<span id="cb4-841"><a href="#cb4-841" aria-hidden="true" tabindex="-1"></a><span class="in">  return [</span></span>
<span id="cb4-842"><a href="#cb4-842" aria-hidden="true" tabindex="-1"></a><span class="in">    yotc + cote * 400,</span></span>
<span id="cb4-843"><a href="#cb4-843" aria-hidden="true" tabindex="-1"></a><span class="in">    dotc - (yotc * 365</span></span>
<span id="cb4-844"><a href="#cb4-844" aria-hidden="true" tabindex="-1"></a><span class="in">      + Math.floor(yotc / 4)</span></span>
<span id="cb4-845"><a href="#cb4-845" aria-hidden="true" tabindex="-1"></a><span class="in">      - Math.floor(yotc / 100)</span></span>
<span id="cb4-846"><a href="#cb4-846" aria-hidden="true" tabindex="-1"></a><span class="in">  ), zone]}</span></span>
<span id="cb4-847"><a href="#cb4-847" aria-hidden="true" tabindex="-1"></a><span class="in">dz = unix2dote(unix)</span></span>
<span id="cb4-848"><a href="#cb4-848" aria-hidden="true" tabindex="-1"></a><span class="in">ydz = dote2date(...dz)</span></span>
<span id="cb4-849"><a href="#cb4-849" aria-hidden="true" tabindex="-1"></a><span class="in">decYear = ydz[0].toString().padStart(4, "0")</span></span>
<span id="cb4-850"><a href="#cb4-850" aria-hidden="true" tabindex="-1"></a><span class="in">decDate = Math.floor(ydz[1]).toString().padStart(3, "0")</span></span>
<span id="cb4-851"><a href="#cb4-851" aria-hidden="true" tabindex="-1"></a><span class="in">browserDote = unix2dote(unix)</span></span>
<span id="cb4-852"><a href="#cb4-852" aria-hidden="true" tabindex="-1"></a><span class="in">browserTime = browserDote[0] % 1 * 10</span></span>
<span id="cb4-853"><a href="#cb4-853" aria-hidden="true" tabindex="-1"></a><span class="in">browserZone = browserDote[1]</span></span>
<span id="cb4-854"><a href="#cb4-854" aria-hidden="true" tabindex="-1"></a><span class="in">browserSign = browserZone &gt; 0 ? "-" : "+"</span></span>
<span id="cb4-855"><a href="#cb4-855" aria-hidden="true" tabindex="-1"></a><span class="in">zone0time = (browserTime - browserZone + 10) % 10</span></span>
<span id="cb4-856"><a href="#cb4-856" aria-hidden="true" tabindex="-1"></a><span class="in">hours = browserTime * 2.4</span></span>
<span id="cb4-857"><a href="#cb4-857" aria-hidden="true" tabindex="-1"></a><span class="in">minutes = hours % 1 * 60</span></span>
<span id="cb4-858"><a href="#cb4-858" aria-hidden="true" tabindex="-1"></a><span class="in">seconds = minutes % 1 * 60</span></span>
<span id="cb4-859"><a href="#cb4-859" aria-hidden="true" tabindex="-1"></a><span class="in">selectedDote = unix2dote(unix, long2zone(location[0]))</span></span>
<span id="cb4-860"><a href="#cb4-860" aria-hidden="true" tabindex="-1"></a><span class="in">selectedExact = selectedDote[0] % 1</span></span>
<span id="cb4-861"><a href="#cb4-861" aria-hidden="true" tabindex="-1"></a><span class="in">selectedExactN = (1 - selectedExact) % 1</span></span>
<span id="cb4-862"><a href="#cb4-862" aria-hidden="true" tabindex="-1"></a><span class="in">selectedZone = selectedDote[1]</span></span>
<span id="cb4-863"><a href="#cb4-863" aria-hidden="true" tabindex="-1"></a><span class="in">decTime = (selectedExact * 10).toFixed(4)</span></span>
<span id="cb4-864"><a href="#cb4-864" aria-hidden="true" tabindex="-1"></a><span class="in">decTimeN = (selectedExactN * 10).toFixed(4)</span></span>
<span id="cb4-865"><a href="#cb4-865" aria-hidden="true" tabindex="-1"></a><span class="in">barDD = decTime[0]</span></span>
<span id="cb4-866"><a href="#cb4-866" aria-hidden="true" tabindex="-1"></a><span class="in">barDDN = decTimeN[0]</span></span>
<span id="cb4-867"><a href="#cb4-867" aria-hidden="true" tabindex="-1"></a><span class="in">barMils = decTime.slice(2, 4)</span></span>
<span id="cb4-868"><a href="#cb4-868" aria-hidden="true" tabindex="-1"></a><span class="in">barMilsN = decTimeN.slice(2, 4)</span></span>
<span id="cb4-869"><a href="#cb4-869" aria-hidden="true" tabindex="-1"></a><span class="in">barBeats = decTime.slice(4, 6)</span></span>
<span id="cb4-870"><a href="#cb4-870" aria-hidden="true" tabindex="-1"></a><span class="in">barBeatsN = decTimeN.slice(4, 6)</span></span>
<span id="cb4-871"><a href="#cb4-871" aria-hidden="true" tabindex="-1"></a><span class="in">function lati2turn1(degrees = -180, e = 3) {</span></span>
<span id="cb4-872"><a href="#cb4-872" aria-hidden="true" tabindex="-1"></a><span class="in">  // turns: e=0, deciturns: e=1, etc.</span></span>
<span id="cb4-873"><a href="#cb4-873" aria-hidden="true" tabindex="-1"></a><span class="in">  return (degrees %= 360) / (360 / 10**e) % 10**e;</span></span>
<span id="cb4-874"><a href="#cb4-874" aria-hidden="true" tabindex="-1"></a><span class="in">}</span></span>
<span id="cb4-875"><a href="#cb4-875" aria-hidden="true" tabindex="-1"></a><span class="in">graticule = d3.geoGraticule().stepMinor([36,36]).stepMajor([36,36])()</span></span>
<span id="cb4-876"><a href="#cb4-876" aria-hidden="true" tabindex="-1"></a><span class="in">graticule.coordinates = graticule.coordinates.map(</span></span>
<span id="cb4-877"><a href="#cb4-877" aria-hidden="true" tabindex="-1"></a><span class="in">  i =&gt; i.map(j =&gt; j.map((k, index, arr) =&gt; i.length === 3 &amp;&amp; index === 0 ? k - 18 : k))</span></span>
<span id="cb4-878"><a href="#cb4-878" aria-hidden="true" tabindex="-1"></a><span class="in">)</span></span>
<span id="cb4-879"><a href="#cb4-879" aria-hidden="true" tabindex="-1"></a><span class="in">function long2turn(degrees = -180, e = 3) {</span></span>
<span id="cb4-880"><a href="#cb4-880" aria-hidden="true" tabindex="-1"></a><span class="in">  // turns: e=0, deciturns: e=1, etc.</span></span>
<span id="cb4-881"><a href="#cb4-881" aria-hidden="true" tabindex="-1"></a><span class="in">  return (((degrees %= 360) &lt; 0 ? degrees + 360 : degrees) + 18) / (360 / 10**e) % 10**e;</span></span>
<span id="cb4-882"><a href="#cb4-882" aria-hidden="true" tabindex="-1"></a><span class="in">}</span></span>
<span id="cb4-883"><a href="#cb4-883" aria-hidden="true" tabindex="-1"></a><span class="in">// https://github.com/topojson/world-atlas</span></span>
<span id="cb4-884"><a href="#cb4-884" aria-hidden="true" tabindex="-1"></a><span class="in">world = d3.json("https://cdn.jsdelivr.net/npm/world-atlas@2/countries-110m.json")</span></span>
<span id="cb4-885"><a href="#cb4-885" aria-hidden="true" tabindex="-1"></a><span class="in">countries = topojson.feature(world, world.objects.countries)</span></span>
<span id="cb4-886"><a href="#cb4-886" aria-hidden="true" tabindex="-1"></a><span class="in">topojson = require("topojson-client@3")</span></span>
<span id="cb4-887"><a href="#cb4-887" aria-hidden="true" tabindex="-1"></a><span class="in">function long2zone(degrees = -180) {</span></span>
<span id="cb4-888"><a href="#cb4-888" aria-hidden="true" tabindex="-1"></a><span class="in">  return Math.floor(long2turn(degrees, 1));</span></span>
<span id="cb4-889"><a href="#cb4-889" aria-hidden="true" tabindex="-1"></a><span class="in">}</span></span>
<span id="cb4-890"><a href="#cb4-890" aria-hidden="true" tabindex="-1"></a><span class="in">function year2leap(year = 1970) {</span></span>
<span id="cb4-891"><a href="#cb4-891" aria-hidden="true" tabindex="-1"></a><span class="in">    return year % 4 == 0 &amp;&amp; year % 100 != 0 || year % 400 == 0;</span></span>
<span id="cb4-892"><a href="#cb4-892" aria-hidden="true" tabindex="-1"></a><span class="in">}</span></span>
<span id="cb4-893"><a href="#cb4-893" aria-hidden="true" tabindex="-1"></a><span class="in">// https://observablehq.com/@dbridges/visualizing-seasonal-daylight</span></span>
<span id="cb4-894"><a href="#cb4-894" aria-hidden="true" tabindex="-1"></a><span class="in">solarSystem = (root, width, location, date, hour) =&gt; {</span></span>
<span id="cb4-895"><a href="#cb4-895" aria-hidden="true" tabindex="-1"></a><span class="in">  const earthRadius = 0.04 * width;</span></span>
<span id="cb4-896"><a href="#cb4-896" aria-hidden="true" tabindex="-1"></a><span class="in">  const sunRadius = 0.08 * width;</span></span>
<span id="cb4-897"><a href="#cb4-897" aria-hidden="true" tabindex="-1"></a><span class="in">  const solarSystemRadius = width / 2 - 20;</span></span>
<span id="cb4-898"><a href="#cb4-898" aria-hidden="true" tabindex="-1"></a><span class="in">  const stretch = 0.3;</span></span>
<span id="cb4-899"><a href="#cb4-899" aria-hidden="true" tabindex="-1"></a><span class="in">  const solarAngle = getSolarAngle(date);</span></span>
<span id="cb4-900"><a href="#cb4-900" aria-hidden="true" tabindex="-1"></a><span class="in">  const solarAngleDeg = (solarAngle * 180) / Math.PI;</span></span>
<span id="cb4-901"><a href="#cb4-901" aria-hidden="true" tabindex="-1"></a><span class="in">  const x = solarSystemRadius * Math.sin(solarAngle);</span></span>
<span id="cb4-902"><a href="#cb4-902" aria-hidden="true" tabindex="-1"></a><span class="in">  const y = stretch * solarSystemRadius * Math.cos(solarAngle);</span></span>
<span id="cb4-903"><a href="#cb4-903" aria-hidden="true" tabindex="-1"></a><span class="in">  const spin = 180 + -location[0] + solarAngleDeg + 360 * ((hour + 12) / 24);</span></span>
<span id="cb4-904"><a href="#cb4-904" aria-hidden="true" tabindex="-1"></a><span class="in">  const earthGeo = { type: "Sphere" };</span></span>
<span id="cb4-905"><a href="#cb4-905" aria-hidden="true" tabindex="-1"></a><span class="in">  const projection = d3</span></span>
<span id="cb4-906"><a href="#cb4-906" aria-hidden="true" tabindex="-1"></a><span class="in">    .geoOrthographic()</span></span>
<span id="cb4-907"><a href="#cb4-907" aria-hidden="true" tabindex="-1"></a><span class="in">    .fitWidth(earthRadius * 2, earthGeo)</span></span>
<span id="cb4-908"><a href="#cb4-908" aria-hidden="true" tabindex="-1"></a><span class="in">    .rotate([spin, 0, 23.5])</span></span>
<span id="cb4-909"><a href="#cb4-909" aria-hidden="true" tabindex="-1"></a><span class="in">    .translate([0, 0]);</span></span>
<span id="cb4-910"><a href="#cb4-910" aria-hidden="true" tabindex="-1"></a><span class="in">  const staticProjection = d3</span></span>
<span id="cb4-911"><a href="#cb4-911" aria-hidden="true" tabindex="-1"></a><span class="in">    .geoOrthographic()</span></span>
<span id="cb4-912"><a href="#cb4-912" aria-hidden="true" tabindex="-1"></a><span class="in">    .fitWidth(earthRadius * 2, earthGeo)</span></span>
<span id="cb4-913"><a href="#cb4-913" aria-hidden="true" tabindex="-1"></a><span class="in">    .rotate([solarAngleDeg - 90, 0])</span></span>
<span id="cb4-914"><a href="#cb4-914" aria-hidden="true" tabindex="-1"></a><span class="in">    .translate([0, 0]);</span></span>
<span id="cb4-915"><a href="#cb4-915" aria-hidden="true" tabindex="-1"></a><span class="in">  const path = d3.geoPath(projection).pointRadius(1.5);</span></span>
<span id="cb4-916"><a href="#cb4-916" aria-hidden="true" tabindex="-1"></a><span class="in">  const staticPath = d3.geoPath(staticProjection);</span></span>
<span id="cb4-917"><a href="#cb4-917" aria-hidden="true" tabindex="-1"></a><span class="in">  const solarSystem = root</span></span>
<span id="cb4-918"><a href="#cb4-918" aria-hidden="true" tabindex="-1"></a><span class="in">    .append("g")</span></span>
<span id="cb4-919"><a href="#cb4-919" aria-hidden="true" tabindex="-1"></a><span class="in">    .attr("transform", `translate(${width / 2})`);</span></span>
<span id="cb4-920"><a href="#cb4-920" aria-hidden="true" tabindex="-1"></a><span class="in">  solarSystem.append("circle").attr("r", sunRadius).attr("fill", colors.sun);</span></span>
<span id="cb4-921"><a href="#cb4-921" aria-hidden="true" tabindex="-1"></a><span class="in">  /* Draw orbit */</span></span>
<span id="cb4-922"><a href="#cb4-922" aria-hidden="true" tabindex="-1"></a><span class="in">  solarSystem</span></span>
<span id="cb4-923"><a href="#cb4-923" aria-hidden="true" tabindex="-1"></a><span class="in">    .append("ellipse")</span></span>
<span id="cb4-924"><a href="#cb4-924" aria-hidden="true" tabindex="-1"></a><span class="in">    .attr("rx", solarSystemRadius)</span></span>
<span id="cb4-925"><a href="#cb4-925" aria-hidden="true" tabindex="-1"></a><span class="in">    .attr("ry", stretch * solarSystemRadius)</span></span>
<span id="cb4-926"><a href="#cb4-926" aria-hidden="true" tabindex="-1"></a><span class="in">    .attr("fill", "none")</span></span>
<span id="cb4-927"><a href="#cb4-927" aria-hidden="true" tabindex="-1"></a><span class="in">    .attr("stroke", "black");</span></span>
<span id="cb4-928"><a href="#cb4-928" aria-hidden="true" tabindex="-1"></a><span class="in">  /* Draw month ticks */</span></span>
<span id="cb4-929"><a href="#cb4-929" aria-hidden="true" tabindex="-1"></a><span class="in">  d3.range(12).map((m) =&gt; {</span></span>
<span id="cb4-930"><a href="#cb4-930" aria-hidden="true" tabindex="-1"></a><span class="in">    const d = new Date(date.getFullYear(), m, 1);</span></span>
<span id="cb4-931"><a href="#cb4-931" aria-hidden="true" tabindex="-1"></a><span class="in">    const angle = getSolarAngle(d);</span></span>
<span id="cb4-932"><a href="#cb4-932" aria-hidden="true" tabindex="-1"></a><span class="in">    solarSystem</span></span>
<span id="cb4-933"><a href="#cb4-933" aria-hidden="true" tabindex="-1"></a><span class="in">      .append("line")</span></span>
<span id="cb4-934"><a href="#cb4-934" aria-hidden="true" tabindex="-1"></a><span class="in">      .attr("x1", (solarSystemRadius + 6) * Math.sin(angle))</span></span>
<span id="cb4-935"><a href="#cb4-935" aria-hidden="true" tabindex="-1"></a><span class="in">      .attr("y1", (solarSystemRadius + 6) * stretch * Math.cos(angle))</span></span>
<span id="cb4-936"><a href="#cb4-936" aria-hidden="true" tabindex="-1"></a><span class="in">      .attr("x2", (solarSystemRadius - 6) * Math.sin(angle))</span></span>
<span id="cb4-937"><a href="#cb4-937" aria-hidden="true" tabindex="-1"></a><span class="in">      .attr("y2", (solarSystemRadius - 6) * stretch * Math.cos(angle))</span></span>
<span id="cb4-938"><a href="#cb4-938" aria-hidden="true" tabindex="-1"></a><span class="in">      .attr("stroke", "black");</span></span>
<span id="cb4-939"><a href="#cb4-939" aria-hidden="true" tabindex="-1"></a><span class="in">    const startMonthAngle = getSolarAngle(new Date(date.getFullYear(), m, 1));</span></span>
<span id="cb4-940"><a href="#cb4-940" aria-hidden="true" tabindex="-1"></a><span class="in">    solarSystem</span></span>
<span id="cb4-941"><a href="#cb4-941" aria-hidden="true" tabindex="-1"></a><span class="in">      .append("text")</span></span>
<span id="cb4-942"><a href="#cb4-942" aria-hidden="true" tabindex="-1"></a><span class="in">      .text(date2doty(d))</span></span>
<span id="cb4-943"><a href="#cb4-943" aria-hidden="true" tabindex="-1"></a><span class="in">      .attr("x", (solarSystemRadius + 18) * Math.sin(startMonthAngle))</span></span>
<span id="cb4-944"><a href="#cb4-944" aria-hidden="true" tabindex="-1"></a><span class="in">      .attr(</span></span>
<span id="cb4-945"><a href="#cb4-945" aria-hidden="true" tabindex="-1"></a><span class="in">        "y",</span></span>
<span id="cb4-946"><a href="#cb4-946" aria-hidden="true" tabindex="-1"></a><span class="in">        (solarSystemRadius + 18) * 1.18 * stretch * Math.cos(startMonthAngle)</span></span>
<span id="cb4-947"><a href="#cb4-947" aria-hidden="true" tabindex="-1"></a><span class="in">      )</span></span>
<span id="cb4-948"><a href="#cb4-948" aria-hidden="true" tabindex="-1"></a><span class="in">      .attr("text-anchor", "middle")</span></span>
<span id="cb4-949"><a href="#cb4-949" aria-hidden="true" tabindex="-1"></a><span class="in">      .attr("font-size", fontSize * (width &lt; 165 ? .9 : width &lt; 265 ? 1 : width &lt; 365 ? 1.1 : 1.2))</span></span>
<span id="cb4-950"><a href="#cb4-950" aria-hidden="true" tabindex="-1"></a><span class="in">      .attr("dominant-baseline", "middle")</span></span>
<span id="cb4-951"><a href="#cb4-951" aria-hidden="true" tabindex="-1"></a><span class="in">      .attr("font-size", fontSize * (width &lt; 165 ? .9 : width &lt; 265 ? 1 : width &lt; 365 ? 1.1 : 1.2))</span></span>
<span id="cb4-952"><a href="#cb4-952" aria-hidden="true" tabindex="-1"></a><span class="in">      .attr("font-family", "sans-serif")</span></span>
<span id="cb4-953"><a href="#cb4-953" aria-hidden="true" tabindex="-1"></a><span class="in">      .attr("fill", "black");</span></span>
<span id="cb4-954"><a href="#cb4-954" aria-hidden="true" tabindex="-1"></a><span class="in">  });</span></span>
<span id="cb4-955"><a href="#cb4-955" aria-hidden="true" tabindex="-1"></a><span class="in">  const earth = solarSystem</span></span>
<span id="cb4-956"><a href="#cb4-956" aria-hidden="true" tabindex="-1"></a><span class="in">    .append("g")</span></span>
<span id="cb4-957"><a href="#cb4-957" aria-hidden="true" tabindex="-1"></a><span class="in">    .attr("transform", `translate(${x}, ${y})`);</span></span>
<span id="cb4-958"><a href="#cb4-958" aria-hidden="true" tabindex="-1"></a><span class="in">  earth</span></span>
<span id="cb4-959"><a href="#cb4-959" aria-hidden="true" tabindex="-1"></a><span class="in">    .append("line")</span></span>
<span id="cb4-960"><a href="#cb4-960" aria-hidden="true" tabindex="-1"></a><span class="in">    .attr("y1", -1.5 * earthRadius)</span></span>
<span id="cb4-961"><a href="#cb4-961" aria-hidden="true" tabindex="-1"></a><span class="in">    .attr("y2", 1.5 * earthRadius)</span></span>
<span id="cb4-962"><a href="#cb4-962" aria-hidden="true" tabindex="-1"></a><span class="in">    .attr("stroke", "blue")</span></span>
<span id="cb4-963"><a href="#cb4-963" aria-hidden="true" tabindex="-1"></a><span class="in">    .attr("transform", `rotate(-23.5)`);</span></span>
<span id="cb4-964"><a href="#cb4-964" aria-hidden="true" tabindex="-1"></a><span class="in">  earth.append("path").attr("d", path(earthGeo)).attr("fill", colors.ocean);</span></span>
<span id="cb4-965"><a href="#cb4-965" aria-hidden="true" tabindex="-1"></a><span class="in">  earth.append("path").attr("d", path(land)).attr("fill", colors.land);</span></span>
<span id="cb4-966"><a href="#cb4-966" aria-hidden="true" tabindex="-1"></a><span class="in">  earth.append("path")</span></span>
<span id="cb4-967"><a href="#cb4-967" aria-hidden="true" tabindex="-1"></a><span class="in">  .attr("d", path(countries))</span></span>
<span id="cb4-968"><a href="#cb4-968" aria-hidden="true" tabindex="-1"></a><span class="in">  .attr("stroke-width", ".075")</span></span>
<span id="cb4-969"><a href="#cb4-969" aria-hidden="true" tabindex="-1"></a><span class="in">  .attr("fill", "none")</span></span>
<span id="cb4-970"><a href="#cb4-970" aria-hidden="true" tabindex="-1"></a><span class="in">  .attr("stroke", "#555");</span></span>
<span id="cb4-971"><a href="#cb4-971" aria-hidden="true" tabindex="-1"></a><span class="in">  const shadowPolygon = [</span></span>
<span id="cb4-972"><a href="#cb4-972" aria-hidden="true" tabindex="-1"></a><span class="in">    [0, -90],</span></span>
<span id="cb4-973"><a href="#cb4-973" aria-hidden="true" tabindex="-1"></a><span class="in">    [0, 0],</span></span>
<span id="cb4-974"><a href="#cb4-974" aria-hidden="true" tabindex="-1"></a><span class="in">    [0, 90],</span></span>
<span id="cb4-975"><a href="#cb4-975" aria-hidden="true" tabindex="-1"></a><span class="in">    [180, 0],</span></span>
<span id="cb4-976"><a href="#cb4-976" aria-hidden="true" tabindex="-1"></a><span class="in">    [0, -90]</span></span>
<span id="cb4-977"><a href="#cb4-977" aria-hidden="true" tabindex="-1"></a><span class="in">  ];</span></span>
<span id="cb4-978"><a href="#cb4-978" aria-hidden="true" tabindex="-1"></a><span class="in">  earth</span></span>
<span id="cb4-979"><a href="#cb4-979" aria-hidden="true" tabindex="-1"></a><span class="in">    .append("path")</span></span>
<span id="cb4-980"><a href="#cb4-980" aria-hidden="true" tabindex="-1"></a><span class="in">    .attr("d", staticPath({ type: "Polygon", coordinates: [shadowPolygon] }))</span></span>
<span id="cb4-981"><a href="#cb4-981" aria-hidden="true" tabindex="-1"></a><span class="in">    .attr("fill", "rgba(0, 0, 0, 0.5)");</span></span>
<span id="cb4-982"><a href="#cb4-982" aria-hidden="true" tabindex="-1"></a><span class="in">  earth</span></span>
<span id="cb4-983"><a href="#cb4-983" aria-hidden="true" tabindex="-1"></a><span class="in">    .append("path")</span></span>
<span id="cb4-984"><a href="#cb4-984" aria-hidden="true" tabindex="-1"></a><span class="in">    .attr("d", path({ type: "Point", coordinates: location }))</span></span>
<span id="cb4-985"><a href="#cb4-985" aria-hidden="true" tabindex="-1"></a><span class="in">    .attr("r", 18)</span></span>
<span id="cb4-986"><a href="#cb4-986" aria-hidden="true" tabindex="-1"></a><span class="in">    .attr("stroke-width", .3)</span></span>
<span id="cb4-987"><a href="#cb4-987" aria-hidden="true" tabindex="-1"></a><span class="in">    .attr("stroke", "black")</span></span>
<span id="cb4-988"><a href="#cb4-988" aria-hidden="true" tabindex="-1"></a><span class="in">    .attr("fill", "red");</span></span>
<span id="cb4-989"><a href="#cb4-989" aria-hidden="true" tabindex="-1"></a><span class="in">}</span></span>
<span id="cb4-990"><a href="#cb4-990" aria-hidden="true" tabindex="-1"></a><span class="in">function greg2doty(month = 1, day = 1) {</span></span>
<span id="cb4-991"><a href="#cb4-991" aria-hidden="true" tabindex="-1"></a><span class="in">    return Math.floor(</span></span>
<span id="cb4-992"><a href="#cb4-992" aria-hidden="true" tabindex="-1"></a><span class="in">        (153 * (month &gt; 2 ? month - 3 : month + 9) + 2) / 5 + day - 1</span></span>
<span id="cb4-993"><a href="#cb4-993" aria-hidden="true" tabindex="-1"></a><span class="in">)}</span></span>
<span id="cb4-994"><a href="#cb4-994" aria-hidden="true" tabindex="-1"></a><span class="in">function date2doty(date) {</span></span>
<span id="cb4-995"><a href="#cb4-995" aria-hidden="true" tabindex="-1"></a><span class="in">  return greg2doty(date.getMonth() + 1, date.getDate())</span></span>
<span id="cb4-996"><a href="#cb4-996" aria-hidden="true" tabindex="-1"></a><span class="in">}</span></span>
<span id="cb4-997"><a href="#cb4-997" aria-hidden="true" tabindex="-1"></a><span class="in">function date2doty1(date) {</span></span>
<span id="cb4-998"><a href="#cb4-998" aria-hidden="true" tabindex="-1"></a><span class="in">  const doty = greg2doty(date.getMonth() + 1, date.getDate())</span></span>
<span id="cb4-999"><a href="#cb4-999" aria-hidden="true" tabindex="-1"></a><span class="in">  return doty === 31 ? "Day " + String(doty) : doty</span></span>
<span id="cb4-1000"><a href="#cb4-1000" aria-hidden="true" tabindex="-1"></a><span class="in">}</span></span>
<span id="cb4-1001"><a href="#cb4-1001" aria-hidden="true" tabindex="-1"></a><span class="in">// https://observablehq.com/@dbridges/visualizing-seasonal-daylight</span></span>
<span id="cb4-1002"><a href="#cb4-1002" aria-hidden="true" tabindex="-1"></a><span class="in">globe = (root, { width, location, date, hour }) =&gt; {</span></span>
<span id="cb4-1003"><a href="#cb4-1003" aria-hidden="true" tabindex="-1"></a><span class="in">  const solarAngle = getSolarAngle(date);</span></span>
<span id="cb4-1004"><a href="#cb4-1004" aria-hidden="true" tabindex="-1"></a><span class="in">  const solarAngleDeg = toDegrees(solarAngle);</span></span>
<span id="cb4-1005"><a href="#cb4-1005" aria-hidden="true" tabindex="-1"></a><span class="in">  const hourSpin = 360 * ((hour + 12) / 24);</span></span>
<span id="cb4-1006"><a href="#cb4-1006" aria-hidden="true" tabindex="-1"></a><span class="in">  const spin = (180 + -location[0] + solarAngleDeg + hourSpin);</span></span>
<span id="cb4-1007"><a href="#cb4-1007" aria-hidden="true" tabindex="-1"></a><span class="in">  const tilt = -15;</span></span>
<span id="cb4-1008"><a href="#cb4-1008" aria-hidden="true" tabindex="-1"></a><span class="in">  const projection = d3.geoOrthographic()</span></span>
<span id="cb4-1009"><a href="#cb4-1009" aria-hidden="true" tabindex="-1"></a><span class="in">                       .fitWidth(width, graticule)</span></span>
<span id="cb4-1010"><a href="#cb4-1010" aria-hidden="true" tabindex="-1"></a><span class="in">                       .rotate([spin, tilt, 23.5]);</span></span>
<span id="cb4-1011"><a href="#cb4-1011" aria-hidden="true" tabindex="-1"></a><span class="in">  const path = d3.geoPath(projection);</span></span>
<span id="cb4-1012"><a href="#cb4-1012" aria-hidden="true" tabindex="-1"></a><span class="in">  const unClippedProjection = d3.geoOrthographic()</span></span>
<span id="cb4-1013"><a href="#cb4-1013" aria-hidden="true" tabindex="-1"></a><span class="in">                                .clipAngle(null)</span></span>
<span id="cb4-1014"><a href="#cb4-1014" aria-hidden="true" tabindex="-1"></a><span class="in">                                .fitWidth(width, graticule)</span></span>
<span id="cb4-1015"><a href="#cb4-1015" aria-hidden="true" tabindex="-1"></a><span class="in">                                .rotate([spin, tilt, 23.5]);</span></span>
<span id="cb4-1016"><a href="#cb4-1016" aria-hidden="true" tabindex="-1"></a><span class="in">  const unClippedPath = d3.geoPath(unClippedProjection);</span></span>
<span id="cb4-1017"><a href="#cb4-1017" aria-hidden="true" tabindex="-1"></a><span class="in">  const staticProjection = d3.geoOrthographic()</span></span>
<span id="cb4-1018"><a href="#cb4-1018" aria-hidden="true" tabindex="-1"></a><span class="in">                             .fitWidth(width, graticule)</span></span>
<span id="cb4-1019"><a href="#cb4-1019" aria-hidden="true" tabindex="-1"></a><span class="in">                             .rotate([solarAngleDeg - 90, tilt]);</span></span>
<span id="cb4-1020"><a href="#cb4-1020" aria-hidden="true" tabindex="-1"></a><span class="in">  const staticPath = d3.geoPath(staticProjection);</span></span>
<span id="cb4-1021"><a href="#cb4-1021" aria-hidden="true" tabindex="-1"></a><span class="in">  const background = root.append("g");</span></span>
<span id="cb4-1022"><a href="#cb4-1022" aria-hidden="true" tabindex="-1"></a><span class="in">  const earth = root.append("g").style("opacity", 0.75);</span></span>
<span id="cb4-1023"><a href="#cb4-1023" aria-hidden="true" tabindex="-1"></a><span class="in">  const foreground = root.append("g");</span></span>
<span id="cb4-1024"><a href="#cb4-1024" aria-hidden="true" tabindex="-1"></a><span class="in">  earth.append("path")</span></span>
<span id="cb4-1025"><a href="#cb4-1025" aria-hidden="true" tabindex="-1"></a><span class="in">    .attr("d", path({type: "Sphere"}))</span></span>
<span id="cb4-1026"><a href="#cb4-1026" aria-hidden="true" tabindex="-1"></a><span class="in">    .attr("fill", colors.ocean)</span></span>
<span id="cb4-1027"><a href="#cb4-1027" aria-hidden="true" tabindex="-1"></a><span class="in">    .attr("stroke", "#9ecbda");</span></span>
<span id="cb4-1028"><a href="#cb4-1028" aria-hidden="true" tabindex="-1"></a><span class="in">  earth.append("path")</span></span>
<span id="cb4-1029"><a href="#cb4-1029" aria-hidden="true" tabindex="-1"></a><span class="in">    .attr("d", path(graticule))</span></span>
<span id="cb4-1030"><a href="#cb4-1030" aria-hidden="true" tabindex="-1"></a><span class="in">    .attr("stroke-width", "1")</span></span>
<span id="cb4-1031"><a href="#cb4-1031" aria-hidden="true" tabindex="-1"></a><span class="in">    .attr("fill", "none")</span></span>
<span id="cb4-1032"><a href="#cb4-1032" aria-hidden="true" tabindex="-1"></a><span class="in">    .attr("stroke", "#888");</span></span>
<span id="cb4-1033"><a href="#cb4-1033" aria-hidden="true" tabindex="-1"></a><span class="in">  earth.append("path")</span></span>
<span id="cb4-1034"><a href="#cb4-1034" aria-hidden="true" tabindex="-1"></a><span class="in">    .attr("d", path(land))</span></span>
<span id="cb4-1035"><a href="#cb4-1035" aria-hidden="true" tabindex="-1"></a><span class="in">    .attr("fill", colors.land);</span></span>
<span id="cb4-1036"><a href="#cb4-1036" aria-hidden="true" tabindex="-1"></a><span class="in">  earth.append("path")</span></span>
<span id="cb4-1037"><a href="#cb4-1037" aria-hidden="true" tabindex="-1"></a><span class="in">    .attr("d", path(countries))</span></span>
<span id="cb4-1038"><a href="#cb4-1038" aria-hidden="true" tabindex="-1"></a><span class="in">    .attr("stroke-width", "1")</span></span>
<span id="cb4-1039"><a href="#cb4-1039" aria-hidden="true" tabindex="-1"></a><span class="in">    .attr("fill", "none")</span></span>
<span id="cb4-1040"><a href="#cb4-1040" aria-hidden="true" tabindex="-1"></a><span class="in">    .attr("stroke", "#000");</span></span>
<span id="cb4-1041"><a href="#cb4-1041" aria-hidden="true" tabindex="-1"></a><span class="in">  background.append("path")</span></span>
<span id="cb4-1042"><a href="#cb4-1042" aria-hidden="true" tabindex="-1"></a><span class="in">    .attr("d", unClippedPath({type: "Point", coordinates: location}))</span></span>
<span id="cb4-1043"><a href="#cb4-1043" aria-hidden="true" tabindex="-1"></a><span class="in">    .attr("fill", "red");</span></span>
<span id="cb4-1044"><a href="#cb4-1044" aria-hidden="true" tabindex="-1"></a><span class="in">  const latitudeCoords = (latitude, start, end) =&gt; {</span></span>
<span id="cb4-1045"><a href="#cb4-1045" aria-hidden="true" tabindex="-1"></a><span class="in">    const longitudes = d3.range(start, end, 2).concat(end);</span></span>
<span id="cb4-1046"><a href="#cb4-1046" aria-hidden="true" tabindex="-1"></a><span class="in">    return longitudes.map(d =&gt; [d, latitude]);</span></span>
<span id="cb4-1047"><a href="#cb4-1047" aria-hidden="true" tabindex="-1"></a><span class="in">  }</span></span>
<span id="cb4-1048"><a href="#cb4-1048" aria-hidden="true" tabindex="-1"></a><span class="in">  const correctSpin = d3.geoRotation([-hourSpin, 0]);</span></span>
<span id="cb4-1049"><a href="#cb4-1049" aria-hidden="true" tabindex="-1"></a><span class="in">  const correctTilt = d3.geoRotation([6, 0, 0]);</span></span>
<span id="cb4-1050"><a href="#cb4-1050" aria-hidden="true" tabindex="-1"></a><span class="in">  /* total angular extent of day/night */</span></span>
<span id="cb4-1051"><a href="#cb4-1051" aria-hidden="true" tabindex="-1"></a><span class="in">  const dayExtent = 360 * dayLength(date, location[1]) / 24;</span></span>
<span id="cb4-1052"><a href="#cb4-1052" aria-hidden="true" tabindex="-1"></a><span class="in">  const nightExtent = 360 - dayExtent;</span></span>
<span id="cb4-1053"><a href="#cb4-1053" aria-hidden="true" tabindex="-1"></a><span class="in">  const dayLine = {</span></span>
<span id="cb4-1054"><a href="#cb4-1054" aria-hidden="true" tabindex="-1"></a><span class="in">    type: "LineString",</span></span>
<span id="cb4-1055"><a href="#cb4-1055" aria-hidden="true" tabindex="-1"></a><span class="in">    coordinates: latitudeCoords(location[1],</span></span>
<span id="cb4-1056"><a href="#cb4-1056" aria-hidden="true" tabindex="-1"></a><span class="in">                                location[0] - dayExtent / 2,</span></span>
<span id="cb4-1057"><a href="#cb4-1057" aria-hidden="true" tabindex="-1"></a><span class="in">                                location[0] + dayExtent / 2).map(d =&gt; correctSpin(d))</span></span>
<span id="cb4-1058"><a href="#cb4-1058" aria-hidden="true" tabindex="-1"></a><span class="in">  };</span></span>
<span id="cb4-1059"><a href="#cb4-1059" aria-hidden="true" tabindex="-1"></a><span class="in">  const nightLine = {</span></span>
<span id="cb4-1060"><a href="#cb4-1060" aria-hidden="true" tabindex="-1"></a><span class="in">    type: "LineString",</span></span>
<span id="cb4-1061"><a href="#cb4-1061" aria-hidden="true" tabindex="-1"></a><span class="in">    coordinates: latitudeCoords(location[1],</span></span>
<span id="cb4-1062"><a href="#cb4-1062" aria-hidden="true" tabindex="-1"></a><span class="in">                                location[0] - dayExtent / 2 - nightExtent,</span></span>
<span id="cb4-1063"><a href="#cb4-1063" aria-hidden="true" tabindex="-1"></a><span class="in">                                location[0] - dayExtent / 2).map(d =&gt; correctSpin(d))</span></span>
<span id="cb4-1064"><a href="#cb4-1064" aria-hidden="true" tabindex="-1"></a><span class="in">  };</span></span>
<span id="cb4-1065"><a href="#cb4-1065" aria-hidden="true" tabindex="-1"></a><span class="in">  background.append("path")</span></span>
<span id="cb4-1066"><a href="#cb4-1066" aria-hidden="true" tabindex="-1"></a><span class="in">    .attr("d", unClippedPath(dayLine))</span></span>
<span id="cb4-1067"><a href="#cb4-1067" aria-hidden="true" tabindex="-1"></a><span class="in">    .attr("fill", "none")</span></span>
<span id="cb4-1068"><a href="#cb4-1068" aria-hidden="true" tabindex="-1"></a><span class="in">    .attr("stroke", colors.day)</span></span>
<span id="cb4-1069"><a href="#cb4-1069" aria-hidden="true" tabindex="-1"></a><span class="in">    .attr("stroke-width", 3);</span></span>
<span id="cb4-1070"><a href="#cb4-1070" aria-hidden="true" tabindex="-1"></a><span class="in">  background.append("path")</span></span>
<span id="cb4-1071"><a href="#cb4-1071" aria-hidden="true" tabindex="-1"></a><span class="in">    .attr("d", unClippedPath(nightLine))</span></span>
<span id="cb4-1072"><a href="#cb4-1072" aria-hidden="true" tabindex="-1"></a><span class="in">    .attr("fill", "none")</span></span>
<span id="cb4-1073"><a href="#cb4-1073" aria-hidden="true" tabindex="-1"></a><span class="in">    .attr("stroke", colors.night)</span></span>
<span id="cb4-1074"><a href="#cb4-1074" aria-hidden="true" tabindex="-1"></a><span class="in">    .attr("stroke-width", 3);</span></span>
<span id="cb4-1075"><a href="#cb4-1075" aria-hidden="true" tabindex="-1"></a><span class="in">  foreground.append("path")</span></span>
<span id="cb4-1076"><a href="#cb4-1076" aria-hidden="true" tabindex="-1"></a><span class="in">    .attr("d", path(dayLine))</span></span>
<span id="cb4-1077"><a href="#cb4-1077" aria-hidden="true" tabindex="-1"></a><span class="in">    .attr("fill", "none")</span></span>
<span id="cb4-1078"><a href="#cb4-1078" aria-hidden="true" tabindex="-1"></a><span class="in">    .attr("stroke", colors.day)</span></span>
<span id="cb4-1079"><a href="#cb4-1079" aria-hidden="true" tabindex="-1"></a><span class="in">    .attr("stroke-width", 3);</span></span>
<span id="cb4-1080"><a href="#cb4-1080" aria-hidden="true" tabindex="-1"></a><span class="in">  foreground.append("path")</span></span>
<span id="cb4-1081"><a href="#cb4-1081" aria-hidden="true" tabindex="-1"></a><span class="in">    .attr("d", path(nightLine))</span></span>
<span id="cb4-1082"><a href="#cb4-1082" aria-hidden="true" tabindex="-1"></a><span class="in">    .attr("fill", "none")</span></span>
<span id="cb4-1083"><a href="#cb4-1083" aria-hidden="true" tabindex="-1"></a><span class="in">    .attr("stroke", colors.night)</span></span>
<span id="cb4-1084"><a href="#cb4-1084" aria-hidden="true" tabindex="-1"></a><span class="in">    .attr("stroke-width", 3);</span></span>
<span id="cb4-1085"><a href="#cb4-1085" aria-hidden="true" tabindex="-1"></a><span class="in">  foreground.append("path")</span></span>
<span id="cb4-1086"><a href="#cb4-1086" aria-hidden="true" tabindex="-1"></a><span class="in">    .attr("d", path({type: "Point", coordinates: location}))</span></span>
<span id="cb4-1087"><a href="#cb4-1087" aria-hidden="true" tabindex="-1"></a><span class="in">    .attr("stroke-width", .5)</span></span>
<span id="cb4-1088"><a href="#cb4-1088" aria-hidden="true" tabindex="-1"></a><span class="in">    .attr("stroke", "black")</span></span>
<span id="cb4-1089"><a href="#cb4-1089" aria-hidden="true" tabindex="-1"></a><span class="in">    .attr("fill", "red");</span></span>
<span id="cb4-1090"><a href="#cb4-1090" aria-hidden="true" tabindex="-1"></a><span class="in">  const shadowPolygon = [[0, -90], [0, 0], [0, 90], [180, 0], [0, -90]].map(d =&gt; correctTilt(d));</span></span>
<span id="cb4-1091"><a href="#cb4-1091" aria-hidden="true" tabindex="-1"></a><span class="in">  foreground.append("path")</span></span>
<span id="cb4-1092"><a href="#cb4-1092" aria-hidden="true" tabindex="-1"></a><span class="in">    .attr("d", staticPath({type: "Polygon", coordinates: [shadowPolygon]}))</span></span>
<span id="cb4-1093"><a href="#cb4-1093" aria-hidden="true" tabindex="-1"></a><span class="in">    .attr("fill", "rgba(0, 0, 0, 0.25)");</span></span>
<span id="cb4-1094"><a href="#cb4-1094" aria-hidden="true" tabindex="-1"></a><span class="in">}</span></span>
<span id="cb4-1095"><a href="#cb4-1095" aria-hidden="true" tabindex="-1"></a><span class="in">dayOfYear = (date) =&gt; {</span></span>
<span id="cb4-1096"><a href="#cb4-1096" aria-hidden="true" tabindex="-1"></a><span class="in">  const yearStart = new Date(date.getFullYear(), 0, 1+60);</span></span>
<span id="cb4-1097"><a href="#cb4-1097" aria-hidden="true" tabindex="-1"></a><span class="in">  return Math.floor((date.getTime() - yearStart.getTime())/86400000) + 1</span></span>
<span id="cb4-1098"><a href="#cb4-1098" aria-hidden="true" tabindex="-1"></a><span class="in">}</span></span>
<span id="cb4-1099"><a href="#cb4-1099" aria-hidden="true" tabindex="-1"></a><span class="in">// https://observablehq.com/@dbridges/visualizing-seasonal-daylight</span></span>
<span id="cb4-1100"><a href="#cb4-1100" aria-hidden="true" tabindex="-1"></a><span class="in">daylightPlot = (</span></span>
<span id="cb4-1101"><a href="#cb4-1101" aria-hidden="true" tabindex="-1"></a><span class="in">  root,</span></span>
<span id="cb4-1102"><a href="#cb4-1102" aria-hidden="true" tabindex="-1"></a><span class="in">  { width, height, year, latitude, defaultDate, defaultHour }</span></span>
<span id="cb4-1103"><a href="#cb4-1103" aria-hidden="true" tabindex="-1"></a><span class="in">) =&gt; {</span></span>
<span id="cb4-1104"><a href="#cb4-1104" aria-hidden="true" tabindex="-1"></a><span class="in">  const margin = { top: 24, bottom: 32, left: 48, right: 0 };</span></span>
<span id="cb4-1105"><a href="#cb4-1105" aria-hidden="true" tabindex="-1"></a><span class="in">  const chartWidth = width - margin.left - margin.right;</span></span>
<span id="cb4-1106"><a href="#cb4-1106" aria-hidden="true" tabindex="-1"></a><span class="in">  const chartHeight = height - margin.top - margin.bottom;</span></span>
<span id="cb4-1107"><a href="#cb4-1107" aria-hidden="true" tabindex="-1"></a><span class="in">  const xTickValues =</span></span>
<span id="cb4-1108"><a href="#cb4-1108" aria-hidden="true" tabindex="-1"></a><span class="in">    width &gt; 280 ? [3, 6, 9, 12, 15, 18, 21] : width &gt; 140 ? [6, 12, 18] : [12];</span></span>
<span id="cb4-1109"><a href="#cb4-1109" aria-hidden="true" tabindex="-1"></a><span class="in">  const xScale = d3</span></span>
<span id="cb4-1110"><a href="#cb4-1110" aria-hidden="true" tabindex="-1"></a><span class="in">    .scaleLinear()</span></span>
<span id="cb4-1111"><a href="#cb4-1111" aria-hidden="true" tabindex="-1"></a><span class="in">    .domain([0, 24])</span></span>
<span id="cb4-1112"><a href="#cb4-1112" aria-hidden="true" tabindex="-1"></a><span class="in">    .range([margin.left, margin.left + chartWidth])</span></span>
<span id="cb4-1113"><a href="#cb4-1113" aria-hidden="true" tabindex="-1"></a><span class="in">    .clamp(true);</span></span>
<span id="cb4-1114"><a href="#cb4-1114" aria-hidden="true" tabindex="-1"></a><span class="in">  // y-axis scale</span></span>
<span id="cb4-1115"><a href="#cb4-1115" aria-hidden="true" tabindex="-1"></a><span class="in">  const yScale = d3</span></span>
<span id="cb4-1116"><a href="#cb4-1116" aria-hidden="true" tabindex="-1"></a><span class="in">    .scaleTime()</span></span>
<span id="cb4-1117"><a href="#cb4-1117" aria-hidden="true" tabindex="-1"></a><span class="in">    .domain([new Date(year, 0, 1+60), new Date(year, 11, 31+60)])</span></span>
<span id="cb4-1118"><a href="#cb4-1118" aria-hidden="true" tabindex="-1"></a><span class="in">    .range([margin.top, margin.top + chartHeight])</span></span>
<span id="cb4-1119"><a href="#cb4-1119" aria-hidden="true" tabindex="-1"></a><span class="in">    .clamp(true);</span></span>
<span id="cb4-1120"><a href="#cb4-1120" aria-hidden="true" tabindex="-1"></a><span class="in">  // y-axis labels</span></span>
<span id="cb4-1121"><a href="#cb4-1121" aria-hidden="true" tabindex="-1"></a><span class="in">  const yAxis = d3</span></span>
<span id="cb4-1122"><a href="#cb4-1122" aria-hidden="true" tabindex="-1"></a><span class="in">    .axisLeft(yScale)</span></span>
<span id="cb4-1123"><a href="#cb4-1123" aria-hidden="true" tabindex="-1"></a><span class="in">    .tickValues(d3.timeMonth.range(new Date(year, 0, 1+60), new Date(year, 12, 1+57)))</span></span>
<span id="cb4-1124"><a href="#cb4-1124" aria-hidden="true" tabindex="-1"></a><span class="in">    .tickSize(chartWidth)</span></span>
<span id="cb4-1125"><a href="#cb4-1125" aria-hidden="true" tabindex="-1"></a><span class="in">    .tickFormat(date2doty1);</span></span>
<span id="cb4-1126"><a href="#cb4-1126" aria-hidden="true" tabindex="-1"></a><span class="in">  const xAxis = d3</span></span>
<span id="cb4-1127"><a href="#cb4-1127" aria-hidden="true" tabindex="-1"></a><span class="in">    .axisBottom(xScale)</span></span>
<span id="cb4-1128"><a href="#cb4-1128" aria-hidden="true" tabindex="-1"></a><span class="in">    .tickValues(xTickValues)</span></span>
<span id="cb4-1129"><a href="#cb4-1129" aria-hidden="true" tabindex="-1"></a><span class="in">    .tickSize(chartHeight)</span></span>
<span id="cb4-1130"><a href="#cb4-1130" aria-hidden="true" tabindex="-1"></a><span class="in">    .tickFormat((d) =&gt; {</span></span>
<span id="cb4-1131"><a href="#cb4-1131" aria-hidden="true" tabindex="-1"></a><span class="in">      return `${d / .024}`;</span></span>
<span id="cb4-1132"><a href="#cb4-1132" aria-hidden="true" tabindex="-1"></a><span class="in">    });</span></span>
<span id="cb4-1133"><a href="#cb4-1133" aria-hidden="true" tabindex="-1"></a><span class="in">  let date = defaultDate || new Date();</span></span>
<span id="cb4-1134"><a href="#cb4-1134" aria-hidden="true" tabindex="-1"></a><span class="in">  let hour = defaultHour != null ? defaultHour : date.getHours();</span></span>
<span id="cb4-1135"><a href="#cb4-1135" aria-hidden="true" tabindex="-1"></a><span class="in">  const handleMouseMove = (e) =&gt; {};</span></span>
<span id="cb4-1136"><a href="#cb4-1136" aria-hidden="true" tabindex="-1"></a><span class="in">  root</span></span>
<span id="cb4-1137"><a href="#cb4-1137" aria-hidden="true" tabindex="-1"></a><span class="in">    .append("rect")</span></span>
<span id="cb4-1138"><a href="#cb4-1138" aria-hidden="true" tabindex="-1"></a><span class="in">    .attr("x", margin.left)</span></span>
<span id="cb4-1139"><a href="#cb4-1139" aria-hidden="true" tabindex="-1"></a><span class="in">    .attr("y", margin.top)</span></span>
<span id="cb4-1140"><a href="#cb4-1140" aria-hidden="true" tabindex="-1"></a><span class="in">    .attr("width", chartWidth)</span></span>
<span id="cb4-1141"><a href="#cb4-1141" aria-hidden="true" tabindex="-1"></a><span class="in">    .attr("height", chartHeight)</span></span>
<span id="cb4-1142"><a href="#cb4-1142" aria-hidden="true" tabindex="-1"></a><span class="in">    .attr("rx", 0.05 * width)</span></span>
<span id="cb4-1143"><a href="#cb4-1143" aria-hidden="true" tabindex="-1"></a><span class="in">    .attr("fill", colors.night);</span></span>
<span id="cb4-1144"><a href="#cb4-1144" aria-hidden="true" tabindex="-1"></a><span class="in">  root</span></span>
<span id="cb4-1145"><a href="#cb4-1145" aria-hidden="true" tabindex="-1"></a><span class="in">    .append("g")</span></span>
<span id="cb4-1146"><a href="#cb4-1146" aria-hidden="true" tabindex="-1"></a><span class="in">    .attr("transform", `translate(${margin.left + chartWidth}, 0)`)</span></span>
<span id="cb4-1147"><a href="#cb4-1147" aria-hidden="true" tabindex="-1"></a><span class="in">    .call(yAxis)</span></span>
<span id="cb4-1148"><a href="#cb4-1148" aria-hidden="true" tabindex="-1"></a><span class="in">    .call((g) =&gt; g.select(".domain").remove())</span></span>
<span id="cb4-1149"><a href="#cb4-1149" aria-hidden="true" tabindex="-1"></a><span class="in">    .call((g) =&gt; g.selectAll(".tick").attr("color", colors.grid))</span></span>
<span id="cb4-1150"><a href="#cb4-1150" aria-hidden="true" tabindex="-1"></a><span class="in">    .call((g) =&gt; g.selectAll(".tick text").attr("font-size", fontSize * (width &lt; 165 ? .7 : width &lt; 265 ? .9 : width &lt; 365 ? 1.3 : 1.4)))</span></span>
<span id="cb4-1151"><a href="#cb4-1151" aria-hidden="true" tabindex="-1"></a><span class="in">    .call((g) =&gt; g.selectAll(".tick text").attr("color", "black"))</span></span>
<span id="cb4-1152"><a href="#cb4-1152" aria-hidden="true" tabindex="-1"></a><span class="in">    .call((g) =&gt; g.selectAll(".tick line").attr("stroke-dasharray", "5 3"));</span></span>
<span id="cb4-1153"><a href="#cb4-1153" aria-hidden="true" tabindex="-1"></a><span class="in">  root</span></span>
<span id="cb4-1154"><a href="#cb4-1154" aria-hidden="true" tabindex="-1"></a><span class="in">    .append("g")</span></span>
<span id="cb4-1155"><a href="#cb4-1155" aria-hidden="true" tabindex="-1"></a><span class="in">    .attr("transform", `translate(0, ${margin.top})`)</span></span>
<span id="cb4-1156"><a href="#cb4-1156" aria-hidden="true" tabindex="-1"></a><span class="in">    .call(xAxis)</span></span>
<span id="cb4-1157"><a href="#cb4-1157" aria-hidden="true" tabindex="-1"></a><span class="in">    .call((g) =&gt; g.select(".domain").remove())</span></span>
<span id="cb4-1158"><a href="#cb4-1158" aria-hidden="true" tabindex="-1"></a><span class="in">    .call((g) =&gt; g.selectAll(".tick").attr("color", colors.grid))</span></span>
<span id="cb4-1159"><a href="#cb4-1159" aria-hidden="true" tabindex="-1"></a><span class="in">    .call((g) =&gt; g.selectAll(".tick text").attr("font-size", fontSize * (width &lt; 165 ? .9 : width &lt; 265 ? 1.1 : width &lt; 365 ? 1.2 : 1.3)))</span></span>
<span id="cb4-1160"><a href="#cb4-1160" aria-hidden="true" tabindex="-1"></a><span class="in">    .call((g) =&gt; g.selectAll(".tick text").attr("color", "black"))</span></span>
<span id="cb4-1161"><a href="#cb4-1161" aria-hidden="true" tabindex="-1"></a><span class="in">    .call((g) =&gt; g.selectAll(".tick line").attr("stroke-dasharray", "5 3"));</span></span>
<span id="cb4-1162"><a href="#cb4-1162" aria-hidden="true" tabindex="-1"></a><span class="in">  root</span></span>
<span id="cb4-1163"><a href="#cb4-1163" aria-hidden="true" tabindex="-1"></a><span class="in">    .append("text")</span></span>
<span id="cb4-1164"><a href="#cb4-1164" aria-hidden="true" tabindex="-1"></a><span class="in">    .text("Time of day (millidays)")</span></span>
<span id="cb4-1165"><a href="#cb4-1165" aria-hidden="true" tabindex="-1"></a><span class="in">    .attr("x", margin.left + chartWidth / 2)</span></span>
<span id="cb4-1166"><a href="#cb4-1166" aria-hidden="true" tabindex="-1"></a><span class="in">    .attr("y", margin.top + chartHeight + margin.bottom - (width &lt; 165 ? 9 : width &lt; 265 ? 6 : width &lt; 365 ? 2 : 0))</span></span>
<span id="cb4-1167"><a href="#cb4-1167" aria-hidden="true" tabindex="-1"></a><span class="in">    .attr("text-anchor", "middle")</span></span>
<span id="cb4-1168"><a href="#cb4-1168" aria-hidden="true" tabindex="-1"></a><span class="in">    .attr("font-size", fontSize * (width &lt; 165 ? .85 : width &lt; 265 ? 1.15 : width &lt; 365 ? 1.5 : 1.6))</span></span>
<span id="cb4-1169"><a href="#cb4-1169" aria-hidden="true" tabindex="-1"></a><span class="in">    .attr("font-family", "sans-serif")</span></span>
<span id="cb4-1170"><a href="#cb4-1170" aria-hidden="true" tabindex="-1"></a><span class="in">    .attr("fill", "black");</span></span>
<span id="cb4-1171"><a href="#cb4-1171" aria-hidden="true" tabindex="-1"></a><span class="in">  const data = yearDates(year)</span></span>
<span id="cb4-1172"><a href="#cb4-1172" aria-hidden="true" tabindex="-1"></a><span class="in">    .map((d) =&gt; [d, dayLength(d, latitude)])</span></span>
<span id="cb4-1173"><a href="#cb4-1173" aria-hidden="true" tabindex="-1"></a><span class="in">    .filter(([_, d]) =&gt; d &gt; 0);</span></span>
<span id="cb4-1174"><a href="#cb4-1174" aria-hidden="true" tabindex="-1"></a><span class="in">  /* Render separate polygons for each continuous sequence of</span></span>
<span id="cb4-1175"><a href="#cb4-1175" aria-hidden="true" tabindex="-1"></a><span class="in">   * days with more than 0 hours of day light</span></span>
<span id="cb4-1176"><a href="#cb4-1176" aria-hidden="true" tabindex="-1"></a><span class="in">   */</span></span>
<span id="cb4-1177"><a href="#cb4-1177" aria-hidden="true" tabindex="-1"></a><span class="in">  const polys = [];</span></span>
<span id="cb4-1178"><a href="#cb4-1178" aria-hidden="true" tabindex="-1"></a><span class="in">  let currentPoly = [];</span></span>
<span id="cb4-1179"><a href="#cb4-1179" aria-hidden="true" tabindex="-1"></a><span class="in">  for (let i = 0; i &lt; data.length; i++) {</span></span>
<span id="cb4-1180"><a href="#cb4-1180" aria-hidden="true" tabindex="-1"></a><span class="in">    const currentDate = data[i][0];</span></span>
<span id="cb4-1181"><a href="#cb4-1181" aria-hidden="true" tabindex="-1"></a><span class="in">    const prevDate = (data[i - 1] || [])[0];</span></span>
<span id="cb4-1182"><a href="#cb4-1182" aria-hidden="true" tabindex="-1"></a><span class="in">    if (</span></span>
<span id="cb4-1183"><a href="#cb4-1183" aria-hidden="true" tabindex="-1"></a><span class="in">      i === 0 ||</span></span>
<span id="cb4-1184"><a href="#cb4-1184" aria-hidden="true" tabindex="-1"></a><span class="in">      currentDate.getTime() - prevDate.getTime() &lt; 3600 * 24 * 1000 * 1.5</span></span>
<span id="cb4-1185"><a href="#cb4-1185" aria-hidden="true" tabindex="-1"></a><span class="in">    ) {</span></span>
<span id="cb4-1186"><a href="#cb4-1186" aria-hidden="true" tabindex="-1"></a><span class="in">      currentPoly.push(data[i]);</span></span>
<span id="cb4-1187"><a href="#cb4-1187" aria-hidden="true" tabindex="-1"></a><span class="in">    } else {</span></span>
<span id="cb4-1188"><a href="#cb4-1188" aria-hidden="true" tabindex="-1"></a><span class="in">      polys.push(currentPoly);</span></span>
<span id="cb4-1189"><a href="#cb4-1189" aria-hidden="true" tabindex="-1"></a><span class="in">      currentPoly = [data[i]];</span></span>
<span id="cb4-1190"><a href="#cb4-1190" aria-hidden="true" tabindex="-1"></a><span class="in">    }</span></span>
<span id="cb4-1191"><a href="#cb4-1191" aria-hidden="true" tabindex="-1"></a><span class="in">  }</span></span>
<span id="cb4-1192"><a href="#cb4-1192" aria-hidden="true" tabindex="-1"></a><span class="in">  polys.push(currentPoly);</span></span>
<span id="cb4-1193"><a href="#cb4-1193" aria-hidden="true" tabindex="-1"></a><span class="in">  polys.forEach((p) =&gt; {</span></span>
<span id="cb4-1194"><a href="#cb4-1194" aria-hidden="true" tabindex="-1"></a><span class="in">    const points = [</span></span>
<span id="cb4-1195"><a href="#cb4-1195" aria-hidden="true" tabindex="-1"></a><span class="in">      ...p.map(([d, l]) =&gt; `${xScale(12 - l / 2)},${yScale(d)}`),</span></span>
<span id="cb4-1196"><a href="#cb4-1196" aria-hidden="true" tabindex="-1"></a><span class="in">      ...p.reverse().map(([d, l]) =&gt; `${xScale(12 + l / 2)},${yScale(d)}`)</span></span>
<span id="cb4-1197"><a href="#cb4-1197" aria-hidden="true" tabindex="-1"></a><span class="in">    ].join(" ");</span></span>
<span id="cb4-1198"><a href="#cb4-1198" aria-hidden="true" tabindex="-1"></a><span class="in">    root.append("polygon").attr("points", points).attr("fill", colors.day);</span></span>
<span id="cb4-1199"><a href="#cb4-1199" aria-hidden="true" tabindex="-1"></a><span class="in">  });</span></span>
<span id="cb4-1200"><a href="#cb4-1200" aria-hidden="true" tabindex="-1"></a><span class="in">  /* Legend */</span></span>
<span id="cb4-1201"><a href="#cb4-1201" aria-hidden="true" tabindex="-1"></a><span class="in">  const legend = root</span></span>
<span id="cb4-1202"><a href="#cb4-1202" aria-hidden="true" tabindex="-1"></a><span class="in">    .append("g")</span></span>
<span id="cb4-1203"><a href="#cb4-1203" aria-hidden="true" tabindex="-1"></a><span class="in">    .attr("transform", `translate(${margin.left + chartWidth / 2 - 64})`);</span></span>
<span id="cb4-1204"><a href="#cb4-1204" aria-hidden="true" tabindex="-1"></a><span class="in">  legend</span></span>
<span id="cb4-1205"><a href="#cb4-1205" aria-hidden="true" tabindex="-1"></a><span class="in">    .append("rect")</span></span>
<span id="cb4-1206"><a href="#cb4-1206" aria-hidden="true" tabindex="-1"></a><span class="in">    .attr("rx", 5)</span></span>
<span id="cb4-1207"><a href="#cb4-1207" aria-hidden="true" tabindex="-1"></a><span class="in">    .attr("x", -34 + 4 * (width &lt; 165 ? 12.7 : width &lt; 265 ? 5.5 : width &lt; 365 ? 3 : 0))</span></span>
<span id="cb4-1208"><a href="#cb4-1208" aria-hidden="true" tabindex="-1"></a><span class="in">    .attr("y", 4.5 * (width &lt; 165 ? 1.9 : width &lt; 265 ? 1.4 : width &lt; 365 ? .9 : .8))</span></span>
<span id="cb4-1209"><a href="#cb4-1209" aria-hidden="true" tabindex="-1"></a><span class="in">    .attr("width", fontSize * (width &lt; 165 ? 1 : width &lt; 265 ? 1.2 : width &lt; 365 ? 1.4 : 1.6))</span></span>
<span id="cb4-1210"><a href="#cb4-1210" aria-hidden="true" tabindex="-1"></a><span class="in">    .attr("height", fontSize * (width &lt; 165 ? 1 : width &lt; 265 ? 1.2 : width &lt; 365 ? 1.4 : 1.6))</span></span>
<span id="cb4-1211"><a href="#cb4-1211" aria-hidden="true" tabindex="-1"></a><span class="in">    .attr("fill", colors.night);</span></span>
<span id="cb4-1212"><a href="#cb4-1212" aria-hidden="true" tabindex="-1"></a><span class="in">  legend</span></span>
<span id="cb4-1213"><a href="#cb4-1213" aria-hidden="true" tabindex="-1"></a><span class="in">    .append("text")</span></span>
<span id="cb4-1214"><a href="#cb4-1214" aria-hidden="true" tabindex="-1"></a><span class="in">    .attr("x", -16 + 4 * (width &lt; 165 ? 11.8 : width &lt; 265 ? 4.9 : width &lt; 365 ? 2.8 : 0))</span></span>
<span id="cb4-1215"><a href="#cb4-1215" aria-hidden="true" tabindex="-1"></a><span class="in">    .attr("y", 19)</span></span>
<span id="cb4-1216"><a href="#cb4-1216" aria-hidden="true" tabindex="-1"></a><span class="in">    .attr("font-size", fontSize * (width &lt; 165 ? 1 : width &lt; 265 ? 1.2 : width &lt; 365 ? 1.4 : 1.6))</span></span>
<span id="cb4-1217"><a href="#cb4-1217" aria-hidden="true" tabindex="-1"></a><span class="in">    .attr("font-family", "sans-serif")</span></span>
<span id="cb4-1218"><a href="#cb4-1218" aria-hidden="true" tabindex="-1"></a><span class="in">    .text("Night");</span></span>
<span id="cb4-1219"><a href="#cb4-1219" aria-hidden="true" tabindex="-1"></a><span class="in">  legend</span></span>
<span id="cb4-1220"><a href="#cb4-1220" aria-hidden="true" tabindex="-1"></a><span class="in">    .append("rect")</span></span>
<span id="cb4-1221"><a href="#cb4-1221" aria-hidden="true" tabindex="-1"></a><span class="in">    .attr("x", 34 + 4 * (width &lt; 165 ? 7.8 : width &lt; 265 ? 8.2 : width &lt; 365 ? 6.9 : 4.2))</span></span>
<span id="cb4-1222"><a href="#cb4-1222" aria-hidden="true" tabindex="-1"></a><span class="in">    .attr("rx", 5)</span></span>
<span id="cb4-1223"><a href="#cb4-1223" aria-hidden="true" tabindex="-1"></a><span class="in">    .attr("y", 4.5 * (width &lt; 165 ? 1.9 : width &lt; 265 ? 1.4 : width &lt; 365 ? .9 : .8))</span></span>
<span id="cb4-1224"><a href="#cb4-1224" aria-hidden="true" tabindex="-1"></a><span class="in">    .attr("width", fontSize * (width &lt; 165 ? 1 : width &lt; 265 ? 1.2 : width &lt; 365 ? 1.4 : 1.6))</span></span>
<span id="cb4-1225"><a href="#cb4-1225" aria-hidden="true" tabindex="-1"></a><span class="in">    .attr("height", fontSize * (width &lt; 165 ? 1 : width &lt; 265 ? 1.2 : width &lt; 365 ? 1.4 : 1.6))</span></span>
<span id="cb4-1226"><a href="#cb4-1226" aria-hidden="true" tabindex="-1"></a><span class="in">    .attr("fill", colors.day);</span></span>
<span id="cb4-1227"><a href="#cb4-1227" aria-hidden="true" tabindex="-1"></a><span class="in">  legend</span></span>
<span id="cb4-1228"><a href="#cb4-1228" aria-hidden="true" tabindex="-1"></a><span class="in">    .append("text")</span></span>
<span id="cb4-1229"><a href="#cb4-1229" aria-hidden="true" tabindex="-1"></a><span class="in">    .attr("x", 52 + 4 * (width &lt; 165 ? 6.8 : width &lt; 265 ? 7.8 : width &lt; 365 ? 6.9 : 4.2))</span></span>
<span id="cb4-1230"><a href="#cb4-1230" aria-hidden="true" tabindex="-1"></a><span class="in">    .attr("y", 19)</span></span>
<span id="cb4-1231"><a href="#cb4-1231" aria-hidden="true" tabindex="-1"></a><span class="in">    .attr("font-size", fontSize * (width &lt; 165 ? 1 : width &lt; 265 ? 1.2 : width &lt; 365 ? 1.4 : 1.6))</span></span>
<span id="cb4-1232"><a href="#cb4-1232" aria-hidden="true" tabindex="-1"></a><span class="in">    .attr("font-family", "sans-serif")</span></span>
<span id="cb4-1233"><a href="#cb4-1233" aria-hidden="true" tabindex="-1"></a><span class="in">    .text("Day");</span></span>
<span id="cb4-1234"><a href="#cb4-1234" aria-hidden="true" tabindex="-1"></a><span class="in">  /* Time and date controls */</span></span>
<span id="cb4-1235"><a href="#cb4-1235" aria-hidden="true" tabindex="-1"></a><span class="in">  const dateLine = root.append("g");</span></span>
<span id="cb4-1236"><a href="#cb4-1236" aria-hidden="true" tabindex="-1"></a><span class="in">  const updateControlPositions = () =&gt; {</span></span>
<span id="cb4-1237"><a href="#cb4-1237" aria-hidden="true" tabindex="-1"></a><span class="in">    dateLine</span></span>
<span id="cb4-1238"><a href="#cb4-1238" aria-hidden="true" tabindex="-1"></a><span class="in">      .select("line")</span></span>
<span id="cb4-1239"><a href="#cb4-1239" aria-hidden="true" tabindex="-1"></a><span class="in">      .attr("id", "dateline")</span></span>
<span id="cb4-1240"><a href="#cb4-1240" aria-hidden="true" tabindex="-1"></a><span class="in">      .attr("x1", xScale(0))</span></span>
<span id="cb4-1241"><a href="#cb4-1241" aria-hidden="true" tabindex="-1"></a><span class="in">      .attr("y1", yScale(date))</span></span>
<span id="cb4-1242"><a href="#cb4-1242" aria-hidden="true" tabindex="-1"></a><span class="in">      .attr("x2", xScale(24))</span></span>
<span id="cb4-1243"><a href="#cb4-1243" aria-hidden="true" tabindex="-1"></a><span class="in">      .attr("y2", yScale(date));</span></span>
<span id="cb4-1244"><a href="#cb4-1244" aria-hidden="true" tabindex="-1"></a><span class="in">    dateLine</span></span>
<span id="cb4-1245"><a href="#cb4-1245" aria-hidden="true" tabindex="-1"></a><span class="in">      .select("rect")</span></span>
<span id="cb4-1246"><a href="#cb4-1246" aria-hidden="true" tabindex="-1"></a><span class="in">      .attr("id", "daterect")</span></span>
<span id="cb4-1247"><a href="#cb4-1247" aria-hidden="true" tabindex="-1"></a><span class="in">      .attr("x", xScale(0))</span></span>
<span id="cb4-1248"><a href="#cb4-1248" aria-hidden="true" tabindex="-1"></a><span class="in">      .attr("y", yScale(date) - 4);</span></span>
<span id="cb4-1249"><a href="#cb4-1249" aria-hidden="true" tabindex="-1"></a><span class="in">    root</span></span>
<span id="cb4-1250"><a href="#cb4-1250" aria-hidden="true" tabindex="-1"></a><span class="in">      .select("#time-control")</span></span>
<span id="cb4-1251"><a href="#cb4-1251" aria-hidden="true" tabindex="-1"></a><span class="in">      .attr("cx", xScale(hour))</span></span>
<span id="cb4-1252"><a href="#cb4-1252" aria-hidden="true" tabindex="-1"></a><span class="in">      .attr("cy", yScale(date));</span></span>
<span id="cb4-1253"><a href="#cb4-1253" aria-hidden="true" tabindex="-1"></a><span class="in">  };</span></span>
<span id="cb4-1254"><a href="#cb4-1254" aria-hidden="true" tabindex="-1"></a><span class="in">  const dispatchDateHourChange = () =&gt; {</span></span>
<span id="cb4-1255"><a href="#cb4-1255" aria-hidden="true" tabindex="-1"></a><span class="in">    const detail = { date, hour };</span></span>
<span id="cb4-1256"><a href="#cb4-1256" aria-hidden="true" tabindex="-1"></a><span class="in">    const changeEvent = new CustomEvent(EventType.DateHourChange, {</span></span>
<span id="cb4-1257"><a href="#cb4-1257" aria-hidden="true" tabindex="-1"></a><span class="in">      detail,</span></span>
<span id="cb4-1258"><a href="#cb4-1258" aria-hidden="true" tabindex="-1"></a><span class="in">      bubbles: true</span></span>
<span id="cb4-1259"><a href="#cb4-1259" aria-hidden="true" tabindex="-1"></a><span class="in">    });</span></span>
<span id="cb4-1260"><a href="#cb4-1260" aria-hidden="true" tabindex="-1"></a><span class="in">    root.node().dispatchEvent(changeEvent);</span></span>
<span id="cb4-1261"><a href="#cb4-1261" aria-hidden="true" tabindex="-1"></a><span class="in">  };</span></span>
<span id="cb4-1262"><a href="#cb4-1262" aria-hidden="true" tabindex="-1"></a><span class="in">  const handleDateLineDrag = ({ y }) =&gt; {</span></span>
<span id="cb4-1263"><a href="#cb4-1263" aria-hidden="true" tabindex="-1"></a><span class="in">    date = yScale.invert(y);</span></span>
<span id="cb4-1264"><a href="#cb4-1264" aria-hidden="true" tabindex="-1"></a><span class="in">    updateControlPositions();</span></span>
<span id="cb4-1265"><a href="#cb4-1265" aria-hidden="true" tabindex="-1"></a><span class="in">    dispatchDateHourChange();</span></span>
<span id="cb4-1266"><a href="#cb4-1266" aria-hidden="true" tabindex="-1"></a><span class="in">  };</span></span>
<span id="cb4-1267"><a href="#cb4-1267" aria-hidden="true" tabindex="-1"></a><span class="in">  const handleTimeCircleDrag = ({ x }) =&gt; {</span></span>
<span id="cb4-1268"><a href="#cb4-1268" aria-hidden="true" tabindex="-1"></a><span class="in">    hour = xScale.invert(x);</span></span>
<span id="cb4-1269"><a href="#cb4-1269" aria-hidden="true" tabindex="-1"></a><span class="in">    updateControlPositions();</span></span>
<span id="cb4-1270"><a href="#cb4-1270" aria-hidden="true" tabindex="-1"></a><span class="in">    dispatchDateHourChange();</span></span>
<span id="cb4-1271"><a href="#cb4-1271" aria-hidden="true" tabindex="-1"></a><span class="in">  };</span></span>
<span id="cb4-1272"><a href="#cb4-1272" aria-hidden="true" tabindex="-1"></a><span class="in">  dateLine.append("line").attr("stroke-width", 4).attr("stroke", "red");</span></span>
<span id="cb4-1273"><a href="#cb4-1273" aria-hidden="true" tabindex="-1"></a><span class="in">  dateLine</span></span>
<span id="cb4-1274"><a href="#cb4-1274" aria-hidden="true" tabindex="-1"></a><span class="in">    .append("rect")</span></span>
<span id="cb4-1275"><a href="#cb4-1275" aria-hidden="true" tabindex="-1"></a><span class="in">    .attr("width", chartWidth)</span></span>
<span id="cb4-1276"><a href="#cb4-1276" aria-hidden="true" tabindex="-1"></a><span class="in">    .attr("height", 8)</span></span>
<span id="cb4-1277"><a href="#cb4-1277" aria-hidden="true" tabindex="-1"></a><span class="in">    .attr("fill", "rgba(0, 0, 0, 0)")</span></span>
<span id="cb4-1278"><a href="#cb4-1278" aria-hidden="true" tabindex="-1"></a><span class="in">    .style("cursor", "row-resize")</span></span>
<span id="cb4-1279"><a href="#cb4-1279" aria-hidden="true" tabindex="-1"></a><span class="in">    .call(d3.drag().on("drag", handleDateLineDrag));</span></span>
<span id="cb4-1280"><a href="#cb4-1280" aria-hidden="true" tabindex="-1"></a><span class="in">  root</span></span>
<span id="cb4-1281"><a href="#cb4-1281" aria-hidden="true" tabindex="-1"></a><span class="in">    .append("circle")</span></span>
<span id="cb4-1282"><a href="#cb4-1282" aria-hidden="true" tabindex="-1"></a><span class="in">    .attr("id", "time-control")</span></span>
<span id="cb4-1283"><a href="#cb4-1283" aria-hidden="true" tabindex="-1"></a><span class="in">    .attr("r", 12)</span></span>
<span id="cb4-1284"><a href="#cb4-1284" aria-hidden="true" tabindex="-1"></a><span class="in">    .attr("fill", "red")</span></span>
<span id="cb4-1285"><a href="#cb4-1285" aria-hidden="true" tabindex="-1"></a><span class="in">    .attr("stroke-width", .6)</span></span>
<span id="cb4-1286"><a href="#cb4-1286" aria-hidden="true" tabindex="-1"></a><span class="in">    .attr("stroke", "black")</span></span>
<span id="cb4-1287"><a href="#cb4-1287" aria-hidden="true" tabindex="-1"></a><span class="in">    .style("cursor", "pointer")</span></span>
<span id="cb4-1288"><a href="#cb4-1288" aria-hidden="true" tabindex="-1"></a><span class="in">    .call(d3.drag().on("drag", handleTimeCircleDrag));</span></span>
<span id="cb4-1289"><a href="#cb4-1289" aria-hidden="true" tabindex="-1"></a><span class="in">  updateControlPositions();</span></span>
<span id="cb4-1290"><a href="#cb4-1290" aria-hidden="true" tabindex="-1"></a><span class="in">}</span></span>
<span id="cb4-1291"><a href="#cb4-1291" aria-hidden="true" tabindex="-1"></a><span class="in">fontSize = 12;</span></span>
<span id="cb4-1292"><a href="#cb4-1292" aria-hidden="true" tabindex="-1"></a><span class="in">getSolarAngle = (date) =&gt; (dayOfYear(date) + 10) / 365 * Math.PI * 2 - Math.PI / 2;</span></span>
<span id="cb4-1293"><a href="#cb4-1293" aria-hidden="true" tabindex="-1"></a><span class="in">/*</span></span>
<span id="cb4-1294"><a href="#cb4-1294" aria-hidden="true" tabindex="-1"></a><span class="in"> * Formulas uses the CBM model as reviewed here:</span></span>
<span id="cb4-1295"><a href="#cb4-1295" aria-hidden="true" tabindex="-1"></a><span class="in"> * https://www.ikhebeenvraag.be/mediastorage/FSDocument/171/Forsythe+-+A+model+comparison+for+daylength+as+a+function+of+latitude+and+day+of+year+-+1995.pdf</span></span>
<span id="cb4-1296"><a href="#cb4-1296" aria-hidden="true" tabindex="-1"></a><span class="in"> */</span></span>
<span id="cb4-1297"><a href="#cb4-1297" aria-hidden="true" tabindex="-1"></a><span class="in">dayLength = (date, latitude) =&gt; {</span></span>
<span id="cb4-1298"><a href="#cb4-1298" aria-hidden="true" tabindex="-1"></a><span class="in">  const yearStart = new Date(date.getFullYear(), 0, 1);</span></span>
<span id="cb4-1299"><a href="#cb4-1299" aria-hidden="true" tabindex="-1"></a><span class="in">  const dayOfYear = Math.floor((date.getTime() - yearStart.getTime())/86400000) + 1;</span></span>
<span id="cb4-1300"><a href="#cb4-1300" aria-hidden="true" tabindex="-1"></a><span class="in">  const revAngle = 0.2163108 + 2 * Math.atan(0.9671396 * Math.tan(0.00860 * (dayOfYear - 186)));</span></span>
<span id="cb4-1301"><a href="#cb4-1301" aria-hidden="true" tabindex="-1"></a><span class="in">  const decAngle = Math.asin(0.39795 * Math.cos(revAngle));</span></span>
<span id="cb4-1302"><a href="#cb4-1302" aria-hidden="true" tabindex="-1"></a><span class="in">  /* daylight coefficient selected for apparent sunrise/sunset */</span></span>
<span id="cb4-1303"><a href="#cb4-1303" aria-hidden="true" tabindex="-1"></a><span class="in">  const p = 0.8333</span></span>
<span id="cb4-1304"><a href="#cb4-1304" aria-hidden="true" tabindex="-1"></a><span class="in">  const intResult =</span></span>
<span id="cb4-1305"><a href="#cb4-1305" aria-hidden="true" tabindex="-1"></a><span class="in">    (Math.sin((p * Math.PI) / 180) +</span></span>
<span id="cb4-1306"><a href="#cb4-1306" aria-hidden="true" tabindex="-1"></a><span class="in">      Math.sin((latitude * Math.PI) / 180) * Math.sin(decAngle)) /</span></span>
<span id="cb4-1307"><a href="#cb4-1307" aria-hidden="true" tabindex="-1"></a><span class="in">    (Math.cos((latitude * Math.PI) / 180) * Math.cos(decAngle));</span></span>
<span id="cb4-1308"><a href="#cb4-1308" aria-hidden="true" tabindex="-1"></a><span class="in">  if (intResult &gt;= 1) return 24;</span></span>
<span id="cb4-1309"><a href="#cb4-1309" aria-hidden="true" tabindex="-1"></a><span class="in">  if (intResult &lt;= -1) return 0;</span></span>
<span id="cb4-1310"><a href="#cb4-1310" aria-hidden="true" tabindex="-1"></a><span class="in">  return 24 - 24 * Math.acos(intResult) / Math.PI;</span></span>
<span id="cb4-1311"><a href="#cb4-1311" aria-hidden="true" tabindex="-1"></a><span class="in">}</span></span>
<span id="cb4-1312"><a href="#cb4-1312" aria-hidden="true" tabindex="-1"></a><span class="in">yearDates = (year) =&gt; {</span></span>
<span id="cb4-1313"><a href="#cb4-1313" aria-hidden="true" tabindex="-1"></a><span class="in">  const startDate = new Date(year, 0, 1+60);</span></span>
<span id="cb4-1314"><a href="#cb4-1314" aria-hidden="true" tabindex="-1"></a><span class="in">  const endDate = new Date(year + 1, 0, 1+60);</span></span>
<span id="cb4-1315"><a href="#cb4-1315" aria-hidden="true" tabindex="-1"></a><span class="in">  return d3.timeDay.range(startDate, endDate);</span></span>
<span id="cb4-1316"><a href="#cb4-1316" aria-hidden="true" tabindex="-1"></a><span class="in">}</span></span>
<span id="cb4-1317"><a href="#cb4-1317" aria-hidden="true" tabindex="-1"></a><span class="in">height = 0.65 * width;</span></span>
<span id="cb4-1318"><a href="#cb4-1318" aria-hidden="true" tabindex="-1"></a><span class="in">EventType = ({</span></span>
<span id="cb4-1319"><a href="#cb4-1319" aria-hidden="true" tabindex="-1"></a><span class="in">  LocationChange: "LOCATION_CHANGE",</span></span>
<span id="cb4-1320"><a href="#cb4-1320" aria-hidden="true" tabindex="-1"></a><span class="in">  DateHourChange: "DATE_HOUR_CHANGE"</span></span>
<span id="cb4-1321"><a href="#cb4-1321" aria-hidden="true" tabindex="-1"></a><span class="in">})</span></span>
<span id="cb4-1322"><a href="#cb4-1322" aria-hidden="true" tabindex="-1"></a><span class="in">colors = ({</span></span>
<span id="cb4-1323"><a href="#cb4-1323" aria-hidden="true" tabindex="-1"></a><span class="in">  night: "#719fb6",</span></span>
<span id="cb4-1324"><a href="#cb4-1324" aria-hidden="true" tabindex="-1"></a><span class="in">  day: "#ffe438",</span></span>
<span id="cb4-1325"><a href="#cb4-1325" aria-hidden="true" tabindex="-1"></a><span class="in">  grid: "#4b6a79",</span></span>
<span id="cb4-1326"><a href="#cb4-1326" aria-hidden="true" tabindex="-1"></a><span class="in">  ocean: "#adeeff",</span></span>
<span id="cb4-1327"><a href="#cb4-1327" aria-hidden="true" tabindex="-1"></a><span class="in">  land: "#f5f1dc",</span></span>
<span id="cb4-1328"><a href="#cb4-1328" aria-hidden="true" tabindex="-1"></a><span class="in">  sun: "#ffe438"</span></span>
<span id="cb4-1329"><a href="#cb4-1329" aria-hidden="true" tabindex="-1"></a><span class="in">})</span></span>
<span id="cb4-1330"><a href="#cb4-1330" aria-hidden="true" tabindex="-1"></a><span class="in">toRadians = (val) =&gt; val * Math.PI / 180</span></span>
<span id="cb4-1331"><a href="#cb4-1331" aria-hidden="true" tabindex="-1"></a><span class="in">toDegrees = (val) =&gt; val * 180 / Math.PI;</span></span>
<span id="cb4-1332"><a href="#cb4-1332" aria-hidden="true" tabindex="-1"></a><span class="in">land = topojson.feature(world, world.objects.land);</span></span>
<span id="cb4-1333"><a href="#cb4-1333" aria-hidden="true" tabindex="-1"></a><span class="in">d3 = require("d3@7", "d3-geo-projection@3")</span></span>
<span id="cb4-1334"><a href="#cb4-1334" aria-hidden="true" tabindex="-1"></a><span class="in">function input(config) {</span></span>
<span id="cb4-1335"><a href="#cb4-1335" aria-hidden="true" tabindex="-1"></a><span class="in">  let {</span></span>
<span id="cb4-1336"><a href="#cb4-1336" aria-hidden="true" tabindex="-1"></a><span class="in">    form,</span></span>
<span id="cb4-1337"><a href="#cb4-1337" aria-hidden="true" tabindex="-1"></a><span class="in">    type = "text",</span></span>
<span id="cb4-1338"><a href="#cb4-1338" aria-hidden="true" tabindex="-1"></a><span class="in">    attributes = {},</span></span>
<span id="cb4-1339"><a href="#cb4-1339" aria-hidden="true" tabindex="-1"></a><span class="in">    action,</span></span>
<span id="cb4-1340"><a href="#cb4-1340" aria-hidden="true" tabindex="-1"></a><span class="in">    getValue,</span></span>
<span id="cb4-1341"><a href="#cb4-1341" aria-hidden="true" tabindex="-1"></a><span class="in">    title,</span></span>
<span id="cb4-1342"><a href="#cb4-1342" aria-hidden="true" tabindex="-1"></a><span class="in">    description,</span></span>
<span id="cb4-1343"><a href="#cb4-1343" aria-hidden="true" tabindex="-1"></a><span class="in">    format,</span></span>
<span id="cb4-1344"><a href="#cb4-1344" aria-hidden="true" tabindex="-1"></a><span class="in">    display,</span></span>
<span id="cb4-1345"><a href="#cb4-1345" aria-hidden="true" tabindex="-1"></a><span class="in">    submit,</span></span>
<span id="cb4-1346"><a href="#cb4-1346" aria-hidden="true" tabindex="-1"></a><span class="in">    options</span></span>
<span id="cb4-1347"><a href="#cb4-1347" aria-hidden="true" tabindex="-1"></a><span class="in">  } = config;</span></span>
<span id="cb4-1348"><a href="#cb4-1348" aria-hidden="true" tabindex="-1"></a><span class="in">  const wrapper = html`&lt;div&gt;&lt;/div&gt;`;</span></span>
<span id="cb4-1349"><a href="#cb4-1349" aria-hidden="true" tabindex="-1"></a><span class="in">  if (!form)</span></span>
<span id="cb4-1350"><a href="#cb4-1350" aria-hidden="true" tabindex="-1"></a><span class="in">    form = html`&lt;form&gt;</span></span>
<span id="cb4-1351"><a href="#cb4-1351" aria-hidden="true" tabindex="-1"></a><span class="in">    &lt;input name=input type=${type} /&gt;</span></span>
<span id="cb4-1352"><a href="#cb4-1352" aria-hidden="true" tabindex="-1"></a><span class="in">  &lt;/form&gt;`;</span></span>
<span id="cb4-1353"><a href="#cb4-1353" aria-hidden="true" tabindex="-1"></a><span class="in">  Object.keys(attributes).forEach(key =&gt; {</span></span>
<span id="cb4-1354"><a href="#cb4-1354" aria-hidden="true" tabindex="-1"></a><span class="in">    const val = attributes[key];</span></span>
<span id="cb4-1355"><a href="#cb4-1355" aria-hidden="true" tabindex="-1"></a><span class="in">    if (val != null) form.input.setAttribute(key, val);</span></span>
<span id="cb4-1356"><a href="#cb4-1356" aria-hidden="true" tabindex="-1"></a><span class="in">  });</span></span>
<span id="cb4-1357"><a href="#cb4-1357" aria-hidden="true" tabindex="-1"></a><span class="in">  if (submit)</span></span>
<span id="cb4-1358"><a href="#cb4-1358" aria-hidden="true" tabindex="-1"></a><span class="in">    form.append(</span></span>
<span id="cb4-1359"><a href="#cb4-1359" aria-hidden="true" tabindex="-1"></a><span class="in">      html`&lt;input name=submit type=submit style="margin: 0 0.75em" value="${</span></span>
<span id="cb4-1360"><a href="#cb4-1360" aria-hidden="true" tabindex="-1"></a><span class="in">        typeof submit == "string" ? submit : "Submit"</span></span>
<span id="cb4-1361"><a href="#cb4-1361" aria-hidden="true" tabindex="-1"></a><span class="in">      }" /&gt;`</span></span>
<span id="cb4-1362"><a href="#cb4-1362" aria-hidden="true" tabindex="-1"></a><span class="in">    );</span></span>
<span id="cb4-1363"><a href="#cb4-1363" aria-hidden="true" tabindex="-1"></a><span class="in">  form.append(</span></span>
<span id="cb4-1364"><a href="#cb4-1364" aria-hidden="true" tabindex="-1"></a><span class="in">    html`&lt;output name=output style="font: 14px Menlo, Consolas, monospace; margin-left: 0.1em; text-align:center;"&gt;&lt;/output&gt;`</span></span>
<span id="cb4-1365"><a href="#cb4-1365" aria-hidden="true" tabindex="-1"></a><span class="in">  );</span></span>
<span id="cb4-1366"><a href="#cb4-1366" aria-hidden="true" tabindex="-1"></a><span class="in">  if (title)</span></span>
<span id="cb4-1367"><a href="#cb4-1367" aria-hidden="true" tabindex="-1"></a><span class="in">    form.prepend(</span></span>
<span id="cb4-1368"><a href="#cb4-1368" aria-hidden="true" tabindex="-1"></a><span class="in">      html`&lt;div style="font: 700 0.9rem sans-serif; margin-bottom: 3px;"&gt;${title}&lt;/div&gt;`</span></span>
<span id="cb4-1369"><a href="#cb4-1369" aria-hidden="true" tabindex="-1"></a><span class="in">    );</span></span>
<span id="cb4-1370"><a href="#cb4-1370" aria-hidden="true" tabindex="-1"></a><span class="in">  if (description)</span></span>
<span id="cb4-1371"><a href="#cb4-1371" aria-hidden="true" tabindex="-1"></a><span class="in">    form.append(</span></span>
<span id="cb4-1372"><a href="#cb4-1372" aria-hidden="true" tabindex="-1"></a><span class="in">      html`&lt;div style="font-size: 0.85rem; font-style: italic; margin-top: 3px;"&gt;${description}&lt;/div&gt;`</span></span>
<span id="cb4-1373"><a href="#cb4-1373" aria-hidden="true" tabindex="-1"></a><span class="in">    );</span></span>
<span id="cb4-1374"><a href="#cb4-1374" aria-hidden="true" tabindex="-1"></a><span class="in">  if (format)</span></span>
<span id="cb4-1375"><a href="#cb4-1375" aria-hidden="true" tabindex="-1"></a><span class="in">    format = typeof format === "function" ? format : d3format.format(format);</span></span>
<span id="cb4-1376"><a href="#cb4-1376" aria-hidden="true" tabindex="-1"></a><span class="in">  if (action) {</span></span>
<span id="cb4-1377"><a href="#cb4-1377" aria-hidden="true" tabindex="-1"></a><span class="in">    action(form);</span></span>
<span id="cb4-1378"><a href="#cb4-1378" aria-hidden="true" tabindex="-1"></a><span class="in">  } else {</span></span>
<span id="cb4-1379"><a href="#cb4-1379" aria-hidden="true" tabindex="-1"></a><span class="in">    const verb = submit</span></span>
<span id="cb4-1380"><a href="#cb4-1380" aria-hidden="true" tabindex="-1"></a><span class="in">      ? "onsubmit"</span></span>
<span id="cb4-1381"><a href="#cb4-1381" aria-hidden="true" tabindex="-1"></a><span class="in">      : type == "button"</span></span>
<span id="cb4-1382"><a href="#cb4-1382" aria-hidden="true" tabindex="-1"></a><span class="in">      ? "onclick"</span></span>
<span id="cb4-1383"><a href="#cb4-1383" aria-hidden="true" tabindex="-1"></a><span class="in">      : type == "checkbox" || type == "radio"</span></span>
<span id="cb4-1384"><a href="#cb4-1384" aria-hidden="true" tabindex="-1"></a><span class="in">      ? "onchange"</span></span>
<span id="cb4-1385"><a href="#cb4-1385" aria-hidden="true" tabindex="-1"></a><span class="in">      : "oninput";</span></span>
<span id="cb4-1386"><a href="#cb4-1386" aria-hidden="true" tabindex="-1"></a><span class="in">    form[verb] = e =&gt; {</span></span>
<span id="cb4-1387"><a href="#cb4-1387" aria-hidden="true" tabindex="-1"></a><span class="in">      e &amp;&amp; e.preventDefault();</span></span>
<span id="cb4-1388"><a href="#cb4-1388" aria-hidden="true" tabindex="-1"></a><span class="in">      const value = getValue ? getValue(form.input) : form.input.value;</span></span>
<span id="cb4-1389"><a href="#cb4-1389" aria-hidden="true" tabindex="-1"></a><span class="in">      if (form.output) {</span></span>
<span id="cb4-1390"><a href="#cb4-1390" aria-hidden="true" tabindex="-1"></a><span class="in">        const out = display ? display(value) : format ? format(value) : value;</span></span>
<span id="cb4-1391"><a href="#cb4-1391" aria-hidden="true" tabindex="-1"></a><span class="in">        if (out instanceof window.Element) {</span></span>
<span id="cb4-1392"><a href="#cb4-1392" aria-hidden="true" tabindex="-1"></a><span class="in">          while (form.output.hasChildNodes()) {</span></span>
<span id="cb4-1393"><a href="#cb4-1393" aria-hidden="true" tabindex="-1"></a><span class="in">            form.output.removeChild(form.output.lastChild);</span></span>
<span id="cb4-1394"><a href="#cb4-1394" aria-hidden="true" tabindex="-1"></a><span class="in">          }</span></span>
<span id="cb4-1395"><a href="#cb4-1395" aria-hidden="true" tabindex="-1"></a><span class="in">          form.output.append(out);</span></span>
<span id="cb4-1396"><a href="#cb4-1396" aria-hidden="true" tabindex="-1"></a><span class="in">        } else {</span></span>
<span id="cb4-1397"><a href="#cb4-1397" aria-hidden="true" tabindex="-1"></a><span class="in">          form.output.value = out;</span></span>
<span id="cb4-1398"><a href="#cb4-1398" aria-hidden="true" tabindex="-1"></a><span class="in">        }</span></span>
<span id="cb4-1399"><a href="#cb4-1399" aria-hidden="true" tabindex="-1"></a><span class="in">      }</span></span>
<span id="cb4-1400"><a href="#cb4-1400" aria-hidden="true" tabindex="-1"></a><span class="in">      form.value = value;</span></span>
<span id="cb4-1401"><a href="#cb4-1401" aria-hidden="true" tabindex="-1"></a><span class="in">      if (verb !== "oninput")</span></span>
<span id="cb4-1402"><a href="#cb4-1402" aria-hidden="true" tabindex="-1"></a><span class="in">        form.dispatchEvent(new CustomEvent("input", { bubbles: true }));</span></span>
<span id="cb4-1403"><a href="#cb4-1403" aria-hidden="true" tabindex="-1"></a><span class="in">    };</span></span>
<span id="cb4-1404"><a href="#cb4-1404" aria-hidden="true" tabindex="-1"></a><span class="in">    if (verb !== "oninput")</span></span>
<span id="cb4-1405"><a href="#cb4-1405" aria-hidden="true" tabindex="-1"></a><span class="in">      wrapper.oninput = e =&gt; e &amp;&amp; e.stopPropagation() &amp;&amp; e.preventDefault();</span></span>
<span id="cb4-1406"><a href="#cb4-1406" aria-hidden="true" tabindex="-1"></a><span class="in">    if (verb !== "onsubmit") form.onsubmit = e =&gt; e &amp;&amp; e.preventDefault();</span></span>
<span id="cb4-1407"><a href="#cb4-1407" aria-hidden="true" tabindex="-1"></a><span class="in">    form[verb]();</span></span>
<span id="cb4-1408"><a href="#cb4-1408" aria-hidden="true" tabindex="-1"></a><span class="in">  }</span></span>
<span id="cb4-1409"><a href="#cb4-1409" aria-hidden="true" tabindex="-1"></a><span class="in">  while (form.childNodes.length) {</span></span>
<span id="cb4-1410"><a href="#cb4-1410" aria-hidden="true" tabindex="-1"></a><span class="in">    wrapper.appendChild(form.childNodes[0]);</span></span>
<span id="cb4-1411"><a href="#cb4-1411" aria-hidden="true" tabindex="-1"></a><span class="in">  }</span></span>
<span id="cb4-1412"><a href="#cb4-1412" aria-hidden="true" tabindex="-1"></a><span class="in">  form.append(wrapper);</span></span>
<span id="cb4-1413"><a href="#cb4-1413" aria-hidden="true" tabindex="-1"></a><span class="in">  return form;</span></span>
<span id="cb4-1414"><a href="#cb4-1414" aria-hidden="true" tabindex="-1"></a><span class="in">}</span></span>
<span id="cb4-1415"><a href="#cb4-1415" aria-hidden="true" tabindex="-1"></a><span class="in">d3format = require("d3-format@1")</span></span>
<span id="cb4-1416"><a href="#cb4-1416" aria-hidden="true" tabindex="-1"></a><span class="in">// https://observablehq.com/@enjalot/draggable-world-map-coordinates-input</span></span>
<span id="cb4-1417"><a href="#cb4-1417" aria-hidden="true" tabindex="-1"></a><span class="in">function worldMapCoordinates(config = {}, dimensions) {</span></span>
<span id="cb4-1418"><a href="#cb4-1418" aria-hidden="true" tabindex="-1"></a><span class="in">  const {</span></span>
<span id="cb4-1419"><a href="#cb4-1419" aria-hidden="true" tabindex="-1"></a><span class="in">    value = [], title, description, width = dimensions[0]</span></span>
<span id="cb4-1420"><a href="#cb4-1420" aria-hidden="true" tabindex="-1"></a><span class="in">  } = Array.isArray(config) ? {value: config} : config;</span></span>
<span id="cb4-1421"><a href="#cb4-1421" aria-hidden="true" tabindex="-1"></a><span class="in">  const height = dimensions[1];</span></span>
<span id="cb4-1422"><a href="#cb4-1422" aria-hidden="true" tabindex="-1"></a><span class="in">  let [lon, lat] = value;</span></span>
<span id="cb4-1423"><a href="#cb4-1423" aria-hidden="true" tabindex="-1"></a><span class="in">  lon = lon != null ? lon : null;</span></span>
<span id="cb4-1424"><a href="#cb4-1424" aria-hidden="true" tabindex="-1"></a><span class="in">  lat = lat != null ? lat : null;</span></span>
<span id="cb4-1425"><a href="#cb4-1425" aria-hidden="true" tabindex="-1"></a><span class="in">  const formEl = html`&lt;form style="width: ${width}px;"&gt;&lt;/form&gt;`;</span></span>
<span id="cb4-1426"><a href="#cb4-1426" aria-hidden="true" tabindex="-1"></a><span class="in">  const context = DOM.context2d(width, height-width/13.2);</span></span>
<span id="cb4-1427"><a href="#cb4-1427" aria-hidden="true" tabindex="-1"></a><span class="in">  const canvas = context.canvas;</span></span>
<span id="cb4-1428"><a href="#cb4-1428" aria-hidden="true" tabindex="-1"></a><span class="in">  canvas.style.margin = `-10px 0px -26px 0px`;</span></span>
<span id="cb4-1429"><a href="#cb4-1429" aria-hidden="true" tabindex="-1"></a><span class="in">  const projection = d3</span></span>
<span id="cb4-1430"><a href="#cb4-1430" aria-hidden="true" tabindex="-1"></a><span class="in">    .geoEquirectangular()</span></span>
<span id="cb4-1431"><a href="#cb4-1431" aria-hidden="true" tabindex="-1"></a><span class="in">    .precision(0.1)</span></span>
<span id="cb4-1432"><a href="#cb4-1432" aria-hidden="true" tabindex="-1"></a><span class="in">    .fitSize([width, height], { type: "Sphere" }).rotate([-153, 0]);</span></span>
<span id="cb4-1433"><a href="#cb4-1433" aria-hidden="true" tabindex="-1"></a><span class="in">  const path = d3.geoPath(projection, context).pointRadius(2.5);</span></span>
<span id="cb4-1434"><a href="#cb4-1434" aria-hidden="true" tabindex="-1"></a><span class="in">  formEl.append(canvas);</span></span>
<span id="cb4-1435"><a href="#cb4-1435" aria-hidden="true" tabindex="-1"></a><span class="in">  function draw() {</span></span>
<span id="cb4-1436"><a href="#cb4-1436" aria-hidden="true" tabindex="-1"></a><span class="in">    context.fillStyle = "#fff";</span></span>
<span id="cb4-1437"><a href="#cb4-1437" aria-hidden="true" tabindex="-1"></a><span class="in">    context.fillRect(0, 0, width, height);</span></span>
<span id="cb4-1438"><a href="#cb4-1438" aria-hidden="true" tabindex="-1"></a><span class="in">    context.beginPath(); path({type: "Sphere"});</span></span>
<span id="cb4-1439"><a href="#cb4-1439" aria-hidden="true" tabindex="-1"></a><span class="in">    context.fillStyle = colors.ocean; context.fill();</span></span>
<span id="cb4-1440"><a href="#cb4-1440" aria-hidden="true" tabindex="-1"></a><span class="in">    context.beginPath();</span></span>
<span id="cb4-1441"><a href="#cb4-1441" aria-hidden="true" tabindex="-1"></a><span class="in">    path(graticule);</span></span>
<span id="cb4-1442"><a href="#cb4-1442" aria-hidden="true" tabindex="-1"></a><span class="in">    context.lineWidth = 0.95;</span></span>
<span id="cb4-1443"><a href="#cb4-1443" aria-hidden="true" tabindex="-1"></a><span class="in">    context.strokeStyle = `#aaa`;</span></span>
<span id="cb4-1444"><a href="#cb4-1444" aria-hidden="true" tabindex="-1"></a><span class="in">    context.stroke();</span></span>
<span id="cb4-1445"><a href="#cb4-1445" aria-hidden="true" tabindex="-1"></a><span class="in">    context.beginPath();</span></span>
<span id="cb4-1446"><a href="#cb4-1446" aria-hidden="true" tabindex="-1"></a><span class="in">    path(land);</span></span>
<span id="cb4-1447"><a href="#cb4-1447" aria-hidden="true" tabindex="-1"></a><span class="in">    context.fillStyle = colors.land;</span></span>
<span id="cb4-1448"><a href="#cb4-1448" aria-hidden="true" tabindex="-1"></a><span class="in">    context.fill();</span></span>
<span id="cb4-1449"><a href="#cb4-1449" aria-hidden="true" tabindex="-1"></a><span class="in">    context.beginPath();</span></span>
<span id="cb4-1450"><a href="#cb4-1450" aria-hidden="true" tabindex="-1"></a><span class="in">    path(countries);</span></span>
<span id="cb4-1451"><a href="#cb4-1451" aria-hidden="true" tabindex="-1"></a><span class="in">    context.lineWidth = .95;</span></span>
<span id="cb4-1452"><a href="#cb4-1452" aria-hidden="true" tabindex="-1"></a><span class="in">    context.strokeStyle = `#000`;</span></span>
<span id="cb4-1453"><a href="#cb4-1453" aria-hidden="true" tabindex="-1"></a><span class="in">    context.stroke();</span></span>
<span id="cb4-1454"><a href="#cb4-1454" aria-hidden="true" tabindex="-1"></a><span class="in">    context.fillStyle = `#000`;</span></span>
<span id="cb4-1455"><a href="#cb4-1455" aria-hidden="true" tabindex="-1"></a><span class="in">    context.font = width &lt; 760 ? "14px serif" : width &lt; 990 ? "17px serif" : "23px serif";</span></span>
<span id="cb4-1456"><a href="#cb4-1456" aria-hidden="true" tabindex="-1"></a><span class="in">    d3.range(-1.5, 342 + 1, 36).map(x =&gt;  context.fillText(long2zone(x), ...projection([x, 84 - (width &lt; 500) * 8.8])));</span></span>
<span id="cb4-1457"><a href="#cb4-1457" aria-hidden="true" tabindex="-1"></a><span class="in">    d3.range(-1.5, 342 + 1, 36).map(x =&gt;  context.fillText(long2zone(x), ...projection([x, -66 + (width &lt; 500) * 1.1])));</span></span>
<span id="cb4-1458"><a href="#cb4-1458" aria-hidden="true" tabindex="-1"></a><span class="in">    context.beginPath(), path(night), context.fillStyle = "rgba(0,0,255,0.1)", context.fill();</span></span>
<span id="cb4-1459"><a href="#cb4-1459" aria-hidden="true" tabindex="-1"></a><span class="in">    context.beginPath(); path.pointRadius(17); path({type: "Point", coordinates: sun}); context.strokeStyle = "#0008"; context.fillStyle = "#ff08"; context.lineWidth = 1; context.stroke(); context.fill();</span></span>
<span id="cb4-1460"><a href="#cb4-1460" aria-hidden="true" tabindex="-1"></a><span class="in">    if (lon != null &amp;&amp; lat != null) {</span></span>
<span id="cb4-1461"><a href="#cb4-1461" aria-hidden="true" tabindex="-1"></a><span class="in">      path.pointRadius(17); context.strokeStyle = "black";</span></span>
<span id="cb4-1462"><a href="#cb4-1462" aria-hidden="true" tabindex="-1"></a><span class="in">      context.beginPath(); path({type: "Point", coordinates: [lon, lat]}); context.lineWidth = 1; context.stroke();</span></span>
<span id="cb4-1463"><a href="#cb4-1463" aria-hidden="true" tabindex="-1"></a><span class="in">      context.lineWidth = 6;</span></span>
<span id="cb4-1464"><a href="#cb4-1464" aria-hidden="true" tabindex="-1"></a><span class="in">      path.pointRadius(14); context.strokeStyle = "red";</span></span>
<span id="cb4-1465"><a href="#cb4-1465" aria-hidden="true" tabindex="-1"></a><span class="in">      context.beginPath(); path({type: "Point", coordinates: [lon, lat]}); context.stroke();</span></span>
<span id="cb4-1466"><a href="#cb4-1466" aria-hidden="true" tabindex="-1"></a><span class="in">    }</span></span>
<span id="cb4-1467"><a href="#cb4-1467" aria-hidden="true" tabindex="-1"></a><span class="in">  }</span></span>
<span id="cb4-1468"><a href="#cb4-1468" aria-hidden="true" tabindex="-1"></a><span class="in">  let drag = d3.drag()</span></span>
<span id="cb4-1469"><a href="#cb4-1469" aria-hidden="true" tabindex="-1"></a><span class="in">    .on("drag", (event) =&gt; {</span></span>
<span id="cb4-1470"><a href="#cb4-1470" aria-hidden="true" tabindex="-1"></a><span class="in">      let coords = projection.invert([event.x, event.y]);</span></span>
<span id="cb4-1471"><a href="#cb4-1471" aria-hidden="true" tabindex="-1"></a><span class="in">      lon = +coords[0].toFixed(2);</span></span>
<span id="cb4-1472"><a href="#cb4-1472" aria-hidden="true" tabindex="-1"></a><span class="in">      lat = +coords[1].toFixed(2);</span></span>
<span id="cb4-1473"><a href="#cb4-1473" aria-hidden="true" tabindex="-1"></a><span class="in">      draw();</span></span>
<span id="cb4-1474"><a href="#cb4-1474" aria-hidden="true" tabindex="-1"></a><span class="in">      canvas.dispatchEvent(new CustomEvent("input", { bubbles: true }));</span></span>
<span id="cb4-1475"><a href="#cb4-1475" aria-hidden="true" tabindex="-1"></a><span class="in">    })</span></span>
<span id="cb4-1476"><a href="#cb4-1476" aria-hidden="true" tabindex="-1"></a><span class="in">  d3.select(canvas).call(drag)</span></span>
<span id="cb4-1477"><a href="#cb4-1477" aria-hidden="true" tabindex="-1"></a><span class="in">  canvas.onclick = function(ev) {</span></span>
<span id="cb4-1478"><a href="#cb4-1478" aria-hidden="true" tabindex="-1"></a><span class="in">    const { offsetX, offsetY } = ev;</span></span>
<span id="cb4-1479"><a href="#cb4-1479" aria-hidden="true" tabindex="-1"></a><span class="in">    let coords = projection.invert([offsetX, offsetY]);</span></span>
<span id="cb4-1480"><a href="#cb4-1480" aria-hidden="true" tabindex="-1"></a><span class="in">    lon = +coords[0].toFixed(2);</span></span>
<span id="cb4-1481"><a href="#cb4-1481" aria-hidden="true" tabindex="-1"></a><span class="in">    lat = +coords[1].toFixed(2);</span></span>
<span id="cb4-1482"><a href="#cb4-1482" aria-hidden="true" tabindex="-1"></a><span class="in">    draw();</span></span>
<span id="cb4-1483"><a href="#cb4-1483" aria-hidden="true" tabindex="-1"></a><span class="in">    canvas.dispatchEvent(new CustomEvent("input", { bubbles: true }));</span></span>
<span id="cb4-1484"><a href="#cb4-1484" aria-hidden="true" tabindex="-1"></a><span class="in">  };</span></span>
<span id="cb4-1485"><a href="#cb4-1485" aria-hidden="true" tabindex="-1"></a><span class="in">  draw();</span></span>
<span id="cb4-1486"><a href="#cb4-1486" aria-hidden="true" tabindex="-1"></a><span class="in">  const form = input({</span></span>
<span id="cb4-1487"><a href="#cb4-1487" aria-hidden="true" tabindex="-1"></a><span class="in">    type: "worldMapCoordinates",</span></span>
<span id="cb4-1488"><a href="#cb4-1488" aria-hidden="true" tabindex="-1"></a><span class="in">    title,</span></span>
<span id="cb4-1489"><a href="#cb4-1489" aria-hidden="true" tabindex="-1"></a><span class="in">    description,</span></span>
<span id="cb4-1490"><a href="#cb4-1490" aria-hidden="true" tabindex="-1"></a><span class="in">    display: v =&gt; (width &gt; 300) ? html`&lt;div style="width: ${width}px; white-space: nowrap; color: #444; text-align: center; font: ${width / 50}px monospace; position: relative; top: -${width / 30}px;  margin-bottom: -.4em;"&gt;</span></span>
<span id="cb4-1491"><a href="#cb4-1491" aria-hidden="true" tabindex="-1"></a><span class="in">            &lt;span style="color: #000;"&gt;Zone:&lt;/span&gt; ${lon != null ? long2zone(lon) : ""}</span></span>
<span id="cb4-1492"><a href="#cb4-1492" aria-hidden="true" tabindex="-1"></a><span class="in">            &amp;nbsp; &amp;nbsp;</span></span>
<span id="cb4-1493"><a href="#cb4-1493" aria-hidden="true" tabindex="-1"></a><span class="in">            &lt;span style="color: #000;"&gt;Longitude:&lt;/span&gt; ${lon != null ? (long2turn(lon)).toFixed(0) : ""}</span></span>
<span id="cb4-1494"><a href="#cb4-1494" aria-hidden="true" tabindex="-1"></a><span class="in">            &amp;nbsp; &amp;nbsp;</span></span>
<span id="cb4-1495"><a href="#cb4-1495" aria-hidden="true" tabindex="-1"></a><span class="in">            &lt;span style="color: #000;"&gt;Latitude:&lt;/span&gt; ${lat != null ? ((lati2turn1(lat))).toFixed(0) : ""}</span></span>
<span id="cb4-1496"><a href="#cb4-1496" aria-hidden="true" tabindex="-1"></a><span class="in">          &lt;/div&gt;` : '',</span></span>
<span id="cb4-1497"><a href="#cb4-1497" aria-hidden="true" tabindex="-1"></a><span class="in">    getValue: () =&gt; [lon != null ? lon : null, lat != null ? lat : null],</span></span>
<span id="cb4-1498"><a href="#cb4-1498" aria-hidden="true" tabindex="-1"></a><span class="in">    form: formEl</span></span>
<span id="cb4-1499"><a href="#cb4-1499" aria-hidden="true" tabindex="-1"></a><span class="in">  });</span></span>
<span id="cb4-1500"><a href="#cb4-1500" aria-hidden="true" tabindex="-1"></a><span class="in">  return form;</span></span>
<span id="cb4-1501"><a href="#cb4-1501" aria-hidden="true" tabindex="-1"></a><span class="in">}</span></span>
<span id="cb4-1502"><a href="#cb4-1502" aria-hidden="true" tabindex="-1"></a><span class="in">sun = {</span></span>
<span id="cb4-1503"><a href="#cb4-1503" aria-hidden="true" tabindex="-1"></a><span class="in">  const now = new Date;</span></span>
<span id="cb4-1504"><a href="#cb4-1504" aria-hidden="true" tabindex="-1"></a><span class="in">  const day = new Date(+now).setUTCHours(0, 0, 0, 0);</span></span>
<span id="cb4-1505"><a href="#cb4-1505" aria-hidden="true" tabindex="-1"></a><span class="in">  const t = solar.century(now);</span></span>
<span id="cb4-1506"><a href="#cb4-1506" aria-hidden="true" tabindex="-1"></a><span class="in">  const longitude = (day - now) / 864e5 * 360 - 180;</span></span>
<span id="cb4-1507"><a href="#cb4-1507" aria-hidden="true" tabindex="-1"></a><span class="in">  return [longitude - solar.equationOfTime(t) / 4, solar.declination(t)];</span></span>
<span id="cb4-1508"><a href="#cb4-1508" aria-hidden="true" tabindex="-1"></a><span class="in">}</span></span>
<span id="cb4-1509"><a href="#cb4-1509" aria-hidden="true" tabindex="-1"></a><span class="in">night = d3.geoCircle()</span></span>
<span id="cb4-1510"><a href="#cb4-1510" aria-hidden="true" tabindex="-1"></a><span class="in">    .radius(90)</span></span>
<span id="cb4-1511"><a href="#cb4-1511" aria-hidden="true" tabindex="-1"></a><span class="in">    .center(antipode(sun))</span></span>
<span id="cb4-1512"><a href="#cb4-1512" aria-hidden="true" tabindex="-1"></a><span class="in">  ()</span></span>
<span id="cb4-1513"><a href="#cb4-1513" aria-hidden="true" tabindex="-1"></a><span class="in">antipode = ([longitude, latitude]) =&gt; [longitude + 180, -latitude]</span></span>
<span id="cb4-1514"><a href="#cb4-1514" aria-hidden="true" tabindex="-1"></a><span class="in">solar = require("solar-calculator@0.3/dist/solar-calculator.min.js")</span></span>
<span id="cb4-1515"><a href="#cb4-1515" aria-hidden="true" tabindex="-1"></a><span class="in">viewof fancySecondsOFF = Inputs.toggle({</span></span>
<span id="cb4-1516"><a href="#cb4-1516" aria-hidden="true" tabindex="-1"></a><span class="in">  label: "Ticking clock",</span></span>
<span id="cb4-1517"><a href="#cb4-1517" aria-hidden="true" tabindex="-1"></a><span class="in">  value: true,</span></span>
<span id="cb4-1518"><a href="#cb4-1518" aria-hidden="true" tabindex="-1"></a><span class="in">})</span></span>
<span id="cb4-1519"><a href="#cb4-1519" aria-hidden="true" tabindex="-1"></a><span class="in">function setStyle(content, style = {}) {</span></span>
<span id="cb4-1520"><a href="#cb4-1520" aria-hidden="true" tabindex="-1"></a><span class="in">  function yiq(color) {</span></span>
<span id="cb4-1521"><a href="#cb4-1521" aria-hidden="true" tabindex="-1"></a><span class="in">    const {r, g, b} = d3.rgb(color);</span></span>
<span id="cb4-1522"><a href="#cb4-1522" aria-hidden="true" tabindex="-1"></a><span class="in">    return (r * 299 + g * 587 + b * 114) / 1000 / 255; // returns values between 0 and 1</span></span>
<span id="cb4-1523"><a href="#cb4-1523" aria-hidden="true" tabindex="-1"></a><span class="in">  }</span></span>
<span id="cb4-1524"><a href="#cb4-1524" aria-hidden="true" tabindex="-1"></a><span class="in">  const {</span></span>
<span id="cb4-1525"><a href="#cb4-1525" aria-hidden="true" tabindex="-1"></a><span class="in">    background,</span></span>
<span id="cb4-1526"><a href="#cb4-1526" aria-hidden="true" tabindex="-1"></a><span class="in">    color = yiq(background) &gt;= 0.6 ? "#111" : "white",</span></span>
<span id="cb4-1527"><a href="#cb4-1527" aria-hidden="true" tabindex="-1"></a><span class="in">    padding = "0 1px",</span></span>
<span id="cb4-1528"><a href="#cb4-1528" aria-hidden="true" tabindex="-1"></a><span class="in">    borderRadius = "4px",</span></span>
<span id="cb4-1529"><a href="#cb4-1529" aria-hidden="true" tabindex="-1"></a><span class="in">    fontWeight = 900,</span></span>
<span id="cb4-1530"><a href="#cb4-1530" aria-hidden="true" tabindex="-1"></a><span class="in">    fontSize = "1em",</span></span>
<span id="cb4-1531"><a href="#cb4-1531" aria-hidden="true" tabindex="-1"></a><span class="in">    ...rest</span></span>
<span id="cb4-1532"><a href="#cb4-1532" aria-hidden="true" tabindex="-1"></a><span class="in">  } = typeof style === "string" ? {background: style} : style;</span></span>
<span id="cb4-1533"><a href="#cb4-1533" aria-hidden="true" tabindex="-1"></a><span class="in">  return htl.html`&lt;span style=${{</span></span>
<span id="cb4-1534"><a href="#cb4-1534" aria-hidden="true" tabindex="-1"></a><span class="in">    background,</span></span>
<span id="cb4-1535"><a href="#cb4-1535" aria-hidden="true" tabindex="-1"></a><span class="in">    color,</span></span>
<span id="cb4-1536"><a href="#cb4-1536" aria-hidden="true" tabindex="-1"></a><span class="in">    padding,</span></span>
<span id="cb4-1537"><a href="#cb4-1537" aria-hidden="true" tabindex="-1"></a><span class="in">    borderRadius,</span></span>
<span id="cb4-1538"><a href="#cb4-1538" aria-hidden="true" tabindex="-1"></a><span class="in">    fontWeight,</span></span>
<span id="cb4-1539"><a href="#cb4-1539" aria-hidden="true" tabindex="-1"></a><span class="in">    ...rest</span></span>
<span id="cb4-1540"><a href="#cb4-1540" aria-hidden="true" tabindex="-1"></a><span class="in">  }}&gt;${content}&lt;/span&gt;`;</span></span>
<span id="cb4-1541"><a href="#cb4-1541" aria-hidden="true" tabindex="-1"></a><span class="in">}</span></span>
<span id="cb4-1542"><a href="#cb4-1542" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb4-1543"><a href="#cb4-1543" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-1544"><a href="#cb4-1544" aria-hidden="true" tabindex="-1"></a><span class="in">```{=html}</span></span>
<span id="cb4-1545"><a href="#cb4-1545" aria-hidden="true" tabindex="-1"></a><span class="in">&lt;style&gt;</span></span>
<span id="cb4-1546"><a href="#cb4-1546" aria-hidden="true" tabindex="-1"></a><span class="in">  #barClock {</span></span>
<span id="cb4-1547"><a href="#cb4-1547" aria-hidden="true" tabindex="-1"></a><span class="in">    width: 100%;</span></span>
<span id="cb4-1548"><a href="#cb4-1548" aria-hidden="true" tabindex="-1"></a><span class="in">  }</span></span>
<span id="cb4-1549"><a href="#cb4-1549" aria-hidden="true" tabindex="-1"></a><span class="in">  .tickLabel, .tickLabel1, .tickLabel2, .timeLabel {</span></span>
<span id="cb4-1550"><a href="#cb4-1550" aria-hidden="true" tabindex="-1"></a><span class="in">    fill: #000;</span></span>
<span id="cb4-1551"><a href="#cb4-1551" aria-hidden="true" tabindex="-1"></a><span class="in">    font-family: monospace;</span></span>
<span id="cb4-1552"><a href="#cb4-1552" aria-hidden="true" tabindex="-1"></a><span class="in">    text-anchor: middle;</span></span>
<span id="cb4-1553"><a href="#cb4-1553" aria-hidden="true" tabindex="-1"></a><span class="in">  }</span></span>
<span id="cb4-1554"><a href="#cb4-1554" aria-hidden="true" tabindex="-1"></a><span class="in">  .timeLabel {</span></span>
<span id="cb4-1555"><a href="#cb4-1555" aria-hidden="true" tabindex="-1"></a><span class="in">    text-anchor: start;</span></span>
<span id="cb4-1556"><a href="#cb4-1556" aria-hidden="true" tabindex="-1"></a><span class="in">  }</span></span>
<span id="cb4-1557"><a href="#cb4-1557" aria-hidden="true" tabindex="-1"></a><span class="in">  .timeBar, .timeBarFull, .timeBarFullN {</span></span>
<span id="cb4-1558"><a href="#cb4-1558" aria-hidden="true" tabindex="-1"></a><span class="in">    x: 1px;</span></span>
<span id="cb4-1559"><a href="#cb4-1559" aria-hidden="true" tabindex="-1"></a><span class="in">    height: 25px;</span></span>
<span id="cb4-1560"><a href="#cb4-1560" aria-hidden="true" tabindex="-1"></a><span class="in">    rx: 5px;</span></span>
<span id="cb4-1561"><a href="#cb4-1561" aria-hidden="true" tabindex="-1"></a><span class="in">    stroke: #aaa;</span></span>
<span id="cb4-1562"><a href="#cb4-1562" aria-hidden="true" tabindex="-1"></a><span class="in">  }</span></span>
<span id="cb4-1563"><a href="#cb4-1563" aria-hidden="true" tabindex="-1"></a><span class="in">  .timeBar {</span></span>
<span id="cb4-1564"><a href="#cb4-1564" aria-hidden="true" tabindex="-1"></a><span class="in">    fill: #e8e8e8;</span></span>
<span id="cb4-1565"><a href="#cb4-1565" aria-hidden="true" tabindex="-1"></a><span class="in">  }</span></span>
<span id="cb4-1566"><a href="#cb4-1566" aria-hidden="true" tabindex="-1"></a><span class="in">  .timeBarFull {</span></span>
<span id="cb4-1567"><a href="#cb4-1567" aria-hidden="true" tabindex="-1"></a><span class="in">    fill: #ccffff;</span></span>
<span id="cb4-1568"><a href="#cb4-1568" aria-hidden="true" tabindex="-1"></a><span class="in">  }</span></span>
<span id="cb4-1569"><a href="#cb4-1569" aria-hidden="true" tabindex="-1"></a><span class="in">  .timeBarFullN {</span></span>
<span id="cb4-1570"><a href="#cb4-1570" aria-hidden="true" tabindex="-1"></a><span class="in">    fill: #ffcccc;</span></span>
<span id="cb4-1571"><a href="#cb4-1571" aria-hidden="true" tabindex="-1"></a><span class="in">  }</span></span>
<span id="cb4-1572"><a href="#cb4-1572" aria-hidden="true" tabindex="-1"></a><span class="in">  .background {</span></span>
<span id="cb4-1573"><a href="#cb4-1573" aria-hidden="true" tabindex="-1"></a><span class="in">    fill: white;</span></span>
<span id="cb4-1574"><a href="#cb4-1574" aria-hidden="true" tabindex="-1"></a><span class="in">  }</span></span>
<span id="cb4-1575"><a href="#cb4-1575" aria-hidden="true" tabindex="-1"></a><span class="in">  .tickDek, .tickDotd, .tickDotd1, .tickC, .tickC1, .tickM, .tickM1, .tickB, .tickB1 {</span></span>
<span id="cb4-1576"><a href="#cb4-1576" aria-hidden="true" tabindex="-1"></a><span class="in">    stroke: none;</span></span>
<span id="cb4-1577"><a href="#cb4-1577" aria-hidden="true" tabindex="-1"></a><span class="in">    fill: #666;</span></span>
<span id="cb4-1578"><a href="#cb4-1578" aria-hidden="true" tabindex="-1"></a><span class="in">    width: 1px;</span></span>
<span id="cb4-1579"><a href="#cb4-1579" aria-hidden="true" tabindex="-1"></a><span class="in">  }</span></span>
<span id="cb4-1580"><a href="#cb4-1580" aria-hidden="true" tabindex="-1"></a><span class="in">#clock {</span></span>
<span id="cb4-1581"><a href="#cb4-1581" aria-hidden="true" tabindex="-1"></a><span class="in">  stroke: #000;</span></span>
<span id="cb4-1582"><a href="#cb4-1582" aria-hidden="true" tabindex="-1"></a><span class="in">  font-family: "HelveticaNeue-Light", "Helvetica Neue Light", "Helvetica Neue", Helvetica, Arial, "Lucida Grande", sans-serif;</span></span>
<span id="cb4-1583"><a href="#cb4-1583" aria-hidden="true" tabindex="-1"></a><span class="in">}</span></span>
<span id="cb4-1584"><a href="#cb4-1584" aria-hidden="true" tabindex="-1"></a><span class="in">#clock #rim {</span></span>
<span id="cb4-1585"><a href="#cb4-1585" aria-hidden="true" tabindex="-1"></a><span class="in">  fill: none;</span></span>
<span id="cb4-1586"><a href="#cb4-1586" aria-hidden="true" tabindex="-1"></a><span class="in">  stroke: #999;</span></span>
<span id="cb4-1587"><a href="#cb4-1587" aria-hidden="true" tabindex="-1"></a><span class="in">  stroke-width: 3px;</span></span>
<span id="cb4-1588"><a href="#cb4-1588" aria-hidden="true" tabindex="-1"></a><span class="in">}</span></span>
<span id="cb4-1589"><a href="#cb4-1589" aria-hidden="true" tabindex="-1"></a><span class="in">#clock .second-hand {</span></span>
<span id="cb4-1590"><a href="#cb4-1590" aria-hidden="true" tabindex="-1"></a><span class="in">  stroke-width: 3;</span></span>
<span id="cb4-1591"><a href="#cb4-1591" aria-hidden="true" tabindex="-1"></a><span class="in">}</span></span>
<span id="cb4-1592"><a href="#cb4-1592" aria-hidden="true" tabindex="-1"></a><span class="in">#clock .minute-hand {</span></span>
<span id="cb4-1593"><a href="#cb4-1593" aria-hidden="true" tabindex="-1"></a><span class="in">  stroke-width: 8;</span></span>
<span id="cb4-1594"><a href="#cb4-1594" aria-hidden="true" tabindex="-1"></a><span class="in">  stroke-linecap: round;</span></span>
<span id="cb4-1595"><a href="#cb4-1595" aria-hidden="true" tabindex="-1"></a><span class="in">}</span></span>
<span id="cb4-1596"><a href="#cb4-1596" aria-hidden="true" tabindex="-1"></a><span class="in">#clock .hour-hand {</span></span>
<span id="cb4-1597"><a href="#cb4-1597" aria-hidden="true" tabindex="-1"></a><span class="in">  stroke-width: 12;</span></span>
<span id="cb4-1598"><a href="#cb4-1598" aria-hidden="true" tabindex="-1"></a><span class="in">  stroke-linecap: round;</span></span>
<span id="cb4-1599"><a href="#cb4-1599" aria-hidden="true" tabindex="-1"></a><span class="in">}</span></span>
<span id="cb4-1600"><a href="#cb4-1600" aria-hidden="true" tabindex="-1"></a><span class="in">#clock .hands-cover {</span></span>
<span id="cb4-1601"><a href="#cb4-1601" aria-hidden="true" tabindex="-1"></a><span class="in">  stroke-width: 3;</span></span>
<span id="cb4-1602"><a href="#cb4-1602" aria-hidden="true" tabindex="-1"></a><span class="in">  fill: #fff;</span></span>
<span id="cb4-1603"><a href="#cb4-1603" aria-hidden="true" tabindex="-1"></a><span class="in">}</span></span>
<span id="cb4-1604"><a href="#cb4-1604" aria-hidden="true" tabindex="-1"></a><span class="in">#clock .second-tick {</span></span>
<span id="cb4-1605"><a href="#cb4-1605" aria-hidden="true" tabindex="-1"></a><span class="in">  stroke-width: 3;</span></span>
<span id="cb4-1606"><a href="#cb4-1606" aria-hidden="true" tabindex="-1"></a><span class="in">  fill: #000;</span></span>
<span id="cb4-1607"><a href="#cb4-1607" aria-hidden="true" tabindex="-1"></a><span class="in">}</span></span>
<span id="cb4-1608"><a href="#cb4-1608" aria-hidden="true" tabindex="-1"></a><span class="in">#clock .hour-tick {</span></span>
<span id="cb4-1609"><a href="#cb4-1609" aria-hidden="true" tabindex="-1"></a><span class="in">  stroke-width: 8; // same as the minute hand</span></span>
<span id="cb4-1610"><a href="#cb4-1610" aria-hidden="true" tabindex="-1"></a><span class="in">}</span></span>
<span id="cb4-1611"><a href="#cb4-1611" aria-hidden="true" tabindex="-1"></a><span class="in">#clock .second-label {</span></span>
<span id="cb4-1612"><a href="#cb4-1612" aria-hidden="true" tabindex="-1"></a><span class="in">  font-size: 18px;</span></span>
<span id="cb4-1613"><a href="#cb4-1613" aria-hidden="true" tabindex="-1"></a><span class="in">}</span></span>
<span id="cb4-1614"><a href="#cb4-1614" aria-hidden="true" tabindex="-1"></a><span class="in">#clock .hour-label {</span></span>
<span id="cb4-1615"><a href="#cb4-1615" aria-hidden="true" tabindex="-1"></a><span class="in">  font-size: 32px</span></span>
<span id="cb4-1616"><a href="#cb4-1616" aria-hidden="true" tabindex="-1"></a><span class="in">}</span></span>
<span id="cb4-1617"><a href="#cb4-1617" aria-hidden="true" tabindex="-1"></a><span class="in">.clocks * {</span></span>
<span id="cb4-1618"><a href="#cb4-1618" aria-hidden="true" tabindex="-1"></a><span class="in">  margin: -10px 0px 10px 0px;</span></span>
<span id="cb4-1619"><a href="#cb4-1619" aria-hidden="true" tabindex="-1"></a><span class="in">  padding: 0px;</span></span>
<span id="cb4-1620"><a href="#cb4-1620" aria-hidden="true" tabindex="-1"></a><span class="in">}</span></span>
<span id="cb4-1621"><a href="#cb4-1621" aria-hidden="true" tabindex="-1"></a><span class="in">&lt;/style&gt;</span></span>
<span id="cb4-1622"><a href="#cb4-1622" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
</code><button title="Copy to Clipboard" class="code-copy-button" data-in-quarto-modal=""><i class="bi"></i></button></pre></div>
</div></div></div></div></div>
</div> <!-- /content -->
<footer class="footer">
  <div class="nav-footer">
    <div class="nav-footer-left">
<p>¬© Copyright 2024, Martin Laptev</p>
</div>   
    <div class="nav-footer-center">
      &nbsp;
    <div class="toc-actions d-sm-block d-md-none"><ul><li><a href="https://github.com/maptv/maptv.github.io/blob/main/dec/time/index.qmd" class="toc-action"><i class="bi bi-github"></i>View source</a></li></ul></div></div>
    <div class="nav-footer-right">
      <ul class="footer-items list-unstyled">
    <li class="nav-item compact">
    <a class="nav-link" href="https://github.com/maptv" target="_blank">
      <i class="bi bi-github" role="img">
</i> 
    </a>
  </li>  
    <li class="nav-item compact">
    <a class="nav-link" href="https://linkedin.com/in/maptv" target="_blank">
      <i class="bi bi-linkedin" role="img">
</i> 
    </a>
  </li>  
    <li class="nav-item compact">
    <a class="nav-link active" href="mailto:maptv@engineer.com" aria-current="page">
      <i class="bi bi-envelope-at" role="img">
</i> 
    </a>
  </li>  
</ul>
    </div>
  </div>
</footer>




</body></html>